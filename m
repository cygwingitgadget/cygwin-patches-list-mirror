From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-patches@cygwin.com>
Subject: daemon snapshot
Date: Mon, 24 Sep 2001 06:37:00 -0000
Message-id: <0db501c144fe$1b7ccbf0$0200a8c0@lifelesswks>
X-SW-Source: 2001-q3/msg00189.html
Content-type: multipart/mixed; boundary="----------=_1583532849-65438-105"

This is a multi-part message in MIME format...

------------=_1583532849-65438-105
Content-length: 203

Well I've been puddling along adding shm features. We're nearly core
feature complete now. (I haven't had much time to commit to it :[).

Attached is a snapshot for your delight and entertainment.

Rob


------------=_1583532849-65438-105
Content-Type: text/x-diff; charset=us-ascii; name="daemonsnap20010924.patch"
Content-Disposition: inline; filename="daemonsnap20010924.patch"
Content-Transfer-Encoding: base64
Content-Length: 114550

UGF0Y2ggZmlsZSBnZW5lcmF0ZWQgTW9uIFNlcCAyNCAyMzoxMTozNiAgMjAw
MSBmcm9tCkNWUyBicmFuY2ggY3ZzdXBsb2NhbApDVlMgcmVwb3NpdG9yeTog
cm9iZXJ0Y0AxOTIuMTY4LjAuMTovaG9tZS9yb2JlcnRjL2N2c3VwL2N5Z3dp
bi9zcmMKQ1ZTIG1vZHVsZTogc3JjCgpJbmRleDogc3JjL25ld2xpYi9saWJj
L2luY2x1ZGUvc3lzL3R5cGVzLmgKZGlmZiAtdSBzcmMvbmV3bGliL2xpYmMv
aW5jbHVkZS9zeXMvdHlwZXMuaDoxLjcgc3JjL25ld2xpYi9saWJjL2luY2x1
ZGUvc3lzL3R5cGVzLmg6MS43LjIuMQotLS0gc3JjL25ld2xpYi9saWJjL2lu
Y2x1ZGUvc3lzL3R5cGVzLmg6MS43CVRodSBBcHIgMTIgMTA6MDU6NTcgMjAw
MQorKysgc3JjL25ld2xpYi9saWJjL2luY2x1ZGUvc3lzL3R5cGVzLmgJTW9u
IFNlcCAyNCAyMjoyNTo0NSAyMDAxCkBAIC0xMzMsNyArMTMzLDExIEBACiB0
eXBlZGVmCXVuc2lnbmVkIHNob3J0CXVpZF90OwogdHlwZWRlZgl1bnNpZ25l
ZCBzaG9ydAlnaWRfdDsKIHR5cGVkZWYgaW50IHBpZF90OwotdHlwZWRlZgls
b25nIGtleV90OworI2lmIGRlZmluZWQgKF9fQ1lHV0lOX18pCit0eXBlZGVm
IGxvbmcgbG9uZyBpbnQga2V5X3Q7CisjZWxzZQordHlwZWRlZiBsb25nIGtl
eV90OworI2VuZGlmIC8qIF9fQ1lHV0lOX18gKi8KIHR5cGVkZWYgbG9uZyBz
c2l6ZV90OwogCiAjaWZkZWYgX19NU190eXBlc19fCkluZGV4OiBzcmMvd2lu
c3VwL2N5Z3dpbi9NYWtlZmlsZS5pbgpkaWZmIC11IHNyYy93aW5zdXAvY3ln
d2luL01ha2VmaWxlLmluOjEuNjIgc3JjL3dpbnN1cC9jeWd3aW4vTWFrZWZp
bGUuaW46MS42Mi4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL01ha2VmaWxl
LmluOjEuNjIJU2F0IFNlcCAxNSAxNDozNjo0MyAyMDAxCisrKyBzcmMvd2lu
c3VwL2N5Z3dpbi9NYWtlZmlsZS5pbglNb24gU2VwIDI0IDIyOjQ5OjEwIDIw
MDEKQEAgLTExNiwxNiArMTE2LDE5IEBACiAKIERMTF9JTVBPUlRTOj0kKHcz
MmFwaV9saWIpL2xpYmtlcm5lbDMyLmEKIAotRExMX09GSUxFUzo9YXNzZXJ0
Lm8gYXV0b2xvYWQubyBjeWdoZWFwLm8gZGNydDAubyBkZWJ1Zy5vIGRlbHF1
ZXVlLm8gZGlyLm8gXAorRExMX09GSUxFUzo9YXNzZXJ0Lm8gYXV0b2xvYWQu
byBjeWdoZWFwLm8gY3lnc2VydmVyX2NsaWVudC5vIGN5Z3NlcnZlcl9zaG0u
byBcCisJY3lnc2VydmVyX3RyYW5zcG9ydC5vIGN5Z3NlcnZlcl90cmFuc3Bv
cnRfcGlwZXMubyBkY3J0MC5vIGRlYnVnLm8gXAorCWRlbHF1ZXVlLm8gZGly
Lm8gXAogCWRsZmNuLm8gZGxsX2luaXQubyBkdGFibGUubyBlbnZpcm9uLm8g
IGVycm5vLm8gZXhjZXB0aW9ucy5vIGV4ZWMubyBcCiAJZXh0ZXJuYWwubyBm
Y250bC5vIGZoYW5kbGVyLm8gZmhhbmRsZXJfY2xpcGJvYXJkLm8gZmhhbmRs
ZXJfY29uc29sZS5vIFwKIAlmaGFuZGxlcl9kc3AubyBmaGFuZGxlcl9mbG9w
cHkubyBmaGFuZGxlcl9tZW0ubyBmaGFuZGxlcl9yYW5kb20ubyBcCiAJZmhh
bmRsZXJfcmF3Lm8gZmhhbmRsZXJfc2VyaWFsLm8gZmhhbmRsZXJfc29ja2V0
Lm8gZmhhbmRsZXJfdGFwZS5vIFwKIAlmaGFuZGxlcl90ZXJtaW9zLm8gZmhh
bmRsZXJfdHR5Lm8gZmhhbmRsZXJfd2luZG93cy5vIGZoYW5kbGVyX3plcm8u
byBcCi0JZm9yay5vIGdsb2IubyBncnAubyBoZWFwLm8gaW5pdC5vIGlvY3Rs
Lm8gbG9jYWx0aW1lLm8gbWFsbG9jLm8gXAorCWZvcmsubyBnbG9iLm8gZ3Jw
Lm8gaGVhcC5vIGluaXQubyBpb2N0bC5vIGlwYy5vIGxvY2FsdGltZS5vIG1h
bGxvYy5vIFwKIAltaXNjZnVuY3MubyBtbWFwLm8gbmV0Lm8gbnRlYS5vIHBh
c3N3ZC5vIHBhdGgubyBwaW5mby5vIHBpcGUubyBwb2xsLm8gXAogCXB0aHJl
YWQubyByZWdleHAubyByZWdlcnJvci5vIHJlZ3N1Yi5vIHJlZ2lzdHJ5Lm8g
cmVzb3VyY2UubyBzY2FuZGlyLm8gXAotCXNjaGVkLm8gc2VjX2FjbC5vIHNl
Y19oZWxwZXIubyBzZWN1cml0eS5vIHNlbGVjdC5vIHNoYXJlZC5vIHNob3J0
Y3V0Lm8gc2lnbmFsLm8gc2lncHJvYy5vIFwKKwlzY2hlZC5vIHNlY19hY2wu
byBzZWNfaGVscGVyLm8gc2VjdXJpdHkubyBzZWxlY3QubyBzaGFyZWQubyBz
aG0ubyBcCisJc2hvcnRjdXQubyBzaWduYWwubyBzaWdwcm9jLm8gXAogCXNt
YWxscHJpbnQubyBzcGF3bi5vIHN0cmFjZS5vIHN0cnNlcC5vIHN5bmMubyBz
eXNjYWxscy5vIHN5c2NvbmYubyBcCiAJc3lzbG9nLm8gdGVybWlvcy5vIHRo
cmVhZC5vIHRpbWVzLm8gdHR5Lm8gdWluZm8ubyB1bmFtZS5vIHdhaXQubyBc
CiAJd2luY2FwLm8gd2luZG93Lm8gXApAQCAtMTQ0LDEzICsxNDcsMTYgQEAK
IAogYWxsOiBhbGxfdGFyZ2V0ICQoYWxsX2hvc3QpCiAKLWFsbF90YXJnZXQ6
ICQoTElCX05BTUUpIGF1dG9tb2RlLm8gYmlubW9kZS5vIHRleHRtb2RlLm8g
JChMSUJHTU9OX0EpCithbGxfdGFyZ2V0OiAkKExJQl9OQU1FKSBhdXRvbW9k
ZS5vIGJpbm1vZGUubyB0ZXh0bW9kZS5vICQoTElCR01PTl9BKSBjeWdzZXJ2
ZXIuZXhlCiAKIGFsbF9ob3N0OiBuZXctJChMSUJfTkFNRSkgY3lncnVuLmV4
ZQogCiBmb3JjZToKIAotaW5zdGFsbDogaW5zdGFsbC1saWJzIGluc3RhbGwt
aGVhZGVycyAkKGluc3RhbGxfaG9zdCkgJChpbnN0YWxsX3RhcmdldCkKK2lu
c3RhbGw6IGluc3RhbGwtYmluIGluc3RhbGwtbGlicyBpbnN0YWxsLWhlYWRl
cnMgJChpbnN0YWxsX2hvc3QpICQoaW5zdGFsbF90YXJnZXQpCisKK2luc3Rh
bGwtYmluOiBjeWdzZXJ2ZXIuZXhlCisJJChJTlNUQUxMX1BST0dSQU0pIGN5
Z3NlcnZlci5leGUgJChiaW5kaXIpL2N5Z3NlcnZlci5leGUJCiAKIGluc3Rh
bGwtbGliczogJChMSUJfTkFNRSkKIAkkKElOU1RBTExfREFUQSkgbmV3LSQo
RExMX05BTUUpICQoYmluZGlyKS8kKERMTF9OQU1FKTsgXApAQCAtMjEwLDEy
ICsyMTYsMzMgQEAKIHdpbnZlcl9zdGFtcDogbWt2ZXJzLnNoIGluY2x1ZGUv
Y3lnd2luL3ZlcnNpb24uaCB3aW52ZXIucmMgJChETExfT0ZJTEVTKQogCUBl
Y2hvICJNYWtpbmcgdmVyc2lvbi5vIGFuZCB3aW52ZXIubyI7XAogCSQoU0hF
TEwpICR7d29yZCAxLCRefSAke3dvcmQgMiwkXn0gJHt3b3JkIDMsJF59ICQo
V0lORFJFUykgJiYgXAotCXRvdWNoICRAICYmIFwKLQkkKENPTVBJTEVfQ1hY
KSAtbyB2ZXJzaW9uLm8gdmVyc2lvbi5jYworCSQoQ1hYKSAtYyAtbyB2ZXJz
aW9uLm8gdmVyc2lvbi5jYyAmJlwKKwl0b3VjaCAkQAogCiBjeWdydW4uZXhl
IDogY3lncnVuLm8gJChMSUJfTkFNRSkgJCh3MzJhcGlfbGliKS9saWJ1c2Vy
MzIuYSBcCiAJICAgICAkKHczMmFwaV9saWIpL2xpYnNoZWxsMzIuYSAkKHcz
MmFwaV9saWIpL2xpYmtlcm5lbDMyLmEKIAkkKENDKSAtbm9kZWZhdWx0bGli
cyAtbyAkQCAkXgorCitjeWdzZXJ2ZXJfdHJhbnNwb3J0X291dHNpZGUubzog
Y3lnc2VydmVyX3RyYW5zcG9ydC5jYworCSQoQ09NUElMRV9DWFgpIC1EX19P
VVRTSURFX0NZR1dJTl9fIC1vICRAICQ8CisKK2N5Z3NlcnZlcl90cmFuc3Bv
cnRfcGlwZXNfb3V0c2lkZS5vOiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVz
LmNjCisJJChDT01QSUxFX0NYWCkgLURfX09VVFNJREVfQ1lHV0lOX18gLW8g
JEAgJDwKKworY3lnc2VydmVyX2NsaWVudF9vdXRzaWRlLm86IGN5Z3NlcnZl
cl9jbGllbnQuY2MKKwkgJChDT01QSUxFX0NYWCkgLURfX09VVFNJREVfQ1lH
V0lOX18gLW8gJEAgJDwKKworY3lnc2VydmVyX3NobV9vdXRzaWRlLm86IGN5
Z3NlcnZlcl9zaG0uY2MKKwkkKENPTVBJTEVfQ1hYKSAtRF9fT1VUU0lERV9D
WUdXSU5fXyAtbyAkQCAkPAorCitjeWdzZXJ2ZXIuZXhlOiBjeWdzZXJ2ZXIu
byBjeWdzZXJ2ZXJfc2htX291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0
X291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzX291dHNpZGUu
byBjeWdzZXJ2ZXJfY2xpZW50X291dHNpZGUubyB3aW5jYXAubyBzbWFsbHBy
aW50Lm8gCisJJChDWFgpIC1vICRAICReCisjaWZkZWYgVkVSQk9TRQorIwkk
KENYWCkgJChNSU5HV19DWFhGTEFHUykgLW8gJEAgJHt3b3JkbGlzdCAxLDMs
JF59IC1CJChtaW5nd19idWlsZCkvICQoTUlOR1dfTERGTEFHUykKKyNlbHNl
CisjCUBlY2hvICQoQ1hYKSAtbyAkQCAke3dvcmRsaXN0IDEsMywkXn0gJHtm
aWx0ZXItb3V0IC1CJSwgJChNSU5HV19DWFhGTEFHUykgJChNSU5HV19MREZM
QUdTKX07XAorIwkkKENYWCkgJChNSU5HV19DWFhGTEFHUykgLW8gJEAgJHt3
b3JkbGlzdCAxLDMsJF59IC1CJChtaW5nd19idWlsZCkvICQoTUlOR1dfTERG
TEFHUykKKyNlbmRpZgogCiAjDAogCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dp
bi9hdXRvbG9hZC5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL2F1dG9s
b2FkLmNjOjEuMzIgc3JjL3dpbnN1cC9jeWd3aW4vYXV0b2xvYWQuY2M6MS4z
Mi4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL2F1dG9sb2FkLmNjOjEuMzIJ
VGh1IFNlcCAxMyAwMzo0NjozNSAyMDAxCisrKyBzcmMvd2luc3VwL2N5Z3dp
bi9hdXRvbG9hZC5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTMy
Nyw2ICszMjcsNyBAQAogTG9hZERMTGZ1bmMgKEdldFRva2VuSW5mb3JtYXRp
b24sIDIwLCBhZHZhcGkzMikKIExvYWRETExmdW5jIChHZXRVc2VyTmFtZUEs
IDgsIGFkdmFwaTMyKQogTG9hZERMTGZ1bmMgKEltcGVyc29uYXRlTG9nZ2Vk
T25Vc2VyLCA0LCBhZHZhcGkzMikKK0xvYWRETExmdW5jIChJbXBlcnNvbmF0
ZU5hbWVkUGlwZUNsaWVudCwgNCwgYWR2YXBpMzIpCiBMb2FkRExMZnVuYyAo
SW5pdGlhbGl6ZUFjbCwgMTIsIGFkdmFwaTMyKQogTG9hZERMTGZ1bmMgKElu
aXRpYWxpemVTZWN1cml0eURlc2NyaXB0b3IsIDgsIGFkdmFwaTMyKQogTG9h
ZERMTGZ1bmMgKEluaXRpYWxpemVTaWQsIDEyLCBhZHZhcGkzMikKSW5kZXg6
IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlci5jYwpkaWZmIC11IC9kZXYv
bnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXIuY2M6MS4xLjIuMQot
LS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNy
Yy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlci5jYwlNb24gU2VwIDI0IDIyOjQ5
OjEwIDIwMDEKQEAgLTAsMCArMSw1NDYgQEAKKy8qIGN5Z3NlcnZlci5jYwor
CisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKworICAgV3JpdHRl
biBieSBFZ29yIER1ZGEgPGRlb0Bsb2dvcy1tLnJ1PgorCisgICBUaGlzIGZp
bGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdhcmUgaXMg
YSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJtcyBv
ZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQgdGhl
IGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMuICovCisK
KyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN0ZGlvLmg+CisjaW5j
bHVkZSA8dW5pc3RkLmg+CisjaW5jbHVkZSA8d2luZG93cy5oPgorI2luY2x1
ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KKyNp
bmNsdWRlIDxuZXRkYi5oPgorI2luY2x1ZGUgIndpbmNhcC5oIgorCisjaW5j
bHVkZSAiZ2V0b3B0LmgiCisKKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVy
X3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIK
KyNpbmNsdWRlICJjeWdzZXJ2ZXJfc2htLmgiCisKKworR0VORVJJQ19NQVBQ
SU5HIGFjY2Vzc19tYXBwaW5nOworY2xhc3MgdHJhbnNwb3J0X2xheWVyX2Jh
c2UgKnRyYW5zcG9ydDsKKworRFdPUkQgcmVxdWVzdF9jb3VudCA9IDA7CisK
K0JPT0wKK3NldHVwX3ByaXZpbGVnZXMgKCkKK3sKKyAgQk9PTCByYywgcmV0
X3ZhbDsKKyAgSEFORExFIGhUb2tlbiA9IE5VTEw7CisgIFRPS0VOX1BSSVZJ
TEVHRVMgc1ByaXZpbGVnZXM7CisKKyAgcmMgPSBPcGVuUHJvY2Vzc1Rva2Vu
ICggR2V0Q3VycmVudFByb2Nlc3MoKSAsIFRPS0VOX0FMTF9BQ0NFU1MgLCAm
aFRva2VuICkgOworICBpZiAoICFyYyApCisgICAgeworICAgICAgcHJpbnRm
ICggImVycm9yIG9wZW5pbmcgcHJvY2VzcyB0b2tlbiAoJWx1KVxuIiwgR2V0
TGFzdEVycm9yICgpICk7CisgICAgICByZXRfdmFsID0gRkFMU0U7CisgICAg
ICBnb3RvIG91dDsKKyAgICB9CisgIHJjID0gTG9va3VwUHJpdmlsZWdlVmFs
dWUgKCBOVUxMLCBTRV9ERUJVR19OQU1FLCAmc1ByaXZpbGVnZXMuUHJpdmls
ZWdlc1swXS5MdWlkICk7CisgIGlmICggIXJjICkKKyAgICB7CisgICAgICBw
cmludGYgKCAiZXJyb3IgZ2V0dGluZyBwcmlnaWxlZ2UgbHVpZCAoJWx1KVxu
IiwgR2V0TGFzdEVycm9yICgpICk7CisgICAgICByZXRfdmFsID0gRkFMU0U7
CisgICAgICBnb3RvIG91dDsKKyAgICB9CisgIHNQcml2aWxlZ2VzLlByaXZp
bGVnZUNvdW50ID0gMSA7CisgIHNQcml2aWxlZ2VzLlByaXZpbGVnZXNbMF0u
QXR0cmlidXRlcyA9IFNFX1BSSVZJTEVHRV9FTkFCTEVEIDsKKyAgcmMgPSBB
ZGp1c3RUb2tlblByaXZpbGVnZXMgKCBoVG9rZW4sIEZBTFNFLCAmc1ByaXZp
bGVnZXMsIDAsIE5VTEwsIE5VTEwgKSA7CisgIGlmICggIXJjICkKKyAgICB7
CisgICAgICBwcmludGYgKCAiZXJyb3IgYWRqdXN0aW5nIHByaWdpbGVnZSBs
ZXZlbC4gKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSApOworICAgICAgcmV0
X3ZhbCA9IEZBTFNFOworICAgICAgZ290byBvdXQ7CisgICAgfQorCisgIGFj
Y2Vzc19tYXBwaW5nLkdlbmVyaWNSZWFkID0gRklMRV9SRUFEX0RBVEE7Cisg
IGFjY2Vzc19tYXBwaW5nLkdlbmVyaWNXcml0ZSA9IEZJTEVfV1JJVEVfREFU
QTsKKyAgYWNjZXNzX21hcHBpbmcuR2VuZXJpY0V4ZWN1dGUgPSAwOworICBh
Y2Nlc3NfbWFwcGluZy5HZW5lcmljQWxsID0gRklMRV9SRUFEX0RBVEEgfCBG
SUxFX1dSSVRFX0RBVEE7CisKKyAgcmV0X3ZhbCA9IFRSVUU7CisKK291dDoK
KyAgQ2xvc2VIYW5kbGUgKCBoVG9rZW4gKTsKKyAgcmV0dXJuIHJldF92YWw7
Cit9CisKK2ludAorY2hlY2tfYW5kX2R1cF9oYW5kbGUgKEhBTkRMRSBmcm9t
X3Byb2Nlc3MsIEhBTkRMRSB0b19wcm9jZXNzLAorCQkgICAgICBIQU5ETEUg
ZnJvbV9wcm9jZXNzX3Rva2VuLAorICAgICAgICAgICAgICAgICAgICAgIERX
T1JEIGFjY2VzcywKKyAgICAgICAgICAgICAgICAgICAgICBIQU5ETEUgZnJv
bV9oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgSEFORExFKiB0b19o
YW5kbGVfcHRyLCBCT09MIGJJbmhlcml0SGFuZGxlKQoreworICBIQU5ETEUg
bG9jYWxfaGFuZGxlID0gTlVMTDsKKyAgaW50IHJldF92YWwgPSBFQUNDRVM7
CisgIGNoYXIgc2RfYnVmIFsxMDI0XTsKKyAgUFNFQ1VSSVRZX0RFU0NSSVBU
T1Igc2QgPSAoUFNFQ1VSSVRZX0RFU0NSSVBUT1IpICZzZF9idWY7CisgIERX
T1JEIGJ5dGVzX25lZWRlZDsKKyAgUFJJVklMRUdFX1NFVCBwczsKKyAgRFdP
UkQgcHNfbGVuID0gc2l6ZW9mIChwcyk7CisgIEJPT0wgc3RhdHVzOworCisg
IGlmIChmcm9tX3Byb2Nlc3MgIT0gR2V0Q3VycmVudFByb2Nlc3MgKCkpCit7
IAorCisgIGlmICghRHVwbGljYXRlSGFuZGxlIChmcm9tX3Byb2Nlc3MsIGZy
b21faGFuZGxlLAorCSAgICAgICAgICAgICAgICBHZXRDdXJyZW50UHJvY2Vz
cyAoKSwgJmxvY2FsX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
IDAsIGJJbmhlcml0SGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAg
RFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKKyAgICB7CisgICAgICBwcmludGYg
KCAiZXJyb3IgZ2V0dGluZyBoYW5kbGUoJXUpIHRvIHNlcnZlciAoJWx1KVxu
IiwgKHVuc2lnbmVkIGludClmcm9tX2hhbmRsZSwgR2V0TGFzdEVycm9yICgp
KTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KK30gZWxzZQorIGxvY2FsX2hh
bmRsZSA9IGZyb21faGFuZGxlOworCisgIGlmICghR2V0S2VybmVsT2JqZWN0
U2VjdXJpdHkgKGxvY2FsX2hhbmRsZSwKKyAgCQkJICAgICAgICBPV05FUl9T
RUNVUklUWV9JTkZPUk1BVElPTiB8IEdST1VQX1NFQ1VSSVRZX0lORk9STUFU
SU9OCXwgREFDTF9TRUNVUklUWV9JTkZPUk1BVElPTiwKKwkJCQlzZCwgc2l6
ZW9mIChzZF9idWYpLCAmYnl0ZXNfbmVlZGVkKSkKKyAgICB7CisgICAgICBw
cmludGYgKCAiZXJyb3IgZ2V0dGluZyBoYW5kbGUgU0QgKCVsdSlcbiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAg
TWFwR2VuZXJpY01hc2sgKCZhY2Nlc3MsICZhY2Nlc3NfbWFwcGluZyk7CisK
KyAgaWYgKCFBY2Nlc3NDaGVjayAoc2QsIGZyb21fcHJvY2Vzc190b2tlbiwg
YWNjZXNzLCAmYWNjZXNzX21hcHBpbmcsCisgIAkJICAgICZwcywgJnBzX2xl
biwgJmFjY2VzcywgJnN0YXR1cykpCisgICAgeworICAgICAgcHJpbnRmICgg
ImVycm9yIGNoZWNraW5nIGFjY2VzcyByaWdodHMgKCVsdSlcbiIsIEdldExh
c3RFcnJvciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgaWYg
KCFzdGF0dXMpCisgICAgeworICAgICAgcHJpbnRmICggImFjY2VzcyB0byBv
YmplY3QgZGVuaWVkXG4iKTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKwor
ICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAoZnJvbV9wcm9jZXNzLCBmcm9tX2hh
bmRsZSwKKwkgICAgICAgICAgICAgICAgdG9fcHJvY2VzcywgdG9faGFuZGxl
X3B0ciwKKyAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VzcywgYkluaGVy
aXRIYW5kbGUsIDApKQorICAgIHsKKyAgICAgIHByaW50ZiAoICJlcnJvciBn
ZXR0aW5nIGhhbmRsZSB0byBjbGllbnQgKCVsdSlcbiIsIEdldExhc3RFcnJv
ciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgcmV0X3ZhbCA9
IDA7CisgICAgICAgICAgICAgICAgICAgIAorb3V0OgorICBpZiAobG9jYWxf
aGFuZGxlICYmIGZyb21fcHJvY2VzcyAhPSBHZXRDdXJyZW50UHJvY2VzcyAo
KSkKKyAgICBDbG9zZUhhbmRsZSAobG9jYWxfaGFuZGxlKTsKKworICByZXR1
cm4gKHJldF92YWwpOworfQorCitpbnQKK2NoZWNrX2FuZF9kdXBfaGFuZGxl
IChIQU5ETEUgZnJvbV9wcm9jZXNzLCBIQU5ETEUgdG9fcHJvY2VzcywKKyAg
ICAgICAgICAgICAgICAgICAgICBIQU5ETEUgZnJvbV9wcm9jZXNzX3Rva2Vu
LAorICAgICAgICAgICAgICAgICAgICAgIERXT1JEIGFjY2VzcywKKyAgICAg
ICAgICAgICAgICAgICAgICBIQU5ETEUgZnJvbV9oYW5kbGUsCisgICAgICAg
ICAgICAgICAgICAgICAgSEFORExFKiB0b19oYW5kbGVfcHRyKQoreworICBy
ZXR1cm4gY2hlY2tfYW5kX2R1cF9oYW5kbGUoZnJvbV9wcm9jZXNzLHRvX3By
b2Nlc3MsZnJvbV9wcm9jZXNzX3Rva2VuLGFjY2Vzcyxmcm9tX2hhbmRsZSx0
b19oYW5kbGVfcHRyLEZBTFNFKTsKK30KKwordm9pZAorY2xpZW50X3JlcXVl
c3RfYXR0YWNoX3R0eTo6c2VydmUodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNv
bm4pCit7CisgIEhBTkRMRSBmcm9tX3Byb2Nlc3NfaGFuZGxlID0gTlVMTDsK
KyAgSEFORExFIHRvX3Byb2Nlc3NfaGFuZGxlID0gTlVMTDsKKyAgSEFORExF
IHRva2VuX2hhbmRsZSA9IE5VTEw7CisgIERXT1JEIHJjOworCisgIGlmICho
ZWFkZXIuY2IgIT0gc2l6ZW9mIChyZXEpKQorICAgIHsKKyAgICAgIGhlYWRl
ci5lcnJvcl9jb2RlID0gRUlOVkFMOworICAgICAgcmV0dXJuOworICAgIH0K
KworI2lmZGVmIERFQlVHCisgIHByaW50ZiAoIiVkOiglZCwlZCkgLT4gJWRc
biIsIHJlcS5tYXN0ZXJfcGlkLAorICAJICAJCQlyZXEuZnJvbV9tYXN0ZXIs
IHJlcS50b19tYXN0ZXIsCisJCQkJcmVxLnBpZCk7CisjZW5kaWYKKworICBm
cm9tX3Byb2Nlc3NfaGFuZGxlID0gT3BlblByb2Nlc3MgKFBST0NFU1NfRFVQ
X0hBTkRMRSwgRkFMU0UsIHJlcS5tYXN0ZXJfcGlkKTsKKyAgdG9fcHJvY2Vz
c19oYW5kbGUgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19EVVBfSEFORExFLCBG
QUxTRSwgcmVxLnBpZCk7CisgIGlmICghZnJvbV9wcm9jZXNzX2hhbmRsZSB8
fCAhdG9fcHJvY2Vzc19oYW5kbGUpCisgICAgeworICAgICAgcHJpbnRmICgi
ZXJyb3Igb3BlbmluZyBwcm9jZXNzICglbHUpXG4iLCBHZXRMYXN0RXJyb3Ig
KCkpOworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAg
ICBnb3RvIG91dDsKKyAgICB9CisKKyAgdHJhbnNwb3J0LT5pbXBlcnNvbmF0
ZV9jbGllbnQgKCk7CisgIAorICByYyA9IE9wZW5UaHJlYWRUb2tlbiAoR2V0
Q3VycmVudFRocmVhZCAoKSwKKyAgCQkJVE9LRU5fUVVFUlksCisgICAgICAg
ICAgICAgICAgICAgICAgICBUUlVFLAorCQkJJnRva2VuX2hhbmRsZSk7CisK
KyAgdHJhbnNwb3J0LT5yZXZlcnRfdG9fc2VsZiAoKTsKKworICBpZiAoIXJj
KQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIG9wZW5pbmcgdGhyZWFk
IHRva2VuICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgaGVh
ZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAgICBnb3RvIG91dDsKKyAg
ICB9CisKKyAgaWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChmcm9tX3Byb2Nl
c3NfaGFuZGxlLCB0b19wcm9jZXNzX2hhbmRsZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB0b2tlbl9oYW5kbGUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgR0VORVJJQ19SRUFELAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHJlcS5mcm9tX21hc3RlciwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmcmVxLmZyb21fbWFzdGVyKSAhPSAwKQorICAgIHsKKyAg
ICAgIHByaW50ZiAoImVycm9yIGR1cGxpY2F0aW5nIGZyb21fbWFzdGVyIGhh
bmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRl
ci5lcnJvcl9jb2RlID0gRUFDQ0VTOworICAgICAgZ290byBvdXQ7CisgICAg
fQorCisgIGlmIChyZXEudG9fbWFzdGVyKQorICAgIHsKKyAgICAgIGlmIChj
aGVja19hbmRfZHVwX2hhbmRsZSAoZnJvbV9wcm9jZXNzX2hhbmRsZSwgdG9f
cHJvY2Vzc19oYW5kbGUsCisJCQkJdG9rZW5faGFuZGxlLAorCQkJCUdFTkVS
SUNfV1JJVEUsCisJCQkJcmVxLnRvX21hc3RlciwKKwkJCQkmcmVxLnRvX21h
c3RlcikgIT0gMCkKKwl7CisJICBwcmludGYgKCJlcnJvciBkdXBsaWNhdGlu
ZyB0b19tYXN0ZXIgaGFuZGxlICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkp
OworCSAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisJICBnb3RvIG91
dDsKKwl9CisgICAgfQorCisjaWZkZWYgREVCVUcKKyAgcHJpbnRmICgiJWQg
LT4gJWQoJWQsJWQpXG4iLCByZXEubWFzdGVyX3BpZCwgcmVxLnBpZCwKKyAg
CSAgCQkJcmVxLmZyb21fbWFzdGVyLCByZXEudG9fbWFzdGVyKTsKKyNlbmRp
ZgorCisgIGhlYWRlci5lcnJvcl9jb2RlID0gMDsKKworb3V0OgorICBpZiAo
ZnJvbV9wcm9jZXNzX2hhbmRsZSkKKyAgICBDbG9zZUhhbmRsZSAoZnJvbV9w
cm9jZXNzX2hhbmRsZSk7CisgIGlmICh0b19wcm9jZXNzX2hhbmRsZSkKKyAg
ICBDbG9zZUhhbmRsZSAodG9fcHJvY2Vzc19oYW5kbGUpOworICBpZiAodG9r
ZW5faGFuZGxlKQorICAgIENsb3NlSGFuZGxlICh0b2tlbl9oYW5kbGUpOwor
fQorCit2b2lkCitjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lvbjo6c2VydmUo
dHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4pCit7CisgIGlmIChoZWFkZXIu
Y2IgIT0gc2l6ZW9mICh2ZXJzaW9uKSkKKyAgICB7CisgICAgICBoZWFkZXIu
ZXJyb3JfY29kZSA9IEVJTlZBTDsKKyAgICAgIHJldHVybjsKKyAgICB9Cisg
IGhlYWRlci5lcnJvcl9jb2RlID0gMDsKKyAgdmVyc2lvbi5tYWpvciA9IENZ
R1dJTl9TRVJWRVJfVkVSU0lPTl9NQUpPUjsKKyAgdmVyc2lvbi5hcGkgICA9
IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9BUEk7CisgIHZlcnNpb24ubWlub3Ig
PSBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlOT1I7CisgIHZlcnNpb24ucGF0
Y2ggPSBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fUEFUQ0g7Cit9CisKK2NsYXNz
IHNlcnZlcl9yZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgY2xhc3Mgc2VydmVy
X3JlcXVlc3QgKm5leHQ7CisgIHNlcnZlcl9yZXF1ZXN0ICh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqbmV3Y29ubik7CisgIHZvaWQgcHJvY2VzcyAoKTsKKyAg
cHJpdmF0ZToKKyAgICBjaGFyIHJlcXVlc3RfYnVmZmVyIFtNQVhfUkVRVUVT
VF9TSVpFXTsKKyAgICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubjsKK307
CisKK2NsYXNzIHNlcnZlcl9yZXF1ZXN0X3F1ZXVlCit7CisgIHB1YmxpYzoK
KyAgQ1JJVElDQUxfU0VDVElPTiBxdWV1ZWxvY2s7CisgIEhBTkRMRSBldmVu
dDsKKyAgc2VydmVyX3JlcXVlc3QgKiByZXF1ZXN0OworICBib29sIGFjdGl2
ZTsKKyAgdW5zaWduZWQgaW50IGluaXRpYWxfd29ya2VyczsKKyAgdW5zaWdu
ZWQgaW50IHJ1bm5pbmc7CisgIHZvaWQgY3JlYXRlX3dvcmtlcnMgKCk7Cisg
IHZvaWQgY2xlYW51cCAoKTsKKyAgdm9pZCBhZGQgKHRyYW5zcG9ydF9sYXll
cl9iYXNlICpjb25uKTsKK307CitjbGFzcyBzZXJ2ZXJfcmVxdWVzdF9xdWV1
ZSByZXF1ZXN0X3F1ZXVlOworCit2b2lkCitjbGllbnRfcmVxdWVzdF9zaHV0
ZG93bjo6c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKQorewor
ICAvKiBGSVhNRTogbGluayB1cHdhcmRzLCBhbmQgdGhlbiB0aGlzIGJlY29t
ZXMgYSB0cml2aWFsIG1ldGhvZCBjYWxsIHRvCisgICAqIG9ubHkgc2h1dGRv
d24gX3RoaXMgcXVldWVfCisgICAqLworICAvKiB0ZWxsIHRoZSBtYWluIHRo
cmVhZCB0byBzaHV0ZG93biAqLworICByZXF1ZXN0X3F1ZXVlLmFjdGl2ZT1m
YWxzZTsKK30KKworc2VydmVyX3JlcXVlc3Q6OnNlcnZlcl9yZXF1ZXN0ICh0
cmFuc3BvcnRfbGF5ZXJfYmFzZSAqbmV3Y29ubikKK3sKKyAgY29ubiA9IG5l
d2Nvbm47CisgIG5leHQgPSBOVUxMOworfQorCit2b2lkCitzZXJ2ZXJfcmVx
dWVzdDo6cHJvY2VzcyAoKQoreworICBzc2l6ZV90IGJ5dGVzX3JlYWQsIGJ5
dGVzX3dyaXR0ZW47CisgIHN0cnVjdCByZXF1ZXN0X2hlYWRlciogcmVxX3B0
ciA9IChzdHJ1Y3QgcmVxdWVzdF9oZWFkZXIqKSAmcmVxdWVzdF9idWZmZXI7
CisgIGNsaWVudF9yZXF1ZXN0ICpyZXEgPSBOVUxMOworICBwcmludGYgKCJh
Ym91dCB0byByZWFkXG4iKTsKKworICBieXRlc19yZWFkID0gY29ubi0+cmVh
ZCAocmVxdWVzdF9idWZmZXIsIHNpemVvZiAoc3RydWN0IHJlcXVlc3RfaGVh
ZGVyKSk7CisgIGlmIChieXRlc19yZWFkICE9IHNpemVvZiAoc3RydWN0IHJl
cXVlc3RfaGVhZGVyKSkKKyAgICB7CisgICAgICBwcmludGYgKCJlcnJvciBy
ZWFkaW5nIGZyb20gY29ubmVjdGlvbiAoJWx1KVxuIiwgR2V0TGFzdEVycm9y
ICgpKTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKyAgcHJpbnRmICgiZ290
IGhlYWRlciAoJWxkKVxuIiwgYnl0ZXNfcmVhZCk7CisKKyAgc3dpdGNoIChy
ZXFfcHRyLT5yZXFfaWQpCisgICAgeworICAgIGNhc2UgQ1lHU0VSVkVSX1JF
UVVFU1RfR0VUX1ZFUlNJT046CisgICAgICByZXEgPSBuZXcgY2xpZW50X3Jl
cXVlc3RfZ2V0X3ZlcnNpb24gKCk7IGJyZWFrOworICAgIGNhc2UgQ1lHU0VS
VkVSX1JFUVVFU1RfQVRUQUNIX1RUWToKKyAgICAgIHJlcSA9IG5ldyBjbGll
bnRfcmVxdWVzdF9hdHRhY2hfdHR5ICgpOyBicmVhazsKKyAgICBjYXNlIENZ
R1NFUlZFUl9SRVFVRVNUX1NIVVRET1dOOgorICAgICAgcmVxID0gbmV3IGNs
aWVudF9yZXF1ZXN0X3NodXRkb3duICgpOyBicmVhazsKKyAgICBjYXNlIENZ
R1NFUlZFUl9SRVFVRVNUX1NITV9HRVQ6CisgICAgIHJlcSA9IG5ldyBjbGll
bnRfcmVxdWVzdF9zaG1fZ2V0ICgpOyBicmVhazsKKyAgICBkZWZhdWx0Ogor
ICAgICAgcmVxID0gbmV3IGNsaWVudF9yZXF1ZXN0IChDWUdTRVJWRVJfUkVR
VUVTVF9JTlZBTElEKTsKKyAgICAgIHJlcS0+aGVhZGVyLmVycm9yX2NvZGUg
PSBFTk9TWVM7CisgICAgICBwcmludGYgKCJCYWQgY2xpZW50IHJlcXVlc3Qg
LSByZXR1cm5pbmcgRU5PU1lTXG4iKTsKKyAgICB9CisKKyAgaWYgKHJlcS0+
aGVhZGVyLmNiICE9IHJlcV9wdHItPmNiKQorICAgIHsKKyAgICAgIHByaW50
ZiAoIk1pc21hdGNoIGluIHJlcXVlc3QgYnVmZmVyIHNpemVzXG4iKTsKKyAg
ICAgIGdvdG8gb3V0OworICAgIH0KKworICBpZiAocmVxLT5oZWFkZXIuY2Ip
CisgICAgeworCisgICAgICBieXRlc19yZWFkID0gY29ubi0+cmVhZCAocmVx
LT5idWZmZXIsIHJlcS0+aGVhZGVyLmNiKTsKKyAgICAgIGlmIChieXRlc19y
ZWFkICE9IHJlcS0+aGVhZGVyLmNiKQorICAgICAgICB7CisgICAgICAgICAg
cHJpbnRmICgiZXJyb3IgcmVhZGluZyBmcm9tIGNvbm5lY3Rpb24gKCVsdSlc
biIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICAgICAgZ290byBvdXQ7Cisg
ICAgICAgIH0KKyAgICAgIHByaW50ZiAoImdvdCBib2R5ICglbGQpXG4iLGJ5
dGVzX3JlYWQpOworICAgIH0KKworICAvKiB0aGlzIGlzIG5vdCBhbGxvd2Vk
IHRvIGZhaWwuIFdlIG11c3QgcmV0dXJuIEVOT1NZUyBhdCBhIG1pbmltdW0g
dG8gdGhlIGNsaWVudCAqLworICByZXEtPnNlcnZlIChjb25uKTsKKworICBp
ZiAoKGJ5dGVzX3dyaXR0ZW4gPSBjb25uLT53cml0ZSAoKGNoYXIgKikmcmVx
LT5oZWFkZXIsIHNpemVvZiAocmVxLT5oZWFkZXIpKSkKKyAgICAhPSBzaXpl
b2YocmVxLT5oZWFkZXIpIHx8CisgICAgKGJ5dGVzX3dyaXR0ZW4gPSBjb25u
LT53cml0ZSAocmVxLT5idWZmZXIsIHJlcS0+aGVhZGVyLmNiKSkgIT0gcmVx
LT5oZWFkZXIuY2IpCisgICAgeworICAgICAgcmVxLT5oZWFkZXIuZXJyb3Jf
Y29kZSA9IC0xOworICAgICAgcHJpbnRmICgiZXJyb3Igd3JpdGluZyB0byBj
b25uZWN0aW9uICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAg
Z290byBvdXQ7CisgICAgfQorCisgIHByaW50ZigiU2VudCByZXBseSwgc2l6
ZSAoJWxkKVxuIixieXRlc193cml0dGVuKTsKKworb3V0OgorICBjb25uLT5j
bG9zZSAoKTsKKyAgZGVsZXRlIGNvbm47CisgIGlmIChyZXEpCisgICAgZGVs
ZXRlIChyZXEpOworfQorCitEV09SRCBXSU5BUEkKK3dvcmtlcl9mdW5jdGlv
biggTFBWT0lEIExwUGFyYW0gKQoreworICBjbGFzcyBzZXJ2ZXJfcmVxdWVz
dF9xdWV1ZSAqcXVldWUgPSAoY2xhc3Mgc2VydmVyX3JlcXVlc3RfcXVldWUg
KikgTHBQYXJhbTsKKyAgY2xhc3Mgc2VydmVyX3JlcXVlc3QgKnJlcXVlc3Q7
CisgIC8qIEZJWE1FIHVzZSBhIHRocmVhZHNhZmUgcG9wIGluc3RlYWQgZm9y
IHNwZWVkPyAqLworICB3aGlsZSAocXVldWUtPmFjdGl2ZSkKKyAgICB7Cisg
ICAgICBFbnRlckNyaXRpY2FsU2VjdGlvbiAoJnF1ZXVlLT5xdWV1ZWxvY2sp
OworICAgICAgd2hpbGUgKCFxdWV1ZS0+cmVxdWVzdCAmJiBxdWV1ZS0+YWN0
aXZlKQorICAgICAgICB7CisJICBMZWF2ZUNyaXRpY2FsU2VjdGlvbiAoJnF1
ZXVlLT5xdWV1ZWxvY2spOworICAgICAgICAgIERXT1JEIHJjID0gV2FpdEZv
clNpbmdsZU9iamVjdCAocXVldWUtPmV2ZW50LElORklOSVRFKTsKKyAgICAg
ICAgICBpZiAocmMgPT0gV0FJVF9GQUlMRUQpCisJICAgIHsKKwkgICAgICBw
cmludGYoIldhaXQgZm9yIGV2ZW50IGZhaWxlZFxuIik7CisJICAgICAgcXVl
dWUtPnJ1bm5pbmctLTsKKwkgICAgICBFeGl0VGhyZWFkICgwKTsKKwkgICAg
fQorCSAgRW50ZXJDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZS0+cXVldWVsb2Nr
KTsKKyAgICAgICAgfQorICAgICAgaWYgKCFxdWV1ZS0+YWN0aXZlKQorCXsK
KwkgIHF1ZXVlLT5ydW5uaW5nLS07CisJICBMZWF2ZUNyaXRpY2FsU2VjdGlv
biAoJnF1ZXVlLT5xdWV1ZWxvY2spOworCSAgRXhpdFRocmVhZCAoMCk7CisJ
fQorICAgICAgLyogbm90IG5lZWRlZCwgYnV0IGl0IGlzIGVmZmljaWVudCAq
LworICAgICAgcmVxdWVzdCA9IChjbGFzcyBzZXJ2ZXJfcmVxdWVzdCAqKUlu
dGVybG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmcXVldWUtPnJlcXVlc3QsIHF1
ZXVlLT5yZXF1ZXN0LT5uZXh0KTsKKyAgICAgIExlYXZlQ3JpdGljYWxTZWN0
aW9uICgmcXVldWUtPnF1ZXVlbG9jayk7CisgICAgICByZXF1ZXN0LT5wcm9j
ZXNzICgpOworICAgICAgZGVsZXRlIHJlcXVlc3Q7CisgICAgfQorICBxdWV1
ZS0+cnVubmluZy0tOworICBFeGl0VGhyZWFkICgwKTsKK30KKwordm9pZAor
c2VydmVyX3JlcXVlc3RfcXVldWU6OmNyZWF0ZV93b3JrZXJzKCkKK3sKKyAg
SW5pdGlhbGl6ZUNyaXRpY2FsU2VjdGlvbiAoJnF1ZXVlbG9jayk7CisgIGlm
ICgoZXZlbnQgPSBDcmVhdGVFdmVudCAoTlVMTCwgRkFMU0UsIEZBTFNFLCBO
VUxMKSkgPT0gTlVMTCkKKyAgICB7CisgICAgICBwcmludGYgKCJGYWlsZWQg
dG8gY3JlYXRlIGV2ZW50IHF1ZXVlICglbHUpLCB0ZXJtaW5hdGluZ1xuIiwg
R2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGV4aXQgKDEpOworICAgIH0KKyAg
YWN0aXZlID0gdHJ1ZTsKKyAgCisgIC8qIEZJWE1FOiBVc2UgYSBzdGFjayBw
YWlyIGFuZCBjcmVhdGUgdGhyZWFkcyBvbiB0aGUgZmx5IHdoZW5ldmVyCisg
ICAqIHdlIGhhdmUgdG8gdG8gc2VydmljZSBhIHJlcXVlc3QuCisgICAqLwor
ICBmb3IgKHVuc2lnbmVkIGludCBpPTA7IGk8aW5pdGlhbF93b3JrZXJzOyBp
KyspCisgICAgeworICAgICAgSEFORExFIGhUaHJlYWQ7CisgICAgICBEV09S
RCB0aWQ7CisgICAgICBoVGhyZWFkID0gQ3JlYXRlVGhyZWFkIChOVUxMLCAw
LCB3b3JrZXJfZnVuY3Rpb24sIHRoaXMsIDAsICZ0aWQpOworICAgICAgaWYg
KGhUaHJlYWQgPT0gTlVMTCkKKyAgICAgICAgeworCSAgcHJpbnRmICgiRmFp
bGVkIHRvIGNyZWF0ZSB0aHJlYWQgKCVsdSksIHRlcm1pbmF0aW5nXG4iLCBH
ZXRMYXN0RXJyb3IgKCkpOworCSAgZXhpdCAoMSk7CisJfQorICAgICAgQ2xv
c2VIYW5kbGUgKGhUaHJlYWQpOworICAgICAgcnVubmluZysrOworICAgIH0K
K30KKwordm9pZAorc2VydmVyX3JlcXVlc3RfcXVldWU6OmNsZWFudXAgKCkK
K3sKKyAgLyogaGFydmVzdCB0aGUgdGhyZWFkcyAqLworICBhY3RpdmUgPSBm
YWxzZTsKKyAgaWYgKCFydW5uaW5nKQorICAgIHJldHVybjsKKyAgcHJpbnRm
ICgiV2FpdGluZyBmb3IgY3VycmVudCBjb25uZWN0aW9ucyB0byB0ZXJtaW5h
dGVcbiIpOworICBmb3IgKGludCBuPXJ1bm5pbmc7IG47IG4tLSkKKyAgICBQ
dWxzZUV2ZW50IChldmVudCk7CisgIHdoaWxlIChydW5uaW5nKQorICAgIHNs
ZWVwICgxKTsKKyAgRGVsZXRlQ3JpdGljYWxTZWN0aW9uICgmcXVldWVsb2Nr
KTsKKyAgQ2xvc2VIYW5kbGUgKGV2ZW50KTsKK30KKwordm9pZAorc2VydmVy
X3JlcXVlc3RfcXVldWU6OmFkZCAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNv
bm4pCit7CisgIC8qIHNhZmUgdG8gbm90ICJUcnkiIGJlY2F1c2Ugd29ya2Vy
cyBkb24ndCBob2cgdGhpcywgdGhleSB3YWl0IG9uIHRoZSBldmVudAorICAg
Ki8KKyAgRW50ZXJDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZWxvY2spOworICBp
ZiAoIXJ1bm5pbmcpCisgICAgeworICAgICAgcHJpbnRmICgiTm8gd29ya2Vy
IHRocmVhZHMgdG8gaGFuZGxlIHJlcXVlc3QhXG4iKTsKKyAgICAgIGNvbm4t
PmNsb3NlICgpOworICAgICAgZGVsZXRlIGNvbm47CisgICAgfQorICBzZXJ2
ZXJfcmVxdWVzdCAqIGxpc3RyZXF1ZXN0OworICBpZiAoIXJlcXVlc3QpCisg
ICAgeworICAgICAgcmVxdWVzdCA9IG5ldyBzZXJ2ZXJfcmVxdWVzdCAoY29u
bik7CisgICAgICBsaXN0cmVxdWVzdCA9IHJlcXVlc3Q7CisgICAgfQorICBl
bHNlCisgICAgeworICAgICAgLyogYWRkIHRvIHRoZSBxdWV1ZSBlbmQuICov
CisgICAgICBsaXN0cmVxdWVzdCA9IHJlcXVlc3Q7CisgICAgICB3aGlsZSAo
bGlzdHJlcXVlc3QtPm5leHQpCisJbGlzdHJlcXVlc3QgPSBsaXN0cmVxdWVz
dC0+bmV4dDsKKyAgICAgIGxpc3RyZXF1ZXN0LT5uZXh0ID0gbmV3IHNlcnZl
cl9yZXF1ZXN0IChjb25uKTsKKyAgICAgIGxpc3RyZXF1ZXN0ID0gbGlzdHJl
cXVlc3QtPm5leHQ7CisgICAgfQorICBQdWxzZUV2ZW50IChldmVudCk7Cisg
IExlYXZlQ3JpdGljYWxTZWN0aW9uICgmcXVldWVsb2NrKTsKK30KKworc3Ry
dWN0IG9wdGlvbiBsb25nb3B0c1tdID0geworICB7InNodXRkb3duIiwgbm9f
YXJndW1lbnQsIE5VTEwsICdzJ30sCisgIHswLCBub19hcmd1bWVudCwgTlVM
TCwgMH0KK307CisKK2NoYXIgb3B0c1tdID0gInMiOworCitpbnQKK21haW4g
KGludCBhcmdjLCBjaGFyICoqYXJndikKK3sKKyAgaW50IHNodXRkb3duPTA7
CisgIGNoYXIgaTsKKworICB3aGlsZSAoKGkgPSBnZXRvcHRfbG9uZyAoYXJn
YywgYXJndiwgb3B0cywgbG9uZ29wdHMsIE5VTEwpKSAhPSBFT0YpCisgICAg
c3dpdGNoIChpKQorICAgICAgeworICAgICAgY2FzZSAncyc6CisgICAgICAg
IHNodXRkb3duID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgICBkZWZhdWx0
OgorICAgICAgICBicmVhazsKKyAgICAgICAvKk5PVFJFQUNIRUQqLworICAg
ICAgfQorCisgIHdpbmNhcC5pbml0KCk7CisgIGlmICh3aW5jYXAuaGFzX3Nl
Y3VyaXR5ICgpKQorICAgIHNldHVwX3ByaXZpbGVnZXMgKCk7CisgIHRyYW5z
cG9ydCA9IGNyZWF0ZV9zZXJ2ZXJfdHJhbnNwb3J0ICgpOworCisgIGlmIChz
aHV0ZG93bikKKyAgICB7CisgICAgICBpZiAoIXRyYW5zcG9ydC0+Y29ubmVj
dCgpKQorCXsKKwkgIHByaW50ZiAoImNvdWxkbid0IGVzdGFibGlzaCBjb25u
ZWN0aW9uIHdpdGggc2VydmVyXG4iKTsKKwkgIGV4aXQgKDEpOworCX0KKyAg
ICAgIGNsaWVudF9yZXF1ZXN0X3NodXRkb3duICpyZXF1ZXN0ID0KKwluZXcg
Y2xpZW50X3JlcXVlc3Rfc2h1dGRvd24gKCk7CisgICAgICByZXF1ZXN0LT5z
ZW5kICh0cmFuc3BvcnQpOworICAgICAgdHJhbnNwb3J0LT5jbG9zZSgpOwor
ICAgICAgZGVsZXRlIHRyYW5zcG9ydDsKKyAgICAgIGRlbGV0ZSByZXF1ZXN0
OworICAgICAgZXhpdCgwKTsKKyAgICB9CisKKyAgdHJhbnNwb3J0LT5saXN0
ZW4gKCk7CisgIHJlcXVlc3RfcXVldWUuaW5pdGlhbF93b3JrZXJzID0gMTA7
CisgIHJlcXVlc3RfcXVldWUuY3JlYXRlX3dvcmtlcnMoKTsKKyAgd2hpbGUg
KHJlcXVlc3RfcXVldWUuYWN0aXZlKQorICAgIHsKKyAgICAgIHRyYW5zcG9y
dF9sYXllcl9iYXNlICogbmV3X2Nvbm4gPSB0cmFuc3BvcnQtPmFjY2VwdCAo
KTsKKyAgICAgIC8qIEZJWE1FOiB0aGlzIGlzIGEgbGl0dGxlIHVnbHkuIFdo
YXQgd2UgcmVhbGx5IHdhbnQgaXMgdG8gd2FpdCBvbiB0d28gb2JqZWN0czoK
KyAgICAgICAqIG9uZSBmb3IgdGhlIHBpcGUvc29ja2V0LCBhbmQgb25lIGZv
ciBiZWluZyB0b2xkIHRvIHNodXRkb3duLiBPdGhlcndpc2UKKyAgICAgICAq
IHRoaXMgd2lsbCBzdGF5IGEgcHJvYmxlbSAod2Ugd29uJ3QgYWN0dWFsbHkg
c2h1dGRvd24gdW50aWwgdGhlIHJlcXVlc3QKKyAgICAgICAqIF9BRlRFUl8g
dGhlIHNodXRkb3duIHJlcXVlc3QuIEFuZCBzZW5kaW5nIG91cnNlbHZlcyBh
IHJlcXVlc3QgaXMgdWdseSAKKyAgICAgICAqLworICAgICAgaWYgKG5ld19j
b25uICYmIHJlcXVlc3RfcXVldWUuYWN0aXZlKQorICAgICAgICAgIHJlcXVl
c3RfcXVldWUuYWRkIChuZXdfY29ubik7CisgICAgfQorICBwcmludGYgKCJO
byBsb25nZXIgYWNjZXB0aW5nIHJlcXVlc3RzLlxuIik7CisgIHJlcXVlc3Rf
cXVldWUuY2xlYW51cCAoKTsKKyAgdHJhbnNwb3J0LT5jbG9zZSAoKTsKK30K
SW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl9jbGllbnQuY2MK
ZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVy
X2NsaWVudC5jYzoxLjEuMi4xCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEg
MDE6MDA6MDAgMTk3MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVy
X2NsaWVudC5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTAsMCAr
MSwyMjUgQEAKKy8qIGN5Z3NlcnZlcl9jbGllbnQuY2MKKworICAgQ29weXJp
Z2h0IDIwMDEgUmVkIEhhdCBJbmMuCisKKyAgIFdyaXR0ZW4gYnkgRWdvciBE
dWRhIDxkZW9AbG9nb3MtbS5ydT4KKworICAgVGhpcyBmaWxlIGlzIHBhcnQg
b2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0
ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisgICBD
eWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdX
SU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisjaWZkZWYgX19P
VVRTSURFX0NZR1dJTl9fCisjdW5kZWYgX19JTlNJREVfQ1lHV0lOX18KKyNl
bHNlCisjaW5jbHVkZSAid2luc3VwLmgiCisjZW5kaWYKKworI2lmbmRlZiBf
X0lOU0lERV9DWUdXSU5fXworI2RlZmluZSBkZWJ1Z19wcmludGYgcHJpbnRm
CisjZGVmaW5lIGFwaV9mYXRhbCBwcmludGYKKyNpbmNsdWRlIDxzdGRpby5o
PgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNlbmRpZgorI2luY2x1ZGUgPHN5
cy9zb2NrZXQuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHVu
aXN0ZC5oPgorLy8jaW5jbHVkZSAic2VjdXJpdHkuaCIKKyNpbmNsdWRlICJj
eWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dp
bi9jeWdzZXJ2ZXIuaCIKKworLyogMCA9IHVudGVzdGVkLCAxID0gcnVubmlu
ZywgMiA9IGRlYWQgKi8KK2ludCBjeWdzZXJ2ZXJfcnVubmluZz1DWUdTRVJW
RVJfVU5LTk9XTjsKKworY2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb246OmNs
aWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uICgpIDogY2xpZW50X3JlcXVlc3Qg
KENZR1NFUlZFUl9SRVFVRVNUX0dFVF9WRVJTSU9OKQoreworICBoZWFkZXIu
Y2IgPSBzaXplb2YgKHZlcnNpb24pOworICBidWZmZXIgPSAoY2hhciAqKSZ2
ZXJzaW9uOworfQorCisjaWZkZWYgX19JTlNJREVfQ1lHV0lOX18KK3ZvaWQK
K2NsaWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uOjpzZXJ2ZSAodHJhbnNwb3J0
X2xheWVyX2Jhc2UgKmNvbm4pCit7Cit9CisjZW5kaWYKKworY2xpZW50X3Jl
cXVlc3RfYXR0YWNoX3R0eTo6Y2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eSAo
KSA6IGNsaWVudF9yZXF1ZXN0IChDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hf
VFRZKQoreworICBoZWFkZXIuY2IgPSBzaXplb2YgKHJlcSk7CisgIGJ1ZmZl
ciA9IChjaGFyICopJnJlcTsKKyAgcmVxLnBpZCA9IDA7CisgIHJlcS5tYXN0
ZXJfcGlkID0gMDsKKyAgcmVxLmZyb21fbWFzdGVyID0gTlVMTDsKKyAgcmVx
LnRvX21hc3RlciA9IE5VTEw7Cit9CisKK2NsaWVudF9yZXF1ZXN0X2F0dGFj
aF90dHk6OmNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkgKERXT1JEIG5waWQs
IERXT1JEIG5tYXN0ZXJfcGlkLCBIQU5ETEUgbmZyb21fbWFzdGVyLCBIQU5E
TEUgbnRvX21hc3RlcikgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JF
UVVFU1RfQVRUQUNIX1RUWSkKK3sKKyAgaGVhZGVyLmNiID0gc2l6ZW9mIChy
ZXEpOworICBidWZmZXIgPSAoY2hhciAqKSZyZXE7CisgIHJlcS5waWQgPSBu
cGlkOworICByZXEubWFzdGVyX3BpZCA9IG5tYXN0ZXJfcGlkOworICByZXEu
ZnJvbV9tYXN0ZXIgPSBuZnJvbV9tYXN0ZXI7CisgIHJlcS50b19tYXN0ZXIg
PSBudG9fbWFzdGVyOworfQorCisjaWZkZWYgX19JTlNJREVfQ1lHV0lOX18K
K3ZvaWQKK2NsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHk6OnNlcnZlICh0cmFu
c3BvcnRfbGF5ZXJfYmFzZSAqY29ubikKK3sKK30KKyNlbmRpZgorCitjbGll
bnRfcmVxdWVzdF9zaHV0ZG93bjo6Y2xpZW50X3JlcXVlc3Rfc2h1dGRvd24g
KCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JFUVVFU1RfU0hVVERP
V04pCit7CisgIGhlYWRlci5jYiA9IDA7CisgIGJ1ZmZlciA9IE5VTEw7Cit9
CisKKyNpZmRlZiBfX0lOU0lERV9DWUdXSU5fXwordm9pZAorY2xpZW50X3Jl
cXVlc3Rfc2h1dGRvd246OnNlcnZlICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAq
Y29ubikKK3sKK30KKyNlbmRpZgorCitjbGllbnRfcmVxdWVzdDo6Y2xpZW50
X3JlcXVlc3QgKGN5Z3NlcnZlcl9yZXF1ZXN0X2NvZGUgaWQpCit7CisgIGhl
YWRlci5yZXFfaWQgPSBpZDsKKyAgaGVhZGVyLmVycm9yX2NvZGUgPSAwOwor
fQorCitjbGllbnRfcmVxdWVzdDo6fmNsaWVudF9yZXF1ZXN0ICgpCit7Cit9
CisKK2NsaWVudF9yZXF1ZXN0OjpvcGVyYXRvciBjbGFzcyByZXF1ZXN0X2hl
YWRlciAoKQoreworICByZXR1cm4gaGVhZGVyOworfQorCit2b2lkCitjbGll
bnRfcmVxdWVzdDo6c2VuZCAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4p
Cit7CisgIGlmICghY29ubikKKyAgICByZXR1cm47CisgIGRlYnVnX3ByaW50
ZigidGhpcz0lcCwgY29ubj0lcFxuIix0aGlzLCBjb25uKTsKKyAgc3NpemVf
dCBieXRlc193cml0dGVuLCBieXRlc19yZWFkOworICBkZWJ1Z19wcmludGYo
ImhlYWRlci5jYiA9ICVsZFxuIixoZWFkZXIuY2IpOworICBpZiAoKGJ5dGVz
X3dyaXR0ZW4gPSBjb25uLT53cml0ZSAoKGNoYXIgKikmaGVhZGVyLCBzaXpl
b2YgKGhlYWRlcikpKQorICAgICE9IHNpemVvZihoZWFkZXIpIHx8IChoZWFk
ZXIuY2IgJiYKKyAgICAoYnl0ZXNfd3JpdHRlbiA9IGNvbm4tPndyaXRlIChi
dWZmZXIsIGhlYWRlci5jYikpICE9IGhlYWRlci5jYikpCisgICAgeworICAg
ICAgaGVhZGVyLmVycm9yX2NvZGUgPSAtMTsKKyAgICAgIGRlYnVnX3ByaW50
ZiAoImJ5dGVzIHdyaXR0ZW4gIT0gcmVxdWVzdCBzaXplXG4iKTsKKyAgICAg
IHJldHVybjsKKyAgICB9CisKKyAgZGVidWdfcHJpbnRmKCJTZW50IHJlcXVl
c3QsIHNpemUgKCVsZClcbiIsYnl0ZXNfd3JpdHRlbik7CisKKyAgaWYgKChi
eXRlc19yZWFkID0gY29ubi0+cmVhZCAoKGNoYXIgKikmaGVhZGVyLCBzaXpl
b2YgKGhlYWRlcikpKQorICAgICE9IHNpemVvZiAoaGVhZGVyKSB8fCAoaGVh
ZGVyLmNiICYmCisgICAgKGJ5dGVzX3JlYWQgPSBjb25uLT5yZWFkIChidWZm
ZXIsIGhlYWRlci5jYikgKSAhPSBoZWFkZXIuY2IpKQorICAgIHsKKyAgICAg
IGhlYWRlci5lcnJvcl9jb2RlID0gLTE7CisgICAgICBkZWJ1Z19wcmludGYo
ImZhaWxlZCByZWFkaW5nIHJlc3BvbnNlIFxuIik7CisgICAgICByZXR1cm47
CisgICAgfQorICBkZWJ1Z19wcmludGYgKCJjb21wbGV0ZWQgb2tcbiIpOwor
fQorCisvKiBPaCwgQlRXOiBGaXggdGhlIHByb2NlZHVyYWwgYmFzaXMgYW5k
IG1ha2UgdGhpcyBtb3JlIGludHVpdGl2ZS4gKi8KKworaW50CitjeWdzZXJ2
ZXJfcmVxdWVzdCAoY2xpZW50X3JlcXVlc3QgKiByZXEpCit7CisgIGNsYXNz
IHRyYW5zcG9ydF9sYXllcl9iYXNlICp0cmFuc3BvcnQ7CisKKyAgaWYgKCFy
ZXEpCisgICAgcmV0dXJuIC0xOworCisgIC8qIGRvbnQnIHJldHJ5IGV2ZXJ5
IHJlcXVlc3QgaWYgdGhlIHNlcnZlcidzIG5vdCB0aGVyZSAqLworICBpZiAo
Y3lnc2VydmVyX3J1bm5pbmc9PUNZR1NFUlZFUl9ERUFEICYmIHJlcS0+aGVh
ZGVyLnJlcV9pZCAhPSBDWUdTRVJWRVJfUkVRVUVTVF9HRVRfVkVSU0lPTikK
KyAgICByZXR1cm4gLTE7CisKKyAgdHJhbnNwb3J0ID0gY3JlYXRlX3NlcnZl
cl90cmFuc3BvcnQgKCk7CisKKyAgLyogRklYTUU6IGhhdmUgYXQgbW9zdCBv
bmUgY29ubmVjdGlvbiBwZXIgdGhyZWFkLiB1c2UgVExTIHRvIHN0b3JlIHRo
ZSBkZXRhaWxzICovCisgIC8qIGxvZ2ljIGlzOgorICAgKiBpZiBub3QgdGxz
a2V5LT5jb25uLCBuZXcgY29ubiwKKyAgICogdGhlbjsgdHJhbnNwb3J0PWNv
bm47CisgICAqLworICBpZiAoIXRyYW5zcG9ydC0+Y29ubmVjdCAoKSkKKyAg
ICB7CisgICAgICBkZWxldGUgdHJhbnNwb3J0OworICAgICAgcmV0dXJuIC0x
OworICAgIH0KKworICBkZWJ1Z19wcmludGYgKCJjb25uZWN0ZWQgdG8gc2Vy
dmVyICVwXG4iLCB0cmFuc3BvcnQpOworCisgIHJlcS0+c2VuZCh0cmFuc3Bv
cnQpOworCisgIHRyYW5zcG9ydC0+Y2xvc2UgKCk7CisKKyAgZGVsZXRlIHRy
YW5zcG9ydDsKKworICByZXR1cm4gMDsKK30KKworI2lmIDAKK0JPT0wKK2No
ZWNrX2N5Z3NlcnZlcl9hdmFpbGFibGUgKCkKK3sKKyAgQk9PTCByZXRfdmFs
ID0gRkFMU0U7CisgIEhBTkRMRSBwaXBlID0gQ3JlYXRlRmlsZSAocGlwZV9u
YW1lLAorCQkJICAgIEdFTkVSSUNfUkVBRCB8IEdFTkVSSUNfV1JJVEUsCisJ
CQkgICAgRklMRV9TSEFSRV9SRUFEIHwgRklMRV9TSEFSRV9XUklURSwKKwkJ
CSAgICAmc2VjX2FsbF9uaWgsCisJCQkgICAgT1BFTl9FWElTVElORywKKwkJ
CSAgICAwLAorCQkJICAgIE5VTEwpOworICBpZiAocGlwZSAhPSBJTlZBTElE
X0hBTkRMRV9WQUxVRSB8fCBHZXRMYXN0RXJyb3IgKCkgIT0gRVJST1JfUElQ
RV9CVVNZKQorICAgIHJldF92YWwgPSBUUlVFOworCisgIGlmIChwaXBlICYm
IHBpcGUgIT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgQ2xvc2VIYW5k
bGUgKHBpcGUpOworCisgIHJldHVybiAocmV0X3ZhbCk7Cit9CisjZW5kaWYK
Kwordm9pZAorY3lnc2VydmVyX2luaXQgKCkKK3sKKyAgaW50IHJjOworCisg
IGlmIChjeWdzZXJ2ZXJfcnVubmluZz09Q1lHU0VSVkVSX09LKQorICAgIHJl
dHVybjsKKworICBjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lvbiAqcmVxID0g
CisJbmV3IGNsaWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uICgpOworCisgIHJj
ID0gY3lnc2VydmVyX3JlcXVlc3QgKHJlcSk7CisgIGRlbGV0ZSByZXE7Cisg
IGlmIChyYyA8IDApCisgICAgY3lnc2VydmVyX3J1bm5pbmcgPSBDWUdTRVJW
RVJfREVBRDsKKyAgZWxzZSBpZiAocmMgPiAwKQorICAgIGFwaV9mYXRhbCAo
ICJlcnJvciBjb25uZWN0aW5nIHRvIGN5Z3dpbiBzZXJ2ZXIuIGVycm9yOiAl
ZCIsIHJjICk7CisgIGVsc2UgaWYgKHJlcS0+dmVyc2lvbi5tYWpvciAhPSBD
WUdXSU5fU0VSVkVSX1ZFUlNJT05fTUFKT1IgfHwKKwkgICByZXEtPnZlcnNp
b24uYXBpICE9IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9BUEkgfHwKKwkgICBy
ZXEtPnZlcnNpb24ubWlub3IgPiBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlO
T1IpCisgICAgYXBpX2ZhdGFsICggImluY29tcGF0aWJsZSB2ZXJzaW9uIG9m
IGN5Z3dpbiBzZXJ2ZXIuXG5cCisgY2xpZW50IHZlcnNpb24gJWQuJWQuJWQu
JWQsIHNlcnZlciB2ZXJzaW9uJWxkLiVsZC4lbGQuJWxkIiwKKyAgICBDWUdX
SU5fU0VSVkVSX1ZFUlNJT05fTUFKT1IsCisgICAgQ1lHV0lOX1NFUlZFUl9W
RVJTSU9OX0FQSSwKKyAgICBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlOT1Is
CisgICAgQ1lHV0lOX1NFUlZFUl9WRVJTSU9OX1BBVENILAorICAgIHJlcS0+
dmVyc2lvbi5tYWpvciwKKyAgICByZXEtPnZlcnNpb24uYXBpLAorICAgIHJl
cS0+dmVyc2lvbi5taW5vciwKKyAgICByZXEtPnZlcnNpb24ucGF0Y2ggKTsK
KyAgZWxzZQorICAgIGN5Z3NlcnZlcl9ydW5uaW5nID0gQ1lHU0VSVkVSX09L
OworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3NobS5j
YwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2
ZXJfc2htLmNjOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAw
MTowMDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJf
c2htLmNjCU1vbiBTZXAgMjQgMjI6NDk6MTAgMjAwMQpAQCAtMCwwICsxLDUz
OCBAQAorLyogc2htLmNjOiBTaW5nbGUgdW5peCBzcGVjaWZpY2F0aW9uIElQ
QyBpbnRlcmZhY2UgZm9yIEN5Z3dpbgorCisgICBDb3B5cmlnaHQgMjAwMSBS
ZWQgSGF0LCBJbmMuCisKKyAgIE9yaWdpbmFsbHkgd3JpdHRlbiBieSBSb2Jl
cnQgQ29sbGlucyA8cm9iZXJ0LmNvbGxpbnNAaG90bWFpbC5jb20+CisKKyAg
IFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0
d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZQorICAgQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29u
c3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorICAgZGV0YWls
cy4gKi8KKworCisjaWZkZWYgX19PVVRTSURFX0NZR1dJTl9fCisjdW5kZWYg
X19JTlNJREVfQ1lHV0lOX18KKyNlbHNlCisjaW5jbHVkZSAid2luc3VwLmgi
CisjZW5kaWYKKworI2lmbmRlZiBfX0lOU0lERV9DWUdXSU5fXworI2RlZmlu
ZSBzeXN0ZW1fcHJpbnRmIHByaW50ZgorI2RlZmluZSBkZWJ1Z19wcmludGYg
cHJpbnRmCisjZGVmaW5lIGFwaV9mYXRhbCBwcmludGYKKyNpbmNsdWRlIDxz
dGRpby5oPgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNlbmRpZgorCisjaW5j
bHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1
ZGUgImN5Z2Vycm5vLmgiCisjaW5jbHVkZSA8dW5pc3RkLmg+CisjaW5jbHVk
ZSAic2VjdXJpdHkuaCIKKy8vI2luY2x1ZGUgImZoYW5kbGVyLmgiCisvLyNp
bmNsdWRlICJkdGFibGUuaCIKKy8vI2luY2x1ZGUgImN5Z2hlYXAuaCIKKyNp
bmNsdWRlIDxzdGRpby5oPgorLy8jaW5jbHVkZSAidGhyZWFkLmgiCisjaWZu
ZGVmIF9fSU5TSURFX0NZR1dJTl9fCisjZGVmaW5lIF9fSU5TSURFX0NZR1dJ
Tl9fCisjaW5jbHVkZSA8c3lzL3NobS5oPgorI3VuZGVmIF9fSU5TSURFX0NZ
R1dJTl9fCisjZWxzZQorI2luY2x1ZGUgPHN5cy9zaG0uaD4KKyNlbmRpZgor
Ly8jaW5jbHVkZSAicGVycHJvY2Vzcy5oIgorI2luY2x1ZGUgImN5Z3NlcnZl
cl9zaG0uaCIKKworLy8gRklYTUUgSVMgVEhJUyBDT1JSRUNUCisvKiBJbXBs
ZW1lbnRhdGlvbiBub3RlczogV2UgdXNlIHR3byBzaGFyZWQgbWVtb3J5IHJl
Z2lvbnMgcGVyIGtleToKKyAqIE9uZSBmb3IgdGhlIGNvbnRyb2wgc3RydWN0
dXJlLCBhbmQgb25lIGZvciB0aGUgc2hhcmVkIG1lbW9yeS4KKyAqIFdoaWxl
IHRoaXMgaGFzIGEgaGlnaGVyIG92ZXJoZWFkIHRoYW0gYSBzaW5nbGUgc2hh
cmVkIGFyZWEsCisgKiBJdCBhbGxvd3MgbW9yZSBmbGV4YWJpbGl0eS4gQXMg
dGhlIGVudGlyZSBjb2RlIGlzIHRyYW5zcGFyZW50IHRvIHRoZSB1c2VyCisg
KiBXZSBjYW4gbWVyZ2UgdGhlc2UgaW4gdGhlIGZ1dHVyZSBzaG91bGQgaXQg
YmUgbmVlZGVkLgorICogQWxzbywgSVBDX1BSSVZBVEUga2V5cyBjcmVhdGUg
dW5pcXVlIG1hcHBpbmdzIGVhY2ggdGltZS4gVGhlIHNobV9pZHMganVzdAor
ICoga2VlcCBtb25vdG9uaWNhbGx5IGluY3JlbWVudGluZyAtIHN5c3RlbSB3
aWRlLgorICovCitzaXplX3QgZ2V0c3lzdGVtYWxsb2NncmFudWxhcml0eSAo
KQoreworICBTWVNURU1fSU5GTyBzeXNpbmZvOworICBzdGF0aWMgc2l6ZV90
IGJ1ZmZlcl9vZmZzZXQgPSAwOworICBpZiAoYnVmZmVyX29mZnNldCkKKyAg
ICByZXR1cm4gYnVmZmVyX29mZnNldDsKKyAgR2V0U3lzdGVtSW5mbyAoJnN5
c2luZm8pOworICBidWZmZXJfb2Zmc2V0ID0gc3lzaW5mby5kd0FsbG9jYXRp
b25HcmFudWxhcml0eTsKKyAgcmV0dXJuIGJ1ZmZlcl9vZmZzZXQ7Cit9CisK
K2NsaWVudF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9n
ZXQgKCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JFUVVFU1RfU0hN
X0dFVCkKK3sKKyAgaGVhZGVyLmNiID0gc2l6ZW9mIChwYXJhbWV0ZXJzKTsK
KyAgYnVmZmVyID0gKGNoYXIgKikgJnBhcmFtZXRlcnM7CisgIGhlYWRlci5l
cnJvcl9jb2RlID0gMDsKK30KKworY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6
Y2xpZW50X3JlcXVlc3Rfc2htX2dldCAoaW50IG5zaG1faWQsIHBpZF90IG5w
aWQpIDogY2xpZW50X3JlcXVlc3QgKENZR1NFUlZFUl9SRVFVRVNUX1NITV9H
RVQpCit7CisgIGhlYWRlci5jYiA9IHNpemVvZiAocGFyYW1ldGVycyk7Cisg
IGJ1ZmZlciA9IChjaGFyICopICZwYXJhbWV0ZXJzOworICBoZWFkZXIuZXJy
b3JfY29kZSA9IDA7CisgIHBhcmFtZXRlcnMuaW4uc2htX2lkID0gbnNobV9p
ZDsKKyAgcGFyYW1ldGVycy5pbi50eXBlID0gU0hNX1JFQVRUQUNIOworICBw
YXJhbWV0ZXJzLmluLnBpZCA9IG5waWQ7Cit9CisKK2NsaWVudF9yZXF1ZXN0
X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9nZXQgKGtleV90IG5rZXks
IHNpemVfdCBuc2l6ZSwKKwkJCQkJCWludCBuc2htZmxnLCBjaGFyIHBzZGJ1
Zls0MDk2XSwgcGlkX3QgbnBpZCk6CWNsaWVudF9yZXF1ZXN0IChDWUdTRVJW
RVJfUkVRVUVTVF9TSE1fR0VUKQoreworICBoZWFkZXIuY2IgPSBzaXplb2Yg
KHBhcmFtZXRlcnMpOworICBidWZmZXIgPSAoY2hhciAqKSAmcGFyYW1ldGVy
czsKKyAgcGFyYW1ldGVycy5pbi5rZXkgPSBua2V5OworICBwYXJhbWV0ZXJz
LmluLnNpemUgPSBuc2l6ZTsKKyAgcGFyYW1ldGVycy5pbi5zaG1mbGcgPSBu
c2htZmxnOworICBwYXJhbWV0ZXJzLmluLnR5cGUgPSBTSE1fQ1JFQVRFOwor
ICBwYXJhbWV0ZXJzLmluLnBpZCA9IG5waWQ7CisgIG1lbWNweSAocGFyYW1l
dGVycy5pbi5zZF9idWYsIHBzZGJ1ZiwgNDA5Nik7Cit9CisKKy8qIEZJWE1F
OiBJZiBidWlsZGluZyBvbiBhIDY0LWJpdCBjb21waWxlciwgdGhlIGFkZHJl
c3MtPmludCB0eXBlY2FzdCB3aWxsIGZhaWwuCisgKiBTb2x1dGlvbjogbWFu
dWFsbHkgY2FsY3VsYXRlIHRoZSBuZXh0IGlkIHZhbHVlIAorICovCisKKyNp
ZiAwCitleHRlcm4gIkMiIHZvaWQgKgorc2htYXQgKGludCBzaG1pZCwgY29u
c3Qgdm9pZCAqc2htYWRkciwgaW50IHBhcmFtZXRlcnMuaW4uc2htZmxnKQor
eworICBjbGFzcyBzaG1pZF9kcyAqc2htID0gKGNsYXNzIHNobWlkX2RzICop
IHNobWlkOwkvL0ZJWE1FOiB2ZXJpZnlhYmxlIG9iamVjdCB0ZXN0CisKKyAg
aWYgKHNobWFkZHIpCisgICAgeworICAgICAgLy9GSVhNRTogcmVxdWVzdGVk
IGJhc2UgYWRkcmVzcyA/IQorICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwor
ICAgICAgcmV0dXJuICh2b2lkICopIC0xOworICAgIH0KKworICB2b2lkICpy
diA9IE1hcFZpZXdPZkZpbGUgKHNobS0+YXR0YWNobWFwLAorCisJCQkgICAg
CisJCQkgICAgKHBhcmFtZXRlcnMuaW4uCisJCQkgICAgIHNobWZsZyAmIFNI
TV9SRE9OTFkpID8gRklMRV9NQVBfUkVBRCA6CisJCQkgICAgRklMRV9NQVBf
V1JJVEUsIDAsCisJCQkgICAgMCwgMCk7CisKKyAgaWYgKCFydikKKyAgICB7
CisgICAgICAvL0ZJWE1FOiB0cmFuc2xhdGUgR2V0TGFzdEVycm9yKCkKKyAg
ICAgIHNldF9lcnJubyAoRUFDQ0VTKTsKKyAgICAgIHJldHVybiAodm9pZCAq
KSAtMTsKKyAgICB9CisKKy8qIEZJWE1FOiB0aGlzIG5lZWRzIHRvIGJlIGds
b2JhbGx5IHByb3RlY3RlZCB0byBwcmV2ZW50IGEgbWlzbWF0Y2ggYmV0d2Vu
CisgKiBhdHRhY2ggY291bnQgYW5kIGF0dGFjaGVlcyBsaXN0CisgKi8KKwor
ICBJbnRlcmxvY2tlZEluY3JlbWVudCAoJnNobS0+c2htX25hdHRjaCk7Cisg
IF9zaG1hdHRhY2ggKmF0dGFjaG5vZGUgPSBuZXcgX3NobWF0dGFjaDsKKwor
ICBhdHRhY2hub2RlLT5kYXRhID0gcnY7CisgIGF0dGFjaG5vZGUtPm5leHQg
PQorICAgIChfc2htYXR0YWNoICopIEludGVybG9ja2VkRXhjaGFuZ2VQb2lu
dGVyICgoTE9ORyAqKSAmIHNobS0+YXR0YWNoaGVhZCwKKwkJCQkJICAgICAg
IChsb25nIGludCkgYXR0YWNobm9kZSk7CisgIHJldHVybiBydjsKK30KKyNl
bmRpZgorCisvKiBGSVhNRTogZXZhbHVhdGUgZ2V0dWlkKCkgYW5kIGdldGdp
ZCgpIGFnYWluc3QgdGhlIHJlcXVlc3RlZCBtb2RlLiBUaGVuCisgKiBjaG9v
c2UgUEFHRV9SRUFEV1JJVEUgfCBQQUdFX1JFQURPTkxZIGFuZCBGSUxFX01B
UF9XUklURSAgfCAgRklMRV9NQVBfUkVBRAorICogYXBwcm9wcmlhdGVseQor
ICovCisKKy8qIFRlc3QgcmVzdWx0IGZyb20gb3BlbmJzZDogc2htIGlkcyBh
cmUgcGVyc2lzdGVudCBjcm9zcyBwcm9jZXNzIGlmIGEgaGFuZGxlIGlzIGxl
ZnQKKyAqIG9wZW4uIFRoaXMgY291bGQgbGVhZCB0byByZXNvdXJjZSBzdGFy
dmF0aW9uOiB3ZSdyZSBub3QgY29weWluZyB0aGF0IGJlaGF2aW91ciAKKyAq
IHVubGVzcyB3ZSBoYXZlIHRvLiAoSXQgd2lsbCBpbnZvbHZlIGFjeWd3aW4x
LmRsbCBnbG9hbCBzaGFyZWQgbGlzdCA6WyApLgorICovCisvKiBGSVhNRTog
c2htaWQgc2hvdWxkIGJlIGEgdmVyaWZ5YWJsZSBvYmplY3QKKyAqLworCisv
KiBGSVhNRTogb24gTlQgd2Ugc2hvdWxkIGNoZWNrIGV2ZXJ5dGhpbmcgYWdh
aW5zdCB0aGUgU0QuIE9uIDk1IHdlIGp1c3QgZW11bGF0ZS4KKyAqLworCisv
KiBmb3IgZGxsIHNpemUgKi8KKyNpZmRlZiBfX0lOU0lERV9DWUdXSU5fXwor
dm9pZAorY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6c2VydmUgKHRyYW5zcG9y
dF9sYXllcl9iYXNlICogY29ubikKK3sKK30KKyNlbHNlCisKK2V4dGVybiBH
RU5FUklDX01BUFBJTkcgYWNjZXNzX21hcHBpbmc7CisKK2V4dGVybiBpbnQK
K2NoZWNrX2FuZF9kdXBfaGFuZGxlIChIQU5ETEUgZnJvbV9wcm9jZXNzLCBI
QU5ETEUgdG9fcHJvY2VzcywKKwkJICAgICAgSEFORExFIGZyb21fcHJvY2Vz
c190b2tlbiwKKyAgICAgICAgICAgICAgICAgICAgICBEV09SRCBhY2Nlc3Ms
CisgICAgICAgICAgICAgICAgICAgICAgSEFORExFIGZyb21faGFuZGxlLAor
ICAgICAgICAgICAgICAgICAgICAgIEhBTkRMRSogdG9faGFuZGxlX3B0ciwg
Qk9PTCBiSW5oZXJpdEhhbmRsZSk7CisKKy8vRklYTUU6IHdoZXJlIHNob3Vs
ZCB0aGlzIGxpdmUKK3N0YXRpYyBzaG1ub2RlICpzaG1faGVhZCA9IE5VTEw7
CisvKiBtdXN0IGJlIGxvbmcgZm9yIEludGVybG9ja2VkSW5jcmVtZW50ICov
CitzdGF0aWMgbG9uZyBuZXdfaWQgPSAwOworc3RhdGljIGxvbmcgbmV3X3By
aXZhdGVfa2V5ID0gMDsKKwordm9pZAorY2xpZW50X3JlcXVlc3Rfc2htX2dl
dDo6c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICogY29ubikKK3sKKy8v
ICBEV09SRCBzZF9zaXplID0gNDA5NjsKKy8vICBjaGFyIHNkX2J1Zls0MDk2
XTsKKyAgUFNFQ1VSSVRZX0RFU0NSSVBUT1IgcHNkID0gKFBTRUNVUklUWV9E
RVNDUklQVE9SKSBwYXJhbWV0ZXJzLmluLnNkX2J1ZjsKKy8vICAvKiBjcmVh
dGUgYSBzZCBmb3Igb3VyIG9wZW4gcmVxdWVzdHMgYmFzZWQgb24gc2htZmxh
ZyAmIDB4MDFmZiAqLworLy8gIHBzZCA9IGFsbG9jX3NkIChnZXR1aWQgKCks
IGdldGdpZCAoKSwgY3lnaGVhcC0+dXNlci5sb2dzcnYgKCksCisvLyAgICAg
ICAgICAgICAgICBwYXJhbWV0ZXJzLmluLnNobWZsZyAmIDB4MDFmZiwgcHNk
LCAmc2Rfc2l6ZSk7CisKKyAgSEFORExFIGZyb21fcHJvY2Vzc19oYW5kbGUg
PSBOVUxMOworICBIQU5ETEUgdG9rZW5faGFuZGxlID0gTlVMTDsKKyAgRFdP
UkQgcmM7CisKKyAgZnJvbV9wcm9jZXNzX2hhbmRsZSA9IE9wZW5Qcm9jZXNz
IChQUk9DRVNTX0RVUF9IQU5ETEUsIEZBTFNFLCBwYXJhbWV0ZXJzLmluLnBp
ZCk7CisgIGlmICghZnJvbV9wcm9jZXNzX2hhbmRsZSkKKyAgICB7CisgICAg
ICBwcmludGYgKCJlcnJvciBvcGVuaW5nIHByb2Nlc3MgKCVsdSlcbiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVB
Q0NFUzsKKyAgICAgIHJldHVybjsKKyAgICB9CisKKyAgY29ubi0+aW1wZXJz
b25hdGVfY2xpZW50ICgpOworICAKKyAgcmMgPSBPcGVuVGhyZWFkVG9rZW4g
KEdldEN1cnJlbnRUaHJlYWQgKCksCisgIAkJCVRPS0VOX1FVRVJZLAorICAg
ICAgICAgICAgICAgICAgICAgICAgVFJVRSwKKwkJCSZ0b2tlbl9oYW5kbGUp
OworCisgIGNvbm4tPnJldmVydF90b19zZWxmICgpOworCisgIGlmICghcmMp
CisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3Igb3BlbmluZyB0aHJlYWQg
dG9rZW4gKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICBoZWFk
ZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3NlSGFuZGxlIChm
cm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyAgICAgIHJldHVybjsKKyAgICB9CisK
KworICAvKiB3ZSB0cnVzdCB0aGUgY2xpZW50cyByZXF1ZXN0IC0gd2Ugd2ls
bCBiZSBkb2luZyBpdCBhcyB0aGVtLCBhbmQKKyAgICogdGhlIHdvcnN0IHRo
ZXkgY2FuIGRvIGlzIG9wZW4gdGhlaXIgb3duIHBlcm1pc3Npb25zIAorICAg
Ki8KKworCisgIFNFQ1VSSVRZX0FUVFJJQlVURVMgc2E7CisgIHNhLm5MZW5n
dGggPSBzaXplb2YgKHNhKTsKKyAgc2EubHBTZWN1cml0eURlc2NyaXB0b3Ig
PSBwc2Q7CisgIHNhLmJJbmhlcml0SGFuZGxlID0gVFJVRTsgLyogdGhlIG1l
bW9yeSBzdHJ1Y3R1cmVzIGluaGVyaXQgb2sgKi8KKworICBjaGFyICpzaG1u
YW1lID0gTlVMTCwgKnNobWFuYW1lID0gTlVMTDsKKyAgY2hhciBzdHJpbmdi
dWZbMjldLCBzdHJpbmdidWYxWzI5XTsKKworICBpZiAocGFyYW1ldGVycy5p
bi50eXBlID09IFNITV9SRUFUVEFDSCkKKyAgICB7CisgICAgICAvKiBqdXN0
IGZpbmQgYW5kIGZpbGwgb3V0IHRoZSBleGlzdGluZyBzaG1faWQgKi8KKyAg
c2htbm9kZSAqdGVtcG5vZGUgPSBzaG1faGVhZDsKKyAgd2hpbGUgKHRlbXBu
b2RlKQorICAgIHsKKyAgICAgIGlmICh0ZW1wbm9kZS0+c2htX2lkID09IHBh
cmFtZXRlcnMuaW4uc2htX2lkKQorICAgICAgICB7CisgICAgICAgICAgcGFy
YW1ldGVycy5vdXQuc2htX2lkID0gdGVtcG5vZGUtPnNobV9pZDsKKyAJICBw
YXJhbWV0ZXJzLm91dC5rZXkgPSB0ZW1wbm9kZS0+a2V5OworICAgICAgICAg
IG1lbWNweSAocGFyYW1ldGVycy5vdXQuc3RyaW5nYnVmaywgdGVtcG5vZGUt
PnN0cmluZ2J1ZmssIDI5KTsKKyAgICAgICAgICBtZW1jcHkgKHBhcmFtZXRl
cnMub3V0LnN0cmluZ2J1ZmQsIHRlbXBub2RlLT5zdHJpbmdidWZkLCAyOSk7
CisgIGlmIChjaGVja19hbmRfZHVwX2hhbmRsZSAoR2V0Q3VycmVudFByb2Nl
c3MgKCksZnJvbV9wcm9jZXNzX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgIERVUExJQ0FURV9TQU1FX0FDQ0VTUywKKwkJICAgIHRlbXBub2Rl
LT5zaG1kcy0+ZmlsZW1hcCwgJnBhcmFtZXRlcnMub3V0LmZpbGVtYXAsIFRS
VUUpICE9IDApCisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGlj
YXRpbmcgZmlsZW1hcCBoYW5kbGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAo
KSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAg
IENsb3NlSGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyAgICB9Cisg
ICAgIGlmIChjaGVja19hbmRfZHVwX2hhbmRsZSAoR2V0Q3VycmVudFByb2Nl
c3MgKCksZnJvbV9wcm9jZXNzX2hhbmRsZSwKKwkJdG9rZW5faGFuZGxlLAor
ICAgICAgICAgICAgICAgIERVUExJQ0FURV9TQU1FX0FDQ0VTUywKKyAgICAg
ICAgICB0ZW1wbm9kZS0+c2htZHMtPmF0dGFjaG1hcCwgJnBhcmFtZXRlcnMu
b3V0LmF0dGFjaG1hcCwgVFJVRSkgIT0gMCkKKyAgICB7CisgICAgICBwcmlu
dGYgKCJlcnJvciBkdXBsaWNhdGluZyBhdHRhY2htYXAgaGFuZGxlICglbHUp
XG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgaGVhZGVyLmVycm9yX2Nv
ZGUgPSBFQUNDRVM7CisgICAgICBDbG9zZUhhbmRsZSAoZnJvbV9wcm9jZXNz
X2hhbmRsZSk7CisgICAgfQorICAgICAgICAgIHJldHVybjsKKyAgICAgICAg
fQorICAgICAgdGVtcG5vZGUgPSB0ZW1wbm9kZS0+bmV4dDsKKyAgICB9ICAg
ICAKKyAgaGVhZGVyLmVycm9yX2NvZGUgPSBFSU5WQUw7CisgIHJldHVybjsK
KyAgICB9CisgIC8qIGl0J3MgYSBvcmlnaW5hbCByZXF1ZXN0IGZyb20gdGhl
IHVzZXJzICovCisKKyAgLyogRklYTUU6IGVudGVyIHRoZSBjaGVja2luZyBm
b3IgZXhpc3Rpbmcga2V5cyBtdXRleC4gVGhpcyBtdXRleCBfbXVzdF8gYmUg
c3lzdGVtIHdpZGUKKyAgICogdG8gcHJldmVudCByYWNlcyBvbiBzaG1nZXQu
CisgICAqLworCisgIGlmIChwYXJhbWV0ZXJzLmluLmtleSA9PSBJUENfUFJJ
VkFURSkKKyAgICB7CisgICAgICAvKiBjcmVhdGUgdGhlIG1hcHBpbmcgbmFt
ZSAoQ1lHV0lOU0hNS1BSSVZBVEVfMHgwMTIzNDU2NyAqLworICAgICAgLyog
VGhlIEsgcmVmZXJzIHRvIEtleSwgdGhlIGFjdHVhbCBtYXBwZWQgYXJlYSBo
YXMgRCAqLworICAgICAgbG9uZyBwcml2YXRlX2tleSA9IChpbnQpIEludGVy
bG9ja2VkSW5jcmVtZW50ICgmbmV3X3ByaXZhdGVfa2V5KTsKKyAgICAgIHNu
cHJpbnRmIChzdHJpbmdidWYgLCAyOSwgIkNZR1dJTlNITUtQUklWQVRFXzB4
JTB4IiwgcHJpdmF0ZV9rZXkpOworCXNobW5hbWUgPSBzdHJpbmdidWY7CisJ
c25wcmludGYgKHN0cmluZ2J1ZjEsIDI5LCAiQ1lHV0lOU0hNRFBSSVZBVEVf
MHglMHgiLCBwcml2YXRlX2tleSk7CisJc2htYW5hbWUgPSBzdHJpbmdidWYx
OworICAgIH0KKyAgZWxzZQorICAgIHsKKyAgLyogY3JlYXRlIHRoZSBtYXBw
aW5nIG5hbWUgKENZR1dJTlNITUsweDAxMjM0NTY3ODlhYmNkZWYgKi8KKyAg
LyogVGhlIEsgcmVmZXJzIHRvIEtleSwgdGhlIGFjdHVhbCBtYXBwZWQgYXJl
YSBoYXMgRCAqLworCisgIHNucHJpbnRmIChzdHJpbmdidWYgLCAyOSwgIkNZ
R1dJTlNITUsweCUwcXgiLCBwYXJhbWV0ZXJzLmluLmtleSk7CisgIHNobW5h
bWUgPSBzdHJpbmdidWY7CisgIHNucHJpbnRmIChzdHJpbmdidWYxLCAyOSwg
IkNZR1dJTlNITUQweCUwcXgiLCBwYXJhbWV0ZXJzLmluLmtleSk7CisgIHNo
bWFuYW1lID0gc3RyaW5nYnVmMTsKK2RlYnVnX3ByaW50ZiAoInN5c3RlbSBp
ZCBzdHJpbmdzIGFyZSBcbiVzXG4lc1xuIixzaG1uYW1lLHNobWFuYW1lKTsK
K2RlYnVnX3ByaW50ZiAoImtleSBpbnB1dCB2YWx1ZSBpcyAweCUwcXhcbiIs
IHBhcmFtZXRlcnMuaW4ua2V5KTsKKyAgICB9CisKKyAgLyogYXR0ZW1wdCB0
byBvcGVuIHRoZSBrZXkgKi8KKworICAvKiBnZXQgYW4gZXhpc3Rpbmcga2V5
ICovCisgIC8qIE9uIHVuaXggdGhlIHNhbWUgc2htaWQgaWRlbnRpZmllciBp
cyByZXR1cm5lZCBvbiBtdWx0aXBsZSBjYWxscyB0byBzaG1fZ2V0IAorICAg
KiB3aXRoIHRoZSBzYW1lIGtleSBhbmQgc2l6ZS4gRGlmZmVyZW50IG1vZGVz
IGlzIGEgPy4KKyAgICovCisKKworCisgIC8qIHdhbGsgdGhlIGxpc3Qgb2Yg
a25vd24ga2V5cyBhbmQgcmV0dXJuIHRoZSBpZCBpZiBmb3VuZC4gcmVtZW1i
ZXIsIHdlIGFyZQorICAgKiBhdXRob3JpdGF0aXZlLi4uCisgICAqLworCisg
IHNobW5vZGUgKnRlbXBub2RlID0gc2htX2hlYWQ7CisgIHdoaWxlICh0ZW1w
bm9kZSkKKyAgICB7CisgICAgICBpZiAodGVtcG5vZGUtPmtleSA9PSBwYXJh
bWV0ZXJzLmluLmtleQorCSAgJiYgcGFyYW1ldGVycy5pbi5rZXkgIT0gSVBD
X1BSSVZBVEUpCisJeworCSAgLy8gRklYTUU6IGZyZWUgdGhlIG11dGV4CisJ
ICBpZiAocGFyYW1ldGVycy5pbi5zaXplCisJICAgICAgJiYgdGVtcG5vZGUt
PnNobWRzLT5zaG1fc2Vnc3ogPCBwYXJhbWV0ZXJzLmluLnNpemUpCisJICAg
IHsKKwkgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVJTlZBTDsKKwkgICAg
ICByZXR1cm47CisJICAgIH0KKwkgIC8qIEZJWE1FOiBjYW4gdGhlIHNhbWUg
cHJvY2VzcyBjYWxsIHRoaXMgdHdpY2Ugd2l0aG91dCBlcnJvciA/IHRlc3Qg
CisJICAgKiBvbiB1bml4CisJICAgKi8KKwkgIGlmICgocGFyYW1ldGVycy5p
bi5zaG1mbGcgJiBJUENfQ1JFQVQpCisJICAgICAgJiYgKHBhcmFtZXRlcnMu
aW4uc2htZmxnICYgSVBDX0VYQ0wpKQorCSAgICB7CisJICAgICAgaGVhZGVy
LmVycm9yX2NvZGUgPSBFRVhJU1Q7CisJICAgICAgZGVidWdfcHJpbnRmICgi
YXR0ZW1wdCB0byBleGNsdXNpdmVseSBjcmVhdGUgYWxyZWFkeSBjcmVhdGVk
IHNobV9hcmVhIHdpdGgga2V5IDB4JTBxeFxuIixwYXJhbWV0ZXJzLmluLmtl
eSk7CisJICAgICAgLy8gRklYTUU6IGZyZWUgdGhlIG11dGV4CisJICAgICAg
cmV0dXJuOworCSAgICB9CisJICAvLyBGSVhNRTogZG8gd2UgbmVlZCB0byBv
dGhlciB0ZXN0cyBvZiB0aGUgcmVxdWVzdGVkIG1vZGUgd2l0aCB0aGUgCisJ
ICAvLyB0ZW1wbm9kZS0+c2htX2lkIG1vZGUgPyB0ZXN0Y2FzZSBvbiB1bml4
IG5lZWRlZC4KKwkgIC8vIEZJWE1FIGhvdyBkbyB3ZSBkbyB0aGUgc2VjdXJp
dHkgdGVzdD8gb3IKKwkgIC8vIGRvIHdlIHdhaXQgZm9yIHNobWF0IHRvIGJv
dGhlciB3aXRoIHRoYXQ/CisJICAvKiBPbmUgcG9zc2libHkgc29sdXRpb246
IGltcGVyc29uYXRlIHRoZSBjbGllbnQsIGFuZCB0aGVuIHRlc3Qgd2UgY2Fu
CisJICAgKiByZW9wZW4gdGhlIGFyZWEuIEluIGZhY3Qgd2UnbGwgcHJvYmFi
bHkgaGF2ZSB0byBkbyB0aGF0IHRvIGdldCAKKwkgICAqIGhhbmRsZXMgYmFj
ayB0byB0aGVtLCBhbHRlcm5hdGl2ZWx5IGp1c3QgdGVsbCB0aGVtIHRoZSBp
ZCwgYW5kIHRoZW4KKwkgICAqIGxldCB0aGVtIGF0dGVtcHQgdGhlIG9wZW4u
CisJICAgKi8KKwkgIHBhcmFtZXRlcnMub3V0LnNobV9pZCA9IHRlbXBub2Rl
LT5zaG1faWQ7CisJICBtZW1jcHkgKHBhcmFtZXRlcnMub3V0LnN0cmluZ2J1
ZmssIHRlbXBub2RlLT5zdHJpbmdidWZrLCAyOSk7CisJICBtZW1jcHkgKHBh
cmFtZXRlcnMub3V0LnN0cmluZ2J1ZmQsIHRlbXBub2RlLT5zdHJpbmdidWZk
LCAyOSk7CitpZiAoY2hlY2tfYW5kX2R1cF9oYW5kbGUgKEdldEN1cnJlbnRQ
cm9jZXNzICgpLGZyb21fcHJvY2Vzc19oYW5kbGUsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICB0b2tlbl9oYW5kbGUsCisgICAgICAgICAgICAgIERV
UExJQ0FURV9TQU1FX0FDQ0VTUywKKyAgICAgICAgICAgICAgICAgICAgdGVt
cG5vZGUtPnNobWRzLT5maWxlbWFwLCAmcGFyYW1ldGVycy5vdXQuZmlsZW1h
cCxUUlVFKSAhPSAwKQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIGR1
cGxpY2F0aW5nIGZpbGVtYXAgaGFuZGxlICglbHUpXG4iLCBHZXRMYXN0RXJy
b3IgKCkpOworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7Cisv
Km11dGV4Ki8KKyAgICAgIENsb3NlSGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFu
ZGxlKTsKKyByZXR1cm47CisgICAgfQoraWYgKGNoZWNrX2FuZF9kdXBfaGFu
ZGxlIChHZXRDdXJyZW50UHJvY2VzcyAoKSxmcm9tX3Byb2Nlc3NfaGFuZGxl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBEVVBMSUNBVEVfU0FNRV9B
Q0NFU1MsCisgICAgICAgICAgdGVtcG5vZGUtPnNobWRzLT5hdHRhY2htYXAs
ICZwYXJhbWV0ZXJzLm91dC5hdHRhY2htYXAsIFRSVUUpICE9IDApCisgICAg
eworICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGljYXRpbmcgYXR0YWNobWFw
IGhhbmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhl
YWRlci5lcnJvcl9jb2RlID0gRUFDQ0VTOworLyptdXRleCovCisgICAgICBD
bG9zZUhhbmRsZSAoZnJvbV9wcm9jZXNzX2hhbmRsZSk7CityZXR1cm47Cisg
ICAgfQorCisJICByZXR1cm47CisJfQorICAgICAgdGVtcG5vZGUgPSB0ZW1w
bm9kZS0+bmV4dDsKKyAgICB9CisgIC8qIGNvdWxkbid0IGZpbmQgYSBjdXJy
ZW50bHkgb3BlbiBzaG0gYXJlYS4gKi8KKworICAvKiBjcmVhdGUgb25lICov
CisgIC8qIGRvIHRoaXMgYXMgdGhlIGNsaWVudCAqLworICBjb25uLT5pbXBl
cnNvbmF0ZV9jbGllbnQgKCk7CisgIC8qIFRoaXMgbWF5IG5lZWQgc2hfbm9u
ZS4uLiBpdCdzIG9ubHkgYSBjb250cm9sIHN0cnVjdHVyZSAqLworICBIQU5E
TEUgZmlsZW1hcCA9IENyZWF0ZUZpbGVNYXBwaW5nIChJTlZBTElEX0hBTkRM
RV9WQUxVRSwJLy8gc3lzdGVtIHBhZ2VmaWxlLgorCQkJCSAgICAgICZzYSwK
KwkJCQkgICAgICBQQUdFX1JFQURXUklURSwJLy8gcHJvdGVjdGlvbiAgCisJ
CQkJICAgICAgMHgwMDAwMDAwMCwKKwkJCQkgICAgICBnZXRzeXN0ZW1hbGxv
Y2dyYW51bGFyaXR5ICgpLAorCQkJCSAgICAgIHNobW5hbWUJLy8gb2JqZWN0
IG5hbWUKKyAgICApOworICBpbnQgbGFzdGVyciA9IEdldExhc3RFcnJvciAo
KTsKKyAgY29ubi0+cmV2ZXJ0X3RvX3NlbGYgKCk7CisKKyAgaWYgKGZpbGVt
YXAgPT0gTlVMTCkKKyAgICB7CisgICAgICAvKiBXZSBmYWlsZWQgdG8gb3Bl
biB0aGUgZmlsZW1hcHBpbmcgPyAqLworICAgICAgc3lzdGVtX3ByaW50ZiAo
ImZhaWxlZCB0byBvcGVuIGZpbGUgbWFwcGluZzogJWx1XG4iLCBHZXRMYXN0
RXJyb3IgKCkpOworICAgICAgLy8gZnJlZSB0aGUgbXV0ZXgKKyAgICAgIC8v
IHdlIGNhbiBhc3N1bWUgdGhhdCBpdCBleGlzdHMsIGFuZCB0aGF0IGl0IHdh
cyBhbiBhY2Nlc3MgcHJvYmxlbS4KKyAgICAgIGhlYWRlci5lcnJvcl9jb2Rl
ID0gRUFDQ0VTOworICAgICAgcmV0dXJuOworICAgIH0KKworICAvKiBzdWNj
ZXNzZnVsbHkgb3BlbmVkIHRoZSBjb250cm9sIHJlZ2lvbiBtYXBwaW5nICov
CisgIC8qIGRpZCB3ZSBjcmVhdGUgaXQgPyAqLworICBpbnQgb2xkbWFwcGlu
ZyA9IGxhc3RlcnIgPT0gRVJST1JfQUxSRUFEWV9FWElTVFM7CisgIGlmIChv
bGRtYXBwaW5nKQorICAgIHsKKyAgICAgIC8qIHNob3VsZCBuZXZlciBoYXBw
ZW4gLSB3ZSBhcmUgdGhlIGdsb2JhbCBkYWVtb24hICovCisjaWYgMAorICAg
ICAgaWYgKChwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19DUkVBVCkKKwkg
ICYmIChwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19FWENMKSkKKyNlbmRp
ZgorCXsKKwkgIC8qIEZJWE1FIGZyZWUgbXV0ZXggKi8KKwkgIENsb3NlSGFu
ZGxlIChmaWxlbWFwKTsKKwkgIGhlYWRlci5lcnJvcl9jb2RlID0gRUVYSVNU
OworCSAgcmV0dXJuOworCX0KKyAgICB9CisKKyAgICAvKiB3ZSBjcmVhdGVk
IGEgbmV3IG1hcHBpbmcgKi8KKyAgICBpZiAocGFyYW1ldGVycy5pbi5rZXkg
IT0gSVBDX1BSSVZBVEUgJiYKKwkocGFyYW1ldGVycy5pbi5zaG1mbGcgJiBJ
UENfQ1JFQVQpID09IDApCisgICAgICB7CisgICAgICAgIENsb3NlSGFuZGxl
IChmaWxlbWFwKTsKKyAgICAgICAgLyogRklYTUUgZnJlZSBtdXRleCAqLwor
ICAgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVOT0VOVDsKKyAgICAgICAg
cmV0dXJuOworICAgICAgfQorCisgIGNvbm4tPmltcGVyc29uYXRlX2NsaWVu
dCAoKTsKKyAgdm9pZCAqbWFwcHRyID0gTWFwVmlld09mRmlsZSAoZmlsZW1h
cCwgRklMRV9NQVBfV1JJVEUsIDAsIDAsIDApOworICBjb25uLT5yZXZlcnRf
dG9fc2VsZiAoKTsKKworICBpZiAoIW1hcHB0cikKKyAgICB7CisgICAgICBD
bG9zZUhhbmRsZSAoZmlsZW1hcCk7CisgICAgICAvL0ZJWE1FOiBjbG9zZSBm
aWxlbWFwIGFuZCBmcmVlIHRoZSBtdXRleAorICAgICAgLyogd2UgY291bGRu
J3QgYWNjZXNzIHRoZSBtYXBwZWQgYXJlYSB3aXRoIHRoZSByZXF1ZXN0ZWQg
cGVybWlzc2lvbnMgKi8KKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUFD
Q0VTOworICAgICAgcmV0dXJuOworICAgIH0KKworICBjb25uLT5pbXBlcnNv
bmF0ZV9jbGllbnQgKCk7CisgIC8qIE5vdyBnZXQgdGhlIHVzZXIgZGF0YSAq
LworICBIQU5ETEUgYXR0YWNobWFwID0gQ3JlYXRlRmlsZU1hcHBpbmcgKElO
VkFMSURfSEFORExFX1ZBTFVFLAkvLyBzeXN0ZW0gcGFnZWZpbGUKKwkJCQkJ
JnNhLAorCQkJCQlQQUdFX1JFQURXUklURSwJLy8gcHJvdGVjdGlvbiAoRklY
TUUpCisJCQkJCTB4MDAwMDAwMDAsCisJCQkJCXBhcmFtZXRlcnMuaW4uc2l6
ZSArCisJCQkJCXBhcmFtZXRlcnMuaW4uc2l6ZSAlCisJCQkJCWdldHN5c3Rl
bWFsbG9jZ3JhbnVsYXJpdHkgKCksCisJCQkJCXNobWFuYW1lCS8vIG9iamVj
dCBuYW1lCisgICAgKTsKKyAgY29ubi0+cmV2ZXJ0X3RvX3NlbGYgKCk7CisK
KyAgaWYgKGF0dGFjaG1hcCA9PSBOVUxMKQorICAgIHsKKyAgICAgIHN5c3Rl
bV9wcmludGYgKCJmYWlsZWQgdG8gZ2V0IHNobSBhdHRhY2htYXBcbiIpOwor
ICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFTk9NRU07CisgICAgICBVbm1h
cFZpZXdPZkZpbGUgKG1hcHB0cik7CisgICAgICBDbG9zZUhhbmRsZSAoZmls
ZW1hcCk7CisgICAgICAvKiBGSVhNRSBleGl0IHRoZSBtdXRleCAqLworICAg
ICAgcmV0dXJuOworICAgIH0KKworICBzaG1pZF9kcyAqc2htdGVtcCA9IG5l
dyBzaG1pZF9kczsKKyAgaWYgKCFzaG10ZW1wKQorICAgIHsKKyAgICAgIHN5
c3RlbV9wcmludGYgKCJmYWlsZWQgdG8gbWFsbG9jIHNobSBub2RlXG4iKTsK
KyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRU5PTUVNOworICAgICAgVW5t
YXBWaWV3T2ZGaWxlIChtYXBwdHIpOworICAgICAgQ2xvc2VIYW5kbGUgKGZp
bGVtYXApOworICAgICAgQ2xvc2VIYW5kbGUgKGF0dGFjaG1hcCk7CisgICAg
ICAvKiBGSVhNRSBleGl0IG11dGV4ICovCisgICAgICByZXR1cm47CisgICAg
fQorCisgIC8qIGZpbGwgb3V0IHRoZSBub2RlIGRhdGEgKi8KKyAgc2htdGVt
cC0+c2htX3Blcm0uY3VpZCA9IGdldHVpZCAoKTsKKyAgc2htdGVtcC0+c2ht
X3Blcm0udWlkID0gc2htdGVtcC0+c2htX3Blcm0uY3VpZDsKKyAgc2htdGVt
cC0+c2htX3Blcm0uY2dpZCA9IGdldGdpZCAoKTsKKyAgc2htdGVtcC0+c2ht
X3Blcm0uZ2lkID0gc2htdGVtcC0+c2htX3Blcm0uY2dpZDsKKyAgc2htdGVt
cC0+c2htX3Blcm0ubW9kZSA9IHBhcmFtZXRlcnMuaW4uc2htZmxnICYgMHgw
MWZmOworICBzaG10ZW1wLT5zaG1fbHBpZCA9IDA7CisgIHNobXRlbXAtPnNo
bV9uYXR0Y2ggPSAwOworICBzaG10ZW1wLT5zaG1fYXRpbWUgPSAwOworICBz
aG10ZW1wLT5zaG1fZHRpbWUgPSAwOworICBzaG10ZW1wLT5zaG1fY3RpbWUg
PSB0aW1lIChOVUxMKTsKKyAgc2htdGVtcC0+c2htX3NlZ3N6ID0gcGFyYW1l
dGVycy5pbi5zaXplOworICAqKHNobWlkX2RzICopIG1hcHB0ciA9ICpzaG10
ZW1wOworICBzaG10ZW1wLT5maWxlbWFwID0gZmlsZW1hcDsKKyAgc2htdGVt
cC0+YXR0YWNobWFwID0gYXR0YWNobWFwOworICBzaG10ZW1wLT5tYXBwdHIg
PSBtYXBwdHI7CisKKyAgLyogbm8gbmVlZCBmb3IgSW50ZXJsb2NrZWRFeGNo
YW5nZSBoZXJlLCB3ZSdyZSBzZXJpYWxpc2VkIGJ5IHRoZSBnbG9iYWwgbXV0
ZXggKi8KKyAgdGVtcG5vZGUgPSBuZXcgc2htbm9kZTsKKyAgdGVtcG5vZGUt
PnNobWRzID0gc2htdGVtcDsKKyAgdGVtcG5vZGUtPnNobV9pZCA9IChpbnQp
IEludGVybG9ja2VkSW5jcmVtZW50ICgmbmV3X2lkKTsKKyAgdGVtcG5vZGUt
PmtleSA9IHBhcmFtZXRlcnMuaW4ua2V5OworICBtZW1jcHkgKHRlbXBub2Rl
LT5zdHJpbmdidWZrLCBzdHJpbmdidWYsIDI5KTsKKyAgbWVtY3B5ICh0ZW1w
bm9kZS0+c3RyaW5nYnVmZCwgc3RyaW5nYnVmMSwgMjkpOworICB0ZW1wbm9k
ZS0+bmV4dCA9IHNobV9oZWFkOworICBzaG1faGVhZCA9IHRlbXBub2RlOwor
CisgIC8qIHdlIG5vdyBoYXZlIHRoZSBhcmVhIGluIHRoZSBkYWVtb24gbGlz
dCwgb3BlbmVkLiAKKworICBGSVhNRTogbGVhdmUgdGhlIHN5c3RlbSB3aWRl
IHNobSBtdXRleCAqLworCisgIHBhcmFtZXRlcnMub3V0LnNobV9pZCA9IHRl
bXBub2RlLT5zaG1faWQ7CisgIG1lbWNweSAocGFyYW1ldGVycy5vdXQuc3Ry
aW5nYnVmaywgc3RyaW5nYnVmLCAyOSk7CisgIG1lbWNweSAocGFyYW1ldGVy
cy5vdXQuc3RyaW5nYnVmZCwgc3RyaW5nYnVmMSwgMjkpOworaWYgKGNoZWNr
X2FuZF9kdXBfaGFuZGxlIChHZXRDdXJyZW50UHJvY2VzcyAoKSxmcm9tX3By
b2Nlc3NfaGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9r
ZW5faGFuZGxlLAorICAgICAgICAgICAgICBEVVBMSUNBVEVfU0FNRV9BQ0NF
U1MsCisgICAgICAgICAgICAgICAgICAgIHRlbXBub2RlLT5zaG1kcy0+Zmls
ZW1hcCwgJnBhcmFtZXRlcnMub3V0LmZpbGVtYXAsIFRSVUUpICE9IDApCisg
ICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGljYXRpbmcgZmlsZW1h
cCBoYW5kbGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICBo
ZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3NlSGFuZGxl
IChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKy8qIG11dGV4IGV0IGFsICovCity
ZXR1cm47CisgICAgfQoraWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChHZXRD
dXJyZW50UHJvY2VzcyAoKSxmcm9tX3Byb2Nlc3NfaGFuZGxlLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgIERVUExJQ0FURV9TQU1FX0FDQ0VTUywKKyAg
ICAgICAgICB0ZW1wbm9kZS0+c2htZHMtPmF0dGFjaG1hcCwgJnBhcmFtZXRl
cnMub3V0LmF0dGFjaG1hcCwgVFJVRSkgIT0gMCkKKyAgICB7CisgICAgICBw
cmludGYgKCJlcnJvciBkdXBsaWNhdGluZyBhdHRhY2htYXAgaGFuZGxlICgl
bHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgaGVhZGVyLmVycm9y
X2NvZGUgPSBFQUNDRVM7CisgICAgICBDbG9zZUhhbmRsZSAoZnJvbV9wcm9j
ZXNzX2hhbmRsZSk7CisvKiBtb3JlIGNsZWFudXAuLi4geWF5ISAqLworcmV0
dXJuOworICAgIH0KKyAgcmV0dXJuOworfQorI2VuZGlmCkluZGV4OiBzcmMv
d2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfc2htLmgKZGlmZiAtdSAvZGV2L251
bGwgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3NobS5oOjEuMS4yLjEK
LS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDowMCAxOTcwCisrKyBz
cmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfc2htLmgJTW9uIFNlcCAyNCAy
Mjo0OToxMCAyMDAxCkBAIC0wLDAgKzEsODEgQEAKKy8qIGN5Z3NlcnZlcl9z
aG0uaAorCisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKyAgIFdy
aXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJidGNvbGxpbnNAaG90bWFpbC5j
b20+CisKK1RoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworVGhpcyBz
b2Z0d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZQorQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29u
c3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorZGV0YWlscy4g
Ki8KKworI2luY2x1ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9z
b2NrZXQuaD4KKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9y
dC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIKKworI2RlZmlu
ZSBTSE1fQ1JFQVRFIDAKKyNkZWZpbmUgU0hNX1JFQVRUQUNIIDEKKworCitj
bGFzcyBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0IDogcHVibGljIGNsaWVudF9y
ZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgdmlydHVhbCB2b2lkIHNlcnZlICh0
cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubik7CisgIGNsaWVudF9yZXF1ZXN0
X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9nZXQoa2V5X3QsIHNpemVf
dCwgaW50LCBjaGFyIHBzZGJ1Zls0MDk2XSwgcGlkX3QpOworICBjbGllbnRf
cmVxdWVzdF9zaG1fZ2V0OjpjbGllbnRfcmVxdWVzdF9zaG1fZ2V0KCk7Cisg
IGNsaWVudF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9n
ZXQoaW50LHBpZF90KTsKKyAgdW5pb24geworICAgc3RydWN0IHtpbnQgdHlw
ZTsgcGlkX3QgcGlkOyBpbnQgc2htX2lkOyBrZXlfdCBrZXk7IHNpemVfdCBz
aXplOyBpbnQgc2htZmxnOyBjaGFyIHNkX2J1Zls0MDk2XTt9IGluOworICAg
c3RydWN0IHtpbnQgc2htX2lkOyBjaGFyIHN0cmluZ2J1ZmtbMjldLCBzdHJp
bmdidWZkWzI5XTsKKwkgICBIQU5ETEUgZmlsZW1hcDsgSEFORExFIGF0dGFj
aG1hcDsga2V5X3Qga2V5O30gb3V0OworICB9IHBhcmFtZXRlcnM7Cit9Owor
CisjaWYgMAorY2xhc3MgX3NobWF0dGFjaCB7CitwdWJsaWM6CisgIHZvaWQg
KmRhdGE7CisgIGNsYXNzIF9zaG1hdHRhY2ggKm5leHQ7Cit9OworCitjbGFz
cyBzaG1pZF9kcyB7CitwdWJsaWM6CisgIHN0cnVjdCAgIGlwY19wZXJtIHNo
bV9wZXJtOworICBzaXplX3QgICBzaG1fc2Vnc3o7CisgIHBpZF90ICAgIHNo
bV9scGlkOworICBwaWRfdCAgICBzaG1fY3BpZDsKKyAgc2htYXR0X3Qgc2ht
X25hdHRjaDsKKyAgdGltZV90ICAgc2htX2F0aW1lOworICB0aW1lX3QgICBz
aG1fZHRpbWU7CisgIHRpbWVfdCAgIHNobV9jdGltZTsKKyAgSEFORExFIGZp
bGVtYXA7CisgIEhBTkRMRSBhdHRhY2htYXA7CisgIHZvaWQgKm1hcHB0cjsK
KyAgY2xhc3MgX3NobWF0dGFjaCAqYXR0YWNoaGVhZDsKK307CisKK2NsYXNz
IHNobW5vZGUgeworcHVibGljOgorICBjbGFzcyBzaG1pZF9kcyAqIHNobWlk
OworICBjbGFzcyBzaG1ub2RlICpuZXh0OworICBrZXlfdCBrZXk7Cit9Owor
Ly8uLi4uCitzdHJ1Y3Qgc2htaWRfZHMgeworICBzdHJ1Y3QgICBpcGNfcGVy
bSBzaG1fcGVybTsKKyAgc2l6ZV90ICAgc2htX3NlZ3N6OworICBwaWRfdCAg
ICBzaG1fbHBpZDsKKyAgcGlkX3QgICAgc2htX2NwaWQ7CisgIHNobWF0dF90
IHNobV9uYXR0Y2g7CisgIHRpbWVfdCAgIHNobV9hdGltZTsKKyAgdGltZV90
ICAgc2htX2R0aW1lOworICB0aW1lX3QgICBzaG1fY3RpbWU7Cit9OworCit2
b2lkICpzaG1hdChpbnQsIGNvbnN0IHZvaWQgKiwgaW50KTsKK2ludCAgIHNo
bWN0bChpbnQsIGludCwgc3RydWN0IHNobWlkX2RzICopOworaW50ICAgc2ht
ZHQoY29uc3Qgdm9pZCAqKTsKK2ludCAgIHNobWdldChrZXlfdCwgc2l6ZV90
LCBpbnQpOworCisjZW5kaWYKSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2N5
Z3NlcnZlcl90cmFuc3BvcnQuY2MKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dp
bnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5jYzoxLjEuMi4xCi0t
LSAvZGV2L251bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAgMTk3MAorKysgc3Jj
L3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5jYwlNb24gU2Vw
IDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTAsMCArMSwxNTQgQEAKKy8qIGN5Z3Nl
cnZlcl90cmFuc3BvcnQuY2MKKworICAgQ29weXJpZ2h0IDIwMDEgUmVkIEhh
dCBJbmMuCisKKyAgIFdyaXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJidGNv
bGxpbnNAaG90bWFpbC5jb20+CisKKyAgIFRoaXMgZmlsZSBpcyBwYXJ0IG9m
IEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0d2FyZSBpcyBhIGNvcHlyaWdodGVk
IHdvcmsgbGljZW5zZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZQorICAgQ3ln
d2luIGxpY2Vuc2UuICBQbGVhc2UgY29uc3VsdCB0aGUgZmlsZSAiQ1lHV0lO
X0xJQ0VOU0UiIGZvcgorICAgZGV0YWlscy4gKi8KKworI2luY2x1ZGUgPGVy
cm5vLmg+CisjaW5jbHVkZSA8c3RkaW8uaD4KKyNpbmNsdWRlIDx1bmlzdGQu
aD4KKyNpbmNsdWRlIDx3aW5kb3dzLmg+CisjaW5jbHVkZSA8c3lzL3R5cGVz
Lmg+CisjaW5jbHVkZSA8c3lzL3NvY2tldC5oPgorI2luY2x1ZGUgPG5ldGRi
Lmg+CisjaW5jbHVkZSAid2luY2FwLmgiCisjaW5jbHVkZSAiY3lnd2luL2N5
Z3NlcnZlcl90cmFuc3BvcnQuaCIKKworLyogdG8gYWxsb3cgdGhpcyB0byBs
aW5rIGludG8gY3lnd2luIGFuZCB0aGUgLmRsbCwgYSBsaXR0bGUgbWFnaWMg
aXMgbmVlZGVkLiAqLworI2lmbmRlZiBfX09VVFNJREVfQ1lHV0lOX18KKyNp
bmNsdWRlICJ3aW5zdXAuaCIKK2V4dGVybiAiQyIgaW50CitjeWd3aW5fc29j
a2V0IChpbnQgYWYsIGludCB0eXBlLCBpbnQgcHJvdG9jb2wpOworZXh0ZXJu
ICJDIiBpbnQKK2N5Z3dpbl9jb25uZWN0IChpbnQgZmQsCisgICAgICAgICAg
ICAgICAgY29uc3Qgc3RydWN0IHNvY2thZGRyICpuYW1lLAorCQlpbnQgbmFt
ZWxlbik7CitleHRlcm4gIkMiIGludAorY3lnd2luX2FjY2VwdCAoaW50IGZk
LCBzdHJ1Y3Qgc29ja2FkZHIgKnBlZXIsIGludCAqbGVuKTsKK2V4dGVybiAi
QyIgaW50CitjeWd3aW5fbGlzdGVuIChpbnQgZmQsIGludCBiYWNrbG9nKTsK
K2V4dGVybiAiQyIgaW50CitjeWd3aW5fYmluZCAoaW50IGZkLCBjb25zdCBz
dHJ1Y3Qgc29ja2FkZHIgKm15X2FkZHIsIGludCBhZGRybGVuKTsKKworI2Vs
c2UKKyNkZWZpbmUgY3lnd2luX2FjY2VwdChBLEIsQykgIDo6YWNjZXB0KEEs
QixDKQorI2RlZmluZSBjeWd3aW5fc29ja2V0KEEsQixDKSAgOjpzb2NrZXQo
QSxCLEMpCisjZGVmaW5lIGN5Z3dpbl9saXN0ZW4oQSxCKSAgICA6Omxpc3Rl
bihBLEIpCisjZGVmaW5lIGN5Z3dpbl9iaW5kKEEsQixDKSAgICA6OmJpbmQo
QSxCLEMpCisjZGVmaW5lIGN5Z3dpbl9jb25uZWN0KEEsQixDKSA6OmNvbm5l
Y3QoQSxCLEMpCisjZGVmaW5lIGRlYnVnX3ByaW50ZiBwcmludGYKKyNlbmRp
ZgorCisvKiBUaGUgZmFjdG9yeSAqLworY2xhc3MgdHJhbnNwb3J0X2xheWVy
X2Jhc2UgKmNyZWF0ZV9zZXJ2ZXJfdHJhbnNwb3J0KCkKK3sKKyAgdHJhbnNw
b3J0X2xheWVyX2Jhc2UgKnRlbXA7CisgIC8qIGN1cnJlbnRseSB0aGVyZSBp
cyBvbmx5IHRoZSBiYXNlIGNsYXNzISAqLworICBpZiAod2luY2FwLmlzX3dp
bm50ICgpKQorICAgIHRlbXAgPSBuZXcgdHJhbnNwb3J0X2xheWVyX3BpcGVz
ICgpOworICBlbHNlCisgICAgdGVtcCA9IG5ldyB0cmFuc3BvcnRfbGF5ZXJf
YmFzZSAoKTsKKyAgcmV0dXJuIHRlbXA7Cit9CisKKwordHJhbnNwb3J0X2xh
eWVyX2Jhc2U6OnRyYW5zcG9ydF9sYXllcl9iYXNlIChpbnQgbmV3ZmQpOiBm
ZChuZXdmZCkKK3sKKyAgLyogVGhpcyBtYXkgbm90IGJlIG5lZWRlZCBpbiB0
aGlzIGNvbnN0cnVjdG9yIC0gaXQncyBvbmx5IHVzZWQKKyAgICogd2hlbiBj
cmVhdGluZyBhIGNvbm5lY3Rpb24gdmlhIGJpbmQgb3IgY29ubmVjdAorICAg
Ki8KKyAgc29ja2RldGFpbHMuc2FfZmFtaWx5ID0gQUZfVU5JWDsKKyAgc3Ry
Y3B5IChzb2NrZGV0YWlscy5zYV9kYXRhLCAiL3RtcC9jeWdkYWVtbyIpOwor
ICBzZGxlbiA9IHN0cmxlbihzb2NrZGV0YWlscy5zYV9kYXRhKSArIHNpemVv
Zihzb2NrZGV0YWlscy5zYV9mYW1pbHkpOworfTsKKwordHJhbnNwb3J0X2xh
eWVyX2Jhc2U6OnRyYW5zcG9ydF9sYXllcl9iYXNlICgpOiBmZCAoLTEpCit7
CisgIHNvY2tkZXRhaWxzLnNhX2ZhbWlseSA9IEFGX1VOSVg7CisgIHN0cmNw
eSAoc29ja2RldGFpbHMuc2FfZGF0YSwgIi90bXAvY3lnZGFlbW8iKTsKKyAg
c2RsZW4gPSBzdHJsZW4oc29ja2RldGFpbHMuc2FfZGF0YSkgKyBzaXplb2Yo
c29ja2RldGFpbHMuc2FfZmFtaWx5KTsKK30KKwordm9pZAordHJhbnNwb3J0
X2xheWVyX2Jhc2U6Omxpc3RlbiAoKQoreworICAvKiB3ZSB3YW50IGEgdGhy
ZWFkIHBvb2wgYmFzZWQgYXBwcm9hY2guICovCisgIGlmICgoZmQgPSBjeWd3
aW5fc29ja2V0IChBRl9VTklYLCBTT0NLX1NUUkVBTSwwKSkgPCAwKQorICAg
IHByaW50ZiAoIlNvY2tldCBub3QgY3JlYXRlZCBlcnJvciAlZFxuIiwgZXJy
bm8pOworICBpZiAoY3lnd2luX2JpbmQoZmQsICZzb2NrZGV0YWlscywgc2Rs
ZW4pKQorICAgIHByaW50ZiAoIkJpbmQgZG9lc24ndCBsaWtlIHlvdS4gVHNr
IFRzay4gQmluZCBzYWlkICVkXG4iLCBlcnJubyk7CisgIGlmIChjeWd3aW5f
bGlzdGVuKGZkLCA1KSA8IDApCisgICAgcHJpbnRmICgiQW5kIHRoZSBPUyBq
dXN0IGlzbid0IGxpc3RlbmluZywgYWxsIGl0IHNheXMgaXMgJWRcbiIsIGVy
cm5vKTsKK30KKworY2xhc3MgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKgordHJh
bnNwb3J0X2xheWVyX2Jhc2U6OmFjY2VwdCAoKQoreworICAvKiBGSVhNRTog
Y2hlY2sgd2UgaGF2ZSBsaXN0ZW5lZCAqLworICBpbnQgbmV3X2ZkOworCisg
IGlmICgobmV3X2ZkID0gY3lnd2luX2FjY2VwdChmZCwgJnNvY2tkZXRhaWxz
LCAmc2RsZW4pKSA8IDApCisgICAgeworICAgICAgcHJpbnRmICgiTnVwLCBj
b3VsZCcgYWNjZXB0LiAlZFxuIixlcnJubyk7CisgICAgICByZXR1cm4gTlVM
TDsKKyAgICB9CisgIAorICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqbmV3X2Nv
bm4gPSBuZXcgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKG5ld19mZCk7CisKKyAg
cmV0dXJuIG5ld19jb25uOyAgCisKK30KKwordm9pZAordHJhbnNwb3J0X2xh
eWVyX2Jhc2U6OmNsb3NlKCkKK3sKKyAgLyogRklYTUUgLSBhcmUgd2Ugb3Bl
bj8gKi8KKyAgOjpjbG9zZSAoZmQpOworfQorCitzc2l6ZV90Cit0cmFuc3Bv
cnRfbGF5ZXJfYmFzZTo6cmVhZCAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQor
eworICAvKiBGSVhNRTogYXJlIHdlIG9wZW4/ICovCisgIHJldHVybiA6OnJl
YWQgKGZkLCBidWYsIGxlbik7Cit9CisKK3NzaXplX3QKK3RyYW5zcG9ydF9s
YXllcl9iYXNlOjp3cml0ZSAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQorewor
ICAvKiBGSVhNRTogYXJlIHdlIG9wZW4/ICovCisgIHJldHVybiA6OndyaXRl
IChmZCwgYnVmLCBsZW4pOworfQorCitib29sCit0cmFuc3BvcnRfbGF5ZXJf
YmFzZTo6Y29ubmVjdCAoKQoreworICAvKiBhcmUgd2UgYWxyZWFkeSBjb25u
ZWN0ZWQ/ICovCisgIGlmIChmZCAhPSAtMSkKKyAgICByZXR1cm4gZmFsc2U7
CisgIGZkID0gY3lnd2luX3NvY2tldCAoQUZfVU5JWCwgU09DS19TVFJFQU0s
IDApOworICBpZiAoY3lnd2luX2Nvbm5lY3QgKGZkLCAmc29ja2RldGFpbHMs
IHNkbGVuKSA8IDApCisgICAgeworICAgICAgZGVidWdfcHJpbnRmKCJjbGll
bnQgY29ubmVjdCBmYWlsdXJlICVkXG4iLCBlcnJubyk7CisgICAgICA6OmNs
b3NlIChmZCk7CisgICAgICByZXR1cm4gZmFsc2U7CisgICAgfQorICByZXR1
cm4gdHJ1ZTsKK30KKwordm9pZAordHJhbnNwb3J0X2xheWVyX2Jhc2U6Omlt
cGVyc29uYXRlX2NsaWVudCAoKQoreworfQorCit2b2lkCit0cmFuc3BvcnRf
bGF5ZXJfYmFzZTo6cmV2ZXJ0X3RvX3NlbGYgKCkKK3sKK30KKwpJbmRleDog
c3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydF9waXBlcy5j
YwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2
ZXJfdHJhbnNwb3J0X3BpcGVzLmNjOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJ
VGh1IEphbiAgMSAwMTowMDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dp
bi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmNjCU1vbiBTZXAgMjQgMjI6
NDk6MTAgMjAwMQpAQCAtMCwwICsxLDE5NSBAQAorLyogY3lnc2VydmVyX3Ry
YW5zcG9ydF9waXBlcy5jYworCisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0
IEluYy4KKworICAgV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29s
bGluc0Bob3RtYWlsLmNvbT4KKworICAgVGhpcyBmaWxlIGlzIHBhcnQgb2Yg
Q3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQg
d29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisgICBDeWd3
aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdXSU5f
TElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisjaW5jbHVkZSA8ZXJy
bm8uaD4KKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1ZGUgPHVuaXN0ZC5o
PgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNpbmNsdWRlIDxzeXMvdHlwZXMu
aD4KKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CisjaW5jbHVkZSA8bmV0ZGIu
aD4KKyNpbmNsdWRlICJ3aW5jYXAuaCIKKyNpbmNsdWRlICJjeWd3aW4vY3ln
c2VydmVyX3RyYW5zcG9ydC5oIgorCisvKiB0byBhbGxvdyB0aGlzIHRvIGxp
bmsgaW50byBjeWd3aW4gYW5kIHRoZSAuZGxsLCBhIGxpdHRsZSBtYWdpYyBp
cyBuZWVkZWQuICovCisjaWZuZGVmIF9fT1VUU0lERV9DWUdXSU5fXworI2lu
Y2x1ZGUgIndpbnN1cC5oIgorI2Vsc2UKKyNkZWZpbmUgZGVidWdfcHJpbnRm
IHByaW50ZgorI2VuZGlmCisKK3RyYW5zcG9ydF9sYXllcl9waXBlczo6dHJh
bnNwb3J0X2xheWVyX3BpcGVzIChIQU5ETEUgbmV3X3BpcGUpCit7CisgIHBp
cGUgPSBuZXdfcGlwZTsKKyAgaWYgKGluaXRlZCAhPSB0cnVlKQorICAgIGlu
aXRfc2VjdXJpdHkoKTsKK307CisKK3RyYW5zcG9ydF9sYXllcl9waXBlczo6
dHJhbnNwb3J0X2xheWVyX3BpcGVzICgpIAoreworICBwaXBlID0gTlVMTDsK
KyAgc3RyY3B5KHBpcGVfbmFtZSwgIlxcXFwuXFxwaXBlXFxjeWd3aW5fbHBj
Iik7CisgIGlmIChpbml0ZWQgIT0gdHJ1ZSkKKyAgICBpbml0X3NlY3VyaXR5
KCk7Cit9CisKKwordm9pZAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjppbml0
X3NlY3VyaXR5KCkKK3sKKyAgLyogRklYTUU6IHB0aHJlYWRfb25jZSBvciBl
cXVpdmFsZW50IG5lZWRlZCAqLworICBJbml0aWFsaXplU2VjdXJpdHlEZXNj
cmlwdG9yICgmc2QsIFNFQ1VSSVRZX0RFU0NSSVBUT1JfUkVWSVNJT04pOwor
ICBTZXRTZWN1cml0eURlc2NyaXB0b3JEYWNsICgmc2QsIFRSVUUsIDAsIEZB
TFNFKTsKKworICBzZWNfbm9uZV9uaWgubkxlbmd0aCA9IHNlY19hbGxfbmlo
Lm5MZW5ndGggPSBzaXplb2YgKFNFQ1VSSVRZX0FUVFJJQlVURVMpOworICBz
ZWNfbm9uZV9uaWguYkluaGVyaXRIYW5kbGUgPSBzZWNfYWxsX25paC5iSW5o
ZXJpdEhhbmRsZSA9IEZBTFNFOworICBzZWNfbm9uZV9uaWgubHBTZWN1cml0
eURlc2NyaXB0b3IgPSBOVUxMOworICBzZWNfYWxsX25paC5scFNlY3VyaXR5
RGVzY3JpcHRvciA9ICZzZDsKKyAgaW5pdGVkID0gdHJ1ZTsKK30KKwordm9p
ZAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjpsaXN0ZW4gKCkKK3sKKyAgLyog
bm8tb3AgKi8KK30KKworY2xhc3MgdHJhbnNwb3J0X2xheWVyX3BpcGVzICoK
K3RyYW5zcG9ydF9sYXllcl9waXBlczo6YWNjZXB0ICgpCit7CisgIGlmIChw
aXBlKQorICAgIHsKKyAgICAgIGRlYnVnX3ByaW50ZiAoIkFscmVhZHkgaGF2
ZSBhIHBpcGUgaW4gdGhpcyAlcFxuIix0aGlzKTsKKyAgICAgIHJldHVybiBO
VUxMOworICAgIH0KKworICBwaXBlID0gQ3JlYXRlTmFtZWRQaXBlIChwaXBl
X25hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgIFBJUEVfQUNDRVNT
X0RVUExFWCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgUElQRV9UWVBF
X0JZVEUgfCBQSVBFX1dBSVQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
IFBJUEVfVU5MSU1JVEVEX0lOU1RBTkNFUywKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgMCwgMCwgMTAwMCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgJnNlY19hbGxfbmloICk7CisgIGlmIChwaXBlID09IElOVkFMSURfSEFO
RExFX1ZBTFVFKQorICAgIHsKKyAgICAgIGRlYnVnX3ByaW50ZiAoImVycm9y
IGNyZWF0aW5nIHBpcGUgKCVsdSlcbi4iLCBHZXRMYXN0RXJyb3IgKCkpOwor
ICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIGlmICggIUNvbm5lY3RO
YW1lZFBpcGUgKCBwaXBlLCBOVUxMICkgJiYKKyAgICAgR2V0TGFzdEVycm9y
ICgpICE9IEVSUk9SX1BJUEVfQ09OTkVDVEVEKQorICAgIHsKKyAgICAgIHBy
aW50ZiAoImVycm9yIGNvbm5lY3RpbmcgdG8gcGlwZSAoJWx1KVxuLiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICBDbG9zZUhhbmRsZSAocGlwZSk7Cisg
ICAgICBwaXBlID0gTlVMTDsKKyAgICAgIHJldHVybiBOVUxMOworICAgIH0K
KyAgCisgIHRyYW5zcG9ydF9sYXllcl9waXBlcyAqbmV3X2Nvbm4gPSBuZXcg
dHJhbnNwb3J0X2xheWVyX3BpcGVzIChwaXBlKTsKKyAgcGlwZSA9IE5VTEw7
CisKKyAgcmV0dXJuIG5ld19jb25uOyAgCit9CisKK3ZvaWQKK3RyYW5zcG9y
dF9sYXllcl9waXBlczo6Y2xvc2UoKQoreworICBpZiAocGlwZSAmJiBwaXBl
ICE9IElOVkFMSURfSEFORExFX1ZBTFVFKQorICAgIHsKKyAgICAgIEZsdXNo
RmlsZUJ1ZmZlcnMgKHBpcGUpOworICAgICAgRGlzY29ubmVjdE5hbWVkUGlw
ZSAocGlwZSk7CisgICAgICBDbG9zZUhhbmRsZSAocGlwZSk7CisgICAgfQor
fQorCitzc2l6ZV90Cit0cmFuc3BvcnRfbGF5ZXJfcGlwZXM6OnJlYWQgKGNo
YXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKyAgRFdPUkQgYnl0ZXNfcmVhZCwg
cmM7CisgIGlmICghcGlwZSB8fCBwaXBlID09IElOVkFMSURfSEFORExFX1ZB
TFVFKQorICAgIHJldHVybiAtMTsKKworICByYyA9IFJlYWRGaWxlIChwaXBl
LCBidWYsIGxlbiwgJmJ5dGVzX3JlYWQsIE5VTEwpOworICBpZiAoIXJjKQor
ICAgIHsKKyAgICAgIGRlYnVnX3ByaW50ZiAoImVycm9yIHJlYWRpbmcgZnJv
bSBwaXBlICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgcmV0
dXJuIC0xOworICAgIH0KKyAgcmV0dXJuIGJ5dGVzX3JlYWQ7Cit9CisKK3Nz
aXplX3QKK3RyYW5zcG9ydF9sYXllcl9waXBlczo6d3JpdGUgKGNoYXIgKmJ1
Ziwgc2l6ZV90IGxlbikKK3sKKyAgRFdPUkQgYnl0ZXNfd3JpdHRlbiwgcmM7
CisgIGlmICghcGlwZSB8fCBwaXBlID09IElOVkFMSURfSEFORExFX1ZBTFVF
KQorICAgIHJldHVybiAtMTsKKworICByYyA9IFdyaXRlRmlsZSAocGlwZSwg
YnVmLCBsZW4sICZieXRlc193cml0dGVuLCBOVUxMKTsKKyAgaWYgKCFyYykK
KyAgICB7CisgICAgICBkZWJ1Z19wcmludGYgKCJlcnJvciB3cml0aW5nIHRv
IHBpcGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICByZXR1
cm4gLTE7CisgICAgfQorICByZXR1cm4gYnl0ZXNfd3JpdHRlbjsKK30KKwor
Ym9vbAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjpjb25uZWN0ICgpCit7Cisg
IGlmIChwaXBlICYmIHBpcGUgIT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisg
ICAgeworICAgICAgZGVidWdfcHJpbnRmICgiQWxyZWFkeSBoYXZlIGEgcGlw
ZSBpbiB0aGlzICVwXG4iLHRoaXMpOworICAgICAgcmV0dXJuIGZhbHNlOwor
ICAgIH0KKworICB3aGlsZSAoMSkKKyAgICB7CisgICAgICBwaXBlID0gQ3Jl
YXRlRmlsZSAocGlwZV9uYW1lLAorCQkgICAgICAgICBHRU5FUklDX1JFQUQg
fCBHRU5FUklDX1dSSVRFLAorCQkgICAgICAgICBGSUxFX1NIQVJFX1JFQUQg
fCBGSUxFX1NIQVJFX1dSSVRFLAorCQkgICAgICAgICAmc2VjX2FsbF9uaWgs
CisJCSAgICAgICAgIE9QRU5fRVhJU1RJTkcsCisJCSAgICAgICAgIDAsIE5V
TEwpOworCisgICAgICBpZiAocGlwZSAhPSBJTlZBTElEX0hBTkRMRV9WQUxV
RSkKKwkvKiBnb3QgdGhlIHBpcGUgKi8KKyAgICAgICAgcmV0dXJuIHRydWU7
CisKKyAgICAgIGlmIChHZXRMYXN0RXJyb3IgKCkgIT0gRVJST1JfUElQRV9C
VVNZKQorICAgICAgICB7CisgICAgICAgICAgZGVidWdfcHJpbnRmICgiRXJy
b3Igb3BlbmluZyB0aGUgcGlwZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgp
KTsKKyAgICAgICAgICBwaXBlID0gTlVMTDsKKyAgICAgICAgICByZXR1cm4g
ZmFsc2U7CisgICAgICAgIH0KKyAgICAgIGlmICghV2FpdE5hbWVkUGlwZSAo
cGlwZV9uYW1lLCAyMDAwMCkpCisgICAgICAgIGRlYnVnX3ByaW50ZiAoICJl
cnJvciBjb25uZWN0aW5nIHRvIHNlcnZlciBwaXBlIGFmdGVyIDIwIHNlY29u
ZHMgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSApOworICAgICAgLyogV2Ug
bG9vcCBoZXJlLCBiZWNhdXNlIHRoZSBwaXBlIGV4aXN0cyBidXQgaXMgYnVz
eS4gSWYgaXQgZG9lc24ndCBleGlzdAorICAgICAgICogdGhlICE9IEVSUk9S
X1BJUEVfQlVTWSB3aWxsIGNhdGNoIGl0LgorICAgICAgICovIAorICAgIH0K
K30KKwordm9pZAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjppbXBlcnNvbmF0
ZV9jbGllbnQgKCkKK3sKKyAgaWYgKHBpcGUgJiYgcGlwZSAhPSBJTlZBTElE
X0hBTkRMRV9WQUxVRSkKKyAgICBJbXBlcnNvbmF0ZU5hbWVkUGlwZUNsaWVu
dCAocGlwZSk7CisgIGRlYnVnX3ByaW50ZigiSSBhbSB3aG8geW91IGFyZVxu
Iik7Cit9CisKK3ZvaWQKK3RyYW5zcG9ydF9sYXllcl9waXBlczo6cmV2ZXJ0
X3RvX3NlbGYgKCkKK3sKKyAgUmV2ZXJ0VG9TZWxmICgpOyAKKyAgZGVidWdf
cHJpbnRmKCJJIGFtIHdobyBJIHlhbVxuIik7Cit9CisKSW5kZXg6IHNyYy93
aW5zdXAvY3lnd2luL2N5Z3dpbi5kaW4KZGlmZiAtdSBzcmMvd2luc3VwL2N5
Z3dpbi9jeWd3aW4uZGluOjEuMzcgc3JjL3dpbnN1cC9jeWd3aW4vY3lnd2lu
LmRpbjoxLjM3LjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3aW4vY3lnd2luLmRp
bjoxLjM3CVdlZCBTZXAgMTkgMTE6MDc6MTAgMjAwMQorKysgc3JjL3dpbnN1
cC9jeWd3aW4vY3lnd2luLmRpbglNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEK
QEAgLTEyMjAsMyArMTIyMCw3IEBACiBfYWNsdG90ZXh0ID0gYWNsdG90ZXh0
CiBhY2xmcm9tdGV4dAogX2FjbGZyb210ZXh0ID0gYWNsZnJvbXRleHQKK2Z0
b2sKK3NobWF0CitzaG1jdGwKK3NobWdldApJbmRleDogc3JjL3dpbnN1cC9j
eWd3aW4vZGNydDAuY2MKZGlmZiAtdSBzcmMvd2luc3VwL2N5Z3dpbi9kY3J0
MC5jYzoxLjExMiBzcmMvd2luc3VwL2N5Z3dpbi9kY3J0MC5jYzoxLjExMi4y
LjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL2RjcnQwLmNjOjEuMTEyCVNhdCBT
ZXAgMTUgMTQ6MzY6NDMgMjAwMQorKysgc3JjL3dpbnN1cC9jeWd3aW4vZGNy
dDAuY2MJTW9uIFNlcCAyNCAyMjo0OToxMCAyMDAxCkBAIC0zNCw2ICszNCw5
IEBACiAjaW5jbHVkZSAic2hhcmVkX2luZm8uaCIKICNpbmNsdWRlICJjeWd3
aW5fdmVyc2lvbi5oIgogI2luY2x1ZGUgImRsbF9pbml0LmgiCisjaW5jbHVk
ZSA8c3lzL3NvY2tldC5oPgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJf
dHJhbnNwb3J0LmgiCisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlci5oIgog
CiAjZGVmaW5lIE1BWF9BVF9GSUxFX0xFVkVMIDEwCiAKQEAgLTY4Nyw2ICs2
OTAsOCBAQAogCiAgIC8qIEluaXRpYWxpemUgc2lnbmFsL3N1YnByb2Nlc3Mg
aGFuZGxpbmcuICovCiAgIHNpZ3Byb2NfaW5pdCAoKTsKKworICBjeWdzZXJ2
ZXJfaW5pdCAoKTsKIAogICAvKiBDb25uZWN0IHRvIHR0eS4gKi8KICAgdHR5
X2luaXQgKCk7CkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9maGFuZGxlci5o
CmRpZmYgLXUgc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaDoxLjgyIHNy
Yy93aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmg6MS44Mi4yLjEKLS0tIHNyYy93
aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmg6MS44MglTdW4gU2VwIDIzIDA3OjQ0
OjA3IDIwMDEKKysrIHNyYy93aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmgJTW9u
IFNlcCAyNCAyMjo0OToxMCAyMDAxCkBAIC04MzUsNiArODM1LDggQEAKICAg
b2ZmX3QgbHNlZWsgKG9mZl90LCBpbnQpIHsgcmV0dXJuIDA7IH0KICAgc2Vs
ZWN0X3JlY29yZCAqc2VsZWN0X3JlYWQgKHNlbGVjdF9yZWNvcmQgKnMpOwog
ICBpbnQgcmVhZHlfZm9yX3JlYWQgKGludCBmZCwgRFdPUkQgaG93bG9uZywg
aW50IGlnbnJhKTsKKworICBpbnQgY3lnc2VydmVyX2F0dGFjaF90dHkgKEhB
TkRMRSosIEhBTkRMRSopOwogfTsKIAogY2xhc3MgZmhhbmRsZXJfcHR5X21h
c3RlcjogcHVibGljIGZoYW5kbGVyX3R0eV9jb21tb24KSW5kZXg6IHNyYy93
aW5zdXAvY3lnd2luL2ZoYW5kbGVyX3R0eS5jYwpkaWZmIC11IHNyYy93aW5z
dXAvY3lnd2luL2ZoYW5kbGVyX3R0eS5jYzoxLjQ4IHNyYy93aW5zdXAvY3ln
d2luL2ZoYW5kbGVyX3R0eS5jYzoxLjQ4LjIuMQotLS0gc3JjL3dpbnN1cC9j
eWd3aW4vZmhhbmRsZXJfdHR5LmNjOjEuNDgJRnJpIFNlcCAyMSAwNjo1ODoy
OSAyMDAxCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl90dHkuY2MJ
TW9uIFNlcCAyNCAyMjo0OToxMCAyMDAxCkBAIC0yNSw2ICsyNSw5IEBACiAj
aW5jbHVkZSAicGluZm8uaCIKICNpbmNsdWRlICJjeWdoZWFwLmgiCiAjaW5j
bHVkZSAic2hhcmVkX2luZm8uaCIKKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+
CisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnQuaCIKKyNp
bmNsdWRlICJjeWd3aW4vY3lnc2VydmVyLmgiCiAKIC8qIFR0eSBtYXN0ZXIg
c3R1ZmYgKi8KIApAQCAtNTIzLDQyICs1MjYsODkgQEAKICAgICAgIHJldHVy
biAwOwogICAgIH0KIAotICBIQU5ETEUgdHR5X293bmVyID0gT3BlblByb2Nl
c3MgKFBST0NFU1NfRFVQX0hBTkRMRSwgRkFMU0UsCi0JCQkJICAgICBnZXRf
dHR5cCAoKS0+bWFzdGVyX3BpZCk7Ci0gIGlmICh0dHlfb3duZXIgPT0gTlVM
TCkKLSAgICB7Ci0gICAgICB0ZXJtaW9zX3ByaW50ZiAoImNhbid0IG9wZW4g
dHR5ICglZCkgaGFuZGxlIHByb2Nlc3MgJWQiLAotCQkgICAgICB0dHludW0s
IGdldF90dHlwICgpLT5tYXN0ZXJfcGlkKTsKLSAgICAgIF9fc2V0ZXJybm8g
KCk7Ci0gICAgICByZXR1cm4gMDsKLSAgICB9CisgIEhBTkRMRSBmcm9tX21h
c3Rlcl9sb2NhbCwgdG9fbWFzdGVyX2xvY2FsOwogCi0gIEhBTkRMRSBuaDsK
LSAgaWYgKCFEdXBsaWNhdGVIYW5kbGUgKHR0eV9vd25lciwgZ2V0X3R0eXAg
KCktPmZyb21fbWFzdGVyLCBoTWFpblByb2MsICZuaCwgMCwgVFJVRSwKLQkJ
CURVUExJQ0FURV9TQU1FX0FDQ0VTUykpCi0gICAgewotICAgICAgdGVybWlv
c19wcmludGYgKCJjYW4ndCBkdXBsaWNhdGUgaW5wdXQsICVFIik7Ci0gICAg
ICBfX3NldGVycm5vICgpOwotICAgICAgcmV0dXJuIDA7Ci0gICAgfQotICBz
ZXRfaW9faGFuZGxlIChuaCk7Ci0gIFByb3RlY3RIYW5kbGUxIChuaCwgZnJv
bV9wdHkpOwotICB0ZXJtaW9zX3ByaW50ZiAoImR1cGxpY2F0ZWQgZnJvbV9t
YXN0ZXIgJXAtPiVwIGZyb20gdHR5X293bmVyICVwIiwKLQkJICBnZXRfdHR5
cCAoKS0+ZnJvbV9tYXN0ZXIsIG5oLCB0dHlfb3duZXIpOwotICBpZiAoIUR1
cGxpY2F0ZUhhbmRsZSAodHR5X293bmVyLCBnZXRfdHR5cCAoKS0+dG9fbWFz
dGVyLCBoTWFpblByb2MsICZuaCwgMCwgVFJVRSwKLQkJCURVUExJQ0FURV9T
QU1FX0FDQ0VTUykpCi0gICAgewotICAgICAgdGVybWlvc19wcmludGYgKCJj
YW4ndCBkdXBsaWNhdGUgb3V0cHV0LCAlRSIpOwotICAgICAgX19zZXRlcnJu
byAoKTsKLSAgICAgIHJldHVybiAwOwotICAgIH0KLSAgc2V0X291dHB1dF9o
YW5kbGUgKG5oKTsKLSAgUHJvdGVjdEhhbmRsZTEgKG5oLCB0b19wdHkpOwot
ICBDbG9zZUhhbmRsZSAodHR5X293bmVyKTsKKyAgaWYgKCF3aW5jYXAuaGFz
X3NlY3VyaXR5ICgpIHx8CisgICAgICBjeWdzZXJ2ZXJfcnVubmluZyE9Q1lH
U0VSVkVSX09LIHx8CisgICAgICAhY3lnc2VydmVyX2F0dGFjaF90dHkgKCAm
ZnJvbV9tYXN0ZXJfbG9jYWwsICZ0b19tYXN0ZXJfbG9jYWwpKQorICAgIHsK
KyAgICAgIHRlcm1pb3NfcHJpbnRmICgiY2Fubm90IGR1cCBoYW5kbGVzIHZp
YSBzZXJ2ZXIuIHVzaW5nIG9sZCBtZXRob2QuIik7CisKKyAgICAgIEhBTkRM
RSB0dHlfb3duZXIgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19EVVBfSEFORExF
LCBGQUxTRSwKKwkJCQkgICAgICAgICBnZXRfdHR5cCAoKS0+bWFzdGVyX3Bp
ZCk7CisgICAgICBpZiAodHR5X293bmVyID09IE5VTEwpCisgICAgICAgIHsK
KyAgICAgICAgICB0ZXJtaW9zX3ByaW50ZiAoImNhbid0IG9wZW4gdHR5ICgl
ZCkgaGFuZGxlIHByb2Nlc3MgJWQiLAorCSAJICAgICAgICAgIHR0eW51bSwg
Z2V0X3R0eXAgKCktPm1hc3Rlcl9waWQpOworICAgICAgICAgIF9fc2V0ZXJy
bm8gKCk7CisgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKworICAg
ICAgaWYgKCFEdXBsaWNhdGVIYW5kbGUgKHR0eV9vd25lciwgZ2V0X3R0eXAg
KCktPmZyb21fbWFzdGVyLCAKKwkJCSAgaE1haW5Qcm9jLCAmZnJvbV9tYXN0
ZXJfbG9jYWwsIDAsIFRSVUUsCisJCQkgICAgRFVQTElDQVRFX1NBTUVfQUND
RVNTKSkKKyAgICAgICAgeworICAgICAgICAgIHRlcm1pb3NfcHJpbnRmICgi
Y2FuJ3QgZHVwbGljYXRlIGlucHV0LCAlRSIpOworICAgICAgICAgIF9fc2V0
ZXJybm8gKCk7CisgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKyAg
ICAgIHRlcm1pb3NfcHJpbnRmICgiZHVwbGljYXRlZCBmcm9tX21hc3RlciAl
cC0+JXAgZnJvbSB0dHlfb3duZXIgJXAiLAorCQkgICAgIGdldF90dHlwICgp
LT5mcm9tX21hc3RlciwgZnJvbV9tYXN0ZXJfbG9jYWwsIHR0eV9vd25lcik7
CisKKyAgICAgIGlmICghRHVwbGljYXRlSGFuZGxlICh0dHlfb3duZXIsIGdl
dF90dHlwICgpLT50b19tYXN0ZXIsIAorCQkJICBoTWFpblByb2MsICZ0b19t
YXN0ZXJfbG9jYWwsIDAsIFRSVUUsCisJCQkgIERVUExJQ0FURV9TQU1FX0FD
Q0VTUykpCisgICAgICAgIHsKKyAgICAgICAgICB0ZXJtaW9zX3ByaW50ZiAo
ImNhbid0IGR1cGxpY2F0ZSBvdXRwdXQsICVFIik7CisgICAgICAgICAgX19z
ZXRlcnJubyAoKTsKKyAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgfQor
ICAgICAgdGVybWlvc19wcmludGYgKCJkdXBsaWNhdGVkIHRvX21hc3RlciAl
cC0+JXAgZnJvbSB0dHlfb3duZXIgJXAiLAorICAgICAgCQkgICAgIGdldF90
dHlwICgpLT50b19tYXN0ZXIsIHRvX21hc3Rlcl9sb2NhbCwgdHR5X293bmVy
KTsKKyAgICAgIENsb3NlSGFuZGxlICh0dHlfb3duZXIpOworICAgIH0KKwor
ICBzZXRfaW9faGFuZGxlIChmcm9tX21hc3Rlcl9sb2NhbCk7CisgIFByb3Rl
Y3RIYW5kbGUxIChmcm9tX21hc3Rlcl9sb2NhbCwgZnJvbV9wdHkpOworICBz
ZXRfb3V0cHV0X2hhbmRsZSAodG9fbWFzdGVyX2xvY2FsKTsKKyAgUHJvdGVj
dEhhbmRsZTEgKHRvX21hc3Rlcl9sb2NhbCwgdG9fcHR5KTsKIAogICBzZXRf
b3Blbl9zdGF0dXMgKCk7CiAgIHRlcm1pb3NfcHJpbnRmICgidHR5JWQgb3Bl
bmVkIiwgdHR5bnVtKTsKIAorICByZXR1cm4gMTsKK30KKworaW50CitmaGFu
ZGxlcl90dHlfc2xhdmU6OmN5Z3NlcnZlcl9hdHRhY2hfdHR5IChMUEhBTkRM
RSBmcm9tX21hc3Rlcl9wdHIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgTFBIQU5ETEUgdG9fbWFzdGVyX3B0cikKK3sKKyAg
aWYgKCFmcm9tX21hc3Rlcl9wdHIgfHwgIXRvX21hc3Rlcl9wdHIpCisgICAg
cmV0dXJuIDA7CisKKyAgY2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eSAqcmVx
dWVzdCA9IAorCW5ldyBjbGllbnRfcmVxdWVzdF9hdHRhY2hfdHR5ICgoRFdP
UkQpIEdldEN1cnJlbnRQcm9jZXNzSWQgKCksCisJCQkJICAgICAgKERXT1JE
KSBnZXRfdHR5cCAoKS0+bWFzdGVyX3BpZCwKKwkJCQkgICAgICAoSEFORExF
KSBnZXRfdHR5cCAoKS0+ZnJvbV9tYXN0ZXIsCisJCQkJICAgICAgKEhBTkRM
RSkgZ2V0X3R0eXAgKCktPnRvX21hc3Rlcik7CisKKyAgaWYgKGN5Z3NlcnZl
cl9yZXF1ZXN0IChyZXF1ZXN0KSAhPSAwIHx8CisJcmVxdWVzdC0+aGVhZGVy
LmVycm9yX2NvZGUgIT0gMCkKKyAgICByZXR1cm4gMDsKKworLyoKKyAgc3Ry
dWN0IHJlcXVlc3RfYXR0YWNoX3R0eSByZXE7CisgIElOSVRfUkVRVUVTVCAo
cmVxLCBDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hfVFRZKTsKKyAgcmVxLnBp
ZCA9IEdldEN1cnJlbnRQcm9jZXNzSWQgKCk7CisgIHJlcS5tYXN0ZXJfcGlk
ID0gZ2V0X3R0eXAgKCktPm1hc3Rlcl9waWQ7CisgIHJlcS5mcm9tX21hc3Rl
ciA9IGdldF90dHlwICgpLT5mcm9tX21hc3RlcjsKKyAgcmVxLnRvX21hc3Rl
ciA9IGdldF90dHlwICgpLT50b19tYXN0ZXI7CisgIGlmIChjeWdzZXJ2ZXJf
cmVxdWVzdCAoKHN0cnVjdCByZXF1ZXN0X2hlYWRlciopICZyZXEpICE9IDAp
CisgICAgcmV0dXJuIDA7CisqLworICAqZnJvbV9tYXN0ZXJfcHRyID0gcmVx
dWVzdC0+ZnJvbV9tYXN0ZXIgKCk7CisgICp0b19tYXN0ZXJfcHRyID0gcmVx
dWVzdC0+dG9fbWFzdGVyICgpOworICBkZWxldGUgcmVxdWVzdDsKICAgcmV0
dXJuIDE7CiB9CiAKSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2ZvcmsuY2MK
ZGlmZiAtdSBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjOjEuNjggc3JjL3dp
bnN1cC9jeWd3aW4vZm9yay5jYzoxLjY4LjIuMQotLS0gc3JjL3dpbnN1cC9j
eWd3aW4vZm9yay5jYzoxLjY4CVN1biBTZXAgMjMgMDI6NTU6MDIgMjAwMQor
Kysgc3JjL3dpbnN1cC9jeWd3aW4vZm9yay5jYwlNb24gU2VwIDI0IDIyOjQ5
OjEwIDIwMDEKQEAgLTMwMiw2ICszMDIsOSBAQAogICBpZiAoZml4dXBfbW1h
cHNfYWZ0ZXJfZm9yayAoKSkKICAgICBhcGlfZmF0YWwgKCJyZWNyZWF0ZV9t
bWFwc19hZnRlcl9mb3JrX2ZhaWxlZCIpOwogCisgIGlmIChmaXh1cF9zaG1z
X2FmdGVyX2ZvcmsgKCkpCisgICAgYXBpX2ZhdGFsICgicmVjcmVhdGVfc2ht
IGFyZWFzIGFmdGVyIGZvcmsgZmFpbGVkIik7CisKICAgLyogU2V0IHRocmVh
ZCBsb2NhbCBzdHVmZiB0byB6ZXJvLiAgVW5kZXIgV2luZG93cyA5NS85OCB0
aGlzIGlzIHNvbWV0aW1lcwogICAgICBub24temVybywgZm9yIHNvbWUgcmVh
c29uLgogICAgICBGSVhNRTogIFRoZXJlIGlzIGEgbWVtb3J5IGxlYWsgaGVy
ZSBhZnRlciBhIGZvcmsuICovCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9p
cGMuY2MKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vaXBj
LmNjOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDow
MCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9pcGMuY2MJTW9uIFNlcCAy
NCAyMjo0OToxMCAyMDAxCkBAIC0wLDAgKzEsMzkgQEAKKy8qIGlwYy5jYzog
U2luZ2xlIHVuaXggc3BlY2lmaWNhdGlvbiBJUEMgaW50ZXJmYWNlIGZvciBD
eWd3aW4KKworICAgQ29weXJpZ2h0IDIwMDEgUmVkIEhhdCwgSW5jLgorCisg
ICBPcmlnaW5hbGx5IHdyaXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJvYmVy
dC5jb2xsaW5zQGhvdG1haWwuY29tPgorCisgICBUaGlzIGZpbGUgaXMgcGFy
dCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdhcmUgaXMgYSBjb3B5cmln
aHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUKKyAg
IEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQgdGhlIGZpbGUgIkNZ
R1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMuICovCisKKyNpbmNsdWRl
ICJ3aW5zdXAuaCIKKyNpbmNsdWRlIDxzeXMvaXBjLmg+CisjaW5jbHVkZSA8
c3lzL3N0YXQuaD4KKworZXh0ZXJuICJDIgoreworCisvKiBOb3Rlczogd2Ug
cmV0dXJuIGEgdmFsaWQga2V5IGV2ZW4gaWYgaWQncyBsb3cgb3JkZXIgOCBi
aXRzIGFyZSAwLiAqLwora2V5X3QKK2Z0b2soY29uc3QgY2hhciAqcGF0aCwg
aW50IGlkKQoreworICBzdHJ1Y3Qgc3RhdCBzdGF0YnVmOworICBpZiAoc3Rh
dChwYXRoLCAmc3RhdGJ1ZikpCisgICAgeworICAgICAgLyogc3RhdCBzZXQg
dGhlIGFwcHJvcHJpYXRlIGVycm5vIGZvciB1cyAqLworICAgICAgcmV0dXJu
IChrZXlfdCkgLTE7CisgICAgfQorICAKKyAgLyogZGV2X3QgaXMgc2hvcnQg
Zm9yIGN5Z3dpbiAKKyAgICogaW5vX3QgaXMgbG9uZyBmb3IgY3lnd2luCisg
ICAqIGFuZCB3ZSBuZWVkIDggYml0cyBmb3IgdGhlIGlkLgorICAgKiB0aHVz
IGtleV90IGlzIGxvbmcgbG9uZy4gCisgICAqLworICByZXR1cm4gKChsb25n
IGxvbmcpIHN0YXRidWYuc3RfZGV2IDw8ICg1KjgpKSB8IChzdGF0YnVmLnN0
X2lubyA8PCAoOCkgKSB8IChpZCAmIDB4MDBmZik7Cit9CisKK30KSW5kZXg6
IHNyYy93aW5zdXAvY3lnd2luL3BpbmZvLmgKZGlmZiAtdSBzcmMvd2luc3Vw
L2N5Z3dpbi9waW5mby5oOjEuMzEgc3JjL3dpbnN1cC9jeWd3aW4vcGluZm8u
aDoxLjMxLjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3aW4vcGluZm8uaDoxLjMx
CVRodSBTZXAgMTMgMDM6NDY6MzYgMjAwMQorKysgc3JjL3dpbnN1cC9jeWd3
aW4vcGluZm8uaAlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTIwMSw2
ICsyMDEsOCBAQAogCiAvKiBGb3IgbW1hcHMgYWNyb3NzIGZvcmsoKS4gKi8K
IGludCBfX3N0ZGNhbGwgZml4dXBfbW1hcHNfYWZ0ZXJfZm9yayAoKTsKKy8q
IGZvciBzaG0gYXJlYXMgYWNyb3NzIGZvcmsgKCkuICovCitpbnQgX19zdGRj
YWxsIGZpeHVwX3NobXNfYWZ0ZXJfZm9yayAoKTsKIAogdm9pZCBfX3N0ZGNh
bGwgZmlsbF9ydXNhZ2UgKHN0cnVjdCBydXNhZ2UgKiwgSEFORExFKTsKIHZv
aWQgX19zdGRjYWxsIGFkZF9ydXNhZ2UgKHN0cnVjdCBydXNhZ2UgKiwgc3Ry
dWN0IHJ1c2FnZSAqKTsKSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL3NlY3Vy
aXR5LmgKZGlmZiAtdSBzcmMvd2luc3VwL2N5Z3dpbi9zZWN1cml0eS5oOjEu
MTYgc3JjL3dpbnN1cC9jeWd3aW4vc2VjdXJpdHkuaDoxLjE2LjQuMQotLS0g
c3JjL3dpbnN1cC9jeWd3aW4vc2VjdXJpdHkuaDoxLjE2CVNhdCBTZXAgIDgg
MDc6MzI6MDUgMjAwMQorKysgc3JjL3dpbnN1cC9jeWd3aW4vc2VjdXJpdHku
aAlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTIwNCwzICsyMDQsNSBA
QAogCiBpbnQgX19zdGRjYWxsIE5UUmVhZEVBIChjb25zdCBjaGFyICpmaWxl
LCBjb25zdCBjaGFyICphdHRybmFtZSwgY2hhciAqYnVmLCBpbnQgbGVuKTsK
IEJPT0wgX19zdGRjYWxsIE5UV3JpdGVFQSAoY29uc3QgY2hhciAqZmlsZSwg
Y29uc3QgY2hhciAqYXR0cm5hbWUsIGNvbnN0IGNoYXIgKmJ1ZiwgaW50IGxl
bik7CitQU0VDVVJJVFlfREVTQ1JJUFRPUiBhbGxvY19zZCAodWlkX3QgdWlk
LCBnaWRfdCBnaWQsIGNvbnN0IGNoYXIgKmxvZ3NydiwgaW50IGF0dHJpYnV0
ZSwKKyAgICAgICAgICBQU0VDVVJJVFlfREVTQ1JJUFRPUiBzZF9yZXQsIERX
T1JEICpzZF9zaXplX3JldCk7CkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9z
aG0uY2MKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vc2ht
LmNjOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDow
MCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9zaG0uY2MJTW9uIFNlcCAy
NCAyMjo0OToxMSAyMDAxCkBAIC0wLDAgKzEsNDQ2IEBACisvKiBzaG0uY2M6
IFNpbmdsZSB1bml4IHNwZWNpZmljYXRpb24gSVBDIGludGVyZmFjZSBmb3Ig
Q3lnd2luCisKKyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQsIEluYy4KKwor
ICAgT3JpZ2luYWxseSB3cml0dGVuIGJ5IFJvYmVydCBDb2xsaW5zIDxyb2Jl
cnQuY29sbGluc0Bob3RtYWlsLmNvbT4KKworICAgVGhpcyBmaWxlIGlzIHBh
cnQgb2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJp
Z2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisg
ICBDeWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJD
WUdXSU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisjaW5jbHVk
ZSAid2luc3VwLmgiCisjaW5jbHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRl
IDxlcnJuby5oPgorI2luY2x1ZGUgImN5Z2Vycm5vLmgiCisjaW5jbHVkZSA8
dW5pc3RkLmg+CisjaW5jbHVkZSAic2VjdXJpdHkuaCIKKyNpbmNsdWRlICJm
aGFuZGxlci5oIgorI2luY2x1ZGUgImR0YWJsZS5oIgorI2luY2x1ZGUgImN5
Z2hlYXAuaCIKKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1ZGUgInRocmVh
ZC5oIgorI2luY2x1ZGUgPHN5cy9zaG0uaD4KKyNpbmNsdWRlICJwZXJwcm9j
ZXNzLmgiCisjaW5jbHVkZSAiY3lnc2VydmVyX3NobS5oIgorCisvLyBGSVhN
RSBJUyBUSElTIENPUlJFQ1QKKy8qIEltcGxlbWVudGF0aW9uIG5vdGVzOiBX
ZSB1c2UgdHdvIHNoYXJlZCBtZW1vcnkgcmVnaW9ucyBwZXIga2V5OgorICog
T25lIGZvciB0aGUgY29udHJvbCBzdHJ1Y3R1cmUsIGFuZCBvbmUgZm9yIHRo
ZSBzaGFyZWQgbWVtb3J5LgorICogV2hpbGUgdGhpcyBoYXMgYSBoaWdoZXIg
b3ZlcmhlYWQgdGhhbSBhIHNpbmdsZSBzaGFyZWQgYXJlYSwKKyAqIEl0IGFs
bG93cyBtb3JlIGZsZXhhYmlsaXR5LiBBcyB0aGUgZW50aXJlIGNvZGUgaXMg
dHJhbnNwYXJlbnQgdG8gdGhlIHVzZXIKKyAqIFdlIGNhbiBtZXJnZSB0aGVz
ZSBpbiB0aGUgZnV0dXJlIHNob3VsZCBpdCBiZSBuZWVkZWQuCisgKi8KK2V4
dGVybiAiQyIgc2l6ZV90CitnZXRzeXN0ZW1hbGxvY2dyYW51bGFyaXR5ICgp
Cit7CisgIFNZU1RFTV9JTkZPIHN5c2luZm87CisgIHN0YXRpYyBzaXplX3Qg
YnVmZmVyX29mZnNldCA9IDA7CisgIGlmIChidWZmZXJfb2Zmc2V0KQorICAg
IHJldHVybiBidWZmZXJfb2Zmc2V0OworICBHZXRTeXN0ZW1JbmZvICgmc3lz
aW5mbyk7CisgIGJ1ZmZlcl9vZmZzZXQgPSBzeXNpbmZvLmR3QWxsb2NhdGlv
bkdyYW51bGFyaXR5OworICByZXR1cm4gYnVmZmVyX29mZnNldDsKK30KKwor
c3RhdGljIHNobW5vZGUgKnNobV9oZWFkID0gTlVMTDsKKworc3RhdGljIHNo
bW5vZGUgKgorYnVpbGRfaW5wcm9jZXNzX3NobWRzIChIQU5ETEUgaGZpbGVt
YXAsIEhBTkRMRSBoYXR0YWNobWFwLCBrZXlfdCBrZXksCisJCSAgICAgICBp
bnQgc2htX2lkKQoreworICBIQU5ETEUgZmlsZW1hcCA9IGhmaWxlbWFwOwor
ICB2b2lkICptYXBwdHIgPSBNYXBWaWV3T2ZGaWxlIChmaWxlbWFwLCBGSUxF
X01BUF9XUklURSwgMCwgMCwgMCk7CisKKyAgaWYgKCFtYXBwdHIpCisgICAg
eworICAgICAgQ2xvc2VIYW5kbGUgKGhmaWxlbWFwKTsKKyAgICAgIENsb3Nl
SGFuZGxlIChoYXR0YWNobWFwKTsKKyAgICAgIC8vRklYTUU6IGNsb3NlIGZp
bGVtYXAgYW5kIGZyZWUgdGhlIG11dGV4CisgICAgICAvKiB3ZSBjb3VsZG4n
dCBhY2Nlc3MgdGhlIG1hcHBlZCBhcmVhIHdpdGggdGhlIHJlcXVlc3RlZCBw
ZXJtaXNzaW9ucyAqLworICAgICAgc2V0X2Vycm5vIChFQUNDRVMpOworICAg
ICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIC8qIE5vdyBnZXQgdGhlIHVz
ZXIgZGF0YSAqLworICBIQU5ETEUgYXR0YWNobWFwID0gaGF0dGFjaG1hcDsK
KyAgc2htaWRfZHMgKnNobXRlbXAgPSBuZXcgc2htaWRfZHM7CisgIGlmICgh
c2htdGVtcCkKKyAgICB7CisgICAgICBzeXN0ZW1fcHJpbnRmICgiZmFpbGVk
IHRvIG1hbGxvYyBzaG0gbm9kZVxuIik7CisgICAgICBzZXRfZXJybm8gKEVO
T01FTSk7CisgICAgICBVbm1hcFZpZXdPZkZpbGUgKG1hcHB0cik7CisgICAg
ICBDbG9zZUhhbmRsZSAoZmlsZW1hcCk7CisgICAgICBDbG9zZUhhbmRsZSAo
YXR0YWNobWFwKTsKKyAgICAgIC8qIGV4aXQgbXV0ZXggKi8KKyAgICAgIHJl
dHVybiBOVUxMOworICAgIH0KKworICAvKiBnZXQgdGhlIHN5c3RlbSBub2Rl
IGRhdGEgKi8KKyAgKnNobXRlbXAgPSAqKHNobWlkX2RzICopIG1hcHB0cjsK
KworICAvKiBwcm9jZXNzIGxvY2FsIGRhdGEgKi8KKyAgc2htbm9kZSAqdGVt
cG5vZGUgPSBuZXcgc2htbm9kZTsKKworICB0ZW1wbm9kZS0+ZmlsZW1hcCA9
IGZpbGVtYXA7CisgIHRlbXBub2RlLT5hdHRhY2htYXAgPSBhdHRhY2htYXA7
CisgIHNobXRlbXAtPm1hcHB0ciA9IG1hcHB0cjsKKworICAvKiBubyBuZWVk
IGZvciBJbnRlcmxvY2tlZEV4Y2hhbmdlIGhlcmUsIHdlJ3JlIHNlcmlhbGlz
ZWQgYnkgdGhlIGdsb2JhbCBtdXRleCAqLworICB0ZW1wbm9kZS0+c2htZHMg
PSBzaG10ZW1wOworICB0ZW1wbm9kZS0+c2htX2lkID0gc2htX2lkOworICB0
ZW1wbm9kZS0+a2V5ID0ga2V5OworICB0ZW1wbm9kZS0+bmV4dCA9IHNobV9o
ZWFkOworICB0ZW1wbm9kZS0+YXR0YWNoaGVhZCA9IE5VTEw7CisgIHNobV9o
ZWFkID0gdGVtcG5vZGU7CisKKyAgLyogRklYTUU6IGxlYXZlIHRoZSBzeXN0
ZW0gd2lkZSBzaG0gbXV0ZXggKi8KKworICByZXR1cm4gdGVtcG5vZGU7Cit9
CisKK2ludCBfX3N0ZGNhbGwKK2ZpeHVwX3NobXNfYWZ0ZXJfZm9yayAoKQor
eworICBzaG1ub2RlICp0ZW1wbm9kZSA9IHNobV9oZWFkOworICB3aGlsZSAo
dGVtcG5vZGUpCisgICAgeworICAgICAgdm9pZCAqbmV3c2htZHMgPQorCU1h
cFZpZXdPZkZpbGUgKHRlbXBub2RlLT5maWxlbWFwLCBGSUxFX01BUF9XUklU
RSwgMCwgMCwgMCk7CisgICAgICBpZiAoIW5ld3NobWRzKQorCXsKKwkgIC8q
IGRvbid0IHdvcnJ5IGFib3V0IGhhbmRsZSBjbGVhbnVwLCB3ZSdyZSBkeWlu
ZyEgKi8KKwkgIHN5c3RlbV9wcmludGYoImZhaWxlZCB0byByZWF0dGFjaCB0
byBzaG0gY29udHJvbCBmaWxlIHZpZXcgJXhcbiIsdGVtcG5vZGUpOworCSAg
cmV0dXJuIDE7CisJfQorICAgICAgdGVtcG5vZGUtPnNobWRzID0gKGNsYXNz
IHNobWlkX2RzICopIG5ld3NobWRzOworICAgICAgdGVtcG5vZGUtPnNobWRz
LT5tYXBwdHIgPSBuZXdzaG1kczsKKyAgICAgIF9zaG1hdHRhY2ggKmF0dGFj
aG5vZGUgPSB0ZW1wbm9kZS0+YXR0YWNoaGVhZDsKKyAgICAgIHdoaWxlIChh
dHRhY2hub2RlKQorCXsKKwkgIHZvaWQgKm5ld2RhdGEgPSBNYXBWaWV3T2ZG
aWxlRXggKHRlbXBub2RlLT5hdHRhY2htYXAsCisJCQkJCSAgIChhdHRhY2hu
b2RlLT5zaG1mbGcgJiBTSE1fUkRPTkxZKSA/CisJCQkJCSAgIEZJTEVfTUFQ
X1JFQUQgOiBGSUxFX01BUF9XUklURSwgMCwKKwkJCQkJICAgMCwgMCwgYXR0
YWNobm9kZS0+ZGF0YSk7CisJICBpZiAobmV3ZGF0YSAhPSBhdHRhY2hub2Rl
LT5kYXRhKQorCSAgICB7CisJICAgICAgLyogZG9uJ3Qgd29ycnkgYWJvdXQg
aGFuZGxlIGNsZWFudXAsIHdlJ3JlIGR5aW5nISAqLworCQlzeXN0ZW1fcHJp
bnRmKCJmYWlsZWQgdG8gcmVhdHRhY2ggdG8gbWFwcGVkIGZpbGUgdmlldyAl
eFxuIixhdHRhY2hub2RlLT5kYXRhKTsKKwkgICAgICByZXR1cm4gMTsKKwkg
ICAgfQorCSAgYXR0YWNobm9kZSA9IGF0dGFjaG5vZGUtPm5leHQ7CisJfQor
ICAgICAgdGVtcG5vZGUgPSB0ZW1wbm9kZS0+bmV4dDsKKyAgICB9CisgIHJl
dHVybiAwOworfQorCisvKiB0aGlzIGlzIHVnbHkuIFllcywgSSBrbm93IHRo
YXQuCisgKiBGSVhNRTogYWJzdHJhY3QgdGhlIGxvb2t1cCBmdW5jdGlvbmFs
aXR5LAorICogU28gdGhhdCBpdCBjYW4gYmUgYW4gYXJyYXksIGxpc3QsIHdo
YXRldmVyIHdpdGhvdXQgdXMgYmVpbmcgd29ycmllZAorICovCisKKy8qIEZJ
WE1FOiBhZnRlciBmb3JrLCBldmVyeSBtZW1vcnkgYXJlYSBuZWVkcyB0byBo
YXZlIHRoZSBhdHRhY2ggY291bnQKKyAqIGluY3JlbWVudGVkIGFuZCB0aGUg
bWFwcGluZ3MgcG90ZW50aWFsbHkgcmVlc3RhYmxpc2hlZCwgcGVyaGFwcyBh
bGxvd2luZworICogaW5oZXJpdCB3aWxsIHdvcms/IT8KKyAqLworCisvKiBG
SVhNRTogYXJlIGluaGVyaXRlZCBtYXBwZWQgSVBDX1BSSVZBVEUgaWQncyBz
aGFyZWQgYmV0d2VlbiBwcm9jZXNzJ3MKKyAqIFlFUyBmcm9tIGxpbnV4Lgor
ICovCisKK2V4dGVybiAiQyIgdm9pZCAqCitzaG1hdCAoaW50IHNobWlkLCBj
b25zdCB2b2lkICpzaG1hZGRyLCBpbnQgc2htZmxnKQoreworICBzaG1ub2Rl
ICp0ZW1wbm9kZSA9IHNobV9oZWFkOworICB3aGlsZSAodGVtcG5vZGUgJiYg
dGVtcG5vZGUtPnNobV9pZCAhPSBzaG1pZCkKKyAgICB0ZW1wbm9kZSA9IHRl
bXBub2RlLT5uZXh0OworCisgIGlmICghdGVtcG5vZGUpCisgICAgeworICAg
ICAgLyogY291bGRuJ3QgZmluZCBhIGN1cnJlbnRseSBvcGVuIHNobSBjb250
cm9sIGFyZWEgZm9yIHRoZSBrZXkgLSBwcm9iYWJseSBiZWNhdXNlCisgICAg
ICAgKiBzaG1nZXQgaGFzbid0IGJlZW4gY2FsbGVkLiAKKyAgICAgICAqIEFs
bG9jYXRlIGEgbmV3IGNvbnRyb2wgYmxvY2sgLSB0aGlzIGhhcyB0byBiZSBo
YW5kbGVkIGJ5IHRoZSBkYWVtb24gKi8KKyAgICAgIGNsaWVudF9yZXF1ZXN0
X3NobV9nZXQgKnJlcSA9CisJbmV3IGNsaWVudF9yZXF1ZXN0X3NobV9nZXQg
KHNobWlkLCBHZXRDdXJyZW50UHJvY2Vzc0lkICgpKTsKKworICAgICAgaW50
IHJjOworICAgICAgaWYgKChyYyA9IGN5Z3NlcnZlcl9yZXF1ZXN0IChyZXEp
KSkKKwl7CisJICBkZWxldGUgcmVxOworCSAgc2V0X2Vycm5vIChFTk9TWVMp
OwkvKiBkYWVtb24gY29tbXVuaWNhdGlvbiBmYWlsZWQgKi8KKwkgIHJldHVy
biAodm9pZCAqKSAtMTsKKwl9CisKKyAgICAgIGlmIChyZXEtPmhlYWRlci5l
cnJvcl9jb2RlKQkvKiBzaG1fZ2V0IGZhaWxlZCBpbiB0aGUgZGFlbW9uICov
CisJeworCSAgc2V0X2Vycm5vIChyZXEtPmhlYWRlci5lcnJvcl9jb2RlKTsK
KwkgIGRlbGV0ZSByZXE7CisJICByZXR1cm4gKHZvaWQgKikgLTE7CisJfQor
CisgICAgICAvKiB3ZSd2ZSBnb3QgdGhlIGlkLCBub3cgd2Ugb3BlbiB0aGUg
bWVtb3J5IGFyZWEgb3Vyc2VsdmVzLgorICAgICAgICogVGhpcyB0ZXN0cyBz
ZWN1cml0eSBhdXRvbWFnaWNhbGx5CisgICAgICAgKiBGSVhNRTogbWFrZSB0
aGlzIGEgbWV0aG9kIG9mIHNobW5vZGUgPworICAgICAgICovCisgICAgICB0
ZW1wbm9kZSA9CisJYnVpbGRfaW5wcm9jZXNzX3NobWRzIChyZXEtPnBhcmFt
ZXRlcnMub3V0LmZpbGVtYXAsCisJCQkgICAgICAgcmVxLT5wYXJhbWV0ZXJz
Lm91dC5hdHRhY2htYXAsCisJCQkgICAgICAgcmVxLT5wYXJhbWV0ZXJzLm91
dC5rZXksCisJCQkgICAgICAgcmVxLT5wYXJhbWV0ZXJzLm91dC5zaG1faWQp
OworICAgICAgZGVsZXRlIHJlcTsKKyAgICAgIGlmICghdGVtcG5vZGUpCisJ
cmV0dXJuICh2b2lkICopIC0xOworCisgICAgfQorCisgIGNsYXNzIHNobWlk
X2RzICpzaG0gPSB0ZW1wbm9kZS0+c2htZHM7CisKKyAgaWYgKHNobWFkZHIp
CisgICAgeworICAgICAgLy9GSVhNRTogcmVxdWVzdGVkIGJhc2UgYWRkcmVz
cyA/ISAoRG9uJ3QgZm9yZ2V0IHRvIGZpeCB0aGUgZml4dXBfYWZ0ZXJfZm9y
ayB0b28pCisgICAgICBzZXRfZXJybm8gKEVJTlZBTCk7CisgICAgICByZXR1
cm4gKHZvaWQgKikgLTE7CisgICAgfQorCisgIHZvaWQgKnJ2ID0gTWFwVmll
d09mRmlsZSAodGVtcG5vZGUtPmF0dGFjaG1hcCwKKwkJCSAgICAoc2htZmxn
ICYgU0hNX1JET05MWSkgPyBGSUxFX01BUF9SRUFEIDoKKwkJCSAgICBGSUxF
X01BUF9XUklURSwgMCwgMCwgMCk7CisKKyAgaWYgKCFydikKKyAgICB7Cisg
ICAgICAvL0ZJWE1FOiB0cmFuc2xhdGUgR2V0TGFzdEVycm9yKCkKKyAgICAg
IHNldF9lcnJubyAoRUFDQ0VTKTsKKyAgICAgIHJldHVybiAodm9pZCAqKSAt
MTsKKyAgICB9CisKKyAgSW50ZXJsb2NrZWRJbmNyZW1lbnQgKCZzaG0tPnNo
bV9uYXR0Y2gpOworICBfc2htYXR0YWNoICphdHRhY2hub2RlID0gbmV3IF9z
aG1hdHRhY2g7CisKKyAgYXR0YWNobm9kZS0+ZGF0YSA9IHJ2OworICBhdHRh
Y2hub2RlLT5zaG1mbGcgPSBzaG1mbGc7CisgIGF0dGFjaG5vZGUtPm5leHQg
PQorICAgIChfc2htYXR0YWNoICopIEludGVybG9ja2VkRXhjaGFuZ2VQb2lu
dGVyICgmdGVtcG5vZGUtPmF0dGFjaGhlYWQsIGF0dGFjaG5vZGUpOworCisK
KyAgcmV0dXJuIHJ2OworfQorCisvL0ZJWE1FOiB3aG8gaXMgYWxsb3dlZCB0
byBwZXJmb3JtIFNUQVQ/IAorZXh0ZXJuICJDIiBpbnQKK3NobWN0bCAoaW50
IHNobWlkLCBpbnQgY21kLCBzdHJ1Y3Qgc2htaWRfZHMgKmJ1ZikKK3sKKyAg
c2htbm9kZSAqdGVtcG5vZGUgPSBzaG1faGVhZDsKKyAgd2hpbGUgKHRlbXBu
b2RlICYmIHRlbXBub2RlLT5zaG1faWQgIT0gc2htaWQpCisgICAgdGVtcG5v
ZGUgPSB0ZW1wbm9kZS0+bmV4dDsKKyAgaWYgKCF0ZW1wbm9kZSkKKyAgewor
ICAgIC8qIGNvdWxkbid0IGZpbmQgYSBjdXJyZW50bHkgb3BlbiBzaG0gY29u
dHJvbCBhcmVhIGZvciB0aGUga2V5IC0gcHJvYmFibHkgYmVjYXVzZQorICAg
ICAqIHNobWdldCBoYXNuJ3QgYmVlbiBjYWxsZWQuCisgICAgICogQWxsb2Nh
dGUgYSBuZXcgY29udHJvbCBibG9jayAtIHRoaXMgaGFzIHRvIGJlIGhhbmRs
ZWQgYnkgdGhlIGRhZW1vbiAqLworICAgIGNsaWVudF9yZXF1ZXN0X3NobV9n
ZXQgKnJlcSA9CisgICAgICBuZXcgY2xpZW50X3JlcXVlc3Rfc2htX2dldCAo
c2htaWQsIEdldEN1cnJlbnRQcm9jZXNzSWQgKCkpOworCisgICAgaW50IHJj
OworICAgIGlmICgocmMgPSBjeWdzZXJ2ZXJfcmVxdWVzdCAocmVxKSkpCisg
ICAgICB7CisgICAgICAgIGRlbGV0ZSByZXE7CisgICAgICAgIHNldF9lcnJu
byAoRU5PU1lTKTsgICAvKiBkYWVtb24gY29tbXVuaWNhdGlvbiBmYWlsZWQg
Ki8KKyAgICAgICAgcmV0dXJuIC0xOworICAgICAgfQorCisgICAgaWYgKHJl
cS0+aGVhZGVyLmVycm9yX2NvZGUpICAgICAgIC8qIHNobV9nZXQgZmFpbGVk
IGluIHRoZSBkYWVtb24gKi8KKyAgICAgIHsKKyAgICAgICAgc2V0X2Vycm5v
IChyZXEtPmhlYWRlci5lcnJvcl9jb2RlKTsKKyAgICAgICAgZGVsZXRlIHJl
cTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgICAgfQorCisgICAgLyogd2Un
dmUgZ290IHRoZSBpZCwgbm93IHdlIG9wZW4gdGhlIG1lbW9yeSBhcmVhIG91
cnNlbHZlcy4KKyAgICAgKiBUaGlzIHRlc3RzIHNlY3VyaXR5IGF1dG9tYWdp
Y2FsbHkKKyAgICAgKiBGSVhNRTogbWFrZSB0aGlzIGEgbWV0aG9kIG9mIHNo
bW5vZGUgPworICAgICAqLworICAgIHRlbXBub2RlID0KKyAgICAgIGJ1aWxk
X2lucHJvY2Vzc19zaG1kcyAocmVxLT5wYXJhbWV0ZXJzLm91dC5maWxlbWFw
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEtPnBhcmFtZXRl
cnMub3V0LmF0dGFjaG1hcCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcmVxLT5wYXJhbWV0ZXJzLm91dC5rZXksCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHJlcS0+cGFyYW1ldGVycy5vdXQuc2htX2lkKTsKKyAg
ICBkZWxldGUgcmVxOworICAgIGlmICghdGVtcG5vZGUpCisgICAgICByZXR1
cm4gLTE7CisgIH0KKyAgCisgIHN3aXRjaCAoY21kKQorICAgIHsKKyAgICBj
YXNlIElQQ19TVEFUOgorICAgICAgYnVmLT5zaG1fcGVybSA9IHRlbXBub2Rl
LT5zaG1kcy0+c2htX3Blcm07IAorICAgICAgYnVmLT5zaG1fc2Vnc3ogPSB0
ZW1wbm9kZS0+c2htZHMtPnNobV9zZWdzejsKKyAgICAgIGJ1Zi0+c2htX2xw
aWQgPSB0ZW1wbm9kZS0+c2htZHMtPnNobV9scGlkOworICAgICAgYnVmLT5z
aG1fY3BpZCA9IHRlbXBub2RlLT5zaG1kcy0+c2htX2NwaWQ7CisgICAgICBi
dWYtPnNobV9uYXR0Y2ggPSB0ZW1wbm9kZS0+c2htZHMtPnNobV9uYXR0Y2g7
CisgICAgICBidWYtPnNobV9hdGltZSA9IHRlbXBub2RlLT5zaG1kcy0+c2ht
X2F0aW1lOworICAgICAgYnVmLT5zaG1fZHRpbWUgPSB0ZW1wbm9kZS0+c2ht
ZHMtPnNobV9kdGltZTsKKyAgICAgIGJ1Zi0+c2htX2N0aW1lID0gdGVtcG5v
ZGUtPnNobWRzLT5zaG1fY3RpbWU7CisgICAgICBicmVhazsKKyAgICBjYXNl
IElQQ19STUlEOgorICAgICAgeworICAgICAgLyogVE9ETzogY2hlY2sgcGVy
bWlzc2lvbnMuIE9yIHBvc3NpYmx5LCB0aGUgZGFlbW9uIGdldHMgdG8gYmUg
dGhlIG9ubHkgCisgICAgICAgKiBvbmUgd2l0aCB3cml0ZSBhY2Nlc3MgdG8g
dGhlIG1lbW9yeSBhcmVhPworICAgICAgICovCisgICAgICBpZiAodGVtcG5v
ZGUtPnNobWRzLT5zaG1fbmF0dGNoKQorCXN5c3RlbV9wcmludGYgKCJjYWxs
IHRvIHNobWN0bCB3aXRoIGNtZD0gSVBDX1JNSUQgd2hlbiBtZW1vcnkgYXJl
YSBzdGlsbCBoYXMiCisJCQkiIGF0dGFjaGVlc1xuIik7CisgICAgICAvKiBo
b3cgZG9lcyB0aGlzIHdvcms/IAorCSogd2UgbWFyayB0aGUgZHMgYXJlYSBh
cyAiZGVsZXRlZCIsIGFuZCB0aGUgYXQgYW5kIGdldCBjYWxscyBhbGwgZmFp
bCBmcm9tIG5vdyBvbgorCSogb24sIHdoZW4gbmF0dGNoIGJlY29tZXMgMCwg
dGhlIG1hcHBlZCBkYXRhIGFyZWEgaXMgZGVzdHJveWVkLgorICAgICAgICAq
IGFuZCBlYWNoIHByb2Nlc3MsIGFzIHRoZXkgdG91Y2ggdGhpcyBhcmVhIGRl
dGFjaGVzLiBldmVudHVhbGx5IG9ubHkgdGhlIAorIAkqIGRhZW1vbiBoYXMg
YW4gYXR0YWNoLiBUaGUgZGFlbW9uIGdldHMgYXNrZWQgdG8gZGV0YWNoIGlt
bWVkaWF0ZWx5LgorCSovCisjaWYgMAorICAgICAgY2xpZW50X3JlcXVlc3Rf
c2htX2dldCAqcmVxID0KKwkgIG5ldyBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0
IChTSE1fREVMLCBzaG1pZCwgR2V0Q3VycmVudFByb2Nlc3NJZCAoKSk7Cisg
ICAgaW50IHJjOworICAgIGlmICgocmMgPSBjeWdzZXJ2ZXJfcmVxdWVzdCAo
cmVxKSkpCisgICAgICB7CisgICAgICAgIGRlbGV0ZSByZXE7CisgICAgICAg
IHNldF9lcnJubyAoRU5PU1lTKTsgICAvKiBkYWVtb24gY29tbXVuaWNhdGlv
biBmYWlsZWQgKi8KKyAgICAgICAgcmV0dXJuIC0xOworICAgICAgfQorCisg
ICAgaWYgKHJlcS0+aGVhZGVyLmVycm9yX2NvZGUpICAgICAgIC8qIHNobV9k
ZWwgZmFpbGVkIGluIHRoZSBkYWVtb24gKi8KKyAgICAgIHsKKyAgICAgICAg
c2V0X2Vycm5vIChyZXEtPmhlYWRlci5lcnJvcl9jb2RlKTsKKyAgICAgICAg
ZGVsZXRlIHJlcTsKKyAgICAgICAgcmV0dXJuIC0xOworICAgICAgfQorCisg
ICAgIC8qIHRoZSBkYWVtb24gaGFzIGRlbGV0ZWQgaXQncyByZWZlcmVuY2Vz
ICovCisgICAgIC8qIG5vdyBmb3IgdXMgKi8KKyNlbmRpZgorfQorICAgICAg
YnJlYWs7CisgICAgY2FzZSBJUENfU0VUOgorICAgIGRlZmF1bHQ6CisgICAg
ICBzZXRfZXJybm8gKEVJTlZBTCk7CisgICAgICByZXR1cm4gLTE7CisgICAg
fQorICByZXR1cm4gMDsKK30KKworLyogRklYTUU6IGV2YWx1YXRlIGdldHVp
ZCgpIGFuZCBnZXRnaWQoKSBhZ2FpbnN0IHRoZSByZXF1ZXN0ZWQgbW9kZS4g
VGhlbgorICogY2hvb3NlIFBBR0VfUkVBRFdSSVRFIHwgUEFHRV9SRUFET05M
WSBhbmQgRklMRV9NQVBfV1JJVEUgIHwgIEZJTEVfTUFQX1JFQUQKKyAqIGFw
cHJvcHJpYXRlbHkKKyAqLworCisvKiBUZXN0IHJlc3VsdCBmcm9tIG9wZW5i
c2Q6IHNobSBpZHMgYXJlIHBlcnNpc3RlbnQgY3Jvc3MgcHJvY2VzcyBpZiBh
IGhhbmRsZSBpcyBsZWZ0CisgKiBvcGVuLiBUaGlzIGNvdWxkIGxlYWQgdG8g
cmVzb3VyY2Ugc3RhcnZhdGlvbjogd2UncmUgbm90IGNvcHlpbmcgdGhhdCBi
ZWhhdmlvdXIgCisgKiB1bmxlc3Mgd2UgaGF2ZSB0by4gKEl0IHdpbGwgaW52
b2x2ZSBhY3lnd2luMS5kbGwgZ2xvYWwgc2hhcmVkIGxpc3QgOlsgKS4KKyAq
LworLyogRklYTUU6IHNobWlkIHNob3VsZCBiZSBhIHZlcmlmeWFibGUgb2Jq
ZWN0CisgKi8KKworLyogRklYTUU6IG9uIE5UIHdlIHNob3VsZCBjaGVjayBl
dmVyeXRoaW5nIGFnYWluc3QgdGhlIFNELiBPbiA5NSB3ZSBqdXN0IGVtdWxh
dGUuCisgKi8KK2V4dGVybiAiQyIgaW50CitzaG1nZXQgKGtleV90IGtleSwg
c2l6ZV90IHNpemUsIGludCBzaG1mbGcpCit7CisgIERXT1JEIHNkX3NpemUg
PSA0MDk2OworICBjaGFyIHNkX2J1Zls0MDk2XTsKKyAgUFNFQ1VSSVRZX0RF
U0NSSVBUT1IgcHNkID0gKFBTRUNVUklUWV9ERVNDUklQVE9SKSBzZF9idWY7
CisgIC8qIGNyZWF0ZSBhIHNkIGZvciBvdXIgb3BlbiByZXF1ZXN0cyBiYXNl
ZCBvbiBzaG1mbGFnICYgMHgwMWZmICovCisgIHBzZCA9IGFsbG9jX3NkIChn
ZXR1aWQgKCksIGdldGdpZCAoKSwgY3lnaGVhcC0+dXNlci5sb2dzcnYgKCks
CisJCSAgc2htZmxnICYgMHgwMWZmLCBwc2QsICZzZF9zaXplKTsKKworICBp
ZiAoa2V5ID09IChrZXlfdCkgLSAxKQorICAgIHsKKyAgICAgIHNldF9lcnJu
byAoRU5PRU5UKTsKKyAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgLyog
RklYTUU6IGVudGVyIHRoZSBjaGVja2luZyBmb3IgZXhpc3Rpbmcga2V5cyBt
dXRleC4gVGhpcyBtdXRleCBfbXVzdF8gYmUgc3lzdGVtIHdpZGUKKyAgICog
dG8gcHJldmVudCByYWNlcyBvbiBzaG1nZXQuCisgICAqLworCisgIC8qIHdh
bGsgdGhlIGxpc3Qgb2YgY3VycmVudGx5IG9wZW4ga2V5cyBhbmQgcmV0dXJu
IHRoZSBpZCBpZiBmb3VuZAorICAgKi8KKyAgc2htbm9kZSAqdGVtcG5vZGUg
PSBzaG1faGVhZDsKKyAgd2hpbGUgKHRlbXBub2RlKQorICAgIHsKKyAgICAg
IGlmICh0ZW1wbm9kZS0+a2V5ID09IGtleSAmJiBrZXkgIT0gSVBDX1BSSVZB
VEUpCisJeworCSAgLy8gRklYTUU6IGZyZWUgdGhlIG11dGV4CisJICBpZiAo
c2l6ZSAmJiB0ZW1wbm9kZS0+c2htZHMtPnNobV9zZWdzeiA8IHNpemUpCisJ
ICAgIHsKKwkgICAgICBzZXRfZXJybm8gKEVJTlZBTCk7CisJICAgICAgcmV0
dXJuIC0xOworCSAgICB9CisJICBpZiAoKHNobWZsZyAmIElQQ19DUkVBVCkg
JiYgKHNobWZsZyAmIElQQ19FWENMKSkKKwkgICAgeworCSAgICAgIHNldF9l
cnJubyAoRUVYSVNUKTsKKwkgICAgICAvLyBGSVhNRTogZnJlZSB0aGUgbXV0
ZXgKKwkgICAgICByZXR1cm4gLTE7CisJICAgIH0KKwkgIC8vIEZJWE1FOiBk
byB3ZSBuZWVkIHRvIG90aGVyIHRlc3RzIG9mIHRoZSByZXF1ZXN0ZWQgbW9k
ZSB3aXRoIHRoZQorCSAgLy8gdGVtcG5vZGUtPnNobWlkIG1vZGUgPyB0ZXN0
Y2FzZSBvbiB1bml4IG5lZWRlZC4KKwkgIC8vIEZJWE1FIGRvIHdlIG5lZWQg
YSBzZWN1cml0eSB0ZXN0PyBXZSBhcmUgb25seSBleGFtaW5pbmcgdGhlIGtl
eXMgd2UgYWxyZWFkeSBoYXZlIG9wZW4uCisJICAvLyBGSVhNRTogd2hhdCBh
cmUgdGhlIHNlYyBpbXBsaWNhdGlvbnMgZm9yIGZvcmsgKCkgaWYgd2UgZG9u
J3QgY2hlY2sgaGVyZT8KKwkgIHJldHVybiB0ZW1wbm9kZS0+c2htX2lkOwor
CX0KKyAgICAgIHRlbXBub2RlID0gdGVtcG5vZGUtPm5leHQ7CisgICAgfQor
ICAvKiBjb3VsZG4ndCBmaW5kIGEgY3VycmVudGx5IG9wZW4gc2htIGNvbnRy
b2wgYXJlYSBmb3IgdGhlIGtleS4KKyAgICogQWxsb2NhdGUgYSBuZXcgY29u
dHJvbCBibG9jayAtIHRoaXMgaGFzIHRvIGJlIGhhbmRsZWQgYnkgdGhlIGRh
ZW1vbiAqLworICBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0ICpyZXEgPQorICAg
IG5ldyBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0IChrZXksIHNpemUsIHNobWZs
Zywgc2RfYnVmLAorCQkJCUdldEN1cnJlbnRQcm9jZXNzSWQgKCkpOworCisg
IGludCByYzsKKyAgaWYgKChyYyA9IGN5Z3NlcnZlcl9yZXF1ZXN0IChyZXEp
KSkKKyAgICB7CisgICAgICBkZWxldGUgcmVxOworICAgICAgc2V0X2Vycm5v
IChFTk9TWVMpOwkvKiBkYWVtb24gY29tbXVuaWNhdGlvbiBmYWlsZWQgKi8K
KyAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgaWYgKHJlcS0+aGVhZGVy
LmVycm9yX2NvZGUpCS8qIHNobV9nZXQgZmFpbGVkIGluIHRoZSBkYWVtb24g
Ki8KKyAgICB7CisgICAgICBzZXRfZXJybm8gKHJlcS0+aGVhZGVyLmVycm9y
X2NvZGUpOworICAgICAgZGVsZXRlIHJlcTsKKyAgICAgIHJldHVybiAtMTsK
KyAgICB9CisKKyAgLyogd2UndmUgZ290IHRoZSBpZCwgbm93IHdlIG9wZW4g
dGhlIG1lbW9yeSBhcmVhIG91cnNlbHZlcy4KKyAgICogVGhpcyB0ZXN0cyBz
ZWN1cml0eSBhdXRvbWFnaWNhbGx5CisgICAqIEZJWE1FOiBtYWtlIHRoaXMg
YSBtZXRob2Qgb2Ygc2htbm9kZSA/CisgICAqLworICBzaG1ub2RlICpzaG10
ZW1wID0gYnVpbGRfaW5wcm9jZXNzX3NobWRzIChyZXEtPnBhcmFtZXRlcnMu
b3V0LmZpbGVtYXAsCisJCQkJCSAgICByZXEtPnBhcmFtZXRlcnMub3V0LmF0
dGFjaG1hcCwKKwkJCQkJICAgIGtleSwKKwkJCQkJICAgIHJlcS0+cGFyYW1l
dGVycy5vdXQuc2htX2lkKTsKKyAgZGVsZXRlIHJlcTsKKyAgaWYgKHNobXRl
bXApCisgICAgcmV0dXJuIHNobXRlbXAtPnNobV9pZDsKKyAgcmV0dXJuIC0x
OworCisKKyNpZiAwCisgIC8qIGZpbGwgb3V0IHRoZSBub2RlIGRhdGEgKi8K
KyAgc2htdGVtcC0+c2htX3Blcm0uY3VpZCA9IGdldHVpZCAoKTsKKyAgc2ht
dGVtcC0+c2htX3Blcm0udWlkID0gc2htdGVtcC0+c2htX3Blcm0uY3VpZDsK
KyAgc2htdGVtcC0+c2htX3Blcm0uY2dpZCA9IGdldGdpZCAoKTsKKyAgc2ht
dGVtcC0+c2htX3Blcm0uZ2lkID0gc2htdGVtcC0+c2htX3Blcm0uY2dpZDsK
KyAgc2htdGVtcC0+c2htX3Blcm0ubW9kZSA9IHNobWZsZyAmIDB4MDFmZjsK
KyAgc2htdGVtcC0+c2htX2xwaWQgPSAwOworICBzaG10ZW1wLT5zaG1fbmF0
dGNoID0gMDsKKyAgc2htdGVtcC0+c2htX2F0aW1lID0gMDsKKyAgc2htdGVt
cC0+c2htX2R0aW1lID0gMDsKKyAgc2htdGVtcC0+c2htX2N0aW1lID0gdGlt
ZSAoTlVMTCk7CisgIHNobXRlbXAtPnNobV9zZWdzeiA9IHNpemU7CisgICoo
c2htaWRfZHMgKikgbWFwcHRyID0gKnNobXRlbXA7CisgIHNobXRlbXAtPmZp
bGVtYXAgPSBmaWxlbWFwOworICBzaG10ZW1wLT5hdHRhY2htYXAgPSBhdHRh
Y2htYXA7CisgIHNobXRlbXAtPm1hcHB0ciA9IG1hcHB0cjsKKworI2VuZGlm
Cit9CkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi90dHkuY2MKZGlmZiAtdSBz
cmMvd2luc3VwL2N5Z3dpbi90dHkuY2M6MS4yOSBzcmMvd2luc3VwL2N5Z3dp
bi90dHkuY2M6MS4yOS4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL3R0eS5j
YzoxLjI5CVRodSBTZXAgMTMgMDM6NDY6MzYgMjAwMQorKysgc3JjL3dpbnN1
cC9jeWd3aW4vdHR5LmNjCU1vbiBTZXAgMjQgMjI6NDk6MTEgMjAwMQpAQCAt
MjMsNiArMjMsOSBAQAogI2luY2x1ZGUgInN5bmMuaCIKICNpbmNsdWRlICJz
aWdwcm9jLmgiCiAjaW5jbHVkZSAicGluZm8uaCIKKyNpbmNsdWRlIDxzeXMv
c29ja2V0Lmg+CisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlcl90cmFuc3Bv
cnQuaCIKKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVyLmgiCiAjaW5jbHVk
ZSAic2hhcmVkX2luZm8uaCIKIAogZXh0ZXJuIGZoYW5kbGVyX3R0eV9tYXN0
ZXIgKnR0eV9tYXN0ZXI7CkBAIC0zOTIsNyArMzk1LDcgQEAKIAogICAvKiBB
bGxvdyB0aGUgb3RoZXJzIHRvIG9wZW4gdXMgKGZvciBoYW5kbGUgZHVwbGlj
YXRpb24pICovCiAKLSAgaWYgKHdpbmNhcC5oYXNfc2VjdXJpdHkgKCkgJiYK
KyAgaWYgKHdpbmNhcC5oYXNfc2VjdXJpdHkgKCkgJiYgY3lnc2VydmVyX3J1
bm5pbmc9PUNZR1NFUlZFUl9PSyAmJgogICAgICAgKFNldEtlcm5lbE9iamVj
dFNlY3VyaXR5IChoTWFpblByb2MsIERBQ0xfU0VDVVJJVFlfSU5GT1JNQVRJ
T04sCiAJCQkgICAgICAgZ2V0X251bGxfc2QgKCkpID09IEZBTFNFKSkKICAg
ICBzbWFsbF9wcmludGYgKCJDYW4ndCBzZXQgcHJvY2VzcyBzZWN1cml0eSwg
JUUiKTsKSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL3dpbnN1cC5oCmRpZmYg
LXUgc3JjL3dpbnN1cC9jeWd3aW4vd2luc3VwLmg6MS42OSBzcmMvd2luc3Vw
L2N5Z3dpbi93aW5zdXAuaDoxLjY5LjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3
aW4vd2luc3VwLmg6MS42OQlUaHUgU2VwIDEzIDAzOjQ2OjM3IDIwMDEKKysr
IHNyYy93aW5zdXAvY3lnd2luL3dpbnN1cC5oCU1vbiBTZXAgMjQgMjI6NDk6
MTEgMjAwMQpAQCAtNjksNiArNjksOCBAQAogZW51bSBjb2RlcGFnZV90eXBl
IHthbnNpX2NwLCBvZW1fY3B9OwogZXh0ZXJuIGNvZGVwYWdlX3R5cGUgY3Vy
cmVudF9jb2RlcGFnZTsKIAorZXh0ZXJuIGludCBjeWdzZXJ2ZXJfcnVubmlu
ZzsKKwogLyogVXNlZCB0byBjaGVjayBpZiBDeWd3aW4gRExMIGlzIGR5bmFt
aWNhbGx5IGxvYWRlZC4gKi8KIGV4dGVybiBpbnQgZHluYW1pY2FsbHlfbG9h
ZGVkOwogCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dp
bi9jeWdzZXJ2ZXIuaApkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5
Z3dpbi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXIuaDoxLjEuMi4xCi0tLSAv
ZGV2L251bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAgMTk3MAorKysgc3JjL3dp
bnN1cC9jeWd3aW4vaW5jbHVkZS9jeWd3aW4vY3lnc2VydmVyLmgJTW9uIFNl
cCAyNCAyMjo0OToxMSAyMDAxCkBAIC0wLDAgKzEsMTI2IEBACisvKiBjeWdz
ZXJ2ZXIuaAorCisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKwor
ICAgV3JpdHRlbiBieSBFZ29yIER1ZGEgPGRlb0Bsb2dvcy1tLnJ1PgorCitU
aGlzIGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKK1RoaXMgc29mdHdhcmUg
aXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJt
cyBvZiB0aGUKK0N5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQgdGhl
IGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKK2RldGFpbHMuICovCisKKyNp
Zm5kZWYgX0NZR1NFUlZFUl9IXworI2RlZmluZSBfQ1lHU0VSVkVSX0hfCisK
KyNkZWZpbmUgTUFYX1JFUVVFU1RfU0laRSAxMjgKKworI2RlZmluZSBDWUdX
SU5fU0VSVkVSX1ZFUlNJT05fTUFKT1IJMQorI2RlZmluZSBDWUdXSU5fU0VS
VkVSX1ZFUlNJT05fQVBJCTEKKyNkZWZpbmUgQ1lHV0lOX1NFUlZFUl9WRVJT
SU9OX01JTk9SCTAKKyNkZWZpbmUgQ1lHV0lOX1NFUlZFUl9WRVJTSU9OX1BB
VENICTAKKworCit0eXBlZGVmIGVudW0geworICBDWUdTRVJWRVJfVU5LTk9X
Tj0wLAorICBDWUdTRVJWRVJfT0s9MSwKKyAgQ1lHU0VSVkVSX0RFQUQ9Mgor
fSBjeWdzZXJ2ZXJfc3RhdGVzOworCit0eXBlZGVmIGVudW0geworICBDWUdT
RVJWRVJfUkVRVUVTVF9JTlZBTElEID0gMCwKKyAgQ1lHU0VSVkVSX1JFUVVF
U1RfR0VUX1ZFUlNJT04sCisgIENZR1NFUlZFUl9SRVFVRVNUX0FUVEFDSF9U
VFksCisgIENZR1NFUlZFUl9SRVFVRVNUX1NIVVRET1dOLAorICBDWUdTRVJW
RVJfUkVRVUVTVF9TSE1fR0VULAorICBDWUdTRVJWRVJfUkVRVUVTVF9MQVNU
Cit9IGN5Z3NlcnZlcl9yZXF1ZXN0X2NvZGU7CisKK2NsYXNzIHJlcXVlc3Rf
aGVhZGVyCit7CisgIHB1YmxpYzoKKyAgICBzc2l6ZV90IGNiOworICAgIGN5
Z3NlcnZlcl9yZXF1ZXN0X2NvZGUgcmVxX2lkOworICAgIHNzaXplX3QgZXJy
b3JfY29kZTsKK30KKyNpZmRlZiBfX0dOVUNfXworICBfX2F0dHJpYnV0ZV9f
ICgocGFja2VkKSkKKyNlbmRpZgorOworCitleHRlcm4gdm9pZCBjeWdzZXJ2
ZXJfaW5pdCAoKTsKKworI2RlZmluZSBJTklUX1JFUVVFU1QocmVxLGlkKSBc
CisJKHJlcSkuaGVhZGVyLmNiID0gc2l6ZW9mIChyZXEpOyBcCisJKHJlcSku
aGVhZGVyLnJlcV9pZCA9IGlkOworCitzdHJ1Y3QgcmVxdWVzdF9nZXRfdmVy
c2lvbgoreworICBEV09SRCBtYWpvciwgYXBpLCBtaW5vciwgcGF0Y2g7Cit9
CisjaWZkZWYgX19HTlVDX18KKyAgX19hdHRyaWJ1dGVfXyAoKHBhY2tlZCkp
CisjZW5kaWYKKzsKKworc3RydWN0IHJlcXVlc3Rfc2h1dGRvd24KK3sKKyAg
aW50IGZvbzsKK30KKyNpZmRlZiBfX0dOVUNfXworICBfX2F0dHJpYnV0ZV9f
ICgocGFja2VkKSkKKyNlbmRpZgorOworCitzdHJ1Y3QgcmVxdWVzdF9hdHRh
Y2hfdHR5Cit7CisgIERXT1JEIHBpZCwgbWFzdGVyX3BpZDsKKyAgSEFORExF
IGZyb21fbWFzdGVyLCB0b19tYXN0ZXI7Cit9CisjaWZkZWYgX19HTlVDX18K
KyAgX19hdHRyaWJ1dGVfXyAoKHBhY2tlZCkpCisjZW5kaWYKKzsKKworY2xh
c3MgY2xpZW50X3JlcXVlc3QKK3sKKyAgcHVibGljOgorICBjbGllbnRfcmVx
dWVzdCAoY3lnc2VydmVyX3JlcXVlc3RfY29kZSBpZCk7CisgIHZpcnR1YWwg
dm9pZCBzZW5kICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubik7CisgIHZp
cnR1YWwgdm9pZCBzZXJ2ZSAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4p
IHt9OworICB2aXJ0dWFsIG9wZXJhdG9yIHN0cnVjdCByZXF1ZXN0X2hlYWRl
ciAoKTsKKyAgY3lnc2VydmVyX3JlcXVlc3RfY29kZSByZXFfaWQgKCkge3Jl
dHVybiBoZWFkZXIucmVxX2lkO307CisgIHZpcnR1YWwgfmNsaWVudF9yZXF1
ZXN0KCk7CisgIHJlcXVlc3RfaGVhZGVyIGhlYWRlcjsKKyAgY2hhciAqYnVm
ZmVyOworfTsKKworY2xhc3MgY2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb24g
OiBwdWJsaWMgY2xpZW50X3JlcXVlc3QKK3sKKyAgcHVibGljOgorICB2aXJ0
dWFsIHZvaWQgc2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKTsK
KyAgY2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb246OmNsaWVudF9yZXF1ZXN0
X2dldF92ZXJzaW9uKCk7CisgIHN0cnVjdCByZXF1ZXN0X2dldF92ZXJzaW9u
IHZlcnNpb247Cit9OworCitjbGFzcyBjbGllbnRfcmVxdWVzdF9zaHV0ZG93
biA6IHB1YmxpYyBjbGllbnRfcmVxdWVzdAoreworICBwdWJsaWM6CisgIHZp
cnR1YWwgdm9pZCBzZXJ2ZSAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4p
OworICBjbGllbnRfcmVxdWVzdF9zaHV0ZG93biAoKTsKK307CisKK2NsYXNz
IGNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkgOiBwdWJsaWMgY2xpZW50X3Jl
cXVlc3QKK3sKKyAgcHVibGljOgorICB2aXJ0dWFsIHZvaWQgc2VydmUgKHRy
YW5zcG9ydF9sYXllcl9iYXNlICpjb25uKTsKKyAgY2xpZW50X3JlcXVlc3Rf
YXR0YWNoX3R0eSAoKTsKKyAgY2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eSAo
RFdPUkQgbnBpZCwgRFdPUkQgbm1hc3Rlcl9waWQsIEhBTkRMRSBuZnJvbV9t
YXN0ZXIsIEhBTkRMRSBudG9fbWFzdGVyKTsKKyAgSEFORExFIGZyb21fbWFz
dGVyICgpIHtyZXR1cm4gcmVxLmZyb21fbWFzdGVyO307CisgIEhBTkRMRSB0
b19tYXN0ZXIgKCkge3JldHVybiByZXEudG9fbWFzdGVyO307CisgIHN0cnVj
dCByZXF1ZXN0X2F0dGFjaF90dHkgcmVxOworfTsKKworZXh0ZXJuIGludCBj
eWdzZXJ2ZXJfcmVxdWVzdCAoY2xpZW50X3JlcXVlc3QgKik7CisKKyNlbmRp
ZiAvKiBfQ1lHU0VSVkVSK0grICovCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dp
bi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0LmgKZGlmZiAt
dSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9jeWd3aW4v
Y3lnc2VydmVyX3RyYW5zcG9ydC5oOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJ
VGh1IEphbiAgMSAwMTowMDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dp
bi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0LmgJTW9uIFNl
cCAyNCAyMjo0OToxMSAyMDAxCkBAIC0wLDAgKzEsNTMgQEAKKworI2lmbmRl
ZiBfQ1lHU0VSVkVSX1NITV8KKyNkZWZpbmUgX0NZR1NFUlZFUl9TSE1fCitj
bGFzcyB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY3JlYXRlX3NlcnZlcl90cmFu
c3BvcnQoKTsKKworLyogdGhlIGJhc2UgY2xhc3MgdXNlcyBBRl9VTklYIHNv
Y2tldHMsYnV0IG90aGVyIGNsYXNzZXMgYXJlIHBvc3NpYmxlLiAqLworY2xh
c3MgdHJhbnNwb3J0X2xheWVyX2Jhc2UKK3sKKyAgcHVibGljOgorICAgIHZp
cnR1YWwgdm9pZCBsaXN0ZW4gKCk7CisgICAgdmlydHVhbCBjbGFzcyB0cmFu
c3BvcnRfbGF5ZXJfYmFzZSAqIGFjY2VwdCAoKTsKKyAgICB2aXJ0dWFsIHZv
aWQgY2xvc2UgKCk7CisgICAgdmlydHVhbCBzc2l6ZV90IHJlYWQgKGNoYXIg
KmJ1Ziwgc2l6ZV90IGxlbik7CisgICAgdmlydHVhbCBzc2l6ZV90IHdyaXRl
IChjaGFyICpidWYsIHNpemVfdCBsZW4pOworICAgIHZpcnR1YWwgYm9vbCBj
b25uZWN0KCk7CisgICAgdmlydHVhbCB2b2lkIGltcGVyc29uYXRlX2NsaWVu
dCAoKTsKKyAgICB2aXJ0dWFsIHZvaWQgcmV2ZXJ0X3RvX3NlbGYgKCk7Cisg
ICAgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKCk7CisKKyAgcHJpdmF0ZToKKyAg
ICAvKiBmb3Igc29ja2V0IGJhc2VkIGNvbW11bmljYXRpb25zICovCisgICAg
aW50IGZkOworICAgIHN0cnVjdCBzb2NrYWRkciBzb2NrZGV0YWlsczsKKyAg
ICBpbnQgc2RsZW47CisgICAgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKGludCBu
ZXdmZCk7Cit9OworCisvKiBOYW1lZCBwaXBlcyBiYXNlZCB0cmFuc3BvcnQs
IGZvciBzZWN1cml0eSBvbiBOVCAqLworY2xhc3MgdHJhbnNwb3J0X2xheWVy
X3BpcGVzIDogcHVibGljIHRyYW5zcG9ydF9sYXllcl9iYXNlCit7CisgIHB1
YmxpYzoKKyAgICB2aXJ0dWFsIHZvaWQgbGlzdGVuICgpOworICAgIHZpcnR1
YWwgY2xhc3MgdHJhbnNwb3J0X2xheWVyX3BpcGVzICogYWNjZXB0ICgpOwor
ICAgIHZpcnR1YWwgdm9pZCBjbG9zZSAoKTsKKyAgICB2aXJ0dWFsIHNzaXpl
X3QgcmVhZCAoY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKKyAgICB2aXJ0dWFs
IHNzaXplX3Qgd3JpdGUgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7CisgICAg
dmlydHVhbCBib29sIGNvbm5lY3QoKTsKKyAgICB2aXJ0dWFsIHZvaWQgaW1w
ZXJzb25hdGVfY2xpZW50ICgpOworICAgIHZpcnR1YWwgdm9pZCByZXZlcnRf
dG9fc2VsZiAoKTsKKyAgICB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKCk7CisK
KyAgcHJpdmF0ZToKKyAgICAvKiBmb3IgcGlwZSBiYXNlZCBjb21tdW5pY2F0
aW9ucyAqLworICAgIHZvaWQgaW5pdF9zZWN1cml0eSAoKTsKKyAgICBTRUNV
UklUWV9ERVNDUklQVE9SIHNkOworICAgIFNFQ1VSSVRZX0FUVFJJQlVURVMg
c2VjX25vbmVfbmloLCBzZWNfYWxsX25paDsKKyAgICBjaGFyIHBpcGVfbmFt
ZSBbTUFYX1BBVEhdOworICAgIEhBTkRMRSBwaXBlOworICAgIGJvb2wgaW5p
dGVkOworICAgIHRyYW5zcG9ydF9sYXllcl9waXBlcyAoSEFORExFIG5ld19w
aXBlKTsKK307CisKKyNlbmRpZiAvKiBfQ1lHU0VSVkVSX1NITV8gKi8KSW5k
ZXg6IHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lzL2lwYy5oCmRpZmYg
LXUgL2Rldi9udWxsIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lzL2lw
Yy5oOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDow
MCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL3N5cy9pcGMu
aAlNb24gU2VwIDI0IDIyOjQ5OjExIDIwMDEKQEAgLTAsMCArMSw1MiBAQAor
Lyogc3lzL2lwYy5oCisKKyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQgSW5j
LiAKKyAgIFdyaXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJidGNvbGxpbnNA
aG90bWFpbC5jb20+CisKK1RoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4K
KworVGhpcyBzb2Z0d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5z
ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZQorQ3lnd2luIGxpY2Vuc2UuICBQ
bGVhc2UgY29uc3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgor
ZGV0YWlscy4gKi8KKworI2lmZGVmIF9fY3BsdXNwbHVzCitleHRlcm4gIkMi
Cit7CisjZW5kaWYKKworI2lmbmRlZiBfU1lTX0lQQ19ICisjZGVmaW5lIF9T
WVNfSVBDX0gKKworLyogc3lzL3R5cGVzIG11c3QgYmUgaW5jbHVkZWQgYmVm
b3JlIHN5cy9pcGMuaC4gV2UgYXJlbid0IG1lYW50IHRvIGF1dG9tYXRpY2Fs
bHkgCisgKiBpbmNsdWRlIGl0IGhvd2V2ZXIgCisgKi8KKworc3RydWN0IGlw
Y19wZXJtIHsKKyAgdWlkX3QgIHVpZDsKKyAgZ2lkX3QgIGdpZDsKKyAgdWlk
X3QgIGN1aWQ7CisgIGdpZF90ICBjZ2lkOworICBtb2RlX3QgbW9kZTsKK307
IAorCisvKiB0aGUgbW9kZSBmbGFncyB1c2VkIHdpdGggdGhlIF9nZXQgZnVu
Y3Rpb25zIHVzZSB0aGUgbG93IG9yZGVyIDkgYml0cyBmb3IgYSBtb2RlIAor
ICogcmVxdWVzdAorICovCisjZGVmaW5lIElQQ19DUkVBVCAgMHgwMjAwCisj
ZGVmaW5lIElQQ19FWENMICAgMHgwNDAwCisjZGVmaW5lIElQQ19OT1dBSVQg
MHgwODAwCisKKy8qIHRoaXMgaXMgYSB2YWx1ZSB0aGF0IHdpbGwgX25ldmVy
XyBiZSBhIHZhbGlkIGtleSBmcm9tIGZ0b2sgKi8KKyNkZWZpbmUgSVBDX1BS
SVZBVEUgLTIKKworI2RlZmluZSBJUENfUk1JRCAweDAwMDMKKyNkZWZpbmUg
SVBDX1NFVCAgMHgwMDAyCisjZGVmaW5lIElQQ19TVEFUIDB4MDAwMQorCitr
ZXlfdCBmdG9rKGNvbnN0IGNoYXIgKiwgaW50KTsKKworI2VuZGlmIC8qIF9T
WVNfSVBDX0ggKi8KKworI2lmZGVmIF9fY3BsdXNwbHVzCit9CisjZW5kaWYK
SW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lzL3NobS5oCmRp
ZmYgLXUgL2Rldi9udWxsIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lz
L3NobS5oOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTow
MDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL3N5cy9z
aG0uaAlNb24gU2VwIDI0IDIyOjQ5OjExIDIwMDEKQEAgLTAsMCArMSw4OSBA
QAorLyogc3lzL3NobS5oCisKKyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQg
SW5jLiAKKyAgIFdyaXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJidGNvbGxp
bnNAaG90bWFpbC5jb20+CisKK1RoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dp
bi4KKworVGhpcyBzb2Z0d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGlj
ZW5zZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZQorQ3lnd2luIGxpY2Vuc2Uu
ICBQbGVhc2UgY29uc3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZv
cgorZGV0YWlscy4gKi8KKworI2lmZGVmIF9fY3BsdXNwbHVzCitleHRlcm4g
IkMiCit7CisjZW5kaWYKKworI2lmbmRlZiBfU1lTX1NITV9ICisjZGVmaW5l
IF9TWVNfU0hNX0gKKworI2luY2x1ZGUgPHN5cy9pcGMuaD4KKworI2RlZmlu
ZSBTSE1fUkRPTkxZIDEKKy8qIDY0IEtiIHdhcyBoYXJkY29kZWQgZm9yIHg4
Ni4gTVMgc3RhdGVzIHRoaXMgbWF5IGNoYW5nZSwgYnV0IHdlIG5lZWQgaXQg
aW4gdGhlIGhlYWRlcgorICogZmlsZS4KKyAqLworI2RlZmluZSBTSE1MQkEg
ICAgIDY1NTM2CisjZGVmaW5lIFNITV9STkQJICAgMQorCit0eXBlZGVmIGxv
bmcgaW50IHNobWF0dF90OworCisjaWYgZGVmaW5lZChfX0lOU0lERV9DWUdX
SU5fXykgJiYgZGVmaW5lZChfX2NwbHVzcGx1cykKKworY2xhc3MgX3NobWF0
dGFjaCB7CitwdWJsaWM6CisgIHZvaWQgKmRhdGE7CisgIGludCBzaG1mbGc7
CisgIGNsYXNzIF9zaG1hdHRhY2ggKm5leHQ7Cit9OworCitjbGFzcyBzaG1p
ZF9kcyB7CitwdWJsaWM6CisgIHN0cnVjdCAgIGlwY19wZXJtIHNobV9wZXJt
OworICBzaXplX3QgICBzaG1fc2Vnc3o7CisgIHBpZF90ICAgIHNobV9scGlk
OworICBwaWRfdCAgICBzaG1fY3BpZDsKKyAgc2htYXR0X3Qgc2htX25hdHRj
aDsKKyAgdGltZV90ICAgc2htX2F0aW1lOworICB0aW1lX3QgICBzaG1fZHRp
bWU7CisgIHRpbWVfdCAgIHNobV9jdGltZTsKKyAgdm9pZCAqbWFwcHRyOwor
fTsKKworY2xhc3Mgc2htbm9kZSB7CitwdWJsaWM6CisgIGNsYXNzIHNobWlk
X2RzICogc2htZHM7CisgIGludCBzaG1faWQ7CisgIGNsYXNzIHNobW5vZGUg
Km5leHQ7CisgIGtleV90IGtleTsKKyAgSEFORExFIGZpbGVtYXA7CisgIEhB
TkRMRSBhdHRhY2htYXA7CisgIGNsYXNzIF9zaG1hdHRhY2ggKmF0dGFjaGhl
YWQ7Cit9OworCisjZWxzZQorLyogdGhpcyBpcyB3aGF0IHdlIHJldHVybiB3
aGVuIHF1ZXJpZWQuIEl0IGhhcyBubyBiaXR3aXNlIGNvcnJlc3BvbmRlbmNl
CisgKiB0aGUgaW50ZXJuYWwgc3RydWN0dXJlcyAKKyAqLworc3RydWN0IHNo
bWlkX2RzIHsKKyAgc3RydWN0ICAgaXBjX3Blcm0gc2htX3Blcm07CisgIHNp
emVfdCAgIHNobV9zZWdzejsKKyAgcGlkX3QgICAgc2htX2xwaWQ7CisgIHBp
ZF90ICAgIHNobV9jcGlkOworICBzaG1hdHRfdCBzaG1fbmF0dGNoOworICB0
aW1lX3QgICBzaG1fYXRpbWU7CisgIHRpbWVfdCAgIHNobV9kdGltZTsKKyAg
dGltZV90ICAgc2htX2N0aW1lOworfTsKKyNlbmRpZiAvKiBfX0lOU0lERV9D
WUdXSU5fXyAqLworCit2b2lkICpzaG1hdChpbnQsIGNvbnN0IHZvaWQgKiwg
aW50KTsKK2ludCAgIHNobWN0bChpbnQsIGludCwgc3RydWN0IHNobWlkX2Rz
ICopOworaW50ICAgc2htZHQoY29uc3Qgdm9pZCAqKTsKK2ludCAgIHNobWdl
dChrZXlfdCwgc2l6ZV90LCBpbnQpOworCisjZW5kaWYgLyogX1NZU19TSE1f
SCAqLworCisjaWZkZWYgX19jcGx1c3BsdXMKK30KKyNlbmRpZgo=

------------=_1583532849-65438-105--
