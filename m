Return-Path: <cygwin-patches-return-9412-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 48123 invoked by alias); 26 May 2019 15:10:44 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Id: <cygwin-patches.cygwin.com>
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
Received: (qmail 48047 invoked by uid 89); 26 May 2019 15:10:44 -0000
Authentication-Results: sourceware.org; auth=none
X-Spam-SWARE-Status: No, score=-21.9 required=5.0 tests=AWL,BAYES_00,GIT_PATCH_0,GIT_PATCH_1,GIT_PATCH_2,GIT_PATCH_3,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_PASS autolearn=ham version=3.3.1 spammy=supposedly, pvoid, PVOID
X-HELO: NAM05-DM3-obe.outbound.protection.outlook.com
Received: from mail-eopbgr730108.outbound.protection.outlook.com (HELO NAM05-DM3-obe.outbound.protection.outlook.com) (40.107.73.108) by sourceware.org (qpsmtpd/0.93/v0.84-503-g423c35a) with ESMTP; Sun, 26 May 2019 15:10:42 +0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cornell.edu; s=selector2; h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck; bh=6bRIY3wSTXtugxf1PJRDwGQihVWNmNV7FtteuLUKCKo=; b=CC7ypE1WbqDJH3F2ihCxWcfNHSje39Qjf6Du2g1eSQ7Q2zz38bo40BetFMGDmwYev6dxoZA4fR6izOrfdDGFTH/C+e9mv1N79WbV60f2fh7RaOsJN0XDFNhFOpN2MP5eTNMtTskS3TRY++cfH6JpdkV+1XkyX4OMAi2FXOTtMmo=
Received: from DM6PR04MB5211.namprd04.prod.outlook.com (20.178.24.208) by DM6PR04MB4777.namprd04.prod.outlook.com (20.176.107.206) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.1922.15; Sun, 26 May 2019 15:10:36 +0000
Received: from DM6PR04MB5211.namprd04.prod.outlook.com ([fe80::510a:3a42:f346:a4d8]) by DM6PR04MB5211.namprd04.prod.outlook.com ([fe80::510a:3a42:f346:a4d8%7]) with mapi id 15.20.1922.021; Sun, 26 May 2019 15:10:36 +0000
From: Ken Brown <kbrown@cornell.edu>
To: "cygwin-patches@cygwin.com" <cygwin-patches@cygwin.com>
Subject: [PATCH draft 2/6] Cygwin: fhandler_pipe: add raw_read and raw_write
Date: Sun, 26 May 2019 15:10:00 -0000
Message-ID: <20190526151019.2187-3-kbrown@cornell.edu>
References: <20190526151019.2187-1-kbrown@cornell.edu>
In-Reply-To: <20190526151019.2187-1-kbrown@cornell.edu>
authentication-results: spf=none (sender IP is ) smtp.mailfrom=kbrown@cornell.edu;
x-ms-oob-tlc-oobclassifiers: OLM:1201;
received-spf: None (protection.outlook.com: cornell.edu does not designate permitted sender hosts)
x-ms-exchange-senderadcheck: 1
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: ksb2@cornell.edu
X-IsSubscribed: yes
X-SW-Source: 2019-q2/txt/msg00119.txt.bz2

LS0tDQogd2luc3VwL2N5Z3dpbi9maGFuZGxlci5oICAgICAgIHwgICAyICsN
CiB3aW5zdXAvY3lnd2luL2ZoYW5kbGVyX3BpcGUuY2MgfCAxNjQgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrDQogMiBmaWxlcyBjaGFuZ2Vk
LCAxNjYgaW5zZXJ0aW9ucygrKQ0KDQpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5
Z3dpbi9maGFuZGxlci5oIGIvd2luc3VwL2N5Z3dpbi9maGFuZGxlci5oDQpp
bmRleCBiZGZlNGEyNzIuLmI5Y2M3YjQ3MSAxMDA2NDQNCi0tLSBhL3dpbnN1
cC9jeWd3aW4vZmhhbmRsZXIuaA0KKysrIGIvd2luc3VwL2N5Z3dpbi9maGFu
ZGxlci5oDQpAQCAtMTIwNiw2ICsxMjA2LDggQEAgcHVibGljOg0KICAgY2hh
ciAqZ2V0X3Byb2NfZmRfbmFtZSAoY2hhciAqYnVmKTsNCiAgIGludCBvcGVu
IChpbnQgZmxhZ3MsIG1vZGVfdCBtb2RlID0gMCk7DQogICBpbnQgZHVwIChm
aGFuZGxlcl9iYXNlICpjaGlsZCwgaW50KTsNCisgIHZvaWQgX19yZWczIHJh
d19yZWFkICh2b2lkICpwdHIsIHNpemVfdCYgbGVuKTsNCisgIHNzaXplX3Qg
X19yZWczIHJhd193cml0ZSAoY29uc3Qgdm9pZCAqcHRyLCBzaXplX3QgbGVu
KTsNCiAgIGludCBpb2N0bCAodW5zaWduZWQgaW50IGNtZCwgdm9pZCAqKTsN
CiAgIGludCBfX3JlZzIgZnN0YXQgKHN0cnVjdCBzdGF0ICpidWYpOw0KICAg
aW50IF9fcmVnMiBmc3RhdHZmcyAoc3RydWN0IHN0YXR2ZnMgKmJ1Zik7DQpk
aWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9waXBlLmNjIGIv
d2luc3VwL2N5Z3dpbi9maGFuZGxlcl9waXBlLmNjDQppbmRleCAyZWE2OWY4
ZWQuLjQ3NjVhZGM4ZCAxMDA2NDQNCi0tLSBhL3dpbnN1cC9jeWd3aW4vZmhh
bmRsZXJfcGlwZS5jYw0KKysrIGIvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9w
aXBlLmNjDQpAQCAtMjAsNiArMjAsMTQgQEAgZGV0YWlscy4gKi8NCiAjaW5j
bHVkZSAicGluZm8uaCINCiAjaW5jbHVkZSAic2hhcmVkX2luZm8uaCINCiAN
CisvKiBUaGlzIGlzIG9ubHkgdG8gYmUgdXNlZCBmb3Igd3JpdGluZy4gIFdo
ZW4gcmVhZGluZywNCitTVEFUVVNfUElQRV9FTVBUWSBzaW1wbHkgbWVhbnMg
dGhlcmUncyBubyBkYXRhIHRvIGJlIHJlYWQuICovDQorI2RlZmluZSBTVEFU
VVNfUElQRV9JU19DTE9TRUQoc3RhdHVzKQlcDQorCQkoeyBOVFNUQVRVUyBf
cyA9IChzdGF0dXMpOyBcDQorCQkgICBfcyA9PSBTVEFUVVNfUElQRV9DTE9T
SU5HIFwNCisJCSAgIHx8IF9zID09IFNUQVRVU19QSVBFX0JST0tFTiBcDQor
CQkgICB8fCBfcyA9PSBTVEFUVVNfUElQRV9FTVBUWTsgfSkNCisNCiBmaGFu
ZGxlcl9waXBlOjpmaGFuZGxlcl9waXBlICgpDQogICA6IGZoYW5kbGVyX2Jh
c2UgKCksIHBvcGVuX3BpZCAoMCkNCiB7DQpAQCAtMTg0LDYgKzE5MiwxNjIg
QEAgZmhhbmRsZXJfcGlwZTo6Z2V0X3Byb2NfZmRfbmFtZSAoY2hhciAqYnVm
KQ0KICAgcmV0dXJuIGJ1ZjsNCiB9DQogDQordm9pZCBfX3JlZzMNCitmaGFu
ZGxlcl9waXBlOjpyYXdfcmVhZCAodm9pZCAqcHRyLCBzaXplX3QmIGxlbikN
Cit7DQorICBOVFNUQVRVUyBzdGF0dXM7DQorICBJT19TVEFUVVNfQkxPQ0sg
aW87DQorICBIQU5ETEUgZXZ0ID0gTlVMTDsNCisgIERXT1JEIHdhaXRyZXQg
PSBXQUlUX09CSkVDVF8wOw0KKw0KKyAgLyogQ3JlYXRlIGEgd2FpdCBldmVu
dCBpZiB3ZSdyZSBpbiBibG9ja2luZyBtb2RlLiAqLw0KKyAgaWYgKCFpc19u
b25ibG9ja2luZyAoKSAmJiAhKGV2dCA9IENyZWF0ZUV2ZW50IChOVUxMLCBm
YWxzZSwgZmFsc2UsIE5VTEwpKSkNCisgICAgew0KKyAgICAgIGxlbiA9IChz
aXplX3QpIC0xOw0KKyAgICAgIF9fc2V0ZXJybm8gKCk7DQorICAgICAgcmV0
dXJuOw0KKyAgICB9DQorDQorICBzdGF0dXMgPSBOdFJlYWRGaWxlIChnZXRf
aGFuZGxlICgpLCBldnQsIE5VTEwsIE5VTEwsICZpbywgcHRyLCBsZW4sDQor
CQkgICAgICAgTlVMTCwgTlVMTCk7DQorICBpZiAoZXZ0ICYmIHN0YXR1cyA9
PSBTVEFUVVNfUEVORElORykNCisgICAgew0KKyAgICAgIHdhaXRyZXQgPSBj
eWd3YWl0IChldnQsIGN3X2luZmluaXRlLCBjd19jYW5jZWwgfCBjd19zaWdf
ZWludHIpOw0KKyAgICAgIGlmICh3YWl0cmV0ID09IFdBSVRfT0JKRUNUXzAp
DQorCXN0YXR1cyA9IGlvLlN0YXR1czsNCisgICAgfQ0KKyAgaWYgKHdhaXRy
ZXQgPT0gV0FJVF9DQU5DRUxFRCkNCisgICAgc3RhdHVzID0gU1RBVFVTX1RI
UkVBRF9DQU5DRUxFRDsNCisgIGVsc2UgaWYgKHdhaXRyZXQgPT0gV0FJVF9T
SUdOQUxFRCkNCisgICAgc3RhdHVzID0gU1RBVFVTX1RIUkVBRF9TSUdOQUxF
RDsNCisgIGVsc2UgaWYgKE5UX1NVQ0NFU1MgKHN0YXR1cykpDQorICAgIGxl
biA9IGlvLkluZm9ybWF0aW9uOw0KKyAgZWxzZQ0KKyAgICB7DQorICAgICAg
LyogU29tZSBlcnJvcnMgYXJlIG5vdCByZWFsbHkgZXJyb3JzLiAgRGV0ZWN0
IHN1Y2ggY2FzZXMgaGVyZS4gICovDQorICAgICAgc3dpdGNoIChzdGF0dXMp
DQorCXsNCisJY2FzZSBTVEFUVVNfRU5EX09GX0ZJTEU6DQorCWNhc2UgU1RB
VFVTX1BJUEVfQlJPS0VOOg0KKwkgIC8qIFRoaXMgaXMgcmVhbGx5IEVPRi4g
ICovDQorCSAgbGVuID0gMDsNCisJICBicmVhazsNCisJY2FzZSBTVEFUVVNf
TU9SRV9FTlRSSUVTOg0KKwljYXNlIFNUQVRVU19CVUZGRVJfT1ZFUkZMT1c6
DQorCSAgLyogYGlvLkluZm9ybWF0aW9uJyBpcyBzdXBwb3NlZGx5IHZhbGlk
LiAgKi8NCisJICBsZW4gPSBpby5JbmZvcm1hdGlvbjsNCisJICBicmVhazsN
CisJY2FzZSBTVEFUVVNfUElQRV9MSVNURU5JTkc6DQorCWNhc2UgU1RBVFVT
X1BJUEVfRU1QVFk6DQorCSAgaWYgKGlzX25vbmJsb2NraW5nICgpKQ0KKwkg
ICAgew0KKwkgICAgICBzZXRfZXJybm8gKEVBR0FJTik7DQorCSAgICAgIGxl
biA9IChzaXplX3QpIC0xOw0KKwkgICAgICBicmVhazsNCisJICAgIH0NCisJ
ICAvKiBGYWxsIHRocm91Z2guICovDQorCWRlZmF1bHQ6DQorCSAgX19zZXRl
cnJub19mcm9tX250X3N0YXR1cyAoc3RhdHVzKTsNCisJICBsZW4gPSAoc2l6
ZV90KSAtMTsNCisJICBicmVhazsNCisJfQ0KKyAgICB9DQorICBpZiAoZXZ0
KQ0KKyAgICBDbG9zZUhhbmRsZSAoZXZ0KTsNCisgIGlmIChzdGF0dXMgPT0g
U1RBVFVTX1RIUkVBRF9TSUdOQUxFRCAmJiAhX215X3Rscy5jYWxsX3NpZ25h
bF9oYW5kbGVyICgpKQ0KKyAgICB7DQorICAgICAgc2V0X2Vycm5vIChFSU5U
Uik7DQorICAgICAgbGVuID0gKHNpemVfdCkgLTE7DQorICAgIH0NCisgIGVs
c2UgaWYgKHN0YXR1cyA9PSBTVEFUVVNfVEhSRUFEX0NBTkNFTEVEKQ0KKyAg
ICBwdGhyZWFkOjpzdGF0aWNfY2FuY2VsX3NlbGYgKCk7DQorfQ0KKw0KK3Nz
aXplX3QgX19yZWczDQorZmhhbmRsZXJfcGlwZTo6cmF3X3dyaXRlIChjb25z
dCB2b2lkICpwdHIsIHNpemVfdCBsZW4pDQorew0KKyAgc3NpemVfdCByZXQg
PSAtMTsNCisgIHNpemVfdCBuYnl0ZXMgPSAwLCBjaHVuazsNCisgIE5UU1RB
VFVTIHN0YXR1cyA9IFNUQVRVU19TVUNDRVNTOw0KKyAgSU9fU1RBVFVTX0JM
T0NLIGlvOw0KKyAgSEFORExFIGV2dCA9IE5VTEw7DQorDQorICBpZiAobGVu
IDw9IG1heF9hdG9taWNfd3JpdGUpDQorICAgIGNodW5rID0gbGVuOw0KKyAg
ZWxzZSBpZiAoaXNfbm9uYmxvY2tpbmcgKCkpDQorICAgIGNodW5rID0gbGVu
ID0gbWF4X2F0b21pY193cml0ZTsNCisgIGVsc2UNCisgICAgY2h1bmsgPSBt
YXhfYXRvbWljX3dyaXRlOw0KKw0KKyAgLyogQ3JlYXRlIGEgd2FpdCBldmVu
dCBpZiB0aGUgcGlwZSBpcyBpbiBibG9ja2luZyBtb2RlLiAqLw0KKyAgaWYg
KCFpc19ub25ibG9ja2luZyAoKSAmJiAhKGV2dCA9IENyZWF0ZUV2ZW50IChO
VUxMLCBmYWxzZSwgZmFsc2UsIE5VTEwpKSkNCisgICAgcmV0dXJuIC0xOw0K
Kw0KKyAgLyogV3JpdGUgaW4gY2h1bmtzLCBhY2N1bXVsYXRpbmcgYSB0b3Rh
bC4gIElmIHRoZXJlJ3MgYW4gZXJyb3IsIGp1c3QNCisgICAgIHJldHVybiB0
aGUgYWNjdW11bGF0ZWQgdG90YWwgdW5sZXNzIHRoZSBmaXJzdCB3cml0ZSBm
YWlscywgaW4NCisgICAgIHdoaWNoIGNhc2UgcmV0dXJuIC0xLiAqLw0KKyAg
d2hpbGUgKG5ieXRlcyA8IGxlbikNCisgICAgew0KKyAgICAgIFVMT05HX1BU
UiBuYnl0ZXNfbm93ID0gMDsNCisgICAgICBzaXplX3QgbGVmdCA9IGxlbiAt
IG5ieXRlczsNCisgICAgICBzaXplX3QgbGVuMTsNCisgICAgICBpZiAobGVm
dCA+IGNodW5rKQ0KKwlsZW4xID0gY2h1bms7DQorICAgICAgZWxzZQ0KKwls
ZW4xID0gbGVmdDsNCisgICAgICBuYnl0ZXNfbm93ID0gMDsNCisgICAgICBz
dGF0dXMgPSBOdFdyaXRlRmlsZSAoZ2V0X2hhbmRsZSAoKSwgZXZ0LCBOVUxM
LCBOVUxMLCAmaW8sDQorCQkJICAgIChQVk9JRCkgcHRyLCBsZW4xLCBOVUxM
LCBOVUxMKTsNCisgICAgICBpZiAoZXZ0ICYmIHN0YXR1cyA9PSBTVEFUVVNf
UEVORElORykNCisJew0KKwkgIERXT1JEIHdhaXRyZXQgPSBjeWd3YWl0IChl
dnQsIGN3X2luZmluaXRlLCBjd19jYW5jZWwgfCBjd19zaWdfZWludHIpOw0K
KwkgIHN3aXRjaCAod2FpdHJldCkNCisJICAgIHsNCisJICAgIGNhc2UgV0FJ
VF9PQkpFQ1RfMDoNCisJICAgICAgc3RhdHVzID0gaW8uU3RhdHVzOw0KKwkg
ICAgICBicmVhazsNCisJICAgIGNhc2UgV0FJVF9TSUdOQUxFRDoNCisJICAg
ICAgc3RhdHVzID0gU1RBVFVTX1RIUkVBRF9TSUdOQUxFRDsNCisJICAgICAg
YnJlYWs7DQorCSAgICBjYXNlIFdBSVRfQ0FOQ0VMRUQ6DQorCSAgICAgIHN0
YXR1cyA9IFNUQVRVU19USFJFQURfQ0FOQ0VMRUQ7DQorCSAgICAgIGJyZWFr
Ow0KKwkgICAgZGVmYXVsdDoNCisJICAgICAgYnJlYWs7DQorCSAgICB9DQor
CX0NCisgICAgICBpZiAoTlRfU1VDQ0VTUyAoc3RhdHVzKSkNCisJew0KKwkg
IG5ieXRlc19ub3cgPSBpby5JbmZvcm1hdGlvbjsNCisJICAvKiBOdFdyaXRl
RmlsZSByZXR1cm5zIHN1Y2Nlc3Mgd2l0aCAjIG9mIGJ5dGVzIHdyaXR0ZW4g
PT0gMA0KKwkgICAgIGlmIHdyaXRpbmcgb24gYSBub24tYmxvY2tpbmcgcGlw
ZSBmYWlscyBiZWNhdXNlIHRoZSBwaXBlDQorCSAgICAgYnVmZmVyIGRvZXNu
J3QgaGF2ZSBzdWZmaWNpZW50IHNwYWNlLiAqLw0KKwkgIGlmIChuYnl0ZXNf
bm93ID09IDApDQorCSAgICBzZXRfZXJybm8gKEVBR0FJTik7DQorCSAgcHRy
ID0gKChjaGFyICopIHB0cikgKyBjaHVuazsNCisJICBuYnl0ZXMgKz0gbmJ5
dGVzX25vdzsNCisJfQ0KKyAgICAgIGVsc2UgaWYgKFNUQVRVU19QSVBFX0lT
X0NMT1NFRCAoc3RhdHVzKSkNCisJew0KKwkgIHNldF9lcnJubyAoRVBJUEUp
Ow0KKwkgIHJhaXNlIChTSUdQSVBFKTsNCisJfQ0KKyAgICAgIGVsc2UNCisJ
X19zZXRlcnJub19mcm9tX250X3N0YXR1cyAoc3RhdHVzKTsNCisgICAgICBp
ZiAobmJ5dGVzX25vdyA9PSAwKQ0KKwlsZW4gPSAwOwkJLyogVGVybWluYXRl
IGxvb3AuICovDQorICAgICAgaWYgKG5ieXRlcyA+IDApDQorCXJldCA9IG5i
eXRlczsNCisgICAgfQ0KKyAgaWYgKGV2dCkNCisgICAgQ2xvc2VIYW5kbGUg
KGV2dCk7DQorICBpZiAoc3RhdHVzID09IFNUQVRVU19USFJFQURfU0lHTkFM
RUQgJiYgIV9teV90bHMuY2FsbF9zaWduYWxfaGFuZGxlciAoKSkNCisgICAg
c2V0X2Vycm5vIChFSU5UUik7DQorICBlbHNlIGlmIChzdGF0dXMgPT0gU1RB
VFVTX1RIUkVBRF9DQU5DRUxFRCkNCisgICAgcHRocmVhZDo6c3RhdGljX2Nh
bmNlbF9zZWxmICgpOw0KKyAgcmV0dXJuIHJldDsNCit9DQorDQogaW50DQog
ZmhhbmRsZXJfcGlwZTo6ZHVwIChmaGFuZGxlcl9iYXNlICpjaGlsZCwgaW50
IGZsYWdzKQ0KIHsNCi0tIA0KMi4xNy4wDQoNCg==
