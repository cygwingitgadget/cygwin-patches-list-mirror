From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-patches@cygwin.com>
Subject: Categories and basic dependency handling for setup
Date: Tue, 12 Jun 2001 23:38:00 -0000
Message-id: <EA18B9FA0FE4194AA2B4CDB91F73C0EF7A00@itdomain002.itdomain.net.au>
X-SW-Source: 2001-q2/msg00287.html
Content-type: multipart/mixed; boundary="----------=_1583532848-65438-66"

This is a multi-part message in MIME format...

------------=_1583532848-65438-66
Content-length: 1024

This supercedes my prior patch. (laziness here - diff against cvs is
much nicer than forking my sandbox between patches.)

2001-06-13 16:27:00 Robert Collins <rbtcollins@hotmail.com

	* choose.cc: Add "Category" header.
	(paint): Render the category.
	(best_trust): Don't trust non required packages. No category is
considered required. Ignore categories when the ignore_required
parameter is set.
	(create_listview): Calculate "Category" column.
	(do_choose): Log package category.
	(add_required): Ensure that all packages that are required for
package p will be installed.
	(list_click): Use add_required().
	(dialog_cmd): Check add_required() for all packages.
	* ini.h (Package): Add category field.
	(Dependency): New type for storing dependency data.
	(new_requirement): Prototype for function to add a requirement
dependency.
	* inilex.l: Add "category" and "requires" keywords.
	* iniparse.y: Grab category.
	(new_requirement): Add a required package into the required
dependency list for the current package.

Rob

------------=_1583532848-65438-66
Content-Type: text/x-diff; charset=us-ascii; name="depends.patch"
Content-Disposition: inline; filename="depends.patch"
Content-Transfer-Encoding: base64
Content-Length: 16113

PyBjYXRlZ29yeS5wYXRjaAo/IGRlcGVuZHMucGF0Y2gKSW5kZXg6IGNob29z
ZS5jYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3ZzL3Ny
Yy9zcmMvd2luc3VwL2NpbnN0YWxsL2Nob29zZS5jYyx2CnJldHJpZXZpbmcg
cmV2aXNpb24gMi4yMwpkaWZmIC11IC1wIC1yMi4yMyBjaG9vc2UuY2MKLS0t
IGNob29zZS5jYwkyMDAxLzA1LzI3IDE5OjQzOjUyCTIuMjMKKysrIGNob29z
ZS5jYwkyMDAxLzA2LzEzIDA2OjMxOjEzCkBAIC04NywxNCArODcsMTkgQEAg
aGVhZGVyc1tdID0gewogI2RlZmluZSBORVdfQ09MIDEKICAgeyAiU3JjPyIs
IDQsIDAsIDAgfSwKICNkZWZpbmUgU1JDX0NPTCAyCisgIHsgIkNhdGVnb3J5
IiwgOCwgMCwgMCB9LAorI2RlZmluZSBDQVRFR09SWV9DT0wgMwogICB7ICJQ
YWNrYWdlIiwgNywgMCwgMCB9LAotI2RlZmluZSBQQUNLQUdFX0NPTCAzCisj
ZGVmaW5lIFBBQ0tBR0VfQ09MIDQKICAgeyAwLCAwLCAwLCAwIH0KIH07CiAj
ZGVmaW5lIE5VTV9DT0xVTU5TIChzaXplb2YgKGhlYWRlcnMpIC8gKHNpemVv
ZiAoaGVhZGVyc1swXSkpIC0gMSkKIAogaW50ICpwYWNrYWdlX2luZGV4ZXMs
IG5pbmRleGVzOwogCitzdGF0aWMgaW50IGFkZF9yZXF1aXJlZChpbnQgcCk7
CitzdGF0aWMgdm9pZCBzZXRfZnVsbF9saXN0IChIV05EIGgsIGludCBpc2Z1
bGwpOworCiBzdHJ1Y3QgRXh0cmFQYWNrYWdlSW5mbwogICB7CiAgICAgY2hh
ciAqaW5zdGFsbGVkX2ZpbGU7CS8qIGZpbGVuYW1lIG9mIHByZXZpb3VzICJp
bnN0YWxsIiBmaWxlICovCkBAIC0xODgsNiArMTkzLDkgQEAgcGFpbnQgKEhX
TkQgaHduZCkKICAgICAgIEJpdEJsdCAoaGRjLCB4ICsgaGVhZGVyc1tTUkNf
Q09MXS54LCBieSwgMTEsIDExLAogCSAgICAgIGJpdG1hcF9kYywgMCwgMCwg
U1JDQ09QWSk7CiAKKyAgICAgIGlmIChwYWNrYWdlW2ldLmNhdGVnb3J5KQor
CVRleHRPdXQgKGhkYywgeCArIGhlYWRlcnNbQ0FURUdPUllfQ09MXS54LCBy
LCBwYWNrYWdlW2ldLmNhdGVnb3J5LCBzdHJsZW4gKHBhY2thZ2VbaV0uY2F0
ZWdvcnkpKTsKKwogICAgICAgaWYgKHBhY2thZ2VbaV0ubmFtZSkKIAlUZXh0
T3V0IChoZGMsIHggKyBoZWFkZXJzW1BBQ0tBR0VfQ09MXS54LCByLCBwYWNr
YWdlW2ldLm5hbWUsIHN0cmxlbiAocGFja2FnZVtpXS5uYW1lKSk7CiAgICAg
fQpAQCAtMjc4LDYgKzI4Niw3IEBAIHN0YXRpYyBMUkVTVUxUIENBTExCQUNL
CiBsaXN0X2NsaWNrIChIV05EIGh3bmQsIEJPT0wgZGJsY2xrLCBpbnQgeCwg
aW50IHksIFVJTlQgaGl0Q29kZSkKIHsKICAgaW50IHI7CisgIGludCByZWZy
ZXNoOwogCiAgIGlmIChuaW5kZXhlcyA9PSAwKQogICAgIHJldHVybiAwOwpA
QCAtMzA1LDYgKzMxNCw4IEBAIGxpc3RfY2xpY2sgKEhXTkQgaHduZCwgQk9P
TCBkYmxjbGssIGludCAKIAlleHRyYVtwXS5waWNrKys7CiAgICAgICBpZiAo
ZXh0cmFbcF0uY2hvb3NlcltleHRyYVtwXS5waWNrXS5jYXB0aW9uID09IDAp
CiAJZXh0cmFbcF0ucGljayA9IDA7CisgICAgICAvKiBBZGQgYW55IHBhY2th
Z2VzIHRoYXQgYXJlIG5lZWRlZCBieSB0aGlzIHBhY2thZ2UgKi8KKyAgICAg
IHJlZnJlc2ggPSBhZGRfcmVxdWlyZWQocCk7CiAgICAgfQogCiAgIGlmICh4
ID49IGhlYWRlcnNbU1JDX0NPTF0ueCAtIEhNQVJHSU4vMiAmJiB4IDw9IGhl
YWRlcnNbU1JDX0NPTCArIDFdLnggLSBITUFSR0lOLzIpCkBAIC0zMTIsMTMg
KzMyMywzNCBAQCBsaXN0X2NsaWNrIChIV05EIGh3bmQsIEJPT0wgZGJsY2xr
LCBpbnQgCiAgICAgICBpZiAoZXh0cmFbcF0uY2hvb3NlcltleHRyYVtwXS5w
aWNrXS5zcmNfYXZhaWwpCiAJcGFja2FnZVtwXS5zcmNhY3Rpb24gXj0gKFNS
Q0FDVElPTl9OT15TUkNBQ1RJT05fWUVTKTsKICAgICB9CisKKyAgaWYgKHJl
ZnJlc2gpCisgICAgeyAKKyAgICAgIFJFQ1QgcjsKKyAgICAgIEdldENsaWVu
dFJlY3QgKGx2LCAmcik7CisgICAgICBTQ1JPTExJTkZPIHNpOworICAgICAg
bWVtc2V0ICgmc2ksIDAsIHNpemVvZiAoc2kpKTsKKyAgICAgIHNpLmNiU2l6
ZSA9IHNpemVvZiAoc2kpOworICAgICAgc2kuZk1hc2sgPSBTSUZfQUxMOwor
ICAgICAgc2kubk1pbiA9IDA7CisKKyAgICAgIHNpLm5NYXggPSBuaW5kZXhl
cyAqIHJvd19oZWlnaHQ7CisgICAgICBzaS5uUGFnZSA9IHIuYm90dG9tIC0g
aGVhZGVyX2hlaWdodDsKKyAgICAgIFNldFNjcm9sbEluZm8gKGx2LCBTQl9W
RVJULCAmc2ksIFRSVUUpOworCisgICAgICBzY3JvbGxfdWxjX3ggPSBzY3Jv
bGxfdWxjX3kgPSAwOwogCi0gIFJFQ1QgcmVjdDsKLSAgcmVjdC5sZWZ0ID0g
aGVhZGVyc1tORVdfQ09MXS54IC0gc2Nyb2xsX3VsY194OwotICByZWN0LnJp
Z2h0ID0gaGVhZGVyc1tTUkNfQ09MICsgMV0ueCAtIHNjcm9sbF91bGNfeDsK
LSAgcmVjdC50b3AgPSBoZWFkZXJfaGVpZ2h0ICsgciAqIHJvd19oZWlnaHQg
LSBzY3JvbGxfdWxjX3k7Ci0gIHJlY3QuYm90dG9tID0gcmVjdC50b3AgKyBy
b3dfaGVpZ2h0OwotICBJbnZhbGlkYXRlUmVjdCAoaHduZCwgJnJlY3QsIFRS
VUUpOworICAgICAgSW52YWxpZGF0ZVJlY3QgKGx2LCAmciwgVFJVRSk7Cisg
ICAgfQorICBlbHNlCisgICAgeworICAgICAgUkVDVCByZWN0OworICAgICAg
cmVjdC5sZWZ0ID0gaGVhZGVyc1tORVdfQ09MXS54IC0gc2Nyb2xsX3VsY194
OworICAgICAgcmVjdC5yaWdodCA9IGhlYWRlcnNbU1JDX0NPTCArIDFdLngg
LSBzY3JvbGxfdWxjX3g7CisgICAgICByZWN0LnRvcCA9IGhlYWRlcl9oZWln
aHQgKyByICogcm93X2hlaWdodCAtIHNjcm9sbF91bGNfeTsKKyAgICAgIHJl
Y3QuYm90dG9tID0gcmVjdC50b3AgKyByb3dfaGVpZ2h0OworICAgICAgSW52
YWxpZGF0ZVJlY3QgKGh3bmQsICZyZWN0LCBUUlVFKTsKKyAgICB9CiB9CiAK
IHN0YXRpYyBMUkVTVUxUIENBTExCQUNLCkBAIC00MzIsNyArNDY0LDcgQEAg
c2V0X2V4aXN0ZW5jZSAoKQogfQogCiBzdGF0aWMgaW50Ci1iZXN0X3RydXN0
IChpbnQgcCwgaW50IHRydXN0KQorYmVzdF90cnVzdCAoaW50IHAsIGludCB0
cnVzdCwgaW50IGlnbm9yZV9jYXRlZ29yaWVzKQogewogICBpbnQgdDsKICAg
dCA9IHRydXN0OwpAQCAtNDQwLDEyICs0NzIsOTcgQEAgYmVzdF90cnVzdCAo
aW50IHAsIGludCB0cnVzdCkKICAgICAgICgocGFja2FnZVtwXS5pbmZvW3Rd
Lmluc3RhbGxfZXhpc3RzICYmIHNvdXJjZSA9PSBJRENfU09VUkNFX0NXRCkg
fHwKICAgICAgICAocGFja2FnZVtwXS5pbmZvW3RdLmluc3RhbGxfZXhpc3Rz
ID09IDAgJiYKIAlzb3VyY2UgPT0gSURDX1NPVVJDRV9ET1dOTE9BRCkgfHwg
c291cmNlID09IElEQ19TT1VSQ0VfTkVUSU5TVCkpCi0gICAgcmV0dXJuIHQ7
CisgICAgeworICAgICAgaWYgKCFpZ25vcmVfY2F0ZWdvcmllcyAmJiBwYWNr
YWdlW3BdLmNhdGVnb3J5IAorCSYmIHN0cmNhc2VjbXAocGFja2FnZVtwXS5j
YXRlZ29yeSwgIlJlcXVpcmVkIikpCisgICAgICAgIHJldHVybiBUUlVTVF9O
T05FOworICAgICAgZWxzZQorCXJldHVybiB0OworICAgIH0KICAgaWYgKGV4
dHJhW3BdLmluc3RhbGxlZF9maWxlICYmIGV4dHJhW3BdLmluc3RhbGxlZF92
ZXIgPT0gcGFja2FnZVtwXS5pbmZvW3RdLnZlcnNpb24pCiAgICAgcmV0dXJu
IFRSVVNUX0tFRVA7CiAgIHJldHVybiBUUlVTVF9OT05FOwogfQogCitzdGF0
aWMgaW50CitmaW5kX3BhY2thZ2UgKGNvbnN0IGNoYXIgKm5hbWUpCit7Cisg
IGludCBpOworICBmb3IgKGk9MDsgaSA8IG5wYWNrYWdlczsgaSsrKQorICAg
IHsKKyAgICAgIGlmICghc3RyY2FzZWNtcChuYW1lLCBwYWNrYWdlW2ldLm5h
bWUpKQorCXJldHVybiBpOworICAgIH0KKyAgcmV0dXJuIC0xOworfQorCitz
dGF0aWMgaW50IAorYWRkX3JlcXVpcmVkIChpbnQgcCkKK3sKKyAgRGVwZW5k
ZW5jeSAqZHA7CisgIGludCBpOworICBpbnQgYzsKKyAgaW50IGNoYW5nZWQg
PSAwOworICBkcCA9IHBhY2thZ2VbcF0ucmVxdWlyZWQ7CisgIHN3aXRjaCAo
ZXh0cmFbcF0uY2hvb3NlcltleHRyYVtwXS5waWNrXS50cnVzdCkKKyAgICB7
CisgICAgY2FzZSBUUlVTVF9VTklOU1RBTEw6CisgICAgY2FzZSBUUlVTVF9O
T05FOgorICAgIGNhc2UgVFJVU1RfU1JDX09OTFk6CisgICAgICByZXR1cm4g
MDsKKyAgICBkZWZhdWx0OgorICAgICAgYnJlYWs7CisgICAgfQorICB3aGls
ZSAoZHApCisgICAgeworICAgICAgaWYgKChpID0gZmluZF9wYWNrYWdlKGRw
LT5wYWNrYWdlKSkgPT0gLTEpCisJeworCSAgZHA9ZHAtPm5leHQ7CisJICBj
b250aW51ZTsKKwl9CisgICAgICBzd2l0Y2ggKGV4dHJhW2ldLmNob29zZXJb
ZXh0cmFbaV0ucGlja10udHJ1c3QpCisgICAgICAgIHsKKyAgICAgICAgY2Fz
ZSBUUlVTVF9QUkVWOgorICAgICAgICBjYXNlIFRSVVNUX0NVUlI6CisgICAg
ICAgIGNhc2UgVFJVU1RfVEVTVDoKKyAgICAgICAgY2FzZSBUUlVTVF9SRURP
OgorCWNhc2UgVFJVU1RfS0VFUDoKKyAgICAgICAgICBicmVhazsKKworICAg
ICAgICBjYXNlIFRSVVNUX1VOSU5TVEFMTDoKKwkgIHBhY2thZ2VbaV0udHJ1
c3QgPSBUUlVTVF9LRUVQOworICAgICAgICAgIGJyZWFrOworCisJY2FzZSBU
UlVTVF9OT05FOgorCSAgcGFja2FnZV9pbmRleGVzW25pbmRleGVzKytdID0g
aTsKKyAgICAgICAgY2FzZSBUUlVTVF9TUkNfT05MWToKKyAgICAgICAgICBp
ZiAoISBleHRyYVtpXS53aGljaF9pc19pbnN0YWxsZWQgPj0gMCkKKwkgICAg
eworCSAgICAgIC8qIHByZWZlciB0aGUgY3VycmVudCB2ZXJzaW9uLCB0aGVu
IHByZXYsIHRoZW4gZXhwZXJpbWVudGFsICovCisgICAgICAgICAgICAgIHBh
Y2thZ2VbaV0udHJ1c3QgPSBiZXN0X3RydXN0IChpLCBUUlVTVF9DVVJSLCAx
KTsKKwkgICAgICBpZiAocGFja2FnZVtpXS50cnVzdCAhPSBUUlVTVF9DVVJS
KQorCSAgICAgICAgeworCSAgICAgICAgICBwYWNrYWdlW2ldLnRydXN0ID0g
YmVzdF90cnVzdCAoaSwgVFJVU1RfUFJFViwgMSk7CisJCSAgaWYgKHBhY2th
Z2VbaV0udHJ1c3QgIT0gVFJVU1RfUFJFVikKKwkJICAgIHBhY2thZ2VbaV0u
dHJ1c3QgPSBiZXN0X3RydXN0IChpLCBUUlVTVF9URVNULCAxKTsKKwkgICAg
ICAgIH0KKwkgICAgfQorCSAgZWxzZQorIAkgICAgcGFja2FnZVtpXS50cnVz
dCA9IFRSVVNUX0tFRVA7CisJICBjaGFuZ2VkKys7CisgICAgICAgICAgYnJl
YWs7CisKKwlkZWZhdWx0OgorCSAgYnJlYWs7CisJfQorICAgICAgZm9yIChj
ID0gMDsgYyA8IGV4dHJhW2ldLm5waWNrOyBjKyspCisJaWYgKHBhY2thZ2Vb
aV0udHJ1c3QgPT0gZXh0cmFbaV0uY2hvb3NlcltjXS50cnVzdCkKKwkgIGV4
dHJhW2ldLnBpY2sgPSBjOworICAgICAgZHA9ZHAtPm5leHQ7CisgICAgfQor
ICByZXR1cm4gY2hhbmdlZDsKK30KKwogc3RhdGljIHZvaWQKIGRlZmF1bHRf
dHJ1c3QgKEhXTkQgaCwgaW50IHRydXN0KQogewpAQCAtNDUzLDcgKzU3MCw3
IEBAIGRlZmF1bHRfdHJ1c3QgKEhXTkQgaCwgaW50IHRydXN0KQogCiAgIGZv
ciAoaSA9IDA7IGkgPCBucGFja2FnZXM7IGkrKykKICAgICB7Ci0gICAgICB0
ID0gYmVzdF90cnVzdCAoaSwgdHJ1c3QpOworICAgICAgdCA9IGJlc3RfdHJ1
c3QgKGksIHRydXN0LCAwKTsKICAgICAgIGV4dHJhW2ldLnBpY2sgPSAxOwog
ICAgICAgcGFja2FnZVtpXS50cnVzdCA9IHQ7CiAgICAgICBmb3IgKGMgPSAw
OyBjIDwgZXh0cmFbaV0ubnBpY2s7IGMrKykKQEAgLTY0MCw2ICs3NTcsNyBA
QCBjcmVhdGVfbGlzdHZpZXcgKEhXTkQgZGxnLCBSRUNUICpyKQogICAgICAg
Zm9yICh0ID0gMDsgdCA8IE5UUlVTVDsgdCsrKQogCW5vdGVfd2lkdGggKGRj
LCBwYWNrYWdlW2ldLmluZm9bdF0udmVyc2lvbiwgTkVXX0NPTF9TSVpFX1NM
T1AsIE5FV19DT0wpOwogICAgICAgbm90ZV93aWR0aCAoZGMsIHBhY2thZ2Vb
aV0ubmFtZSwgMCwgUEFDS0FHRV9DT0wpOworICAgICAgbm90ZV93aWR0aCAo
ZGMsIHBhY2thZ2VbaV0uY2F0ZWdvcnksIDAsIENBVEVHT1JZX0NPTCk7CiAg
ICAgICBub3RlX3dpZHRoIChkYywgcGFja2FnZVtpXS5zZGVzYywgMCwgUEFD
S0FHRV9DT0wpOwogICAgIH0KICAgbm90ZV93aWR0aCAoZGMsICJrZWVwIiwg
TkVXX0NPTF9TSVpFX1NMT1AsIE5FV19DT0wpOwpAQCAtNjQ4LDEwICs3NjYs
MTMgQEAgY3JlYXRlX2xpc3R2aWV3IChIV05EIGRsZywgUkVDVCAqcikKICAg
aGVhZGVyc1tDVVJSRU5UX0NPTF0ueCA9IEhNQVJHSU4vMjsKICAgaGVhZGVy
c1tORVdfQ09MXS54ID0gaGVhZGVyc1tDVVJSRU5UX0NPTF0ueCArIGhlYWRl
cnNbQ1VSUkVOVF9DT0xdLndpZHRoICsgTkVXX0NPTF9TSVpFX1NMT1AgKyBI
TUFSR0lOOwogICBoZWFkZXJzW1NSQ19DT0xdLnggPSBoZWFkZXJzW05FV19D
T0xdLnggKyBoZWFkZXJzW05FV19DT0xdLndpZHRoICsgSE1BUkdJTjsKLSAg
aGVhZGVyc1tQQUNLQUdFX0NPTF0ueCA9IGhlYWRlcnNbU1JDX0NPTF0ueCAr
IGhlYWRlcnNbU1JDX0NPTF0ud2lkdGggKyBITUFSR0lOOworICBoZWFkZXJz
W0NBVEVHT1JZX0NPTF0ueCA9IGhlYWRlcnNbU1JDX0NPTF0ueCArIGhlYWRl
cnNbU1JDX0NPTF0ud2lkdGggKyBITUFSR0lOOworICBoZWFkZXJzW1BBQ0tB
R0VfQ09MXS54ID0gaGVhZGVyc1tDQVRFR09SWV9DT0xdLnggKyBoZWFkZXJz
W0NBVEVHT1JZX0NPTF0ud2lkdGggKyBITUFSR0lOOwogCiAgIGRlZmF1bHRf
dHJ1c3QgKGx2LCBUUlVTVF9DVVJSKTsKICAgc2V0X2Z1bGxfbGlzdCAobHYs
IGZ1bGxfbGlzdCk7CisgIGZvciAoaSA9IDA7IGkgPCBucGFja2FnZXM7IGkr
KykKKyAgICBhZGRfcmVxdWlyZWQoaSk7CiAgIHN0YXRpYyBpbnQgdGFbXSA9
IHsgSURDX0NIT09TRV9DVVJSLCAwIH07CiAgIHJic2V0IChkbGcsIHRhLCBJ
RENfQ0hPT1NFX0NVUlIpOwogCkBAIC02NjEsMTggKzc4MiwyNSBAQCBjcmVh
dGVfbGlzdHZpZXcgKEhXTkQgZGxnLCBSRUNUICpyKQogc3RhdGljIEJPT0wK
IGRpYWxvZ19jbWQgKEhXTkQgaCwgaW50IGlkLCBIV05EIGh3bmRjdGwsIFVJ
TlQgY29kZSkKIHsKKyAgaW50IGk7CiAgIHN3aXRjaCAoaWQpCiAgICAgewog
ICAgIGNhc2UgSURDX0NIT09TRV9QUkVWOgogICAgICAgZGVmYXVsdF90cnVz
dCAobHYsIFRSVVNUX1BSRVYpOworICAgICAgZm9yIChpID0gMDsgaSA8IG5w
YWNrYWdlczsgaSsrKQorICAgICAgICBhZGRfcmVxdWlyZWQoaSk7CiAgICAg
ICBzZXRfZnVsbF9saXN0IChsdiwgZnVsbF9saXN0KTsKICAgICAgIGJyZWFr
OwogICAgIGNhc2UgSURDX0NIT09TRV9DVVJSOgogICAgICAgZGVmYXVsdF90
cnVzdCAobHYsIFRSVVNUX0NVUlIpOworICAgICAgZm9yIChpID0gMDsgaSA8
IG5wYWNrYWdlczsgaSsrKQorICAgICAgICBhZGRfcmVxdWlyZWQoaSk7CiAg
ICAgICBzZXRfZnVsbF9saXN0IChsdiwgZnVsbF9saXN0KTsKICAgICAgIGJy
ZWFrOwogICAgIGNhc2UgSURDX0NIT09TRV9FWFA6CiAgICAgICBkZWZhdWx0
X3RydXN0IChsdiwgVFJVU1RfVEVTVCk7CisgICAgICBmb3IgKGkgPSAwOyBp
IDwgbnBhY2thZ2VzOyBpKyspCisgICAgICAgIGFkZF9yZXF1aXJlZChpKTsK
ICAgICAgIHNldF9mdWxsX2xpc3QgKGx2LCBmdWxsX2xpc3QpOwogICAgICAg
YnJlYWs7CiAgICAgY2FzZSBJRENfQ0hPT1NFX0ZVTExQQVJUOgpAQCAtMTA5
Niw5ICsxMjI0LDExIEBAIGRvX2Nob29zZSAoSElOU1RBTkNFIGgpCiAJCQkg
ICAgICAgOiAidW5rbm93biIpOwogICAgICAgY29uc3QgY2hhciAqcGFydGlh
bF9saXN0ID0gKChleHRyYVtpXS5pbl9wYXJ0aWFsX2xpc3QgPT0gMSkgPyAi
eWVzIiA6ICJubyIpOwogCi0gICAgICBsb2cgKExPR19CQUJCTEUsICJbJXNd
IGFjdGlvbj0lcyB0cnVzdD0lcyBpbnN0YWxsZWQ9JXMgcGFydGlhbF9saXN0
PSVzIHNyYz89JXMiLAorICAgICAgbG9nIChMT0dfQkFCQkxFLCAiWyVzXSBh
Y3Rpb249JXMgdHJ1c3Q9JXMgaW5zdGFsbGVkPSVzIHBhcnRpYWxfbGlzdD0l
cyBzcmM/PSVzIgorCSAgICIgY2F0ZWdvcnk9JXMiLAogCSAgIHBhY2thZ2Vb
aV0ubmFtZSwgYWN0aW9uLCB0cnVzdCwgaW5zdGFsbGVkLAotCSAgIHBhcnRp
YWxfbGlzdCwgcGFja2FnZVtpXS5zcmNhY3Rpb24gPT0gU1JDQUNUSU9OX05P
ID8gIm5vIiA6ICJ5ZXMiKTsKKwkgICBwYXJ0aWFsX2xpc3QsIHBhY2thZ2Vb
aV0uc3JjYWN0aW9uID09IFNSQ0FDVElPTl9OTyA/ICJubyIgOiAieWVzIiwg
CisJICAgcGFja2FnZVtpXS5jYXRlZ29yeSk7CiAgICAgICBmb3IgKGludCB0
ID0gMDsgdCA8IE5UUlVTVDsgdCsrKQogCXsKIAkgIGlmIChwYWNrYWdlW2ld
LmluZm9bdF0uaW5zdGFsbCkKSW5kZXg6IGluaS5oCj09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY2luc3Rh
bGwvaW5pLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuNwpkaWZmIC11IC1w
IC1yMi43IGluaS5oCi0tLSBpbmkuaAkyMDAxLzA1LzI3IDA3OjA1OjA5CTIu
NworKysgaW5pLmgJMjAwMS8wNi8xMyAwNjozMToxMwpAQCAtNTIsMTQgKzUy
LDIzIEBAIHR5cGVkZWYgc3RydWN0CiAgIGludCBwYXJ0aWFsX2xpc3RfZGlz
cGxheTsvKiBkaXNwbGF5IHRoaXMgdmVyc2lvbiBpbiBwYXJ0aWFsIGxpc3Qg
Ki8KIH0gSW5mbzsJCQkvKiArMSBmb3IgVFJVU1RfVU5LTk9XTiAqLwogCit0
eXBlZGVmIHN0cnVjdCBEZXBlbmRlbmN5X3QgRGVwZW5kZW5jeTsKK3N0cnVj
dCBEZXBlbmRlbmN5X3QKK3sKKyAgRGVwZW5kZW5jeSAqbmV4dDsgLyogdGhl
IG5leHQgcGFja2FnZSBpbiB0aGlzIGRlcGVuZGVuY3kgbGlzdCAqLworICBj
aGFyICpwYWNrYWdlOyAgICAvKiB0aGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0
aGF0IGlzIGRlcGVuZGVkIG9uICovCit9OyAgICAgICAgICAgICAgICAgIC8q
IERlcGVuZGVuY2llcyBjYW4gYmUgdXNlZCBmb3IgcmVjb21tZW5kZWQvcmVx
dWlyZWQvcmVsYXRlZC4uLiAqLworCiB0eXBlZGVmIHN0cnVjdAogewogICBj
aGFyICpuYW1lOwkvKiBwYWNrYWdlIG5hbWUsIGxpa2UgImN5Z3dpbiIgKi8K
ICAgY2hhciAqc2Rlc2M7CS8qIHNob3J0IGRlc2NyaXB0aW9uIChyZXBsYWNl
cyAibmFtZSIgaWYgcHJvdmlkZWQpICovCiAgIGNoYXIgKmxkZXNjOwkvKiBs
b25nIGRlc2NyaXB0aW9uIChtdWx0aS1saW5lKSAqLworICBjaGFyICpjYXRl
Z29yeTsgLyogdGhlIGNhdGVnb3J5IHRoZSBwYWNrYWdlIGJlbG9uZ3MgdG8s
IGxpa2UgInJlcXVpcmVkIiBvciAiWEZyZWU4NiIgKi8KICAgaW50IGFjdGlv
bjsJLyogQUNUSU9OXyogLSBvbmx5IE5FVyBhbmQgVVBHUkFERSBnZXQgaW5z
dGFsbGVkICovCiAgIGludCBzcmNhY3Rpb247LyogU1JDQUNUSU9OXyAqLwog
ICBpbnQgdHJ1c3Q7CS8qIFRSVVNUXyogKHNlbGVjdHMgYW1vbmcgaW5mb1td
IGJlbG93KSAqLworICBEZXBlbmRlbmN5ICpyZXF1aXJlZDsgLyogdGhlIHBh
Y2thZ2VzIHJlcXVpcmVkIGZvciB0aGlzIHBhY2thZ2UgdG8gd29yayAqLwog
CiAgIEluZm8gaW5mb1tOVFJVU1QgKyAxXTsgLyogKzEgZm9yIFRSVVNUX1VO
S05PV04gKi8KIH0gUGFja2FnZTsKQEAgLTczLDYgKzgyLDcgQEAgZXh0ZXJu
ICJDIiB7CiAKIFBhY2thZ2UgKm5ld19wYWNrYWdlIChjaGFyICpuYW1lKTsK
IHZvaWQJaW5pX2luaXQgKGNoYXIgKnN0cmluZyk7Cit2b2lkICAgIG5ld19y
ZXF1aXJlbWVudChQYWNrYWdlICpwYWNrYWdlLCBjaGFyICpkZXBlbmRzb24p
OwogCiAjZGVmaW5lIHBpIChwYWNrYWdlW2ldLmluZm9bcGFja2FnZVtpXS50
cnVzdF0pCiAKSW5kZXg6IGluaWxleC5sCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY2luc3RhbGwvaW5p
bGV4LmwsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuMgpkaWZmIC11IC1wIC1y
Mi4yIGluaWxleC5sCi0tLSBpbmlsZXgubAkyMDAxLzA1LzMwIDAxOjM4OjQx
CTIuMgorKysgaW5pbGV4LmwJMjAwMS8wNi8xMyAwNjozMToxMwpAQCAtNDcs
NiArNDcsOCBAQCBTVFIJW2EtekEtWjAtOV8uLystXSsKICJzZXR1cC10aW1l
c3RhbXA6IglyZXR1cm4gU0VUVVBfVElNRVNUQU1QOwogInNldHVwLXZlcnNp
b246IglyZXR1cm4gU0VUVVBfVkVSU0lPTjsKICJ2ZXJzaW9uOiIJCXJldHVy
biBWRVJTSU9OOworImNhdGVnb3J5OiIJCXJldHVybiBDQVRFR09SWTsKKyJy
ZXF1aXJlczoiCQlyZXR1cm4gUkVRVUlSRVM7CiAiaW5zdGFsbDoiCQlyZXR1
cm4gSU5TVEFMTDsKICJzb3VyY2U6IgkJcmV0dXJuIFNPVVJDRTsKICJzZGVz
YzoiCQlyZXR1cm4gU0RFU0M7CkluZGV4OiBpbmlwYXJzZS55Cj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAv
Y2luc3RhbGwvaW5pcGFyc2UueSx2CnJldHJpZXZpbmcgcmV2aXNpb24gMi42
CmRpZmYgLXUgLXAgLXIyLjYgaW5pcGFyc2UueQotLS0gaW5pcGFyc2UueQky
MDAxLzA1LzI3IDE5OjQzOjUyCTIuNgorKysgaW5pcGFyc2UueQkyMDAxLzA2
LzEzIDA2OjMxOjEzCkBAIC00Myw3ICs0Myw3IEBAIGV4dGVybiBpbnQgeXls
aW5lbm87CiAlfQogCiAldG9rZW4gU1RSSU5HCi0ldG9rZW4gU0VUVVBfVElN
RVNUQU1QIFNFVFVQX1ZFUlNJT04gVkVSU0lPTiBJTlNUQUxMIFNPVVJDRSBT
REVTQyBMREVTQworJXRva2VuIFNFVFVQX1RJTUVTVEFNUCBTRVRVUF9WRVJT
SU9OIFZFUlNJT04gSU5TVEFMTCBTT1VSQ0UgU0RFU0MgTERFU0MgQ0FURUdP
UlkgUkVRVUlSRVMKICV0b2tlbiBUX1BSRVYgVF9DVVJSIFRfVEVTVCBUX1VO
S05PV04KIAogJSUKQEAgLTgxLDYgKzgxLDcgQEAgbGluZXMKIAogc2ltcGxl
X2xpbmUKICA6IFZFUlNJT04gU1RSSU5HCQl7IGNwdC0+dmVyc2lvbiA9ICQy
OyB9CisgfCBDQVRFR09SWSBTVFJJTkcJCXsgY3AtPmNhdGVnb3J5ID0gJDI7
IH0KICB8IFNERVNDIFNUUklORwkJCXsgY3AtPnNkZXNjID0gJDI7IH0KICB8
IExERVNDIFNUUklORwkJCXsgY3AtPmxkZXNjID0gJDI7IH0KICB8IElOU1RB
TEwgU1RSSU5HIFNUUklORwl7IGNwdC0+aW5zdGFsbCA9ICQyOwpAQCAtOTgs
NiArOTksNyBAQCBzaW1wbGVfbGluZQogIHwgVF9DVVJSCQkJeyB0cnVzdCA9
IFRSVVNUX0NVUlI7IH0KICB8IFRfVEVTVAkJCXsgdHJ1c3QgPSBUUlVTVF9U
RVNUOyB9CiAgfCBUX1VOS05PV04JCQl7IHRydXN0ID0gVFJVU1RfVU5LTk9X
TjsgfQorIHwgUkVRVUlSRVMgcmVxdWlyZXMKICB8IC8qIGVtcHR5ICovCiAg
fCBlcnJvciAnXG4nIHsgeXlsaW5lbm8gLS07CiAJCXl5ZXJyb3IgKCJ1bnJl
Y29nbml6ZWQgbGluZSBpbiBwYWNrYWdlICVzIChkbyB5b3UgaGF2ZSB0aGUg
bGF0ZXN0IHNldHVwPykiLCBjcC0+bmFtZSk7CkBAIC0xMDUsNiArMTA3LDEw
IEBAIHNpbXBsZV9saW5lCiAJICAgICAgfQogIDsKIAorcmVxdWlyZXMKKyA6
IFNUUklORyB7IG5ld19yZXF1aXJlbWVudChjcCwgJDEpOyB9IHJlcXVpcmVz
CisgfCBTVFJJTkcgeyBuZXdfcmVxdWlyZW1lbnQoY3AsICQxKTsgfQorIDsK
ICUlCiAKIFBhY2thZ2UgKnBhY2thZ2UgPSAwOwpAQCAtMTMzLDQgKzEzOSwx
NiBAQCBuZXdfcGFja2FnZSAoY2hhciAqbmFtZSkKICAgdHJ1c3QgPSBUUlVT
VF9DVVJSOwogCiAgIHJldHVybiBjcDsKK30KKwordm9pZCAKK25ld19yZXF1
aXJlbWVudChQYWNrYWdlICpwYWNrYWdlLCBjaGFyICpkZXBlbmRzb24pCit7
CisgIERlcGVuZGVuY3kgKmRwOworICBpZiAoIWRlcGVuZHNvbikKKyAgICBy
ZXR1cm47CisgIGRwID0gKERlcGVuZGVuY3kgKikgbWFsbG9jIChzaXplb2Yg
KERlcGVuZGVuY3kpKTsKKyAgZHAtPm5leHQgPSBjcC0+cmVxdWlyZWQ7Cisg
IGRwLT5wYWNrYWdlID0gZGVwZW5kc29uOworICBjcC0+cmVxdWlyZWQgPSBk
cDsKIH0K

------------=_1583532848-65438-66--
