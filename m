Return-Path: <SRS0=jo1Y=SY=t-online.de=Christian.Franke@sourceware.org>
Received: from mailout08.t-online.de (mailout08.t-online.de [194.25.134.20])
	by sourceware.org (Postfix) with ESMTPS id EE51A3858C53
	for <cygwin-patches@cygwin.com>; Fri, 29 Nov 2024 17:48:40 +0000 (GMT)
DMARC-Filter: OpenDMARC Filter v1.4.2 sourceware.org EE51A3858C53
Authentication-Results: sourceware.org; dmarc=none (p=none dis=none) header.from=t-online.de
Authentication-Results: sourceware.org; spf=pass smtp.mailfrom=t-online.de
ARC-Filter: OpenARC Filter v1.0.0 sourceware.org EE51A3858C53
Authentication-Results: server2.sourceware.org; arc=none smtp.remote-ip=194.25.134.20
ARC-Seal: i=1; a=rsa-sha256; d=sourceware.org; s=key; t=1732902521; cv=none;
	b=fRU8y+PF3Gw/cM2IABZ+S4CmKsE30+PqTS5LWCkQD9hX8h6dx67mho/1FlDYpUcKKphCsrO8St5v8CTZYbYK+nO7vwOoAFZ1YTdHWnSLrw3A2k133HFnnqQnQ//LdDpUL44IiRUUyZkIEKfKt7G60ohCWVmfJmlxeYcyRpaHF2k=
ARC-Message-Signature: i=1; a=rsa-sha256; d=sourceware.org; s=key;
	t=1732902521; c=relaxed/simple;
	bh=N8E1MFEPDWMpCbwzvFleBoKrVO7SVuYMejfWkTOyOO0=;
	h=To:From:Subject:Message-ID:Date:MIME-Version; b=C9THAf3JN3WDJZlt07PpgLGmsrsajDrRsQ9YSQXuSTtpRSD1Qm/o1DYZfZRDu01eTfWHkTgjubwVa5/sjpbHolPW36ppTHqDIj9x3kBQxMy3BzqJ6huSI+b4Ba+oXWzQXBsTXY/gn0S9Qnmqn0A9JRSgLwlPHaHlfb+vbERthjk=
ARC-Authentication-Results: i=1; server2.sourceware.org
Received: from fwd74.aul.t-online.de (fwd74.aul.t-online.de [10.223.144.100])
	by mailout08.t-online.de (Postfix) with SMTP id 3D0243CC
	for <cygwin-patches@cygwin.com>; Fri, 29 Nov 2024 18:48:34 +0100 (CET)
Received: from [192.168.2.101] ([91.57.241.70]) by fwd74.t-online.de
	with (TLSv1.3:TLS_AES_256_GCM_SHA384 encrypted)
	esmtp id 1tH56U-0xqbxI0; Fri, 29 Nov 2024 18:48:30 +0100
To: cygwin-patches@cygwin.com
Reply-To: cygwin-patches@cygwin.com
From: Christian Franke <Christian.Franke@t-online.de>
Subject: [PATCH] Cygwin: sched_setscheduler: accept SCHED_OTHER, SCHED_FIFO
 and SCHED_RR
Message-ID: <eabbcf15-1605-8b77-bf77-ec5fde2d6001@t-online.de>
Date: Fri, 29 Nov 2024 18:48:29 +0100
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101
 SeaMonkey/2.53.19
MIME-Version: 1.0
Content-Type: multipart/mixed;
 boundary="------------53A3A61C880019396D3A7ABD"
X-TOI-EXPURGATEID: 150726::1732902510-C0FF810B-08D6E605/0/0 CLEAN NORMAL
X-TOI-MSGID: 3425dffb-dfe7-4373-85b1-59acbcfb28e2
X-Spam-Status: No, score=-10.7 required=5.0 tests=BAYES_00,FREEMAIL_FROM,GIT_PATCH_0,KAM_DMARC_STATUS,RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE,SPF_PASS,TXREP autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on server2.sourceware.org
List-Id: <cygwin-patches.cygwin.com>

This is a multi-part message in MIME format.
--------------53A3A61C880019396D3A7ABD
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

A very first attempt to let sched_setscheduler() do something possibly 
useful.

This patch is on top of
Cygwin: setpriority, sched_setparam: add missing process access right

-- 
Regards,
Christian


--------------53A3A61C880019396D3A7ABD
Content-Type: text/plain; charset=UTF-8;
 name="0001-Cygwin-sched_setscheduler-accept-SCHED_OTHER-SCHED_F.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename*0="0001-Cygwin-sched_setscheduler-accept-SCHED_OTHER-SCHED_F.pa";
 filename*1="tch"

RnJvbSA1NGE5YjdiZTJhYjQyODQyMDNkYWFmMTU0NDc4MTE4Y2M1MjQwOWNmIE1vbiBTZXAg
MTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RpYW4gRnJhbmtlIDxjaHJpc3RpYW4uZnJh
bmtlQHQtb25saW5lLmRlPgpEYXRlOiBGcmksIDI5IE5vdiAyMDI0IDE4OjQxOjEyICswMTAw
ClN1YmplY3Q6IFtQQVRDSF0gQ3lnd2luOiBzY2hlZF9zZXRzY2hlZHVsZXI6IGFjY2VwdCBT
Q0hFRF9PVEhFUiwgU0NIRURfRklGTwogYW5kIFNDSEVEX1JSCgpJZiBTQ0hFRF9PVEhFUiBp
cyBzZWxlY3RlZCwgc2V0IHRoZSBXaW5kb3dzIHByaW9yaXR5IGFjY29yZGluZyB0byB0aGUK
bmljZSB2YWx1ZS4gIElmIFNDSEVEX0ZJRk8gb3IgU0NIRURfUlIgaXMgc2VsZWN0ZWQsIHBy
ZXNlcnZlIHRoZSBuaWNlCnZhbHVlIGFuZCBzZXQgdGhlIFdpbmRvd3MgcHJpb3JpdHkgYWNj
b3JkaW5nIHRvIHRoZSBzY2hlZF9wcmlvcml0eQpwYXJhbWV0ZXIuCgpTaWduZWQtb2ZmLWJ5
OiBDaHJpc3RpYW4gRnJhbmtlIDxjaHJpc3RpYW4uZnJhbmtlQHQtb25saW5lLmRlPgotLS0K
IHdpbnN1cC9jeWd3aW4vZm9yay5jYyAgICAgICAgICAgICAgICAgICAgfCAgIDEgKwogd2lu
c3VwL2N5Z3dpbi9sb2NhbF9pbmNsdWRlcy9taXNjZnVuY3MuaCB8ICAgMiArLQogd2luc3Vw
L2N5Z3dpbi9sb2NhbF9pbmNsdWRlcy9waW5mby5oICAgICB8ICAgNCArLQogd2luc3VwL2N5
Z3dpbi9taXNjZnVuY3MuY2MgICAgICAgICAgICAgICB8ICAyMyArKystLQogd2luc3VwL2N5
Z3dpbi9waW5mby5jYyAgICAgICAgICAgICAgICAgICB8ICAgMSArCiB3aW5zdXAvY3lnd2lu
L3JlbGVhc2UvMy42LjAgICAgICAgICAgICAgIHwgICA4ICsrCiB3aW5zdXAvY3lnd2luL3Nj
aGVkLmNjICAgICAgICAgICAgICAgICAgIHwgMTIyICsrKysrKysrKysrKysrLS0tLS0tLS0t
CiB3aW5zdXAvY3lnd2luL3NwYXduLmNjICAgICAgICAgICAgICAgICAgIHwgICAxICsKIHdp
bnN1cC9jeWd3aW4vc3lzY2FsbHMuY2MgICAgICAgICAgICAgICAgfCAgMTkgKystLQogOSBm
aWxlcyBjaGFuZ2VkLCAxMTggaW5zZXJ0aW9ucygrKSwgNjMgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9mb3JrLmNjIGIvd2luc3VwL2N5Z3dpbi9mb3JrLmNj
CmluZGV4IDA3NDJhYjM2My4uN2Q5NzZlODgyIDEwMDY0NAotLS0gYS93aW5zdXAvY3lnd2lu
L2ZvcmsuY2MKKysrIGIvd2luc3VwL2N5Z3dpbi9mb3JrLmNjCkBAIC00MDIsNiArNDAyLDcg
QEAgZnJvazo6cGFyZW50ICh2b2xhdGlsZSBjaGFyICogdm9sYXRpbGUgc3RhY2tfaGVyZSkK
ICAgICB9CiAKICAgY2hpbGQtPm5pY2UgPSBteXNlbGYtPm5pY2U7CisgIGNoaWxkLT5zY2hl
ZF9wb2xpY3kgPSBteXNlbGYtPnNjaGVkX3BvbGljeTsKIAogICAvKiBJbml0aWFsaXplIHRo
aW5ncyB0aGF0IGFyZSBkb25lIGxhdGVyIGluIGRsbF9jcnQwXzEgdGhhdCBhcmVuJ3QgZG9u
ZQogICAgICBmb3IgdGhlIGZvcmtlZS4gICovCmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2lu
L2xvY2FsX2luY2x1ZGVzL21pc2NmdW5jcy5oIGIvd2luc3VwL2N5Z3dpbi9sb2NhbF9pbmNs
dWRlcy9taXNjZnVuY3MuaAppbmRleCBlZmQ3ZTUxNmIuLjU3ZGNiZmVhYiAxMDA2NDQKLS0t
IGEvd2luc3VwL2N5Z3dpbi9sb2NhbF9pbmNsdWRlcy9taXNjZnVuY3MuaAorKysgYi93aW5z
dXAvY3lnd2luL2xvY2FsX2luY2x1ZGVzL21pc2NmdW5jcy5oCkBAIC00Niw3ICs0Niw3IEBA
IGlzX2FsdF9udW1wYWRfZXZlbnQgKFBJTlBVVF9SRUNPUkQgcGlyZWMpCiAKIGludCB3aW5w
cmlvX3RvX25pY2UgKERXT1JEKTsKIERXT1JEIG5pY2VfdG9fd2lucHJpbyAoaW50ICYpOwot
Ym9vbCBzZXRfYW5kX2NoZWNrX3dpbnByaW8gKEhBTkRMRSBwcm9jLCBEV09SRCBwcmlvKTsK
K2Jvb2wgc2V0X2FuZF9jaGVja193aW5wcmlvIChIQU5ETEUgcHJvYywgRFdPUkQgcHJpbywg
Ym9vbCBzZXQgPSB0cnVlKTsKIAogYm9vbCBjcmVhdGVfcGlwZSAoUEhBTkRMRSwgUEhBTkRM
RSwgTFBTRUNVUklUWV9BVFRSSUJVVEVTLCBEV09SRCk7CiAKZGlmZiAtLWdpdCBhL3dpbnN1
cC9jeWd3aW4vbG9jYWxfaW5jbHVkZXMvcGluZm8uaCBiL3dpbnN1cC9jeWd3aW4vbG9jYWxf
aW5jbHVkZXMvcGluZm8uaAppbmRleCA0NjNmMGU4NTEuLjAzZTBjNGQ2MCAxMDA2NDQKLS0t
IGEvd2luc3VwL2N5Z3dpbi9sb2NhbF9pbmNsdWRlcy9waW5mby5oCisrKyBiL3dpbnN1cC9j
eWd3aW4vbG9jYWxfaW5jbHVkZXMvcGluZm8uaApAQCAtOTIsNyArOTIsOSBAQCBwdWJsaWM6
CiAgIGxvbmcgc3RhcnRfdGltZTsKICAgc3RydWN0IHJ1c2FnZSBydXNhZ2Vfc2VsZjsKICAg
c3RydWN0IHJ1c2FnZSBydXNhZ2VfY2hpbGRyZW47Ci0gIGludCBuaWNlOworCisgIGludCBu
aWNlOyAgICAgICAgICAvKiBuaWNlIHZhbHVlIGZvciBTQ0hFRF9PVEhFUi4gKi8KKyAgaW50
IHNjaGVkX3BvbGljeTsgIC8qIFNDSEVEX09USEVSLCBTQ0hFRF9GSUZPIG9yIFNDSEVEX1JS
LiAqLwogCiAgIC8qIE5vbi16ZXJvIGlmIHByb2Nlc3Mgd2FzIHN0b3BwZWQgYnkgYSBzaWdu
YWwuICovCiAgIGNoYXIgc3RvcHNpZzsKZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4vbWlz
Y2Z1bmNzLmNjIGIvd2luc3VwL2N5Z3dpbi9taXNjZnVuY3MuY2MKaW5kZXggZWJlNDAxYjkz
Li4wMTQ2NzA0ZWEgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4vbWlzY2Z1bmNzLmNjCisr
KyBiL3dpbnN1cC9jeWd3aW4vbWlzY2Z1bmNzLmNjCkBAIC0xODUsOSArMTg1LDEwIEBAIG5p
Y2VfdG9fd2lucHJpbyAoaW50ICZuaWNlKQogCiAvKiBTZXQgV2luMzIgcHJpb3JpdHkgb3Ig
cmV0dXJuIGZhbHNlIG9uIGZhaWx1cmUuICBBbHNvIHJldHVybgogICAgZmFsc2UgYW5kIHJl
dmVydCB0byB0aGUgb3JpZ2luYWwgcHJpb3JpdHkgaWYgYSBkaWZmZXJlbnQgKGxvd2VyKQot
ICAgcHJpb3JpdHkgaXMgc2V0IGluc3RlYWQuICovCisgICBwcmlvcml0eSBpcyBzZXQgaW5z
dGVhZC4gIEFsd2F5cyByZXZlcnQgdG8gb3JpZ2luYWwgcHJpb3JpdHkgaWYKKyAgIHNldD09
ZmFsc2UuICovCiBib29sCi1zZXRfYW5kX2NoZWNrX3dpbnByaW8gKEhBTkRMRSBwcm9jLCBE
V09SRCBwcmlvKQorc2V0X2FuZF9jaGVja193aW5wcmlvIChIQU5ETEUgcHJvYywgRFdPUkQg
cHJpbywgYm9vbCBzZXQgLyogPSB0cnVlICovKQogewogICBEV09SRCBwcmV2X3ByaW8gPSBH
ZXRQcmlvcml0eUNsYXNzIChwcm9jKTsKICAgaWYgKCFwcmV2X3ByaW8pCkBAIC0yMDIsMTYg
KzIwMywyMCBAQCBzZXRfYW5kX2NoZWNrX3dpbnByaW8gKEhBTkRMRSBwcm9jLCBEV09SRCBw
cmlvKQogICAgICB0aGUgbmV3IHByaW9yaXR5IChSRUFMVElNRV9QUklPUklUWV9DTEFTUykg
cmVxdWlyZXMgYWRtaW5pc3RyYXRvcgogICAgICBwcml2aWxlZ2VzLiAqLwogICBEV09SRCBj
dXJyX3ByaW8gPSBHZXRQcmlvcml0eUNsYXNzIChwcm9jKTsKLSAgaWYgKGN1cnJfcHJpbyAh
PSBwcmlvKQorICBib29sIHJldCA9IChjdXJyX3ByaW8gPT0gcHJpbyk7CisKKyAgaWYgKHNl
dCkKICAgICB7Ci0gICAgICBkZWJ1Z19wcmludGYgKCJGYWlsZWQgdG8gc2V0IHByaW9yaXR5
IDB4JXgsIHJldmVydCBmcm9tIDB4JXggdG8gMHgleCIsCi0JcHJpbywgY3Vycl9wcmlvLCBw
cmV2X3ByaW8pOwotICAgICAgU2V0UHJpb3JpdHlDbGFzcyAocHJvYywgcHJldl9wcmlvKTsK
LSAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgIGlmIChyZXQpCisJZGVidWdfcHJpbnRmICgi
Q2hhbmdlZCBwcmlvcml0eSBmcm9tIDB4JXggdG8gMHgleCIsIHByZXZfcHJpbywgY3Vycl9w
cmlvKTsKKyAgICAgIGVsc2UKKwlkZWJ1Z19wcmludGYgKCJGYWlsZWQgdG8gc2V0IHByaW9y
aXR5IDB4JXgsIHJldmVydCBmcm9tIDB4JXggdG8gMHgleCIsCisJICBwcmlvLCBjdXJyX3By
aW8sIHByZXZfcHJpbyk7CiAgICAgfQorICBpZiAoIShzZXQgJiYgcmV0KSkKKyAgICBTZXRQ
cmlvcml0eUNsYXNzIChwcm9jLCBwcmV2X3ByaW8pOwogCi0gIGRlYnVnX3ByaW50ZiAoIkNo
YW5nZWQgcHJpb3JpdHkgZnJvbSAweCV4IHRvIDB4JXgiLCBwcmV2X3ByaW8sIGN1cnJfcHJp
byk7Ci0gIHJldHVybiB0cnVlOworICByZXR1cm4gcmV0OwogfQogCiAvKiBNaW5pbWFsIG92
ZXJsYXBwZWQgcGlwZSBJL08gaW1wbGVtZW50YXRpb24gZm9yIHNpZ25hbCBhbmQgY29tbXVu
ZSBzdHVmZi4gKi8KZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4vcGluZm8uY2MgYi93aW5z
dXAvY3lnd2luL3BpbmZvLmNjCmluZGV4IGUzMWE2N2Q4Zi4uMDZjOTY2ZjFlIDEwMDY0NAot
LS0gYS93aW5zdXAvY3lnd2luL3BpbmZvLmNjCisrKyBiL3dpbnN1cC9jeWd3aW4vcGluZm8u
Y2MKQEAgLTEwMiw2ICsxMDIsNyBAQCBwaW5mb19pbml0IChjaGFyICoqZW52cCwgaW50IGVu
dmMpCiAgICAgICBteXNlbGYtPmdpZCA9IElMTEVHQUxfR0lEOwogICAgICAgZW52aXJvbl9p
bml0IChOVUxMLCAwKTsJLyogY2FsbCBhZnRlciBteXNlbGYgaGFzIGJlZW4gc2V0IHVwICov
CiAgICAgICBteXNlbGYtPm5pY2UgPSB3aW5wcmlvX3RvX25pY2UgKEdldFByaW9yaXR5Q2xh
c3MgKEdldEN1cnJlbnRQcm9jZXNzICgpKSk7CisgICAgICBteXNlbGYtPnNjaGVkX3BvbGlj
eSA9IFNDSEVEX09USEVSOwogICAgICAgbXlzZWxmLT5wcGlkID0gMTsJCS8qIGFsd2F5cyBz
ZXQgbGFzdCAqLwogICAgICAgZGVidWdfcHJpbnRmICgiU2V0IG5pY2UgdG8gJWQiLCBteXNl
bGYtPm5pY2UpOwogICAgIH0KZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4vcmVsZWFzZS8z
LjYuMCBiL3dpbnN1cC9jeWd3aW4vcmVsZWFzZS8zLjYuMAppbmRleCAxYjJmMDBhZDguLjll
OTI0ZGFiYiAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9yZWxlYXNlLzMuNi4wCisrKyBi
L3dpbnN1cC9jeWd3aW4vcmVsZWFzZS8zLjYuMApAQCAtNTIsMyArNTIsMTEgQEAgV2hhdCBj
aGFuZ2VkOgogLSBuaWNlKDIpIG5vdyByZXR1cm5zIHRoZSBuZXcgbmljZSB2YWx1ZSBpbnN0
ZWFkIG9mIDAgb24gc3VjY2VzcwogICBhbmQgc2V0cyBlcnJubyB0byBFUEVSTSBpbnN0ZWFk
IG9mIEVBQ0NFUyBvbiBmYWlsdXJlLiAgVGhpcyBjb25maXJtcwogICB0byBQT1NJWCBhbmQg
TGludXggKGdsaWJjID49IDIuMi40KSBiZWhhdmlvci4KKworLSBzY2hlZF9zZXRzY2hlZHVs
ZXIoMikgbm93IGVtdWxhdGVzIGNoYW5nZXMgYmV0d2VlbiBTQ0hFRF9PVEhFUiwKKyAgU0NI
RURfRklGTyBhbmQgU0NIRURfUlIuICBJZiBTQ0hFRF9PVEhFUiBpcyBzZWxlY3RlZCwgdGhl
IFdpbmRvd3MKKyAgcHJpb3JpdHkgaXMgc2V0IGFjY29yZGluZyB0byB0aGUgbmljZSB2YWx1
ZS4gIElmIFNDSEVEX0ZJRk8gb3IKKyAgU0NIRURfUlIgaXMgc2VsZWN0ZWQsIHRoZSBuaWNl
IHZhbHVlIGlzIHByZXNlcnZlZCBhbmQgdGhlIFdpbmRvd3MKKyAgcHJpb3JpdHkgaXMgc2V0
IGFjY29yZGluZyB0byB0aGUgcmVhbHRpbWUgcHJpb3JpdHkuCisgIE5vdGU6IFdpbmRvd3Mg
ZG9lcyBub3Qgb2ZmZXIgYWx0ZXJuYXRpdmUgc2NoZWR1bGluZyBwb2xpY2llcyBzbworICB0
aGlzIGNvdWxkIG9ubHkgZW11bGF0ZSBBUEkgYmVoYXZpb3IuCmRpZmYgLS1naXQgYS93aW5z
dXAvY3lnd2luL3NjaGVkLmNjIGIvd2luc3VwL2N5Z3dpbi9zY2hlZC5jYwppbmRleCA2MWQ1
ZTdiZTQuLmM0OGM0MzNkNyAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9zY2hlZC5jYwor
KysgYi93aW5zdXAvY3lnd2luL3NjaGVkLmNjCkBAIC0zMyw5ICszMywxMCBAQCBzY2hlZF9n
ZXRfcHJpb3JpdHlfbWF4IChpbnQgcG9saWN5KQogewogICBzd2l0Y2ggKHBvbGljeSkKICAg
ICB7CisgICAgY2FzZSBTQ0hFRF9PVEhFUjoKKyAgICAgIHJldHVybiAwOwogICAgIGNhc2Ug
U0NIRURfRklGTzoKICAgICBjYXNlIFNDSEVEX1JSOgotICAgIGNhc2UgU0NIRURfT1RIRVI6
CiAgICAgICByZXR1cm4gMzI7CiAgICAgfQogICBzZXRfZXJybm8gKEVJTlZBTCk7CkBAIC00
OCw5ICs0OSwxMCBAQCBzY2hlZF9nZXRfcHJpb3JpdHlfbWluIChpbnQgcG9saWN5KQogewog
ICBzd2l0Y2ggKHBvbGljeSkKICAgICB7CisgICAgY2FzZSBTQ0hFRF9PVEhFUjoKKyAgICAg
IHJldHVybiAwOwogICAgIGNhc2UgU0NIRURfRklGTzoKICAgICBjYXNlIFNDSEVEX1JSOgot
ICAgIGNhc2UgU0NIRURfT1RIRVI6CiAgICAgICByZXR1cm4gMTsKICAgICB9CiAgIHNldF9l
cnJubyAoRUlOVkFMKTsKQEAgLTkwLDYgKzkyLDE0IEBAIHNjaGVkX2dldHBhcmFtIChwaWRf
dCBwaWQsIHN0cnVjdCBzY2hlZF9wYXJhbSAqcGFyYW0pCiAgICAgICBzZXRfZXJybm8gKEVT
UkNIKTsKICAgICAgIHJldHVybiAtMTsKICAgICB9CisKKyAgaWYgKHAtPnNjaGVkX3BvbGlj
eSA9PSBTQ0hFRF9PVEhFUikKKyAgICB7CisgICAgICAvKiBObyByZWFsdGltZSBwb2xpY3ku
ICovCisgICAgICBwYXJhbS0+c2NoZWRfcHJpb3JpdHkgPSAwOworICAgICAgcmV0dXJuIDA7
CisgICAgfQorCiAgIHByb2Nlc3MgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19RVUVSWV9MSU1J
VEVEX0lORk9STUFUSU9OLCBGQUxTRSwKIAkJCSBwLT5kd1Byb2Nlc3NJZCk7CiAgIGlmICgh
cHJvY2VzcykKQEAgLTEzMiw5ICsxNDIsNiBAQCBzY2hlZF9nZXRwYXJhbSAocGlkX3QgcGlk
LCBzdHJ1Y3Qgc2NoZWRfcGFyYW0gKnBhcmFtKQogfQogCiAvKiBnZXQgdGhlIHNjaGVkdWxl
ciBmb3IgcGlkCi0KLSAgIEFsbCBwcm9jZXNzJ3Mgb24gV0lOMzIgcnVuIHdpdGggU0NIRURf
RklGTy4gIFNvIHdlIGp1c3QgZ2l2ZSBhbiBhbnN3ZXIuCi0gICAoV0lOMzIgdXNlcyBhIG11
bHRpIHF1ZXVlIEZJRk8pLgogKi8KIGludAogc2NoZWRfZ2V0c2NoZWR1bGVyIChwaWRfdCBw
aWQpCkBAIC0xNDQsOCArMTUxLDEzIEBAIHNjaGVkX2dldHNjaGVkdWxlciAocGlkX3QgcGlk
KQogICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwogICAgICAgcmV0dXJuIC0xOwogICAgIH0K
LSAgZWxzZQotICAgIHJldHVybiBTQ0hFRF9GSUZPOworICBwaW5mbyBwIChwaWQgPyBwaWQg
OiBnZXRwaWQgKCkpOworICBpZiAoIXApCisgICAgeworICAgICAgc2V0X2Vycm5vIChFU1JD
SCk7CisgICAgICByZXR1cm4gLTE7CisgICAgfQorICByZXR1cm4gcC0+c2NoZWRfcG9saWN5
OwogfQogCiAvKiBnZXQgdGhlIHRpbWUgcXVhbnR1bSBmb3IgcGlkICovCkBAIC0yMTIsMzEg
KzIyNCwxOCBAQCBzY2hlZF9ycl9nZXRfaW50ZXJ2YWwgKHBpZF90IHBpZCwgc3RydWN0IHRp
bWVzcGVjICppbnRlcnZhbCkKIH0KIAogLyogc2V0IHRoZSBzY2hlZHVsaW5nIHBhcmFtZXRl
cnMgKi8KLWludAotc2NoZWRfc2V0cGFyYW0gKHBpZF90IHBpZCwgY29uc3Qgc3RydWN0IHNj
aGVkX3BhcmFtICpwYXJhbSkKK3N0YXRpYyBpbnQKK3NjaGVkX3NldHBhcmFtX3BpbmZvIChw
aW5mbyAmIHAsIGNvbnN0IHN0cnVjdCBzY2hlZF9wYXJhbSAqcGFyYW0pCiB7Ci0gIHBpZF90
IGxvY2FscGlkOwotICBpbnQgcHJpOwotICBEV09SRCBwY2xhc3M7Ci0gIEhBTkRMRSBwcm9j
ZXNzOwotCi0gIGlmICghcGFyYW0gfHwgcGlkIDwgMCkKLSAgICB7Ci0gICAgICBzZXRfZXJy
bm8gKEVJTlZBTCk7Ci0gICAgICByZXR1cm4gLTE7Ci0gICAgfQotCi0gIGlmICghdmFsaWRf
c2NoZWRfcGFyYW1ldGVycyAocGFyYW0pKQotICAgIHsKLSAgICAgIHNldF9lcnJubyAoRUlO
VkFMKTsKLSAgICAgIHJldHVybiAtMTsKLSAgICB9Ci0KLSAgcHJpID0gcGFyYW0tPnNjaGVk
X3ByaW9yaXR5OworICBpbnQgcHJpID0gcGFyYW0tPnNjaGVkX3ByaW9yaXR5OwogCiAgIC8q
IGNhbGN1bGF0ZSBvdXIgZGVzaXJlZCBwcmlvcml0eSBjbGFzcy4gIFdlIG9ubHkgcmVzZXJ2
ZSBhIHNtYWxsIGFyZWEKICAgICAgKDMxLzMyKSBmb3IgcmVhbHRpbWUgcHJpb3JpdHkuICov
Ci0gIGlmIChwcmkgPD0gNikKKyAgRFdPUkQgcGNsYXNzOworICBpZiAocC0+c2NoZWRfcG9s
aWN5ID09IFNDSEVEX09USEVSICYmIHByaSA9PSAwKQorICAgIC8qIE5vIHJlYWx0aW1lIHBv
bGljeSwgcmVhcHBseSB0aGUgbmljZSB2YWx1ZS4gKi8KKyAgICBwY2xhc3MgPSBuaWNlX3Rv
X3dpbnByaW8gKHAtPm5pY2UpOworICBlbHNlIGlmICgxIDw9IHByaSAmJiBwcmkgPD0gNikK
ICAgICBwY2xhc3MgPSBJRExFX1BSSU9SSVRZX0NMQVNTOwogICBlbHNlIGlmIChwcmkgPD0g
MTIpCiAgICAgcGNsYXNzID0gQkVMT1dfTk9STUFMX1BSSU9SSVRZX0NMQVNTOwpAQCAtMjQ2
LDIzICsyNDUsMTYgQEAgc2NoZWRfc2V0cGFyYW0gKHBpZF90IHBpZCwgY29uc3Qgc3RydWN0
IHNjaGVkX3BhcmFtICpwYXJhbSkKICAgICBwY2xhc3MgPSBBQk9WRV9OT1JNQUxfUFJJT1JJ
VFlfQ0xBU1M7CiAgIGVsc2UgaWYgKHByaSA8PSAzMCkKICAgICBwY2xhc3MgPSBISUdIX1BS
SU9SSVRZX0NMQVNTOwotICBlbHNlCisgIGVsc2UgaWYgKHByaSA8PSAzMikKICAgICBwY2xh
c3MgPSBSRUFMVElNRV9QUklPUklUWV9DTEFTUzsKLQotICBsb2NhbHBpZCA9IHBpZCA/IHBp
ZCA6IGdldHBpZCAoKTsKLQotICBwaW5mbyBwIChsb2NhbHBpZCk7Ci0KLSAgLyogc2V0IHRo
ZSBjbGFzcyAqLwotCi0gIGlmICghcCkKKyAgZWxzZQogICAgIHsKLSAgICAgIHNldF9lcnJu
byAoRVNSQ0gpOworICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwogICAgICAgcmV0dXJuIC0x
OwogICAgIH0KLSAgcHJvY2VzcyA9IE9wZW5Qcm9jZXNzIChQUk9DRVNTX1NFVF9JTkZPUk1B
VElPTiB8Ci0JCQkgUFJPQ0VTU19RVUVSWV9MSU1JVEVEX0lORk9STUFUSU9OLAotCQkJIEZB
TFNFLCBwLT5kd1Byb2Nlc3NJZCk7CisgIEhBTkRMRSBwcm9jZXNzID0gT3BlblByb2Nlc3Mg
KFBST0NFU1NfU0VUX0lORk9STUFUSU9OIHwKKwkJCQlQUk9DRVNTX1FVRVJZX0xJTUlURURf
SU5GT1JNQVRJT04sCisJCQkJRkFMU0UsIHAtPmR3UHJvY2Vzc0lkKTsKICAgaWYgKCFwcm9j
ZXNzKQogICAgIHsKICAgICAgIHNldF9lcnJubyAoRVNSQ0gpOwpAQCAtMjc5LDYgKzI3MSwy
NiBAQCBzY2hlZF9zZXRwYXJhbSAocGlkX3QgcGlkLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfcGFy
YW0gKnBhcmFtKQogICByZXR1cm4gMDsKIH0KIAoraW50CitzY2hlZF9zZXRwYXJhbSAocGlk
X3QgcGlkLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfcGFyYW0gKnBhcmFtKQoreworICBpZiAoIShw
aWQgPj0gMCAmJiBwYXJhbSAmJiAocGFyYW0tPnNjaGVkX3ByaW9yaXR5ID09IDAgfHwKKyAg
ICAgIHZhbGlkX3NjaGVkX3BhcmFtZXRlcnMocGFyYW0pKSkpCisgICAgeworICAgICAgc2V0
X2Vycm5vIChFSU5WQUwpOworICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICBwaW5mbyBw
IChwaWQgPyBwaWQgOiBnZXRwaWQgKCkpOworICBpZiAoIXApCisgICAgeworICAgICAgc2V0
X2Vycm5vIChFU1JDSCk7CisgICAgICByZXR1cm4gLTE7CisgICAgfQorCisgIHJldHVybiBz
Y2hlZF9zZXRwYXJhbV9waW5mbyAocCwgcGFyYW0pOworfQorCiAvKiBQT1NJWCB0aHJlYWQg
cHJpb3JpdGllcyBsb29zZWx5IGNvbXBhcmUgdG8gV2luZG93cyB0aHJlYWQgYmFzZSBwcmlv
cml0aWVzLgogCiAgICBCYXNlIHByaW9yaXR5IGlzIGEgZnVuY3Rpb24gb2YgcHJvY2VzcyBw
cmlvcml0eSBjbGFzcyBhbmQgdGhyZWFkIHByaW9yaXR5LgpAQCAtNDA0LDEyICs0MTYsMzAg
QEAgaW50CiBzY2hlZF9zZXRzY2hlZHVsZXIgKHBpZF90IHBpZCwgaW50IHBvbGljeSwKIAkJ
ICAgIGNvbnN0IHN0cnVjdCBzY2hlZF9wYXJhbSAqcGFyYW0pCiB7Ci0gIGlmIChwb2xpY3kg
PT0gU0NIRURfRklGTykgLyogcmV0dXJuZWQgYnkgc2NoZWRfZ2V0c2NoZWR1bGVyLiAqLwot
ICAgIHJldHVybiBzY2hlZF9zZXRwYXJhbSAocGlkLCBwYXJhbSk7CisgIGlmICghKHBpZCA+
PSAwICYmIHBhcmFtICYmCisgICAgICAoKHBvbGljeSA9PSBTQ0hFRF9PVEhFUiAmJiBwYXJh
bS0+c2NoZWRfcHJpb3JpdHkgPT0gMCkgfHwKKyAgICAgICgocG9saWN5ID09IFNDSEVEX0ZJ
Rk8gfHwgcG9saWN5ID09IFNDSEVEX1JSKSAmJiB2YWxpZF9zY2hlZF9wYXJhbWV0ZXJzKHBh
cmFtKSkpKSkKKyAgICB7CisgICAgICBzZXRfZXJybm8gKEVJTlZBTCk7CisgICAgICByZXR1
cm4gLTE7CisgICAgfQogCi0gIC8qIG9uIHdpbjMyLCB5b3UgY2FuJ3QgY2hhbmdlIHRoZSBz
Y2hlZHVsZXIuIERvaCEgKi8KLSAgc2V0X2Vycm5vIChFSU5WQUwpOwotICByZXR1cm4gLTE7
CisgIHBpbmZvIHAgKHBpZCA/IHBpZCA6IGdldHBpZCAoKSk7CisgIGlmICghcCkKKyAgICB7
CisgICAgICBzZXRfZXJybm8gKEVTUkNIKTsKKyAgICAgIHJldHVybiAtMTsKKyAgICB9CisK
KyAgaW50IHByZXZfcG9saWN5ID0gcC0+c2NoZWRfcG9saWN5OworICBwLT5zY2hlZF9wb2xp
Y3kgPSBwb2xpY3k7CisgIGlmIChzY2hlZF9zZXRwYXJhbV9waW5mbyAocCwgcGFyYW0pKQor
ICAgIHsKKyAgICAgIHAtPnNjaGVkX3BvbGljeSA9IHByZXZfcG9saWN5OworICAgICAgcmV0
dXJuIC0xOworICAgIH0KKworICByZXR1cm4gMDsKIH0KIAogLyogeWllbGQgdGhlIGNwdSAq
LwpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9zcGF3bi5jYyBiL3dpbnN1cC9jeWd3aW4v
c3Bhd24uY2MKaW5kZXggNjBhODI5OTFhLi43ZjlmMmRmNjQgMTAwNjQ0Ci0tLSBhL3dpbnN1
cC9jeWd3aW4vc3Bhd24uY2MKKysrIGIvd2luc3VwL2N5Z3dpbi9zcGF3bi5jYwpAQCAtNzk5
LDYgKzc5OSw3IEBAIGNoaWxkX2luZm9fc3Bhd246OndvcmtlciAoY29uc3QgY2hhciAqcHJv
Z19hcmcsIGNvbnN0IGNoYXIgKmNvbnN0ICphcmd2LAogCSAgICB9CiAJICBjaGlsZC0+c3Rh
cnRfdGltZSA9IHRpbWUgKE5VTEwpOyAvKiBSZWdpc3RlciBjaGlsZCdzIHN0YXJ0aW5nIHRp
bWUuICovCiAJICBjaGlsZC0+bmljZSA9IG15c2VsZi0+bmljZTsKKwkgIGNoaWxkLT5zY2hl
ZF9wb2xpY3kgPSBteXNlbGYtPnNjaGVkX3BvbGljeTsKIAkgIHBvc3Rmb3JrIChjaGlsZCk7
CiAJICBpZiAobW9kZSAhPSBfUF9ERVRBQ0gKIAkgICAgICAmJiAoIWNoaWxkLnJlbWVtYmVy
ICgpIHx8ICFjaGlsZC5hdHRhY2ggKCkpKQpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9z
eXNjYWxscy5jYyBiL3dpbnN1cC9jeWd3aW4vc3lzY2FsbHMuY2MKaW5kZXggZDRmYmE2MzJj
Li4yMjQzZGEwOTAgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4vc3lzY2FsbHMuY2MKKysr
IGIvd2luc3VwL2N5Z3dpbi9zeXNjYWxscy5jYwpAQCAtMzgyNiw3ICszODI2LDkgQEAgc2V0
cHJpb3JpdHkgKGludCB3aGljaCwgaWRfdCB3aG8sIGludCB2YWx1ZSkKIAl3aG8gPSBteXNl
bGYtPnBpZDsKICAgICAgIGlmICgocGlkX3QpIHdobyA9PSBteXNlbGYtPnBpZCkKIAl7Ci0J
ICBpZiAoIXNldF9hbmRfY2hlY2tfd2lucHJpbyAoR2V0Q3VycmVudFByb2Nlc3MgKCksIHBy
aW8pKQorCSAgLyogSWYgcmVhbHRpbWUgcG9saWN5IGlzIHNldCwga2VlcCBwcmlvIGJ1dCBj
aGVjayBpdHMgdmFsaWRpdHkuICovCisJICBpZiAoIXNldF9hbmRfY2hlY2tfd2lucHJpbyAo
R2V0Q3VycmVudFByb2Nlc3MgKCksIHByaW8sCisJICAgICAgKG15c2VsZi0+c2NoZWRfcG9s
aWN5ID09IFNDSEVEX09USEVSKSkpCiAJICAgIHsKIAkgICAgICBzZXRfZXJybm8gKEVBQ0NF
Uyk7CiAJICAgICAgcmV0dXJuIC0xOwpAQCAtMzg3Niw3ICszODc4LDkgQEAgc2V0cHJpb3Jp
dHkgKGludCB3aGljaCwgaWRfdCB3aG8sIGludCB2YWx1ZSkKIAkgICAgZXJyb3IgPSBFUEVS
TTsKIAkgIGVsc2UKIAkgICAgewotCSAgICAgIGlmICghc2V0X2FuZF9jaGVja193aW5wcmlv
IChwcm9jX2gsIHByaW8pKQorCSAgICAgIC8qIElmIHJlYWx0aW1lIHBvbGljeSBpcyBzZXQs
IGtlZXAgcHJpbyBidXQgY2hlY2sgaXRzIHZhbGlkaXR5LiAqLworCSAgICAgIGlmICghc2V0
X2FuZF9jaGVja193aW5wcmlvIChwcm9jX2gsIHByaW8sCisJCSAgKHAtPnNjaGVkX3BvbGlj
eSA9PSBTQ0hFRF9PVEhFUikpKQogCQllcnJvciA9IEVBQ0NFUzsKIAkgICAgICBlbHNlCiAJ
CXAtPm5pY2UgPSB2YWx1ZTsKQEAgLTM5MDUsMTAgKzM5MDksMTMgQEAgZ2V0cHJpb3JpdHkg
KGludCB3aGljaCwgaWRfdCB3aG8pCiAJd2hvID0gbXlzZWxmLT5waWQ7CiAgICAgICBpZiAo
KHBpZF90KSB3aG8gPT0gbXlzZWxmLT5waWQpCiAgICAgICAgIHsKLSAgICAgICAgICBEV09S
RCB3aW5wcmlvID0gR2V0UHJpb3JpdHlDbGFzcyhHZXRDdXJyZW50UHJvY2VzcygpKTsKLSAg
ICAgICAgICBpZiAod2lucHJpbyAhPSBuaWNlX3RvX3dpbnByaW8obXlzZWxmLT5uaWNlKSkK
LSAgICAgICAgICAgIG15c2VsZi0+bmljZSA9IHdpbnByaW9fdG9fbmljZSh3aW5wcmlvKTsK
LSAgICAgICAgICByZXR1cm4gbXlzZWxmLT5uaWNlOworCSAgaWYgKG15c2VsZi0+c2NoZWRf
cG9saWN5ID09IFNDSEVEX09USEVSKQorCSAgICB7CisJICAgICAgRFdPUkQgd2lucHJpbyA9
IEdldFByaW9yaXR5Q2xhc3MgKEdldEN1cnJlbnRQcm9jZXNzKCkpOworCSAgICAgIGlmICh3
aW5wcmlvICE9IG5pY2VfdG9fd2lucHJpbyAobXlzZWxmLT5uaWNlKSkKKwkJbXlzZWxmLT5u
aWNlID0gd2lucHJpb190b19uaWNlICh3aW5wcmlvKTsKKwkgICAgfQorCSAgcmV0dXJuIG15
c2VsZi0+bmljZTsKICAgICAgICAgfQogICAgICAgYnJlYWs7CiAgICAgY2FzZSBQUklPX1BH
UlA6Ci0tIAoyLjQ1LjEKCg==
--------------53A3A61C880019396D3A7ABD--
