Return-Path: <SRS0=dQo7=S7=t-online.de=Christian.Franke@sourceware.org>
Received: from mailout01.t-online.de (mailout01.t-online.de [194.25.134.80])
	by sourceware.org (Postfix) with ESMTPS id BD2053858CDB
	for <cygwin-patches@cygwin.com>; Fri,  6 Dec 2024 16:52:52 +0000 (GMT)
DMARC-Filter: OpenDMARC Filter v1.4.2 sourceware.org BD2053858CDB
Authentication-Results: sourceware.org; dmarc=none (p=none dis=none) header.from=t-online.de
Authentication-Results: sourceware.org; spf=pass smtp.mailfrom=t-online.de
ARC-Filter: OpenARC Filter v1.0.0 sourceware.org BD2053858CDB
Authentication-Results: server2.sourceware.org; arc=none smtp.remote-ip=194.25.134.80
ARC-Seal: i=1; a=rsa-sha256; d=sourceware.org; s=key; t=1733503973; cv=none;
	b=wmP3AfMLPWby27W3oLCCz+2WPXVOkAbSzu8TIy67uwThs6RDv0ksDLLX+rguuo2hmAyrVlavZE3lbErssqes4SH/vjwQpo+tIACH06znmRvUiurShhdpZYkIxPNp1feehaDuKPiS7rP0Ujie77xU5NUnt2c5RiwlT5hHK57yYn0=
ARC-Message-Signature: i=1; a=rsa-sha256; d=sourceware.org; s=key;
	t=1733503973; c=relaxed/simple;
	bh=q+8ITl+kkB1GoDf3Npwegz92UDhTLDhB/jEpagWf1p4=;
	h=From:Subject:To:Message-ID:Date:MIME-Version; b=VBD38SWcLf46QT5V4f+xiHNiOXzzHsL6/dV3356ivTIOXXWiFAMvkOYb9xulzbQewy+QtZ2ZR4gjex70f3GsYnuXlTs/nipMHKC6AsSuB5OcbVHfZ8efiFnTn5Bo9c8q+0OzG4+E3LbIWEof3RkxdUS5DfShuUPORJlKNhdYeBo=
ARC-Authentication-Results: i=1; server2.sourceware.org
DKIM-Filter: OpenDKIM Filter v2.11.0 sourceware.org BD2053858CDB
Received: from fwd81.aul.t-online.de (fwd81.aul.t-online.de [10.223.144.107])
	by mailout01.t-online.de (Postfix) with SMTP id 08295A44
	for <cygwin-patches@cygwin.com>; Fri,  6 Dec 2024 17:52:51 +0100 (CET)
Received: from [192.168.2.103] ([91.57.250.70]) by fwd81.t-online.de
	with (TLSv1.3:TLS_AES_256_GCM_SHA384 encrypted)
	esmtp id 1tJbZR-2UXlB20; Fri, 6 Dec 2024 17:52:49 +0100
From: Christian Franke <Christian.Franke@t-online.de>
Subject: [PATCH] Cygwin: sched_setscheduler: accept SCHED_BATCH
To: cygwin-patches@cygwin.com
Reply-To: cygwin-patches@cygwin.com
Message-ID: <3a052da3-f60e-1d7a-f741-956926af23da@t-online.de>
Date: Fri, 6 Dec 2024 17:52:49 +0100
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101
 SeaMonkey/2.53.19
MIME-Version: 1.0
Content-Type: multipart/mixed;
 boundary="------------0042148FA2579E515864AE71"
X-TOI-EXPURGATEID: 150726::1733503969-AD7F9959-99B40459/0/0 CLEAN NORMAL
X-TOI-MSGID: cbf516b1-9c56-456a-9445-0a27ea11b681
X-Spam-Status: No, score=-10.9 required=5.0 tests=BAYES_00,FREEMAIL_FROM,GIT_PATCH_0,KAM_DMARC_STATUS,RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H2,SPF_HELO_NONE,SPF_PASS,TXREP autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on server2.sourceware.org
List-Id: <cygwin-patches.cygwin.com>

This is a multi-part message in MIME format.
--------------0042148FA2579E515864AE71
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

A first attempt to add SCHED_BATCH.

Still TODO:
- Add SCHED_IDLE/BATCH to winsup/doc/posix.xml
- Provide correct values in (18) and (19) of /proc/PID/stat for SCHED_BATCH.
- Provide correct value in (18) of /proc/PID/stat for SCHED_FIFO/RR.

-- 
Regards,
Christian


--------------0042148FA2579E515864AE71
Content-Type: text/plain; charset=UTF-8;
 name="0001-Cygwin-sched_setscheduler-accept-SCHED_BATCH.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="0001-Cygwin-sched_setscheduler-accept-SCHED_BATCH.patch"

RnJvbSAwODIyOTE3MjUyZmRhZGUzZWRjMjQwYjRmYmZkM2MwZjQ3ZWYxZGViIE1vbiBTZXAg
MTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RpYW4gRnJhbmtlIDxjaHJpc3RpYW4uZnJh
bmtlQHQtb25saW5lLmRlPgpEYXRlOiBGcmksIDYgRGVjIDIwMjQgMTc6MzI6MjkgKzAxMDAK
U3ViamVjdDogW1BBVENIXSBDeWd3aW46IHNjaGVkX3NldHNjaGVkdWxlcjogYWNjZXB0IFND
SEVEX0JBVENICgpBZGQgU0NIRURfQkFUQ0ggdG8gPHN5cy9zY2hlZC5oPi4gIFNDSEVEX0JB
VENIIGlzIHNpbWlsYXIgdG8gU0NIRURfT1RIRVIsCmV4Y2VwdCB0aGF0IHRoZSBuaWNlIHZh
bHVlIGlzIG1hcHBlZCB0byBhIG9uZSBzdGVwIGxvd2VyIFdpbmRvd3MgcHJpb3JpdHkuClJl
d29yayB0aGUgbWFwcGluZyBmdW5jdGlvbnMgdG8gZWFzZSB0aGUgYWRkaXRpb24gb2YgdGhp
cyBmdW5jdGlvbmFsaXR5LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEZyYW5rZSA8Y2hy
aXN0aWFuLmZyYW5rZUB0LW9ubGluZS5kZT4KLS0tCiBuZXdsaWIvbGliYy9pbmNsdWRlL3N5
cy9zY2hlZC5oICAgICAgICAgIHwgICA4ICsrCiB3aW5zdXAvY3lnd2luL2xvY2FsX2luY2x1
ZGVzL21pc2NmdW5jcy5oIHwgICA0ICstCiB3aW5zdXAvY3lnd2luL21pc2NmdW5jcy5jYyAg
ICAgICAgICAgICAgIHwgMTU1ICsrKysrKysrKysrKystLS0tLS0tLS0tCiB3aW5zdXAvY3ln
d2luL3JlbGVhc2UvMy42LjAgICAgICAgICAgICAgIHwgIDExICstCiB3aW5zdXAvY3lnd2lu
L3NjaGVkLmNjICAgICAgICAgICAgICAgICAgIHwgIDE1ICsrLQogd2luc3VwL2N5Z3dpbi9z
eXNjYWxscy5jYyAgICAgICAgICAgICAgICB8ICAyMCArLS0KIDYgZmlsZXMgY2hhbmdlZCwg
MTI5IGluc2VydGlvbnMoKyksIDg0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL25ld2xp
Yi9saWJjL2luY2x1ZGUvc3lzL3NjaGVkLmggYi9uZXdsaWIvbGliYy9pbmNsdWRlL3N5cy9z
Y2hlZC5oCmluZGV4IGM5NjM1NWMyNC4uMjY1MjE1MjExIDEwMDY0NAotLS0gYS9uZXdsaWIv
bGliYy9pbmNsdWRlL3N5cy9zY2hlZC5oCisrKyBiL25ld2xpYi9saWJjL2luY2x1ZGUvc3lz
L3NjaGVkLmgKQEAgLTM4LDYgKzM4LDE0IEBAIGV4dGVybiAiQyIgewogI2RlZmluZSBTQ0hF
RF9GSUZPICAgICAxCiAjZGVmaW5lIFNDSEVEX1JSICAgICAgIDIKIAorI2lmIF9fR05VX1ZJ
U0lCTEUKKyNpZiBkZWZpbmVkKF9fQ1lHV0lOX18pCisjZGVmaW5lIFNDSEVEX0JBVENIICAg
IDAKKyNlbHNlCisjZGVmaW5lIFNDSEVEX0JBVENIICAgIDMKKyNlbmRpZgorI2VuZGlmCisK
ICNpZiBkZWZpbmVkKF9QT1NJWF9TUE9SQURJQ19TRVJWRVIpCiAjZGVmaW5lIFNDSEVEX1NQ
T1JBRElDIDQKICNlbmRpZgpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9sb2NhbF9pbmNs
dWRlcy9taXNjZnVuY3MuaCBiL3dpbnN1cC9jeWd3aW4vbG9jYWxfaW5jbHVkZXMvbWlzY2Z1
bmNzLmgKaW5kZXggNTdkY2JmZWFiLi42MDAxYTE2MzYgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9j
eWd3aW4vbG9jYWxfaW5jbHVkZXMvbWlzY2Z1bmNzLmgKKysrIGIvd2luc3VwL2N5Z3dpbi9s
b2NhbF9pbmNsdWRlcy9taXNjZnVuY3MuaApAQCAtNDQsOCArNDQsOCBAQCBpc19hbHRfbnVt
cGFkX2V2ZW50IChQSU5QVVRfUkVDT1JEIHBpcmVjKQogCSAmJiBwaXJlYy0+RXZlbnQuS2V5
RXZlbnQud1ZpcnR1YWxTY2FuQ29kZSA9PSAweDM4OwogfQogCi1pbnQgd2lucHJpb190b19u
aWNlIChEV09SRCk7Ci1EV09SRCBuaWNlX3RvX3dpbnByaW8gKGludCAmKTsKK2ludCB3aW5w
cmlvX3RvX25pY2UgKERXT1JEIHByaW8sIGJvb2wgYmF0Y2ggPSBmYWxzZSk7CitEV09SRCBu
aWNlX3RvX3dpbnByaW8gKGludCAmbmljZSwgYm9vbCBiYXRjaCA9IGZhbHNlKTsKIGJvb2wg
c2V0X2FuZF9jaGVja193aW5wcmlvIChIQU5ETEUgcHJvYywgRFdPUkQgcHJpbywgYm9vbCBz
ZXQgPSB0cnVlKTsKIAogYm9vbCBjcmVhdGVfcGlwZSAoUEhBTkRMRSwgUEhBTkRMRSwgTFBT
RUNVUklUWV9BVFRSSUJVVEVTLCBEV09SRCk7CmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2lu
L21pc2NmdW5jcy5jYyBiL3dpbnN1cC9jeWd3aW4vbWlzY2Z1bmNzLmNjCmluZGV4IDAxNDY3
MDRlYS4uNmZhZjA0OTM3IDEwMDY0NAotLS0gYS93aW5zdXAvY3lnd2luL21pc2NmdW5jcy5j
YworKysgYi93aW5zdXAvY3lnd2luL21pc2NmdW5jcy5jYwpAQCAtMTAzLDg0ICsxMDMsMTEx
IEBAIHlpZWxkICgpCiAgIFNsZWVwICgwTCk7CiB9CiAKLS8qIEdldCBhIGRlZmF1bHQgdmFs
dWUgZm9yIHRoZSBuaWNlIGZhY3Rvci4gIFdoZW4gY2hhbmdpbmcgdGhlc2UgdmFsdWVzLAot
ICAgaGF2ZSBhIGxvb2sgaW50byB0aGUgYmVsb3cgZnVuY3Rpb24gbmljZV90b193aW5wcmlv
LiAgVGhlIHZhbHVlcyBtdXN0Ci0gICBtYXRjaCB0aGUgbGF5b3V0IG9mIHRoZSBzdGF0aWMg
InByaW9yaXR5IiBhcnJheS4gKi8KLWludAotd2lucHJpb190b19uaWNlIChEV09SRCBwcmlv
KQorLyoKKyAgIE1hcHBpbmcgb2YgbmljZSB2YWx1ZSBmcm9tL3RvIFdpbmRvd3MgcHJpb3Jp
dHkKKyAgICgnYmF0Y2gnIGlzIHVzZWQgZm9yIFNDSEVEX0JBVENIIHBvbGljeSkuCisKKyAg
ICBuaWNlX3RvX3dpbnByaW8oKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHdpbnByaW9fdG9fbmljZSgpCisgICFiYXRjaCAgICAgIGJhdGNoICAgICBMZXZlbCAg
V2luZG93cyBwcmlvcml0eSBjbGFzcyAgICAgICAgIWJhdGNoICAgYmF0Y2gKKyAgIDEyLi4u
MTkgICAgICA0Li4uMTkgICAgMCAgICBJRExFX1BSSU9SSVRZX0NMQVNTICAgICAgICAgICAg
MTYgICAgICAgIDgKKyAgICA0Li4uMTEgICAgIC00Li4uLjMgICAgMSAgICBCRUxPV19OT1JN
QUxfUFJJT1JJVFlfQ0xBU1MgICAgIDggICAgICAgIDAKKyAgIC00Li4uLjMgICAgLTEyLi4u
LTUgICAgMiAgICBOT1JNQUxfUFJJT1JJVFlfQ0xBU1MgICAgICAgICAgIDAgICAgICAgLTgK
KyAgLTEyLi4uLTUgICAgLTEzLi4tMTkgICAgMyAgICBBQk9WRV9OT1JNQUxfUFJJT1JJVFlf
Q0xBU1MgICAgLTggICAgICAtMTYKKyAgLTEzLi4tMTkgICAgICAgICAtMjAgICAgNCAgICBI
SUdIX1BSSU9SSVRZX0NMQVNTICAgICAgICAgICAtMTYgICAgICAtMjAKKyAgICAgICAtMjAg
ICAgICAgICAgIC0gICAgNSAgICBSRUFMVElNRV9QUklPUklUWV9DTEFTUyAgICAgICAtMjAg
ICAgICAtMjAKKyovCisKKy8qICpfUFJJT1JJVFlfQ0xBU1MgLT4gMC4uLjUgKi8KK2NvbnN0
ZXhwciBpbnQKK3dpbnByaW9fdG9fbGV2ZWwgKERXT1JEIHByaW8pCiB7CiAgIHN3aXRjaCAo
cHJpbykKICAgICB7Ci0gICAgICBjYXNlIFJFQUxUSU1FX1BSSU9SSVRZX0NMQVNTOgotCXJl
dHVybiAtMjA7Ci0gICAgICBjYXNlIEhJR0hfUFJJT1JJVFlfQ0xBU1M6Ci0JcmV0dXJuIC0x
NjsKLSAgICAgIGNhc2UgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTOgotCXJldHVybiAt
ODsKLSAgICAgIGNhc2UgTk9STUFMX1BSSU9SSVRZX0NMQVNTOgotCXJldHVybiAwOwotICAg
ICAgY2FzZSBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xBU1M6Ci0JcmV0dXJuIDg7Ci0gICAg
ICBjYXNlIElETEVfUFJJT1JJVFlfQ0xBU1M6Ci0JcmV0dXJuIDE2OworICAgICAgY2FzZSBJ
RExFX1BSSU9SSVRZX0NMQVNTOgkJcmV0dXJuIDA7CisgICAgICBjYXNlIEJFTE9XX05PUk1B
TF9QUklPUklUWV9DTEFTUzoJcmV0dXJuIDE7CisgICAgICBkZWZhdWx0OgkJCQlyZXR1cm4g
MjsKKyAgICAgIGNhc2UgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTOglyZXR1cm4gMzsK
KyAgICAgIGNhc2UgSElHSF9QUklPUklUWV9DTEFTUzoJCXJldHVybiA0OworICAgICAgY2Fz
ZSBSRUFMVElNRV9QUklPUklUWV9DTEFTUzoJcmV0dXJuIDU7CiAgICAgfQotICByZXR1cm4g
MDsKK30KKworLyogMC4uLjUgLT4gKl9QUklPUklUWV9DTEFTUyAqLworY29uc3RleHByIERX
T1JECitsZXZlbF90b193aW5wcmlvIChpbnQgbGV2ZWwpCit7CisgIHN3aXRjaCAobGV2ZWwp
CisgICAgeworICAgICAgY2FzZSAwOiAgcmV0dXJuIElETEVfUFJJT1JJVFlfQ0xBU1M7Cisg
ICAgICBjYXNlIDE6ICByZXR1cm4gQkVMT1dfTk9STUFMX1BSSU9SSVRZX0NMQVNTOworICAg
ICAgZGVmYXVsdDogcmV0dXJuIE5PUk1BTF9QUklPUklUWV9DTEFTUzsKKyAgICAgIGNhc2Ug
MzogIHJldHVybiBBQk9WRV9OT1JNQUxfUFJJT1JJVFlfQ0xBU1M7CisgICAgICBjYXNlIDQ6
ICByZXR1cm4gSElHSF9QUklPUklUWV9DTEFTUzsKKyAgICAgIGNhc2UgNTogIHJldHVybiBS
RUFMVElNRV9QUklPUklUWV9DTEFTUzsKKyAgICB9Cit9CisKKy8qICpfUFJJT1JJVFlfQ0xB
U1MgLT4gbmljZSB2YWx1ZSAqLworY29uc3RleHByIGludAord2lucHJpb190b19uaWNlX2lt
cGwgKERXT1JEIHByaW8sIGJvb2wgYmF0Y2ggPSBmYWxzZSkKK3sKKyAgaW50IGxldmVsID0g
d2lucHJpb190b19sZXZlbCAocHJpbyk7CisgIGlmIChiYXRjaCAmJiBsZXZlbCA8IDUpCisg
ICAgbGV2ZWwrKzsKKyAgcmV0dXJuIChsZXZlbCA8IDUgPyBOWkVSTyAtIDEgLSAzIC0gbGV2
ZWwgKiA4IDogLU5aRVJPKTsKK30KKworLyogbmljZSB2YWx1ZSAtPiAqX1BSSU9SSVRZX0NM
QVNTICovCitjb25zdGV4cHIgRFdPUkQKK25pY2VfdG9fd2lucHJpb19pbXBsIChpbnQgbmlj
ZSwgYm9vbCBiYXRjaCA9IGZhbHNlKQoreworICBpbnQgbGV2ZWwgPSAobmljZSA+IC1OWkVS
TyA/IChOWkVSTyAtIDEgLSBuaWNlKSAvIDggOiA1KTsKKyAgaWYgKGJhdGNoICYmIGxldmVs
ID4gMCkKKyAgICBsZXZlbC0tOworICByZXR1cm4gbGV2ZWxfdG9fd2lucHJpbyAobGV2ZWwp
OworfQorCisvKiBDaGVjayBjb25zaXN0ZW5jeSBhdCBjb21waWxlIHRpbWUuICovCitjb25z
dGV4cHIgYm9vbAorY2hlY2tfbmljZV93aW5wcmlvX21hcHBpbmcgKCkKK3sKKyAgZm9yIChp
bnQgbmljZSA9IC1OWkVSTzsgbmljZSA8IE5aRVJPOyBuaWNlKyspCisgICAgZm9yIChpbnQg
YmF0Y2ggPSAwOyBiYXRjaCA8PSAxOyBiYXRjaCsrKSB7CisgICAgICBEV09SRCBwcmlvID0g
bmljZV90b193aW5wcmlvX2ltcGwgKG5pY2UsICEhYmF0Y2gpOworICAgICAgaW50IG5pY2Uy
ID0gd2lucHJpb190b19uaWNlX2ltcGwgKHByaW8sICEhYmF0Y2gpOworICAgICAgRFdPUkQg
cHJpbzIgPSBuaWNlX3RvX3dpbnByaW9faW1wbCAobmljZTIsICEhYmF0Y2gpOworICAgICAg
aWYgKHByaW8gIT0gcHJpbzIpCisJcmV0dXJuIGZhbHNlOworICAgIH0KKyAgcmV0dXJuIHRy
dWU7Cit9CisKK3N0YXRpY19hc3NlcnQgKGNoZWNrX25pY2Vfd2lucHJpb19tYXBwaW5nKCkp
Oworc3RhdGljX2Fzc2VydCAobmljZV90b193aW5wcmlvX2ltcGwoTlpFUk8tMSwgZmFsc2Up
ID09IElETEVfUFJJT1JJVFlfQ0xBU1MpOworc3RhdGljX2Fzc2VydCAobmljZV90b193aW5w
cmlvX2ltcGwoMCwgdHJ1ZSkgPT0gQkVMT1dfTk9STUFMX1BSSU9SSVRZX0NMQVNTKTsKK3N0
YXRpY19hc3NlcnQgKHdpbnByaW9fdG9fbmljZV9pbXBsKEJFTE9XX05PUk1BTF9QUklPUklU
WV9DTEFTUywgdHJ1ZSkgPT0gMCk7CitzdGF0aWNfYXNzZXJ0IChuaWNlX3RvX3dpbnByaW9f
aW1wbCgwLCBmYWxzZSkgPT0gTk9STUFMX1BSSU9SSVRZX0NMQVNTKTsKK3N0YXRpY19hc3Nl
cnQgKHdpbnByaW9fdG9fbmljZV9pbXBsKE5PUk1BTF9QUklPUklUWV9DTEFTUywgZmFsc2Up
ID09IDApOworc3RhdGljX2Fzc2VydCAobmljZV90b193aW5wcmlvX2ltcGwoLU5aRVJPLCBm
YWxzZSkgPT0gUkVBTFRJTUVfUFJJT1JJVFlfQ0xBU1MpOworCisvKiBHZXQgYSBkZWZhdWx0
IHZhbHVlIGZvciB0aGUgbmljZSBmYWN0b3IuICovCitpbnQKK3dpbnByaW9fdG9fbmljZSAo
RFdPUkQgcHJpbywgYm9vbCBiYXRjaCAvKiA9IGZhbHNlICovKQoreworICByZXR1cm4gd2lu
cHJpb190b19uaWNlX2ltcGwgKHByaW8sIGJhdGNoKTsKIH0KIAogLyogR2V0IGEgV2luMzIg
cHJpb3JpdHkgbWF0Y2hpbmcgdGhlIGluY29taW5nIG5pY2UgZmFjdG9yLiAgVGhlIGluY29t
aW5nCiAgICBuaWNlIGlzIGxpbWl0ZWQgdG8gdGhlIGludGVydmFsIFstTlpFUk8sTlpFUk8t
MV0uICovCiBEV09SRAotbmljZV90b193aW5wcmlvIChpbnQgJm5pY2UpCituaWNlX3RvX3dp
bnByaW8gKGludCAmbmljZSwgYm9vbCBiYXRjaCAvKiA9IGZhbHNlICovKQogewotICBzdGF0
aWMgY29uc3QgRFdPUkQgcHJpb3JpdHlbXSA9Ci0gICAgewotICAgICAgUkVBTFRJTUVfUFJJ
T1JJVFlfQ0xBU1MsCQkvKiAgMCAqLwotICAgICAgSElHSF9QUklPUklUWV9DTEFTUywJCS8q
ICAxICovCi0gICAgICBISUdIX1BSSU9SSVRZX0NMQVNTLAotICAgICAgSElHSF9QUklPUklU
WV9DTEFTUywKLSAgICAgIEhJR0hfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBISUdIX1BSSU9S
SVRZX0NMQVNTLAotICAgICAgSElHSF9QUklPUklUWV9DTEFTUywKLSAgICAgIEhJR0hfUFJJ
T1JJVFlfQ0xBU1MsCQkvKiAgNyAqLwotICAgICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NM
QVNTLAkvKiAgOCAqLwotICAgICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTLAotICAg
ICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTLAotICAgICAgQUJPVkVfTk9STUFMX1BS
SU9SSVRZX0NMQVNTLAotICAgICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTLAotICAg
ICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTLAotICAgICAgQUJPVkVfTk9STUFMX1BS
SU9SSVRZX0NMQVNTLAotICAgICAgQUJPVkVfTk9STUFMX1BSSU9SSVRZX0NMQVNTLAkvKiAx
NSAqLwotICAgICAgTk9STUFMX1BSSU9SSVRZX0NMQVNTLAkJLyogMTYgKi8KLSAgICAgIE5P
Uk1BTF9QUklPUklUWV9DTEFTUywKLSAgICAgIE5PUk1BTF9QUklPUklUWV9DTEFTUywKLSAg
ICAgIE5PUk1BTF9QUklPUklUWV9DTEFTUywKLSAgICAgIE5PUk1BTF9QUklPUklUWV9DTEFT
UywKLSAgICAgIE5PUk1BTF9QUklPUklUWV9DTEFTUywKLSAgICAgIE5PUk1BTF9QUklPUklU
WV9DTEFTUywKLSAgICAgIE5PUk1BTF9QUklPUklUWV9DTEFTUywJCS8qIDIzICovCi0gICAg
ICBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xBU1MsCS8qIDI0ICovCi0gICAgICBCRUxPV19O
T1JNQUxfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xB
U1MsCi0gICAgICBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBCRUxPV19O
T1JNQUxfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xB
U1MsCi0gICAgICBCRUxPV19OT1JNQUxfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBCRUxPV19O
T1JNQUxfUFJJT1JJVFlfQ0xBU1MsCS8qIDMxICovCi0gICAgICBJRExFX1BSSU9SSVRZX0NM
QVNTLAkJLyogMzIgKi8KLSAgICAgIElETEVfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBJRExF
X1BSSU9SSVRZX0NMQVNTLAotICAgICAgSURMRV9QUklPUklUWV9DTEFTUywKLSAgICAgIElE
TEVfUFJJT1JJVFlfQ0xBU1MsCi0gICAgICBJRExFX1BSSU9SSVRZX0NMQVNTLAotICAgICAg
SURMRV9QUklPUklUWV9DTEFTUywKLSAgICAgIElETEVfUFJJT1JJVFlfQ0xBU1MJCS8qIDM5
ICovCi0gICAgfTsKICAgaWYgKG5pY2UgPCAtTlpFUk8pCiAgICAgbmljZSA9IC1OWkVSTzsK
ICAgZWxzZSBpZiAobmljZSA+IE5aRVJPIC0gMSkKICAgICBuaWNlID0gTlpFUk8gLSAxOwot
ICBEV09SRCBwcmlvID0gcHJpb3JpdHlbbmljZSArIE5aRVJPXTsKLSAgcmV0dXJuIHByaW87
CisKKyAgcmV0dXJuIG5pY2VfdG9fd2lucHJpb19pbXBsIChuaWNlLCBiYXRjaCk7CiB9CiAK
IC8qIFNldCBXaW4zMiBwcmlvcml0eSBvciByZXR1cm4gZmFsc2Ugb24gZmFpbHVyZS4gIEFs
c28gcmV0dXJuCmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2luL3JlbGVhc2UvMy42LjAgYi93
aW5zdXAvY3lnd2luL3JlbGVhc2UvMy42LjAKaW5kZXggOGNhOTFmMGM5Li4xMWY3NDViMjMg
MTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4vcmVsZWFzZS8zLjYuMAorKysgYi93aW5zdXAv
Y3lnd2luL3JlbGVhc2UvMy42LjAKQEAgLTU0LDExICs1NCwxMiBAQCBXaGF0IGNoYW5nZWQ6
CiAgIHRvIFBPU0lYIGFuZCBMaW51eCAoZ2xpYmMgPj0gMi4yLjQpIGJlaGF2aW9yLgogCiAt
IHNjaGVkX3NldHNjaGVkdWxlcigyKSBub3cgZW11bGF0ZXMgY2hhbmdlcyBiZXR3ZWVuIFND
SEVEX09USEVSLAotICBTQ0hFRF9JRExFLCBTQ0hFRF9GSUZPIGFuZCBTQ0hFRF9SUi4gIElm
IFNDSEVEX09USEVSIGlzIHNlbGVjdGVkLCB0aGUKLSAgV2luZG93cyBwcmlvcml0eSBpcyBz
ZXQgYWNjb3JkaW5nIHRvIHRoZSBuaWNlIHZhbHVlLiBJZiBTQ0hFRF9JRExFIGlzCisgIFND
SEVEX0JBVENILCBTQ0hFRF9JRExFLCBTQ0hFRF9GSUZPIGFuZCBTQ0hFRF9SUi4gIElmIFND
SEVEX09USEVSIG9yCisgIFNDSEVEX0JBVENIIGlzIHNlbGVjdGVkLCB0aGUgV2luZG93cyBw
cmlvcml0eSBpcyBzZXQgYWNjb3JkaW5nIHRvIHRoZQorICBuaWNlIHZhbHVlIHdoZXJlIFND
SEVEX0JBVENIIHNldHMgYSBvbmUgc3RlcCBsb3dlciBwcmlvcml0eS4gIElmCisgIFNDSEVE
X0lETEUgaXMgc2VsZWN0ZWQsIHRoZSBuaWNlIHZhbHVlIGlzIHByZXNlcnZlZCBhbmQgdGhl
IFdpbmRvd3MKKyAgcHJpb3JpdHkgaXMgc2V0IHRvIElETEVfUFJJT1JJVFlfQ0xBU1MuICBJ
ZiBTQ0hFRF9GSUZPIG9yIFNDSEVEX1JSIGlzCiAgIHNlbGVjdGVkLCB0aGUgbmljZSB2YWx1
ZSBpcyBwcmVzZXJ2ZWQgYW5kIHRoZSBXaW5kb3dzIHByaW9yaXR5IGlzIHNldAotICB0byBJ
RExFX1BSSU9SSVRZX0NMQVNTLiAgSWYgU0NIRURfRklGTyBvciBTQ0hFRF9SUiBpcyBzZWxl
Y3RlZCwgdGhlCi0gIG5pY2UgdmFsdWUgaXMgcHJlc2VydmVkIGFuZCB0aGUgV2luZG93cyBw
cmlvcml0eSBpcyBzZXQgYWNjb3JkaW5nIHRvCi0gIHRoZSByZWFsdGltZSBwcmlvcml0eS4K
KyAgYWNjb3JkaW5nIHRvIHRoZSByZWFsdGltZSBwcmlvcml0eS4KICAgTm90ZTogV2luZG93
cyBkb2VzIG5vdCBvZmZlciBhbHRlcm5hdGl2ZSBzY2hlZHVsaW5nIHBvbGljaWVzIHNvCiAg
IHRoaXMgY291bGQgb25seSBlbXVsYXRlIEFQSSBiZWhhdmlvci4KZGlmZiAtLWdpdCBhL3dp
bnN1cC9jeWd3aW4vc2NoZWQuY2MgYi93aW5zdXAvY3lnd2luL3NjaGVkLmNjCmluZGV4IDhi
NGU3ZWZjNC4uZWM2MmVhODNjIDEwMDY0NAotLS0gYS93aW5zdXAvY3lnd2luL3NjaGVkLmNj
CisrKyBiL3dpbnN1cC9jeWd3aW4vc2NoZWQuY2MKQEAgLTM0LDYgKzM0LDcgQEAgc2NoZWRf
Z2V0X3ByaW9yaXR5X21heCAoaW50IHBvbGljeSkKICAgc3dpdGNoIChwb2xpY3kpCiAgICAg
ewogICAgIGNhc2UgU0NIRURfT1RIRVI6CisgICAgY2FzZSBTQ0hFRF9CQVRDSDoKICAgICBj
YXNlIFNDSEVEX0lETEU6CiAgICAgICByZXR1cm4gMDsKICAgICBjYXNlIFNDSEVEX0ZJRk86
CkBAIC01MSw2ICs1Miw3IEBAIHNjaGVkX2dldF9wcmlvcml0eV9taW4gKGludCBwb2xpY3kp
CiAgIHN3aXRjaCAocG9saWN5KQogICAgIHsKICAgICBjYXNlIFNDSEVEX09USEVSOgorICAg
IGNhc2UgU0NIRURfQkFUQ0g6CiAgICAgY2FzZSBTQ0hFRF9JRExFOgogICAgICAgcmV0dXJu
IDA7CiAgICAgY2FzZSBTQ0hFRF9GSUZPOgpAQCAtOTUsNyArOTcsOCBAQCBzY2hlZF9nZXRw
YXJhbSAocGlkX3QgcGlkLCBzdHJ1Y3Qgc2NoZWRfcGFyYW0gKnBhcmFtKQogICAgICAgcmV0
dXJuIC0xOwogICAgIH0KIAotICBpZiAocC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX09USEVS
IHx8IHAtPnNjaGVkX3BvbGljeSA9PSBTQ0hFRF9JRExFKQorICBpZiAocC0+c2NoZWRfcG9s
aWN5ID09IFNDSEVEX09USEVSIHx8IHAtPnNjaGVkX3BvbGljeSA9PSBTQ0hFRF9CQVRDSAor
ICAgICAgfHwgcC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX0lETEUpCiAgICAgewogICAgICAg
LyogTm8gcmVhbHRpbWUgcG9saWN5LiAqLwogICAgICAgcGFyYW0tPnNjaGVkX3ByaW9yaXR5
ID0gMDsKQEAgLTIzNCw5ICsyMzcsMTAgQEAgc2NoZWRfc2V0cGFyYW1fcGluZm8gKHBpbmZv
ICYgcCwgY29uc3Qgc3RydWN0IHNjaGVkX3BhcmFtICpwYXJhbSkKICAgLyogY2FsY3VsYXRl
IG91ciBkZXNpcmVkIHByaW9yaXR5IGNsYXNzLiAgV2Ugb25seSByZXNlcnZlIGEgc21hbGwg
YXJlYQogICAgICAoMzEvMzIpIGZvciByZWFsdGltZSBwcmlvcml0eS4gKi8KICAgRFdPUkQg
cGNsYXNzOwotICBpZiAocC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX09USEVSICYmIHByaSA9
PSAwKQorICBib29sIGJhdGNoID0gKHAtPnNjaGVkX3BvbGljeSA9PSBTQ0hFRF9CQVRDSCk7
CisgIGlmICgocC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX09USEVSIHx8IGJhdGNoKSAmJiBw
cmkgPT0gMCkKICAgICAvKiBObyByZWFsdGltZSBwb2xpY3ksIHJlYXBwbHkgdGhlIG5pY2Ug
dmFsdWUuICovCi0gICAgcGNsYXNzID0gbmljZV90b193aW5wcmlvIChwLT5uaWNlKTsKKyAg
ICBwY2xhc3MgPSBuaWNlX3RvX3dpbnByaW8gKHAtPm5pY2UsIGJhdGNoKTsKICAgZWxzZSBp
ZiAocC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX0lETEUgJiYgcHJpID09IDApCiAgICAgLyog
SWRsZSBwb2xpY3ksIGlnbm9yZSB0aGUgbmljZSB2YWx1ZS4gKi8KICAgICBwY2xhc3MgPSBJ
RExFX1BSSU9SSVRZX0NMQVNTOwpAQCAtNDIyLDggKzQyNiw5IEBAIHNjaGVkX3NldHNjaGVk
dWxlciAocGlkX3QgcGlkLCBpbnQgcG9saWN5LAogCQkgICAgY29uc3Qgc3RydWN0IHNjaGVk
X3BhcmFtICpwYXJhbSkKIHsKICAgaWYgKCEocGlkID49IDAgJiYgcGFyYW0gJiYKLSAgICAg
ICgoKHBvbGljeSA9PSBTQ0hFRF9PVEhFUiB8fCBwb2xpY3kgPT0gU0NIRURfSURMRSkgJiYg
cGFyYW0tPnNjaGVkX3ByaW9yaXR5ID09IDApIHx8Ci0gICAgICAoKHBvbGljeSA9PSBTQ0hF
RF9GSUZPIHx8IHBvbGljeSA9PSBTQ0hFRF9SUikgJiYgdmFsaWRfc2NoZWRfcGFyYW1ldGVy
cyhwYXJhbSkpKSkpCisgICAgICAoKChwb2xpY3kgPT0gU0NIRURfT1RIRVIgfHwgcG9saWN5
ID09IFNDSEVEX0JBVENIIHx8IHBvbGljeSA9PSBTQ0hFRF9JRExFKQorICAgICAgJiYgcGFy
YW0tPnNjaGVkX3ByaW9yaXR5ID09IDApIHx8ICgocG9saWN5ID09IFNDSEVEX0ZJRk8gfHwg
cG9saWN5ID09IFNDSEVEX1JSKQorICAgICAgJiYgdmFsaWRfc2NoZWRfcGFyYW1ldGVycyhw
YXJhbSkpKSkpCiAgICAgewogICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwogICAgICAgcmV0
dXJuIC0xOwpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9zeXNjYWxscy5jYyBiL3dpbnN1
cC9jeWd3aW4vc3lzY2FsbHMuY2MKaW5kZXggMGRlZWZlZmY2Li41ZmYwZjAyYjkgMTAwNjQ0
Ci0tLSBhL3dpbnN1cC9jeWd3aW4vc3lzY2FsbHMuY2MKKysrIGIvd2luc3VwL2N5Z3dpbi9z
eXNjYWxscy5jYwpAQCAtMzgxNiw5ICszODE2LDYgQEAgdmhhbmd1cCAoKQogZXh0ZXJuICJD
IiBpbnQKIHNldHByaW9yaXR5IChpbnQgd2hpY2gsIGlkX3Qgd2hvLCBpbnQgdmFsdWUpCiB7
Ci0gIERXT1JEIHByaW8gPSBuaWNlX3RvX3dpbnByaW8gKHZhbHVlKTsKLSAgaW50IGVycm9y
ID0gMDsKLQogICBzd2l0Y2ggKHdoaWNoKQogICAgIHsKICAgICBjYXNlIFBSSU9fUFJPQ0VT
UzoKQEAgLTM4MjcsOCArMzgyNCwxMCBAQCBzZXRwcmlvcml0eSAoaW50IHdoaWNoLCBpZF90
IHdobywgaW50IHZhbHVlKQogICAgICAgaWYgKChwaWRfdCkgd2hvID09IG15c2VsZi0+cGlk
KQogCXsKIAkgIC8qIElmIHJlYWx0aW1lIHBvbGljeSBpcyBzZXQsIGtlZXAgcHJpbyBidXQg
Y2hlY2sgaXRzIHZhbGlkaXR5LiAqLworCSAgYm9vbCBiYXRjaCA9IChteXNlbGYtPnNjaGVk
X3BvbGljeSA9PSBTQ0hFRF9CQVRDSCk7CisJICBEV09SRCBwcmlvID0gbmljZV90b193aW5w
cmlvICh2YWx1ZSwgYmF0Y2gpOwogCSAgaWYgKCFzZXRfYW5kX2NoZWNrX3dpbnByaW8gKEdl
dEN1cnJlbnRQcm9jZXNzICgpLCBwcmlvLAotCSAgICAgIChteXNlbGYtPnNjaGVkX3BvbGlj
eSA9PSBTQ0hFRF9PVEhFUikpKQorCSAgICAgIChteXNlbGYtPnNjaGVkX3BvbGljeSA9PSBT
Q0hFRF9PVEhFUiB8fCBiYXRjaCkpKQogCSAgICB7CiAJICAgICAgc2V0X2Vycm5vIChFQUND
RVMpOwogCSAgICAgIHJldHVybiAtMTsKQEAgLTM4NTAsNiArMzg0OSw4IEBAIHNldHByaW9y
aXR5IChpbnQgd2hpY2gsIGlkX3Qgd2hvLCBpbnQgdmFsdWUpCiAgICAgICBzZXRfZXJybm8g
KEVJTlZBTCk7CiAgICAgICByZXR1cm4gLTE7CiAgICAgfQorCisgIGludCBlcnJvciA9IDA7
CiAgIHdpbnBpZHMgcGlkcyAoKERXT1JEKSBQSURfTUFQX1JXKTsKICAgZm9yIChEV09SRCBp
ID0gMDsgaSA8IHBpZHMubnBpZHM7ICsraSkKICAgICB7CkBAIC0zODc4LDkgKzM4NzksMTEg
QEAgc2V0cHJpb3JpdHkgKGludCB3aGljaCwgaWRfdCB3aG8sIGludCB2YWx1ZSkKIAkgICAg
ZXJyb3IgPSBFUEVSTTsKIAkgIGVsc2UKIAkgICAgeworCSAgICAgIGJvb2wgYmF0Y2ggPSAo
cC0+c2NoZWRfcG9saWN5ID09IFNDSEVEX0JBVENIKTsKKwkgICAgICBEV09SRCBwcmlvID0g
bmljZV90b193aW5wcmlvICh2YWx1ZSwgYmF0Y2gpOwogCSAgICAgIC8qIElmIHJlYWx0aW1l
IHBvbGljeSBpcyBzZXQsIGtlZXAgcHJpbyBidXQgY2hlY2sgaXRzIHZhbGlkaXR5LiAqLwog
CSAgICAgIGlmICghc2V0X2FuZF9jaGVja193aW5wcmlvIChwcm9jX2gsIHByaW8sCi0JCSAg
KHAtPnNjaGVkX3BvbGljeSA9PSBTQ0hFRF9PVEhFUikpKQorCQkgIChwLT5zY2hlZF9wb2xp
Y3kgPT0gU0NIRURfT1RIRVIgfHwgYmF0Y2gpKSkKIAkJZXJyb3IgPSBFQUNDRVM7CiAJICAg
ICAgZWxzZQogCQlwLT5uaWNlID0gdmFsdWU7CkBAIC0zOTA5LDExICszOTEyLDEyIEBAIGdl
dHByaW9yaXR5IChpbnQgd2hpY2gsIGlkX3Qgd2hvKQogCXdobyA9IG15c2VsZi0+cGlkOwog
ICAgICAgaWYgKChwaWRfdCkgd2hvID09IG15c2VsZi0+cGlkKQogICAgICAgICB7Ci0JICBp
ZiAobXlzZWxmLT5zY2hlZF9wb2xpY3kgPT0gU0NIRURfT1RIRVIpCisJICBib29sIGJhdGNo
ID0gKG15c2VsZi0+c2NoZWRfcG9saWN5ID09IFNDSEVEX0JBVENIKTsKKwkgIGlmIChteXNl
bGYtPnNjaGVkX3BvbGljeSA9PSBTQ0hFRF9PVEhFUiB8fCBiYXRjaCkKIAkgICAgewogCSAg
ICAgIERXT1JEIHdpbnByaW8gPSBHZXRQcmlvcml0eUNsYXNzIChHZXRDdXJyZW50UHJvY2Vz
cygpKTsKLQkgICAgICBpZiAod2lucHJpbyAhPSBuaWNlX3RvX3dpbnByaW8gKG15c2VsZi0+
bmljZSkpCi0JCW15c2VsZi0+bmljZSA9IHdpbnByaW9fdG9fbmljZSAod2lucHJpbyk7CisJ
ICAgICAgaWYgKHdpbnByaW8gIT0gbmljZV90b193aW5wcmlvIChteXNlbGYtPm5pY2UsIGJh
dGNoKSkKKwkJbXlzZWxmLT5uaWNlID0gd2lucHJpb190b19uaWNlICh3aW5wcmlvLCBiYXRj
aCk7CiAJICAgIH0KIAkgIHJldHVybiBteXNlbGYtPm5pY2U7CiAgICAgICAgIH0KLS0gCjIu
NDUuMQoK
--------------0042148FA2579E515864AE71--
