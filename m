From: Egor Duda <deo@logos-m.ru>
To: cygwin-patches@cygwin.com
Subject: Re: known issues with current dll
Date: Sun, 18 Mar 2001 07:12:00 -0000
Message-id: <171293451.20010318180902@logos-m.ru>
References: <5627632543.20010316225211@logos-m.ru> <20010316163702.A22471@redhat.com> <20010316164626.A22656@redhat.com> <20010316211721.A3489@redhat.com> <19889636700.20010317160536@logos-m.ru> <20010317121739.B8183@redhat.com>
X-SW-Source: 2001-q1/msg00206.html
Content-type: multipart/mixed; boundary="----------=_1583532846-65438-23"

This is a multi-part message in MIME format...

------------=_1583532846-65438-23
Content-length: 876

Hi!

Saturday, 17 March, 2001 Christopher Faylor cgf@redhat.com wrote:

CF> On Sat, Mar 17, 2001 at 04:05:36PM +0300, Egor Duda wrote:
>>to  solve  ctrl-D  problem  i  see  2 ways -- either return to the old
>>scheme,  when  master  sends dummy buffer to slave via pipe on eof, or
>>tweak   ready_to_read  stuff  for fhandler_tty_slave, so it will react
>>when  input_available_event  is  signalled, not when pipe handle does.
>>currently, i'm trying to do the latter.

CF> I think that the latter makes sense.

CF> Maybe it's time to separate the pipe stuff from the tty stuff in select.cc

this  patch  fixes  ctrl-d  problem.  this  also  make  cygwin discard
contents of input buffer in canonical mode when user type VINTR, VSTOP
or VSUSP character.

Egor.            mailto:deo@logos-m.ru ICQ 5165414 FidoNet 2:5020/496.19
tty-slave-read2.diff
tty-slave-read2.ChangeLog


------------=_1583532846-65438-23
Content-Type: text/plain; charset=us-ascii; name="tty-slave-read2.ChangeLog"
Content-Disposition: inline; filename="tty-slave-read2.ChangeLog"
Content-Transfer-Encoding: base64
Content-Length: 920

MjAwMS0wMy0xOCAgRWdvciBEdWRhIDxkZW9AbG9nb3MtbS5ydT4KCgkqIGZo
YW5kbGVyLmggKGZoYW5kbGVyX3R0eV9zbGF2ZSk6IERlY2xhcmUgbmV3IG1l
dGhvZHMuCgkqIHNlbGVjdC5jYyAoZmhhbmRsZXJfdHR5X3NsYXZlOjpzZWxl
Y3RfcmVhZCk6IE5ldyBtZXRob2QuCgkqIHNlbGVjdC5jYyAoZmhhbmRsZXJf
dHR5X3NsYXZlOjpyZWFkeV9mb3JfcmVhZCk6IERpdHRvLgoJKiBzZWxlY3Qu
Y2MgKHZlcmlmeV90dHlfc2xhdmUpOiBOZXcgZnVuY3Rpb24uCgkqIGZoYW5k
bGVyX3Rlcm1pb3MuY2MgKGZoYW5kbGVyX3Rlcm1pb3M6OmxpbmVfZWRpdCk6
IEVtcHR5IGlucHV0CglidWZmZXIgb24gc2lnbmFsLgoJKiBmaGFuZGxlcl90
dHkuY2MgKGZoYW5kbGVyX3R0eV9zbGF2ZTo6cmVhZCk6IENoZWNrIGZvciBp
bnB1dCBkYXRhCglhZnRlciByZWFkaW5nIGZyb20gcGlwZS4gUmVzZXQgZXZl
bnQgaWYgaW5wdXQgcGlwZSBpcyBlbXB0eS4KCSogdHR5LmggKGNsYXNzIHR0
eSk6IEFsbG93IGNyZWF0aW5nIGV2ZW50cyB3aXRoIG1hbnVhbCByZXNldC4K
CSogdHR5LmNjICh0dHk6OmdldF9ldmVudCk6IFVzZSBtYW51YWxfcmVzZXQg
ZmxhZy4KCSogdHR5LmNjICh0dHk6OmNvbW1vbl9pbml0KTogQ3JlYXRlIGlu
cHV0X2F2YWlsYWJsZV9ldmVudCB3aXRoCgl3aXRoIG1hbnVhbCByZXNldC4K
Cg==

------------=_1583532846-65438-23
Content-Type: text/x-diff; charset=us-ascii; name="tty-slave-read2.diff"
Content-Disposition: inline; filename="tty-slave-read2.diff"
Content-Transfer-Encoding: base64
Content-Length: 7682

SW5kZXg6IGZoYW5kbGVyLmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaCx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMS40OApkaWZmIC11IC1wIC0yIC1yMS40
OCBmaGFuZGxlci5oCi0tLSBmaGFuZGxlci5oCTIwMDEvMDMvMTIgMjE6Mjc6
NDIJMS40OAorKysgZmhhbmRsZXIuaAkyMDAxLzAzLzE4IDEzOjQ5OjM3CkBA
IC03NjIsNCArNzYyLDYgQEAgcHVibGljOgogCiAgIG9mZl90IGxzZWVrIChv
ZmZfdCwgaW50KSB7IHJldHVybiAwOyB9CisgIHZpcnR1YWwgc2VsZWN0X3Jl
Y29yZCAqc2VsZWN0X3JlYWQgKHNlbGVjdF9yZWNvcmQgKnMpOworICBpbnQg
cmVhZHlfZm9yX3JlYWQgKGludCBmZCwgRFdPUkQgaG93bG9uZywgaW50IGln
bnJhKTsKIH07CiAKSW5kZXg6IGZoYW5kbGVyX3Rlcm1pb3MuY2MKPT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1
cC9jeWd3aW4vZmhhbmRsZXJfdGVybWlvcy5jYyx2CnJldHJpZXZpbmcgcmV2
aXNpb24gMS4xNgpkaWZmIC11IC1wIC0yIC1yMS4xNiBmaGFuZGxlcl90ZXJt
aW9zLmNjCi0tLSBmaGFuZGxlcl90ZXJtaW9zLmNjCTIwMDEvMDMvMTcgMDI6
MTU6MzMJMS4xNgorKysgZmhhbmRsZXJfdGVybWlvcy5jYwkyMDAxLzAzLzE4
IDEzOjQ5OjM3CkBAIC0yMTAsNCArMjEwLDUgQEAgZmhhbmRsZXJfdGVybWlv
czo6bGluZV9lZGl0IChjb25zdCBjaGFyIAogCiAJICB0ZXJtaW9zX3ByaW50
ZiAoImdvdCBpbnRlcnJ1cHQgJWQsIHNlbmRpbmcgc2lnbmFsICVkIiwgYywg
c2lnKTsKKwkgIGVhdF9yZWFkYWhlYWQgKC0xKTsKIAkgIGtpbGxfcGdycCAo
dGMtPmdldHBnaWQgKCksIHNpZyk7CiAJICB0Yy0+dGkuY19sZmxhZyAmPSB+
RkxVU0hPOwpJbmRleDogZmhhbmRsZXJfdHR5LmNjCj09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY3lnd2lu
L2ZoYW5kbGVyX3R0eS5jYyx2CnJldHJpZXZpbmcgcmV2aXNpb24gMS4yOApk
aWZmIC11IC1wIC0yIC1yMS4yOCBmaGFuZGxlcl90dHkuY2MKLS0tIGZoYW5k
bGVyX3R0eS5jYwkyMDAxLzAzLzE3IDAxOjQ1OjQwCTEuMjgKKysrIGZoYW5k
bGVyX3R0eS5jYwkyMDAxLzAzLzE4IDEzOjQ5OjM4CkBAIC02MTUsNCArNjE1
LDUgQEAgZmhhbmRsZXJfdHR5X3NsYXZlOjpyZWFkICh2b2lkICpwdHIsIHNp
egogICBEV09SRCBieXRlc19pbl9waXBlOwogICBjaGFyIGJ1ZltJTlBfQlVG
RkVSX1NJWkVdOworICBjaGFyIHBlZWtfYnVmW0lOUF9CVUZGRVJfU0laRV07
CiAgIERXT1JEIHRpbWVfdG9fd2FpdDsKICAgRFdPUkQgcmM7CkBAIC02Njgs
NSArNjY5LDUgQEAgZmhhbmRsZXJfdHR5X3NsYXZlOjpyZWFkICh2b2lkICpw
dHIsIHNpegogCSAgYnJlYWs7CiAJfQotICAgICAgaWYgKCFQZWVrTmFtZWRQ
aXBlIChnZXRfaGFuZGxlICgpLCBOVUxMLCAwLCBOVUxMLCAmYnl0ZXNfaW5f
cGlwZSwgTlVMTCkpCisgICAgICBpZiAoIVBlZWtOYW1lZFBpcGUgKGdldF9o
YW5kbGUgKCksIHBlZWtfYnVmLCBzaXplb2YocGVla19idWYpLCAmYnl0ZXNf
aW5fcGlwZSwgTlVMTCwgTlVMTCkpCiAJewogCSAgdGVybWlvc19wcmludGYg
KCJQZWVrTmFtZWRQaXBlIGZhaWxlZCwgJUUiKTsKQEAgLTY4Myw0ICs2ODQs
MTQgQEAgZmhhbmRsZXJfdHR5X3NsYXZlOjpyZWFkICh2b2lkICpwdHIsIHNp
egogCSAgICAgIF9yYWlzZSAoU0lHSFVQKTsKIAkgICAgfQorICAgICAgICAg
IC8qIE1TRE4gc3RhdGVzIHRoYXQgNXRoIHByYW1ldGVyIGNhbiBiZSB1c2Vk
IHRvIGRldGVybWluZSB0b3RhbAorICAgICAgICAgICAgIG51bWJlciBvZiBi
eXRlcyBpbiBwaXBlLCBidXQgZm9yIHNvbWUgcmVhc29uIHRoaXMgbnVtYmVy
IGRvZXNuJ3QKKyAgICAgICAgICAgICBjaGFuZ2UgYWZ0ZXIgYWZ0ZXIgc3Vj
Y2Vzc2Z1bCByZWFkLiBTbyB3ZSBoYXZlIHRvIHBlZWsgaW50byB0aGUKKyAg
ICAgICAgICAgICBwaXBlIGFnYWluIHRvIHNlZSBpZiBpbnB1dCBpcyBzdGls
bCBhdmFpbGFibGUgKi8KKyAgICAgICAgICBpZiAoIVBlZWtOYW1lZFBpcGUg
KGdldF9oYW5kbGUgKCksIHBlZWtfYnVmLCAxLCAmYnl0ZXNfaW5fcGlwZSwg
TlVMTCwgTlVMTCkpCisJICAgIHsKKwkgICAgICB0ZXJtaW9zX3ByaW50ZiAo
IlBlZWtOYW1lZFBpcGUgZmFpbGVkLCAlRSIpOworCSAgICAgIF9yYWlzZSAo
U0lHSFVQKTsKKwkgICAgICBieXRlc19pbl9waXBlID0gMDsKKwkgICAgfQog
CSAgaWYgKG4pCiAJICAgIHsKQEAgLTY5Miw2ICs3MDMsNiBAQCBmaGFuZGxl
cl90dHlfc2xhdmU6OnJlYWQgKHZvaWQgKnB0ciwgc2l6CiAJfQogCi0gICAg
ICBpZiAocmVhZGxlbiAhPSBieXRlc19pbl9waXBlKQotCVNldEV2ZW50IChp
bnB1dF9hdmFpbGFibGVfZXZlbnQpOworICAgICAgaWYgKCFieXRlc19pbl9w
aXBlKQorCVJlc2V0RXZlbnQgKGlucHV0X2F2YWlsYWJsZV9ldmVudCk7CiAK
ICAgICAgIFJlbGVhc2VNdXRleCAoaW5wdXRfbXV0ZXgpOwpJbmRleDogc2Vs
ZWN0LmNjCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnMv
c3JjL3NyYy93aW5zdXAvY3lnd2luL3NlbGVjdC5jYyx2CnJldHJpZXZpbmcg
cmV2aXNpb24gMS4zMgpkaWZmIC11IC1wIC0yIC1yMS4zMiBzZWxlY3QuY2MK
LS0tIHNlbGVjdC5jYwkyMDAxLzAzLzE4IDAzOjM0OjA1CTEuMzIKKysrIHNl
bGVjdC5jYwkyMDAxLzAzLzE4IDEzOjQ5OjM4CkBAIC03NDQsNCArNzQ0LDUx
IEBAIGZoYW5kbGVyX3R0eV9jb21tb246OnNlbGVjdF9leGNlcHQgKHNlbGUK
IH0KIAorc3RhdGljIGludAordmVyaWZ5X3R0eV9zbGF2ZSAoc2VsZWN0X3Jl
Y29yZCAqbWUsIGZkX3NldCAqcmVhZGZkcywgZmRfc2V0ICp3cml0ZWZkcywK
KwkgICBmZF9zZXQgKmV4Y2VwdGZkcykKK3sKKyAgaWYgKFdhaXRGb3JTaW5n
bGVPYmplY3QgKG1lLT5oLCAwKSA9PSBXQUlUX09CSkVDVF8wKQorICAgIG1l
LT5yZWFkX3JlYWR5ID0gMTsKKyAgcmV0dXJuIHNldF9iaXRzIChtZSwgcmVh
ZGZkcywgd3JpdGVmZHMsIGV4Y2VwdGZkcyk7Cit9CisKK3NlbGVjdF9yZWNv
cmQgKgorZmhhbmRsZXJfdHR5X3NsYXZlOjpzZWxlY3RfcmVhZCAoc2VsZWN0
X3JlY29yZCAqcykKK3sKKyAgaWYgKCFzKQorICAgIHMgPSBuZXcgc2VsZWN0
X3JlY29yZDsKKyAgcy0+aCA9IGlucHV0X2F2YWlsYWJsZV9ldmVudDsKKyAg
cy0+c3RhcnR1cCA9IG5vX3N0YXJ0dXA7CisgIHMtPnBvbGwgPSBwb2xsX3Bp
cGU7CisgIHMtPnZlcmlmeSA9IHZlcmlmeV90dHlfc2xhdmU7CisgIHMtPnJl
YWRfc2VsZWN0ZWQgPSBUUlVFOworICBzLT5jbGVhbnVwID0gTlVMTDsKKyAg
cmV0dXJuIHM7Cit9CisKK2ludAorZmhhbmRsZXJfdHR5X3NsYXZlOjpyZWFk
eV9mb3JfcmVhZCAoaW50IGZkLCBEV09SRCBob3dsb25nLCBpbnQgaWducmEp
Cit7CisgIEhBTkRMRSB3NFsyXTsKKyAgaWYgKCFpZ25yYSAmJiBnZXRfcmVh
ZGFoZWFkX3ZhbGlkICgpKQorICAgIHsKKyAgICAgIHNlbGVjdF9wcmludGYg
KCJyZWFkYWhlYWQiKTsKKyAgICAgIHJldHVybiAxOworICAgIH0KKyAgdzRb
MF0gPSBzaWduYWxfYXJyaXZlZDsKKyAgdzRbMV0gPSBpbnB1dF9hdmFpbGFi
bGVfZXZlbnQ7CisgIHN3aXRjaCAoV2FpdEZvck11bHRpcGxlT2JqZWN0cyAo
MiwgdzQsIEZBTFNFLCBob3dsb25nKSkKKyAgICB7CisgICAgY2FzZSBXQUlU
X09CSkVDVF8wICsgMToKKyAgICAgIHJldHVybiAxOworICAgIGNhc2UgV0FJ
VF9GQUlMRUQ6CisgICAgICBzZWxlY3RfcHJpbnRmICggIndhaXQgZmFpbGVk
ICVFIiApOworICAgIGNhc2UgV0FJVF9PQkpFQ1RfMDoKKyAgICBjYXNlIFdB
SVRfVElNRU9VVDoKKyAgICBkZWZhdWx0OgorICAgICAgcmV0dXJuIDA7Cisg
ICAgfQorfQorCiBzZWxlY3RfcmVjb3JkICoKIGZoYW5kbGVyX2Rldl9udWxs
OjpzZWxlY3RfcmVhZCAoc2VsZWN0X3JlY29yZCAqcykKSW5kZXg6IHR0eS5j
Ywo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9z
cmMvd2luc3VwL2N5Z3dpbi90dHkuY2MsdgpyZXRyaWV2aW5nIHJldmlzaW9u
IDEuMTUKZGlmZiAtdSAtcCAtMiAtcjEuMTUgdHR5LmNjCi0tLSB0dHkuY2MJ
MjAwMS8wMy8xOCAwMzozNDowNQkxLjE1CisrKyB0dHkuY2MJMjAwMS8wMy8x
OCAxMzo0OTozOApAQCAtMzI2LDUgKzMyNiw1IEBAIHR0eTo6aW5pdCAodm9p
ZCkKIAogSEFORExFCi10dHk6OmdldF9ldmVudCAoY29uc3QgY2hhciAqZm10
LCBCT09MIGluaGVyaXQpCit0dHk6OmdldF9ldmVudCAoY29uc3QgY2hhciAq
Zm10LCBCT09MIGluaGVyaXQsIEJPT0wgbWFudWFsX3Jlc2V0KQogewogICBI
QU5ETEUgaGV2OwpAQCAtMzMyLDUgKzMzMiw1IEBAIHR0eTo6Z2V0X2V2ZW50
IChjb25zdCBjaGFyICpmbXQsIEJPT0wgaW4KIAogICBfX3NtYWxsX3Nwcmlu
dGYgKGJ1ZiwgZm10LCBudHR5KTsKLSAgaWYgKCEoaGV2ID0gQ3JlYXRlRXZl
bnQgKGluaGVyaXQgPyAmc2VjX2FsbCA6ICZzZWNfYWxsX25paCwgRkFMU0Us
IEZBTFNFLCBidWYpKSkKKyAgaWYgKCEoaGV2ID0gQ3JlYXRlRXZlbnQgKGlu
aGVyaXQgPyAmc2VjX2FsbCA6ICZzZWNfYWxsX25paCwgbWFudWFsX3Jlc2V0
LCBGQUxTRSwgYnVmKSkpCiAgICAgewogICAgICAgdGVybWlvc19wcmludGYg
KCJjb3VsZG4ndCBjcmVhdGUgJXMiLCBidWYpOwpAQCAtNDA5LDUgKzQwOSw1
IEBAIHR0eTo6Y29tbW9uX2luaXQgKGZoYW5kbGVyX3B0eV9tYXN0ZXIgKnAK
ICAgICB9CiAKLSAgaWYgKCEocHR5bS0+aW5wdXRfYXZhaWxhYmxlX2V2ZW50
ID0gZ2V0X2V2ZW50IChJTlBVVF9BVkFJTEFCTEVfRVZFTlQsIEZBTFNFKSkp
CisgIGlmICghKHB0eW0tPmlucHV0X2F2YWlsYWJsZV9ldmVudCA9IGdldF9l
dmVudCAoSU5QVVRfQVZBSUxBQkxFX0VWRU5ULCBGQUxTRSwgVFJVRSkpKQog
ICAgIHJldHVybiBGQUxTRTsKIApJbmRleDogdHR5LmgKPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQpSQ1MgZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jeWd3
aW4vdHR5LmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMwpkaWZmIC11IC1w
IC0yIC1yMS4zIHR0eS5oCi0tLSB0dHkuaAkyMDAxLzAzLzA0IDE1OjM0OjI1
CTEuMworKysgdHR5LmgJMjAwMS8wMy8xOCAxMzo0OTozOApAQCAtODcsNSAr
ODcsNSBAQCBjbGFzcyBmaGFuZGxlcl9wdHlfbWFzdGVyOwogY2xhc3MgdHR5
OiBwdWJsaWMgdHR5X21pbgogewotICBIQU5ETEUgZ2V0X2V2ZW50IChjb25z
dCBjaGFyICpmbXQsIEJPT0wgaW5oZXJpdCk7CisgIEhBTkRMRSBnZXRfZXZl
bnQgKGNvbnN0IGNoYXIgKmZtdCwgQk9PTCBpbmhlcml0LCBCT09MIG1hbnVh
bF9yZXNldCA9IEZBTFNFKTsKIHB1YmxpYzoKICAgSFdORCAgaHduZDsJLyog
Q29uc29sZSB3aW5kb3cgaGFuZGxlIHR0eSBiZWxvbmdzIHRvICovCg==

------------=_1583532846-65438-23--
