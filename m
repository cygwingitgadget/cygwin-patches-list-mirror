From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-patches@cygwin.com>
Subject: Re: daemon snapshot
Date: Mon, 24 Sep 2001 15:50:00 -0000
Message-id: <0fe001c1454b$530e89d0$0200a8c0@lifelesswks>
References: <0db501c144fe$1b7ccbf0$0200a8c0@lifelesswks>
X-SW-Source: 2001-q3/msg00192.html
Content-type: multipart/mixed; boundary="----------=_1583532849-65438-107"

This is a multi-part message in MIME format...

------------=_1583532849-65438-107
Content-length: 384

----- Original Message -----
From: "Robert Collins" <robert.collins@itdomain.com.au>


> Well I've been puddling along adding shm features. We're nearly core
> feature complete now. (I haven't had much time to commit to it :[).
>
> Attached is a snapshot for your delight and entertainment.

I thought you might like one that works. I had a couple of unchecked in
changes.. doh!

Rob

------------=_1583532849-65438-107
Content-Type: text/x-diff; charset=us-ascii; name="daemonsnap20010925.patch"
Content-Disposition: inline; filename="daemonsnap20010925.patch"
Content-Transfer-Encoding: base64
Content-Length: 113782

UGF0Y2ggZmlsZSBnZW5lcmF0ZWQgVHVlIFNlcCAyNSAwODo0ODo1NiAgMjAw
MSBmcm9tCkNWUyBicmFuY2ggY3ZzdXBsb2NhbApDVlMgcmVwb3NpdG9yeTog
cm9iZXJ0Y0AxOTIuMTY4LjAuMTovaG9tZS9yb2JlcnRjL2N2c3VwL2N5Z3dp
bi9zcmMKQ1ZTIG1vZHVsZTogc3JjCgpJbmRleDogc3JjL25ld2xpYi9saWJj
L2luY2x1ZGUvc3lzL3R5cGVzLmgKZGlmZiAtdSBzcmMvbmV3bGliL2xpYmMv
aW5jbHVkZS9zeXMvdHlwZXMuaDoxLjcgc3JjL25ld2xpYi9saWJjL2luY2x1
ZGUvc3lzL3R5cGVzLmg6MS43LjIuMQotLS0gc3JjL25ld2xpYi9saWJjL2lu
Y2x1ZGUvc3lzL3R5cGVzLmg6MS43CVRodSBBcHIgMTIgMTA6MDU6NTcgMjAw
MQorKysgc3JjL25ld2xpYi9saWJjL2luY2x1ZGUvc3lzL3R5cGVzLmgJTW9u
IFNlcCAyNCAyMjoyNTo0NSAyMDAxCkBAIC0xMzMsNyArMTMzLDExIEBACiB0
eXBlZGVmCXVuc2lnbmVkIHNob3J0CXVpZF90OwogdHlwZWRlZgl1bnNpZ25l
ZCBzaG9ydAlnaWRfdDsKIHR5cGVkZWYgaW50IHBpZF90OwotdHlwZWRlZgls
b25nIGtleV90OworI2lmIGRlZmluZWQgKF9fQ1lHV0lOX18pCit0eXBlZGVm
IGxvbmcgbG9uZyBpbnQga2V5X3Q7CisjZWxzZQordHlwZWRlZiBsb25nIGtl
eV90OworI2VuZGlmIC8qIF9fQ1lHV0lOX18gKi8KIHR5cGVkZWYgbG9uZyBz
c2l6ZV90OwogCiAjaWZkZWYgX19NU190eXBlc19fCkluZGV4OiBzcmMvd2lu
c3VwL2N5Z3dpbi9NYWtlZmlsZS5pbgpkaWZmIC11IHNyYy93aW5zdXAvY3ln
d2luL01ha2VmaWxlLmluOjEuNjIgc3JjL3dpbnN1cC9jeWd3aW4vTWFrZWZp
bGUuaW46MS42Mi4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL01ha2VmaWxl
LmluOjEuNjIJU2F0IFNlcCAxNSAxNDozNjo0MyAyMDAxCisrKyBzcmMvd2lu
c3VwL2N5Z3dpbi9NYWtlZmlsZS5pbglNb24gU2VwIDI0IDIyOjQ5OjEwIDIw
MDEKQEAgLTExNiwxNiArMTE2LDE5IEBACiAKIERMTF9JTVBPUlRTOj0kKHcz
MmFwaV9saWIpL2xpYmtlcm5lbDMyLmEKIAotRExMX09GSUxFUzo9YXNzZXJ0
Lm8gYXV0b2xvYWQubyBjeWdoZWFwLm8gZGNydDAubyBkZWJ1Zy5vIGRlbHF1
ZXVlLm8gZGlyLm8gXAorRExMX09GSUxFUzo9YXNzZXJ0Lm8gYXV0b2xvYWQu
byBjeWdoZWFwLm8gY3lnc2VydmVyX2NsaWVudC5vIGN5Z3NlcnZlcl9zaG0u
byBcCisJY3lnc2VydmVyX3RyYW5zcG9ydC5vIGN5Z3NlcnZlcl90cmFuc3Bv
cnRfcGlwZXMubyBkY3J0MC5vIGRlYnVnLm8gXAorCWRlbHF1ZXVlLm8gZGly
Lm8gXAogCWRsZmNuLm8gZGxsX2luaXQubyBkdGFibGUubyBlbnZpcm9uLm8g
IGVycm5vLm8gZXhjZXB0aW9ucy5vIGV4ZWMubyBcCiAJZXh0ZXJuYWwubyBm
Y250bC5vIGZoYW5kbGVyLm8gZmhhbmRsZXJfY2xpcGJvYXJkLm8gZmhhbmRs
ZXJfY29uc29sZS5vIFwKIAlmaGFuZGxlcl9kc3AubyBmaGFuZGxlcl9mbG9w
cHkubyBmaGFuZGxlcl9tZW0ubyBmaGFuZGxlcl9yYW5kb20ubyBcCiAJZmhh
bmRsZXJfcmF3Lm8gZmhhbmRsZXJfc2VyaWFsLm8gZmhhbmRsZXJfc29ja2V0
Lm8gZmhhbmRsZXJfdGFwZS5vIFwKIAlmaGFuZGxlcl90ZXJtaW9zLm8gZmhh
bmRsZXJfdHR5Lm8gZmhhbmRsZXJfd2luZG93cy5vIGZoYW5kbGVyX3plcm8u
byBcCi0JZm9yay5vIGdsb2IubyBncnAubyBoZWFwLm8gaW5pdC5vIGlvY3Rs
Lm8gbG9jYWx0aW1lLm8gbWFsbG9jLm8gXAorCWZvcmsubyBnbG9iLm8gZ3Jw
Lm8gaGVhcC5vIGluaXQubyBpb2N0bC5vIGlwYy5vIGxvY2FsdGltZS5vIG1h
bGxvYy5vIFwKIAltaXNjZnVuY3MubyBtbWFwLm8gbmV0Lm8gbnRlYS5vIHBh
c3N3ZC5vIHBhdGgubyBwaW5mby5vIHBpcGUubyBwb2xsLm8gXAogCXB0aHJl
YWQubyByZWdleHAubyByZWdlcnJvci5vIHJlZ3N1Yi5vIHJlZ2lzdHJ5Lm8g
cmVzb3VyY2UubyBzY2FuZGlyLm8gXAotCXNjaGVkLm8gc2VjX2FjbC5vIHNl
Y19oZWxwZXIubyBzZWN1cml0eS5vIHNlbGVjdC5vIHNoYXJlZC5vIHNob3J0
Y3V0Lm8gc2lnbmFsLm8gc2lncHJvYy5vIFwKKwlzY2hlZC5vIHNlY19hY2wu
byBzZWNfaGVscGVyLm8gc2VjdXJpdHkubyBzZWxlY3QubyBzaGFyZWQubyBz
aG0ubyBcCisJc2hvcnRjdXQubyBzaWduYWwubyBzaWdwcm9jLm8gXAogCXNt
YWxscHJpbnQubyBzcGF3bi5vIHN0cmFjZS5vIHN0cnNlcC5vIHN5bmMubyBz
eXNjYWxscy5vIHN5c2NvbmYubyBcCiAJc3lzbG9nLm8gdGVybWlvcy5vIHRo
cmVhZC5vIHRpbWVzLm8gdHR5Lm8gdWluZm8ubyB1bmFtZS5vIHdhaXQubyBc
CiAJd2luY2FwLm8gd2luZG93Lm8gXApAQCAtMTQ0LDEzICsxNDcsMTYgQEAK
IAogYWxsOiBhbGxfdGFyZ2V0ICQoYWxsX2hvc3QpCiAKLWFsbF90YXJnZXQ6
ICQoTElCX05BTUUpIGF1dG9tb2RlLm8gYmlubW9kZS5vIHRleHRtb2RlLm8g
JChMSUJHTU9OX0EpCithbGxfdGFyZ2V0OiAkKExJQl9OQU1FKSBhdXRvbW9k
ZS5vIGJpbm1vZGUubyB0ZXh0bW9kZS5vICQoTElCR01PTl9BKSBjeWdzZXJ2
ZXIuZXhlCiAKIGFsbF9ob3N0OiBuZXctJChMSUJfTkFNRSkgY3lncnVuLmV4
ZQogCiBmb3JjZToKIAotaW5zdGFsbDogaW5zdGFsbC1saWJzIGluc3RhbGwt
aGVhZGVycyAkKGluc3RhbGxfaG9zdCkgJChpbnN0YWxsX3RhcmdldCkKK2lu
c3RhbGw6IGluc3RhbGwtYmluIGluc3RhbGwtbGlicyBpbnN0YWxsLWhlYWRl
cnMgJChpbnN0YWxsX2hvc3QpICQoaW5zdGFsbF90YXJnZXQpCisKK2luc3Rh
bGwtYmluOiBjeWdzZXJ2ZXIuZXhlCisJJChJTlNUQUxMX1BST0dSQU0pIGN5
Z3NlcnZlci5leGUgJChiaW5kaXIpL2N5Z3NlcnZlci5leGUJCiAKIGluc3Rh
bGwtbGliczogJChMSUJfTkFNRSkKIAkkKElOU1RBTExfREFUQSkgbmV3LSQo
RExMX05BTUUpICQoYmluZGlyKS8kKERMTF9OQU1FKTsgXApAQCAtMjEwLDEy
ICsyMTYsMzMgQEAKIHdpbnZlcl9zdGFtcDogbWt2ZXJzLnNoIGluY2x1ZGUv
Y3lnd2luL3ZlcnNpb24uaCB3aW52ZXIucmMgJChETExfT0ZJTEVTKQogCUBl
Y2hvICJNYWtpbmcgdmVyc2lvbi5vIGFuZCB3aW52ZXIubyI7XAogCSQoU0hF
TEwpICR7d29yZCAxLCRefSAke3dvcmQgMiwkXn0gJHt3b3JkIDMsJF59ICQo
V0lORFJFUykgJiYgXAotCXRvdWNoICRAICYmIFwKLQkkKENPTVBJTEVfQ1hY
KSAtbyB2ZXJzaW9uLm8gdmVyc2lvbi5jYworCSQoQ1hYKSAtYyAtbyB2ZXJz
aW9uLm8gdmVyc2lvbi5jYyAmJlwKKwl0b3VjaCAkQAogCiBjeWdydW4uZXhl
IDogY3lncnVuLm8gJChMSUJfTkFNRSkgJCh3MzJhcGlfbGliKS9saWJ1c2Vy
MzIuYSBcCiAJICAgICAkKHczMmFwaV9saWIpL2xpYnNoZWxsMzIuYSAkKHcz
MmFwaV9saWIpL2xpYmtlcm5lbDMyLmEKIAkkKENDKSAtbm9kZWZhdWx0bGli
cyAtbyAkQCAkXgorCitjeWdzZXJ2ZXJfdHJhbnNwb3J0X291dHNpZGUubzog
Y3lnc2VydmVyX3RyYW5zcG9ydC5jYworCSQoQ09NUElMRV9DWFgpIC1EX19P
VVRTSURFX0NZR1dJTl9fIC1vICRAICQ8CisKK2N5Z3NlcnZlcl90cmFuc3Bv
cnRfcGlwZXNfb3V0c2lkZS5vOiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVz
LmNjCisJJChDT01QSUxFX0NYWCkgLURfX09VVFNJREVfQ1lHV0lOX18gLW8g
JEAgJDwKKworY3lnc2VydmVyX2NsaWVudF9vdXRzaWRlLm86IGN5Z3NlcnZl
cl9jbGllbnQuY2MKKwkgJChDT01QSUxFX0NYWCkgLURfX09VVFNJREVfQ1lH
V0lOX18gLW8gJEAgJDwKKworY3lnc2VydmVyX3NobV9vdXRzaWRlLm86IGN5
Z3NlcnZlcl9zaG0uY2MKKwkkKENPTVBJTEVfQ1hYKSAtRF9fT1VUU0lERV9D
WUdXSU5fXyAtbyAkQCAkPAorCitjeWdzZXJ2ZXIuZXhlOiBjeWdzZXJ2ZXIu
byBjeWdzZXJ2ZXJfc2htX291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0
X291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzX291dHNpZGUu
byBjeWdzZXJ2ZXJfY2xpZW50X291dHNpZGUubyB3aW5jYXAubyBzbWFsbHBy
aW50Lm8gCisJJChDWFgpIC1vICRAICReCisjaWZkZWYgVkVSQk9TRQorIwkk
KENYWCkgJChNSU5HV19DWFhGTEFHUykgLW8gJEAgJHt3b3JkbGlzdCAxLDMs
JF59IC1CJChtaW5nd19idWlsZCkvICQoTUlOR1dfTERGTEFHUykKKyNlbHNl
CisjCUBlY2hvICQoQ1hYKSAtbyAkQCAke3dvcmRsaXN0IDEsMywkXn0gJHtm
aWx0ZXItb3V0IC1CJSwgJChNSU5HV19DWFhGTEFHUykgJChNSU5HV19MREZM
QUdTKX07XAorIwkkKENYWCkgJChNSU5HV19DWFhGTEFHUykgLW8gJEAgJHt3
b3JkbGlzdCAxLDMsJF59IC1CJChtaW5nd19idWlsZCkvICQoTUlOR1dfTERG
TEFHUykKKyNlbmRpZgogCiAjDAogCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dp
bi9hdXRvbG9hZC5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL2F1dG9s
b2FkLmNjOjEuMzIgc3JjL3dpbnN1cC9jeWd3aW4vYXV0b2xvYWQuY2M6MS4z
Mi4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL2F1dG9sb2FkLmNjOjEuMzIJ
VGh1IFNlcCAxMyAwMzo0NjozNSAyMDAxCisrKyBzcmMvd2luc3VwL2N5Z3dp
bi9hdXRvbG9hZC5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTMy
Nyw2ICszMjcsNyBAQAogTG9hZERMTGZ1bmMgKEdldFRva2VuSW5mb3JtYXRp
b24sIDIwLCBhZHZhcGkzMikKIExvYWRETExmdW5jIChHZXRVc2VyTmFtZUEs
IDgsIGFkdmFwaTMyKQogTG9hZERMTGZ1bmMgKEltcGVyc29uYXRlTG9nZ2Vk
T25Vc2VyLCA0LCBhZHZhcGkzMikKK0xvYWRETExmdW5jIChJbXBlcnNvbmF0
ZU5hbWVkUGlwZUNsaWVudCwgNCwgYWR2YXBpMzIpCiBMb2FkRExMZnVuYyAo
SW5pdGlhbGl6ZUFjbCwgMTIsIGFkdmFwaTMyKQogTG9hZERMTGZ1bmMgKElu
aXRpYWxpemVTZWN1cml0eURlc2NyaXB0b3IsIDgsIGFkdmFwaTMyKQogTG9h
ZERMTGZ1bmMgKEluaXRpYWxpemVTaWQsIDEyLCBhZHZhcGkzMikKSW5kZXg6
IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlci5jYwpkaWZmIC11IC9kZXYv
bnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXIuY2M6MS4xLjIuMQot
LS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNy
Yy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlci5jYwlNb24gU2VwIDI0IDIyOjQ5
OjEwIDIwMDEKQEAgLTAsMCArMSw1NDYgQEAKKy8qIGN5Z3NlcnZlci5jYwor
CisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKworICAgV3JpdHRl
biBieSBFZ29yIER1ZGEgPGRlb0Bsb2dvcy1tLnJ1PgorCisgICBUaGlzIGZp
bGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdhcmUgaXMg
YSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJtcyBv
ZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQgdGhl
IGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMuICovCisK
KyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN0ZGlvLmg+CisjaW5j
bHVkZSA8dW5pc3RkLmg+CisjaW5jbHVkZSA8d2luZG93cy5oPgorI2luY2x1
ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KKyNp
bmNsdWRlIDxuZXRkYi5oPgorI2luY2x1ZGUgIndpbmNhcC5oIgorCisjaW5j
bHVkZSAiZ2V0b3B0LmgiCisKKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVy
X3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIK
KyNpbmNsdWRlICJjeWdzZXJ2ZXJfc2htLmgiCisKKworR0VORVJJQ19NQVBQ
SU5HIGFjY2Vzc19tYXBwaW5nOworY2xhc3MgdHJhbnNwb3J0X2xheWVyX2Jh
c2UgKnRyYW5zcG9ydDsKKworRFdPUkQgcmVxdWVzdF9jb3VudCA9IDA7CisK
K0JPT0wKK3NldHVwX3ByaXZpbGVnZXMgKCkKK3sKKyAgQk9PTCByYywgcmV0
X3ZhbDsKKyAgSEFORExFIGhUb2tlbiA9IE5VTEw7CisgIFRPS0VOX1BSSVZJ
TEVHRVMgc1ByaXZpbGVnZXM7CisKKyAgcmMgPSBPcGVuUHJvY2Vzc1Rva2Vu
ICggR2V0Q3VycmVudFByb2Nlc3MoKSAsIFRPS0VOX0FMTF9BQ0NFU1MgLCAm
aFRva2VuICkgOworICBpZiAoICFyYyApCisgICAgeworICAgICAgcHJpbnRm
ICggImVycm9yIG9wZW5pbmcgcHJvY2VzcyB0b2tlbiAoJWx1KVxuIiwgR2V0
TGFzdEVycm9yICgpICk7CisgICAgICByZXRfdmFsID0gRkFMU0U7CisgICAg
ICBnb3RvIG91dDsKKyAgICB9CisgIHJjID0gTG9va3VwUHJpdmlsZWdlVmFs
dWUgKCBOVUxMLCBTRV9ERUJVR19OQU1FLCAmc1ByaXZpbGVnZXMuUHJpdmls
ZWdlc1swXS5MdWlkICk7CisgIGlmICggIXJjICkKKyAgICB7CisgICAgICBw
cmludGYgKCAiZXJyb3IgZ2V0dGluZyBwcmlnaWxlZ2UgbHVpZCAoJWx1KVxu
IiwgR2V0TGFzdEVycm9yICgpICk7CisgICAgICByZXRfdmFsID0gRkFMU0U7
CisgICAgICBnb3RvIG91dDsKKyAgICB9CisgIHNQcml2aWxlZ2VzLlByaXZp
bGVnZUNvdW50ID0gMSA7CisgIHNQcml2aWxlZ2VzLlByaXZpbGVnZXNbMF0u
QXR0cmlidXRlcyA9IFNFX1BSSVZJTEVHRV9FTkFCTEVEIDsKKyAgcmMgPSBB
ZGp1c3RUb2tlblByaXZpbGVnZXMgKCBoVG9rZW4sIEZBTFNFLCAmc1ByaXZp
bGVnZXMsIDAsIE5VTEwsIE5VTEwgKSA7CisgIGlmICggIXJjICkKKyAgICB7
CisgICAgICBwcmludGYgKCAiZXJyb3IgYWRqdXN0aW5nIHByaWdpbGVnZSBs
ZXZlbC4gKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSApOworICAgICAgcmV0
X3ZhbCA9IEZBTFNFOworICAgICAgZ290byBvdXQ7CisgICAgfQorCisgIGFj
Y2Vzc19tYXBwaW5nLkdlbmVyaWNSZWFkID0gRklMRV9SRUFEX0RBVEE7Cisg
IGFjY2Vzc19tYXBwaW5nLkdlbmVyaWNXcml0ZSA9IEZJTEVfV1JJVEVfREFU
QTsKKyAgYWNjZXNzX21hcHBpbmcuR2VuZXJpY0V4ZWN1dGUgPSAwOworICBh
Y2Nlc3NfbWFwcGluZy5HZW5lcmljQWxsID0gRklMRV9SRUFEX0RBVEEgfCBG
SUxFX1dSSVRFX0RBVEE7CisKKyAgcmV0X3ZhbCA9IFRSVUU7CisKK291dDoK
KyAgQ2xvc2VIYW5kbGUgKCBoVG9rZW4gKTsKKyAgcmV0dXJuIHJldF92YWw7
Cit9CisKK2ludAorY2hlY2tfYW5kX2R1cF9oYW5kbGUgKEhBTkRMRSBmcm9t
X3Byb2Nlc3MsIEhBTkRMRSB0b19wcm9jZXNzLAorCQkgICAgICBIQU5ETEUg
ZnJvbV9wcm9jZXNzX3Rva2VuLAorICAgICAgICAgICAgICAgICAgICAgIERX
T1JEIGFjY2VzcywKKyAgICAgICAgICAgICAgICAgICAgICBIQU5ETEUgZnJv
bV9oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgSEFORExFKiB0b19o
YW5kbGVfcHRyLCBCT09MIGJJbmhlcml0SGFuZGxlKQoreworICBIQU5ETEUg
bG9jYWxfaGFuZGxlID0gTlVMTDsKKyAgaW50IHJldF92YWwgPSBFQUNDRVM7
CisgIGNoYXIgc2RfYnVmIFsxMDI0XTsKKyAgUFNFQ1VSSVRZX0RFU0NSSVBU
T1Igc2QgPSAoUFNFQ1VSSVRZX0RFU0NSSVBUT1IpICZzZF9idWY7CisgIERX
T1JEIGJ5dGVzX25lZWRlZDsKKyAgUFJJVklMRUdFX1NFVCBwczsKKyAgRFdP
UkQgcHNfbGVuID0gc2l6ZW9mIChwcyk7CisgIEJPT0wgc3RhdHVzOworCisg
IGlmIChmcm9tX3Byb2Nlc3MgIT0gR2V0Q3VycmVudFByb2Nlc3MgKCkpCit7
IAorCisgIGlmICghRHVwbGljYXRlSGFuZGxlIChmcm9tX3Byb2Nlc3MsIGZy
b21faGFuZGxlLAorCSAgICAgICAgICAgICAgICBHZXRDdXJyZW50UHJvY2Vz
cyAoKSwgJmxvY2FsX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
IDAsIGJJbmhlcml0SGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAg
RFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKKyAgICB7CisgICAgICBwcmludGYg
KCAiZXJyb3IgZ2V0dGluZyBoYW5kbGUoJXUpIHRvIHNlcnZlciAoJWx1KVxu
IiwgKHVuc2lnbmVkIGludClmcm9tX2hhbmRsZSwgR2V0TGFzdEVycm9yICgp
KTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KK30gZWxzZQorIGxvY2FsX2hh
bmRsZSA9IGZyb21faGFuZGxlOworCisgIGlmICghR2V0S2VybmVsT2JqZWN0
U2VjdXJpdHkgKGxvY2FsX2hhbmRsZSwKKyAgCQkJICAgICAgICBPV05FUl9T
RUNVUklUWV9JTkZPUk1BVElPTiB8IEdST1VQX1NFQ1VSSVRZX0lORk9STUFU
SU9OCXwgREFDTF9TRUNVUklUWV9JTkZPUk1BVElPTiwKKwkJCQlzZCwgc2l6
ZW9mIChzZF9idWYpLCAmYnl0ZXNfbmVlZGVkKSkKKyAgICB7CisgICAgICBw
cmludGYgKCAiZXJyb3IgZ2V0dGluZyBoYW5kbGUgU0QgKCVsdSlcbiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAg
TWFwR2VuZXJpY01hc2sgKCZhY2Nlc3MsICZhY2Nlc3NfbWFwcGluZyk7CisK
KyAgaWYgKCFBY2Nlc3NDaGVjayAoc2QsIGZyb21fcHJvY2Vzc190b2tlbiwg
YWNjZXNzLCAmYWNjZXNzX21hcHBpbmcsCisgIAkJICAgICZwcywgJnBzX2xl
biwgJmFjY2VzcywgJnN0YXR1cykpCisgICAgeworICAgICAgcHJpbnRmICgg
ImVycm9yIGNoZWNraW5nIGFjY2VzcyByaWdodHMgKCVsdSlcbiIsIEdldExh
c3RFcnJvciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgaWYg
KCFzdGF0dXMpCisgICAgeworICAgICAgcHJpbnRmICggImFjY2VzcyB0byBv
YmplY3QgZGVuaWVkXG4iKTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKwor
ICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAoZnJvbV9wcm9jZXNzLCBmcm9tX2hh
bmRsZSwKKwkgICAgICAgICAgICAgICAgdG9fcHJvY2VzcywgdG9faGFuZGxl
X3B0ciwKKyAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VzcywgYkluaGVy
aXRIYW5kbGUsIDApKQorICAgIHsKKyAgICAgIHByaW50ZiAoICJlcnJvciBn
ZXR0aW5nIGhhbmRsZSB0byBjbGllbnQgKCVsdSlcbiIsIEdldExhc3RFcnJv
ciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgcmV0X3ZhbCA9
IDA7CisgICAgICAgICAgICAgICAgICAgIAorb3V0OgorICBpZiAobG9jYWxf
aGFuZGxlICYmIGZyb21fcHJvY2VzcyAhPSBHZXRDdXJyZW50UHJvY2VzcyAo
KSkKKyAgICBDbG9zZUhhbmRsZSAobG9jYWxfaGFuZGxlKTsKKworICByZXR1
cm4gKHJldF92YWwpOworfQorCitpbnQKK2NoZWNrX2FuZF9kdXBfaGFuZGxl
IChIQU5ETEUgZnJvbV9wcm9jZXNzLCBIQU5ETEUgdG9fcHJvY2VzcywKKyAg
ICAgICAgICAgICAgICAgICAgICBIQU5ETEUgZnJvbV9wcm9jZXNzX3Rva2Vu
LAorICAgICAgICAgICAgICAgICAgICAgIERXT1JEIGFjY2VzcywKKyAgICAg
ICAgICAgICAgICAgICAgICBIQU5ETEUgZnJvbV9oYW5kbGUsCisgICAgICAg
ICAgICAgICAgICAgICAgSEFORExFKiB0b19oYW5kbGVfcHRyKQoreworICBy
ZXR1cm4gY2hlY2tfYW5kX2R1cF9oYW5kbGUoZnJvbV9wcm9jZXNzLHRvX3By
b2Nlc3MsZnJvbV9wcm9jZXNzX3Rva2VuLGFjY2Vzcyxmcm9tX2hhbmRsZSx0
b19oYW5kbGVfcHRyLEZBTFNFKTsKK30KKwordm9pZAorY2xpZW50X3JlcXVl
c3RfYXR0YWNoX3R0eTo6c2VydmUodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNv
bm4pCit7CisgIEhBTkRMRSBmcm9tX3Byb2Nlc3NfaGFuZGxlID0gTlVMTDsK
KyAgSEFORExFIHRvX3Byb2Nlc3NfaGFuZGxlID0gTlVMTDsKKyAgSEFORExF
IHRva2VuX2hhbmRsZSA9IE5VTEw7CisgIERXT1JEIHJjOworCisgIGlmICho
ZWFkZXIuY2IgIT0gc2l6ZW9mIChyZXEpKQorICAgIHsKKyAgICAgIGhlYWRl
ci5lcnJvcl9jb2RlID0gRUlOVkFMOworICAgICAgcmV0dXJuOworICAgIH0K
KworI2lmZGVmIERFQlVHCisgIHByaW50ZiAoIiVkOiglZCwlZCkgLT4gJWRc
biIsIHJlcS5tYXN0ZXJfcGlkLAorICAJICAJCQlyZXEuZnJvbV9tYXN0ZXIs
IHJlcS50b19tYXN0ZXIsCisJCQkJcmVxLnBpZCk7CisjZW5kaWYKKworICBm
cm9tX3Byb2Nlc3NfaGFuZGxlID0gT3BlblByb2Nlc3MgKFBST0NFU1NfRFVQ
X0hBTkRMRSwgRkFMU0UsIHJlcS5tYXN0ZXJfcGlkKTsKKyAgdG9fcHJvY2Vz
c19oYW5kbGUgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19EVVBfSEFORExFLCBG
QUxTRSwgcmVxLnBpZCk7CisgIGlmICghZnJvbV9wcm9jZXNzX2hhbmRsZSB8
fCAhdG9fcHJvY2Vzc19oYW5kbGUpCisgICAgeworICAgICAgcHJpbnRmICgi
ZXJyb3Igb3BlbmluZyBwcm9jZXNzICglbHUpXG4iLCBHZXRMYXN0RXJyb3Ig
KCkpOworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAg
ICBnb3RvIG91dDsKKyAgICB9CisKKyAgdHJhbnNwb3J0LT5pbXBlcnNvbmF0
ZV9jbGllbnQgKCk7CisgIAorICByYyA9IE9wZW5UaHJlYWRUb2tlbiAoR2V0
Q3VycmVudFRocmVhZCAoKSwKKyAgCQkJVE9LRU5fUVVFUlksCisgICAgICAg
ICAgICAgICAgICAgICAgICBUUlVFLAorCQkJJnRva2VuX2hhbmRsZSk7CisK
KyAgdHJhbnNwb3J0LT5yZXZlcnRfdG9fc2VsZiAoKTsKKworICBpZiAoIXJj
KQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIG9wZW5pbmcgdGhyZWFk
IHRva2VuICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgaGVh
ZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAgICBnb3RvIG91dDsKKyAg
ICB9CisKKyAgaWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChmcm9tX3Byb2Nl
c3NfaGFuZGxlLCB0b19wcm9jZXNzX2hhbmRsZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB0b2tlbl9oYW5kbGUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgR0VORVJJQ19SRUFELAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHJlcS5mcm9tX21hc3RlciwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmcmVxLmZyb21fbWFzdGVyKSAhPSAwKQorICAgIHsKKyAg
ICAgIHByaW50ZiAoImVycm9yIGR1cGxpY2F0aW5nIGZyb21fbWFzdGVyIGhh
bmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRl
ci5lcnJvcl9jb2RlID0gRUFDQ0VTOworICAgICAgZ290byBvdXQ7CisgICAg
fQorCisgIGlmIChyZXEudG9fbWFzdGVyKQorICAgIHsKKyAgICAgIGlmIChj
aGVja19hbmRfZHVwX2hhbmRsZSAoZnJvbV9wcm9jZXNzX2hhbmRsZSwgdG9f
cHJvY2Vzc19oYW5kbGUsCisJCQkJdG9rZW5faGFuZGxlLAorCQkJCUdFTkVS
SUNfV1JJVEUsCisJCQkJcmVxLnRvX21hc3RlciwKKwkJCQkmcmVxLnRvX21h
c3RlcikgIT0gMCkKKwl7CisJICBwcmludGYgKCJlcnJvciBkdXBsaWNhdGlu
ZyB0b19tYXN0ZXIgaGFuZGxlICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkp
OworCSAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisJICBnb3RvIG91
dDsKKwl9CisgICAgfQorCisjaWZkZWYgREVCVUcKKyAgcHJpbnRmICgiJWQg
LT4gJWQoJWQsJWQpXG4iLCByZXEubWFzdGVyX3BpZCwgcmVxLnBpZCwKKyAg
CSAgCQkJcmVxLmZyb21fbWFzdGVyLCByZXEudG9fbWFzdGVyKTsKKyNlbmRp
ZgorCisgIGhlYWRlci5lcnJvcl9jb2RlID0gMDsKKworb3V0OgorICBpZiAo
ZnJvbV9wcm9jZXNzX2hhbmRsZSkKKyAgICBDbG9zZUhhbmRsZSAoZnJvbV9w
cm9jZXNzX2hhbmRsZSk7CisgIGlmICh0b19wcm9jZXNzX2hhbmRsZSkKKyAg
ICBDbG9zZUhhbmRsZSAodG9fcHJvY2Vzc19oYW5kbGUpOworICBpZiAodG9r
ZW5faGFuZGxlKQorICAgIENsb3NlSGFuZGxlICh0b2tlbl9oYW5kbGUpOwor
fQorCit2b2lkCitjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lvbjo6c2VydmUo
dHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4pCit7CisgIGlmIChoZWFkZXIu
Y2IgIT0gc2l6ZW9mICh2ZXJzaW9uKSkKKyAgICB7CisgICAgICBoZWFkZXIu
ZXJyb3JfY29kZSA9IEVJTlZBTDsKKyAgICAgIHJldHVybjsKKyAgICB9Cisg
IGhlYWRlci5lcnJvcl9jb2RlID0gMDsKKyAgdmVyc2lvbi5tYWpvciA9IENZ
R1dJTl9TRVJWRVJfVkVSU0lPTl9NQUpPUjsKKyAgdmVyc2lvbi5hcGkgICA9
IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9BUEk7CisgIHZlcnNpb24ubWlub3Ig
PSBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlOT1I7CisgIHZlcnNpb24ucGF0
Y2ggPSBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fUEFUQ0g7Cit9CisKK2NsYXNz
IHNlcnZlcl9yZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgY2xhc3Mgc2VydmVy
X3JlcXVlc3QgKm5leHQ7CisgIHNlcnZlcl9yZXF1ZXN0ICh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqbmV3Y29ubik7CisgIHZvaWQgcHJvY2VzcyAoKTsKKyAg
cHJpdmF0ZToKKyAgICBjaGFyIHJlcXVlc3RfYnVmZmVyIFtNQVhfUkVRVUVT
VF9TSVpFXTsKKyAgICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubjsKK307
CisKK2NsYXNzIHNlcnZlcl9yZXF1ZXN0X3F1ZXVlCit7CisgIHB1YmxpYzoK
KyAgQ1JJVElDQUxfU0VDVElPTiBxdWV1ZWxvY2s7CisgIEhBTkRMRSBldmVu
dDsKKyAgc2VydmVyX3JlcXVlc3QgKiByZXF1ZXN0OworICBib29sIGFjdGl2
ZTsKKyAgdW5zaWduZWQgaW50IGluaXRpYWxfd29ya2VyczsKKyAgdW5zaWdu
ZWQgaW50IHJ1bm5pbmc7CisgIHZvaWQgY3JlYXRlX3dvcmtlcnMgKCk7Cisg
IHZvaWQgY2xlYW51cCAoKTsKKyAgdm9pZCBhZGQgKHRyYW5zcG9ydF9sYXll
cl9iYXNlICpjb25uKTsKK307CitjbGFzcyBzZXJ2ZXJfcmVxdWVzdF9xdWV1
ZSByZXF1ZXN0X3F1ZXVlOworCit2b2lkCitjbGllbnRfcmVxdWVzdF9zaHV0
ZG93bjo6c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKQorewor
ICAvKiBGSVhNRTogbGluayB1cHdhcmRzLCBhbmQgdGhlbiB0aGlzIGJlY29t
ZXMgYSB0cml2aWFsIG1ldGhvZCBjYWxsIHRvCisgICAqIG9ubHkgc2h1dGRv
d24gX3RoaXMgcXVldWVfCisgICAqLworICAvKiB0ZWxsIHRoZSBtYWluIHRo
cmVhZCB0byBzaHV0ZG93biAqLworICByZXF1ZXN0X3F1ZXVlLmFjdGl2ZT1m
YWxzZTsKK30KKworc2VydmVyX3JlcXVlc3Q6OnNlcnZlcl9yZXF1ZXN0ICh0
cmFuc3BvcnRfbGF5ZXJfYmFzZSAqbmV3Y29ubikKK3sKKyAgY29ubiA9IG5l
d2Nvbm47CisgIG5leHQgPSBOVUxMOworfQorCit2b2lkCitzZXJ2ZXJfcmVx
dWVzdDo6cHJvY2VzcyAoKQoreworICBzc2l6ZV90IGJ5dGVzX3JlYWQsIGJ5
dGVzX3dyaXR0ZW47CisgIHN0cnVjdCByZXF1ZXN0X2hlYWRlciogcmVxX3B0
ciA9IChzdHJ1Y3QgcmVxdWVzdF9oZWFkZXIqKSAmcmVxdWVzdF9idWZmZXI7
CisgIGNsaWVudF9yZXF1ZXN0ICpyZXEgPSBOVUxMOworICBwcmludGYgKCJh
Ym91dCB0byByZWFkXG4iKTsKKworICBieXRlc19yZWFkID0gY29ubi0+cmVh
ZCAocmVxdWVzdF9idWZmZXIsIHNpemVvZiAoc3RydWN0IHJlcXVlc3RfaGVh
ZGVyKSk7CisgIGlmIChieXRlc19yZWFkICE9IHNpemVvZiAoc3RydWN0IHJl
cXVlc3RfaGVhZGVyKSkKKyAgICB7CisgICAgICBwcmludGYgKCJlcnJvciBy
ZWFkaW5nIGZyb20gY29ubmVjdGlvbiAoJWx1KVxuIiwgR2V0TGFzdEVycm9y
ICgpKTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKyAgcHJpbnRmICgiZ290
IGhlYWRlciAoJWxkKVxuIiwgYnl0ZXNfcmVhZCk7CisKKyAgc3dpdGNoIChy
ZXFfcHRyLT5yZXFfaWQpCisgICAgeworICAgIGNhc2UgQ1lHU0VSVkVSX1JF
UVVFU1RfR0VUX1ZFUlNJT046CisgICAgICByZXEgPSBuZXcgY2xpZW50X3Jl
cXVlc3RfZ2V0X3ZlcnNpb24gKCk7IGJyZWFrOworICAgIGNhc2UgQ1lHU0VS
VkVSX1JFUVVFU1RfQVRUQUNIX1RUWToKKyAgICAgIHJlcSA9IG5ldyBjbGll
bnRfcmVxdWVzdF9hdHRhY2hfdHR5ICgpOyBicmVhazsKKyAgICBjYXNlIENZ
R1NFUlZFUl9SRVFVRVNUX1NIVVRET1dOOgorICAgICAgcmVxID0gbmV3IGNs
aWVudF9yZXF1ZXN0X3NodXRkb3duICgpOyBicmVhazsKKyAgICBjYXNlIENZ
R1NFUlZFUl9SRVFVRVNUX1NITV9HRVQ6CisgICAgIHJlcSA9IG5ldyBjbGll
bnRfcmVxdWVzdF9zaG1fZ2V0ICgpOyBicmVhazsKKyAgICBkZWZhdWx0Ogor
ICAgICAgcmVxID0gbmV3IGNsaWVudF9yZXF1ZXN0IChDWUdTRVJWRVJfUkVR
VUVTVF9JTlZBTElEKTsKKyAgICAgIHJlcS0+aGVhZGVyLmVycm9yX2NvZGUg
PSBFTk9TWVM7CisgICAgICBwcmludGYgKCJCYWQgY2xpZW50IHJlcXVlc3Qg
LSByZXR1cm5pbmcgRU5PU1lTXG4iKTsKKyAgICB9CisKKyAgaWYgKHJlcS0+
aGVhZGVyLmNiICE9IHJlcV9wdHItPmNiKQorICAgIHsKKyAgICAgIHByaW50
ZiAoIk1pc21hdGNoIGluIHJlcXVlc3QgYnVmZmVyIHNpemVzXG4iKTsKKyAg
ICAgIGdvdG8gb3V0OworICAgIH0KKworICBpZiAocmVxLT5oZWFkZXIuY2Ip
CisgICAgeworCisgICAgICBieXRlc19yZWFkID0gY29ubi0+cmVhZCAocmVx
LT5idWZmZXIsIHJlcS0+aGVhZGVyLmNiKTsKKyAgICAgIGlmIChieXRlc19y
ZWFkICE9IHJlcS0+aGVhZGVyLmNiKQorICAgICAgICB7CisgICAgICAgICAg
cHJpbnRmICgiZXJyb3IgcmVhZGluZyBmcm9tIGNvbm5lY3Rpb24gKCVsdSlc
biIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICAgICAgZ290byBvdXQ7Cisg
ICAgICAgIH0KKyAgICAgIHByaW50ZiAoImdvdCBib2R5ICglbGQpXG4iLGJ5
dGVzX3JlYWQpOworICAgIH0KKworICAvKiB0aGlzIGlzIG5vdCBhbGxvd2Vk
IHRvIGZhaWwuIFdlIG11c3QgcmV0dXJuIEVOT1NZUyBhdCBhIG1pbmltdW0g
dG8gdGhlIGNsaWVudCAqLworICByZXEtPnNlcnZlIChjb25uKTsKKworICBp
ZiAoKGJ5dGVzX3dyaXR0ZW4gPSBjb25uLT53cml0ZSAoKGNoYXIgKikmcmVx
LT5oZWFkZXIsIHNpemVvZiAocmVxLT5oZWFkZXIpKSkKKyAgICAhPSBzaXpl
b2YocmVxLT5oZWFkZXIpIHx8CisgICAgKGJ5dGVzX3dyaXR0ZW4gPSBjb25u
LT53cml0ZSAocmVxLT5idWZmZXIsIHJlcS0+aGVhZGVyLmNiKSkgIT0gcmVx
LT5oZWFkZXIuY2IpCisgICAgeworICAgICAgcmVxLT5oZWFkZXIuZXJyb3Jf
Y29kZSA9IC0xOworICAgICAgcHJpbnRmICgiZXJyb3Igd3JpdGluZyB0byBj
b25uZWN0aW9uICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAg
Z290byBvdXQ7CisgICAgfQorCisgIHByaW50ZigiU2VudCByZXBseSwgc2l6
ZSAoJWxkKVxuIixieXRlc193cml0dGVuKTsKKworb3V0OgorICBjb25uLT5j
bG9zZSAoKTsKKyAgZGVsZXRlIGNvbm47CisgIGlmIChyZXEpCisgICAgZGVs
ZXRlIChyZXEpOworfQorCitEV09SRCBXSU5BUEkKK3dvcmtlcl9mdW5jdGlv
biggTFBWT0lEIExwUGFyYW0gKQoreworICBjbGFzcyBzZXJ2ZXJfcmVxdWVz
dF9xdWV1ZSAqcXVldWUgPSAoY2xhc3Mgc2VydmVyX3JlcXVlc3RfcXVldWUg
KikgTHBQYXJhbTsKKyAgY2xhc3Mgc2VydmVyX3JlcXVlc3QgKnJlcXVlc3Q7
CisgIC8qIEZJWE1FIHVzZSBhIHRocmVhZHNhZmUgcG9wIGluc3RlYWQgZm9y
IHNwZWVkPyAqLworICB3aGlsZSAocXVldWUtPmFjdGl2ZSkKKyAgICB7Cisg
ICAgICBFbnRlckNyaXRpY2FsU2VjdGlvbiAoJnF1ZXVlLT5xdWV1ZWxvY2sp
OworICAgICAgd2hpbGUgKCFxdWV1ZS0+cmVxdWVzdCAmJiBxdWV1ZS0+YWN0
aXZlKQorICAgICAgICB7CisJICBMZWF2ZUNyaXRpY2FsU2VjdGlvbiAoJnF1
ZXVlLT5xdWV1ZWxvY2spOworICAgICAgICAgIERXT1JEIHJjID0gV2FpdEZv
clNpbmdsZU9iamVjdCAocXVldWUtPmV2ZW50LElORklOSVRFKTsKKyAgICAg
ICAgICBpZiAocmMgPT0gV0FJVF9GQUlMRUQpCisJICAgIHsKKwkgICAgICBw
cmludGYoIldhaXQgZm9yIGV2ZW50IGZhaWxlZFxuIik7CisJICAgICAgcXVl
dWUtPnJ1bm5pbmctLTsKKwkgICAgICBFeGl0VGhyZWFkICgwKTsKKwkgICAg
fQorCSAgRW50ZXJDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZS0+cXVldWVsb2Nr
KTsKKyAgICAgICAgfQorICAgICAgaWYgKCFxdWV1ZS0+YWN0aXZlKQorCXsK
KwkgIHF1ZXVlLT5ydW5uaW5nLS07CisJICBMZWF2ZUNyaXRpY2FsU2VjdGlv
biAoJnF1ZXVlLT5xdWV1ZWxvY2spOworCSAgRXhpdFRocmVhZCAoMCk7CisJ
fQorICAgICAgLyogbm90IG5lZWRlZCwgYnV0IGl0IGlzIGVmZmljaWVudCAq
LworICAgICAgcmVxdWVzdCA9IChjbGFzcyBzZXJ2ZXJfcmVxdWVzdCAqKUlu
dGVybG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmcXVldWUtPnJlcXVlc3QsIHF1
ZXVlLT5yZXF1ZXN0LT5uZXh0KTsKKyAgICAgIExlYXZlQ3JpdGljYWxTZWN0
aW9uICgmcXVldWUtPnF1ZXVlbG9jayk7CisgICAgICByZXF1ZXN0LT5wcm9j
ZXNzICgpOworICAgICAgZGVsZXRlIHJlcXVlc3Q7CisgICAgfQorICBxdWV1
ZS0+cnVubmluZy0tOworICBFeGl0VGhyZWFkICgwKTsKK30KKwordm9pZAor
c2VydmVyX3JlcXVlc3RfcXVldWU6OmNyZWF0ZV93b3JrZXJzKCkKK3sKKyAg
SW5pdGlhbGl6ZUNyaXRpY2FsU2VjdGlvbiAoJnF1ZXVlbG9jayk7CisgIGlm
ICgoZXZlbnQgPSBDcmVhdGVFdmVudCAoTlVMTCwgRkFMU0UsIEZBTFNFLCBO
VUxMKSkgPT0gTlVMTCkKKyAgICB7CisgICAgICBwcmludGYgKCJGYWlsZWQg
dG8gY3JlYXRlIGV2ZW50IHF1ZXVlICglbHUpLCB0ZXJtaW5hdGluZ1xuIiwg
R2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGV4aXQgKDEpOworICAgIH0KKyAg
YWN0aXZlID0gdHJ1ZTsKKyAgCisgIC8qIEZJWE1FOiBVc2UgYSBzdGFjayBw
YWlyIGFuZCBjcmVhdGUgdGhyZWFkcyBvbiB0aGUgZmx5IHdoZW5ldmVyCisg
ICAqIHdlIGhhdmUgdG8gdG8gc2VydmljZSBhIHJlcXVlc3QuCisgICAqLwor
ICBmb3IgKHVuc2lnbmVkIGludCBpPTA7IGk8aW5pdGlhbF93b3JrZXJzOyBp
KyspCisgICAgeworICAgICAgSEFORExFIGhUaHJlYWQ7CisgICAgICBEV09S
RCB0aWQ7CisgICAgICBoVGhyZWFkID0gQ3JlYXRlVGhyZWFkIChOVUxMLCAw
LCB3b3JrZXJfZnVuY3Rpb24sIHRoaXMsIDAsICZ0aWQpOworICAgICAgaWYg
KGhUaHJlYWQgPT0gTlVMTCkKKyAgICAgICAgeworCSAgcHJpbnRmICgiRmFp
bGVkIHRvIGNyZWF0ZSB0aHJlYWQgKCVsdSksIHRlcm1pbmF0aW5nXG4iLCBH
ZXRMYXN0RXJyb3IgKCkpOworCSAgZXhpdCAoMSk7CisJfQorICAgICAgQ2xv
c2VIYW5kbGUgKGhUaHJlYWQpOworICAgICAgcnVubmluZysrOworICAgIH0K
K30KKwordm9pZAorc2VydmVyX3JlcXVlc3RfcXVldWU6OmNsZWFudXAgKCkK
K3sKKyAgLyogaGFydmVzdCB0aGUgdGhyZWFkcyAqLworICBhY3RpdmUgPSBm
YWxzZTsKKyAgaWYgKCFydW5uaW5nKQorICAgIHJldHVybjsKKyAgcHJpbnRm
ICgiV2FpdGluZyBmb3IgY3VycmVudCBjb25uZWN0aW9ucyB0byB0ZXJtaW5h
dGVcbiIpOworICBmb3IgKGludCBuPXJ1bm5pbmc7IG47IG4tLSkKKyAgICBQ
dWxzZUV2ZW50IChldmVudCk7CisgIHdoaWxlIChydW5uaW5nKQorICAgIHNs
ZWVwICgxKTsKKyAgRGVsZXRlQ3JpdGljYWxTZWN0aW9uICgmcXVldWVsb2Nr
KTsKKyAgQ2xvc2VIYW5kbGUgKGV2ZW50KTsKK30KKwordm9pZAorc2VydmVy
X3JlcXVlc3RfcXVldWU6OmFkZCAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNv
bm4pCit7CisgIC8qIHNhZmUgdG8gbm90ICJUcnkiIGJlY2F1c2Ugd29ya2Vy
cyBkb24ndCBob2cgdGhpcywgdGhleSB3YWl0IG9uIHRoZSBldmVudAorICAg
Ki8KKyAgRW50ZXJDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZWxvY2spOworICBp
ZiAoIXJ1bm5pbmcpCisgICAgeworICAgICAgcHJpbnRmICgiTm8gd29ya2Vy
IHRocmVhZHMgdG8gaGFuZGxlIHJlcXVlc3QhXG4iKTsKKyAgICAgIGNvbm4t
PmNsb3NlICgpOworICAgICAgZGVsZXRlIGNvbm47CisgICAgfQorICBzZXJ2
ZXJfcmVxdWVzdCAqIGxpc3RyZXF1ZXN0OworICBpZiAoIXJlcXVlc3QpCisg
ICAgeworICAgICAgcmVxdWVzdCA9IG5ldyBzZXJ2ZXJfcmVxdWVzdCAoY29u
bik7CisgICAgICBsaXN0cmVxdWVzdCA9IHJlcXVlc3Q7CisgICAgfQorICBl
bHNlCisgICAgeworICAgICAgLyogYWRkIHRvIHRoZSBxdWV1ZSBlbmQuICov
CisgICAgICBsaXN0cmVxdWVzdCA9IHJlcXVlc3Q7CisgICAgICB3aGlsZSAo
bGlzdHJlcXVlc3QtPm5leHQpCisJbGlzdHJlcXVlc3QgPSBsaXN0cmVxdWVz
dC0+bmV4dDsKKyAgICAgIGxpc3RyZXF1ZXN0LT5uZXh0ID0gbmV3IHNlcnZl
cl9yZXF1ZXN0IChjb25uKTsKKyAgICAgIGxpc3RyZXF1ZXN0ID0gbGlzdHJl
cXVlc3QtPm5leHQ7CisgICAgfQorICBQdWxzZUV2ZW50IChldmVudCk7Cisg
IExlYXZlQ3JpdGljYWxTZWN0aW9uICgmcXVldWVsb2NrKTsKK30KKworc3Ry
dWN0IG9wdGlvbiBsb25nb3B0c1tdID0geworICB7InNodXRkb3duIiwgbm9f
YXJndW1lbnQsIE5VTEwsICdzJ30sCisgIHswLCBub19hcmd1bWVudCwgTlVM
TCwgMH0KK307CisKK2NoYXIgb3B0c1tdID0gInMiOworCitpbnQKK21haW4g
KGludCBhcmdjLCBjaGFyICoqYXJndikKK3sKKyAgaW50IHNodXRkb3duPTA7
CisgIGNoYXIgaTsKKworICB3aGlsZSAoKGkgPSBnZXRvcHRfbG9uZyAoYXJn
YywgYXJndiwgb3B0cywgbG9uZ29wdHMsIE5VTEwpKSAhPSBFT0YpCisgICAg
c3dpdGNoIChpKQorICAgICAgeworICAgICAgY2FzZSAncyc6CisgICAgICAg
IHNodXRkb3duID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgICBkZWZhdWx0
OgorICAgICAgICBicmVhazsKKyAgICAgICAvKk5PVFJFQUNIRUQqLworICAg
ICAgfQorCisgIHdpbmNhcC5pbml0KCk7CisgIGlmICh3aW5jYXAuaGFzX3Nl
Y3VyaXR5ICgpKQorICAgIHNldHVwX3ByaXZpbGVnZXMgKCk7CisgIHRyYW5z
cG9ydCA9IGNyZWF0ZV9zZXJ2ZXJfdHJhbnNwb3J0ICgpOworCisgIGlmIChz
aHV0ZG93bikKKyAgICB7CisgICAgICBpZiAoIXRyYW5zcG9ydC0+Y29ubmVj
dCgpKQorCXsKKwkgIHByaW50ZiAoImNvdWxkbid0IGVzdGFibGlzaCBjb25u
ZWN0aW9uIHdpdGggc2VydmVyXG4iKTsKKwkgIGV4aXQgKDEpOworCX0KKyAg
ICAgIGNsaWVudF9yZXF1ZXN0X3NodXRkb3duICpyZXF1ZXN0ID0KKwluZXcg
Y2xpZW50X3JlcXVlc3Rfc2h1dGRvd24gKCk7CisgICAgICByZXF1ZXN0LT5z
ZW5kICh0cmFuc3BvcnQpOworICAgICAgdHJhbnNwb3J0LT5jbG9zZSgpOwor
ICAgICAgZGVsZXRlIHRyYW5zcG9ydDsKKyAgICAgIGRlbGV0ZSByZXF1ZXN0
OworICAgICAgZXhpdCgwKTsKKyAgICB9CisKKyAgdHJhbnNwb3J0LT5saXN0
ZW4gKCk7CisgIHJlcXVlc3RfcXVldWUuaW5pdGlhbF93b3JrZXJzID0gMTA7
CisgIHJlcXVlc3RfcXVldWUuY3JlYXRlX3dvcmtlcnMoKTsKKyAgd2hpbGUg
KHJlcXVlc3RfcXVldWUuYWN0aXZlKQorICAgIHsKKyAgICAgIHRyYW5zcG9y
dF9sYXllcl9iYXNlICogbmV3X2Nvbm4gPSB0cmFuc3BvcnQtPmFjY2VwdCAo
KTsKKyAgICAgIC8qIEZJWE1FOiB0aGlzIGlzIGEgbGl0dGxlIHVnbHkuIFdo
YXQgd2UgcmVhbGx5IHdhbnQgaXMgdG8gd2FpdCBvbiB0d28gb2JqZWN0czoK
KyAgICAgICAqIG9uZSBmb3IgdGhlIHBpcGUvc29ja2V0LCBhbmQgb25lIGZv
ciBiZWluZyB0b2xkIHRvIHNodXRkb3duLiBPdGhlcndpc2UKKyAgICAgICAq
IHRoaXMgd2lsbCBzdGF5IGEgcHJvYmxlbSAod2Ugd29uJ3QgYWN0dWFsbHkg
c2h1dGRvd24gdW50aWwgdGhlIHJlcXVlc3QKKyAgICAgICAqIF9BRlRFUl8g
dGhlIHNodXRkb3duIHJlcXVlc3QuIEFuZCBzZW5kaW5nIG91cnNlbHZlcyBh
IHJlcXVlc3QgaXMgdWdseSAKKyAgICAgICAqLworICAgICAgaWYgKG5ld19j
b25uICYmIHJlcXVlc3RfcXVldWUuYWN0aXZlKQorICAgICAgICAgIHJlcXVl
c3RfcXVldWUuYWRkIChuZXdfY29ubik7CisgICAgfQorICBwcmludGYgKCJO
byBsb25nZXIgYWNjZXB0aW5nIHJlcXVlc3RzLlxuIik7CisgIHJlcXVlc3Rf
cXVldWUuY2xlYW51cCAoKTsKKyAgdHJhbnNwb3J0LT5jbG9zZSAoKTsKK30K
SW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl9jbGllbnQuY2MK
ZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVy
X2NsaWVudC5jYzoxLjEuMi4xCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEg
MDE6MDA6MDAgMTk3MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVy
X2NsaWVudC5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTAsMCAr
MSwyMjUgQEAKKy8qIGN5Z3NlcnZlcl9jbGllbnQuY2MKKworICAgQ29weXJp
Z2h0IDIwMDEgUmVkIEhhdCBJbmMuCisKKyAgIFdyaXR0ZW4gYnkgRWdvciBE
dWRhIDxkZW9AbG9nb3MtbS5ydT4KKworICAgVGhpcyBmaWxlIGlzIHBhcnQg
b2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0
ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisgICBD
eWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdX
SU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisjaWZkZWYgX19P
VVRTSURFX0NZR1dJTl9fCisjdW5kZWYgX19JTlNJREVfQ1lHV0lOX18KKyNl
bHNlCisjaW5jbHVkZSAid2luc3VwLmgiCisjZW5kaWYKKworI2lmbmRlZiBf
X0lOU0lERV9DWUdXSU5fXworI2RlZmluZSBkZWJ1Z19wcmludGYgcHJpbnRm
CisjZGVmaW5lIGFwaV9mYXRhbCBwcmludGYKKyNpbmNsdWRlIDxzdGRpby5o
PgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNlbmRpZgorI2luY2x1ZGUgPHN5
cy9zb2NrZXQuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHVu
aXN0ZC5oPgorLy8jaW5jbHVkZSAic2VjdXJpdHkuaCIKKyNpbmNsdWRlICJj
eWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dp
bi9jeWdzZXJ2ZXIuaCIKKworLyogMCA9IHVudGVzdGVkLCAxID0gcnVubmlu
ZywgMiA9IGRlYWQgKi8KK2ludCBjeWdzZXJ2ZXJfcnVubmluZz1DWUdTRVJW
RVJfVU5LTk9XTjsKKworY2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb246OmNs
aWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uICgpIDogY2xpZW50X3JlcXVlc3Qg
KENZR1NFUlZFUl9SRVFVRVNUX0dFVF9WRVJTSU9OKQoreworICBoZWFkZXIu
Y2IgPSBzaXplb2YgKHZlcnNpb24pOworICBidWZmZXIgPSAoY2hhciAqKSZ2
ZXJzaW9uOworfQorCisjaWZkZWYgX19JTlNJREVfQ1lHV0lOX18KK3ZvaWQK
K2NsaWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uOjpzZXJ2ZSAodHJhbnNwb3J0
X2xheWVyX2Jhc2UgKmNvbm4pCit7Cit9CisjZW5kaWYKKworY2xpZW50X3Jl
cXVlc3RfYXR0YWNoX3R0eTo6Y2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eSAo
KSA6IGNsaWVudF9yZXF1ZXN0IChDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hf
VFRZKQoreworICBoZWFkZXIuY2IgPSBzaXplb2YgKHJlcSk7CisgIGJ1ZmZl
ciA9IChjaGFyICopJnJlcTsKKyAgcmVxLnBpZCA9IDA7CisgIHJlcS5tYXN0
ZXJfcGlkID0gMDsKKyAgcmVxLmZyb21fbWFzdGVyID0gTlVMTDsKKyAgcmVx
LnRvX21hc3RlciA9IE5VTEw7Cit9CisKK2NsaWVudF9yZXF1ZXN0X2F0dGFj
aF90dHk6OmNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkgKERXT1JEIG5waWQs
IERXT1JEIG5tYXN0ZXJfcGlkLCBIQU5ETEUgbmZyb21fbWFzdGVyLCBIQU5E
TEUgbnRvX21hc3RlcikgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JF
UVVFU1RfQVRUQUNIX1RUWSkKK3sKKyAgaGVhZGVyLmNiID0gc2l6ZW9mIChy
ZXEpOworICBidWZmZXIgPSAoY2hhciAqKSZyZXE7CisgIHJlcS5waWQgPSBu
cGlkOworICByZXEubWFzdGVyX3BpZCA9IG5tYXN0ZXJfcGlkOworICByZXEu
ZnJvbV9tYXN0ZXIgPSBuZnJvbV9tYXN0ZXI7CisgIHJlcS50b19tYXN0ZXIg
PSBudG9fbWFzdGVyOworfQorCisjaWZkZWYgX19JTlNJREVfQ1lHV0lOX18K
K3ZvaWQKK2NsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHk6OnNlcnZlICh0cmFu
c3BvcnRfbGF5ZXJfYmFzZSAqY29ubikKK3sKK30KKyNlbmRpZgorCitjbGll
bnRfcmVxdWVzdF9zaHV0ZG93bjo6Y2xpZW50X3JlcXVlc3Rfc2h1dGRvd24g
KCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JFUVVFU1RfU0hVVERP
V04pCit7CisgIGhlYWRlci5jYiA9IDA7CisgIGJ1ZmZlciA9IE5VTEw7Cit9
CisKKyNpZmRlZiBfX0lOU0lERV9DWUdXSU5fXwordm9pZAorY2xpZW50X3Jl
cXVlc3Rfc2h1dGRvd246OnNlcnZlICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAq
Y29ubikKK3sKK30KKyNlbmRpZgorCitjbGllbnRfcmVxdWVzdDo6Y2xpZW50
X3JlcXVlc3QgKGN5Z3NlcnZlcl9yZXF1ZXN0X2NvZGUgaWQpCit7CisgIGhl
YWRlci5yZXFfaWQgPSBpZDsKKyAgaGVhZGVyLmVycm9yX2NvZGUgPSAwOwor
fQorCitjbGllbnRfcmVxdWVzdDo6fmNsaWVudF9yZXF1ZXN0ICgpCit7Cit9
CisKK2NsaWVudF9yZXF1ZXN0OjpvcGVyYXRvciBjbGFzcyByZXF1ZXN0X2hl
YWRlciAoKQoreworICByZXR1cm4gaGVhZGVyOworfQorCit2b2lkCitjbGll
bnRfcmVxdWVzdDo6c2VuZCAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4p
Cit7CisgIGlmICghY29ubikKKyAgICByZXR1cm47CisgIGRlYnVnX3ByaW50
ZigidGhpcz0lcCwgY29ubj0lcFxuIix0aGlzLCBjb25uKTsKKyAgc3NpemVf
dCBieXRlc193cml0dGVuLCBieXRlc19yZWFkOworICBkZWJ1Z19wcmludGYo
ImhlYWRlci5jYiA9ICVsZFxuIixoZWFkZXIuY2IpOworICBpZiAoKGJ5dGVz
X3dyaXR0ZW4gPSBjb25uLT53cml0ZSAoKGNoYXIgKikmaGVhZGVyLCBzaXpl
b2YgKGhlYWRlcikpKQorICAgICE9IHNpemVvZihoZWFkZXIpIHx8IChoZWFk
ZXIuY2IgJiYKKyAgICAoYnl0ZXNfd3JpdHRlbiA9IGNvbm4tPndyaXRlIChi
dWZmZXIsIGhlYWRlci5jYikpICE9IGhlYWRlci5jYikpCisgICAgeworICAg
ICAgaGVhZGVyLmVycm9yX2NvZGUgPSAtMTsKKyAgICAgIGRlYnVnX3ByaW50
ZiAoImJ5dGVzIHdyaXR0ZW4gIT0gcmVxdWVzdCBzaXplXG4iKTsKKyAgICAg
IHJldHVybjsKKyAgICB9CisKKyAgZGVidWdfcHJpbnRmKCJTZW50IHJlcXVl
c3QsIHNpemUgKCVsZClcbiIsYnl0ZXNfd3JpdHRlbik7CisKKyAgaWYgKChi
eXRlc19yZWFkID0gY29ubi0+cmVhZCAoKGNoYXIgKikmaGVhZGVyLCBzaXpl
b2YgKGhlYWRlcikpKQorICAgICE9IHNpemVvZiAoaGVhZGVyKSB8fCAoaGVh
ZGVyLmNiICYmCisgICAgKGJ5dGVzX3JlYWQgPSBjb25uLT5yZWFkIChidWZm
ZXIsIGhlYWRlci5jYikgKSAhPSBoZWFkZXIuY2IpKQorICAgIHsKKyAgICAg
IGhlYWRlci5lcnJvcl9jb2RlID0gLTE7CisgICAgICBkZWJ1Z19wcmludGYo
ImZhaWxlZCByZWFkaW5nIHJlc3BvbnNlIFxuIik7CisgICAgICByZXR1cm47
CisgICAgfQorICBkZWJ1Z19wcmludGYgKCJjb21wbGV0ZWQgb2tcbiIpOwor
fQorCisvKiBPaCwgQlRXOiBGaXggdGhlIHByb2NlZHVyYWwgYmFzaXMgYW5k
IG1ha2UgdGhpcyBtb3JlIGludHVpdGl2ZS4gKi8KKworaW50CitjeWdzZXJ2
ZXJfcmVxdWVzdCAoY2xpZW50X3JlcXVlc3QgKiByZXEpCit7CisgIGNsYXNz
IHRyYW5zcG9ydF9sYXllcl9iYXNlICp0cmFuc3BvcnQ7CisKKyAgaWYgKCFy
ZXEpCisgICAgcmV0dXJuIC0xOworCisgIC8qIGRvbnQnIHJldHJ5IGV2ZXJ5
IHJlcXVlc3QgaWYgdGhlIHNlcnZlcidzIG5vdCB0aGVyZSAqLworICBpZiAo
Y3lnc2VydmVyX3J1bm5pbmc9PUNZR1NFUlZFUl9ERUFEICYmIHJlcS0+aGVh
ZGVyLnJlcV9pZCAhPSBDWUdTRVJWRVJfUkVRVUVTVF9HRVRfVkVSU0lPTikK
KyAgICByZXR1cm4gLTE7CisKKyAgdHJhbnNwb3J0ID0gY3JlYXRlX3NlcnZl
cl90cmFuc3BvcnQgKCk7CisKKyAgLyogRklYTUU6IGhhdmUgYXQgbW9zdCBv
bmUgY29ubmVjdGlvbiBwZXIgdGhyZWFkLiB1c2UgVExTIHRvIHN0b3JlIHRo
ZSBkZXRhaWxzICovCisgIC8qIGxvZ2ljIGlzOgorICAgKiBpZiBub3QgdGxz
a2V5LT5jb25uLCBuZXcgY29ubiwKKyAgICogdGhlbjsgdHJhbnNwb3J0PWNv
bm47CisgICAqLworICBpZiAoIXRyYW5zcG9ydC0+Y29ubmVjdCAoKSkKKyAg
ICB7CisgICAgICBkZWxldGUgdHJhbnNwb3J0OworICAgICAgcmV0dXJuIC0x
OworICAgIH0KKworICBkZWJ1Z19wcmludGYgKCJjb25uZWN0ZWQgdG8gc2Vy
dmVyICVwXG4iLCB0cmFuc3BvcnQpOworCisgIHJlcS0+c2VuZCh0cmFuc3Bv
cnQpOworCisgIHRyYW5zcG9ydC0+Y2xvc2UgKCk7CisKKyAgZGVsZXRlIHRy
YW5zcG9ydDsKKworICByZXR1cm4gMDsKK30KKworI2lmIDAKK0JPT0wKK2No
ZWNrX2N5Z3NlcnZlcl9hdmFpbGFibGUgKCkKK3sKKyAgQk9PTCByZXRfdmFs
ID0gRkFMU0U7CisgIEhBTkRMRSBwaXBlID0gQ3JlYXRlRmlsZSAocGlwZV9u
YW1lLAorCQkJICAgIEdFTkVSSUNfUkVBRCB8IEdFTkVSSUNfV1JJVEUsCisJ
CQkgICAgRklMRV9TSEFSRV9SRUFEIHwgRklMRV9TSEFSRV9XUklURSwKKwkJ
CSAgICAmc2VjX2FsbF9uaWgsCisJCQkgICAgT1BFTl9FWElTVElORywKKwkJ
CSAgICAwLAorCQkJICAgIE5VTEwpOworICBpZiAocGlwZSAhPSBJTlZBTElE
X0hBTkRMRV9WQUxVRSB8fCBHZXRMYXN0RXJyb3IgKCkgIT0gRVJST1JfUElQ
RV9CVVNZKQorICAgIHJldF92YWwgPSBUUlVFOworCisgIGlmIChwaXBlICYm
IHBpcGUgIT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgQ2xvc2VIYW5k
bGUgKHBpcGUpOworCisgIHJldHVybiAocmV0X3ZhbCk7Cit9CisjZW5kaWYK
Kwordm9pZAorY3lnc2VydmVyX2luaXQgKCkKK3sKKyAgaW50IHJjOworCisg
IGlmIChjeWdzZXJ2ZXJfcnVubmluZz09Q1lHU0VSVkVSX09LKQorICAgIHJl
dHVybjsKKworICBjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lvbiAqcmVxID0g
CisJbmV3IGNsaWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uICgpOworCisgIHJj
ID0gY3lnc2VydmVyX3JlcXVlc3QgKHJlcSk7CisgIGRlbGV0ZSByZXE7Cisg
IGlmIChyYyA8IDApCisgICAgY3lnc2VydmVyX3J1bm5pbmcgPSBDWUdTRVJW
RVJfREVBRDsKKyAgZWxzZSBpZiAocmMgPiAwKQorICAgIGFwaV9mYXRhbCAo
ICJlcnJvciBjb25uZWN0aW5nIHRvIGN5Z3dpbiBzZXJ2ZXIuIGVycm9yOiAl
ZCIsIHJjICk7CisgIGVsc2UgaWYgKHJlcS0+dmVyc2lvbi5tYWpvciAhPSBD
WUdXSU5fU0VSVkVSX1ZFUlNJT05fTUFKT1IgfHwKKwkgICByZXEtPnZlcnNp
b24uYXBpICE9IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9BUEkgfHwKKwkgICBy
ZXEtPnZlcnNpb24ubWlub3IgPiBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlO
T1IpCisgICAgYXBpX2ZhdGFsICggImluY29tcGF0aWJsZSB2ZXJzaW9uIG9m
IGN5Z3dpbiBzZXJ2ZXIuXG5cCisgY2xpZW50IHZlcnNpb24gJWQuJWQuJWQu
JWQsIHNlcnZlciB2ZXJzaW9uJWxkLiVsZC4lbGQuJWxkIiwKKyAgICBDWUdX
SU5fU0VSVkVSX1ZFUlNJT05fTUFKT1IsCisgICAgQ1lHV0lOX1NFUlZFUl9W
RVJTSU9OX0FQSSwKKyAgICBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlOT1Is
CisgICAgQ1lHV0lOX1NFUlZFUl9WRVJTSU9OX1BBVENILAorICAgIHJlcS0+
dmVyc2lvbi5tYWpvciwKKyAgICByZXEtPnZlcnNpb24uYXBpLAorICAgIHJl
cS0+dmVyc2lvbi5taW5vciwKKyAgICByZXEtPnZlcnNpb24ucGF0Y2ggKTsK
KyAgZWxzZQorICAgIGN5Z3NlcnZlcl9ydW5uaW5nID0gQ1lHU0VSVkVSX09L
OworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3NobS5j
YwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2
ZXJfc2htLmNjOjEuMS4yLjIKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAw
MTowMDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJf
c2htLmNjCVR1ZSBTZXAgMjUgMDg6MTY6MjAgMjAwMQpAQCAtMCwwICsxLDUz
MCBAQAorLyogc2htLmNjOiBTaW5nbGUgdW5peCBzcGVjaWZpY2F0aW9uIElQ
QyBpbnRlcmZhY2UgZm9yIEN5Z3dpbgorCisgICBDb3B5cmlnaHQgMjAwMSBS
ZWQgSGF0LCBJbmMuCisKKyAgIE9yaWdpbmFsbHkgd3JpdHRlbiBieSBSb2Jl
cnQgQ29sbGlucyA8cm9iZXJ0LmNvbGxpbnNAaG90bWFpbC5jb20+CisKKyAg
IFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0
d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZQorICAgQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29u
c3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorICAgZGV0YWls
cy4gKi8KKworCisjaWZkZWYgX19PVVRTSURFX0NZR1dJTl9fCisjdW5kZWYg
X19JTlNJREVfQ1lHV0lOX18KKyNlbHNlCisjaW5jbHVkZSAid2luc3VwLmgi
CisjZW5kaWYKKworI2lmbmRlZiBfX0lOU0lERV9DWUdXSU5fXworI2RlZmlu
ZSBzeXN0ZW1fcHJpbnRmIHByaW50ZgorI2RlZmluZSBkZWJ1Z19wcmludGYg
cHJpbnRmCisjZGVmaW5lIGFwaV9mYXRhbCBwcmludGYKKyNpbmNsdWRlIDxz
dGRpby5oPgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNlbmRpZgorCisjaW5j
bHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1
ZGUgImN5Z2Vycm5vLmgiCisjaW5jbHVkZSA8dW5pc3RkLmg+CisjaW5jbHVk
ZSAic2VjdXJpdHkuaCIKKy8vI2luY2x1ZGUgImZoYW5kbGVyLmgiCisvLyNp
bmNsdWRlICJkdGFibGUuaCIKKy8vI2luY2x1ZGUgImN5Z2hlYXAuaCIKKyNp
bmNsdWRlIDxzdGRpby5oPgorLy8jaW5jbHVkZSAidGhyZWFkLmgiCisjaWZu
ZGVmIF9fSU5TSURFX0NZR1dJTl9fCisjZGVmaW5lIF9fSU5TSURFX0NZR1dJ
Tl9fCisjaW5jbHVkZSA8c3lzL3NobS5oPgorI3VuZGVmIF9fSU5TSURFX0NZ
R1dJTl9fCisjZWxzZQorI2luY2x1ZGUgPHN5cy9zaG0uaD4KKyNlbmRpZgor
Ly8jaW5jbHVkZSAicGVycHJvY2Vzcy5oIgorI2luY2x1ZGUgImN5Z3NlcnZl
cl9zaG0uaCIKKworLy8gRklYTUUgSVMgVEhJUyBDT1JSRUNUCisvKiBJbXBs
ZW1lbnRhdGlvbiBub3RlczogV2UgdXNlIHR3byBzaGFyZWQgbWVtb3J5IHJl
Z2lvbnMgcGVyIGtleToKKyAqIE9uZSBmb3IgdGhlIGNvbnRyb2wgc3RydWN0
dXJlLCBhbmQgb25lIGZvciB0aGUgc2hhcmVkIG1lbW9yeS4KKyAqIFdoaWxl
IHRoaXMgaGFzIGEgaGlnaGVyIG92ZXJoZWFkIHRoYW0gYSBzaW5nbGUgc2hh
cmVkIGFyZWEsCisgKiBJdCBhbGxvd3MgbW9yZSBmbGV4YWJpbGl0eS4gQXMg
dGhlIGVudGlyZSBjb2RlIGlzIHRyYW5zcGFyZW50IHRvIHRoZSB1c2VyCisg
KiBXZSBjYW4gbWVyZ2UgdGhlc2UgaW4gdGhlIGZ1dHVyZSBzaG91bGQgaXQg
YmUgbmVlZGVkLgorICogQWxzbywgSVBDX1BSSVZBVEUga2V5cyBjcmVhdGUg
dW5pcXVlIG1hcHBpbmdzIGVhY2ggdGltZS4gVGhlIHNobV9pZHMganVzdAor
ICoga2VlcCBtb25vdG9uaWNhbGx5IGluY3JlbWVudGluZyAtIHN5c3RlbSB3
aWRlLgorICovCitzaXplX3QgZ2V0c3lzdGVtYWxsb2NncmFudWxhcml0eSAo
KQoreworICBTWVNURU1fSU5GTyBzeXNpbmZvOworICBzdGF0aWMgc2l6ZV90
IGJ1ZmZlcl9vZmZzZXQgPSAwOworICBpZiAoYnVmZmVyX29mZnNldCkKKyAg
ICByZXR1cm4gYnVmZmVyX29mZnNldDsKKyAgR2V0U3lzdGVtSW5mbyAoJnN5
c2luZm8pOworICBidWZmZXJfb2Zmc2V0ID0gc3lzaW5mby5kd0FsbG9jYXRp
b25HcmFudWxhcml0eTsKKyAgcmV0dXJuIGJ1ZmZlcl9vZmZzZXQ7Cit9CisK
K2NsaWVudF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9n
ZXQgKCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JFUVVFU1RfU0hN
X0dFVCkKK3sKKyAgaGVhZGVyLmNiID0gc2l6ZW9mIChwYXJhbWV0ZXJzKTsK
KyAgYnVmZmVyID0gKGNoYXIgKikgJnBhcmFtZXRlcnM7CisgIGhlYWRlci5l
cnJvcl9jb2RlID0gMDsKK30KKworY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6
Y2xpZW50X3JlcXVlc3Rfc2htX2dldCAoaW50IG5zaG1faWQsIHBpZF90IG5w
aWQpIDogY2xpZW50X3JlcXVlc3QgKENZR1NFUlZFUl9SRVFVRVNUX1NITV9H
RVQpCit7CisgIGhlYWRlci5jYiA9IHNpemVvZiAocGFyYW1ldGVycyk7Cisg
IGJ1ZmZlciA9IChjaGFyICopICZwYXJhbWV0ZXJzOworICBoZWFkZXIuZXJy
b3JfY29kZSA9IDA7CisgIHBhcmFtZXRlcnMuaW4uc2htX2lkID0gbnNobV9p
ZDsKKyAgcGFyYW1ldGVycy5pbi50eXBlID0gU0hNX1JFQVRUQUNIOworICBw
YXJhbWV0ZXJzLmluLnBpZCA9IG5waWQ7Cit9CisKK2NsaWVudF9yZXF1ZXN0
X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9nZXQgKGtleV90IG5rZXks
IHNpemVfdCBuc2l6ZSwKKwkJCQkJCWludCBuc2htZmxnLCBjaGFyIHBzZGJ1
Zls0MDk2XSwgcGlkX3QgbnBpZCk6CWNsaWVudF9yZXF1ZXN0IChDWUdTRVJW
RVJfUkVRVUVTVF9TSE1fR0VUKQoreworICBoZWFkZXIuY2IgPSBzaXplb2Yg
KHBhcmFtZXRlcnMpOworICBidWZmZXIgPSAoY2hhciAqKSAmcGFyYW1ldGVy
czsKKyAgcGFyYW1ldGVycy5pbi5rZXkgPSBua2V5OworICBwYXJhbWV0ZXJz
LmluLnNpemUgPSBuc2l6ZTsKKyAgcGFyYW1ldGVycy5pbi5zaG1mbGcgPSBu
c2htZmxnOworICBwYXJhbWV0ZXJzLmluLnR5cGUgPSBTSE1fQ1JFQVRFOwor
ICBwYXJhbWV0ZXJzLmluLnBpZCA9IG5waWQ7CisgIG1lbWNweSAocGFyYW1l
dGVycy5pbi5zZF9idWYsIHBzZGJ1ZiwgNDA5Nik7Cit9CisKKy8qIEZJWE1F
OiBJZiBidWlsZGluZyBvbiBhIDY0LWJpdCBjb21waWxlciwgdGhlIGFkZHJl
c3MtPmludCB0eXBlY2FzdCB3aWxsIGZhaWwuCisgKiBTb2x1dGlvbjogbWFu
dWFsbHkgY2FsY3VsYXRlIHRoZSBuZXh0IGlkIHZhbHVlIAorICovCisKKyNp
ZiAwCitleHRlcm4gIkMiIHZvaWQgKgorc2htYXQgKGludCBzaG1pZCwgY29u
c3Qgdm9pZCAqc2htYWRkciwgaW50IHBhcmFtZXRlcnMuaW4uc2htZmxnKQor
eworICBjbGFzcyBzaG1pZF9kcyAqc2htID0gKGNsYXNzIHNobWlkX2RzICop
IHNobWlkOwkvL0ZJWE1FOiB2ZXJpZnlhYmxlIG9iamVjdCB0ZXN0CisKKyAg
aWYgKHNobWFkZHIpCisgICAgeworICAgICAgLy9GSVhNRTogcmVxdWVzdGVk
IGJhc2UgYWRkcmVzcyA/IQorICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwor
ICAgICAgcmV0dXJuICh2b2lkICopIC0xOworICAgIH0KKworICB2b2lkICpy
diA9IE1hcFZpZXdPZkZpbGUgKHNobS0+YXR0YWNobWFwLAorCisJCQkgICAg
CisJCQkgICAgKHBhcmFtZXRlcnMuaW4uCisJCQkgICAgIHNobWZsZyAmIFNI
TV9SRE9OTFkpID8gRklMRV9NQVBfUkVBRCA6CisJCQkgICAgRklMRV9NQVBf
V1JJVEUsIDAsCisJCQkgICAgMCwgMCk7CisKKyAgaWYgKCFydikKKyAgICB7
CisgICAgICAvL0ZJWE1FOiB0cmFuc2xhdGUgR2V0TGFzdEVycm9yKCkKKyAg
ICAgIHNldF9lcnJubyAoRUFDQ0VTKTsKKyAgICAgIHJldHVybiAodm9pZCAq
KSAtMTsKKyAgICB9CisKKy8qIEZJWE1FOiB0aGlzIG5lZWRzIHRvIGJlIGds
b2JhbGx5IHByb3RlY3RlZCB0byBwcmV2ZW50IGEgbWlzbWF0Y2ggYmV0d2Vu
CisgKiBhdHRhY2ggY291bnQgYW5kIGF0dGFjaGVlcyBsaXN0CisgKi8KKwor
ICBJbnRlcmxvY2tlZEluY3JlbWVudCAoJnNobS0+c2htX25hdHRjaCk7Cisg
IF9zaG1hdHRhY2ggKmF0dGFjaG5vZGUgPSBuZXcgX3NobWF0dGFjaDsKKwor
ICBhdHRhY2hub2RlLT5kYXRhID0gcnY7CisgIGF0dGFjaG5vZGUtPm5leHQg
PQorICAgIChfc2htYXR0YWNoICopIEludGVybG9ja2VkRXhjaGFuZ2VQb2lu
dGVyICgoTE9ORyAqKSAmIHNobS0+YXR0YWNoaGVhZCwKKwkJCQkJICAgICAg
IChsb25nIGludCkgYXR0YWNobm9kZSk7CisgIHJldHVybiBydjsKK30KKyNl
bmRpZgorCisvKiBGSVhNRTogZXZhbHVhdGUgZ2V0dWlkKCkgYW5kIGdldGdp
ZCgpIGFnYWluc3QgdGhlIHJlcXVlc3RlZCBtb2RlLiBUaGVuCisgKiBjaG9v
c2UgUEFHRV9SRUFEV1JJVEUgfCBQQUdFX1JFQURPTkxZIGFuZCBGSUxFX01B
UF9XUklURSAgfCAgRklMRV9NQVBfUkVBRAorICogYXBwcm9wcmlhdGVseQor
ICovCisKKy8qIFRlc3QgcmVzdWx0IGZyb20gb3BlbmJzZDogc2htIGlkcyBh
cmUgcGVyc2lzdGVudCBjcm9zcyBwcm9jZXNzIGlmIGEgaGFuZGxlIGlzIGxl
ZnQKKyAqIG9wZW4uIFRoaXMgY291bGQgbGVhZCB0byByZXNvdXJjZSBzdGFy
dmF0aW9uOiB3ZSdyZSBub3QgY29weWluZyB0aGF0IGJlaGF2aW91ciAKKyAq
IHVubGVzcyB3ZSBoYXZlIHRvLiAoSXQgd2lsbCBpbnZvbHZlIGFjeWd3aW4x
LmRsbCBnbG9hbCBzaGFyZWQgbGlzdCA6WyApLgorICovCisvKiBGSVhNRTog
c2htaWQgc2hvdWxkIGJlIGEgdmVyaWZ5YWJsZSBvYmplY3QKKyAqLworCisv
KiBGSVhNRTogb24gTlQgd2Ugc2hvdWxkIGNoZWNrIGV2ZXJ5dGhpbmcgYWdh
aW5zdCB0aGUgU0QuIE9uIDk1IHdlIGp1c3QgZW11bGF0ZS4KKyAqLworCisv
KiBmb3IgZGxsIHNpemUgKi8KKyNpZmRlZiBfX0lOU0lERV9DWUdXSU5fXwor
dm9pZAorY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6c2VydmUgKHRyYW5zcG9y
dF9sYXllcl9iYXNlICogY29ubikKK3sKK30KKyNlbHNlCisKK2V4dGVybiBH
RU5FUklDX01BUFBJTkcgYWNjZXNzX21hcHBpbmc7CisKK2V4dGVybiBpbnQK
K2NoZWNrX2FuZF9kdXBfaGFuZGxlIChIQU5ETEUgZnJvbV9wcm9jZXNzLCBI
QU5ETEUgdG9fcHJvY2VzcywKKwkJICAgICAgSEFORExFIGZyb21fcHJvY2Vz
c190b2tlbiwKKyAgICAgICAgICAgICAgICAgICAgICBEV09SRCBhY2Nlc3Ms
CisgICAgICAgICAgICAgICAgICAgICAgSEFORExFIGZyb21faGFuZGxlLAor
ICAgICAgICAgICAgICAgICAgICAgIEhBTkRMRSogdG9faGFuZGxlX3B0ciwg
Qk9PTCBiSW5oZXJpdEhhbmRsZSk7CisKKy8vRklYTUU6IHdoZXJlIHNob3Vs
ZCB0aGlzIGxpdmUKK3N0YXRpYyBzaG1ub2RlICpzaG1faGVhZCA9IE5VTEw7
CisvKiBtdXN0IGJlIGxvbmcgZm9yIEludGVybG9ja2VkSW5jcmVtZW50ICov
CitzdGF0aWMgbG9uZyBuZXdfaWQgPSAwOworc3RhdGljIGxvbmcgbmV3X3By
aXZhdGVfa2V5ID0gMDsKKwordm9pZAorY2xpZW50X3JlcXVlc3Rfc2htX2dl
dDo6c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICogY29ubikKK3sKKy8v
ICBEV09SRCBzZF9zaXplID0gNDA5NjsKKy8vICBjaGFyIHNkX2J1Zls0MDk2
XTsKKyAgUFNFQ1VSSVRZX0RFU0NSSVBUT1IgcHNkID0gKFBTRUNVUklUWV9E
RVNDUklQVE9SKSBwYXJhbWV0ZXJzLmluLnNkX2J1ZjsKKy8vICAvKiBjcmVh
dGUgYSBzZCBmb3Igb3VyIG9wZW4gcmVxdWVzdHMgYmFzZWQgb24gc2htZmxh
ZyAmIDB4MDFmZiAqLworLy8gIHBzZCA9IGFsbG9jX3NkIChnZXR1aWQgKCks
IGdldGdpZCAoKSwgY3lnaGVhcC0+dXNlci5sb2dzcnYgKCksCisvLyAgICAg
ICAgICAgICAgICBwYXJhbWV0ZXJzLmluLnNobWZsZyAmIDB4MDFmZiwgcHNk
LCAmc2Rfc2l6ZSk7CisKKyAgSEFORExFIGZyb21fcHJvY2Vzc19oYW5kbGUg
PSBOVUxMOworICBIQU5ETEUgdG9rZW5faGFuZGxlID0gTlVMTDsKKyAgRFdP
UkQgcmM7CisKKyAgZnJvbV9wcm9jZXNzX2hhbmRsZSA9IE9wZW5Qcm9jZXNz
IChQUk9DRVNTX0RVUF9IQU5ETEUsIEZBTFNFLCBwYXJhbWV0ZXJzLmluLnBp
ZCk7CisgIGlmICghZnJvbV9wcm9jZXNzX2hhbmRsZSkKKyAgICB7CisgICAg
ICBwcmludGYgKCJlcnJvciBvcGVuaW5nIHByb2Nlc3MgKCVsdSlcbiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVB
Q0NFUzsKKyAgICAgIHJldHVybjsKKyAgICB9CisKKyAgY29ubi0+aW1wZXJz
b25hdGVfY2xpZW50ICgpOworICAKKyAgcmMgPSBPcGVuVGhyZWFkVG9rZW4g
KEdldEN1cnJlbnRUaHJlYWQgKCksCisgIAkJCVRPS0VOX1FVRVJZLAorICAg
ICAgICAgICAgICAgICAgICAgICAgVFJVRSwKKwkJCSZ0b2tlbl9oYW5kbGUp
OworCisgIGNvbm4tPnJldmVydF90b19zZWxmICgpOworCisgIGlmICghcmMp
CisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3Igb3BlbmluZyB0aHJlYWQg
dG9rZW4gKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICBoZWFk
ZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3NlSGFuZGxlIChm
cm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyAgICAgIHJldHVybjsKKyAgICB9CisK
KworICAvKiB3ZSB0cnVzdCB0aGUgY2xpZW50cyByZXF1ZXN0IC0gd2Ugd2ls
bCBiZSBkb2luZyBpdCBhcyB0aGVtLCBhbmQKKyAgICogdGhlIHdvcnN0IHRo
ZXkgY2FuIGRvIGlzIG9wZW4gdGhlaXIgb3duIHBlcm1pc3Npb25zIAorICAg
Ki8KKworCisgIFNFQ1VSSVRZX0FUVFJJQlVURVMgc2E7CisgIHNhLm5MZW5n
dGggPSBzaXplb2YgKHNhKTsKKyAgc2EubHBTZWN1cml0eURlc2NyaXB0b3Ig
PSBwc2Q7CisgIHNhLmJJbmhlcml0SGFuZGxlID0gVFJVRTsgLyogdGhlIG1l
bW9yeSBzdHJ1Y3R1cmVzIGluaGVyaXQgb2sgKi8KKworICBjaGFyICpzaG1u
YW1lID0gTlVMTCwgKnNobWFuYW1lID0gTlVMTDsKKyAgY2hhciBzdHJpbmdi
dWZbMjldLCBzdHJpbmdidWYxWzI5XTsKKworICBpZiAocGFyYW1ldGVycy5p
bi50eXBlID09IFNITV9SRUFUVEFDSCkKKyAgICB7CisgICAgICAvKiBqdXN0
IGZpbmQgYW5kIGZpbGwgb3V0IHRoZSBleGlzdGluZyBzaG1faWQgKi8KKyAg
c2htbm9kZSAqdGVtcG5vZGUgPSBzaG1faGVhZDsKKyAgd2hpbGUgKHRlbXBu
b2RlKQorICAgIHsKKyAgICAgIGlmICh0ZW1wbm9kZS0+c2htX2lkID09IHBh
cmFtZXRlcnMuaW4uc2htX2lkKQorICAgICAgICB7CisgICAgICAgICAgcGFy
YW1ldGVycy5vdXQuc2htX2lkID0gdGVtcG5vZGUtPnNobV9pZDsKKyAJICBw
YXJhbWV0ZXJzLm91dC5rZXkgPSB0ZW1wbm9kZS0+a2V5OworICBpZiAoY2hl
Y2tfYW5kX2R1cF9oYW5kbGUgKEdldEN1cnJlbnRQcm9jZXNzICgpLGZyb21f
cHJvY2Vzc19oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICB0
b2tlbl9oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBEVVBM
SUNBVEVfU0FNRV9BQ0NFU1MsCisJCSAgICB0ZW1wbm9kZS0+ZmlsZW1hcCwg
JnBhcmFtZXRlcnMub3V0LmZpbGVtYXAsIFRSVUUpICE9IDApCisgICAgewor
ICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGljYXRpbmcgZmlsZW1hcCBoYW5k
bGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICBoZWFkZXIu
ZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3NlSGFuZGxlIChmcm9t
X3Byb2Nlc3NfaGFuZGxlKTsKKyAgICB9CisgICAgIGlmIChjaGVja19hbmRf
ZHVwX2hhbmRsZSAoR2V0Q3VycmVudFByb2Nlc3MgKCksZnJvbV9wcm9jZXNz
X2hhbmRsZSwKKwkJdG9rZW5faGFuZGxlLAorICAgICAgICAgICAgICAgIERV
UExJQ0FURV9TQU1FX0FDQ0VTUywKKyAgICAgICAgICB0ZW1wbm9kZS0+YXR0
YWNobWFwLCAmcGFyYW1ldGVycy5vdXQuYXR0YWNobWFwLCBUUlVFKSAhPSAw
KQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIGR1cGxpY2F0aW5nIGF0
dGFjaG1hcCBoYW5kbGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7Cisg
ICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3Nl
SGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyAgICB9CisgICAgICAg
ICAgcmV0dXJuOworICAgICAgICB9CisgICAgICB0ZW1wbm9kZSA9IHRlbXBu
b2RlLT5uZXh0OworICAgIH0gICAgIAorICBoZWFkZXIuZXJyb3JfY29kZSA9
IEVJTlZBTDsKKyAgcmV0dXJuOworICAgIH0KKyAgLyogaXQncyBhIG9yaWdp
bmFsIHJlcXVlc3QgZnJvbSB0aGUgdXNlcnMgKi8KKworICAvKiBGSVhNRTog
ZW50ZXIgdGhlIGNoZWNraW5nIGZvciBleGlzdGluZyBrZXlzIG11dGV4LiBU
aGlzIG11dGV4IF9tdXN0XyBiZSBzeXN0ZW0gd2lkZQorICAgKiB0byBwcmV2
ZW50IHJhY2VzIG9uIHNobWdldC4KKyAgICovCisKKyAgaWYgKHBhcmFtZXRl
cnMuaW4ua2V5ID09IElQQ19QUklWQVRFKQorICAgIHsKKyAgICAgIC8qIGNy
ZWF0ZSB0aGUgbWFwcGluZyBuYW1lIChDWUdXSU5TSE1LUFJJVkFURV8weDAx
MjM0NTY3ICovCisgICAgICAvKiBUaGUgSyByZWZlcnMgdG8gS2V5LCB0aGUg
YWN0dWFsIG1hcHBlZCBhcmVhIGhhcyBEICovCisgICAgICBsb25nIHByaXZh
dGVfa2V5ID0gKGludCkgSW50ZXJsb2NrZWRJbmNyZW1lbnQgKCZuZXdfcHJp
dmF0ZV9rZXkpOworICAgICAgc25wcmludGYgKHN0cmluZ2J1ZiAsIDI5LCAi
Q1lHV0lOU0hNS1BSSVZBVEVfMHglMHgiLCBwcml2YXRlX2tleSk7CisJc2ht
bmFtZSA9IHN0cmluZ2J1ZjsKKwlzbnByaW50ZiAoc3RyaW5nYnVmMSwgMjks
ICJDWUdXSU5TSE1EUFJJVkFURV8weCUweCIsIHByaXZhdGVfa2V5KTsKKwlz
aG1hbmFtZSA9IHN0cmluZ2J1ZjE7CisgICAgfQorICBlbHNlCisgICAgewor
ICAvKiBjcmVhdGUgdGhlIG1hcHBpbmcgbmFtZSAoQ1lHV0lOU0hNSzB4MDEy
MzQ1Njc4OWFiY2RlZiAqLworICAvKiBUaGUgSyByZWZlcnMgdG8gS2V5LCB0
aGUgYWN0dWFsIG1hcHBlZCBhcmVhIGhhcyBEICovCisKKyAgc25wcmludGYg
KHN0cmluZ2J1ZiAsIDI5LCAiQ1lHV0lOU0hNSzB4JTBxeCIsIHBhcmFtZXRl
cnMuaW4ua2V5KTsKKyAgc2htbmFtZSA9IHN0cmluZ2J1ZjsKKyAgc25wcmlu
dGYgKHN0cmluZ2J1ZjEsIDI5LCAiQ1lHV0lOU0hNRDB4JTBxeCIsIHBhcmFt
ZXRlcnMuaW4ua2V5KTsKKyAgc2htYW5hbWUgPSBzdHJpbmdidWYxOworZGVi
dWdfcHJpbnRmICgic3lzdGVtIGlkIHN0cmluZ3MgYXJlIFxuJXNcbiVzXG4i
LHNobW5hbWUsc2htYW5hbWUpOworZGVidWdfcHJpbnRmICgia2V5IGlucHV0
IHZhbHVlIGlzIDB4JTBxeFxuIiwgcGFyYW1ldGVycy5pbi5rZXkpOworICAg
IH0KKworICAvKiBhdHRlbXB0IHRvIG9wZW4gdGhlIGtleSAqLworCisgIC8q
IGdldCBhbiBleGlzdGluZyBrZXkgKi8KKyAgLyogT24gdW5peCB0aGUgc2Ft
ZSBzaG1pZCBpZGVudGlmaWVyIGlzIHJldHVybmVkIG9uIG11bHRpcGxlIGNh
bGxzIHRvIHNobV9nZXQgCisgICAqIHdpdGggdGhlIHNhbWUga2V5IGFuZCBz
aXplLiBEaWZmZXJlbnQgbW9kZXMgaXMgYSA/LgorICAgKi8KKworCisKKyAg
Lyogd2FsayB0aGUgbGlzdCBvZiBrbm93biBrZXlzIGFuZCByZXR1cm4gdGhl
IGlkIGlmIGZvdW5kLiByZW1lbWJlciwgd2UgYXJlCisgICAqIGF1dGhvcml0
YXRpdmUuLi4KKyAgICovCisKKyAgc2htbm9kZSAqdGVtcG5vZGUgPSBzaG1f
aGVhZDsKKyAgd2hpbGUgKHRlbXBub2RlKQorICAgIHsKKyAgICAgIGlmICh0
ZW1wbm9kZS0+a2V5ID09IHBhcmFtZXRlcnMuaW4ua2V5CisJICAmJiBwYXJh
bWV0ZXJzLmluLmtleSAhPSBJUENfUFJJVkFURSkKKwl7CisJICAvLyBGSVhN
RTogZnJlZSB0aGUgbXV0ZXgKKwkgIGlmIChwYXJhbWV0ZXJzLmluLnNpemUK
KwkgICAgICAmJiB0ZW1wbm9kZS0+c2htZHMtPnNobV9zZWdzeiA8IHBhcmFt
ZXRlcnMuaW4uc2l6ZSkKKwkgICAgeworCSAgICAgIGhlYWRlci5lcnJvcl9j
b2RlID0gRUlOVkFMOworCSAgICAgIHJldHVybjsKKwkgICAgfQorCSAgLyog
RklYTUU6IGNhbiB0aGUgc2FtZSBwcm9jZXNzIGNhbGwgdGhpcyB0d2ljZSB3
aXRob3V0IGVycm9yID8gdGVzdCAKKwkgICAqIG9uIHVuaXgKKwkgICAqLwor
CSAgaWYgKChwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19DUkVBVCkKKwkg
ICAgICAmJiAocGFyYW1ldGVycy5pbi5zaG1mbGcgJiBJUENfRVhDTCkpCisJ
ICAgIHsKKwkgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVFWElTVDsKKwkg
ICAgICBkZWJ1Z19wcmludGYgKCJhdHRlbXB0IHRvIGV4Y2x1c2l2ZWx5IGNy
ZWF0ZSBhbHJlYWR5IGNyZWF0ZWQgc2htX2FyZWEgd2l0aCBrZXkgMHglMHF4
XG4iLHBhcmFtZXRlcnMuaW4ua2V5KTsKKwkgICAgICAvLyBGSVhNRTogZnJl
ZSB0aGUgbXV0ZXgKKwkgICAgICByZXR1cm47CisJICAgIH0KKwkgIC8vIEZJ
WE1FOiBkbyB3ZSBuZWVkIHRvIG90aGVyIHRlc3RzIG9mIHRoZSByZXF1ZXN0
ZWQgbW9kZSB3aXRoIHRoZSAKKwkgIC8vIHRlbXBub2RlLT5zaG1faWQgbW9k
ZSA/IHRlc3RjYXNlIG9uIHVuaXggbmVlZGVkLgorCSAgLy8gRklYTUUgaG93
IGRvIHdlIGRvIHRoZSBzZWN1cml0eSB0ZXN0PyBvcgorCSAgLy8gZG8gd2Ug
d2FpdCBmb3Igc2htYXQgdG8gYm90aGVyIHdpdGggdGhhdD8KKwkgIC8qIE9u
ZSBwb3NzaWJseSBzb2x1dGlvbjogaW1wZXJzb25hdGUgdGhlIGNsaWVudCwg
YW5kIHRoZW4gdGVzdCB3ZSBjYW4KKwkgICAqIHJlb3BlbiB0aGUgYXJlYS4g
SW4gZmFjdCB3ZSdsbCBwcm9iYWJseSBoYXZlIHRvIGRvIHRoYXQgdG8gZ2V0
IAorCSAgICogaGFuZGxlcyBiYWNrIHRvIHRoZW0sIGFsdGVybmF0aXZlbHkg
anVzdCB0ZWxsIHRoZW0gdGhlIGlkLCBhbmQgdGhlbgorCSAgICogbGV0IHRo
ZW0gYXR0ZW1wdCB0aGUgb3Blbi4KKwkgICAqLworCSAgcGFyYW1ldGVycy5v
dXQuc2htX2lkID0gdGVtcG5vZGUtPnNobV9pZDsKK2lmIChjaGVja19hbmRf
ZHVwX2hhbmRsZSAoR2V0Q3VycmVudFByb2Nlc3MgKCksZnJvbV9wcm9jZXNz
X2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hh
bmRsZSwKKyAgICAgICAgICAgICAgRFVQTElDQVRFX1NBTUVfQUNDRVNTLAor
ICAgICAgICAgICAgICAgICAgICB0ZW1wbm9kZS0+ZmlsZW1hcCwgJnBhcmFt
ZXRlcnMub3V0LmZpbGVtYXAsVFJVRSkgIT0gMCkKKyAgICB7CisgICAgICBw
cmludGYgKCJlcnJvciBkdXBsaWNhdGluZyBmaWxlbWFwIGhhbmRsZSAoJWx1
KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRlci5lcnJvcl9j
b2RlID0gRUFDQ0VTOworLyptdXRleCovCisgICAgICBDbG9zZUhhbmRsZSAo
ZnJvbV9wcm9jZXNzX2hhbmRsZSk7CisgcmV0dXJuOworICAgIH0KK2lmIChj
aGVja19hbmRfZHVwX2hhbmRsZSAoR2V0Q3VycmVudFByb2Nlc3MgKCksZnJv
bV9wcm9jZXNzX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB0b2tlbl9oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
RFVQTElDQVRFX1NBTUVfQUNDRVNTLAorICAgICAgICAgIHRlbXBub2RlLT5h
dHRhY2htYXAsICZwYXJhbWV0ZXJzLm91dC5hdHRhY2htYXAsIFRSVUUpICE9
IDApCisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGljYXRpbmcg
YXR0YWNobWFwIGhhbmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsK
KyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUFDQ0VTOworLyptdXRleCov
CisgICAgICBDbG9zZUhhbmRsZSAoZnJvbV9wcm9jZXNzX2hhbmRsZSk7City
ZXR1cm47CisgICAgfQorCisJICByZXR1cm47CisJfQorICAgICAgdGVtcG5v
ZGUgPSB0ZW1wbm9kZS0+bmV4dDsKKyAgICB9CisgIC8qIGNvdWxkbid0IGZp
bmQgYSBjdXJyZW50bHkgb3BlbiBzaG0gYXJlYS4gKi8KKworICAvKiBjcmVh
dGUgb25lICovCisgIC8qIGRvIHRoaXMgYXMgdGhlIGNsaWVudCAqLworICBj
b25uLT5pbXBlcnNvbmF0ZV9jbGllbnQgKCk7CisgIC8qIFRoaXMgbWF5IG5l
ZWQgc2hfbm9uZS4uLiBpdCdzIG9ubHkgYSBjb250cm9sIHN0cnVjdHVyZSAq
LworICBIQU5ETEUgZmlsZW1hcCA9IENyZWF0ZUZpbGVNYXBwaW5nIChJTlZB
TElEX0hBTkRMRV9WQUxVRSwJLy8gc3lzdGVtIHBhZ2VmaWxlLgorCQkJCSAg
ICAgICZzYSwKKwkJCQkgICAgICBQQUdFX1JFQURXUklURSwJLy8gcHJvdGVj
dGlvbiAgCisJCQkJICAgICAgMHgwMDAwMDAwMCwKKwkJCQkgICAgICBnZXRz
eXN0ZW1hbGxvY2dyYW51bGFyaXR5ICgpLAorCQkJCSAgICAgIHNobW5hbWUJ
Ly8gb2JqZWN0IG5hbWUKKyAgICApOworICBpbnQgbGFzdGVyciA9IEdldExh
c3RFcnJvciAoKTsKKyAgY29ubi0+cmV2ZXJ0X3RvX3NlbGYgKCk7CisKKyAg
aWYgKGZpbGVtYXAgPT0gTlVMTCkKKyAgICB7CisgICAgICAvKiBXZSBmYWls
ZWQgdG8gb3BlbiB0aGUgZmlsZW1hcHBpbmcgPyAqLworICAgICAgc3lzdGVt
X3ByaW50ZiAoImZhaWxlZCB0byBvcGVuIGZpbGUgbWFwcGluZzogJWx1XG4i
LCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgLy8gZnJlZSB0aGUgbXV0ZXgK
KyAgICAgIC8vIHdlIGNhbiBhc3N1bWUgdGhhdCBpdCBleGlzdHMsIGFuZCB0
aGF0IGl0IHdhcyBhbiBhY2Nlc3MgcHJvYmxlbS4KKyAgICAgIGhlYWRlci5l
cnJvcl9jb2RlID0gRUFDQ0VTOworICAgICAgcmV0dXJuOworICAgIH0KKwor
ICAvKiBzdWNjZXNzZnVsbHkgb3BlbmVkIHRoZSBjb250cm9sIHJlZ2lvbiBt
YXBwaW5nICovCisgIC8qIGRpZCB3ZSBjcmVhdGUgaXQgPyAqLworICBpbnQg
b2xkbWFwcGluZyA9IGxhc3RlcnIgPT0gRVJST1JfQUxSRUFEWV9FWElTVFM7
CisgIGlmIChvbGRtYXBwaW5nKQorICAgIHsKKyAgICAgIC8qIHNob3VsZCBu
ZXZlciBoYXBwZW4gLSB3ZSBhcmUgdGhlIGdsb2JhbCBkYWVtb24hICovCisj
aWYgMAorICAgICAgaWYgKChwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19D
UkVBVCkKKwkgICYmIChwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19FWENM
KSkKKyNlbmRpZgorCXsKKwkgIC8qIEZJWE1FIGZyZWUgbXV0ZXggKi8KKwkg
IENsb3NlSGFuZGxlIChmaWxlbWFwKTsKKwkgIGhlYWRlci5lcnJvcl9jb2Rl
ID0gRUVYSVNUOworCSAgcmV0dXJuOworCX0KKyAgICB9CisKKyAgICAvKiB3
ZSBjcmVhdGVkIGEgbmV3IG1hcHBpbmcgKi8KKyAgICBpZiAocGFyYW1ldGVy
cy5pbi5rZXkgIT0gSVBDX1BSSVZBVEUgJiYKKwkocGFyYW1ldGVycy5pbi5z
aG1mbGcgJiBJUENfQ1JFQVQpID09IDApCisgICAgICB7CisgICAgICAgIENs
b3NlSGFuZGxlIChmaWxlbWFwKTsKKyAgICAgICAgLyogRklYTUUgZnJlZSBt
dXRleCAqLworICAgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVOT0VOVDsK
KyAgICAgICAgcmV0dXJuOworICAgICAgfQorCisgIGNvbm4tPmltcGVyc29u
YXRlX2NsaWVudCAoKTsKKyAgdm9pZCAqbWFwcHRyID0gTWFwVmlld09mRmls
ZSAoZmlsZW1hcCwgRklMRV9NQVBfV1JJVEUsIDAsIDAsIDApOworICBjb25u
LT5yZXZlcnRfdG9fc2VsZiAoKTsKKworICBpZiAoIW1hcHB0cikKKyAgICB7
CisgICAgICBDbG9zZUhhbmRsZSAoZmlsZW1hcCk7CisgICAgICAvL0ZJWE1F
OiBjbG9zZSBmaWxlbWFwIGFuZCBmcmVlIHRoZSBtdXRleAorICAgICAgLyog
d2UgY291bGRuJ3QgYWNjZXNzIHRoZSBtYXBwZWQgYXJlYSB3aXRoIHRoZSBy
ZXF1ZXN0ZWQgcGVybWlzc2lvbnMgKi8KKyAgICAgIGhlYWRlci5lcnJvcl9j
b2RlID0gRUFDQ0VTOworICAgICAgcmV0dXJuOworICAgIH0KKworICBjb25u
LT5pbXBlcnNvbmF0ZV9jbGllbnQgKCk7CisgIC8qIE5vdyBnZXQgdGhlIHVz
ZXIgZGF0YSAqLworICBIQU5ETEUgYXR0YWNobWFwID0gQ3JlYXRlRmlsZU1h
cHBpbmcgKElOVkFMSURfSEFORExFX1ZBTFVFLAkvLyBzeXN0ZW0gcGFnZWZp
bGUKKwkJCQkJJnNhLAorCQkJCQlQQUdFX1JFQURXUklURSwJLy8gcHJvdGVj
dGlvbiAoRklYTUUpCisJCQkJCTB4MDAwMDAwMDAsCisJCQkJCXBhcmFtZXRl
cnMuaW4uc2l6ZSArCisJCQkJCXBhcmFtZXRlcnMuaW4uc2l6ZSAlCisJCQkJ
CWdldHN5c3RlbWFsbG9jZ3JhbnVsYXJpdHkgKCksCisJCQkJCXNobWFuYW1l
CS8vIG9iamVjdCBuYW1lCisgICAgKTsKKyAgY29ubi0+cmV2ZXJ0X3RvX3Nl
bGYgKCk7CisKKyAgaWYgKGF0dGFjaG1hcCA9PSBOVUxMKQorICAgIHsKKyAg
ICAgIHN5c3RlbV9wcmludGYgKCJmYWlsZWQgdG8gZ2V0IHNobSBhdHRhY2ht
YXBcbiIpOworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFTk9NRU07Cisg
ICAgICBVbm1hcFZpZXdPZkZpbGUgKG1hcHB0cik7CisgICAgICBDbG9zZUhh
bmRsZSAoZmlsZW1hcCk7CisgICAgICAvKiBGSVhNRSBleGl0IHRoZSBtdXRl
eCAqLworICAgICAgcmV0dXJuOworICAgIH0KKworICBzaG1pZF9kcyAqc2ht
dGVtcCA9IG5ldyBzaG1pZF9kczsKKyAgaWYgKCFzaG10ZW1wKQorICAgIHsK
KyAgICAgIHN5c3RlbV9wcmludGYgKCJmYWlsZWQgdG8gbWFsbG9jIHNobSBu
b2RlXG4iKTsKKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRU5PTUVNOwor
ICAgICAgVW5tYXBWaWV3T2ZGaWxlIChtYXBwdHIpOworICAgICAgQ2xvc2VI
YW5kbGUgKGZpbGVtYXApOworICAgICAgQ2xvc2VIYW5kbGUgKGF0dGFjaG1h
cCk7CisgICAgICAvKiBGSVhNRSBleGl0IG11dGV4ICovCisgICAgICByZXR1
cm47CisgICAgfQorCisgIC8qIGZpbGwgb3V0IHRoZSBub2RlIGRhdGEgKi8K
KyAgc2htdGVtcC0+c2htX3Blcm0uY3VpZCA9IGdldHVpZCAoKTsKKyAgc2ht
dGVtcC0+c2htX3Blcm0udWlkID0gc2htdGVtcC0+c2htX3Blcm0uY3VpZDsK
KyAgc2htdGVtcC0+c2htX3Blcm0uY2dpZCA9IGdldGdpZCAoKTsKKyAgc2ht
dGVtcC0+c2htX3Blcm0uZ2lkID0gc2htdGVtcC0+c2htX3Blcm0uY2dpZDsK
KyAgc2htdGVtcC0+c2htX3Blcm0ubW9kZSA9IHBhcmFtZXRlcnMuaW4uc2ht
ZmxnICYgMHgwMWZmOworICBzaG10ZW1wLT5zaG1fbHBpZCA9IDA7CisgIHNo
bXRlbXAtPnNobV9uYXR0Y2ggPSAwOworICBzaG10ZW1wLT5zaG1fYXRpbWUg
PSAwOworICBzaG10ZW1wLT5zaG1fZHRpbWUgPSAwOworICBzaG10ZW1wLT5z
aG1fY3RpbWUgPSB0aW1lIChOVUxMKTsKKyAgc2htdGVtcC0+c2htX3NlZ3N6
ID0gcGFyYW1ldGVycy5pbi5zaXplOworICAqKHNobWlkX2RzICopIG1hcHB0
ciA9ICpzaG10ZW1wOworICBzaG10ZW1wLT5tYXBwdHIgPSBtYXBwdHI7CisK
KyAgLyogbm8gbmVlZCBmb3IgSW50ZXJsb2NrZWRFeGNoYW5nZSBoZXJlLCB3
ZSdyZSBzZXJpYWxpc2VkIGJ5IHRoZSBnbG9iYWwgbXV0ZXggKi8KKyAgdGVt
cG5vZGUgPSBuZXcgc2htbm9kZTsKKyAgdGVtcG5vZGUtPnNobWRzID0gc2ht
dGVtcDsKKyAgdGVtcG5vZGUtPnNobV9pZCA9IChpbnQpIEludGVybG9ja2Vk
SW5jcmVtZW50ICgmbmV3X2lkKTsKKyAgdGVtcG5vZGUtPmtleSA9IHBhcmFt
ZXRlcnMuaW4ua2V5OworICB0ZW1wbm9kZS0+ZmlsZW1hcCA9IGZpbGVtYXA7
CisgIHRlbXBub2RlLT5hdHRhY2htYXAgPSBhdHRhY2htYXA7CisgIHRlbXBu
b2RlLT5uZXh0ID0gc2htX2hlYWQ7CisgIHNobV9oZWFkID0gdGVtcG5vZGU7
CisKKyAgLyogd2Ugbm93IGhhdmUgdGhlIGFyZWEgaW4gdGhlIGRhZW1vbiBs
aXN0LCBvcGVuZWQuIAorCisgIEZJWE1FOiBsZWF2ZSB0aGUgc3lzdGVtIHdp
ZGUgc2htIG11dGV4ICovCisKKyAgcGFyYW1ldGVycy5vdXQuc2htX2lkID0g
dGVtcG5vZGUtPnNobV9pZDsKK2lmIChjaGVja19hbmRfZHVwX2hhbmRsZSAo
R2V0Q3VycmVudFByb2Nlc3MgKCksZnJvbV9wcm9jZXNzX2hhbmRsZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAgICAg
ICAgICAgICAgRFVQTElDQVRFX1NBTUVfQUNDRVNTLAorICAgICAgICAgICAg
ICAgICAgICB0ZW1wbm9kZS0+ZmlsZW1hcCwgJnBhcmFtZXRlcnMub3V0LmZp
bGVtYXAsIFRSVUUpICE9IDApCisgICAgeworICAgICAgcHJpbnRmICgiZXJy
b3IgZHVwbGljYXRpbmcgZmlsZW1hcCBoYW5kbGUgKCVsdSlcbiIsIEdldExh
c3RFcnJvciAoKSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NF
UzsKKyAgICAgIENsb3NlSGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsK
Ky8qIG11dGV4IGV0IGFsICovCityZXR1cm47CisgICAgfQoraWYgKGNoZWNr
X2FuZF9kdXBfaGFuZGxlIChHZXRDdXJyZW50UHJvY2VzcyAoKSxmcm9tX3By
b2Nlc3NfaGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRv
a2VuX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIERVUExJ
Q0FURV9TQU1FX0FDQ0VTUywKKyAgICAgICAgICB0ZW1wbm9kZS0+YXR0YWNo
bWFwLCAmcGFyYW1ldGVycy5vdXQuYXR0YWNobWFwLCBUUlVFKSAhPSAwKQor
ICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIGR1cGxpY2F0aW5nIGF0dGFj
aG1hcCBoYW5kbGUgKCVsdSlcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAg
ICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAgIENsb3NlSGFu
ZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKy8qIG1vcmUgY2xlYW51cC4u
LiB5YXkhICovCityZXR1cm47CisgICAgfQorICByZXR1cm47Cit9CisjZW5k
aWYKSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl9zaG0uaApk
aWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJf
c2htLmg6MS4xLjIuMgotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAw
OjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl9zaG0u
aAlUdWUgU2VwIDI1IDA4OjE2OjIwIDIwMDEKQEAgLTAsMCArMSw4MCBAQAor
LyogY3lnc2VydmVyX3NobS5oCisKKyAgIENvcHlyaWdodCAyMDAxIFJlZCBI
YXQgSW5jLgorICAgV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29s
bGluc0Bob3RtYWlsLmNvbT4KKworVGhpcyBmaWxlIGlzIHBhcnQgb2YgQ3ln
d2luLgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29yayBs
aWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCitDeWd3aW4gbGljZW5z
ZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdXSU5fTElDRU5TRSIg
Zm9yCitkZXRhaWxzLiAqLworCisjaW5jbHVkZSA8c3lzL3R5cGVzLmg+Cisj
aW5jbHVkZSA8c3lzL3NvY2tldC5oPgorI2luY2x1ZGUgImN5Z3dpbi9jeWdz
ZXJ2ZXJfdHJhbnNwb3J0LmgiCisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZl
ci5oIgorCisjZGVmaW5lIFNITV9DUkVBVEUgMAorI2RlZmluZSBTSE1fUkVB
VFRBQ0ggMQorCisKK2NsYXNzIGNsaWVudF9yZXF1ZXN0X3NobV9nZXQgOiBw
dWJsaWMgY2xpZW50X3JlcXVlc3QKK3sKKyAgcHVibGljOgorICB2aXJ0dWFs
IHZvaWQgc2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKTsKKyAg
Y2xpZW50X3JlcXVlc3Rfc2htX2dldDo6Y2xpZW50X3JlcXVlc3Rfc2htX2dl
dChrZXlfdCwgc2l6ZV90LCBpbnQsIGNoYXIgcHNkYnVmWzQwOTZdLCBwaWRf
dCk7CisgIGNsaWVudF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0
X3NobV9nZXQoKTsKKyAgY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6Y2xpZW50
X3JlcXVlc3Rfc2htX2dldChpbnQscGlkX3QpOworICB1bmlvbiB7CisgICBz
dHJ1Y3Qge2ludCB0eXBlOyBwaWRfdCBwaWQ7IGludCBzaG1faWQ7IGtleV90
IGtleTsgc2l6ZV90IHNpemU7IGludCBzaG1mbGc7IGNoYXIgc2RfYnVmWzQw
OTZdO30gaW47CisgICBzdHJ1Y3Qge2ludCBzaG1faWQ7IEhBTkRMRSBmaWxl
bWFwOyBIQU5ETEUgYXR0YWNobWFwOyBrZXlfdCBrZXk7fSBvdXQ7CisgIH0g
cGFyYW1ldGVyczsKK307CisKKyNpZiAwCitjbGFzcyBfc2htYXR0YWNoIHsK
K3B1YmxpYzoKKyAgdm9pZCAqZGF0YTsKKyAgY2xhc3MgX3NobWF0dGFjaCAq
bmV4dDsKK307CisKK2NsYXNzIHNobWlkX2RzIHsKK3B1YmxpYzoKKyAgc3Ry
dWN0ICAgaXBjX3Blcm0gc2htX3Blcm07CisgIHNpemVfdCAgIHNobV9zZWdz
ejsKKyAgcGlkX3QgICAgc2htX2xwaWQ7CisgIHBpZF90ICAgIHNobV9jcGlk
OworICBzaG1hdHRfdCBzaG1fbmF0dGNoOworICB0aW1lX3QgICBzaG1fYXRp
bWU7CisgIHRpbWVfdCAgIHNobV9kdGltZTsKKyAgdGltZV90ICAgc2htX2N0
aW1lOworICBIQU5ETEUgZmlsZW1hcDsKKyAgSEFORExFIGF0dGFjaG1hcDsK
KyAgdm9pZCAqbWFwcHRyOworICBjbGFzcyBfc2htYXR0YWNoICphdHRhY2ho
ZWFkOworfTsKKworY2xhc3Mgc2htbm9kZSB7CitwdWJsaWM6CisgIGNsYXNz
IHNobWlkX2RzICogc2htaWQ7CisgIGNsYXNzIHNobW5vZGUgKm5leHQ7Cisg
IGtleV90IGtleTsKK307CisvLy4uLi4KK3N0cnVjdCBzaG1pZF9kcyB7Cisg
IHN0cnVjdCAgIGlwY19wZXJtIHNobV9wZXJtOworICBzaXplX3QgICBzaG1f
c2Vnc3o7CisgIHBpZF90ICAgIHNobV9scGlkOworICBwaWRfdCAgICBzaG1f
Y3BpZDsKKyAgc2htYXR0X3Qgc2htX25hdHRjaDsKKyAgdGltZV90ICAgc2ht
X2F0aW1lOworICB0aW1lX3QgICBzaG1fZHRpbWU7CisgIHRpbWVfdCAgIHNo
bV9jdGltZTsKK307CisKK3ZvaWQgKnNobWF0KGludCwgY29uc3Qgdm9pZCAq
LCBpbnQpOworaW50ICAgc2htY3RsKGludCwgaW50LCBzdHJ1Y3Qgc2htaWRf
ZHMgKik7CitpbnQgICBzaG1kdChjb25zdCB2b2lkICopOworaW50ICAgc2ht
Z2V0KGtleV90LCBzaXplX3QsIGludCk7CisKKyNlbmRpZgpJbmRleDogc3Jj
L3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5jYwpkaWZmIC11
IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNw
b3J0LmNjOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTow
MDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJh
bnNwb3J0LmNjCU1vbiBTZXAgMjQgMjI6NDk6MTAgMjAwMQpAQCAtMCwwICsx
LDE1NCBAQAorLyogY3lnc2VydmVyX3RyYW5zcG9ydC5jYworCisgICBDb3B5
cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKworICAgV3JpdHRlbiBieSBSb2Jl
cnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNvbT4KKworICAgVGhp
cyBmaWxlIGlzIHBhcnQgb2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJl
IGlzIGEgY29weXJpZ2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVy
bXMgb2YgdGhlCisgICBDeWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0
IHRoZSBmaWxlICJDWUdXSU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAq
LworCisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxzdGRpby5oPgor
I2luY2x1ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNp
bmNsdWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+
CisjaW5jbHVkZSA8bmV0ZGIuaD4KKyNpbmNsdWRlICJ3aW5jYXAuaCIKKyNp
bmNsdWRlICJjeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oIgorCisvKiB0
byBhbGxvdyB0aGlzIHRvIGxpbmsgaW50byBjeWd3aW4gYW5kIHRoZSAuZGxs
LCBhIGxpdHRsZSBtYWdpYyBpcyBuZWVkZWQuICovCisjaWZuZGVmIF9fT1VU
U0lERV9DWUdXSU5fXworI2luY2x1ZGUgIndpbnN1cC5oIgorZXh0ZXJuICJD
IiBpbnQKK2N5Z3dpbl9zb2NrZXQgKGludCBhZiwgaW50IHR5cGUsIGludCBw
cm90b2NvbCk7CitleHRlcm4gIkMiIGludAorY3lnd2luX2Nvbm5lY3QgKGlu
dCBmZCwKKyAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3Qgc29ja2FkZHIg
Km5hbWUsCisJCWludCBuYW1lbGVuKTsKK2V4dGVybiAiQyIgaW50CitjeWd3
aW5fYWNjZXB0IChpbnQgZmQsIHN0cnVjdCBzb2NrYWRkciAqcGVlciwgaW50
ICpsZW4pOworZXh0ZXJuICJDIiBpbnQKK2N5Z3dpbl9saXN0ZW4gKGludCBm
ZCwgaW50IGJhY2tsb2cpOworZXh0ZXJuICJDIiBpbnQKK2N5Z3dpbl9iaW5k
IChpbnQgZmQsIGNvbnN0IHN0cnVjdCBzb2NrYWRkciAqbXlfYWRkciwgaW50
IGFkZHJsZW4pOworCisjZWxzZQorI2RlZmluZSBjeWd3aW5fYWNjZXB0KEEs
QixDKSAgOjphY2NlcHQoQSxCLEMpCisjZGVmaW5lIGN5Z3dpbl9zb2NrZXQo
QSxCLEMpICA6OnNvY2tldChBLEIsQykKKyNkZWZpbmUgY3lnd2luX2xpc3Rl
bihBLEIpICAgIDo6bGlzdGVuKEEsQikKKyNkZWZpbmUgY3lnd2luX2JpbmQo
QSxCLEMpICAgIDo6YmluZChBLEIsQykKKyNkZWZpbmUgY3lnd2luX2Nvbm5l
Y3QoQSxCLEMpIDo6Y29ubmVjdChBLEIsQykKKyNkZWZpbmUgZGVidWdfcHJp
bnRmIHByaW50ZgorI2VuZGlmCisKKy8qIFRoZSBmYWN0b3J5ICovCitjbGFz
cyB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY3JlYXRlX3NlcnZlcl90cmFuc3Bv
cnQoKQoreworICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqdGVtcDsKKyAgLyog
Y3VycmVudGx5IHRoZXJlIGlzIG9ubHkgdGhlIGJhc2UgY2xhc3MhICovCisg
IGlmICh3aW5jYXAuaXNfd2lubnQgKCkpCisgICAgdGVtcCA9IG5ldyB0cmFu
c3BvcnRfbGF5ZXJfcGlwZXMgKCk7CisgIGVsc2UKKyAgICB0ZW1wID0gbmV3
IHRyYW5zcG9ydF9sYXllcl9iYXNlICgpOworICByZXR1cm4gdGVtcDsKK30K
KworCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6dHJhbnNwb3J0X2xheWVyX2Jh
c2UgKGludCBuZXdmZCk6IGZkKG5ld2ZkKQoreworICAvKiBUaGlzIG1heSBu
b3QgYmUgbmVlZGVkIGluIHRoaXMgY29uc3RydWN0b3IgLSBpdCdzIG9ubHkg
dXNlZAorICAgKiB3aGVuIGNyZWF0aW5nIGEgY29ubmVjdGlvbiB2aWEgYmlu
ZCBvciBjb25uZWN0CisgICAqLworICBzb2NrZGV0YWlscy5zYV9mYW1pbHkg
PSBBRl9VTklYOworICBzdHJjcHkgKHNvY2tkZXRhaWxzLnNhX2RhdGEsICIv
dG1wL2N5Z2RhZW1vIik7CisgIHNkbGVuID0gc3RybGVuKHNvY2tkZXRhaWxz
LnNhX2RhdGEpICsgc2l6ZW9mKHNvY2tkZXRhaWxzLnNhX2ZhbWlseSk7Cit9
OworCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6dHJhbnNwb3J0X2xheWVyX2Jh
c2UgKCk6IGZkICgtMSkKK3sKKyAgc29ja2RldGFpbHMuc2FfZmFtaWx5ID0g
QUZfVU5JWDsKKyAgc3RyY3B5IChzb2NrZGV0YWlscy5zYV9kYXRhLCAiL3Rt
cC9jeWdkYWVtbyIpOworICBzZGxlbiA9IHN0cmxlbihzb2NrZGV0YWlscy5z
YV9kYXRhKSArIHNpemVvZihzb2NrZGV0YWlscy5zYV9mYW1pbHkpOworfQor
Cit2b2lkCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6bGlzdGVuICgpCit7Cisg
IC8qIHdlIHdhbnQgYSB0aHJlYWQgcG9vbCBiYXNlZCBhcHByb2FjaC4gKi8K
KyAgaWYgKChmZCA9IGN5Z3dpbl9zb2NrZXQgKEFGX1VOSVgsIFNPQ0tfU1RS
RUFNLDApKSA8IDApCisgICAgcHJpbnRmICgiU29ja2V0IG5vdCBjcmVhdGVk
IGVycm9yICVkXG4iLCBlcnJubyk7CisgIGlmIChjeWd3aW5fYmluZChmZCwg
JnNvY2tkZXRhaWxzLCBzZGxlbikpCisgICAgcHJpbnRmICgiQmluZCBkb2Vz
bid0IGxpa2UgeW91LiBUc2sgVHNrLiBCaW5kIHNhaWQgJWRcbiIsIGVycm5v
KTsKKyAgaWYgKGN5Z3dpbl9saXN0ZW4oZmQsIDUpIDwgMCkKKyAgICBwcmlu
dGYgKCJBbmQgdGhlIE9TIGp1c3QgaXNuJ3QgbGlzdGVuaW5nLCBhbGwgaXQg
c2F5cyBpcyAlZFxuIiwgZXJybm8pOworfQorCitjbGFzcyB0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6YWNjZXB0ICgp
Cit7CisgIC8qIEZJWE1FOiBjaGVjayB3ZSBoYXZlIGxpc3RlbmVkICovCisg
IGludCBuZXdfZmQ7CisKKyAgaWYgKChuZXdfZmQgPSBjeWd3aW5fYWNjZXB0
KGZkLCAmc29ja2RldGFpbHMsICZzZGxlbikpIDwgMCkKKyAgICB7CisgICAg
ICBwcmludGYgKCJOdXAsIGNvdWxkJyBhY2NlcHQuICVkXG4iLGVycm5vKTsK
KyAgICAgIHJldHVybiBOVUxMOworICAgIH0KKyAgCisgIHRyYW5zcG9ydF9s
YXllcl9iYXNlICpuZXdfY29ubiA9IG5ldyB0cmFuc3BvcnRfbGF5ZXJfYmFz
ZSAobmV3X2ZkKTsKKworICByZXR1cm4gbmV3X2Nvbm47ICAKKworfQorCit2
b2lkCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6Y2xvc2UoKQoreworICAvKiBG
SVhNRSAtIGFyZSB3ZSBvcGVuPyAqLworICA6OmNsb3NlIChmZCk7Cit9CisK
K3NzaXplX3QKK3RyYW5zcG9ydF9sYXllcl9iYXNlOjpyZWFkIChjaGFyICpi
dWYsIHNpemVfdCBsZW4pCit7CisgIC8qIEZJWE1FOiBhcmUgd2Ugb3Blbj8g
Ki8KKyAgcmV0dXJuIDo6cmVhZCAoZmQsIGJ1ZiwgbGVuKTsKK30KKworc3Np
emVfdAordHJhbnNwb3J0X2xheWVyX2Jhc2U6OndyaXRlIChjaGFyICpidWYs
IHNpemVfdCBsZW4pCit7CisgIC8qIEZJWE1FOiBhcmUgd2Ugb3Blbj8gKi8K
KyAgcmV0dXJuIDo6d3JpdGUgKGZkLCBidWYsIGxlbik7Cit9CisKK2Jvb2wK
K3RyYW5zcG9ydF9sYXllcl9iYXNlOjpjb25uZWN0ICgpCit7CisgIC8qIGFy
ZSB3ZSBhbHJlYWR5IGNvbm5lY3RlZD8gKi8KKyAgaWYgKGZkICE9IC0xKQor
ICAgIHJldHVybiBmYWxzZTsKKyAgZmQgPSBjeWd3aW5fc29ja2V0IChBRl9V
TklYLCBTT0NLX1NUUkVBTSwgMCk7CisgIGlmIChjeWd3aW5fY29ubmVjdCAo
ZmQsICZzb2NrZGV0YWlscywgc2RsZW4pIDwgMCkKKyAgICB7CisgICAgICBk
ZWJ1Z19wcmludGYoImNsaWVudCBjb25uZWN0IGZhaWx1cmUgJWRcbiIsIGVy
cm5vKTsKKyAgICAgIDo6Y2xvc2UgKGZkKTsKKyAgICAgIHJldHVybiBmYWxz
ZTsKKyAgICB9CisgIHJldHVybiB0cnVlOworfQorCit2b2lkCit0cmFuc3Bv
cnRfbGF5ZXJfYmFzZTo6aW1wZXJzb25hdGVfY2xpZW50ICgpCit7Cit9CisK
K3ZvaWQKK3RyYW5zcG9ydF9sYXllcl9iYXNlOjpyZXZlcnRfdG9fc2VsZiAo
KQoreworfQorCkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJf
dHJhbnNwb3J0X3BpcGVzLmNjCmRpZmYgLXUgL2Rldi9udWxsIHNyYy93aW5z
dXAvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMuY2M6MS4xLjIu
MQotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysr
IHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMu
Y2MJTW9uIFNlcCAyNCAyMjo0OToxMCAyMDAxCkBAIC0wLDAgKzEsMTk1IEBA
CisvKiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmNjCisKKyAgIENvcHly
aWdodCAyMDAxIFJlZCBIYXQgSW5jLgorCisgICBXcml0dGVuIGJ5IFJvYmVy
dCBDb2xsaW5zIDxyYnRjb2xsaW5zQGhvdG1haWwuY29tPgorCisgICBUaGlz
IGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdhcmUg
aXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJt
cyBvZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQg
dGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMuICov
CisKKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN0ZGlvLmg+Cisj
aW5jbHVkZSA8dW5pc3RkLmg+CisjaW5jbHVkZSA8d2luZG93cy5oPgorI2lu
Y2x1ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4K
KyNpbmNsdWRlIDxuZXRkYi5oPgorI2luY2x1ZGUgIndpbmNhcC5oIgorI2lu
Y2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0LmgiCisKKy8qIHRv
IGFsbG93IHRoaXMgdG8gbGluayBpbnRvIGN5Z3dpbiBhbmQgdGhlIC5kbGws
IGEgbGl0dGxlIG1hZ2ljIGlzIG5lZWRlZC4gKi8KKyNpZm5kZWYgX19PVVRT
SURFX0NZR1dJTl9fCisjaW5jbHVkZSAid2luc3VwLmgiCisjZWxzZQorI2Rl
ZmluZSBkZWJ1Z19wcmludGYgcHJpbnRmCisjZW5kaWYKKwordHJhbnNwb3J0
X2xheWVyX3BpcGVzOjp0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKEhBTkRMRSBu
ZXdfcGlwZSkKK3sKKyAgcGlwZSA9IG5ld19waXBlOworICBpZiAoaW5pdGVk
ICE9IHRydWUpCisgICAgaW5pdF9zZWN1cml0eSgpOworfTsKKwordHJhbnNw
b3J0X2xheWVyX3BpcGVzOjp0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKCkgCit7
CisgIHBpcGUgPSBOVUxMOworICBzdHJjcHkocGlwZV9uYW1lLCAiXFxcXC5c
XHBpcGVcXGN5Z3dpbl9scGMiKTsKKyAgaWYgKGluaXRlZCAhPSB0cnVlKQor
ICAgIGluaXRfc2VjdXJpdHkoKTsKK30KKworCit2b2lkCit0cmFuc3BvcnRf
bGF5ZXJfcGlwZXM6OmluaXRfc2VjdXJpdHkoKQoreworICAvKiBGSVhNRTog
cHRocmVhZF9vbmNlIG9yIGVxdWl2YWxlbnQgbmVlZGVkICovCisgIEluaXRp
YWxpemVTZWN1cml0eURlc2NyaXB0b3IgKCZzZCwgU0VDVVJJVFlfREVTQ1JJ
UFRPUl9SRVZJU0lPTik7CisgIFNldFNlY3VyaXR5RGVzY3JpcHRvckRhY2wg
KCZzZCwgVFJVRSwgMCwgRkFMU0UpOworCisgIHNlY19ub25lX25paC5uTGVu
Z3RoID0gc2VjX2FsbF9uaWgubkxlbmd0aCA9IHNpemVvZiAoU0VDVVJJVFlf
QVRUUklCVVRFUyk7CisgIHNlY19ub25lX25paC5iSW5oZXJpdEhhbmRsZSA9
IHNlY19hbGxfbmloLmJJbmhlcml0SGFuZGxlID0gRkFMU0U7CisgIHNlY19u
b25lX25paC5scFNlY3VyaXR5RGVzY3JpcHRvciA9IE5VTEw7CisgIHNlY19h
bGxfbmloLmxwU2VjdXJpdHlEZXNjcmlwdG9yID0gJnNkOworICBpbml0ZWQg
PSB0cnVlOworfQorCit2b2lkCit0cmFuc3BvcnRfbGF5ZXJfcGlwZXM6Omxp
c3RlbiAoKQoreworICAvKiBuby1vcCAqLworfQorCitjbGFzcyB0cmFuc3Bv
cnRfbGF5ZXJfcGlwZXMgKgordHJhbnNwb3J0X2xheWVyX3BpcGVzOjphY2Nl
cHQgKCkKK3sKKyAgaWYgKHBpcGUpCisgICAgeworICAgICAgZGVidWdfcHJp
bnRmICgiQWxyZWFkeSBoYXZlIGEgcGlwZSBpbiB0aGlzICVwXG4iLHRoaXMp
OworICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIHBpcGUgPSBDcmVh
dGVOYW1lZFBpcGUgKHBpcGVfbmFtZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgUElQRV9BQ0NFU1NfRFVQTEVYLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICBQSVBFX1RZUEVfQllURSB8IFBJUEVfV0FJVCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgUElQRV9VTkxJTUlURURfSU5TVEFOQ0VTLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAwLCAxMDAwLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAmc2VjX2FsbF9uaWggKTsKKyAgaWYgKHBp
cGUgPT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgeworICAgICAgZGVi
dWdfcHJpbnRmICgiZXJyb3IgY3JlYXRpbmcgcGlwZSAoJWx1KVxuLiIsIEdl
dExhc3RFcnJvciAoKSk7CisgICAgICByZXR1cm4gTlVMTDsKKyAgICB9CisK
KyAgaWYgKCAhQ29ubmVjdE5hbWVkUGlwZSAoIHBpcGUsIE5VTEwgKSAmJgor
ICAgICBHZXRMYXN0RXJyb3IgKCkgIT0gRVJST1JfUElQRV9DT05ORUNURUQp
CisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgY29ubmVjdGluZyB0byBw
aXBlICglbHUpXG4uIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIENsb3Nl
SGFuZGxlIChwaXBlKTsKKyAgICAgIHBpcGUgPSBOVUxMOworICAgICAgcmV0
dXJuIE5VTEw7CisgICAgfQorICAKKyAgdHJhbnNwb3J0X2xheWVyX3BpcGVz
ICpuZXdfY29ubiA9IG5ldyB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKHBpcGUp
OworICBwaXBlID0gTlVMTDsKKworICByZXR1cm4gbmV3X2Nvbm47ICAKK30K
Kwordm9pZAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjpjbG9zZSgpCit7Cisg
IGlmIChwaXBlICYmIHBpcGUgIT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisg
ICAgeworICAgICAgRmx1c2hGaWxlQnVmZmVycyAocGlwZSk7CisgICAgICBE
aXNjb25uZWN0TmFtZWRQaXBlIChwaXBlKTsKKyAgICAgIENsb3NlSGFuZGxl
IChwaXBlKTsKKyAgICB9Cit9CisKK3NzaXplX3QKK3RyYW5zcG9ydF9sYXll
cl9waXBlczo6cmVhZCAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQoreworICBE
V09SRCBieXRlc19yZWFkLCByYzsKKyAgaWYgKCFwaXBlIHx8IHBpcGUgPT0g
SU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgcmV0dXJuIC0xOworCisgIHJj
ID0gUmVhZEZpbGUgKHBpcGUsIGJ1ZiwgbGVuLCAmYnl0ZXNfcmVhZCwgTlVM
TCk7CisgIGlmICghcmMpCisgICAgeworICAgICAgZGVidWdfcHJpbnRmICgi
ZXJyb3IgcmVhZGluZyBmcm9tIHBpcGUgKCVsdSlcbiIsIEdldExhc3RFcnJv
ciAoKSk7CisgICAgICByZXR1cm4gLTE7CisgICAgfQorICByZXR1cm4gYnl0
ZXNfcmVhZDsKK30KKworc3NpemVfdAordHJhbnNwb3J0X2xheWVyX3BpcGVz
Ojp3cml0ZSAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQoreworICBEV09SRCBi
eXRlc193cml0dGVuLCByYzsKKyAgaWYgKCFwaXBlIHx8IHBpcGUgPT0gSU5W
QUxJRF9IQU5ETEVfVkFMVUUpCisgICAgcmV0dXJuIC0xOworCisgIHJjID0g
V3JpdGVGaWxlIChwaXBlLCBidWYsIGxlbiwgJmJ5dGVzX3dyaXR0ZW4sIE5V
TEwpOworICBpZiAoIXJjKQorICAgIHsKKyAgICAgIGRlYnVnX3ByaW50ZiAo
ImVycm9yIHdyaXRpbmcgdG8gcGlwZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9y
ICgpKTsKKyAgICAgIHJldHVybiAtMTsKKyAgICB9CisgIHJldHVybiBieXRl
c193cml0dGVuOworfQorCitib29sCit0cmFuc3BvcnRfbGF5ZXJfcGlwZXM6
OmNvbm5lY3QgKCkKK3sKKyAgaWYgKHBpcGUgJiYgcGlwZSAhPSBJTlZBTElE
X0hBTkRMRV9WQUxVRSkKKyAgICB7CisgICAgICBkZWJ1Z19wcmludGYgKCJB
bHJlYWR5IGhhdmUgYSBwaXBlIGluIHRoaXMgJXBcbiIsdGhpcyk7CisgICAg
ICByZXR1cm4gZmFsc2U7CisgICAgfQorCisgIHdoaWxlICgxKQorICAgIHsK
KyAgICAgIHBpcGUgPSBDcmVhdGVGaWxlIChwaXBlX25hbWUsCisJCSAgICAg
ICAgIEdFTkVSSUNfUkVBRCB8IEdFTkVSSUNfV1JJVEUsCisJCSAgICAgICAg
IEZJTEVfU0hBUkVfUkVBRCB8IEZJTEVfU0hBUkVfV1JJVEUsCisJCSAgICAg
ICAgICZzZWNfYWxsX25paCwKKwkJICAgICAgICAgT1BFTl9FWElTVElORywK
KwkJICAgICAgICAgMCwgTlVMTCk7CisKKyAgICAgIGlmIChwaXBlICE9IElO
VkFMSURfSEFORExFX1ZBTFVFKQorCS8qIGdvdCB0aGUgcGlwZSAqLworICAg
ICAgICByZXR1cm4gdHJ1ZTsKKworICAgICAgaWYgKEdldExhc3RFcnJvciAo
KSAhPSBFUlJPUl9QSVBFX0JVU1kpCisgICAgICAgIHsKKyAgICAgICAgICBk
ZWJ1Z19wcmludGYgKCJFcnJvciBvcGVuaW5nIHRoZSBwaXBlICglbHUpXG4i
LCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgICAgIHBpcGUgPSBOVUxMOwor
ICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgfQorICAgICAgaWYg
KCFXYWl0TmFtZWRQaXBlIChwaXBlX25hbWUsIDIwMDAwKSkKKyAgICAgICAg
ZGVidWdfcHJpbnRmICggImVycm9yIGNvbm5lY3RpbmcgdG8gc2VydmVyIHBp
cGUgYWZ0ZXIgMjAgc2Vjb25kcyAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgp
ICk7CisgICAgICAvKiBXZSBsb29wIGhlcmUsIGJlY2F1c2UgdGhlIHBpcGUg
ZXhpc3RzIGJ1dCBpcyBidXN5LiBJZiBpdCBkb2Vzbid0IGV4aXN0CisgICAg
ICAgKiB0aGUgIT0gRVJST1JfUElQRV9CVVNZIHdpbGwgY2F0Y2ggaXQuCisg
ICAgICAgKi8gCisgICAgfQorfQorCit2b2lkCit0cmFuc3BvcnRfbGF5ZXJf
cGlwZXM6OmltcGVyc29uYXRlX2NsaWVudCAoKQoreworICBpZiAocGlwZSAm
JiBwaXBlICE9IElOVkFMSURfSEFORExFX1ZBTFVFKQorICAgIEltcGVyc29u
YXRlTmFtZWRQaXBlQ2xpZW50IChwaXBlKTsKKyAgZGVidWdfcHJpbnRmKCJJ
IGFtIHdobyB5b3UgYXJlXG4iKTsKK30KKwordm9pZAordHJhbnNwb3J0X2xh
eWVyX3BpcGVzOjpyZXZlcnRfdG9fc2VsZiAoKQoreworICBSZXZlcnRUb1Nl
bGYgKCk7IAorICBkZWJ1Z19wcmludGYoIkkgYW0gd2hvIEkgeWFtXG4iKTsK
K30KKwpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnd2luLmRpbgpkaWZm
IC11IHNyYy93aW5zdXAvY3lnd2luL2N5Z3dpbi5kaW46MS4zNyBzcmMvd2lu
c3VwL2N5Z3dpbi9jeWd3aW4uZGluOjEuMzcuMi4xCi0tLSBzcmMvd2luc3Vw
L2N5Z3dpbi9jeWd3aW4uZGluOjEuMzcJV2VkIFNlcCAxOSAxMTowNzoxMCAy
MDAxCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWd3aW4uZGluCU1vbiBTZXAg
MjQgMjI6NDk6MTAgMjAwMQpAQCAtMTIyMCwzICsxMjIwLDcgQEAKIF9hY2x0
b3RleHQgPSBhY2x0b3RleHQKIGFjbGZyb210ZXh0CiBfYWNsZnJvbXRleHQg
PSBhY2xmcm9tdGV4dAorZnRvaworc2htYXQKK3NobWN0bAorc2htZ2V0Cklu
ZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9kY3J0MC5jYwpkaWZmIC11IHNyYy93
aW5zdXAvY3lnd2luL2RjcnQwLmNjOjEuMTEyIHNyYy93aW5zdXAvY3lnd2lu
L2RjcnQwLmNjOjEuMTEyLjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3aW4vZGNy
dDAuY2M6MS4xMTIJU2F0IFNlcCAxNSAxNDozNjo0MyAyMDAxCisrKyBzcmMv
d2luc3VwL2N5Z3dpbi9kY3J0MC5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIw
MDEKQEAgLTM0LDYgKzM0LDkgQEAKICNpbmNsdWRlICJzaGFyZWRfaW5mby5o
IgogI2luY2x1ZGUgImN5Z3dpbl92ZXJzaW9uLmgiCiAjaW5jbHVkZSAiZGxs
X2luaXQuaCIKKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CisjaW5jbHVkZSAi
Y3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnQuaCIKKyNpbmNsdWRlICJjeWd3
aW4vY3lnc2VydmVyLmgiCiAKICNkZWZpbmUgTUFYX0FUX0ZJTEVfTEVWRUwg
MTAKIApAQCAtNjg3LDYgKzY5MCw4IEBACiAKICAgLyogSW5pdGlhbGl6ZSBz
aWduYWwvc3VicHJvY2VzcyBoYW5kbGluZy4gKi8KICAgc2lncHJvY19pbml0
ICgpOworCisgIGN5Z3NlcnZlcl9pbml0ICgpOwogCiAgIC8qIENvbm5lY3Qg
dG8gdHR5LiAqLwogICB0dHlfaW5pdCAoKTsKSW5kZXg6IHNyYy93aW5zdXAv
Y3lnd2luL2ZoYW5kbGVyLmgKZGlmZiAtdSBzcmMvd2luc3VwL2N5Z3dpbi9m
aGFuZGxlci5oOjEuODIgc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaDox
LjgyLjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaDoxLjgy
CVN1biBTZXAgMjMgMDc6NDQ6MDcgMjAwMQorKysgc3JjL3dpbnN1cC9jeWd3
aW4vZmhhbmRsZXIuaAlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTgz
NSw2ICs4MzUsOCBAQAogICBvZmZfdCBsc2VlayAob2ZmX3QsIGludCkgeyBy
ZXR1cm4gMDsgfQogICBzZWxlY3RfcmVjb3JkICpzZWxlY3RfcmVhZCAoc2Vs
ZWN0X3JlY29yZCAqcyk7CiAgIGludCByZWFkeV9mb3JfcmVhZCAoaW50IGZk
LCBEV09SRCBob3dsb25nLCBpbnQgaWducmEpOworCisgIGludCBjeWdzZXJ2
ZXJfYXR0YWNoX3R0eSAoSEFORExFKiwgSEFORExFKik7CiB9OwogCiBjbGFz
cyBmaGFuZGxlcl9wdHlfbWFzdGVyOiBwdWJsaWMgZmhhbmRsZXJfdHR5X2Nv
bW1vbgpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfdHR5LmNj
CmRpZmYgLXUgc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfdHR5LmNjOjEu
NDggc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfdHR5LmNjOjEuNDguMi4x
Ci0tLSBzcmMvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl90dHkuY2M6MS40OAlG
cmkgU2VwIDIxIDA2OjU4OjI5IDIwMDEKKysrIHNyYy93aW5zdXAvY3lnd2lu
L2ZoYW5kbGVyX3R0eS5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAg
LTI1LDYgKzI1LDkgQEAKICNpbmNsdWRlICJwaW5mby5oIgogI2luY2x1ZGUg
ImN5Z2hlYXAuaCIKICNpbmNsdWRlICJzaGFyZWRfaW5mby5oIgorI2luY2x1
ZGUgPHN5cy9zb2NrZXQuaD4KKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVy
X3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIK
IAogLyogVHR5IG1hc3RlciBzdHVmZiAqLwogCkBAIC01MjMsNDIgKzUyNiw4
OSBAQAogICAgICAgcmV0dXJuIDA7CiAgICAgfQogCi0gIEhBTkRMRSB0dHlf
b3duZXIgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19EVVBfSEFORExFLCBGQUxT
RSwKLQkJCQkgICAgIGdldF90dHlwICgpLT5tYXN0ZXJfcGlkKTsKLSAgaWYg
KHR0eV9vd25lciA9PSBOVUxMKQotICAgIHsKLSAgICAgIHRlcm1pb3NfcHJp
bnRmICgiY2FuJ3Qgb3BlbiB0dHkgKCVkKSBoYW5kbGUgcHJvY2VzcyAlZCIs
Ci0JCSAgICAgIHR0eW51bSwgZ2V0X3R0eXAgKCktPm1hc3Rlcl9waWQpOwot
ICAgICAgX19zZXRlcnJubyAoKTsKLSAgICAgIHJldHVybiAwOwotICAgIH0K
KyAgSEFORExFIGZyb21fbWFzdGVyX2xvY2FsLCB0b19tYXN0ZXJfbG9jYWw7
CiAKLSAgSEFORExFIG5oOwotICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAodHR5
X293bmVyLCBnZXRfdHR5cCAoKS0+ZnJvbV9tYXN0ZXIsIGhNYWluUHJvYywg
Jm5oLCAwLCBUUlVFLAotCQkJRFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKLSAg
ICB7Ci0gICAgICB0ZXJtaW9zX3ByaW50ZiAoImNhbid0IGR1cGxpY2F0ZSBp
bnB1dCwgJUUiKTsKLSAgICAgIF9fc2V0ZXJybm8gKCk7Ci0gICAgICByZXR1
cm4gMDsKLSAgICB9Ci0gIHNldF9pb19oYW5kbGUgKG5oKTsKLSAgUHJvdGVj
dEhhbmRsZTEgKG5oLCBmcm9tX3B0eSk7Ci0gIHRlcm1pb3NfcHJpbnRmICgi
ZHVwbGljYXRlZCBmcm9tX21hc3RlciAlcC0+JXAgZnJvbSB0dHlfb3duZXIg
JXAiLAotCQkgIGdldF90dHlwICgpLT5mcm9tX21hc3RlciwgbmgsIHR0eV9v
d25lcik7Ci0gIGlmICghRHVwbGljYXRlSGFuZGxlICh0dHlfb3duZXIsIGdl
dF90dHlwICgpLT50b19tYXN0ZXIsIGhNYWluUHJvYywgJm5oLCAwLCBUUlVF
LAotCQkJRFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKLSAgICB7Ci0gICAgICB0
ZXJtaW9zX3ByaW50ZiAoImNhbid0IGR1cGxpY2F0ZSBvdXRwdXQsICVFIik7
Ci0gICAgICBfX3NldGVycm5vICgpOwotICAgICAgcmV0dXJuIDA7Ci0gICAg
fQotICBzZXRfb3V0cHV0X2hhbmRsZSAobmgpOwotICBQcm90ZWN0SGFuZGxl
MSAobmgsIHRvX3B0eSk7Ci0gIENsb3NlSGFuZGxlICh0dHlfb3duZXIpOwor
ICBpZiAoIXdpbmNhcC5oYXNfc2VjdXJpdHkgKCkgfHwKKyAgICAgIGN5Z3Nl
cnZlcl9ydW5uaW5nIT1DWUdTRVJWRVJfT0sgfHwKKyAgICAgICFjeWdzZXJ2
ZXJfYXR0YWNoX3R0eSAoICZmcm9tX21hc3Rlcl9sb2NhbCwgJnRvX21hc3Rl
cl9sb2NhbCkpCisgICAgeworICAgICAgdGVybWlvc19wcmludGYgKCJjYW5u
b3QgZHVwIGhhbmRsZXMgdmlhIHNlcnZlci4gdXNpbmcgb2xkIG1ldGhvZC4i
KTsKKworICAgICAgSEFORExFIHR0eV9vd25lciA9IE9wZW5Qcm9jZXNzIChQ
Uk9DRVNTX0RVUF9IQU5ETEUsIEZBTFNFLAorCQkJCSAgICAgICAgIGdldF90
dHlwICgpLT5tYXN0ZXJfcGlkKTsKKyAgICAgIGlmICh0dHlfb3duZXIgPT0g
TlVMTCkKKyAgICAgICAgeworICAgICAgICAgIHRlcm1pb3NfcHJpbnRmICgi
Y2FuJ3Qgb3BlbiB0dHkgKCVkKSBoYW5kbGUgcHJvY2VzcyAlZCIsCisJIAkg
ICAgICAgICAgdHR5bnVtLCBnZXRfdHR5cCAoKS0+bWFzdGVyX3BpZCk7Cisg
ICAgICAgICAgX19zZXRlcnJubyAoKTsKKyAgICAgICAgICByZXR1cm4gMDsK
KyAgICAgICAgfQorCisgICAgICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAodHR5
X293bmVyLCBnZXRfdHR5cCAoKS0+ZnJvbV9tYXN0ZXIsIAorCQkJICBoTWFp
blByb2MsICZmcm9tX21hc3Rlcl9sb2NhbCwgMCwgVFJVRSwKKwkJCSAgICBE
VVBMSUNBVEVfU0FNRV9BQ0NFU1MpKQorICAgICAgICB7CisgICAgICAgICAg
dGVybWlvc19wcmludGYgKCJjYW4ndCBkdXBsaWNhdGUgaW5wdXQsICVFIik7
CisgICAgICAgICAgX19zZXRlcnJubyAoKTsKKyAgICAgICAgICByZXR1cm4g
MDsKKyAgICAgICAgfQorICAgICAgdGVybWlvc19wcmludGYgKCJkdXBsaWNh
dGVkIGZyb21fbWFzdGVyICVwLT4lcCBmcm9tIHR0eV9vd25lciAlcCIsCisJ
CSAgICAgZ2V0X3R0eXAgKCktPmZyb21fbWFzdGVyLCBmcm9tX21hc3Rlcl9s
b2NhbCwgdHR5X293bmVyKTsKKworICAgICAgaWYgKCFEdXBsaWNhdGVIYW5k
bGUgKHR0eV9vd25lciwgZ2V0X3R0eXAgKCktPnRvX21hc3RlciwgCisJCQkg
IGhNYWluUHJvYywgJnRvX21hc3Rlcl9sb2NhbCwgMCwgVFJVRSwKKwkJCSAg
RFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKKyAgICAgICAgeworICAgICAgICAg
IHRlcm1pb3NfcHJpbnRmICgiY2FuJ3QgZHVwbGljYXRlIG91dHB1dCwgJUUi
KTsKKyAgICAgICAgICBfX3NldGVycm5vICgpOworICAgICAgICAgIHJldHVy
biAwOworICAgICAgICB9CisgICAgICB0ZXJtaW9zX3ByaW50ZiAoImR1cGxp
Y2F0ZWQgdG9fbWFzdGVyICVwLT4lcCBmcm9tIHR0eV9vd25lciAlcCIsCisg
ICAgICAJCSAgICAgZ2V0X3R0eXAgKCktPnRvX21hc3RlciwgdG9fbWFzdGVy
X2xvY2FsLCB0dHlfb3duZXIpOworICAgICAgQ2xvc2VIYW5kbGUgKHR0eV9v
d25lcik7CisgICAgfQorCisgIHNldF9pb19oYW5kbGUgKGZyb21fbWFzdGVy
X2xvY2FsKTsKKyAgUHJvdGVjdEhhbmRsZTEgKGZyb21fbWFzdGVyX2xvY2Fs
LCBmcm9tX3B0eSk7CisgIHNldF9vdXRwdXRfaGFuZGxlICh0b19tYXN0ZXJf
bG9jYWwpOworICBQcm90ZWN0SGFuZGxlMSAodG9fbWFzdGVyX2xvY2FsLCB0
b19wdHkpOwogCiAgIHNldF9vcGVuX3N0YXR1cyAoKTsKICAgdGVybWlvc19w
cmludGYgKCJ0dHklZCBvcGVuZWQiLCB0dHludW0pOwogCisgIHJldHVybiAx
OworfQorCitpbnQKK2ZoYW5kbGVyX3R0eV9zbGF2ZTo6Y3lnc2VydmVyX2F0
dGFjaF90dHkgKExQSEFORExFIGZyb21fbWFzdGVyX3B0ciwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMUEhBTkRMRSB0b19t
YXN0ZXJfcHRyKQoreworICBpZiAoIWZyb21fbWFzdGVyX3B0ciB8fCAhdG9f
bWFzdGVyX3B0cikKKyAgICByZXR1cm4gMDsKKworICBjbGllbnRfcmVxdWVz
dF9hdHRhY2hfdHR5ICpyZXF1ZXN0ID0gCisJbmV3IGNsaWVudF9yZXF1ZXN0
X2F0dGFjaF90dHkgKChEV09SRCkgR2V0Q3VycmVudFByb2Nlc3NJZCAoKSwK
KwkJCQkgICAgICAoRFdPUkQpIGdldF90dHlwICgpLT5tYXN0ZXJfcGlkLAor
CQkJCSAgICAgIChIQU5ETEUpIGdldF90dHlwICgpLT5mcm9tX21hc3RlciwK
KwkJCQkgICAgICAoSEFORExFKSBnZXRfdHR5cCAoKS0+dG9fbWFzdGVyKTsK
KworICBpZiAoY3lnc2VydmVyX3JlcXVlc3QgKHJlcXVlc3QpICE9IDAgfHwK
KwlyZXF1ZXN0LT5oZWFkZXIuZXJyb3JfY29kZSAhPSAwKQorICAgIHJldHVy
biAwOworCisvKgorICBzdHJ1Y3QgcmVxdWVzdF9hdHRhY2hfdHR5IHJlcTsK
KyAgSU5JVF9SRVFVRVNUIChyZXEsIENZR1NFUlZFUl9SRVFVRVNUX0FUVEFD
SF9UVFkpOworICByZXEucGlkID0gR2V0Q3VycmVudFByb2Nlc3NJZCAoKTsK
KyAgcmVxLm1hc3Rlcl9waWQgPSBnZXRfdHR5cCAoKS0+bWFzdGVyX3BpZDsK
KyAgcmVxLmZyb21fbWFzdGVyID0gZ2V0X3R0eXAgKCktPmZyb21fbWFzdGVy
OworICByZXEudG9fbWFzdGVyID0gZ2V0X3R0eXAgKCktPnRvX21hc3RlcjsK
KyAgaWYgKGN5Z3NlcnZlcl9yZXF1ZXN0ICgoc3RydWN0IHJlcXVlc3RfaGVh
ZGVyKikgJnJlcSkgIT0gMCkKKyAgICByZXR1cm4gMDsKKyovCisgICpmcm9t
X21hc3Rlcl9wdHIgPSByZXF1ZXN0LT5mcm9tX21hc3RlciAoKTsKKyAgKnRv
X21hc3Rlcl9wdHIgPSByZXF1ZXN0LT50b19tYXN0ZXIgKCk7CisgIGRlbGV0
ZSByZXF1ZXN0OwogICByZXR1cm4gMTsKIH0KIApJbmRleDogc3JjL3dpbnN1
cC9jeWd3aW4vZm9yay5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL2Zv
cmsuY2M6MS42OCBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjOjEuNjguMi4x
Ci0tLSBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjOjEuNjgJU3VuIFNlcCAy
MyAwMjo1NTowMiAyMDAxCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNj
CU1vbiBTZXAgMjQgMjI6NDk6MTAgMjAwMQpAQCAtMzAyLDYgKzMwMiw5IEBA
CiAgIGlmIChmaXh1cF9tbWFwc19hZnRlcl9mb3JrICgpKQogICAgIGFwaV9m
YXRhbCAoInJlY3JlYXRlX21tYXBzX2FmdGVyX2ZvcmtfZmFpbGVkIik7CiAK
KyAgaWYgKGZpeHVwX3NobXNfYWZ0ZXJfZm9yayAoKSkKKyAgICBhcGlfZmF0
YWwgKCJyZWNyZWF0ZV9zaG0gYXJlYXMgYWZ0ZXIgZm9yayBmYWlsZWQiKTsK
KwogICAvKiBTZXQgdGhyZWFkIGxvY2FsIHN0dWZmIHRvIHplcm8uICBVbmRl
ciBXaW5kb3dzIDk1Lzk4IHRoaXMgaXMgc29tZXRpbWVzCiAgICAgIG5vbi16
ZXJvLCBmb3Igc29tZSByZWFzb24uCiAgICAgIEZJWE1FOiAgVGhlcmUgaXMg
YSBtZW1vcnkgbGVhayBoZXJlIGFmdGVyIGEgZm9yay4gKi8KSW5kZXg6IHNy
Yy93aW5zdXAvY3lnd2luL2lwYy5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMv
d2luc3VwL2N5Z3dpbi9pcGMuY2M6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlU
aHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2lu
L2lwYy5jYwlNb24gU2VwIDI0IDIyOjQ5OjEwIDIwMDEKQEAgLTAsMCArMSwz
OSBAQAorLyogaXBjLmNjOiBTaW5nbGUgdW5peCBzcGVjaWZpY2F0aW9uIElQ
QyBpbnRlcmZhY2UgZm9yIEN5Z3dpbgorCisgICBDb3B5cmlnaHQgMjAwMSBS
ZWQgSGF0LCBJbmMuCisKKyAgIE9yaWdpbmFsbHkgd3JpdHRlbiBieSBSb2Jl
cnQgQ29sbGlucyA8cm9iZXJ0LmNvbGxpbnNAaG90bWFpbC5jb20+CisKKyAg
IFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0
d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZQorICAgQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29u
c3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorICAgZGV0YWls
cy4gKi8KKworI2luY2x1ZGUgIndpbnN1cC5oIgorI2luY2x1ZGUgPHN5cy9p
cGMuaD4KKyNpbmNsdWRlIDxzeXMvc3RhdC5oPgorCitleHRlcm4gIkMiCit7
CisKKy8qIE5vdGVzOiB3ZSByZXR1cm4gYSB2YWxpZCBrZXkgZXZlbiBpZiBp
ZCdzIGxvdyBvcmRlciA4IGJpdHMgYXJlIDAuICovCitrZXlfdAorZnRvayhj
b25zdCBjaGFyICpwYXRoLCBpbnQgaWQpCit7CisgIHN0cnVjdCBzdGF0IHN0
YXRidWY7CisgIGlmIChzdGF0KHBhdGgsICZzdGF0YnVmKSkKKyAgICB7Cisg
ICAgICAvKiBzdGF0IHNldCB0aGUgYXBwcm9wcmlhdGUgZXJybm8gZm9yIHVz
ICovCisgICAgICByZXR1cm4gKGtleV90KSAtMTsKKyAgICB9CisgIAorICAv
KiBkZXZfdCBpcyBzaG9ydCBmb3IgY3lnd2luIAorICAgKiBpbm9fdCBpcyBs
b25nIGZvciBjeWd3aW4KKyAgICogYW5kIHdlIG5lZWQgOCBiaXRzIGZvciB0
aGUgaWQuCisgICAqIHRodXMga2V5X3QgaXMgbG9uZyBsb25nLiAKKyAgICov
CisgIHJldHVybiAoKGxvbmcgbG9uZykgc3RhdGJ1Zi5zdF9kZXYgPDwgKDUq
OCkpIHwgKHN0YXRidWYuc3RfaW5vIDw8ICg4KSApIHwgKGlkICYgMHgwMGZm
KTsKK30KKworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vcGluZm8uaApk
aWZmIC11IHNyYy93aW5zdXAvY3lnd2luL3BpbmZvLmg6MS4zMSBzcmMvd2lu
c3VwL2N5Z3dpbi9waW5mby5oOjEuMzEuMi4xCi0tLSBzcmMvd2luc3VwL2N5
Z3dpbi9waW5mby5oOjEuMzEJVGh1IFNlcCAxMyAwMzo0NjozNiAyMDAxCisr
KyBzcmMvd2luc3VwL2N5Z3dpbi9waW5mby5oCU1vbiBTZXAgMjQgMjI6NDk6
MTAgMjAwMQpAQCAtMjAxLDYgKzIwMSw4IEBACiAKIC8qIEZvciBtbWFwcyBh
Y3Jvc3MgZm9yaygpLiAqLwogaW50IF9fc3RkY2FsbCBmaXh1cF9tbWFwc19h
ZnRlcl9mb3JrICgpOworLyogZm9yIHNobSBhcmVhcyBhY3Jvc3MgZm9yayAo
KS4gKi8KK2ludCBfX3N0ZGNhbGwgZml4dXBfc2htc19hZnRlcl9mb3JrICgp
OwogCiB2b2lkIF9fc3RkY2FsbCBmaWxsX3J1c2FnZSAoc3RydWN0IHJ1c2Fn
ZSAqLCBIQU5ETEUpOwogdm9pZCBfX3N0ZGNhbGwgYWRkX3J1c2FnZSAoc3Ry
dWN0IHJ1c2FnZSAqLCBzdHJ1Y3QgcnVzYWdlICopOwpJbmRleDogc3JjL3dp
bnN1cC9jeWd3aW4vc2VjdXJpdHkuaApkaWZmIC11IHNyYy93aW5zdXAvY3ln
d2luL3NlY3VyaXR5Lmg6MS4xNiBzcmMvd2luc3VwL2N5Z3dpbi9zZWN1cml0
eS5oOjEuMTYuNC4xCi0tLSBzcmMvd2luc3VwL2N5Z3dpbi9zZWN1cml0eS5o
OjEuMTYJU2F0IFNlcCAgOCAwNzozMjowNSAyMDAxCisrKyBzcmMvd2luc3Vw
L2N5Z3dpbi9zZWN1cml0eS5oCU1vbiBTZXAgMjQgMjI6NDk6MTAgMjAwMQpA
QCAtMjA0LDMgKzIwNCw1IEBACiAKIGludCBfX3N0ZGNhbGwgTlRSZWFkRUEg
KGNvbnN0IGNoYXIgKmZpbGUsIGNvbnN0IGNoYXIgKmF0dHJuYW1lLCBjaGFy
ICpidWYsIGludCBsZW4pOwogQk9PTCBfX3N0ZGNhbGwgTlRXcml0ZUVBIChj
b25zdCBjaGFyICpmaWxlLCBjb25zdCBjaGFyICphdHRybmFtZSwgY29uc3Qg
Y2hhciAqYnVmLCBpbnQgbGVuKTsKK1BTRUNVUklUWV9ERVNDUklQVE9SIGFs
bG9jX3NkICh1aWRfdCB1aWQsIGdpZF90IGdpZCwgY29uc3QgY2hhciAqbG9n
c3J2LCBpbnQgYXR0cmlidXRlLAorICAgICAgICAgIFBTRUNVUklUWV9ERVND
UklQVE9SIHNkX3JldCwgRFdPUkQgKnNkX3NpemVfcmV0KTsKSW5kZXg6IHNy
Yy93aW5zdXAvY3lnd2luL3NobS5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMv
d2luc3VwL2N5Z3dpbi9zaG0uY2M6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlU
aHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2lu
L3NobS5jYwlNb24gU2VwIDI0IDIyOjQ5OjExIDIwMDEKQEAgLTAsMCArMSw0
NDYgQEAKKy8qIHNobS5jYzogU2luZ2xlIHVuaXggc3BlY2lmaWNhdGlvbiBJ
UEMgaW50ZXJmYWNlIGZvciBDeWd3aW4KKworICAgQ29weXJpZ2h0IDIwMDEg
UmVkIEhhdCwgSW5jLgorCisgICBPcmlnaW5hbGx5IHdyaXR0ZW4gYnkgUm9i
ZXJ0IENvbGxpbnMgPHJvYmVydC5jb2xsaW5zQGhvdG1haWwuY29tPgorCisg
ICBUaGlzIGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29m
dHdhcmUgaXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRo
ZSB0ZXJtcyBvZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNv
bnN1bHQgdGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFp
bHMuICovCisKKyNpbmNsdWRlICJ3aW5zdXAuaCIKKyNpbmNsdWRlIDxzeXMv
c3RhdC5oPgorI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSAiY3lnZXJy
bm8uaCIKKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNsdWRlICJzZWN1cml0
eS5oIgorI2luY2x1ZGUgImZoYW5kbGVyLmgiCisjaW5jbHVkZSAiZHRhYmxl
LmgiCisjaW5jbHVkZSAiY3lnaGVhcC5oIgorI2luY2x1ZGUgPHN0ZGlvLmg+
CisjaW5jbHVkZSAidGhyZWFkLmgiCisjaW5jbHVkZSA8c3lzL3NobS5oPgor
I2luY2x1ZGUgInBlcnByb2Nlc3MuaCIKKyNpbmNsdWRlICJjeWdzZXJ2ZXJf
c2htLmgiCisKKy8vIEZJWE1FIElTIFRISVMgQ09SUkVDVAorLyogSW1wbGVt
ZW50YXRpb24gbm90ZXM6IFdlIHVzZSB0d28gc2hhcmVkIG1lbW9yeSByZWdp
b25zIHBlciBrZXk6CisgKiBPbmUgZm9yIHRoZSBjb250cm9sIHN0cnVjdHVy
ZSwgYW5kIG9uZSBmb3IgdGhlIHNoYXJlZCBtZW1vcnkuCisgKiBXaGlsZSB0
aGlzIGhhcyBhIGhpZ2hlciBvdmVyaGVhZCB0aGFtIGEgc2luZ2xlIHNoYXJl
ZCBhcmVhLAorICogSXQgYWxsb3dzIG1vcmUgZmxleGFiaWxpdHkuIEFzIHRo
ZSBlbnRpcmUgY29kZSBpcyB0cmFuc3BhcmVudCB0byB0aGUgdXNlcgorICog
V2UgY2FuIG1lcmdlIHRoZXNlIGluIHRoZSBmdXR1cmUgc2hvdWxkIGl0IGJl
IG5lZWRlZC4KKyAqLworZXh0ZXJuICJDIiBzaXplX3QKK2dldHN5c3RlbWFs
bG9jZ3JhbnVsYXJpdHkgKCkKK3sKKyAgU1lTVEVNX0lORk8gc3lzaW5mbzsK
KyAgc3RhdGljIHNpemVfdCBidWZmZXJfb2Zmc2V0ID0gMDsKKyAgaWYgKGJ1
ZmZlcl9vZmZzZXQpCisgICAgcmV0dXJuIGJ1ZmZlcl9vZmZzZXQ7CisgIEdl
dFN5c3RlbUluZm8gKCZzeXNpbmZvKTsKKyAgYnVmZmVyX29mZnNldCA9IHN5
c2luZm8uZHdBbGxvY2F0aW9uR3JhbnVsYXJpdHk7CisgIHJldHVybiBidWZm
ZXJfb2Zmc2V0OworfQorCitzdGF0aWMgc2htbm9kZSAqc2htX2hlYWQgPSBO
VUxMOworCitzdGF0aWMgc2htbm9kZSAqCitidWlsZF9pbnByb2Nlc3Nfc2ht
ZHMgKEhBTkRMRSBoZmlsZW1hcCwgSEFORExFIGhhdHRhY2htYXAsIGtleV90
IGtleSwKKwkJICAgICAgIGludCBzaG1faWQpCit7CisgIEhBTkRMRSBmaWxl
bWFwID0gaGZpbGVtYXA7CisgIHZvaWQgKm1hcHB0ciA9IE1hcFZpZXdPZkZp
bGUgKGZpbGVtYXAsIEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKworICBp
ZiAoIW1hcHB0cikKKyAgICB7CisgICAgICBDbG9zZUhhbmRsZSAoaGZpbGVt
YXApOworICAgICAgQ2xvc2VIYW5kbGUgKGhhdHRhY2htYXApOworICAgICAg
Ly9GSVhNRTogY2xvc2UgZmlsZW1hcCBhbmQgZnJlZSB0aGUgbXV0ZXgKKyAg
ICAgIC8qIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgbWFwcGVkIGFyZWEgd2l0
aCB0aGUgcmVxdWVzdGVkIHBlcm1pc3Npb25zICovCisgICAgICBzZXRfZXJy
bm8gKEVBQ0NFUyk7CisgICAgICByZXR1cm4gTlVMTDsKKyAgICB9CisKKyAg
LyogTm93IGdldCB0aGUgdXNlciBkYXRhICovCisgIEhBTkRMRSBhdHRhY2ht
YXAgPSBoYXR0YWNobWFwOworICBzaG1pZF9kcyAqc2htdGVtcCA9IG5ldyBz
aG1pZF9kczsKKyAgaWYgKCFzaG10ZW1wKQorICAgIHsKKyAgICAgIHN5c3Rl
bV9wcmludGYgKCJmYWlsZWQgdG8gbWFsbG9jIHNobSBub2RlXG4iKTsKKyAg
ICAgIHNldF9lcnJubyAoRU5PTUVNKTsKKyAgICAgIFVubWFwVmlld09mRmls
ZSAobWFwcHRyKTsKKyAgICAgIENsb3NlSGFuZGxlIChmaWxlbWFwKTsKKyAg
ICAgIENsb3NlSGFuZGxlIChhdHRhY2htYXApOworICAgICAgLyogZXhpdCBt
dXRleCAqLworICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIC8qIGdl
dCB0aGUgc3lzdGVtIG5vZGUgZGF0YSAqLworICAqc2htdGVtcCA9ICooc2ht
aWRfZHMgKikgbWFwcHRyOworCisgIC8qIHByb2Nlc3MgbG9jYWwgZGF0YSAq
LworICBzaG1ub2RlICp0ZW1wbm9kZSA9IG5ldyBzaG1ub2RlOworCisgIHRl
bXBub2RlLT5maWxlbWFwID0gZmlsZW1hcDsKKyAgdGVtcG5vZGUtPmF0dGFj
aG1hcCA9IGF0dGFjaG1hcDsKKyAgc2htdGVtcC0+bWFwcHRyID0gbWFwcHRy
OworCisgIC8qIG5vIG5lZWQgZm9yIEludGVybG9ja2VkRXhjaGFuZ2UgaGVy
ZSwgd2UncmUgc2VyaWFsaXNlZCBieSB0aGUgZ2xvYmFsIG11dGV4ICovCisg
IHRlbXBub2RlLT5zaG1kcyA9IHNobXRlbXA7CisgIHRlbXBub2RlLT5zaG1f
aWQgPSBzaG1faWQ7CisgIHRlbXBub2RlLT5rZXkgPSBrZXk7CisgIHRlbXBu
b2RlLT5uZXh0ID0gc2htX2hlYWQ7CisgIHRlbXBub2RlLT5hdHRhY2hoZWFk
ID0gTlVMTDsKKyAgc2htX2hlYWQgPSB0ZW1wbm9kZTsKKworICAvKiBGSVhN
RTogbGVhdmUgdGhlIHN5c3RlbSB3aWRlIHNobSBtdXRleCAqLworCisgIHJl
dHVybiB0ZW1wbm9kZTsKK30KKworaW50IF9fc3RkY2FsbAorZml4dXBfc2ht
c19hZnRlcl9mb3JrICgpCit7CisgIHNobW5vZGUgKnRlbXBub2RlID0gc2ht
X2hlYWQ7CisgIHdoaWxlICh0ZW1wbm9kZSkKKyAgICB7CisgICAgICB2b2lk
ICpuZXdzaG1kcyA9CisJTWFwVmlld09mRmlsZSAodGVtcG5vZGUtPmZpbGVt
YXAsIEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKyAgICAgIGlmICghbmV3
c2htZHMpCisJeworCSAgLyogZG9uJ3Qgd29ycnkgYWJvdXQgaGFuZGxlIGNs
ZWFudXAsIHdlJ3JlIGR5aW5nISAqLworCSAgc3lzdGVtX3ByaW50ZigiZmFp
bGVkIHRvIHJlYXR0YWNoIHRvIHNobSBjb250cm9sIGZpbGUgdmlldyAleFxu
Iix0ZW1wbm9kZSk7CisJICByZXR1cm4gMTsKKwl9CisgICAgICB0ZW1wbm9k
ZS0+c2htZHMgPSAoY2xhc3Mgc2htaWRfZHMgKikgbmV3c2htZHM7CisgICAg
ICB0ZW1wbm9kZS0+c2htZHMtPm1hcHB0ciA9IG5ld3NobWRzOworICAgICAg
X3NobWF0dGFjaCAqYXR0YWNobm9kZSA9IHRlbXBub2RlLT5hdHRhY2hoZWFk
OworICAgICAgd2hpbGUgKGF0dGFjaG5vZGUpCisJeworCSAgdm9pZCAqbmV3
ZGF0YSA9IE1hcFZpZXdPZkZpbGVFeCAodGVtcG5vZGUtPmF0dGFjaG1hcCwK
KwkJCQkJICAgKGF0dGFjaG5vZGUtPnNobWZsZyAmIFNITV9SRE9OTFkpID8K
KwkJCQkJICAgRklMRV9NQVBfUkVBRCA6IEZJTEVfTUFQX1dSSVRFLCAwLAor
CQkJCQkgICAwLCAwLCBhdHRhY2hub2RlLT5kYXRhKTsKKwkgIGlmIChuZXdk
YXRhICE9IGF0dGFjaG5vZGUtPmRhdGEpCisJICAgIHsKKwkgICAgICAvKiBk
b24ndCB3b3JyeSBhYm91dCBoYW5kbGUgY2xlYW51cCwgd2UncmUgZHlpbmch
ICovCisJCXN5c3RlbV9wcmludGYoImZhaWxlZCB0byByZWF0dGFjaCB0byBt
YXBwZWQgZmlsZSB2aWV3ICV4XG4iLGF0dGFjaG5vZGUtPmRhdGEpOworCSAg
ICAgIHJldHVybiAxOworCSAgICB9CisJICBhdHRhY2hub2RlID0gYXR0YWNo
bm9kZS0+bmV4dDsKKwl9CisgICAgICB0ZW1wbm9kZSA9IHRlbXBub2RlLT5u
ZXh0OworICAgIH0KKyAgcmV0dXJuIDA7Cit9CisKKy8qIHRoaXMgaXMgdWds
eS4gWWVzLCBJIGtub3cgdGhhdC4KKyAqIEZJWE1FOiBhYnN0cmFjdCB0aGUg
bG9va3VwIGZ1bmN0aW9uYWxpdHksCisgKiBTbyB0aGF0IGl0IGNhbiBiZSBh
biBhcnJheSwgbGlzdCwgd2hhdGV2ZXIgd2l0aG91dCB1cyBiZWluZyB3b3Jy
aWVkCisgKi8KKworLyogRklYTUU6IGFmdGVyIGZvcmssIGV2ZXJ5IG1lbW9y
eSBhcmVhIG5lZWRzIHRvIGhhdmUgdGhlIGF0dGFjaCBjb3VudAorICogaW5j
cmVtZW50ZWQgYW5kIHRoZSBtYXBwaW5ncyBwb3RlbnRpYWxseSByZWVzdGFi
bGlzaGVkLCBwZXJoYXBzIGFsbG93aW5nCisgKiBpbmhlcml0IHdpbGwgd29y
az8hPworICovCisKKy8qIEZJWE1FOiBhcmUgaW5oZXJpdGVkIG1hcHBlZCBJ
UENfUFJJVkFURSBpZCdzIHNoYXJlZCBiZXR3ZWVuIHByb2Nlc3MncworICog
WUVTIGZyb20gbGludXguCisgKi8KKworZXh0ZXJuICJDIiB2b2lkICoKK3No
bWF0IChpbnQgc2htaWQsIGNvbnN0IHZvaWQgKnNobWFkZHIsIGludCBzaG1m
bGcpCit7CisgIHNobW5vZGUgKnRlbXBub2RlID0gc2htX2hlYWQ7CisgIHdo
aWxlICh0ZW1wbm9kZSAmJiB0ZW1wbm9kZS0+c2htX2lkICE9IHNobWlkKQor
ICAgIHRlbXBub2RlID0gdGVtcG5vZGUtPm5leHQ7CisKKyAgaWYgKCF0ZW1w
bm9kZSkKKyAgICB7CisgICAgICAvKiBjb3VsZG4ndCBmaW5kIGEgY3VycmVu
dGx5IG9wZW4gc2htIGNvbnRyb2wgYXJlYSBmb3IgdGhlIGtleSAtIHByb2Jh
Ymx5IGJlY2F1c2UKKyAgICAgICAqIHNobWdldCBoYXNuJ3QgYmVlbiBjYWxs
ZWQuIAorICAgICAgICogQWxsb2NhdGUgYSBuZXcgY29udHJvbCBibG9jayAt
IHRoaXMgaGFzIHRvIGJlIGhhbmRsZWQgYnkgdGhlIGRhZW1vbiAqLworICAg
ICAgY2xpZW50X3JlcXVlc3Rfc2htX2dldCAqcmVxID0KKwluZXcgY2xpZW50
X3JlcXVlc3Rfc2htX2dldCAoc2htaWQsIEdldEN1cnJlbnRQcm9jZXNzSWQg
KCkpOworCisgICAgICBpbnQgcmM7CisgICAgICBpZiAoKHJjID0gY3lnc2Vy
dmVyX3JlcXVlc3QgKHJlcSkpKQorCXsKKwkgIGRlbGV0ZSByZXE7CisJICBz
ZXRfZXJybm8gKEVOT1NZUyk7CS8qIGRhZW1vbiBjb21tdW5pY2F0aW9uIGZh
aWxlZCAqLworCSAgcmV0dXJuICh2b2lkICopIC0xOworCX0KKworICAgICAg
aWYgKHJlcS0+aGVhZGVyLmVycm9yX2NvZGUpCS8qIHNobV9nZXQgZmFpbGVk
IGluIHRoZSBkYWVtb24gKi8KKwl7CisJICBzZXRfZXJybm8gKHJlcS0+aGVh
ZGVyLmVycm9yX2NvZGUpOworCSAgZGVsZXRlIHJlcTsKKwkgIHJldHVybiAo
dm9pZCAqKSAtMTsKKwl9CisKKyAgICAgIC8qIHdlJ3ZlIGdvdCB0aGUgaWQs
IG5vdyB3ZSBvcGVuIHRoZSBtZW1vcnkgYXJlYSBvdXJzZWx2ZXMuCisgICAg
ICAgKiBUaGlzIHRlc3RzIHNlY3VyaXR5IGF1dG9tYWdpY2FsbHkKKyAgICAg
ICAqIEZJWE1FOiBtYWtlIHRoaXMgYSBtZXRob2Qgb2Ygc2htbm9kZSA/Cisg
ICAgICAgKi8KKyAgICAgIHRlbXBub2RlID0KKwlidWlsZF9pbnByb2Nlc3Nf
c2htZHMgKHJlcS0+cGFyYW1ldGVycy5vdXQuZmlsZW1hcCwKKwkJCSAgICAg
ICByZXEtPnBhcmFtZXRlcnMub3V0LmF0dGFjaG1hcCwKKwkJCSAgICAgICBy
ZXEtPnBhcmFtZXRlcnMub3V0LmtleSwKKwkJCSAgICAgICByZXEtPnBhcmFt
ZXRlcnMub3V0LnNobV9pZCk7CisgICAgICBkZWxldGUgcmVxOworICAgICAg
aWYgKCF0ZW1wbm9kZSkKKwlyZXR1cm4gKHZvaWQgKikgLTE7CisKKyAgICB9
CisKKyAgY2xhc3Mgc2htaWRfZHMgKnNobSA9IHRlbXBub2RlLT5zaG1kczsK
KworICBpZiAoc2htYWRkcikKKyAgICB7CisgICAgICAvL0ZJWE1FOiByZXF1
ZXN0ZWQgYmFzZSBhZGRyZXNzID8hIChEb24ndCBmb3JnZXQgdG8gZml4IHRo
ZSBmaXh1cF9hZnRlcl9mb3JrIHRvbykKKyAgICAgIHNldF9lcnJubyAoRUlO
VkFMKTsKKyAgICAgIHJldHVybiAodm9pZCAqKSAtMTsKKyAgICB9CisKKyAg
dm9pZCAqcnYgPSBNYXBWaWV3T2ZGaWxlICh0ZW1wbm9kZS0+YXR0YWNobWFw
LAorCQkJICAgIChzaG1mbGcgJiBTSE1fUkRPTkxZKSA/IEZJTEVfTUFQX1JF
QUQgOgorCQkJICAgIEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKworICBp
ZiAoIXJ2KQorICAgIHsKKyAgICAgIC8vRklYTUU6IHRyYW5zbGF0ZSBHZXRM
YXN0RXJyb3IoKQorICAgICAgc2V0X2Vycm5vIChFQUNDRVMpOworICAgICAg
cmV0dXJuICh2b2lkICopIC0xOworICAgIH0KKworICBJbnRlcmxvY2tlZElu
Y3JlbWVudCAoJnNobS0+c2htX25hdHRjaCk7CisgIF9zaG1hdHRhY2ggKmF0
dGFjaG5vZGUgPSBuZXcgX3NobWF0dGFjaDsKKworICBhdHRhY2hub2RlLT5k
YXRhID0gcnY7CisgIGF0dGFjaG5vZGUtPnNobWZsZyA9IHNobWZsZzsKKyAg
YXR0YWNobm9kZS0+bmV4dCA9CisgICAgKF9zaG1hdHRhY2ggKikgSW50ZXJs
b2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZ0ZW1wbm9kZS0+YXR0YWNoaGVhZCwg
YXR0YWNobm9kZSk7CisKKworICByZXR1cm4gcnY7Cit9CisKKy8vRklYTUU6
IHdobyBpcyBhbGxvd2VkIHRvIHBlcmZvcm0gU1RBVD8gCitleHRlcm4gIkMi
IGludAorc2htY3RsIChpbnQgc2htaWQsIGludCBjbWQsIHN0cnVjdCBzaG1p
ZF9kcyAqYnVmKQoreworICBzaG1ub2RlICp0ZW1wbm9kZSA9IHNobV9oZWFk
OworICB3aGlsZSAodGVtcG5vZGUgJiYgdGVtcG5vZGUtPnNobV9pZCAhPSBz
aG1pZCkKKyAgICB0ZW1wbm9kZSA9IHRlbXBub2RlLT5uZXh0OworICBpZiAo
IXRlbXBub2RlKQorICB7CisgICAgLyogY291bGRuJ3QgZmluZCBhIGN1cnJl
bnRseSBvcGVuIHNobSBjb250cm9sIGFyZWEgZm9yIHRoZSBrZXkgLSBwcm9i
YWJseSBiZWNhdXNlCisgICAgICogc2htZ2V0IGhhc24ndCBiZWVuIGNhbGxl
ZC4KKyAgICAgKiBBbGxvY2F0ZSBhIG5ldyBjb250cm9sIGJsb2NrIC0gdGhp
cyBoYXMgdG8gYmUgaGFuZGxlZCBieSB0aGUgZGFlbW9uICovCisgICAgY2xp
ZW50X3JlcXVlc3Rfc2htX2dldCAqcmVxID0KKyAgICAgIG5ldyBjbGllbnRf
cmVxdWVzdF9zaG1fZ2V0IChzaG1pZCwgR2V0Q3VycmVudFByb2Nlc3NJZCAo
KSk7CisKKyAgICBpbnQgcmM7CisgICAgaWYgKChyYyA9IGN5Z3NlcnZlcl9y
ZXF1ZXN0IChyZXEpKSkKKyAgICAgIHsKKyAgICAgICAgZGVsZXRlIHJlcTsK
KyAgICAgICAgc2V0X2Vycm5vIChFTk9TWVMpOyAgIC8qIGRhZW1vbiBjb21t
dW5pY2F0aW9uIGZhaWxlZCAqLworICAgICAgICByZXR1cm4gLTE7CisgICAg
ICB9CisKKyAgICBpZiAocmVxLT5oZWFkZXIuZXJyb3JfY29kZSkgICAgICAg
Lyogc2htX2dldCBmYWlsZWQgaW4gdGhlIGRhZW1vbiAqLworICAgICAgewor
ICAgICAgICBzZXRfZXJybm8gKHJlcS0+aGVhZGVyLmVycm9yX2NvZGUpOwor
ICAgICAgICBkZWxldGUgcmVxOworICAgICAgICByZXR1cm4gLTE7CisgICAg
ICB9CisKKyAgICAvKiB3ZSd2ZSBnb3QgdGhlIGlkLCBub3cgd2Ugb3BlbiB0
aGUgbWVtb3J5IGFyZWEgb3Vyc2VsdmVzLgorICAgICAqIFRoaXMgdGVzdHMg
c2VjdXJpdHkgYXV0b21hZ2ljYWxseQorICAgICAqIEZJWE1FOiBtYWtlIHRo
aXMgYSBtZXRob2Qgb2Ygc2htbm9kZSA/CisgICAgICovCisgICAgdGVtcG5v
ZGUgPQorICAgICAgYnVpbGRfaW5wcm9jZXNzX3NobWRzIChyZXEtPnBhcmFt
ZXRlcnMub3V0LmZpbGVtYXAsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHJlcS0+cGFyYW1ldGVycy5vdXQuYXR0YWNobWFwLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICByZXEtPnBhcmFtZXRlcnMub3V0LmtleSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLT5wYXJhbWV0ZXJz
Lm91dC5zaG1faWQpOworICAgIGRlbGV0ZSByZXE7CisgICAgaWYgKCF0ZW1w
bm9kZSkKKyAgICAgIHJldHVybiAtMTsKKyAgfQorICAKKyAgc3dpdGNoIChj
bWQpCisgICAgeworICAgIGNhc2UgSVBDX1NUQVQ6CisgICAgICBidWYtPnNo
bV9wZXJtID0gdGVtcG5vZGUtPnNobWRzLT5zaG1fcGVybTsgCisgICAgICBi
dWYtPnNobV9zZWdzeiA9IHRlbXBub2RlLT5zaG1kcy0+c2htX3NlZ3N6Owor
ICAgICAgYnVmLT5zaG1fbHBpZCA9IHRlbXBub2RlLT5zaG1kcy0+c2htX2xw
aWQ7CisgICAgICBidWYtPnNobV9jcGlkID0gdGVtcG5vZGUtPnNobWRzLT5z
aG1fY3BpZDsKKyAgICAgIGJ1Zi0+c2htX25hdHRjaCA9IHRlbXBub2RlLT5z
aG1kcy0+c2htX25hdHRjaDsKKyAgICAgIGJ1Zi0+c2htX2F0aW1lID0gdGVt
cG5vZGUtPnNobWRzLT5zaG1fYXRpbWU7CisgICAgICBidWYtPnNobV9kdGlt
ZSA9IHRlbXBub2RlLT5zaG1kcy0+c2htX2R0aW1lOworICAgICAgYnVmLT5z
aG1fY3RpbWUgPSB0ZW1wbm9kZS0+c2htZHMtPnNobV9jdGltZTsKKyAgICAg
IGJyZWFrOworICAgIGNhc2UgSVBDX1JNSUQ6CisgICAgICB7CisgICAgICAv
KiBUT0RPOiBjaGVjayBwZXJtaXNzaW9ucy4gT3IgcG9zc2libHksIHRoZSBk
YWVtb24gZ2V0cyB0byBiZSB0aGUgb25seSAKKyAgICAgICAqIG9uZSB3aXRo
IHdyaXRlIGFjY2VzcyB0byB0aGUgbWVtb3J5IGFyZWE/CisgICAgICAgKi8K
KyAgICAgIGlmICh0ZW1wbm9kZS0+c2htZHMtPnNobV9uYXR0Y2gpCisJc3lz
dGVtX3ByaW50ZiAoImNhbGwgdG8gc2htY3RsIHdpdGggY21kPSBJUENfUk1J
RCB3aGVuIG1lbW9yeSBhcmVhIHN0aWxsIGhhcyIKKwkJCSIgYXR0YWNoZWVz
XG4iKTsKKyAgICAgIC8qIGhvdyBkb2VzIHRoaXMgd29yaz8gCisJKiB3ZSBt
YXJrIHRoZSBkcyBhcmVhIGFzICJkZWxldGVkIiwgYW5kIHRoZSBhdCBhbmQg
Z2V0IGNhbGxzIGFsbCBmYWlsIGZyb20gbm93IG9uCisJKiBvbiwgd2hlbiBu
YXR0Y2ggYmVjb21lcyAwLCB0aGUgbWFwcGVkIGRhdGEgYXJlYSBpcyBkZXN0
cm95ZWQuCisgICAgICAgICogYW5kIGVhY2ggcHJvY2VzcywgYXMgdGhleSB0
b3VjaCB0aGlzIGFyZWEgZGV0YWNoZXMuIGV2ZW50dWFsbHkgb25seSB0aGUg
CisgCSogZGFlbW9uIGhhcyBhbiBhdHRhY2guIFRoZSBkYWVtb24gZ2V0cyBh
c2tlZCB0byBkZXRhY2ggaW1tZWRpYXRlbHkuCisJKi8KKyNpZiAwCisgICAg
ICBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0ICpyZXEgPQorCSAgbmV3IGNsaWVu
dF9yZXF1ZXN0X3NobV9nZXQgKFNITV9ERUwsIHNobWlkLCBHZXRDdXJyZW50
UHJvY2Vzc0lkICgpKTsKKyAgICBpbnQgcmM7CisgICAgaWYgKChyYyA9IGN5
Z3NlcnZlcl9yZXF1ZXN0IChyZXEpKSkKKyAgICAgIHsKKyAgICAgICAgZGVs
ZXRlIHJlcTsKKyAgICAgICAgc2V0X2Vycm5vIChFTk9TWVMpOyAgIC8qIGRh
ZW1vbiBjb21tdW5pY2F0aW9uIGZhaWxlZCAqLworICAgICAgICByZXR1cm4g
LTE7CisgICAgICB9CisKKyAgICBpZiAocmVxLT5oZWFkZXIuZXJyb3JfY29k
ZSkgICAgICAgLyogc2htX2RlbCBmYWlsZWQgaW4gdGhlIGRhZW1vbiAqLwor
ICAgICAgeworICAgICAgICBzZXRfZXJybm8gKHJlcS0+aGVhZGVyLmVycm9y
X2NvZGUpOworICAgICAgICBkZWxldGUgcmVxOworICAgICAgICByZXR1cm4g
LTE7CisgICAgICB9CisKKyAgICAgLyogdGhlIGRhZW1vbiBoYXMgZGVsZXRl
ZCBpdCdzIHJlZmVyZW5jZXMgKi8KKyAgICAgLyogbm93IGZvciB1cyAqLwor
I2VuZGlmCit9CisgICAgICBicmVhazsKKyAgICBjYXNlIElQQ19TRVQ6Cisg
ICAgZGVmYXVsdDoKKyAgICAgIHNldF9lcnJubyAoRUlOVkFMKTsKKyAgICAg
IHJldHVybiAtMTsKKyAgICB9CisgIHJldHVybiAwOworfQorCisvKiBGSVhN
RTogZXZhbHVhdGUgZ2V0dWlkKCkgYW5kIGdldGdpZCgpIGFnYWluc3QgdGhl
IHJlcXVlc3RlZCBtb2RlLiBUaGVuCisgKiBjaG9vc2UgUEFHRV9SRUFEV1JJ
VEUgfCBQQUdFX1JFQURPTkxZIGFuZCBGSUxFX01BUF9XUklURSAgfCAgRklM
RV9NQVBfUkVBRAorICogYXBwcm9wcmlhdGVseQorICovCisKKy8qIFRlc3Qg
cmVzdWx0IGZyb20gb3BlbmJzZDogc2htIGlkcyBhcmUgcGVyc2lzdGVudCBj
cm9zcyBwcm9jZXNzIGlmIGEgaGFuZGxlIGlzIGxlZnQKKyAqIG9wZW4uIFRo
aXMgY291bGQgbGVhZCB0byByZXNvdXJjZSBzdGFydmF0aW9uOiB3ZSdyZSBu
b3QgY29weWluZyB0aGF0IGJlaGF2aW91ciAKKyAqIHVubGVzcyB3ZSBoYXZl
IHRvLiAoSXQgd2lsbCBpbnZvbHZlIGFjeWd3aW4xLmRsbCBnbG9hbCBzaGFy
ZWQgbGlzdCA6WyApLgorICovCisvKiBGSVhNRTogc2htaWQgc2hvdWxkIGJl
IGEgdmVyaWZ5YWJsZSBvYmplY3QKKyAqLworCisvKiBGSVhNRTogb24gTlQg
d2Ugc2hvdWxkIGNoZWNrIGV2ZXJ5dGhpbmcgYWdhaW5zdCB0aGUgU0QuIE9u
IDk1IHdlIGp1c3QgZW11bGF0ZS4KKyAqLworZXh0ZXJuICJDIiBpbnQKK3No
bWdldCAoa2V5X3Qga2V5LCBzaXplX3Qgc2l6ZSwgaW50IHNobWZsZykKK3sK
KyAgRFdPUkQgc2Rfc2l6ZSA9IDQwOTY7CisgIGNoYXIgc2RfYnVmWzQwOTZd
OworICBQU0VDVVJJVFlfREVTQ1JJUFRPUiBwc2QgPSAoUFNFQ1VSSVRZX0RF
U0NSSVBUT1IpIHNkX2J1ZjsKKyAgLyogY3JlYXRlIGEgc2QgZm9yIG91ciBv
cGVuIHJlcXVlc3RzIGJhc2VkIG9uIHNobWZsYWcgJiAweDAxZmYgKi8KKyAg
cHNkID0gYWxsb2Nfc2QgKGdldHVpZCAoKSwgZ2V0Z2lkICgpLCBjeWdoZWFw
LT51c2VyLmxvZ3NydiAoKSwKKwkJICBzaG1mbGcgJiAweDAxZmYsIHBzZCwg
JnNkX3NpemUpOworCisgIGlmIChrZXkgPT0gKGtleV90KSAtIDEpCisgICAg
eworICAgICAgc2V0X2Vycm5vIChFTk9FTlQpOworICAgICAgcmV0dXJuIC0x
OworICAgIH0KKworICAvKiBGSVhNRTogZW50ZXIgdGhlIGNoZWNraW5nIGZv
ciBleGlzdGluZyBrZXlzIG11dGV4LiBUaGlzIG11dGV4IF9tdXN0XyBiZSBz
eXN0ZW0gd2lkZQorICAgKiB0byBwcmV2ZW50IHJhY2VzIG9uIHNobWdldC4K
KyAgICovCisKKyAgLyogd2FsayB0aGUgbGlzdCBvZiBjdXJyZW50bHkgb3Bl
biBrZXlzIGFuZCByZXR1cm4gdGhlIGlkIGlmIGZvdW5kCisgICAqLworICBz
aG1ub2RlICp0ZW1wbm9kZSA9IHNobV9oZWFkOworICB3aGlsZSAodGVtcG5v
ZGUpCisgICAgeworICAgICAgaWYgKHRlbXBub2RlLT5rZXkgPT0ga2V5ICYm
IGtleSAhPSBJUENfUFJJVkFURSkKKwl7CisJICAvLyBGSVhNRTogZnJlZSB0
aGUgbXV0ZXgKKwkgIGlmIChzaXplICYmIHRlbXBub2RlLT5zaG1kcy0+c2ht
X3NlZ3N6IDwgc2l6ZSkKKwkgICAgeworCSAgICAgIHNldF9lcnJubyAoRUlO
VkFMKTsKKwkgICAgICByZXR1cm4gLTE7CisJICAgIH0KKwkgIGlmICgoc2ht
ZmxnICYgSVBDX0NSRUFUKSAmJiAoc2htZmxnICYgSVBDX0VYQ0wpKQorCSAg
ICB7CisJICAgICAgc2V0X2Vycm5vIChFRVhJU1QpOworCSAgICAgIC8vIEZJ
WE1FOiBmcmVlIHRoZSBtdXRleAorCSAgICAgIHJldHVybiAtMTsKKwkgICAg
fQorCSAgLy8gRklYTUU6IGRvIHdlIG5lZWQgdG8gb3RoZXIgdGVzdHMgb2Yg
dGhlIHJlcXVlc3RlZCBtb2RlIHdpdGggdGhlCisJICAvLyB0ZW1wbm9kZS0+
c2htaWQgbW9kZSA/IHRlc3RjYXNlIG9uIHVuaXggbmVlZGVkLgorCSAgLy8g
RklYTUUgZG8gd2UgbmVlZCBhIHNlY3VyaXR5IHRlc3Q/IFdlIGFyZSBvbmx5
IGV4YW1pbmluZyB0aGUga2V5cyB3ZSBhbHJlYWR5IGhhdmUgb3Blbi4KKwkg
IC8vIEZJWE1FOiB3aGF0IGFyZSB0aGUgc2VjIGltcGxpY2F0aW9ucyBmb3Ig
Zm9yayAoKSBpZiB3ZSBkb24ndCBjaGVjayBoZXJlPworCSAgcmV0dXJuIHRl
bXBub2RlLT5zaG1faWQ7CisJfQorICAgICAgdGVtcG5vZGUgPSB0ZW1wbm9k
ZS0+bmV4dDsKKyAgICB9CisgIC8qIGNvdWxkbid0IGZpbmQgYSBjdXJyZW50
bHkgb3BlbiBzaG0gY29udHJvbCBhcmVhIGZvciB0aGUga2V5LgorICAgKiBB
bGxvY2F0ZSBhIG5ldyBjb250cm9sIGJsb2NrIC0gdGhpcyBoYXMgdG8gYmUg
aGFuZGxlZCBieSB0aGUgZGFlbW9uICovCisgIGNsaWVudF9yZXF1ZXN0X3No
bV9nZXQgKnJlcSA9CisgICAgbmV3IGNsaWVudF9yZXF1ZXN0X3NobV9nZXQg
KGtleSwgc2l6ZSwgc2htZmxnLCBzZF9idWYsCisJCQkJR2V0Q3VycmVudFBy
b2Nlc3NJZCAoKSk7CisKKyAgaW50IHJjOworICBpZiAoKHJjID0gY3lnc2Vy
dmVyX3JlcXVlc3QgKHJlcSkpKQorICAgIHsKKyAgICAgIGRlbGV0ZSByZXE7
CisgICAgICBzZXRfZXJybm8gKEVOT1NZUyk7CS8qIGRhZW1vbiBjb21tdW5p
Y2F0aW9uIGZhaWxlZCAqLworICAgICAgcmV0dXJuIC0xOworICAgIH0KKwor
ICBpZiAocmVxLT5oZWFkZXIuZXJyb3JfY29kZSkJLyogc2htX2dldCBmYWls
ZWQgaW4gdGhlIGRhZW1vbiAqLworICAgIHsKKyAgICAgIHNldF9lcnJubyAo
cmVxLT5oZWFkZXIuZXJyb3JfY29kZSk7CisgICAgICBkZWxldGUgcmVxOwor
ICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAvKiB3ZSd2ZSBnb3QgdGhl
IGlkLCBub3cgd2Ugb3BlbiB0aGUgbWVtb3J5IGFyZWEgb3Vyc2VsdmVzLgor
ICAgKiBUaGlzIHRlc3RzIHNlY3VyaXR5IGF1dG9tYWdpY2FsbHkKKyAgICog
RklYTUU6IG1ha2UgdGhpcyBhIG1ldGhvZCBvZiBzaG1ub2RlID8KKyAgICov
CisgIHNobW5vZGUgKnNobXRlbXAgPSBidWlsZF9pbnByb2Nlc3Nfc2htZHMg
KHJlcS0+cGFyYW1ldGVycy5vdXQuZmlsZW1hcCwKKwkJCQkJICAgIHJlcS0+
cGFyYW1ldGVycy5vdXQuYXR0YWNobWFwLAorCQkJCQkgICAga2V5LAorCQkJ
CQkgICAgcmVxLT5wYXJhbWV0ZXJzLm91dC5zaG1faWQpOworICBkZWxldGUg
cmVxOworICBpZiAoc2htdGVtcCkKKyAgICByZXR1cm4gc2htdGVtcC0+c2ht
X2lkOworICByZXR1cm4gLTE7CisKKworI2lmIDAKKyAgLyogZmlsbCBvdXQg
dGhlIG5vZGUgZGF0YSAqLworICBzaG10ZW1wLT5zaG1fcGVybS5jdWlkID0g
Z2V0dWlkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS51aWQgPSBzaG10ZW1w
LT5zaG1fcGVybS5jdWlkOworICBzaG10ZW1wLT5zaG1fcGVybS5jZ2lkID0g
Z2V0Z2lkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS5naWQgPSBzaG10ZW1w
LT5zaG1fcGVybS5jZ2lkOworICBzaG10ZW1wLT5zaG1fcGVybS5tb2RlID0g
c2htZmxnICYgMHgwMWZmOworICBzaG10ZW1wLT5zaG1fbHBpZCA9IDA7Cisg
IHNobXRlbXAtPnNobV9uYXR0Y2ggPSAwOworICBzaG10ZW1wLT5zaG1fYXRp
bWUgPSAwOworICBzaG10ZW1wLT5zaG1fZHRpbWUgPSAwOworICBzaG10ZW1w
LT5zaG1fY3RpbWUgPSB0aW1lIChOVUxMKTsKKyAgc2htdGVtcC0+c2htX3Nl
Z3N6ID0gc2l6ZTsKKyAgKihzaG1pZF9kcyAqKSBtYXBwdHIgPSAqc2htdGVt
cDsKKyAgc2htdGVtcC0+ZmlsZW1hcCA9IGZpbGVtYXA7CisgIHNobXRlbXAt
PmF0dGFjaG1hcCA9IGF0dGFjaG1hcDsKKyAgc2htdGVtcC0+bWFwcHRyID0g
bWFwcHRyOworCisjZW5kaWYKK30KSW5kZXg6IHNyYy93aW5zdXAvY3lnd2lu
L3R0eS5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL3R0eS5jYzoxLjI5
IHNyYy93aW5zdXAvY3lnd2luL3R0eS5jYzoxLjI5LjIuMQotLS0gc3JjL3dp
bnN1cC9jeWd3aW4vdHR5LmNjOjEuMjkJVGh1IFNlcCAxMyAwMzo0NjozNiAy
MDAxCisrKyBzcmMvd2luc3VwL2N5Z3dpbi90dHkuY2MJTW9uIFNlcCAyNCAy
Mjo0OToxMSAyMDAxCkBAIC0yMyw2ICsyMyw5IEBACiAjaW5jbHVkZSAic3lu
Yy5oIgogI2luY2x1ZGUgInNpZ3Byb2MuaCIKICNpbmNsdWRlICJwaW5mby5o
IgorI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KKyNpbmNsdWRlICJjeWd3aW4v
Y3lnc2VydmVyX3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdz
ZXJ2ZXIuaCIKICNpbmNsdWRlICJzaGFyZWRfaW5mby5oIgogCiBleHRlcm4g
ZmhhbmRsZXJfdHR5X21hc3RlciAqdHR5X21hc3RlcjsKQEAgLTM5Miw3ICsz
OTUsNyBAQAogCiAgIC8qIEFsbG93IHRoZSBvdGhlcnMgdG8gb3BlbiB1cyAo
Zm9yIGhhbmRsZSBkdXBsaWNhdGlvbikgKi8KIAotICBpZiAod2luY2FwLmhh
c19zZWN1cml0eSAoKSAmJgorICBpZiAod2luY2FwLmhhc19zZWN1cml0eSAo
KSAmJiBjeWdzZXJ2ZXJfcnVubmluZz09Q1lHU0VSVkVSX09LICYmCiAgICAg
ICAoU2V0S2VybmVsT2JqZWN0U2VjdXJpdHkgKGhNYWluUHJvYywgREFDTF9T
RUNVUklUWV9JTkZPUk1BVElPTiwKIAkJCSAgICAgICBnZXRfbnVsbF9zZCAo
KSkgPT0gRkFMU0UpKQogICAgIHNtYWxsX3ByaW50ZiAoIkNhbid0IHNldCBw
cm9jZXNzIHNlY3VyaXR5LCAlRSIpOwpJbmRleDogc3JjL3dpbnN1cC9jeWd3
aW4vd2luc3VwLmgKZGlmZiAtdSBzcmMvd2luc3VwL2N5Z3dpbi93aW5zdXAu
aDoxLjY5IHNyYy93aW5zdXAvY3lnd2luL3dpbnN1cC5oOjEuNjkuMi4xCi0t
LSBzcmMvd2luc3VwL2N5Z3dpbi93aW5zdXAuaDoxLjY5CVRodSBTZXAgMTMg
MDM6NDY6MzcgMjAwMQorKysgc3JjL3dpbnN1cC9jeWd3aW4vd2luc3VwLmgJ
TW9uIFNlcCAyNCAyMjo0OToxMSAyMDAxCkBAIC02OSw2ICs2OSw4IEBACiBl
bnVtIGNvZGVwYWdlX3R5cGUge2Fuc2lfY3AsIG9lbV9jcH07CiBleHRlcm4g
Y29kZXBhZ2VfdHlwZSBjdXJyZW50X2NvZGVwYWdlOwogCitleHRlcm4gaW50
IGN5Z3NlcnZlcl9ydW5uaW5nOworCiAvKiBVc2VkIHRvIGNoZWNrIGlmIEN5
Z3dpbiBETEwgaXMgZHluYW1pY2FsbHkgbG9hZGVkLiAqLwogZXh0ZXJuIGlu
dCBkeW5hbWljYWxseV9sb2FkZWQ7CiAKSW5kZXg6IHNyYy93aW5zdXAvY3ln
d2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlci5oCmRpZmYgLXUgL2Rldi9u
dWxsIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZl
ci5oOjEuMS4yLjEKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDow
MCAxOTcwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi9j
eWdzZXJ2ZXIuaAlNb24gU2VwIDI0IDIyOjQ5OjExIDIwMDEKQEAgLTAsMCAr
MSwxMjYgQEAKKy8qIGN5Z3NlcnZlci5oCisKKyAgIENvcHlyaWdodCAyMDAx
IFJlZCBIYXQgSW5jLgorCisgICBXcml0dGVuIGJ5IEVnb3IgRHVkYSA8ZGVv
QGxvZ29zLW0ucnU+CisKK1RoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4K
KworVGhpcyBzb2Z0d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5z
ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZQorQ3lnd2luIGxpY2Vuc2UuICBQ
bGVhc2UgY29uc3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgor
ZGV0YWlscy4gKi8KKworI2lmbmRlZiBfQ1lHU0VSVkVSX0hfCisjZGVmaW5l
IF9DWUdTRVJWRVJfSF8KKworI2RlZmluZSBNQVhfUkVRVUVTVF9TSVpFIDEy
OAorCisjZGVmaW5lIENZR1dJTl9TRVJWRVJfVkVSU0lPTl9NQUpPUgkxCisj
ZGVmaW5lIENZR1dJTl9TRVJWRVJfVkVSU0lPTl9BUEkJMQorI2RlZmluZSBD
WUdXSU5fU0VSVkVSX1ZFUlNJT05fTUlOT1IJMAorI2RlZmluZSBDWUdXSU5f
U0VSVkVSX1ZFUlNJT05fUEFUQ0gJMAorCisKK3R5cGVkZWYgZW51bSB7Cisg
IENZR1NFUlZFUl9VTktOT1dOPTAsCisgIENZR1NFUlZFUl9PSz0xLAorICBD
WUdTRVJWRVJfREVBRD0yCit9IGN5Z3NlcnZlcl9zdGF0ZXM7CisKK3R5cGVk
ZWYgZW51bSB7CisgIENZR1NFUlZFUl9SRVFVRVNUX0lOVkFMSUQgPSAwLAor
ICBDWUdTRVJWRVJfUkVRVUVTVF9HRVRfVkVSU0lPTiwKKyAgQ1lHU0VSVkVS
X1JFUVVFU1RfQVRUQUNIX1RUWSwKKyAgQ1lHU0VSVkVSX1JFUVVFU1RfU0hV
VERPV04sCisgIENZR1NFUlZFUl9SRVFVRVNUX1NITV9HRVQsCisgIENZR1NF
UlZFUl9SRVFVRVNUX0xBU1QKK30gY3lnc2VydmVyX3JlcXVlc3RfY29kZTsK
KworY2xhc3MgcmVxdWVzdF9oZWFkZXIKK3sKKyAgcHVibGljOgorICAgIHNz
aXplX3QgY2I7CisgICAgY3lnc2VydmVyX3JlcXVlc3RfY29kZSByZXFfaWQ7
CisgICAgc3NpemVfdCBlcnJvcl9jb2RlOworfQorI2lmZGVmIF9fR05VQ19f
CisgIF9fYXR0cmlidXRlX18gKChwYWNrZWQpKQorI2VuZGlmCis7CisKK2V4
dGVybiB2b2lkIGN5Z3NlcnZlcl9pbml0ICgpOworCisjZGVmaW5lIElOSVRf
UkVRVUVTVChyZXEsaWQpIFwKKwkocmVxKS5oZWFkZXIuY2IgPSBzaXplb2Yg
KHJlcSk7IFwKKwkocmVxKS5oZWFkZXIucmVxX2lkID0gaWQ7CisKK3N0cnVj
dCByZXF1ZXN0X2dldF92ZXJzaW9uCit7CisgIERXT1JEIG1ham9yLCBhcGks
IG1pbm9yLCBwYXRjaDsKK30KKyNpZmRlZiBfX0dOVUNfXworICBfX2F0dHJp
YnV0ZV9fICgocGFja2VkKSkKKyNlbmRpZgorOworCitzdHJ1Y3QgcmVxdWVz
dF9zaHV0ZG93bgoreworICBpbnQgZm9vOworfQorI2lmZGVmIF9fR05VQ19f
CisgIF9fYXR0cmlidXRlX18gKChwYWNrZWQpKQorI2VuZGlmCis7CisKK3N0
cnVjdCByZXF1ZXN0X2F0dGFjaF90dHkKK3sKKyAgRFdPUkQgcGlkLCBtYXN0
ZXJfcGlkOworICBIQU5ETEUgZnJvbV9tYXN0ZXIsIHRvX21hc3RlcjsKK30K
KyNpZmRlZiBfX0dOVUNfXworICBfX2F0dHJpYnV0ZV9fICgocGFja2VkKSkK
KyNlbmRpZgorOworCitjbGFzcyBjbGllbnRfcmVxdWVzdAoreworICBwdWJs
aWM6CisgIGNsaWVudF9yZXF1ZXN0IChjeWdzZXJ2ZXJfcmVxdWVzdF9jb2Rl
IGlkKTsKKyAgdmlydHVhbCB2b2lkIHNlbmQgKHRyYW5zcG9ydF9sYXllcl9i
YXNlICpjb25uKTsKKyAgdmlydHVhbCB2b2lkIHNlcnZlICh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqY29ubikge307CisgIHZpcnR1YWwgb3BlcmF0b3Igc3Ry
dWN0IHJlcXVlc3RfaGVhZGVyICgpOworICBjeWdzZXJ2ZXJfcmVxdWVzdF9j
b2RlIHJlcV9pZCAoKSB7cmV0dXJuIGhlYWRlci5yZXFfaWQ7fTsKKyAgdmly
dHVhbCB+Y2xpZW50X3JlcXVlc3QoKTsKKyAgcmVxdWVzdF9oZWFkZXIgaGVh
ZGVyOworICBjaGFyICpidWZmZXI7Cit9OworCitjbGFzcyBjbGllbnRfcmVx
dWVzdF9nZXRfdmVyc2lvbiA6IHB1YmxpYyBjbGllbnRfcmVxdWVzdAorewor
ICBwdWJsaWM6CisgIHZpcnR1YWwgdm9pZCBzZXJ2ZSAodHJhbnNwb3J0X2xh
eWVyX2Jhc2UgKmNvbm4pOworICBjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lv
bjo6Y2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb24oKTsKKyAgc3RydWN0IHJl
cXVlc3RfZ2V0X3ZlcnNpb24gdmVyc2lvbjsKK307CisKK2NsYXNzIGNsaWVu
dF9yZXF1ZXN0X3NodXRkb3duIDogcHVibGljIGNsaWVudF9yZXF1ZXN0Cit7
CisgIHB1YmxpYzoKKyAgdmlydHVhbCB2b2lkIHNlcnZlICh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqY29ubik7CisgIGNsaWVudF9yZXF1ZXN0X3NodXRkb3du
ICgpOworfTsKKworY2xhc3MgY2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eSA6
IHB1YmxpYyBjbGllbnRfcmVxdWVzdAoreworICBwdWJsaWM6CisgIHZpcnR1
YWwgdm9pZCBzZXJ2ZSAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4pOwor
ICBjbGllbnRfcmVxdWVzdF9hdHRhY2hfdHR5ICgpOworICBjbGllbnRfcmVx
dWVzdF9hdHRhY2hfdHR5IChEV09SRCBucGlkLCBEV09SRCBubWFzdGVyX3Bp
ZCwgSEFORExFIG5mcm9tX21hc3RlciwgSEFORExFIG50b19tYXN0ZXIpOwor
ICBIQU5ETEUgZnJvbV9tYXN0ZXIgKCkge3JldHVybiByZXEuZnJvbV9tYXN0
ZXI7fTsKKyAgSEFORExFIHRvX21hc3RlciAoKSB7cmV0dXJuIHJlcS50b19t
YXN0ZXI7fTsKKyAgc3RydWN0IHJlcXVlc3RfYXR0YWNoX3R0eSByZXE7Cit9
OworCitleHRlcm4gaW50IGN5Z3NlcnZlcl9yZXF1ZXN0IChjbGllbnRfcmVx
dWVzdCAqKTsKKworI2VuZGlmIC8qIF9DWUdTRVJWRVIrSCsgKi8KSW5kZXg6
IHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90
cmFuc3BvcnQuaApkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dp
bi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0Lmg6MS4xLjIu
MQotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysr
IHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90
cmFuc3BvcnQuaAlNb24gU2VwIDI0IDIyOjQ5OjExIDIwMDEKQEAgLTAsMCAr
MSw1MyBAQAorCisjaWZuZGVmIF9DWUdTRVJWRVJfU0hNXworI2RlZmluZSBf
Q1lHU0VSVkVSX1NITV8KK2NsYXNzIHRyYW5zcG9ydF9sYXllcl9iYXNlICpj
cmVhdGVfc2VydmVyX3RyYW5zcG9ydCgpOworCisvKiB0aGUgYmFzZSBjbGFz
cyB1c2VzIEFGX1VOSVggc29ja2V0cyxidXQgb3RoZXIgY2xhc3NlcyBhcmUg
cG9zc2libGUuICovCitjbGFzcyB0cmFuc3BvcnRfbGF5ZXJfYmFzZQorewor
ICBwdWJsaWM6CisgICAgdmlydHVhbCB2b2lkIGxpc3RlbiAoKTsKKyAgICB2
aXJ0dWFsIGNsYXNzIHRyYW5zcG9ydF9sYXllcl9iYXNlICogYWNjZXB0ICgp
OworICAgIHZpcnR1YWwgdm9pZCBjbG9zZSAoKTsKKyAgICB2aXJ0dWFsIHNz
aXplX3QgcmVhZCAoY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKKyAgICB2aXJ0
dWFsIHNzaXplX3Qgd3JpdGUgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7Cisg
ICAgdmlydHVhbCBib29sIGNvbm5lY3QoKTsKKyAgICB2aXJ0dWFsIHZvaWQg
aW1wZXJzb25hdGVfY2xpZW50ICgpOworICAgIHZpcnR1YWwgdm9pZCByZXZl
cnRfdG9fc2VsZiAoKTsKKyAgICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAoKTsK
KworICBwcml2YXRlOgorICAgIC8qIGZvciBzb2NrZXQgYmFzZWQgY29tbXVu
aWNhdGlvbnMgKi8KKyAgICBpbnQgZmQ7CisgICAgc3RydWN0IHNvY2thZGRy
IHNvY2tkZXRhaWxzOworICAgIGludCBzZGxlbjsKKyAgICB0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAoaW50IG5ld2ZkKTsKK307CisKKy8qIE5hbWVkIHBpcGVz
IGJhc2VkIHRyYW5zcG9ydCwgZm9yIHNlY3VyaXR5IG9uIE5UICovCitjbGFz
cyB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgOiBwdWJsaWMgdHJhbnNwb3J0X2xh
eWVyX2Jhc2UKK3sKKyAgcHVibGljOgorICAgIHZpcnR1YWwgdm9pZCBsaXN0
ZW4gKCk7CisgICAgdmlydHVhbCBjbGFzcyB0cmFuc3BvcnRfbGF5ZXJfcGlw
ZXMgKiBhY2NlcHQgKCk7CisgICAgdmlydHVhbCB2b2lkIGNsb3NlICgpOwor
ICAgIHZpcnR1YWwgc3NpemVfdCByZWFkIChjaGFyICpidWYsIHNpemVfdCBs
ZW4pOworICAgIHZpcnR1YWwgc3NpemVfdCB3cml0ZSAoY2hhciAqYnVmLCBz
aXplX3QgbGVuKTsKKyAgICB2aXJ0dWFsIGJvb2wgY29ubmVjdCgpOworICAg
IHZpcnR1YWwgdm9pZCBpbXBlcnNvbmF0ZV9jbGllbnQgKCk7CisgICAgdmly
dHVhbCB2b2lkIHJldmVydF90b19zZWxmICgpOworICAgIHRyYW5zcG9ydF9s
YXllcl9waXBlcyAoKTsKKworICBwcml2YXRlOgorICAgIC8qIGZvciBwaXBl
IGJhc2VkIGNvbW11bmljYXRpb25zICovCisgICAgdm9pZCBpbml0X3NlY3Vy
aXR5ICgpOworICAgIFNFQ1VSSVRZX0RFU0NSSVBUT1Igc2Q7CisgICAgU0VD
VVJJVFlfQVRUUklCVVRFUyBzZWNfbm9uZV9uaWgsIHNlY19hbGxfbmloOwor
ICAgIGNoYXIgcGlwZV9uYW1lIFtNQVhfUEFUSF07CisgICAgSEFORExFIHBp
cGU7CisgICAgYm9vbCBpbml0ZWQ7CisgICAgdHJhbnNwb3J0X2xheWVyX3Bp
cGVzIChIQU5ETEUgbmV3X3BpcGUpOworfTsKKworI2VuZGlmIC8qIF9DWUdT
RVJWRVJfU0hNXyAqLwpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVk
ZS9zeXMvaXBjLmgKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3
aW4vaW5jbHVkZS9zeXMvaXBjLmg6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlU
aHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2lu
L2luY2x1ZGUvc3lzL2lwYy5oCU1vbiBTZXAgMjQgMjI6NDk6MTEgMjAwMQpA
QCAtMCwwICsxLDUyIEBACisvKiBzeXMvaXBjLmgKKworICAgQ29weXJpZ2h0
IDIwMDEgUmVkIEhhdCBJbmMuIAorICAgV3JpdHRlbiBieSBSb2JlcnQgQ29s
bGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNvbT4KKworVGhpcyBmaWxlIGlz
IHBhcnQgb2YgQ3lnd2luLgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJp
Z2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCitD
eWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdX
SU5fTElDRU5TRSIgZm9yCitkZXRhaWxzLiAqLworCisjaWZkZWYgX19jcGx1
c3BsdXMKK2V4dGVybiAiQyIKK3sKKyNlbmRpZgorCisjaWZuZGVmIF9TWVNf
SVBDX0gKKyNkZWZpbmUgX1NZU19JUENfSAorCisvKiBzeXMvdHlwZXMgbXVz
dCBiZSBpbmNsdWRlZCBiZWZvcmUgc3lzL2lwYy5oLiBXZSBhcmVuJ3QgbWVh
bnQgdG8gYXV0b21hdGljYWxseSAKKyAqIGluY2x1ZGUgaXQgaG93ZXZlciAK
KyAqLworCitzdHJ1Y3QgaXBjX3Blcm0geworICB1aWRfdCAgdWlkOworICBn
aWRfdCAgZ2lkOworICB1aWRfdCAgY3VpZDsKKyAgZ2lkX3QgIGNnaWQ7Cisg
IG1vZGVfdCBtb2RlOworfTsgCisKKy8qIHRoZSBtb2RlIGZsYWdzIHVzZWQg
d2l0aCB0aGUgX2dldCBmdW5jdGlvbnMgdXNlIHRoZSBsb3cgb3JkZXIgOSBi
aXRzIGZvciBhIG1vZGUgCisgKiByZXF1ZXN0CisgKi8KKyNkZWZpbmUgSVBD
X0NSRUFUICAweDAyMDAKKyNkZWZpbmUgSVBDX0VYQ0wgICAweDA0MDAKKyNk
ZWZpbmUgSVBDX05PV0FJVCAweDA4MDAKKworLyogdGhpcyBpcyBhIHZhbHVl
IHRoYXQgd2lsbCBfbmV2ZXJfIGJlIGEgdmFsaWQga2V5IGZyb20gZnRvayAq
LworI2RlZmluZSBJUENfUFJJVkFURSAtMgorCisjZGVmaW5lIElQQ19STUlE
IDB4MDAwMworI2RlZmluZSBJUENfU0VUICAweDAwMDIKKyNkZWZpbmUgSVBD
X1NUQVQgMHgwMDAxCisKK2tleV90IGZ0b2soY29uc3QgY2hhciAqLCBpbnQp
OworCisjZW5kaWYgLyogX1NZU19JUENfSCAqLworCisjaWZkZWYgX19jcGx1
c3BsdXMKK30KKyNlbmRpZgpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vaW5j
bHVkZS9zeXMvc2htLmgKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9j
eWd3aW4vaW5jbHVkZS9zeXMvc2htLmg6MS4xLjIuMQotLS0gL2Rldi9udWxs
CQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3ln
d2luL2luY2x1ZGUvc3lzL3NobS5oCU1vbiBTZXAgMjQgMjI6NDk6MTEgMjAw
MQpAQCAtMCwwICsxLDg5IEBACisvKiBzeXMvc2htLmgKKworICAgQ29weXJp
Z2h0IDIwMDEgUmVkIEhhdCBJbmMuIAorICAgV3JpdHRlbiBieSBSb2JlcnQg
Q29sbGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNvbT4KKworVGhpcyBmaWxl
IGlzIHBhcnQgb2YgQ3lnd2luLgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29w
eXJpZ2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhl
CitDeWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJD
WUdXSU5fTElDRU5TRSIgZm9yCitkZXRhaWxzLiAqLworCisjaWZkZWYgX19j
cGx1c3BsdXMKK2V4dGVybiAiQyIKK3sKKyNlbmRpZgorCisjaWZuZGVmIF9T
WVNfU0hNX0gKKyNkZWZpbmUgX1NZU19TSE1fSAorCisjaW5jbHVkZSA8c3lz
L2lwYy5oPgorCisjZGVmaW5lIFNITV9SRE9OTFkgMQorLyogNjQgS2Igd2Fz
IGhhcmRjb2RlZCBmb3IgeDg2LiBNUyBzdGF0ZXMgdGhpcyBtYXkgY2hhbmdl
LCBidXQgd2UgbmVlZCBpdCBpbiB0aGUgaGVhZGVyCisgKiBmaWxlLgorICov
CisjZGVmaW5lIFNITUxCQSAgICAgNjU1MzYKKyNkZWZpbmUgU0hNX1JORAkg
ICAxCisKK3R5cGVkZWYgbG9uZyBpbnQgc2htYXR0X3Q7CisKKyNpZiBkZWZp
bmVkKF9fSU5TSURFX0NZR1dJTl9fKSAmJiBkZWZpbmVkKF9fY3BsdXNwbHVz
KQorCitjbGFzcyBfc2htYXR0YWNoIHsKK3B1YmxpYzoKKyAgdm9pZCAqZGF0
YTsKKyAgaW50IHNobWZsZzsKKyAgY2xhc3MgX3NobWF0dGFjaCAqbmV4dDsK
K307CisKK2NsYXNzIHNobWlkX2RzIHsKK3B1YmxpYzoKKyAgc3RydWN0ICAg
aXBjX3Blcm0gc2htX3Blcm07CisgIHNpemVfdCAgIHNobV9zZWdzejsKKyAg
cGlkX3QgICAgc2htX2xwaWQ7CisgIHBpZF90ICAgIHNobV9jcGlkOworICBz
aG1hdHRfdCBzaG1fbmF0dGNoOworICB0aW1lX3QgICBzaG1fYXRpbWU7Cisg
IHRpbWVfdCAgIHNobV9kdGltZTsKKyAgdGltZV90ICAgc2htX2N0aW1lOwor
ICB2b2lkICptYXBwdHI7Cit9OworCitjbGFzcyBzaG1ub2RlIHsKK3B1Ymxp
YzoKKyAgY2xhc3Mgc2htaWRfZHMgKiBzaG1kczsKKyAgaW50IHNobV9pZDsK
KyAgY2xhc3Mgc2htbm9kZSAqbmV4dDsKKyAga2V5X3Qga2V5OworICBIQU5E
TEUgZmlsZW1hcDsKKyAgSEFORExFIGF0dGFjaG1hcDsKKyAgY2xhc3MgX3No
bWF0dGFjaCAqYXR0YWNoaGVhZDsKK307CisKKyNlbHNlCisvKiB0aGlzIGlz
IHdoYXQgd2UgcmV0dXJuIHdoZW4gcXVlcmllZC4gSXQgaGFzIG5vIGJpdHdp
c2UgY29ycmVzcG9uZGVuY2UKKyAqIHRoZSBpbnRlcm5hbCBzdHJ1Y3R1cmVz
IAorICovCitzdHJ1Y3Qgc2htaWRfZHMgeworICBzdHJ1Y3QgICBpcGNfcGVy
bSBzaG1fcGVybTsKKyAgc2l6ZV90ICAgc2htX3NlZ3N6OworICBwaWRfdCAg
ICBzaG1fbHBpZDsKKyAgcGlkX3QgICAgc2htX2NwaWQ7CisgIHNobWF0dF90
IHNobV9uYXR0Y2g7CisgIHRpbWVfdCAgIHNobV9hdGltZTsKKyAgdGltZV90
ICAgc2htX2R0aW1lOworICB0aW1lX3QgICBzaG1fY3RpbWU7Cit9OworI2Vu
ZGlmIC8qIF9fSU5TSURFX0NZR1dJTl9fICovCisKK3ZvaWQgKnNobWF0KGlu
dCwgY29uc3Qgdm9pZCAqLCBpbnQpOworaW50ICAgc2htY3RsKGludCwgaW50
LCBzdHJ1Y3Qgc2htaWRfZHMgKik7CitpbnQgICBzaG1kdChjb25zdCB2b2lk
ICopOworaW50ICAgc2htZ2V0KGtleV90LCBzaXplX3QsIGludCk7CisKKyNl
bmRpZiAvKiBfU1lTX1NITV9IICovCisKKyNpZmRlZiBfX2NwbHVzcGx1cwor
fQorI2VuZGlmCg==

------------=_1583532849-65438-107--
