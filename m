Return-Path: <cygwin-patches-return-8234-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 53773 invoked by alias); 17 Aug 2015 07:42:04 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Id: <cygwin-patches.cygwin.com>
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
Received: (qmail 53762 invoked by uid 89); 17 Aug 2015 07:42:03 -0000
Authentication-Results: sourceware.org; auth=none
X-Virus-Found: No
X-Spam-SWARE-Status: No, score=-2.0 required=5.0 tests=AWL,BAYES_00,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW,SPF_PASS autolearn=ham version=3.3.2
X-HELO: mail-wi0-f175.google.com
Received: from mail-wi0-f175.google.com (HELO mail-wi0-f175.google.com) (209.85.212.175) by sourceware.org (qpsmtpd/0.93/v0.84-503-g423c35a) with (AES128-GCM-SHA256 encrypted) ESMTPS; Mon, 17 Aug 2015 07:42:02 +0000
Received: by wicne3 with SMTP id ne3so63498887wic.0        for <cygwin-patches@cygwin.com>; Mon, 17 Aug 2015 00:41:59 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.180.85.194 with SMTP id j2mr31094469wiz.11.1439797319583; Mon, 17 Aug 2015 00:41:59 -0700 (PDT)
Received: by 10.28.51.80 with HTTP; Mon, 17 Aug 2015 00:41:59 -0700 (PDT)
Date: Mon, 17 Aug 2015 07:42:00 -0000
Message-ID: <CAGHpTBLBua-DJQ1tBapYd_6ypdWGMW+ehAq4r7k_TA44Tn_Oxg@mail.gmail.com>
Subject: [PATCH] mkglobals: Fix EOL detection
From: Orgad Shaneh <orgads@gmail.com>
To: cygwin-patches@cygwin.com
Content-Type: text/plain; charset=UTF-8
X-IsSubscribed: yes
X-SW-Source: 2015-q3/txt/msg00016.txt.bz2

When globals.cc has CRLF line endings, winsup.h is not removed, and
compilation fails for duplicate definitions.
---
 winsup/cygwin/mkglobals_h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/winsup/cygwin/mkglobals_h b/winsup/cygwin/mkglobals_h
index ea4a582..2d185f2 100755
--- a/winsup/cygwin/mkglobals_h
+++ b/winsup/cygwin/mkglobals_h
@@ -1,6 +1,7 @@
 #!/usr/bin/perl
 my @argv = @ARGV;
 $_ = join('', <>);
+s/\s+\n/\n/sog;
 s/\n[^\n]*!globals.h[^\n]*\n/\n/sog;
 s%/\*.*?\*/%%sog;
 s/(enum\s.*?{.*?})/munge($1)/soge;
@@ -12,7 +13,6 @@ s/^\n+//sog;
 s/#include "winsup\.h"\n//so;
 s/-NL-/\n/sog;
 s/-EQ-/=/sog;
-s/\s+\n/\n/sog;
 s/\n{2,}/\n/sog;
 print <<PRELUDE,$_;
 /* $target - Autogenerated from @argv.  Look there for comments. */
--
2.4.6.windows.1
