From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-developers@cygwin.com>
Cc: <cygwin-patches@cygwin.com>
Subject: Re: pthread_cond*
Date: Fri, 16 Mar 2001 15:02:00 -0000
Message-id: <007701c0ae6c$f174ab70$0200a8c0@lifelesswks>
References: <05e401c0ae24$e8194600$0200a8c0@lifelesswks> <20010316102348.D11518@redhat.com>
X-SW-Source: 2001-q1/msg00188.html
Content-type: multipart/mixed; boundary="----------=_1583532846-65438-21"

This is a multi-part message in MIME format...

------------=_1583532846-65438-21
Content-length: 53

Take two - return value for TimedWait function.

Rob

------------=_1583532846-65438-21
Content-Type: text/x-diff; charset=us-ascii; name="pthread_cond2.patch"
Content-Disposition: inline; filename="pthread_cond2.patch"
Content-Transfer-Encoding: base64
Content-Length: 20061

SW5kZXg6IGN5Z3dpbi9jeWd3aW4uZGluCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY3lnd2luL2N5Z3dp
bi5kaW4sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjEKZGlmZiAtdSAtcCAt
cjEuMjEgY3lnd2luLmRpbgotLS0gY3lnd2luLmRpbgkyMDAxLzAzLzA1IDA2
OjI4OjIzCTEuMjEKKysrIGN5Z3dpbi5kaW4JMjAwMS8wMy8xNiAyMjo1ODox
MgpAQCAtMTA5OSw2ICsxMDk5LDE2IEBAIGN5Z3dpbjMyX2ludGVybmFsID0g
Y3lnd2luX2ludGVybmFsCiBAUFRIX0FMTE9XQHB0aHJlYWRfbXV0ZXhfdHJ5
bG9jawogQFBUSF9BTExPV0BwdGhyZWFkX211dGV4X3VubG9jawogQFBUSF9B
TExPV0BwdGhyZWFkX211dGV4X2Rlc3Ryb3kKK0BQVEhfQUxMT1dAcHRocmVh
ZF9jb25kX2luaXQKK0BQVEhfQUxMT1dAcHRocmVhZF9jb25kX2Rlc3Ryb3kK
K0BQVEhfQUxMT1dAcHRocmVhZF9jb25kX2Jyb2FkY2FzdAorQFBUSF9BTExP
V0BwdGhyZWFkX2NvbmRfc2lnbmFsCitAUFRIX0FMTE9XQHB0aHJlYWRfY29u
ZF93YWl0CitAUFRIX0FMTE9XQHB0aHJlYWRfY29uZF90aW1lZHdhaXQKK0BQ
VEhfQUxMT1dAcHRocmVhZF9jb25kYXR0cl9pbml0CitAUFRIX0FMTE9XQHB0
aHJlYWRfY29uZGF0dHJfZGVzdHJveQorQFBUSF9BTExPV0BwdGhyZWFkX2Nv
bmRhdHRyX2dldHBzaGFyZWQKK0BQVEhfQUxMT1dAcHRocmVhZF9jb25kYXR0
cl9zZXRwc2hhcmVkCiBAUFRIX0FMTE9XQHNlbV9pbml0CiBAUFRIX0FMTE9X
QHNlbV9kZXN0cm95CiBAUFRIX0FMTE9XQHNlbV93YWl0CkluZGV4OiBjeWd3
aW4vcHRocmVhZC5jYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxl
OiAvY3ZzL3NyYy9zcmMvd2luc3VwL2N5Z3dpbi9wdGhyZWFkLmNjLHYKcmV0
cmlldmluZyByZXZpc2lvbiAxLjMKZGlmZiAtdSAtcCAtcjEuMyBwdGhyZWFk
LmNjCi0tLSBwdGhyZWFkLmNjCTIwMDAvMDkvMDQgMTc6NTI6NDIJMS4zCisr
KyBwdGhyZWFkLmNjCTIwMDEvMDMvMTYgMjI6NTg6MTIKQEAgLTE3MSw2ICsx
NzEsNjcgQEAgcHRocmVhZF9tdXRleF9kZXN0cm95IChwdGhyZWFkX211dGV4
X3QgKgogICByZXR1cm4gX19wdGhyZWFkX211dGV4X2Rlc3Ryb3kgKG11dGV4
KTsKIH0KIAorLyogU3luY2hyb25pc2F0aW9uICovCisKK2ludAorcHRocmVh
ZF9jb25kX2Rlc3Ryb3kocHRocmVhZF9jb25kX3QgKmNvbmQpCit7CisgIHJl
dHVybiAgX19wdGhyZWFkX2NvbmRfZGVzdHJveSAoY29uZCk7Cit9CisKK2lu
dAorcHRocmVhZF9jb25kX2luaXQocHRocmVhZF9jb25kX3QgKmNvbmQsIGNv
bnN0IHB0aHJlYWRfY29uZGF0dHJfdCAqYXR0cikKK3sKKyAgcmV0dXJuIF9f
cHRocmVhZF9jb25kX2luaXQgKGNvbmQsIGF0dHIpOworfQorCitpbnQKK3B0
aHJlYWRfY29uZF9zaWduYWwocHRocmVhZF9jb25kX3QgKmNvbmQpCit7Cisg
IHJldHVybiBfX3B0aHJlYWRfY29uZF9zaWduYWwgKGNvbmQpOworfQorCitp
bnQgcHRocmVhZF9jb25kX2Jyb2FkY2FzdChwdGhyZWFkX2NvbmRfdCAqY29u
ZCkKK3sKKyAgcmV0dXJuIF9fcHRocmVhZF9jb25kX2Jyb2FkY2FzdCAoY29u
ZCk7Cit9CisKK2ludAorcHRocmVhZF9jb25kX3RpbWVkd2FpdChwdGhyZWFk
X2NvbmRfdCAqY29uZCwKKwkgcHRocmVhZF9tdXRleF90ICptdXRleCwgY29u
c3Qgc3RydWN0IHRpbWVzcGVjICphYnN0aW1lKQoreworICByZXR1cm4gX19w
dGhyZWFkX2NvbmRfdGltZWR3YWl0IChjb25kLCBtdXRleCwgYWJzdGltZSk7
Cit9CisKK2ludAorcHRocmVhZF9jb25kX3dhaXQocHRocmVhZF9jb25kX3Qg
KmNvbmQsIHB0aHJlYWRfbXV0ZXhfdCAqbXV0ZXgpCit7CisgIHJldHVybiBf
X3B0aHJlYWRfY29uZF93YWl0IChjb25kLCBtdXRleCk7Cit9CisKK2ludAor
cHRocmVhZF9jb25kYXR0cl9pbml0KHB0aHJlYWRfY29uZGF0dHJfdCAqY29u
ZGF0dHIpCit7CisgIHJldHVybiBfX3B0aHJlYWRfY29uZGF0dHJfaW5pdCAo
Y29uZGF0dHIpOworfQorCitpbnQKK3B0aHJlYWRfY29uZGF0dHJfZGVzdHJv
eShwdGhyZWFkX2NvbmRhdHRyX3QgKmNvbmRhdHRyKQoreworICByZXR1cm4g
X19wdGhyZWFkX2NvbmRhdHRyX2Rlc3Ryb3kgKGNvbmRhdHRyKTsKK30KKwor
aW50CitwdGhyZWFkX2NvbmRhdHRyX2dldHBzaGFyZWQgKGNvbnN0IHB0aHJl
YWRfY29uZGF0dHJfdCAqYXR0ciwgaW50ICpwc2hhcmVkKQoreworICByZXR1
cm4gX19wdGhyZWFkX2NvbmRhdHRyX2dldHBzaGFyZWQgKGF0dHIsIHBzaGFy
ZWQpOworfQorCitpbnQgcHRocmVhZF9jb25kYXR0cl9zZXRwc2hhcmVkIChw
dGhyZWFkX2NvbmRhdHRyX3QgKmF0dHIsIGludCBwc2hhcmVkKQoreworICBy
ZXR1cm4gX19wdGhyZWFkX2NvbmRhdHRyX3NldHBzaGFyZWQgKGF0dHIsIHBz
aGFyZWQpOworfQorCiAvKiBTZW1hcGhvcmVzICovCiBpbnQKIHNlbV9pbml0
IChzZW1fdCAqIHNlbSwgaW50IHBzaGFyZWQsIHVuc2lnbmVkIGludCB2YWx1
ZSkKSW5kZXg6IGN5Z3dpbi90aHJlYWQuY2MKPT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQpSQ1MgZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jeWd3aW4vdGhy
ZWFkLmNjLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjE2CmRpZmYgLXUgLXAg
LXIxLjE2IHRocmVhZC5jYwotLS0gdGhyZWFkLmNjCTIwMDEvMDIvMjAgMDI6
NTM6NTUJMS4xNgorKysgdGhyZWFkLmNjCTIwMDEvMDMvMTYgMjI6NTg6MTQK
QEAgLTYzLDYgKzYzLDEzIEBAIGV4dGVybiBpbnQgdGhyZWFkc2FmZTsKICAg
aWYgKCFpdGVtKSByZXR1cm4gRUlOVkFMOyBcCiAgIENIRUNLSEFORExFIChF
SU5WQUwsIDApOwogCisjZGVmaW5lIEdFVENPTkQobikgXAorICBTZXRSZXNv
dXJjZUxvY2sgKExPQ0tfQ09ORF9MSVNULCBSRUFEX0xPQ0ssIG4pOyBcCisg
IENvbmRJdGVtICppdGVtPXVzZXJfZGF0YS0+dGhyZWFkaW50ZXJmYWNlLT5H
ZXRDb25kIChjb25kKTsgXAorICBSZWxlYXNlUmVzb3VyY2VMb2NrIChMT0NL
X0NPTkRfTElTVCwgUkVBRF9MT0NLLCBuKTsgXAorICBpZiAoIWl0ZW0pIHJl
dHVybiBFSU5WQUw7IFwKKyAgQ0hFQ0tIQU5ETEUgKEVJTlZBTCwgMCk7CisK
ICNkZWZpbmUgQ0hFQ0tJVEVNKHJuLCBybSwgZm4pIFwKICAgaWYgKCFpdGVt
KSB7IFwKICAgICBSZWxlYXNlUmVzb3VyY2VMb2NrIChybiwgcm0sIGZuKTsg
XApAQCAtMzg3LDYgKzM5NCwxMyBAQCBNVGludGVyZmFjZTo6R2V0U2VtYXBo
b3JlIChzZW1fdCAqIHNwKQogICByZXR1cm4gKFNlbWFwaG9yZUl0ZW0gKikg
RmluZCAoc3AsICZDbXBQdGhyZWFkT2JqLCBpbmRleCwgJnNlbWFsaXN0KTsK
IH0KIAorQ29uZEl0ZW0gKgorTVRpbnRlcmZhY2U6OkdldENvbmQgKHB0aHJl
YWRfY29uZF90ICogbXApCit7CisgIEFzc2VydFJlc291cmNlT3duZXIgKExP
Q0tfQ09ORF9MSVNULCBSRUFEX0xPQ0spOworICBpbnQgaW5kZXggPSAwOwor
ICByZXR1cm4gKENvbmRJdGVtICopIEZpbmQgKG1wLCAmQ21wUHRocmVhZE9i
aiwgaW5kZXgsICZjb25kbGlzdCk7Cit9CiAKIHZvaWQKIE1UaXRlbTo6RGVz
dHJveSAoKQpAQCAtNDU1LDcgKzQ2OSw3OSBAQCBTZW1hcGhvcmVJdGVtOjpU
cnlXYWl0ICgpCiAgIHJldHVybiBXYWl0Rm9yU2luZ2xlT2JqZWN0ICh3aW4z
Ml9vYmpfaWQsIDApOwogfQogCisvKiBDb25kaXRpb24gSXRlbXMgKi8KK0Nv
bmRJdGVtICoKK01UaW50ZXJmYWNlOjpDcmVhdGVDb25kIChwdGhyZWFkX2Nv
bmRfdCAqIGNvbmQsIGNvbnN0IHB0aHJlYWRfY29uZGF0dHJfdCAqIGF0dHIp
Cit7CisgIEFzc2VydFJlc291cmNlT3duZXIgKExPQ0tfQ09ORF9MSVNULCBX
UklURV9MT0NLIHwgUkVBRF9MT0NLKTsKKworICBpbnQgaSA9IEZpbmROZXh0
VW51c2VkICgmY29uZGxpc3QpOworCisgIENvbmRJdGVtICppdGVtID0gKENv
bmRJdGVtICopIEdldEl0ZW0gKGksICZjb25kbGlzdCk7CisgIGlmICghaXRl
bSkKKyAgICBpdGVtID0gKENvbmRJdGVtICopIFNldEl0ZW0gKGksIG5ldyBD
b25kSXRlbSAoKSwgJmNvbmRsaXN0KTsKKyAgaWYgKCFpdGVtKQorICAgIHN5
c3RlbV9wcmludGYgKCJjb25kIGNyZWF0aW9uIGZhaWxlZCIpOworICBpdGVt
LT51c2VkID0gdHJ1ZTsKKyAgaXRlbS0+c2hhcmVkID0gYXR0ci0+c2hhcmVk
OworICBpdGVtLT5tdXRleGl0ZW09TlVMTDsKKyAgaXRlbS0+d2FpdGluZz0w
OworCisgIGl0ZW0tPndpbjMyX29ial9pZCA9IDo6Q3JlYXRlRXZlbnQgKCZz
ZWNfbm9uZV9uaWgsIAorCWZhbHNlLCAvKiBhdXRvIHNpZ25hbCByZXNldCAt
IHdoaWNoIEkgdGhpbmsgaXMgcHRocmVhZHMgbGlrZSA/ICovCisJZmFsc2Us
IC8qIHN0YXJ0IG5vbiBzaWduYWxlZCAqLworCU5VTEwgLyogbm8gbmFtZSAq
LyApOworCisKKyAgQ0hFQ0tIQU5ETEUgKE5VTEwsIDEpOworCisgICpjb25k
ID0gKHB0aHJlYWRfY29uZF90KSBpdGVtLT53aW4zMl9vYmpfaWQ7CisKKyAg
cmV0dXJuIGl0ZW07Cit9CisKKworaW50CitDb25kSXRlbTo6U2lnbmFsICgp
Cit7CisgIHJldHVybiAhUHVsc2VFdmVudCh3aW4zMl9vYmpfaWQpOworfQor
CitpbnQKK0NvbmRJdGVtOjpXYWl0ICgpCit7CisgIERXT1JEIHJ2ID0gU2ln
bmFsT2JqZWN0QW5kV2FpdCAobXV0ZXhpdGVtLT53aW4zMl9vYmpfaWQsIHdp
bjMyX29ial9pZCwgSU5GSU5JVEUsIGZhbHNlKTsKKyAgc3dpdGNoIChydikg
eworICAgIGNhc2UgV0FJVF9GQUlMRUQ6IHJldHVybiAwOyAvKiBQT1NJWCBk
b2Vzbid0IGFsbG93IGVycm9ycyBhZnRlciB3ZSBtb2RpZnkgdGhlIG11dGV4
IHN0YXRlICovCisgICAgY2FzZSBXQUlUX09CSkVDVF8wOiByZXR1cm4gMDsg
Lyogd2UgaGF2ZSBiZWVuIHNpZ25hbGVkICovCisgICAgZGVmYXVsdDogcmV0
dXJuIDA7CisgIH0KK30KKworaW50CitDb25kSXRlbTo6VGltZWRXYWl0IChE
V09SRCBkd01pbGxpc2Vjb25kcykKK3sKKyAgRFdPUkQgcnYgPSBTaWduYWxP
YmplY3RBbmRXYWl0IChtdXRleGl0ZW0tPndpbjMyX29ial9pZCwgd2luMzJf
b2JqX2lkLCBkd01pbGxpc2Vjb25kcywgZmFsc2UpOworICBzd2l0Y2ggKHJ2
KSB7CisgICAgY2FzZSBXQUlUX0ZBSUxFRDogcmV0dXJuIDA7IC8qIFBPU0lY
IGRvZXNuJ3QgYWxsb3cgZXJyb3JzIGFmdGVyIHdlIG1vZGlmeSB0aGUgbXV0
ZXggc3RhdGUgKi8KKyAgICBjYXNlIFdBSVRfQUJBTkRPTkVEOiByZXR1cm4g
RVRJTUVET1VUOworICAgIGNhc2UgV0FJVF9PQkpFQ1RfMDogcmV0dXJuIDA7
IC8qIHdlIGhhdmUgYmVlbiBzaWduYWxlZCAqLworICAgIGRlZmF1bHQ6IHJl
dHVybiAwOworICB9Cit9CiAKK2ludAorQ29uZEl0ZW06OkJyb2FkQ2FzdCAo
KQoreworICBpZiAoIW11dGV4aXRlbSkKKyAgICByZXR1cm4gMDsKKyAgUHVs
c2VFdmVudCh3aW4zMl9vYmpfaWQpOworICB3aGlsZSAoSW50ZXJsb2NrZWRE
ZWNyZW1lbnQoJndhaXRpbmcpIT0wKQorICAgIFB1bHNlRXZlbnQod2luMzJf
b2JqX2lkKTsKKyAgbXV0ZXhpdGVtPU5VTEw7CisgIHJldHVybiAwOworfQor
CiAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyAgUHRocmVhZHMKIAogdm9p
ZCAqCkBAIC02NzgsNiArNzY0LDE0NyBAQCBfX3B0aHJlYWRfZ2V0c3BlY2lm
aWMgKHB0aHJlYWRfa2V5X3QgKi8qCiAgIE5PVF9JTVAgKCJfcF9rZXlfZ2V0
c3BcbiIpOwogfQogCisvKiBUaHJlYWQgc3luY2hyb25pc2F0aW9uICovCisK
K2ludAorX19wdGhyZWFkX2NvbmRfZGVzdHJveShwdGhyZWFkX2NvbmRfdCAq
Y29uZCkKK3sKKyAgU2V0UmVzb3VyY2VMb2NrIChMT0NLX0NPTkRfTElTVCwg
UkVBRF9MT0NLIHwgV1JJVEVfTE9DSywgIl9fcHRocmVhZF9jb25kX2Rlc3Ry
b3kiKTsKKworICBDb25kSXRlbSAqaXRlbSA9IE1UX0lOVEVSRkFDRS0+R2V0
Q29uZCAoY29uZCk7CisKKyAgQ0hFQ0tJVEVNIChMT0NLX0NPTkRfTElTVCwg
V1JJVEVfTE9DSyB8IFJFQURfTE9DSywgIl9fcHRocmVhZF9jb25kX2luaXQi
KTsKKworICBpdGVtLT5EZXN0cm95ICgpOworCisgIE1UX0lOVEVSRkFDRS0+
UmVsZWFzZUl0ZW0gKGl0ZW0pOworCisgIFJlbGVhc2VSZXNvdXJjZUxvY2sg
KExPQ0tfQ09ORF9MSVNULCBSRUFEX0xPQ0sgfCBXUklURV9MT0NLLCAiX19w
dGhyZWFkX2NvbmRfZGVzdHJveSIpCis7CisgIHJldHVybiAwOworfQorCitp
bnQKK19fcHRocmVhZF9jb25kX2luaXQocHRocmVhZF9jb25kX3QgKmNvbmQs
IGNvbnN0IHB0aHJlYWRfY29uZGF0dHJfdCAqYXR0cikKK3sKKyAgaWYgKGF0
dHIgJiYgKGF0dHItPnZhbGlkICE9IDB4ZjM0MSkpCisgICAgcmV0dXJuIEVJ
TlZBTDsKKyAgU2V0UmVzb3VyY2VMb2NrIChMT0NLX0NPTkRfTElTVCwgV1JJ
VEVfTE9DSyB8IFJFQURfTE9DSywgIl9fcHRocmVhZF9jb25kX2luaXQiKTsK
KworICBDb25kSXRlbSAqaXRlbSA9IE1UX0lOVEVSRkFDRS0+Q3JlYXRlQ29u
ZCAoY29uZCwgYXR0cik7CisKKyAgQ0hFQ0tJVEVNIChMT0NLX0NPTkRfTElT
VCwgV1JJVEVfTE9DSyB8IFJFQURfTE9DSywgIl9fcHRocmVhZF9jb25kX2lu
aXQiKTsKKworICBSZWxlYXNlUmVzb3VyY2VMb2NrIChMT0NLX0NPTkRfTElT
VCwgV1JJVEVfTE9DSyB8IFJFQURfTE9DSywgIl9fcHRocmVhZF9jb25kX2lu
aXQiKTsKKyAgcmV0dXJuIDA7CisKK30KKworaW50IF9fcHRocmVhZF9jb25k
X2Jyb2FkY2FzdChwdGhyZWFkX2NvbmRfdCAqY29uZCkKK3sKKyAgR0VUQ09O
RCgiX3B0aHJlYWRfY29uZF9sb2NrIik7CisgIAorICBpdGVtLT5Ccm9hZENh
c3QoKTsKKworICByZXR1cm4gMDsKK30KKworaW50IF9fcHRocmVhZF9jb25k
X3NpZ25hbChwdGhyZWFkX2NvbmRfdCAqY29uZCkKK3sKKyAgR0VUQ09ORCgi
X3B0aHJlYWRfY29uZF9sb2NrIik7CisKKyAgaXRlbS0+U2lnbmFsKCk7CisK
KyAgcmV0dXJuIDA7Cit9CisKK2ludCBfX3B0aHJlYWRfY29uZF90aW1lZHdh
aXQocHRocmVhZF9jb25kX3QgKmNvbmQsIHB0aHJlYWRfbXV0ZXhfdCAqbXV0
ZXgsIGNvbnN0IHN0cnVjdCB0aW1lc3BlYyAqYWJzdGltZSkKK3sKKyAgaW50
IHJ2OworICBpZiAoIWFic3RpbWUpCisgICAgcmV0dXJuIEVJTlZBTDsKKyAg
U2V0UmVzb3VyY2VMb2NrIChMT0NLX01VVEVYX0xJU1QsIFJFQURfTE9DSywg
Il9wdGhlcmFkX211dGV4X2xvY2siKTsKKyAgTXV0ZXhJdGVtKiBtdXRleGl0
ZW09dXNlcl9kYXRhLT50aHJlYWRpbnRlcmZhY2UtPkdldE11dGV4IChtdXRl
eCk7CisgIFJlbGVhc2VSZXNvdXJjZUxvY2sgKExPQ0tfTVVURVhfTElTVCwg
UkVBRF9MT0NLLCAiX3B0aGVyYWRfbXV0ZXhfbG9jayIpOworICBpZiAoIW11
dGV4aXRlbSkgcmV0dXJuIEVJTlZBTDsKKyAgaWYgKCFtdXRleGl0ZW0tPkhh
bmRsZU9rZSAoKSkKKyAgeworICAgIHJldHVybiBFSU5WQUw7CisgIH0KKyAg
R0VUQ09ORCgiX3B0aHJlYWRfY29uZF9sb2NrIik7CisgIGlmIChpdGVtLT5t
dXRleGl0ZW0gJiYgKGl0ZW0tPm11dGV4aXRlbSAhPSBtdXRleGl0ZW0pKQor
ICAgIHJldHVybiBFSU5WQUw7CisKKyAgaXRlbS0+bXV0ZXhpdGVtPW11dGV4
aXRlbTsKKyAgSW50ZXJsb2NrZWRJbmNyZW1lbnQoJml0ZW0tPndhaXRpbmcp
OworICBydiA9IGl0ZW0tPlRpbWVkV2FpdChhYnN0aW1lLT50dl9zZWMqMTAw
MCk7CisgIG11dGV4aXRlbS0+TG9jaygpOworICBpZiAoSW50ZXJsb2NrZWRE
ZWNyZW1lbnQoJml0ZW0tPndhaXRpbmcpPT0wKQorICAgIGl0ZW0tPm11dGV4
aXRlbT1OVUxMOworCisgIHJldHVybiBydjsKK30KKworaW50IF9fcHRocmVh
ZF9jb25kX3dhaXQocHRocmVhZF9jb25kX3QgKmNvbmQsIHB0aHJlYWRfbXV0
ZXhfdCAqbXV0ZXgpCit7IAorICBpbnQgcnY7CisgIFNldFJlc291cmNlTG9j
ayAoTE9DS19NVVRFWF9MSVNULCBSRUFEX0xPQ0ssICJfcHRoZXJhZF9tdXRl
eF9sb2NrIik7IAorICBNdXRleEl0ZW0qIG11dGV4aXRlbT11c2VyX2RhdGEt
PnRocmVhZGludGVyZmFjZS0+R2V0TXV0ZXggKG11dGV4KTsgCisgIFJlbGVh
c2VSZXNvdXJjZUxvY2sgKExPQ0tfTVVURVhfTElTVCwgUkVBRF9MT0NLLCAi
X3B0aGVyYWRfbXV0ZXhfbG9jayIpOyAKKyAgaWYgKCFtdXRleGl0ZW0pIHJl
dHVybiBFSU5WQUw7ICAKKyAgaWYgKCFtdXRleGl0ZW0tPkhhbmRsZU9rZSAo
KSkKKyAgeyAKKyAgICByZXR1cm4gRUlOVkFMOyAKKyAgfQorICBHRVRDT05E
KCJfcHRocmVhZF9jb25kX2xvY2siKTsKKyAgaWYgKGl0ZW0tPm11dGV4aXRl
bSAmJiAoaXRlbS0+bXV0ZXhpdGVtICE9IG11dGV4aXRlbSkpCisgICAgcmV0
dXJuIEVJTlZBTDsKKyAgCisgIGl0ZW0tPm11dGV4aXRlbT1tdXRleGl0ZW07
CisgIEludGVybG9ja2VkSW5jcmVtZW50KCZpdGVtLT53YWl0aW5nKTsKKyAg
cnYgPSBpdGVtLT5XYWl0KCk7ICAKKyAgbXV0ZXhpdGVtLT5Mb2NrKCk7Cisg
IGlmIChJbnRlcmxvY2tlZERlY3JlbWVudCgmaXRlbS0+d2FpdGluZyk9PTAp
CisgICAgaXRlbS0+bXV0ZXhpdGVtPU5VTEw7CisgCisgIHJldHVybiBydjsK
K30KKworaW50CitfX3B0aHJlYWRfY29uZGF0dHJfaW5pdCAocHRocmVhZF9j
b25kYXR0cl90ICogY29uZGF0dHIpCit7CisgIGNvbmRhdHRyLT5zaGFyZWQg
PSAwOworICBjb25kYXR0ci0+dmFsaWQgID0gMHhmMzQxOyAvKiBSb2JlcnRz
IG1hZ2ljIG51bWJlciAqLworICByZXR1cm4gMDsKK30KKworaW50CitfX3B0
aHJlYWRfY29uZGF0dHJfZ2V0cHNoYXJlZCAoY29uc3QgcHRocmVhZF9jb25k
YXR0cl90ICogYXR0ciwgaW50ICpwc2hhcmVkKQoreworICBpZiAoIWF0dHIg
fHwgKGF0dHItPnZhbGlkICE9IDB4ZjM0MSkpCisgICAgcmV0dXJuIEVJTlZB
TDsKKyAgKnBzaGFyZWQgPSBhdHRyLT5zaGFyZWQ7CisgIHJldHVybiAwOwor
fQorCitpbnQKK19fcHRocmVhZF9jb25kYXR0cl9zZXRwc2hhcmVkIChwdGhy
ZWFkX2NvbmRhdHRyX3QgKiBhdHRyLCBpbnQgcHNoYXJlZCkKK3sKKyAgaWYg
KCFhdHRyIHx8IChhdHRyLT52YWxpZCAhPSAweGYzNDEpIHx8IChwc2hhcmVk
IDwwKSB8fCAocHNoYXJlZCA+IDEgKSkKKyAgICByZXR1cm4gRUlOVkFMOwor
ICBhdHRyLT5zaGFyZWQgPSBwc2hhcmVkOworICByZXR1cm4gMDsKK30KKwor
aW50CitfX3B0aHJlYWRfY29uZGF0dHJfZGVzdHJveSAocHRocmVhZF9jb25k
YXR0cl90ICogY29uZGF0dHIpCit7CisgIGlmICghY29uZGF0dHIgfHwgKGNv
bmRhdHRyLT52YWxpZCAhPSAweGYzNDEpKQorICAgICAgcmV0dXJuIEVJTlZB
TDsKKyAgY29uZGF0dHItPnZhbGlkPTA7CisgIHJldHVybiAwOworfQorCiAv
KiBUaHJlYWQgc2lnbmFsICovCiBpbnQKIF9fcHRocmVhZF9raWxsIChwdGhy
ZWFkX3QgKiB0aHJlYWQsIGludCBzaWcpCkBAIC02OTMsNyArOTIwLDYgQEAg
X19wdGhyZWFkX2tpbGwgKHB0aHJlYWRfdCAqIHRocmVhZCwgaW50IAogCiAv
LyB1bmxvY2sgbXlzZWxmCiAgIHJldHVybiBydmFsOwotCiB9CiAKIGludApA
QCAtOTUzLDYgKzExNzksNDYgQEAgZXh0ZXJuICJDIgogICAgIHJldHVybiAt
MTsKICAgfQogICBpbnQgX19wdGhyZWFkX211dGV4X2Rlc3Ryb3kgKHB0aHJl
YWRfbXV0ZXhfdCAqKQorICB7CisgICAgcmV0dXJuIC0xOworICB9CisgIGlu
dCBfX3B0aHJlYWRfY29uZF9kZXN0cm95KHB0aHJlYWRfY29uZF90ICopCisg
IHsKKyAgICByZXR1cm4gLTE7CisgIH0KKyAgaW50IF9fcHRocmVhZF9jb25k
X2luaXQocHRocmVhZF9jb25kX3QgKiwgY29uc3QgcHRocmVhZF9jb25kYXR0
cl90ICopCisgIHsKKyAgICByZXR1cm4gLTE7CisgIH0KKyAgaW50IF9fcHRo
cmVhZF9jb25kX3NpZ25hbChwdGhyZWFkX2NvbmRfdCAqKQorICB7CisgICAg
cmV0dXJuIC0xOworICB9CisgIGludCBfX3B0aHJlYWRfY29uZF9icm9hZGNh
c3QocHRocmVhZF9jb25kX3QgKikKKyAgeworICAgIHJldHVybiAtMTsKKyAg
fQorICBpbnQgX19wdGhyZWFkX2NvbmRfdGltZWR3YWl0KHB0aHJlYWRfY29u
ZF90ICosIHB0aHJlYWRfbXV0ZXhfdCAqLCBjb25zdCBzdHJ1Y3QgdGltZXNw
ZWMgKikKKyAgeworICAgIHJldHVybiAtMTsKKyAgfQorICBpbnQgX19wdGhy
ZWFkX2NvbmRfd2FpdChwdGhyZWFkX2NvbmRfdCAqLCBwdGhyZWFkX211dGV4
X3QgKikKKyAgeworICAgIHJldHVybiAtMTsKKyAgfQorICBpbnQgX19wdGhy
ZWFkX2NvbmRhdHRyX2luaXQgKHB0aHJlYWRfY29uZGF0dHJfdCAqKQorICB7
CisgICAgcmV0dXJuIC0xOworICB9CisgIGludCBfX3B0aHJlYWRfY29uZGF0
dHJfZGVzdHJveSAocHRocmVhZF9jb25kYXR0cl90ICopCisgIHsKKyAgICBy
ZXR1cm4gLTE7CisgIH0KKyAgaW50IF9fcHRocmVhZF9jb25kYXR0cl9nZXRw
c2hhcmVkIChwdGhyZWFkX2NvbmRhdHRyX3QgKiwgaW50ICopCisgIHsKKyAg
ICByZXR1cm4gLTE7CisgIH0KKyAgaW50IF9fcHRocmVhZF9jb25kYXR0cl9z
ZXRwc2hhcmVkIChwdGhyZWFkX2NvbmRhdHRyX3QgKiwgaW50KQogICB7CiAg
ICAgcmV0dXJuIC0xOwogICB9CkluZGV4OiBjeWd3aW4vdGhyZWFkLmgKPT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2N2cy9zcmMvc3JjL3dp
bnN1cC9jeWd3aW4vdGhyZWFkLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEu
OApkaWZmIC11IC1wIC1yMS44IHRocmVhZC5oCi0tLSB0aHJlYWQuaAkyMDAw
LzEwLzE2IDIzOjU1OjU3CTEuOAorKysgdGhyZWFkLmgJMjAwMS8wMy8xNiAy
Mjo1ODoxNQpAQCAtMjAsNiArMjAsNyBAQCBkZXRhaWxzLiAqLwogI2RlZmlu
ZSBMT0NLX1RIUkVBRF9MSVNUIDUKICNkZWZpbmUgTE9DS19NVVRFWF9MSVNU
ICA2CiAjZGVmaW5lIExPQ0tfU0VNX0xJU1QgICAgNworI2RlZmluZSBMT0NL
X0NPTkRfTElTVCAgIDgKIAogI2RlZmluZSBXUklURV9MT0NLIDEKICNkZWZp
bmUgUkVBRF9MT0NLICAyCkBAIC0xOTAsNiArMTkxLDE3IEBAIHB1YmxpYzoK
ICAgaW50IFRyeVdhaXQgKCk7CiB9OwogCitjbGFzcyBDb25kSXRlbTogcHVi
bGljIE1UaXRlbQoreworcHVibGljOgorICBpbnQgc2hhcmVkOworICBMT05H
IHdhaXRpbmc7CisgIE11dGV4SXRlbSAqbXV0ZXhpdGVtOworICBpbnQgV2Fp
dCAoKTsKKyAgaW50IFRpbWVkV2FpdCAoRFdPUkQgZHdNaWxsaXNlY29uZHMp
OworICBpbnQgQnJvYWRDYXN0ICgpOworICBpbnQgU2lnbmFsICgpOworfTsK
IAogdHlwZWRlZiBzdHJ1Y3QKIHsKQEAgLTIyNiw2ICsyMzgsMTAgQEAgcHVi
bGljOgogICBTZW1hcGhvcmVJdGVtICpDcmVhdGVTZW1hcGhvcmUgKHNlbV90
ICosIGludCwgaW50KTsKICAgU2VtYXBob3JlSXRlbSAqR2V0U2VtYXBob3Jl
IChzZW1fdCAqIHQpOwogCisgIC8vIENvbmRpdGlvbiBmdW5jdGlvbnMKKyAg
Q29uZEl0ZW0gKkNyZWF0ZUNvbmQgKHB0aHJlYWRfY29uZF90ICosIGNvbnN0
IHB0aHJlYWRfY29uZGF0dHJfdCAqKTsgCisgIENvbmRJdGVtICpHZXRDb25k
IChwdGhyZWFkX2NvbmRfdCAqKTsKKwogcHJpdmF0ZToKICAgLy8gR2VuZXJh
bCBBZG1pbmlzdHJhdGlvbgogICBNVGl0ZW0gKiBGaW5kICh2b2lkICosIGlu
dCAoKmNvbXBhcmUpICh2b2lkICosIHZvaWQgKiksIGludCAmLCBNVExpc3Qg
Kik7CkBAIC0yMzcsNiArMjUzLDcgQEAgcHJpdmF0ZToKICAgTVRMaXN0IHRo
cmVhZGxpc3Q7CiAgIE1UTGlzdCBtdXRleGxpc3Q7CiAgIE1UTGlzdCBzZW1h
bGlzdDsKKyAgTVRMaXN0IGNvbmRsaXN0OwogfTsKIAogCkBAIC0yNzQsNiAr
MjkxLDE3IEBAIGludCBfX3B0aHJlYWRfa2V5X2RlbGV0ZSAocHRocmVhZF9r
ZXlfdCAKIGludCBfX3B0aHJlYWRfc2V0c3BlY2lmaWMgKHB0aHJlYWRfa2V5
X3QgKiBrZXksIGNvbnN0IHZvaWQgKnZhbHVlKTsKIHZvaWQgKl9fcHRocmVh
ZF9nZXRzcGVjaWZpYyAocHRocmVhZF9rZXlfdCAqIGtleSk7CiAKKy8qIFRo
ZWFkIHN5bmNocm9uaWF0aW9uICovCitpbnQgX19wdGhyZWFkX2NvbmRfZGVz
dHJveShwdGhyZWFkX2NvbmRfdCAqY29uZCk7CitpbnQgX19wdGhyZWFkX2Nv
bmRfaW5pdChwdGhyZWFkX2NvbmRfdCAqY29uZCwgY29uc3QgcHRocmVhZF9j
b25kYXR0cl90ICphdHRyKTsKK2ludCBfX3B0aHJlYWRfY29uZF9zaWduYWwo
cHRocmVhZF9jb25kX3QgKmNvbmQpOworaW50IF9fcHRocmVhZF9jb25kX2Jy
b2FkY2FzdChwdGhyZWFkX2NvbmRfdCAqY29uZCk7CitpbnQgX19wdGhyZWFk
X2NvbmRfdGltZWR3YWl0KHB0aHJlYWRfY29uZF90ICpjb25kLCBwdGhyZWFk
X211dGV4X3QgKm11dGV4LCBjb25zdCBzdHJ1Y3QgdGltZXNwZWMgKmFic3Rp
bWUpOworaW50IF9fcHRocmVhZF9jb25kX3dhaXQocHRocmVhZF9jb25kX3Qg
KmNvbmQsIHB0aHJlYWRfbXV0ZXhfdCAqbXV0ZXgpOworaW50IF9fcHRocmVh
ZF9jb25kYXR0cl9pbml0IChwdGhyZWFkX2NvbmRhdHRyX3QgKiBjb25kYXR0
cik7CitpbnQgX19wdGhyZWFkX2NvbmRhdHRyX2Rlc3Ryb3kgKHB0aHJlYWRf
Y29uZGF0dHJfdCAqIGNvbmRhdHRyKTsKK2ludCBfX3B0aHJlYWRfY29uZGF0
dHJfZ2V0cHNoYXJlZCAoY29uc3QgcHRocmVhZF9jb25kYXR0cl90ICphdHRy
LCBpbnQgKnBzaGFyZWQpOworaW50IF9fcHRocmVhZF9jb25kYXR0cl9zZXRw
c2hhcmVkIChwdGhyZWFkX2NvbmRhdHRyX3QgKmF0dHIsIGludCBwc2hhcmVk
KTsKIAogLyogVGhyZWFkIHNpZ25hbCAqLwogaW50IF9fcHRocmVhZF9raWxs
IChwdGhyZWFkX3QgKiB0aHJlYWQsIGludCBzaWcpOwpJbmRleDogY3lnd2lu
L2luY2x1ZGUvcHRocmVhZC5oCj09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNT
IGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvcHRo
cmVhZC5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjIKZGlmZiAtdSAtcCAt
cjEuMiBwdGhyZWFkLmgKLS0tIHB0aHJlYWQuaAkyMDAwLzA1LzA4IDIyOjM4
OjA3CTEuMgorKysgcHRocmVhZC5oCTIwMDEvMDMvMTYgMjI6NTg6MTUKQEAg
LTIzLDYgKzIzLDE2IEBAIGV4dGVybiAiQyIKIAogI2RlZmluZSBURkQobikg
dm9pZCooKm4pKHZvaWQqKQogCisvKiBEZWZpbmVzLiAoVGhlc2UgYXJlIGNv
cnJlY3RseSBkZWZpbmVkIGhlcmUgYXMgcGVyCisgICBodHRwOi8vd3d3Lm9w
ZW5ncm91cC5vcmcvb25saW5lcHVicy83OTA4Nzk5L3hzaC9wdGhyZWFkLmgu
aHRtbCAqLworCisvKiBGSVhNRTogdGhpcyBzaG91bGQgYWxsb2NhdGUgYSBu
ZXcgY29uZCB2YXJpYWJsZSwgYW5kIHJldHVybiB0aGUgdmFsdWUgIHRoYXQK
KyB3b3VsZCBub3JtYWxseSBiZSB3cml0dGVuIHRvIHRoZSBwYXNzZWQgcGFy
YW1ldGVyIG9mIHB0aHJlYWRfY29uZF9pbml0KGx2YWx1ZSwgTlVMTCk7ICov
CisvLyAjZGVmaW5lIFBUSFJFQURfQ09ORF9JTklUSUFMSVpFUiAwCisKKyNk
ZWZpbmUgUFRIUkVBRF9QUk9DRVNTX1BSSVZBVEUgMAorI2RlZmluZSBQVEhS
RUFEX1BST0NFU1NfU0hBUkVEICAxCisKIHR5cGVkZWYgaW50IHB0aHJlYWRf
dDsKIHR5cGVkZWYgaW50IHB0aHJlYWRfbXV0ZXhfdDsKIHR5cGVkZWYgaW50
IHNlbV90OwpAQCAtNDMsMTIgKzUzLDM1IEBAIHR5cGVkZWYgc3RydWN0IHB0
aHJlYWRfbXV0ZXhhdHRyCiAgIH0KIHB0aHJlYWRfbXV0ZXhhdHRyX3Q7CiAK
K3R5cGVkZWYgc3RydWN0IHB0aHJlYWRfY29uZGF0dHIKKyAgeworICAgIGlu
dCBzaGFyZWQ7CisgICAgaW50IHZhbGlkOworICB9CitwdGhyZWFkX2NvbmRh
dHRyX3Q7CisKK3R5cGVkZWYgaW50IHB0aHJlYWRfY29uZF90OworCiAvKiAg
VGhyZWFkQ3JlYXRpb24gKi8KIGludCBwdGhyZWFkX2NyZWF0ZSAocHRocmVh
ZF90ICogdGhyZWFkLCBjb25zdCBwdGhyZWFkX2F0dHJfdCAqIGF0dHIsIFRG
RCAoZnVuY3Rpb24pLCB2b2lkICphcmcpOwogaW50IHB0aHJlYWRfYXR0cl9p
bml0IChwdGhyZWFkX2F0dHJfdCAqIGF0dHIpOwogaW50IHB0aHJlYWRfYXR0
cl9kZXN0cm95IChwdGhyZWFkX2F0dHJfdCAqIGF0dHIpOwogaW50IHB0aHJl
YWRfYXR0cl9zZXRzdGFja3NpemUgKHB0aHJlYWRfYXR0cl90ICogYXR0ciwg
c2l6ZV90IHNpemUpOwogaW50IHB0aHJlYWRfYXR0cl9nZXRzdGFja3NpemUg
KHB0aHJlYWRfYXR0cl90ICogYXR0ciwgc2l6ZV90ICogc2l6ZSk7CisKKy8q
IENvbmRpdGlvbiB2YXJpYWJsZXMgKi8KK2ludCAgIHB0aHJlYWRfY29uZF9i
cm9hZGNhc3QocHRocmVhZF9jb25kX3QgKik7CitpbnQgICBwdGhyZWFkX2Nv
bmRfZGVzdHJveShwdGhyZWFkX2NvbmRfdCAqKTsKK2ludCAgIHB0aHJlYWRf
Y29uZF9pbml0KHB0aHJlYWRfY29uZF90ICosIGNvbnN0IHB0aHJlYWRfY29u
ZGF0dHJfdCAqKTsKK2ludCAgIHB0aHJlYWRfY29uZF9zaWduYWwocHRocmVh
ZF9jb25kX3QgKik7CitpbnQgICBwdGhyZWFkX2NvbmRfdGltZWR3YWl0KHB0
aHJlYWRfY29uZF90ICosIAorICAgICAgICAgIHB0aHJlYWRfbXV0ZXhfdCAq
LCBjb25zdCBzdHJ1Y3QgdGltZXNwZWMgKik7CitpbnQgICBwdGhyZWFkX2Nv
bmRfd2FpdChwdGhyZWFkX2NvbmRfdCAqLCBwdGhyZWFkX211dGV4X3QgKik7
CitpbnQgICBwdGhyZWFkX2NvbmRhdHRyX2Rlc3Ryb3kocHRocmVhZF9jb25k
YXR0cl90ICopOworaW50ICAgcHRocmVhZF9jb25kYXR0cl9nZXRwc2hhcmVk
KGNvbnN0IHB0aHJlYWRfY29uZGF0dHJfdCAqLCBpbnQgKik7CitpbnQgICBw
dGhyZWFkX2NvbmRhdHRyX2luaXQocHRocmVhZF9jb25kYXR0cl90ICopOwor
aW50ICAgcHRocmVhZF9jb25kYXR0cl9zZXRwc2hhcmVkKHB0aHJlYWRfY29u
ZGF0dHJfdCAqLCBpbnQpOworCiAKIC8qIFRocmVhZCBDb250cm9sICovCiBp
bnQgcHRocmVhZF9kZXRhY2ggKHB0aHJlYWRfdCB0aHJlYWQpOwo=

------------=_1583532846-65438-21--
