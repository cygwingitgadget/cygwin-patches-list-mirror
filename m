Return-Path: <cygwin-patches-return-1907-listarch-cygwin-patches=sourceware.cygnus.com@cygwin.com>
Received: (qmail 27996 invoked by alias); 26 Feb 2002 12:12:55 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sources.redhat.com/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sources.redhat.com/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Received: (qmail 27935 invoked from network); 26 Feb 2002 12:12:49 -0000
content-class: urn:content-classes:message
Subject: RE: help/version patches
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Date: Tue, 26 Feb 2002 04:38:00 -0000
Message-ID: <FC169E059D1A0442A04C40F86D9BA76008AABC@itdomain003.itdomain.net.au>
X-MimeOLE: Produced By Microsoft Exchange V6.0.5762.3
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: help/version patches
Thread-Index: AcG+cw4JYx/F/oNHSxW71A/ngygsUAAStvuw
From: "Robert Collins" <robert.collins@itdomain.com.au>
To: "Joshua Daniel Franklin" <joshuadfranklin@yahoo.com>
Cc: <cygwin-patches@cygwin.com>
X-SW-Source: 2002-q1/txt/msg00264.txt.bz2



> -----Original Message-----
> From: Joshua Daniel Franklin [mailto:joshuadfranklin@yahoo.com]=20

It's not - strace is manually entered version info.=20
=20
> Anyway here is a patch for cygcheck that I think does the=20
> right thing. Somebody want to take a look?

+const char *revision=3D"$Revision: 1.22 $";

This is suspect: The revision string can look like $Revision:$ in some circ=
umstances - see man co again - which is why I had "$Revision: $ " - note th=
e space after the second $ sign.

Likewise, the=20
+  /* Get version number out of the autogenerated revision string  */
+  (void *) version =3D malloc(sizeof(revision));
+  strcpy(version, revision+11);
+  version[strlen(version)-1]=3D 0;

Could be more robustly done as=20
+  version =3D (char *) malloc(sizeof(revision));
+  strcpy(version, revision+11);
+  {
+    char *temp=3Dversion + strlen (version);
+    while (isspace(--temp) && temp >=3D version);
+    temp[1]=3D'\0';
+  }

Which will munch an arbitrary amount of whitespace.

Rob
