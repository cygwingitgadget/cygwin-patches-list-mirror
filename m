Return-Path: <takashi.yano@nifty.ne.jp>
Received: from conssluserg-03.nifty.com (conssluserg-03.nifty.com
 [210.131.2.82])
 by sourceware.org (Postfix) with ESMTPS id C5CB63861011
 for <cygwin-patches@cygwin.com>; Sat, 29 Aug 2020 13:14:40 +0000 (GMT)
DMARC-Filter: OpenDMARC Filter v1.3.2 sourceware.org C5CB63861011
Received: from Express5800-S70 (v038192.dynamic.ppp.asahi-net.or.jp
 [124.155.38.192]) (authenticated)
 by conssluserg-03.nifty.com with ESMTP id 07TDE7rN031409
 for <cygwin-patches@cygwin.com>; Sat, 29 Aug 2020 22:14:07 +0900
DKIM-Filter: OpenDKIM Filter v2.10.3 conssluserg-03.nifty.com 07TDE7rN031409
X-Nifty-SrcIP: [124.155.38.192]
Date: Sat, 29 Aug 2020 22:14:20 +0900
From: Takashi Yano <takashi.yano@nifty.ne.jp>
To: cygwin-patches@cygwin.com
Subject: Re: [PATCH] Cygwin: pty: Disable pseudo console if TERM is dumb or
 not set.
Message-Id: <20200829221420.65bf54f2848c30c5415fbf29@nifty.ne.jp>
In-Reply-To: <20200829201228.b327d38eab10a64d941f99c0@nifty.ne.jp>
References: <20200826120015.1188-1-takashi.yano@nifty.ne.jp>
 <20200828134503.GL3272@calimero.vinschen.de>
 <20200829042554.e18de504a93bb80da347e858@nifty.ne.jp>
 <20200829201228.b327d38eab10a64d941f99c0@nifty.ne.jp>
X-Mailer: Sylpheed 3.7.0 (GTK+ 2.24.30; i686-pc-mingw32)
Mime-Version: 1.0
Content-Type: multipart/mixed;
 boundary="Multipart=_Sat__29_Aug_2020_22_14_20_+0900_iOm_mrNGDSf6mt=="
X-Spam-Status: No, score=-2.4 required=5.0 tests=BAYES_00, DKIM_SIGNED,
 DKIM_VALID, DKIM_VALID_AU, DKIM_VALID_EF, NICE_REPLY_A,
 RCVD_IN_BARRACUDACENTRAL, RCVD_IN_DNSWL_NONE, RCVD_IN_MSPIKE_H3,
 RCVD_IN_MSPIKE_WL, SPF_HELO_NONE, SPF_PASS,
 TXREP autolearn=no autolearn_force=no version=3.4.2
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on
 server2.sourceware.org
X-BeenThere: cygwin-patches@cygwin.com
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Cygwin core component patch submission and discussion
 <cygwin-patches.cygwin.com>
List-Unsubscribe: <https://cygwin.com/mailman/options/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=unsubscribe>
List-Archive: <https://cygwin.com/pipermail/cygwin-patches/>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Help: <mailto:cygwin-patches-request@cygwin.com?subject=help>
List-Subscribe: <https://cygwin.com/mailman/listinfo/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=subscribe>
X-List-Received-Date: Sat, 29 Aug 2020 13:14:44 -0000

This is a multi-part message in MIME format.

--Multipart=_Sat__29_Aug_2020_22_14_20_+0900_iOm_mrNGDSf6mt==
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Sat, 29 Aug 2020 20:12:28 +0900
Takashi Yano via Cygwin-patches <cygwin-patches@cygwin.com> wrote:
> Hi Corinna,
> 
> On Sat, 29 Aug 2020 04:25:54 +0900
> Takashi Yano via Cygwin-patches <cygwin-patches@cygwin.com> wrote:
> > Hi Corinna,
> >
> > On Fri, 28 Aug 2020 15:45:03 +0200
> > Corinna Vinschen wrote:
> > > Hi Takashi,
> > > 
> > > On Aug 26 21:00, Takashi Yano via Cygwin-patches wrote:
> > > > Pseudo console generates escape sequences on execution of non-cygwin
> > > > apps.  If the terminal does not support escape sequence, output will
> > > > be garbled. This patch prevents garbled output in dumb terminal by
> > > > disabling pseudo console.
> [...]
> > > 
> > > Would you mind to encapsulate the TERM checks into a fhandler_pty_slave
> > > method so the TERM specific stuff is done in the fhandler code, not
> > > in spawn.cc?
> > 
> > Thansk for the suggestion. I will submit v2 patch.
> 
> What do you think of v3 patch attached? With this patch,
> terminal capability is checked by looking into terminfo
> database rather than just checking terminal name. This
> solution is more essential for the issue to be solved,
> I think.
> 
> One downside of this solution, I noticed, is that tmux
> sets TERM to "screen", which does not have CSI6n, by
> default. As a result, pseudo console is disbled in tmux
> by default. Setting TERM, such as screen.xterm-256color,
> will solve the issue.

Attached is the v4 patch. Small bug was fixed.

-- 
Takashi Yano <takashi.yano@nifty.ne.jp>

--Multipart=_Sat__29_Aug_2020_22_14_20_+0900_iOm_mrNGDSf6mt==
Content-Type: application/octet-stream;
 name="v4-0001-Cygwin-pty-Disable-pseudo-console-if-TERM-does-no.patch"
Content-Disposition: attachment;
 filename="v4-0001-Cygwin-pty-Disable-pseudo-console-if-TERM-does-no.patch"
Content-Transfer-Encoding: base64

RnJvbSAzNzhjOTMzN2YwOGFhMmE0YTcwYzliYmI0YmFiN2EwMGQ5YzdmY2ZmIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBUYWthc2hpIFlhbm8gPHRha2FzaGkueWFub0BuaWZ0eS5uZS5q
cD4KRGF0ZTogU2F0LCAyOSBBdWcgMjAyMCAyMTo1OTozMiArMDkwMApTdWJqZWN0OiBbUEFUQ0gg
djRdIEN5Z3dpbjogcHR5OiBEaXNhYmxlIHBzZXVkbyBjb25zb2xlIGlmIFRFUk0gZG9lcyBub3Qg
aGF2ZQogQ1NJNm4uCgotIFBzZXVkbyBjb25zb2xlIGludGVybmFsbHkgc2VuZHMgZXNjYXBlIHNl
cXVlbmNlIENTSTZuIChxdWVyeSBjdXJzb3IKICBwb3NpdGlvbikgb24gc3RhcnR1cCBvZiBub24t
Y3lnd2luIGFwcHMuIElmIHRoZSB0ZXJtaW5hbCBkb2VzIG5vdAogIHN1cHBvcnQgQ1NJNm4sIENy
ZWF0ZVByb2Nlc3MoKSBoYW5ncyB3YWl0aW5nIGZvciByZXNwb25zZS4gVG8gcHJldmVudAogIGhh
bmcsIHRoaXMgcGF0Y2ggZGlzYWJsZXMgcHNldWRvIGNvbnNvbGUgaWYgdGhlIHRlcm1pbmFsIGRv
ZXMgbm90CiAgaGF2ZSBDU0k2biBpbiB0ZXJtaW5mbyBkYXRhYmFzZS4gQWxzbywgcmVtb3ZlcyBl
c2NhcGUgc2VxdWVuY2UgZm9yCiAgc2V0dGluZyB3aW5kb3cgdGl0bGUgaWYgdGhlIHRlcm1pbmFs
IGRvZXMgbm90IGhhdmUgdGhlIHNldC10aXRsZQogIGNhcGFiaWxpdHkuCi0tLQogd2luc3VwL2N5
Z3dpbi9maGFuZGxlci5oICAgICAgfCAgIDEgKwogd2luc3VwL2N5Z3dpbi9maGFuZGxlcl90dHku
Y2MgfCAxMjUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogd2luc3VwL2N5Z3dp
bi9zcGF3bi5jYyAgICAgICAgfCAgMTkgKysrKy0tCiB3aW5zdXAvY3lnd2luL3R0eS5jYyAgICAg
ICAgICB8ICAgMSArCiB3aW5zdXAvY3lnd2luL3R0eS5oICAgICAgICAgICB8ICAgMSArCiA1IGZp
bGVzIGNoYW5nZWQsIDE0MCBpbnNlcnRpb25zKCspLCA3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaCBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaApp
bmRleCA5ZmQ5NWMwOTguLmY1NWJjZjlkMSAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9maGFu
ZGxlci5oCisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaApAQCAtMjMzMiw2ICsyMzMyLDcg
QEAgY2xhc3MgZmhhbmRsZXJfcHR5X3NsYXZlOiBwdWJsaWMgZmhhbmRsZXJfcHR5X2NvbW1vbgog
ICB9CiAgIGJvb2wgc2V0dXBfcHNldWRvY29uc29sZSAoU1RBUlRVUElORk9FWFcgKnNpLCBib29s
IG5vcGNvbik7CiAgIHZvaWQgY2xvc2VfcHNldWRvY29uc29sZSAodm9pZCk7CisgIGJvb2wgdGVy
bV9oYXNfcGNvbl9jYXAgKGNvbnN0IFdDSEFSICplbnYsIGJvb2wgYmcpOwogICB2b2lkIHNldF9z
d2l0Y2hfdG9fcGNvbiAodm9pZCk7CiAgIHZvaWQgcmVzZXRfc3dpdGNoX3RvX3Bjb24gKHZvaWQp
OwogICB2b2lkIG1hc2tfc3dpdGNoX3RvX3Bjb25faW4gKGJvb2wgbWFzayk7CmRpZmYgLS1naXQg
YS93aW5zdXAvY3lnd2luL2ZoYW5kbGVyX3R0eS5jYyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJf
dHR5LmNjCmluZGV4IDA4NjVjMWZhYy4uODAwZjhmMGNmIDEwMDY0NAotLS0gYS93aW5zdXAvY3ln
d2luL2ZoYW5kbGVyX3R0eS5jYworKysgYi93aW5zdXAvY3lnd2luL2ZoYW5kbGVyX3R0eS5jYwpA
QCAtMjE2OSw2ICsyMTY5LDIyIEBAIGZoYW5kbGVyX3B0eV9tYXN0ZXI6OnB0eV9tYXN0ZXJfZndk
X3RocmVhZCAoKQogICAgICAgY2hhciAqcHRyID0gb3V0YnVmOwogICAgICAgaWYgKGdldF90dHlw
ICgpLT5oX3BzZXVkb19jb25zb2xlKQogCXsKKwkgIGlmICghZ2V0X3R0eXAgKCktPmhhc19zZXRf
dGl0bGUpCisJICAgIHsKKwkgICAgICAvKiBSZW1vdmUgU2V0IHRpdGxlIHNlcXVlbmNlICovCisJ
ICAgICAgY2hhciAqcDAsICpwMTsKKwkgICAgICBwMCA9IG91dGJ1ZjsKKwkgICAgICB3aGlsZSAo
KHAwID0gKGNoYXIgKikgbWVtbWVtIChwMCwgcmxlbiwgIlwwMzNdMDsiLCA0KSkpCisJCXsKKwkJ
ICBwMSA9IChjaGFyICopIG1lbWNociAocDAsICdcMDA3JywgcmxlbiAtIChwMCAtIG91dGJ1Zikp
OworCQkgIGlmIChwMSkKKwkJICAgIHsKKwkJICAgICAgbWVtbW92ZSAocDAsIHAxICsgMSwgcmxl
biAtIChwMSArIDEgLSBvdXRidWYpKTsKKwkJICAgICAgcmxlbiAtPSBwMSArIDEgLSBwMDsKKwkJ
ICAgICAgd2xlbiA9IHJsZW47CisJCSAgICB9CisJCX0KKwkgICAgfQogCSAgLyogUmVtb3ZlIENT
SSA+IFBtIG0gKi8KIAkgIGludCBzdGF0ZSA9IDA7CiAJICBpbnQgc3RhcnRfYXQgPSAwOwpAQCAt
MjY1OSwzICsyNjc1LDExMiBAQCBmaGFuZGxlcl9wdHlfc2xhdmU6OmNsb3NlX3BzZXVkb2NvbnNv
bGUgKHZvaWQpCiAgICAgICBnZXRfdHR5cCAoKS0+cGNvbl9zdGFydCA9IGZhbHNlOwogICAgIH0K
IH0KKworYm9vbAorZmhhbmRsZXJfcHR5X3NsYXZlOjp0ZXJtX2hhc19wY29uX2NhcCAoY29uc3Qg
V0NIQVIgKmVudiwgYm9vbCBiYWNrZ3JvdW5kKQoreworICBjb25zdCBjaGFyICp0ZXJtID0gTlVM
TDsKKyAgY2hhciB0ZXJtX3N0clsyNjBdOworICBpZiAoZW52KQorICAgIHsKKyAgICBmb3IgKGNv
bnN0IFdDSEFSICpwID0gZW52OyAqcCAhPSBMJ1wwJzsgcCArPSB3Y3NsZW4gKHApICsgMSkKKyAg
ICAgIGlmIChzd3NjYW5mIChwLCBMIlRFUk09JTIzNnMiLCB0ZXJtX3N0cikgPT0gMSkKKwl7CisJ
ICB0ZXJtID0gdGVybV9zdHI7CisJICBicmVhazsKKwl9CisgICAgfQorICBlbHNlCisgICAgdGVy
bSA9IGdldGVudiAoIlRFUk0iKTsKKworICBpZiAoIXRlcm0pCisgICAgcmV0dXJuIGZhbHNlOwor
CisgIC8qIENoZWNrIGlmIHRlcm1pbmFsIGhhcyBjYXBhYmlsaXR5IHdoaWNoIHB1c2VkbyBjb25z
b2xlIG5lZWRzICovCisgIGNoYXIgdGluZm9bMjYwXTsKKyAgX19zbWFsbF9zcHJpbnRmICh0aW5m
bywgIi91c3Ivc2hhcmUvdGVybWluZm8vJTAyeC8lcyIsIHRlcm1bMF0sIHRlcm0pOworICBwYXRo
X2NvbnYgcGF0aCAodGluZm8pOworICBXQ0hBUiB3dGluZm9bMjYwXTsKKyAgcGF0aC5nZXRfd2lk
ZV93aW4zMl9wYXRoICh3dGluZm8pOworICBIQU5ETEUgaDsKKyAgaCA9IENyZWF0ZUZpbGVXICh3
dGluZm8sIEdFTkVSSUNfUkVBRCwgRklMRV9TSEFSRV9SRUFELAorCQkgICBOVUxMLCBPUEVOX0VY
SVNUSU5HLCAwLCBOVUxMKTsKKyAgaWYgKGggPT0gTlVMTCkKKyAgICByZXR1cm4gZmFsc2U7Cisg
IGNoYXIgdGVybWluZm9bNDA5Nl07CisgIERXT1JEIG47CisgIFJlYWRGaWxlIChoLCB0ZXJtaW5m
bywgc2l6ZW9mICh0ZXJtaW5mbyksICZuLCAwKTsKKyAgQ2xvc2VIYW5kbGUgKGgpOworCisgIGlu
dCBudW1fc2l6ZSA9IDI7CisgIGlmICgqKGludDE2X3QgKil0ZXJtaW5mbyA9PSAwMTAzNiAvKiBN
QUdJQzIgKi8pCisgICAgbnVtX3NpemUgPSA0OworICBjb25zdCBpbnQgbmFtZV9wb3MgPSAxMjsg
LyogUG9zaXRpb24gb2YgdGVybWluYWwgbmFtZSAqLworICBjb25zdCBpbnQgbmFtZV9zaXplID0g
KihpbnQxNl90ICopICh0ZXJtaW5mbyArIDIpOworICBjb25zdCBpbnQgYm9vbF9jb3VudCA9ICoo
aW50MTZfdCAqKSAodGVybWluZm8gKyA0KTsKKyAgY29uc3QgaW50IG51bV9jb3VudCA9ICooaW50
MTZfdCAqKSAodGVybWluZm8gKyA2KTsKKyAgY29uc3QgaW50IHN0cl9jb3VudCA9ICooaW50MTZf
dCAqKSAodGVybWluZm8gKyA4KTsKKyAgY29uc3QgaW50IHN0cl9zaXplID0gKihpbnQxNl90ICop
ICh0ZXJtaW5mbyArIDEwKTsKKyAgY29uc3QgaW50IHVzZXI3ID0gMjk0OyAvKiB1NyAocXVlcnkg
Y3Vyc29yIHBvc2l0aW9uKSBlbnRyeSBpbmRleCAqLworICBpZiAodXNlcjcgPj0gc3RyX2NvdW50
KQorICAgIHJldHVybiBmYWxzZTsKKyAgaW50IHN0cl9pZHhfcG9zID0gbmFtZV9wb3MgKyBuYW1l
X3NpemUgKyBib29sX2NvdW50ICsgbnVtX3NpemUgKiBudW1fY291bnQ7CisgIGlmIChzdHJfaWR4
X3BvcyAmIDEpCisgICAgc3RyX2lkeF9wb3MgKys7CisgIGNvbnN0IGludDE2X3QgKnN0cl9pZHgg
PSAoaW50MTZfdCAqKSAodGVybWluZm8gKyBzdHJfaWR4X3Bvcyk7CisgIGNvbnN0IGNoYXIgKnN0
cl90YWJsZSA9IChjb25zdCBjaGFyICopIChzdHJfaWR4ICsgc3RyX2NvdW50KTsKKyAgaWYgKHN0
cl9pZHggKyB1c2VyNyA+PSAoaW50MTZfdCAqKSAodGVybWluZm8gKyBuKSkKKyAgICByZXR1cm4g
ZmFsc2U7CisgIGlmIChzdHJfaWR4W3VzZXI3XSA9PSAtMSkKKyAgICByZXR1cm4gZmFsc2U7Cisg
IGNvbnN0IGNoYXIgKnVzZXI3X3N0ciA9IHN0cl90YWJsZSArIHN0cl9pZHhbdXNlcjddOworICBp
ZiAodXNlcjdfc3RyID49IHN0cl90YWJsZSArIHN0cl9zaXplKQorICAgIHJldHVybiBmYWxzZTsK
KyAgaWYgKHVzZXI3X3N0ciA+PSB0ZXJtaW5mbyArIG4pCisgICAgcmV0dXJuIGZhbHNlOworICBp
ZiAoc3RyY21wICh1c2VyN19zdHIsICJcMDMzWzZuIikgPT0gMCkKKyAgICB7CisgICAgICAvKiBJ
ZiB0aGUgcHJvY2VzcyBpcyBiYWNrZ3JvdW5kLCBvciBhbm90aGVyIHByb2Nlc3MgaXMgYWxyZWFk
eQorCSBzdGFydGVkIHVuZGVyIHBzZXVkbyBjb25zb2xlLCByZXNwb25jZSBmb3IgQ1NJNm4gbWF5
IGJlIGVhdGVuCisJIGJ5IHRoZSBvdGhlciBwcm9jZXNzLiBUaGVyZWZvcmUsIGNoZWNraW5nIHNl
dC10aXRsZSBjYXBhYmlsaXR5CisJIHNob3VsZCBiZSBza2lwcGVkLiAqLworICAgICAgaWYgKGdl
dF90dHlwICgpLT5wY29uX3BpZCAmJiBnZXRfdHR5cCAoKS0+cGNvbl9waWQgIT0gbXlzZWxmLT5w
aWQKKwkgICYmICEhcGluZm8gKGdldF90dHlwICgpLT5wY29uX3BpZCkpCisJOyAvKiBEbyBub3Ro
aW5nICovCisgICAgICBlbHNlIGlmICghYmFja2dyb3VuZCkKKwl7CisJICAvKiBDaGVjayBpZiB0
ZXJtaW5hbCBoYXMgc2V0LXRpdGxlIGNhcGFiaWxpdHkgKi8KKwkgIERXT1JEIG47CisJICB0Y2Zs
YWdfdCBjX2xmbGFnID0gZ2V0X3R0eXAgKCktPnRpLmNfbGZsYWc7CisJICBnZXRfdHR5cCAoKS0+
dGkuY19sZmxhZyAmPSB+SUNBTk9OOworCSAgV3JpdGVGaWxlIChnZXRfb3V0cHV0X2hhbmRsZV9j
eWcgKCksCisJCSAgICAgIlwwMzNbNm5cMDMzXTA7XDAwN1wwMzNbNm4iLCAxMywgJm4sIE5VTEwp
OworCSAgY2hhciBidWZbXSA9ICJcMDMzWzMyNzY4OzMyNzY4UlwwMzNbMzI3Njg7MzI3NjhSIjsK
KwkgIGNoYXIgKnAgPSBidWY7CisJICBpbnQgbGVuID0gc2l6ZW9mIChidWYpIC0gMTsKKwkgIGlu
dCB4MSwgeTEsIHgyLCB5MjsKKwkgIGRvCisJICAgIHsKKwkgICAgICBSZWFkRmlsZSAoZ2V0X2hh
bmRsZV9jeWcgKCksIHAsIGxlbiwgJm4sIE5VTEwpOworCSAgICAgIHAgKz0gbjsKKwkgICAgICBs
ZW4gLT0gbjsKKwkgICAgICAqcCA9ICdcMCc7CisJICAgIH0KKwkgIHdoaWxlIChzc2NhbmYgKGJ1
ZiwgIlwwMzNbJWQ7JWRSXDAzM1slZDslZFIiLAorCQkJICZ5MSwgJngxLCAmeTIsICZ4MikgIT0g
NCk7CisJICBnZXRfdHR5cCAoKS0+dGkuY19sZmxhZyA9IGNfbGZsYWc7CisJICBpZiAoeDIgPT0g
eDEgJiYgeTIgPT0geTEpCisJICAgIC8qIElmICJcMDMzXTA7XDAwNyIgZG9lcyBub3QgbW92ZSBj
dXJzb3IgcG9zaXRpb24sCisJICAgICAgIHNldC10aXRsZSBpcyBzdXBwb3NlZCB0byBiZSBzdXBw
b3J0ZWQuICovCisJICAgIGdldF90dHlwICgpLT5oYXNfc2V0X3RpdGxlID0gdHJ1ZTsKKwkgIGVs
c2UKKwkgICAgeworCSAgICAgIGZvciAoaW50IGk9MDsgaTx4Mi14MTsgaSsrKQorCQlXcml0ZUZp
bGUgKGdldF9vdXRwdXRfaGFuZGxlX2N5ZyAoKSwgIlxiIFxiIiwgMywgJm4sIE5VTEwpOworCSAg
ICAgIGdldF90dHlwICgpLT5oYXNfc2V0X3RpdGxlID0gZmFsc2U7CisJICAgIH0KKwl9CisgICAg
ICByZXR1cm4gdHJ1ZTsKKyAgICB9CisgIHJldHVybiBmYWxzZTsKK30KZGlmZiAtLWdpdCBhL3dp
bnN1cC9jeWd3aW4vc3Bhd24uY2MgYi93aW5zdXAvY3lnd2luL3NwYXduLmNjCmluZGV4IGEyZjc2
OTdkNy4uOWE1ZTNmNmVmIDEwMDY0NAotLS0gYS93aW5zdXAvY3lnd2luL3NwYXduLmNjCisrKyBi
L3dpbnN1cC9jeWd3aW4vc3Bhd24uY2MKQEAgLTY0NywxMyArNjQ3LDE4IEBAIGNoaWxkX2luZm9f
c3Bhd246OndvcmtlciAoY29uc3QgY2hhciAqcHJvZ19hcmcsIGNvbnN0IGNoYXIgKmNvbnN0ICph
cmd2LAogICAgICAgWmVyb01lbW9yeSAoJnNpX3Bjb24sIHNpemVvZiAoc2lfcGNvbikpOwogICAg
ICAgU1RBUlRVUElORk9XICpzaV90bXAgPSAmc2k7CiAgICAgICBpZiAoIWlzY3lnd2luICgpICYm
IHB0eXNfcHJpbWFyeSAmJiBpc19jb25zb2xlX2FwcCAocnVucGF0aCkpCi0JaWYgKHB0eXNfcHJp
bWFyeS0+c2V0dXBfcHNldWRvY29uc29sZSAoJnNpX3Bjb24sCi0JCQkgICAgIG1vZGUgIT0gX1Bf
T1ZFUkxBWSAmJiBtb2RlICE9IF9QX1dBSVQpKQotCSAgewotCSAgICBjX2ZsYWdzIHw9IEVYVEVO
REVEX1NUQVJUVVBJTkZPX1BSRVNFTlQ7Ci0JICAgIHNpX3RtcCA9ICZzaV9wY29uLlN0YXJ0dXBJ
bmZvOwotCSAgICBlbmFibGVfcGNvbiA9IHRydWU7Ci0JICB9CisJeworCSAgYm9vbCBub3Bjb24g
PSBtb2RlICE9IF9QX09WRVJMQVkgJiYgbW9kZSAhPSBfUF9XQUlUOworCSAgYm9vbCBiYWNrZ3Jv
dW5kID0gY3R0eV9wZ2lkICYmIGN0dHlfcGdpZCAhPSBteXNlbGYtPnBnaWQ7CisJICBpZiAoIXB0
eXNfcHJpbWFyeS0+dGVybV9oYXNfcGNvbl9jYXAgKGVudmJsb2NrLCBiYWNrZ3JvdW5kKSkKKwkg
ICAgbm9wY29uID0gdHJ1ZTsKKwkgIGlmIChwdHlzX3ByaW1hcnktPnNldHVwX3BzZXVkb2NvbnNv
bGUgKCZzaV9wY29uLCBub3Bjb24pKQorCSAgICB7CisJICAgICAgY19mbGFncyB8PSBFWFRFTkRF
RF9TVEFSVFVQSU5GT19QUkVTRU5UOworCSAgICAgIHNpX3RtcCA9ICZzaV9wY29uLlN0YXJ0dXBJ
bmZvOworCSAgICAgIGVuYWJsZV9wY29uID0gdHJ1ZTsKKwkgICAgfQorCX0KIAogICAgIGxvb3A6
CiAgICAgICAvKiBXaGVuIHJ1aWQgIT0gZXVpZCB3ZSBjcmVhdGUgdGhlIG5ldyBwcm9jZXNzIHVu
ZGVyIHRoZSBjdXJyZW50IG9yaWdpbmFsCmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2luL3R0eS5j
YyBiL3dpbnN1cC9jeWd3aW4vdHR5LmNjCmluZGV4IGQ2MGYyNzU0NS4uZTZkNTdmZjZlIDEwMDY0
NAotLS0gYS93aW5zdXAvY3lnd2luL3R0eS5jYworKysgYi93aW5zdXAvY3lnd2luL3R0eS5jYwpA
QCAtMjQyLDYgKzI0Miw3IEBAIHR0eTo6aW5pdCAoKQogICB0ZXJtX2NvZGVfcGFnZSA9IDA7CiAg
IHBjb25fbGFzdF90aW1lID0gMDsKICAgcGNvbl9zdGFydCA9IGZhbHNlOworICBoYXNfc2V0X3Rp
dGxlID0gZmFsc2U7CiB9CiAKIEhBTkRMRQpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi90dHku
aCBiL3dpbnN1cC9jeWd3aW4vdHR5LmgKaW5kZXggYzQ5MWQzODkxLi4xM2FmOTU2ODcgMTAwNjQ0
Ci0tLSBhL3dpbnN1cC9jeWd3aW4vdHR5LmgKKysrIGIvd2luc3VwL2N5Z3dpbi90dHkuaApAQCAt
MTAxLDYgKzEwMSw3IEBAIHByaXZhdGU6CiAgIFVJTlQgdGVybV9jb2RlX3BhZ2U7CiAgIERXT1JE
IHBjb25fbGFzdF90aW1lOwogICBIQU5ETEUgaF9wY29uX3dyaXRlX3BpcGU7CisgIGJvb2wgaGFz
X3NldF90aXRsZTsKIAogcHVibGljOgogICBIQU5ETEUgZnJvbV9tYXN0ZXIgKCkgY29uc3QgeyBy
ZXR1cm4gX2Zyb21fbWFzdGVyOyB9Ci0tIAoyLjI4LjAKCg==

--Multipart=_Sat__29_Aug_2020_22_14_20_+0900_iOm_mrNGDSf6mt==--
