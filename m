Return-Path: <cygwin-patches-return-3634-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 21687 invoked by alias); 27 Feb 2003 12:28:32 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sources.redhat.com/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sources.redhat.com/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Received: (qmail 21678 invoked from network); 27 Feb 2003 12:28:31 -0000
X-Authentication-Warning: atacama.four-d.de: mail set sender to <tpfaff@gmx.net> using -f
Date: Thu, 27 Feb 2003 12:28:00 -0000
From: Thomas Pfaff <tpfaff@gmx.net>
To: cygwin-patches@cygwin.com
Subject: [PATCH] Implement pthread_rwlocks
Message-ID: <Pine.WNT.4.44.0302271115543.285-201000@algeria.intern.net>
X-X-Sender: pfaff@antarctica.intern.net
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="7524116-12176-1046345225=:285"
Content-ID: <Pine.WNT.4.44.0302271327262.285@algeria.intern.net>
X-SW-Source: 2003-q1/txt/msg00283.txt.bz2

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--7524116-12176-1046345225=:285
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.WNT.4.44.0302271327263.285@algeria.intern.net>
Content-length: 3398


This patch adds support for pthread_rwlocks. Attached are testcases from
the pthreads-win32 project.

The rwlock implementation follows the opengroup spec that it will
prefer writers among readers and check for deadlock conditions.

2003-02-27  Thomas Pfaff  <tpfaff@gmx.net>

	* cygwin.din: Add pthread_rwlock_destroy, pthread_rwlock_init,
	pthread_rwlock_rdlock, pthread_rwlock_tryrdlock,
	pthread_rwlock_wrlock, pthread_rwlock_trywrlock,
	pthread_rwlock_unlock, pthread_rwlockattr_init,
	pthread_rwlockattr_getpshared, pthread_rwlockattr_setpshared,
	and pthread_rwlockattr_destroy.
	* include/cygwin/version.h: Bump API minor number.
	* include/pthread.h (PTHREAD_RWLOCK_INITIALIZER): Define a
	reasonable value.
	Add prototypes for pthread_rwlock_destroy, pthread_rwlock_init,
	pthread_rwlock_rdlock, pthread_rwlock_tryrdlock,
	pthread_rwlock_wrlock, pthread_rwlock_trywrlock,
	pthread_rwlock_unlock, pthread_rwlockattr_init,
	pthread_rwlockattr_getpshared, pthread_rwlockattr_setpshared,
	and pthread_rwlockattr_destroy.
	* thread.h (PTHREAD_ONCE_MAGIC): Remove superflous semicolon.
	(PTHREAD_RWLOCK_MAGIC): New define.
	(PTHREAD_RWLOCKATTR_MAGIC): Ditto.
	(pthread_rwlockattr): New class.
	(pthread_rwlock): Ditto.
	(MTinterface::rwlocks): New member.
	(MTinterface::MTinterface): Initialize rwlocks.
	Add prototypes for __pthread_rwlock_destroy,
	__pthread_rwlock_wrlock, __pthread_rwlock_trywrlock,
	__pthread_rwlock_unlock, __pthread_rwlockattr_init,
	__pthread_rwlockattr_getpshared, __pthread_rwlockattr_setpshared,
	and __pthread_rwlockattr_destroy.
	* thread.cc (MTinterface::Init): Initialize rwlock internal mutex.
	(MTinterface::fixup_after_fork): Fixup rwlocks after fork.
	(pthread_rwlockattr::isGoodObject): Implement.
	(pthread_rwlockattr::pthread_rwlockattr): Ditto.
	(pthread_rwlockattr::~pthread_rwlockattr): Ditto.
	(pthread_rwlock::initMutex): Ditto.
	(pthread_rwlock::pthread_rwlock): Ditto.
	(pthread_rwlock::~pthread_rwlock): Ditto.
	(pthread_rwlock::RdLock): Ditto.
	(pthread_rwlock::TryRdLock): Ditto.
	(pthread_rwlock::WrLock): Ditto.
	(pthread_rwlock::TryWrLock): Ditto.
	(pthread_rwlock::UnLock): Ditto.
	(pthread_rwlock::addReader): Ditto.
	(pthread_rwlock::removeReader): Ditto.
	(pthread_rwlock::lookupReader): Ditto.
	(pthread_rwlock::RdLockCleanup): Ditto.
	(pthread_rwlock::WrLockCleanup): Ditto.
	(pthread_rwlock::fixup_after_fork): Ditto.
	(pthread_rwlock::isGoodObject): Ditto.
	(pthread_rwlock::isGoodInitializer): Ditto.
	(pthread_rwlock::isGoodInitializerOrObject): Ditto.
	(pthread_rwlock::isGoodInitializerOrBadObject): Ditto.
	(__pthread_rwlock_destroy): Ditto.
	(pthread_rwlock::init): Ditto.
	(__pthread_rwlock_rdlock): Ditto.
	(__pthread_rwlock_tryrdlock): Ditto.
	(__pthread_rwlock_wrlock): Ditto.
	(__pthread_rwlock_trywrlock): Ditto.
	(__pthread_rwlock_unlock): Ditto.
	(__pthread_rwlockattr_init): Ditto.
	(__pthread_rwlockattr_getpshared): Ditto.
	(__pthread_rwlockattr_setpshared): Ditto.
	(__pthread_rwlockattr_destroy): Ditto.
	* pthread.cc (pthread_rwlock_destroy): Implement:
	(pthread_rwlock_init): Ditto.
	(pthread_rwlock_rdlock): Ditto.
	(pthread_rwlock_tryrdlock): Ditto.
	(pthread_rwlock_wrlock): Ditto.
	(pthread_rwlock_trywrlock): Ditto.
	(pthread_rwlock_unlock): Ditto.
	(pthread_rwlockattr_init): Ditto.
	(pthread_rwlockattr_getpshared): Ditto.
	(pthread_rwlockattr_getpshared): Ditto.
	(pthread_rwlockattr_destroy): Ditto.


--7524116-12176-1046345225=:285
Content-Type: APPLICATION/X-GZIP; NAME="rwlock.tar.gz"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0302271227050.285@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="rwlock.tar.gz"
Content-length: 4087

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

--7524116-12176-1046345225=:285
Content-Type: TEXT/PLAIN; NAME="pthread_rwlock.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0302271227051.285@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="pthread_rwlock.patch"
Content-length: 28703

ZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi9jeWd3aW4uZGluIHNy
Yy93aW5zdXAvY3lnd2luL2N5Z3dpbi5kaW4KLS0tIHNyYy5vbGQvd2luc3Vw
L2N5Z3dpbi9jeWd3aW4uZGluCTIwMDMtMDItMjcgMTA6MTQ6MzEuMDAwMDAw
MDAwICswMTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWd3aW4uZGluCTIw
MDMtMDItMjcgMTA6MTg6MzUuMDAwMDAwMDAwICswMTAwCkBAIC05MzIsNiAr
OTMyLDE3IEBAIHB0aHJlYWRfbXV0ZXhhdHRyX3NldHByb3RvY29sCiBwdGhy
ZWFkX211dGV4YXR0cl9zZXRwc2hhcmVkCiBwdGhyZWFkX211dGV4YXR0cl9z
ZXR0eXBlCiBwdGhyZWFkX29uY2UKK3B0aHJlYWRfcndsb2NrX2Rlc3Ryb3kK
K3B0aHJlYWRfcndsb2NrX2luaXQKK3B0aHJlYWRfcndsb2NrX3JkbG9jawor
cHRocmVhZF9yd2xvY2tfdHJ5cmRsb2NrCitwdGhyZWFkX3J3bG9ja193cmxv
Y2sKK3B0aHJlYWRfcndsb2NrX3RyeXdybG9jaworcHRocmVhZF9yd2xvY2tf
dW5sb2NrCitwdGhyZWFkX3J3bG9ja2F0dHJfaW5pdAorcHRocmVhZF9yd2xv
Y2thdHRyX2dldHBzaGFyZWQKK3B0aHJlYWRfcndsb2NrYXR0cl9zZXRwc2hh
cmVkCitwdGhyZWFkX3J3bG9ja2F0dHJfZGVzdHJveQogcHRocmVhZF9zZWxm
CiBwdGhyZWFkX3NldGNhbmNlbHN0YXRlCiBwdGhyZWFkX3NldGNhbmNlbHR5
cGUKZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5
Z3dpbi92ZXJzaW9uLmggc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9jeWd3
aW4vdmVyc2lvbi5oCi0tLSBzcmMub2xkL3dpbnN1cC9jeWd3aW4vaW5jbHVk
ZS9jeWd3aW4vdmVyc2lvbi5oCTIwMDMtMDItMjcgMTA6MTU6MTcuMDAwMDAw
MDAwICswMTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dp
bi92ZXJzaW9uLmgJMjAwMy0wMi0yNyAxMDoxOToyMi4wMDAwMDAwMDAgKzAx
MDAKQEAgLTE4NSwxMiArMTg1LDEzIEBAIGRldGFpbHMuICovCiAJCSAgcm91
bmQgcm91bmRmIHNjYWxibG4gc2NhbGJsbmYgc2luY29zIHNpbmNvc2YgdGdh
bW1hIHRnYW1tYWYKIAkJICB0cnVuY2YKICAgICAgICA3NjogbWFsbGluZm8K
KyAgICAgICA3NzogRXhwb3J0IHB0aHJlYWRfcndsb2NrIHN0dWZmCiAgICAg
ICovCiAKICAgICAgLyogTm90ZSB0aGF0IHdlIGZvcmdvdCB0byBidW1wIHRo
ZSBhcGkgZm9yIHVhbGFybSwgc3RydG9sbCwgc3RydG91bGwgKi8KIAogI2Rl
ZmluZSBDWUdXSU5fVkVSU0lPTl9BUElfTUFKT1IgMAotI2RlZmluZSBDWUdX
SU5fVkVSU0lPTl9BUElfTUlOT1IgNzYKKyNkZWZpbmUgQ1lHV0lOX1ZFUlNJ
T05fQVBJX01JTk9SIDc3CiAKICAgICAgLyogVGhlcmUgaXMgYWxzbyBhIGNv
bXBhdGliaXR5IHZlcnNpb24gbnVtYmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUK
IAlzaGFyZWQgbWVtb3J5IHJlZ2lvbnMuICBJdCBpcyBpbmNyZW1lbnRlZCB3
aGVuIGluY29tcGF0aWJsZQpkaWZmIC11cnAgc3JjLm9sZC93aW5zdXAvY3ln
d2luL2luY2x1ZGUvcHRocmVhZC5oIHNyYy93aW5zdXAvY3lnd2luL2luY2x1
ZGUvcHRocmVhZC5oCi0tLSBzcmMub2xkL3dpbnN1cC9jeWd3aW4vaW5jbHVk
ZS9wdGhyZWFkLmgJMjAwMy0wMi0yNyAwOToyNTo0OS4wMDAwMDAwMDAgKzAx
MDAKKysrIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvcHRocmVhZC5oCTIw
MDMtMDItMjcgMDk6MzI6MTguMDAwMDAwMDAwICswMTAwCkBAIC02Miw3ICs2
Miw3IEBAIGV4dGVybiAiQyIKICNkZWZpbmUgUFRIUkVBRF9QUklPX1BST1RF
Q1QKICNkZWZpbmUgUFRIUkVBRF9QUk9DRVNTX1NIQVJFRCAxCiAjZGVmaW5l
IFBUSFJFQURfUFJPQ0VTU19QUklWQVRFIDAKLSNkZWZpbmUgUFRIUkVBRF9S
V0xPQ0tfSU5JVElBTElaRVIKKyNkZWZpbmUgUFRIUkVBRF9SV0xPQ0tfSU5J
VElBTElaRVIgKHB0aHJlYWRfcndsb2NrX3QpMjIKIC8qIHByb2Nlc3MgaXMg
dGhlIGRlZmF1bHQgKi8KICNkZWZpbmUgUFRIUkVBRF9TQ09QRV9QUk9DRVNT
IDAKICNkZWZpbmUgUFRIUkVBRF9TQ09QRV9TWVNURU0gMQpAQCAtMTYxLDYg
KzE2MSwyMCBAQCBpbnQgcHRocmVhZF9tdXRleGF0dHJfc2V0cHJvdG9jb2wg
KHB0aHJlCiBpbnQgcHRocmVhZF9tdXRleGF0dHJfc2V0cHNoYXJlZCAocHRo
cmVhZF9tdXRleGF0dHJfdCAqLCBpbnQpOwogaW50IHB0aHJlYWRfbXV0ZXhh
dHRyX3NldHR5cGUgKHB0aHJlYWRfbXV0ZXhhdHRyX3QgKiwgaW50KTsKIAor
LyogUlcgTG9ja3MgKi8KK2ludCBwdGhyZWFkX3J3bG9ja19kZXN0cm95IChw
dGhyZWFkX3J3bG9ja190ICpyd2xvY2spOworaW50IHB0aHJlYWRfcndsb2Nr
X2luaXQgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaywgY29uc3QgcHRocmVh
ZF9yd2xvY2thdHRyX3QgKmF0dHIpOworaW50IHB0aHJlYWRfcndsb2NrX3Jk
bG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKTsKK2ludCBwdGhyZWFk
X3J3bG9ja190cnlyZGxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jayk7
CitpbnQgcHRocmVhZF9yd2xvY2tfd3Jsb2NrIChwdGhyZWFkX3J3bG9ja190
ICpyd2xvY2spOworaW50IHB0aHJlYWRfcndsb2NrX3RyeXdybG9jayAocHRo
cmVhZF9yd2xvY2tfdCAqcndsb2NrKTsKK2ludCBwdGhyZWFkX3J3bG9ja191
bmxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jayk7CitpbnQgcHRocmVh
ZF9yd2xvY2thdHRyX2luaXQgKHB0aHJlYWRfcndsb2NrYXR0cl90ICpyd2xv
Y2thdHRyKTsKK2ludCBwdGhyZWFkX3J3bG9ja2F0dHJfZ2V0cHNoYXJlZCAo
Y29uc3QgcHRocmVhZF9yd2xvY2thdHRyX3QgKmF0dHIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCAqcHNoYXJlZCk7CitpbnQg
cHRocmVhZF9yd2xvY2thdHRyX3NldHBzaGFyZWQgKHB0aHJlYWRfcndsb2Nr
YXR0cl90ICphdHRyLCBpbnQgcHNoYXJlZCk7CitpbnQgcHRocmVhZF9yd2xv
Y2thdHRyX2Rlc3Ryb3kgKHB0aHJlYWRfcndsb2NrYXR0cl90ICpyd2xvY2th
dHRyKTsKKwogaW50IHB0aHJlYWRfb25jZSAocHRocmVhZF9vbmNlX3QgKiwg
dm9pZCAoKikodm9pZCkpOwogCiAvKiBDb25jdXJyZW5jeSBsZXZlbHMgLSBY
L09wZW4gaW50ZXJmYWNlICovCmRpZmYgLXVycCBzcmMub2xkL3dpbnN1cC9j
eWd3aW4vcHRocmVhZC5jYyBzcmMvd2luc3VwL2N5Z3dpbi9wdGhyZWFkLmNj
Ci0tLSBzcmMub2xkL3dpbnN1cC9jeWd3aW4vcHRocmVhZC5jYwkyMDAzLTAx
LTEwIDE4OjU1OjAzLjAwMDAwMDAwMCArMDEwMAorKysgc3JjL3dpbnN1cC9j
eWd3aW4vcHRocmVhZC5jYwkyMDAzLTAyLTI3IDA5OjMyOjE4LjAwMDAwMDAw
MCArMDEwMApAQCAtMzg4LDYgKzM4OCw3NCBAQCBwdGhyZWFkX2NvbmRhdHRy
X3NldHBzaGFyZWQgKHB0aHJlYWRfY29uCiAgIHJldHVybiBfX3B0aHJlYWRf
Y29uZGF0dHJfc2V0cHNoYXJlZCAoYXR0ciwgcHNoYXJlZCk7CiB9CiAKKy8q
IFJXIExvY2tzICovCitpbnQKK3B0aHJlYWRfcndsb2NrX2Rlc3Ryb3kgKHB0
aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykKK3sKKyAgcmV0dXJuIF9fcHRocmVh
ZF9yd2xvY2tfZGVzdHJveSAocndsb2NrKTsKK30KKworaW50CitwdGhyZWFk
X3J3bG9ja19pbml0IChwdGhyZWFkX3J3bG9ja190ICpyd2xvY2ssIGNvbnN0
IHB0aHJlYWRfcndsb2NrYXR0cl90ICphdHRyKQoreworICByZXR1cm4gcHRo
cmVhZF9yd2xvY2s6OmluaXQgKHJ3bG9jaywgYXR0cik7Cit9CisKK2ludAor
cHRocmVhZF9yd2xvY2tfcmRsb2NrIChwdGhyZWFkX3J3bG9ja190ICpyd2xv
Y2spCit7CisgIHJldHVybiBfX3B0aHJlYWRfcndsb2NrX3JkbG9jayAocnds
b2NrKTsKK30KKworaW50CitwdGhyZWFkX3J3bG9ja190cnlyZGxvY2sgKHB0
aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykKK3sKKyAgcmV0dXJuIF9fcHRocmVh
ZF9yd2xvY2tfdHJ5cmRsb2NrIChyd2xvY2spOworfQorCitpbnQKK3B0aHJl
YWRfcndsb2NrX3dybG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKQor
eworICByZXR1cm4gX19wdGhyZWFkX3J3bG9ja193cmxvY2sgKHJ3bG9jayk7
Cit9CisKK2ludAorcHRocmVhZF9yd2xvY2tfdHJ5d3Jsb2NrIChwdGhyZWFk
X3J3bG9ja190ICpyd2xvY2spCit7CisgIHJldHVybiBfX3B0aHJlYWRfcnds
b2NrX3RyeXdybG9jayAocndsb2NrKTsKK30KKworaW50CitwdGhyZWFkX3J3
bG9ja191bmxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykKK3sKKyAg
cmV0dXJuIF9fcHRocmVhZF9yd2xvY2tfdW5sb2NrIChyd2xvY2spOworfQor
CitpbnQKK3B0aHJlYWRfcndsb2NrYXR0cl9pbml0IChwdGhyZWFkX3J3bG9j
a2F0dHJfdCAqcndsb2NrYXR0cikKK3sKKyAgcmV0dXJuIF9fcHRocmVhZF9y
d2xvY2thdHRyX2luaXQgKHJ3bG9ja2F0dHIpOworfQorCitpbnQKK3B0aHJl
YWRfcndsb2NrYXR0cl9nZXRwc2hhcmVkIChjb25zdCBwdGhyZWFkX3J3bG9j
a2F0dHJfdCAqYXR0ciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpbnQgKnBzaGFyZWQpCit7CisgIHJldHVybiBfX3B0aHJlYWRfcndsb2Nr
YXR0cl9nZXRwc2hhcmVkIChhdHRyLCBwc2hhcmVkKTsKK30KKworaW50Citw
dGhyZWFkX3J3bG9ja2F0dHJfc2V0cHNoYXJlZCAocHRocmVhZF9yd2xvY2th
dHRyX3QgKmF0dHIsIGludCBwc2hhcmVkKQoreworICByZXR1cm4gX19wdGhy
ZWFkX3J3bG9ja2F0dHJfc2V0cHNoYXJlZCAoYXR0ciwgcHNoYXJlZCk7Cit9
CisKK2ludAorcHRocmVhZF9yd2xvY2thdHRyX2Rlc3Ryb3kgKHB0aHJlYWRf
cndsb2NrYXR0cl90ICpyd2xvY2thdHRyKQoreworICByZXR1cm4gX19wdGhy
ZWFkX3J3bG9ja2F0dHJfZGVzdHJveSAocndsb2NrYXR0cik7Cit9CisKIC8q
IFNjaGVkdWxpbmcgKi8KIAogaW50CmRpZmYgLXVycCBzcmMub2xkL3dpbnN1
cC9jeWd3aW4vdGhyZWFkLmNjIHNyYy93aW5zdXAvY3lnd2luL3RocmVhZC5j
YwotLS0gc3JjLm9sZC93aW5zdXAvY3lnd2luL3RocmVhZC5jYwkyMDAzLTAy
LTI3IDA5OjMxOjU1LjAwMDAwMDAwMCArMDEwMAorKysgc3JjL3dpbnN1cC9j
eWd3aW4vdGhyZWFkLmNjCTIwMDMtMDItMjcgMDk6MzI6MTguMDAwMDAwMDAw
ICswMTAwCkBAIC0xOTksNiArMTk5LDcgQEAgTVRpbnRlcmZhY2U6OkluaXQg
KGludCBmb3JrZWQpCiAKICAgcHRocmVhZF9tdXRleDo6aW5pdE11dGV4ICgp
OwogICBwdGhyZWFkX2NvbmQ6OmluaXRNdXRleCAoKTsKKyAgcHRocmVhZF9y
d2xvY2s6OmluaXRNdXRleCAoKTsKIH0KIAogdm9pZApAQCAtMjMwLDYgKzIz
MSwxMyBAQCBNVGludGVyZmFjZTo6Zml4dXBfYWZ0ZXJfZm9yayAodm9pZCkK
ICAgICAgIGNvbmQtPmZpeHVwX2FmdGVyX2ZvcmsgKCk7CiAgICAgICBjb25k
ID0gY29uZC0+bmV4dDsKICAgICB9CisgIHB0aHJlYWRfcndsb2NrICpyd2xv
Y2sgPSByd2xvY2tzOworICBkZWJ1Z19wcmludGYgKCJyd2xvY2tzIGlzICV4
Iixyd2xvY2tzKTsKKyAgd2hpbGUgKHJ3bG9jaykKKyAgICB7CisgICAgICBy
d2xvY2stPmZpeHVwX2FmdGVyX2ZvcmsgKCk7CisgICAgICByd2xvY2sgPSBy
d2xvY2stPm5leHQ7CisgICAgfQogICBzZW1hcGhvcmUgKnNlbSA9IHNlbWFw
aG9yZXM7CiAgIGRlYnVnX3ByaW50ZiAoInNlbWFwaG9yZXMgaXMgJXgiLHNl
bWFwaG9yZXMpOwogICB3aGlsZSAoc2VtKQpAQCAtOTk4LDYgKzEwMDYsMzQx
IEBAIHB0aHJlYWRfY29uZDo6Zml4dXBfYWZ0ZXJfZm9yayAoKQogICAgIGFw
aV9mYXRhbCAoInB0aHJlYWRfY29uZDo6Zml4dXBfYWZ0ZXJfZm9yayAoKSBm
YWlsZWQgdG8gcmVjcmVhdGUgd2luMzIgc2VtYXBob3JlIik7CiB9CiAKK2Jv
b2wKK3B0aHJlYWRfcndsb2NrYXR0cjo6aXNHb29kT2JqZWN0IChwdGhyZWFk
X3J3bG9ja2F0dHJfdCBjb25zdCAqYXR0cikKK3sKKyAgaWYgKHZlcmlmeWFi
bGVfb2JqZWN0X2lzdmFsaWQgKGF0dHIsIFBUSFJFQURfUldMT0NLQVRUUl9N
QUdJQykgIT0gVkFMSURfT0JKRUNUKQorICAgIHJldHVybiBmYWxzZTsKKyAg
cmV0dXJuIHRydWU7Cit9CisKK3B0aHJlYWRfcndsb2NrYXR0cjo6cHRocmVh
ZF9yd2xvY2thdHRyICgpOnZlcmlmeWFibGVfb2JqZWN0CisgIChQVEhSRUFE
X1JXTE9DS0FUVFJfTUFHSUMpLCBzaGFyZWQgKFBUSFJFQURfUFJPQ0VTU19Q
UklWQVRFKQoreworfQorCitwdGhyZWFkX3J3bG9ja2F0dHI6On5wdGhyZWFk
X3J3bG9ja2F0dHIgKCkKK3sKK30KKworLyogVGhpcyBpcyB1c2VkIGZvciBy
d2xvY2sgY3JlYXRpb24gcHJvdGVjdGlvbiB3aXRoaW4gYSBzaW5nbGUgcHJv
Y2VzcyBvbmx5ICovCituYXRpdmVNdXRleCBOT19DT1BZIHB0aHJlYWRfcnds
b2NrOjpyd2xvY2tJbml0aWFsaXphdGlvbkxvY2s7CisKKy8qIFdlIGNhbiBv
bmx5IGJlIGNhbGxlZCBvbmNlLgorICAgVE9ETzogKG5vIHJ1c2gpIHVzZSBh
IG5vbiBjb3BpZWQgbWVtb3J5IHNlY3Rpb24gdG8KKyAgIGhvbGQgYW4gaW5p
dGlhbGl6YXRpb24gZmxhZy4gICovCit2b2lkCitwdGhyZWFkX3J3bG9jazo6
aW5pdE11dGV4ICgpCit7CisgIGlmICghcndsb2NrSW5pdGlhbGl6YXRpb25M
b2NrLmluaXQgKCkpCisgICAgYXBpX2ZhdGFsICgiQ291bGQgbm90IGNyZWF0
ZSB3aW4zMiBNdXRleCBmb3IgcHRocmVhZCByd2xvY2sgc3RhdGljIGluaXRp
YWxpemVyIHN1cHBvcnQuIik7Cit9CisKK3B0aHJlYWRfcndsb2NrOjpwdGhy
ZWFkX3J3bG9jayAocHRocmVhZF9yd2xvY2thdHRyICphdHRyKSA6CisgIHZl
cmlmeWFibGVfb2JqZWN0IChQVEhSRUFEX1JXTE9DS19NQUdJQyksCisgIHNo
YXJlZCAoMCksIHdhaXRpbmdSZWFkZXJzICgwKSwgd2FpdGluZ1dyaXRlcnMg
KDApLCB3cml0ZXIgKE5VTEwpLAorICByZWFkZXJzIChOVUxMKSwgbXR4IChO
VUxMKSwgY29uZFJlYWRlcnMgKE5VTEwpLCBjb25kV3JpdGVycyAoTlVMTCks
CisgIG5leHQgKE5VTEwpCit7CisgIHB0aHJlYWRfbXV0ZXggKnZlcmlmeWFi
bGVfbXV0ZXhfb2JqID0gJm10eDsKKyAgcHRocmVhZF9jb25kICp2ZXJpZnlh
YmxlX2NvbmRfb2JqOworCisgIGlmIChhdHRyKQorICAgIGlmIChhdHRyLT5z
aGFyZWQgIT0gUFRIUkVBRF9QUk9DRVNTX1BSSVZBVEUpCisgICAgICB7Cisg
ICAgICAgIG1hZ2ljID0gMDsKKyAgICAgICAgcmV0dXJuOworICAgICAgfQor
CisgIGlmICghcHRocmVhZF9tdXRleDo6aXNHb29kT2JqZWN0ICgmdmVyaWZ5
YWJsZV9tdXRleF9vYmopKQorICAgIHsKKyAgICAgIHRocmVhZF9wcmludGYg
KCJJbnRlcm5hbCByd2xvY2sgbXV0ZXggaXMgbm90IHZhbGlkLiB0aGlzICVw
IiwgdGhpcyk7CisgICAgICBtYWdpYyA9IDA7CisgICAgICByZXR1cm47Cisg
ICAgfQorICAvKiBDaGFuZ2UgdGhlIG11dGV4IHR5cGUgdG8gTk9STUFMIHRv
IHNwZWVkIHVwIG11dGV4IG9wZXJhdGlvbnMgKi8KKyAgbXR4LnR5cGUgPSBQ
VEhSRUFEX01VVEVYX05PUk1BTDsKKworICB2ZXJpZnlhYmxlX2NvbmRfb2Jq
ID0gJmNvbmRSZWFkZXJzOworICBpZiAoIXB0aHJlYWRfY29uZDo6aXNHb29k
T2JqZWN0ICgmdmVyaWZ5YWJsZV9jb25kX29iaikpCisgICAgeworICAgICAg
dGhyZWFkX3ByaW50ZiAoIkludGVybmFsIHJ3bG9jayByZWFkZXJzIGNvbmQg
aXMgbm90IHZhbGlkLiB0aGlzICVwIiwgdGhpcyk7CisgICAgICBtYWdpYyA9
IDA7CisgICAgICByZXR1cm47CisgICAgfQorCisgIHZlcmlmeWFibGVfY29u
ZF9vYmogPSAmY29uZFdyaXRlcnM7CisgIGlmICghcHRocmVhZF9jb25kOjpp
c0dvb2RPYmplY3QgKCZ2ZXJpZnlhYmxlX2NvbmRfb2JqKSkKKyAgICB7Cisg
ICAgICB0aHJlYWRfcHJpbnRmICgiSW50ZXJuYWwgcndsb2NrIHdyaXRlcnMg
Y29uZCBpcyBub3QgdmFsaWQuIHRoaXMgJXAiLCB0aGlzKTsKKyAgICAgIG1h
Z2ljID0gMDsKKyAgICAgIHJldHVybjsKKyAgICB9CisKKworICAvKiB0aHJl
YWRzYWZlIGFkZGl0aW9uIGlzIGVhc3kgKi8KKyAgbmV4dCA9IChwdGhyZWFk
X3J3bG9jayAqKSBJbnRlcmxvY2tlZEV4Y2hhbmdlUG9pbnRlciAoJk1UX0lO
VEVSRkFDRS0+cndsb2NrcywgdGhpcyk7Cit9CisKK3B0aHJlYWRfcndsb2Nr
Ojp+cHRocmVhZF9yd2xvY2sgKCkKK3sKKyAgLyogSSdtIG5vdCAxMDAlIHN1
cmUgdGhlIG5leHQgYml0IGlzIHRocmVhZHNhZmUuIEkgdGhpbmsgaXQgaXMu
Li4gKi8KKyAgaWYgKE1UX0lOVEVSRkFDRS0+cndsb2NrcyA9PSB0aGlzKQor
ICAgIEludGVybG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmTVRfSU5URVJGQUNF
LT5yd2xvY2tzLCB0aGlzLT5uZXh0KTsKKyAgZWxzZQorICAgIHsKKyAgICAg
IHB0aHJlYWRfcndsb2NrICp0ZW1wcndsb2NrID0gTVRfSU5URVJGQUNFLT5y
d2xvY2tzOworICAgICAgd2hpbGUgKHRlbXByd2xvY2stPm5leHQgJiYgdGVt
cHJ3bG9jay0+bmV4dCAhPSB0aGlzKQorCXRlbXByd2xvY2sgPSB0ZW1wcnds
b2NrLT5uZXh0OworICAgICAgLyogYnV0IHRoZXJlIG1heSBiZSBhIHJhY2Ug
YmV0d2VlbiB0aGUgbG9vcCBhYm92ZSBhbmQgdGhpcyBzdGF0ZW1lbnQgKi8K
KyAgICAgIEludGVybG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmdGVtcHJ3bG9j
ay0+bmV4dCwgdGhpcy0+bmV4dCk7CisgICAgfQorfQorCitpbnQKK3B0aHJl
YWRfcndsb2NrOjpSZExvY2sgKCkKK3sKKyAgaW50IHJlc3VsdCA9IDA7Cisg
IHN0cnVjdCBSV0xPQ0tfUkVBREVSICpyZWFkZXI7CisgIHB0aHJlYWRfdCBz
ZWxmID0gcHRocmVhZDo6c2VsZiAoKTsKKworICBtdHguTG9jayAoKTsKKwor
ICBpZiAobG9va3VwUmVhZGVyIChzZWxmKSkKKyAgICB7CisgICAgICByZXN1
bHQgPSBFREVBRExLOworICAgICAgZ290byBET05FOworICAgIH0KKworICBy
ZWFkZXIgPSBuZXcgc3RydWN0IFJXTE9DS19SRUFERVI7CisgIGlmICghcmVh
ZGVyKQorICAgIHsKKyAgICAgIHJlc3VsdCA9IEVBR0FJTjsKKyAgICAgIGdv
dG8gRE9ORTsKKyAgICB9CisKKyAgd2hpbGUgKHdyaXRlciB8fCB3YWl0aW5n
V3JpdGVycykKKyAgICB7ICAKKyAgICAgIHB0aHJlYWRfY2xlYW51cF9wdXNo
IChwdGhyZWFkX3J3bG9jazo6UmRMb2NrQ2xlYW51cCwgdGhpcyk7CisKKyAg
ICAgICsrd2FpdGluZ1JlYWRlcnM7CisgICAgICBjb25kUmVhZGVycy5XYWl0
ICgmbXR4KTsKKyAgICAgIC0td2FpdGluZ1JlYWRlcnM7CisKKyAgICAgIHB0
aHJlYWRfY2xlYW51cF9wb3AgKDApOworICAgIH0KKworICByZWFkZXItPnRo
cmVhZCA9IHNlbGY7CisgIGFkZFJlYWRlciAocmVhZGVyKTsKKworIERPTkU6
CisgIG10eC5VbkxvY2sgKCk7CisKKyAgcmV0dXJuIHJlc3VsdDsKK30KKwor
aW50CitwdGhyZWFkX3J3bG9jazo6VHJ5UmRMb2NrICgpCit7CisgIGludCBy
ZXN1bHQgPSAwOworICBwdGhyZWFkX3Qgc2VsZiA9IHB0aHJlYWQ6OnNlbGYg
KCk7CisKKyAgbXR4LkxvY2sgKCk7CisKKyAgaWYgKHdyaXRlciB8fCB3YWl0
aW5nV3JpdGVycyB8fCBsb29rdXBSZWFkZXIgKHNlbGYpKQorICAgIHJlc3Vs
dCA9IEVCVVNZOworICBlbHNlCisgICAgeworICAgICAgc3RydWN0IFJXTE9D
S19SRUFERVIgKnJlYWRlciA9IG5ldyBzdHJ1Y3QgUldMT0NLX1JFQURFUjsK
KyAgICAgIGlmIChyZWFkZXIpCisgICAgICAgIHsKKyAgICAgICAgICByZWFk
ZXItPnRocmVhZCA9IHNlbGY7CisgICAgICAgICAgYWRkUmVhZGVyIChyZWFk
ZXIpOworICAgICAgICB9CisgICAgICBlbHNlCisgICAgICAgIHJlc3VsdCA9
IEVBR0FJTjsKKyAgICB9CisgICAgCisgIG10eC5VbkxvY2sgKCk7CisKKyAg
cmV0dXJuIHJlc3VsdDsKK30KKworaW50CitwdGhyZWFkX3J3bG9jazo6V3JM
b2NrICgpCit7CisgIGludCByZXN1bHQgPSAwOworICBwdGhyZWFkX3Qgc2Vs
ZiA9IHB0aHJlYWQ6OnNlbGYgKCk7CisKKyAgbXR4LkxvY2sgKCk7CisKKyAg
aWYgKHdyaXRlciA9PSBzZWxmIHx8IGxvb2t1cFJlYWRlciAoc2VsZikpCisg
ICAgeworICAgICAgcmVzdWx0ID0gRURFQURMSzsKKyAgICAgIGdvdG8gRE9O
RTsKKyAgICB9CisKKyAgd2hpbGUgKHdyaXRlciB8fCByZWFkZXJzKQorICAg
IHsgIAorICAgICAgcHRocmVhZF9jbGVhbnVwX3B1c2ggKHB0aHJlYWRfcnds
b2NrOjpXckxvY2tDbGVhbnVwLCB0aGlzKTsKKworICAgICAgKyt3YWl0aW5n
V3JpdGVyczsKKyAgICAgIGNvbmRXcml0ZXJzLldhaXQgKCZtdHgpOworICAg
ICAgLS13YWl0aW5nV3JpdGVyczsKKworICAgICAgcHRocmVhZF9jbGVhbnVw
X3BvcCAoMCk7CisgICAgfQorCisgIHdyaXRlciA9IHNlbGY7CisKKyBET05F
OgorICBtdHguVW5Mb2NrICgpOworCisgIHJldHVybiByZXN1bHQ7Cit9CisK
K2ludAorcHRocmVhZF9yd2xvY2s6OlRyeVdyTG9jayAoKQoreworICBpbnQg
cmVzdWx0ID0gMDsKKyAgcHRocmVhZF90IHNlbGYgPSBwdGhyZWFkOjpzZWxm
ICgpOworCisgIG10eC5Mb2NrICgpOworCisgIGlmICh3cml0ZXIgfHwgcmVh
ZGVycykKKyAgICByZXN1bHQgPSBFQlVTWTsKKyAgZWxzZQorICAgIHdyaXRl
ciA9IHNlbGY7CisgICAgCisgIG10eC5VbkxvY2sgKCk7CisKKyAgcmV0dXJu
IHJlc3VsdDsKK30KKworaW50CitwdGhyZWFkX3J3bG9jazo6VW5Mb2NrICgp
Cit7CisgIGludCByZXN1bHQgPSAwOworICBwdGhyZWFkX3Qgc2VsZiA9IHB0
aHJlYWQ6OnNlbGYgKCk7CisKKyAgbXR4LkxvY2sgKCk7CisKKyAgaWYgKHdy
aXRlcikKKyAgICB7CisgICAgICBpZiAod3JpdGVyICE9IHNlbGYpCisgICAg
ICAgIHsKKyAgICAgICAgICByZXN1bHQgPSBFUEVSTTsKKyAgICAgICAgICBn
b3RvIERPTkU7CisgICAgICAgIH0KKworICAgICAgd3JpdGVyID0gTlVMTDsK
KyAgICB9CisgIGVsc2UKKyAgICB7CisgICAgICBzdHJ1Y3QgUldMT0NLX1JF
QURFUiAqcmVhZGVyID0gbG9va3VwUmVhZGVyIChzZWxmKTsKKworICAgICAg
aWYgKCFyZWFkZXIpCisgICAgICAgIHsKKyAgICAgICAgICByZXN1bHQgPSBF
UEVSTTsKKyAgICAgICAgICBnb3RvIERPTkU7CisgICAgICAgIH0KKworICAg
ICAgcmVtb3ZlUmVhZGVyIChyZWFkZXIpOworICAgICAgZGVsZXRlIHJlYWRl
cjsKKyAgICB9CisKKyAgaWYgKHdhaXRpbmdXcml0ZXJzKQorICAgIHsKKyAg
ICAgIGlmICghcmVhZGVycykKKyAgICAgICAgY29uZFdyaXRlcnMuVW5CbG9j
ayAoZmFsc2UpOworICAgIH0KKyAgZWxzZSBpZiAod2FpdGluZ1JlYWRlcnMp
CisgICAgY29uZFJlYWRlcnMuVW5CbG9jayAodHJ1ZSk7CisKKyBET05FOgor
ICBtdHguVW5Mb2NrICgpOworCisgIHJldHVybiByZXN1bHQ7Cit9CisKK3Zv
aWQKK3B0aHJlYWRfcndsb2NrOjphZGRSZWFkZXIgKHN0cnVjdCBSV0xPQ0tf
UkVBREVSICpyZCkKK3sKKyAgcmQtPm5leHQgPSAoc3RydWN0IFJXTE9DS19S
RUFERVIgKikKKyAgICBJbnRlcmxvY2tlZEV4Y2hhbmdlUG9pbnRlciAoJnJl
YWRlcnMsIHJkKTsKK30KKwordm9pZAorcHRocmVhZF9yd2xvY2s6OnJlbW92
ZVJlYWRlciAoc3RydWN0IFJXTE9DS19SRUFERVIgKnJkKQoreworICBpZiAo
cmVhZGVycyA9PSByZCkKKyAgICBJbnRlcmxvY2tlZEV4Y2hhbmdlUG9pbnRl
ciAoJnJlYWRlcnMsIHJkLT5uZXh0KTsKKyAgZWxzZQorICAgIHsKKyAgICAg
IHN0cnVjdCBSV0xPQ0tfUkVBREVSICp0ZW1wID0gcmVhZGVyczsKKyAgICAg
IHdoaWxlICh0ZW1wLT5uZXh0ICYmIHRlbXAtPm5leHQgIT0gcmQpCisJdGVt
cCA9IHRlbXAtPm5leHQ7CisgICAgICAvKiBidXQgdGhlcmUgbWF5IGJlIGEg
cmFjZSBiZXR3ZWVuIHRoZSBsb29wIGFib3ZlIGFuZCB0aGlzIHN0YXRlbWVu
dCAqLworICAgICAgSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZ0ZW1w
LT5uZXh0LCByZC0+bmV4dCk7CisgICAgfQorfQorCitzdHJ1Y3QgcHRocmVh
ZF9yd2xvY2s6OlJXTE9DS19SRUFERVIgKgorcHRocmVhZF9yd2xvY2s6Omxv
b2t1cFJlYWRlciAocHRocmVhZF90IHRocmVhZCkKK3sKKyAgc3RydWN0IFJX
TE9DS19SRUFERVIgKnRlbXAgPSByZWFkZXJzOworCisgIHdoaWxlICh0ZW1w
ICYmIHRlbXAtPnRocmVhZCAhPSB0aHJlYWQpCisgICAgdGVtcCA9IHRlbXAt
Pm5leHQ7CisKKyAgcmV0dXJuIHRlbXA7Cit9CisKK3ZvaWQKK3B0aHJlYWRf
cndsb2NrOjpSZExvY2tDbGVhbnVwICh2b2lkICphcmcpCit7CisgIHB0aHJl
YWRfcndsb2NrICpyd2xvY2sgPSAocHRocmVhZF9yd2xvY2sgKikgYXJnOwor
CisgIC0tKHJ3bG9jay0+d2FpdGluZ1JlYWRlcnMpOworICByd2xvY2stPm10
eC5VbkxvY2sgKCk7Cit9CisKK3ZvaWQKK3B0aHJlYWRfcndsb2NrOjpXckxv
Y2tDbGVhbnVwICh2b2lkICphcmcpCit7CisgIHB0aHJlYWRfcndsb2NrICpy
d2xvY2sgPSAocHRocmVhZF9yd2xvY2sgKikgYXJnOworCisgIC0tKHJ3bG9j
ay0+d2FpdGluZ1dyaXRlcnMpOworICByd2xvY2stPm10eC5VbkxvY2sgKCk7
Cit9CisKK3ZvaWQKK3B0aHJlYWRfcndsb2NrOjpmaXh1cF9hZnRlcl9mb3Jr
ICgpCit7CisgIHB0aHJlYWRfdCBzZWxmID0gcHRocmVhZDo6c2VsZiAoKTsK
KyAgc3RydWN0IFJXTE9DS19SRUFERVIgKip0ZW1wID0gJnJlYWRlcnM7CisK
KyAgd2FpdGluZ1JlYWRlcnMgPSAwOworICB3YWl0aW5nV3JpdGVycyA9IDA7
CisKKyAgLyogVW5sb2NrIGV2ZW50dWFsbHkgbG9ja2VkIG11dGV4ICovCisg
IG10eC5VbkxvY2sgKCk7CisgIC8qCisgICAqIFJlbW92ZSBhbGwgcmVhZGVy
cyBleGNlcHQgc2VsZgorICAgKi8KKyAgd2hpbGUgKCp0ZW1wKQorICAgIHsK
KyAgICAgIGlmICgoKnRlbXApLT50aHJlYWQgPT0gc2VsZikKKyAgICAgICAg
dGVtcCA9ICYoKCp0ZW1wKS0+bmV4dCk7CisgICAgICBlbHNlCisgICAgICAg
IHsKKyAgICAgICAgICBzdHJ1Y3QgUldMT0NLX1JFQURFUiAqY3VyID0gKnRl
bXA7CisgICAgICAgICAgKnRlbXAgPSAoKnRlbXApLT5uZXh0OworICAgICAg
ICAgIGRlbGV0ZSBjdXI7CisgICAgICAgIH0KKyAgICB9Cit9CisKIC8qIHB0
aHJlYWRfa2V5ICovCiAvKiBzdGF0aWMgbWVtYmVycyAqLwogLyogVGhpcyBz
dG9yZXMgcHRocmVhZF9rZXkgaW5mb3JtYXRpb24gYWNyb3NzIGZvcmsoKSBi
b3VuZGFyaWVzICovCkBAIC0yMjkyLDYgKzI2MzUsMTkxIEBAIF9fcHRocmVh
ZF9jb25kYXR0cl9kZXN0cm95IChwdGhyZWFkX2NvbmQKICAgcmV0dXJuIDA7
CiB9CiAKKy8qIFJXIGxvY2tzICovCitib29sCitwdGhyZWFkX3J3bG9jazo6
aXNHb29kT2JqZWN0IChwdGhyZWFkX3J3bG9ja190IGNvbnN0ICpyd2xvY2sp
Cit7CisgIGlmICh2ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkIChyd2xvY2ss
IFBUSFJFQURfUldMT0NLX01BR0lDKSAhPSBWQUxJRF9PQkpFQ1QpCisgICAg
cmV0dXJuIGZhbHNlOworICByZXR1cm4gdHJ1ZTsKK30KKworYm9vbAorcHRo
cmVhZF9yd2xvY2s6OmlzR29vZEluaXRpYWxpemVyIChwdGhyZWFkX3J3bG9j
a190IGNvbnN0ICpyd2xvY2spCit7CisgIGlmICh2ZXJpZnlhYmxlX29iamVj
dF9pc3ZhbGlkIChyd2xvY2ssIFBUSFJFQURfUldMT0NLX01BR0lDLCBQVEhS
RUFEX1JXTE9DS19JTklUSUFMSVpFUikgIT0gVkFMSURfU1RBVElDX09CSkVD
VCkKKyAgICByZXR1cm4gZmFsc2U7CisgIHJldHVybiB0cnVlOworfQorCiti
b29sCitwdGhyZWFkX3J3bG9jazo6aXNHb29kSW5pdGlhbGl6ZXJPck9iamVj
dCAocHRocmVhZF9yd2xvY2tfdCBjb25zdCAqcndsb2NrKQoreworICBpZiAo
dmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAocndsb2NrLCBQVEhSRUFEX1JX
TE9DS19NQUdJQywgUFRIUkVBRF9SV0xPQ0tfSU5JVElBTElaRVIpID09IElO
VkFMSURfT0JKRUNUKQorICAgIHJldHVybiBmYWxzZTsKKyAgcmV0dXJuIHRy
dWU7Cit9CisKK2Jvb2wKK3B0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFs
aXplck9yQmFkT2JqZWN0IChwdGhyZWFkX3J3bG9ja190IGNvbnN0ICpyd2xv
Y2spCit7CisgIHZlcmlmeWFibGVfb2JqZWN0X3N0YXRlIG9iamVjdFN0YXRl
ID0gdmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAocndsb2NrLCBQVEhSRUFE
X1JXTE9DS19NQUdJQywgUFRIUkVBRF9SV0xPQ0tfSU5JVElBTElaRVIpOwor
ICBpZiAob2JqZWN0U3RhdGUgPT0gVkFMSURfT0JKRUNUKQorCXJldHVybiBm
YWxzZTsKKyAgcmV0dXJuIHRydWU7Cit9CisKK2ludAorX19wdGhyZWFkX3J3
bG9ja19kZXN0cm95IChwdGhyZWFkX3J3bG9ja190ICpyd2xvY2spCit7Cisg
IGlmIChwdGhyZWFkX3J3bG9jazo6aXNHb29kSW5pdGlhbGl6ZXIgKHJ3bG9j
aykpCisgICAgcmV0dXJuIDA7CisgIGlmICghcHRocmVhZF9yd2xvY2s6Omlz
R29vZE9iamVjdCAocndsb2NrKSkKKyAgICByZXR1cm4gRUlOVkFMOworCisg
IGlmICgoKnJ3bG9jayktPndyaXRlciB8fCAoKnJ3bG9jayktPnJlYWRlcnMg
fHwKKyAgICAgICgqcndsb2NrKS0+d2FpdGluZ1JlYWRlcnMgfHwgKCpyd2xv
Y2spLT53YWl0aW5nV3JpdGVycykKKyAgICByZXR1cm4gRUJVU1k7CisKKyAg
ZGVsZXRlICgqcndsb2NrKTsKKyAgKnJ3bG9jayA9IE5VTEw7CisKKyAgcmV0
dXJuIDA7Cit9CisKK2ludAorcHRocmVhZF9yd2xvY2s6OmluaXQgKHB0aHJl
YWRfcndsb2NrX3QgKnJ3bG9jaywgY29uc3QgcHRocmVhZF9yd2xvY2thdHRy
X3QgKmF0dHIpCit7CisgIGlmIChhdHRyICYmICFwdGhyZWFkX3J3bG9ja2F0
dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgICAgcmV0dXJuIEVJTlZBTDsK
KyAgaWYgKCFyd2xvY2tJbml0aWFsaXphdGlvbkxvY2subG9jayAoKSkKKyAg
ICByZXR1cm4gRUlOVkFMOworCisgIGlmICghaXNHb29kSW5pdGlhbGl6ZXJP
ckJhZE9iamVjdCAocndsb2NrKSkKKyAgICB7CisgICAgICByd2xvY2tJbml0
aWFsaXphdGlvbkxvY2sudW5sb2NrICgpOworICAgICAgcmV0dXJuIEVCVVNZ
OworICAgIH0KKworICAqcndsb2NrID0gbmV3IHB0aHJlYWRfcndsb2NrIChh
dHRyID8gKCphdHRyKSA6IE5VTEwpOworICBpZiAoIWlzR29vZE9iamVjdCAo
cndsb2NrKSkKKyAgICB7CisgICAgICBkZWxldGUgKCpyd2xvY2spOworICAg
ICAgKnJ3bG9jayA9IE5VTEw7CisgICAgICByd2xvY2tJbml0aWFsaXphdGlv
bkxvY2sudW5sb2NrICgpOworICAgICAgcmV0dXJuIEVBR0FJTjsKKyAgICB9
CisgIHJ3bG9ja0luaXRpYWxpemF0aW9uTG9jay51bmxvY2sgKCk7CisgIHJl
dHVybiAwOworfQorCitpbnQKK19fcHRocmVhZF9yd2xvY2tfcmRsb2NrIChw
dGhyZWFkX3J3bG9ja190ICpyd2xvY2spCit7CisgIHB0aHJlYWRfdGVzdGNh
bmNlbCAoKTsKKworICBpZiAocHRocmVhZF9yd2xvY2s6OmlzR29vZEluaXRp
YWxpemVyIChyd2xvY2spKQorICAgIHB0aHJlYWRfcndsb2NrOjppbml0IChy
d2xvY2ssIE5VTEwpOworICBpZiAoIXB0aHJlYWRfcndsb2NrOjppc0dvb2RP
YmplY3QgKHJ3bG9jaykpCisgICAgcmV0dXJuIEVJTlZBTDsKKworICByZXR1
cm4gKCpyd2xvY2spLT5SZExvY2sgKCk7Cit9CisKK2ludAorX19wdGhyZWFk
X3J3bG9ja190cnlyZGxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykK
K3sKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFsaXplciAo
cndsb2NrKSkKKyAgICBwdGhyZWFkX3J3bG9jazo6aW5pdCAocndsb2NrLCBO
VUxMKTsKKyAgaWYgKCFwdGhyZWFkX3J3bG9jazo6aXNHb29kT2JqZWN0IChy
d2xvY2spKQorICAgIHJldHVybiBFSU5WQUw7CisKKyAgcmV0dXJuICgqcnds
b2NrKS0+VHJ5UmRMb2NrICgpOworfQorCitpbnQKK19fcHRocmVhZF9yd2xv
Y2tfd3Jsb2NrIChwdGhyZWFkX3J3bG9ja190ICpyd2xvY2spCit7CisgIHB0
aHJlYWRfdGVzdGNhbmNlbCAoKTsKKworICBpZiAocHRocmVhZF9yd2xvY2s6
OmlzR29vZEluaXRpYWxpemVyIChyd2xvY2spKQorICAgIHB0aHJlYWRfcnds
b2NrOjppbml0IChyd2xvY2ssIE5VTEwpOworICBpZiAoIXB0aHJlYWRfcnds
b2NrOjppc0dvb2RPYmplY3QgKHJ3bG9jaykpCisgICAgcmV0dXJuIEVJTlZB
TDsKKworICByZXR1cm4gKCpyd2xvY2spLT5XckxvY2sgKCk7Cit9CisKK2lu
dAorX19wdGhyZWFkX3J3bG9ja190cnl3cmxvY2sgKHB0aHJlYWRfcndsb2Nr
X3QgKnJ3bG9jaykKK3sKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJ
bml0aWFsaXplciAocndsb2NrKSkKKyAgICBwdGhyZWFkX3J3bG9jazo6aW5p
dCAocndsb2NrLCBOVUxMKTsKKyAgaWYgKCFwdGhyZWFkX3J3bG9jazo6aXNH
b29kT2JqZWN0IChyd2xvY2spKQorICAgIHJldHVybiBFSU5WQUw7CisKKyAg
cmV0dXJuICgqcndsb2NrKS0+VHJ5V3JMb2NrICgpOworfQorCitpbnQKK19f
cHRocmVhZF9yd2xvY2tfdW5sb2NrIChwdGhyZWFkX3J3bG9ja190ICpyd2xv
Y2spCit7CisgIGlmIChwdGhyZWFkX3J3bG9jazo6aXNHb29kSW5pdGlhbGl6
ZXIgKHJ3bG9jaykpCisgICAgcmV0dXJuIDA7CisgIGlmICghcHRocmVhZF9y
d2xvY2s6OmlzR29vZE9iamVjdCAocndsb2NrKSkKKyAgICByZXR1cm4gRUlO
VkFMOworCisgIHJldHVybiAoKnJ3bG9jayktPlVuTG9jayAoKTsKK30KKwor
aW50CitfX3B0aHJlYWRfcndsb2NrYXR0cl9pbml0IChwdGhyZWFkX3J3bG9j
a2F0dHJfdCAqcndsb2NrYXR0cikKK3sKKyAgaWYgKGNoZWNrX3ZhbGlkX3Bv
aW50ZXIgKHJ3bG9ja2F0dHIpKQorICAgIHJldHVybiBFSU5WQUw7CisgICpy
d2xvY2thdHRyID0gbmV3IHB0aHJlYWRfcndsb2NrYXR0cjsKKyAgaWYgKCFw
dGhyZWFkX3J3bG9ja2F0dHI6OmlzR29vZE9iamVjdCAocndsb2NrYXR0cikp
CisgICAgeworICAgICAgZGVsZXRlICgqcndsb2NrYXR0cik7CisgICAgICAq
cndsb2NrYXR0ciA9IE5VTEw7CisgICAgICByZXR1cm4gRUFHQUlOOworICAg
IH0KKyAgcmV0dXJuIDA7Cit9CisKK2ludAorX19wdGhyZWFkX3J3bG9ja2F0
dHJfZ2V0cHNoYXJlZCAoY29uc3QgcHRocmVhZF9yd2xvY2thdHRyX3QgKmF0
dHIsIGludCAqcHNoYXJlZCkKK3sKKyAgaWYgKCFwdGhyZWFkX3J3bG9ja2F0
dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgICAgcmV0dXJuIEVJTlZBTDsK
KyAgKnBzaGFyZWQgPSAoKmF0dHIpLT5zaGFyZWQ7CisgIHJldHVybiAwOwor
fQorCitpbnQKK19fcHRocmVhZF9yd2xvY2thdHRyX3NldHBzaGFyZWQgKHB0
aHJlYWRfcndsb2NrYXR0cl90ICphdHRyLCBpbnQgcHNoYXJlZCkKK3sKKyAg
aWYgKCFwdGhyZWFkX3J3bG9ja2F0dHI6OmlzR29vZE9iamVjdCAoYXR0cikp
CisgICAgcmV0dXJuIEVJTlZBTDsKKyAgaWYgKChwc2hhcmVkIDwgMCkgfHwg
KHBzaGFyZWQgPiAxKSkKKyAgICByZXR1cm4gRUlOVkFMOworICAvKiBzaGFy
ZWQgcndsb2NrIHZhcnMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgKi8KKyAg
aWYgKHBzaGFyZWQgIT0gUFRIUkVBRF9QUk9DRVNTX1BSSVZBVEUpCisgICAg
cmV0dXJuIEVJTlZBTDsKKyAgKCphdHRyKS0+c2hhcmVkID0gcHNoYXJlZDsK
KyAgcmV0dXJuIDA7Cit9CisKK2ludAorX19wdGhyZWFkX3J3bG9ja2F0dHJf
ZGVzdHJveSAocHRocmVhZF9yd2xvY2thdHRyX3QgKnJ3bG9ja2F0dHIpCit7
CisgIGlmICghcHRocmVhZF9yd2xvY2thdHRyOjppc0dvb2RPYmplY3QgKHJ3
bG9ja2F0dHIpKQorICAgIHJldHVybiBFSU5WQUw7CisgIGRlbGV0ZSAoKnJ3
bG9ja2F0dHIpOworICAqcndsb2NrYXR0ciA9IE5VTEw7CisgIHJldHVybiAw
OworfQorCiAvKiBUaHJlYWQgc2lnbmFsICovCiBpbnQKIF9fcHRocmVhZF9r
aWxsIChwdGhyZWFkX3QgdGhyZWFkLCBpbnQgc2lnKQpkaWZmIC11cnAgc3Jj
Lm9sZC93aW5zdXAvY3lnd2luL3RocmVhZC5oIHNyYy93aW5zdXAvY3lnd2lu
L3RocmVhZC5oCi0tLSBzcmMub2xkL3dpbnN1cC9jeWd3aW4vdGhyZWFkLmgJ
MjAwMy0wMi0yNyAwOTozMTo1NS4wMDAwMDAwMDAgKzAxMDAKKysrIHNyYy93
aW5zdXAvY3lnd2luL3RocmVhZC5oCTIwMDMtMDItMjcgMDk6MzI6MTguMDAw
MDAwMDAwICswMTAwCkBAIC0xNjMsNiArMTYzLDggQEAgcHJpdmF0ZToKICNk
ZWZpbmUgUFRIUkVBRF9DT05EQVRUUl9NQUdJQyBQVEhSRUFEX01BR0lDKzYK
ICNkZWZpbmUgU0VNX01BR0lDIFBUSFJFQURfTUFHSUMrNwogI2RlZmluZSBQ
VEhSRUFEX09OQ0VfTUFHSUMgUFRIUkVBRF9NQUdJQys4CisjZGVmaW5lIFBU
SFJFQURfUldMT0NLX01BR0lDIFBUSFJFQURfTUFHSUMrOQorI2RlZmluZSBQ
VEhSRUFEX1JXTE9DS0FUVFJfTUFHSUMgUFRIUkVBRF9NQUdJQysxMAogCiAj
ZGVmaW5lIE1VVEVYX09XTkVSX0FOT05ZTU9VUyAgICAgICAgKChwdGhyZWFk
X3QpIC0xKQogCkBAIC01MTcsNiArNTE5LDY3IEBAIHByaXZhdGU6CiAgIHN0
YXRpYyBuYXRpdmVNdXRleCBjb25kSW5pdGlhbGl6YXRpb25Mb2NrOwogfTsK
IAorY2xhc3MgcHRocmVhZF9yd2xvY2thdHRyOnB1YmxpYyB2ZXJpZnlhYmxl
X29iamVjdAoreworcHVibGljOgorICBzdGF0aWMgYm9vbCBpc0dvb2RPYmpl
Y3QocHRocmVhZF9yd2xvY2thdHRyX3QgY29uc3QgKik7CisgIGludCBzaGFy
ZWQ7CisKKyAgcHRocmVhZF9yd2xvY2thdHRyICgpOworICB+cHRocmVhZF9y
d2xvY2thdHRyICgpOworfTsKKworY2xhc3MgcHRocmVhZF9yd2xvY2s6cHVi
bGljIHZlcmlmeWFibGVfb2JqZWN0Cit7CitwdWJsaWM6CisgIHN0YXRpYyBi
b29sIGlzR29vZE9iamVjdCAocHRocmVhZF9yd2xvY2tfdCBjb25zdCAqKTsK
KyAgc3RhdGljIGJvb2wgaXNHb29kSW5pdGlhbGl6ZXIgKHB0aHJlYWRfcnds
b2NrX3QgY29uc3QgKik7CisgIHN0YXRpYyBib29sIGlzR29vZEluaXRpYWxp
emVyT3JPYmplY3QgKHB0aHJlYWRfcndsb2NrX3QgY29uc3QgKik7CisgIHN0
YXRpYyBib29sIGlzR29vZEluaXRpYWxpemVyT3JCYWRPYmplY3QgKHB0aHJl
YWRfcndsb2NrX3QgY29uc3QgKik7CisgIHN0YXRpYyB2b2lkIGluaXRNdXRl
eCAoKTsKKyAgc3RhdGljIGludCBpbml0IChwdGhyZWFkX3J3bG9ja190ICos
IGNvbnN0IHB0aHJlYWRfcndsb2NrYXR0cl90ICopOworCisgIGludCBzaGFy
ZWQ7CisKKyAgdW5zaWduZWQgbG9uZyB3YWl0aW5nUmVhZGVyczsKKyAgdW5z
aWduZWQgbG9uZyB3YWl0aW5nV3JpdGVyczsKKyAgcHRocmVhZF90IHdyaXRl
cjsKKyAgc3RydWN0IFJXTE9DS19SRUFERVIKKyAgeworICAgIHN0cnVjdCBS
V0xPQ0tfUkVBREVSICpuZXh0OworICAgIHB0aHJlYWRfdCB0aHJlYWQ7Cisg
IH0gKnJlYWRlcnM7CisKKyAgaW50IFJkTG9jayAoKTsKKyAgaW50IFRyeVJk
TG9jayAoKTsKKworICBpbnQgV3JMb2NrICgpOworICBpbnQgVHJ5V3JMb2Nr
ICgpOworCisgIGludCBVbkxvY2sgKCk7CisKKyAgcHRocmVhZF9tdXRleCBt
dHg7CisgIHB0aHJlYWRfY29uZCBjb25kUmVhZGVyczsKKyAgcHRocmVhZF9j
b25kIGNvbmRXcml0ZXJzOworCisgIGNsYXNzIHB0aHJlYWRfcndsb2NrICog
bmV4dDsKKworICB2b2lkIGZpeHVwX2FmdGVyX2ZvcmsgKCk7CisKKyAgcHRo
cmVhZF9yd2xvY2sgKHB0aHJlYWRfcndsb2NrYXR0ciAqKTsKKyAgfnB0aHJl
YWRfcndsb2NrICgpOworCitwcml2YXRlOgorICB2b2lkIGFkZFJlYWRlciAo
c3RydWN0IFJXTE9DS19SRUFERVIgKnJkKTsKKyAgdm9pZCByZW1vdmVSZWFk
ZXIgKHN0cnVjdCBSV0xPQ0tfUkVBREVSICpyZCk7CisgIHN0cnVjdCBSV0xP
Q0tfUkVBREVSICpsb29rdXBSZWFkZXIgKHB0aHJlYWRfdCB0aHJlYWQpOwor
CisgIHN0YXRpYyB2b2lkIFJkTG9ja0NsZWFudXAgKHZvaWQgKmFyZyk7Cisg
IHN0YXRpYyB2b2lkIFdyTG9ja0NsZWFudXAgKHZvaWQgKmFyZyk7CisKKyAg
c3RhdGljIG5hdGl2ZU11dGV4IHJ3bG9ja0luaXRpYWxpemF0aW9uTG9jazsK
K307CisKIGNsYXNzIHB0aHJlYWRfb25jZQogewogcHVibGljOgpAQCAtNTc0
LDYgKzYzNyw3IEBAIHB1YmxpYzoKICAgLy8gbGlzdHMgb2YgcHRocmVhZCBv
YmplY3RzLiBVU0UgVEhSRUFEU0FGRSBJTlNFUlRTIEFORCBERUxFVEVTLgog
ICBjbGFzcyBwdGhyZWFkX211dGV4ICogbXV0ZXhzOwogICBjbGFzcyBwdGhy
ZWFkX2NvbmQgICogY29uZHM7CisgIGNsYXNzIHB0aHJlYWRfcndsb2NrICog
cndsb2NrczsKICAgY2xhc3Mgc2VtYXBob3JlICAgICAqIHNlbWFwaG9yZXM7
CiAKICAgcHRocmVhZF9rZXkgcmVlbnRfa2V5OwpAQCAtNTg2LDcgKzY1MCw3
IEBAIHB1YmxpYzoKICAgTVRpbnRlcmZhY2UgKCkgOgogICAgIGNvbmN1cnJl
bmN5ICgwKSwgdGhyZWFkY291bnQgKDEpLAogICAgIHB0aHJlYWRfcHJlcGFy
ZSAoTlVMTCksIHB0aHJlYWRfY2hpbGQgKE5VTEwpLCBwdGhyZWFkX3BhcmVu
dCAoTlVMTCksCi0gICAgbXV0ZXhzIChOVUxMKSwgY29uZHMgKE5VTEwpLCBz
ZW1hcGhvcmVzIChOVUxMKSwKKyAgICBtdXRleHMgKE5VTEwpLCBjb25kcyAo
TlVMTCksIHJ3bG9ja3MgKE5VTEwpLCBzZW1hcGhvcmVzIChOVUxMKSwKICAg
ICByZWVudF9rZXkgKE5VTEwpLCB0aHJlYWRfc2VsZl9rZXkgKE5VTEwpCiAg
IHsKICAgfQpAQCAtNjMyLDYgKzY5NiwxOSBAQCBpbnQgX19wdGhyZWFkX2Nv
bmRhdHRyX2dldHBzaGFyZWQgKGNvbnN0CiAJCQkJICAgaW50ICpwc2hhcmVk
KTsKIGludCBfX3B0aHJlYWRfY29uZGF0dHJfc2V0cHNoYXJlZCAocHRocmVh
ZF9jb25kYXR0cl90ICogYXR0ciwgaW50IHBzaGFyZWQpOwogCisvKiBSVyBs
b2NrcyAqLworaW50IF9fcHRocmVhZF9yd2xvY2tfZGVzdHJveSAocHRocmVh
ZF9yd2xvY2tfdCAqcndsb2NrKTsKK2ludCBfX3B0aHJlYWRfcndsb2NrX3Jk
bG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKTsKK2ludCBfX3B0aHJl
YWRfcndsb2NrX3RyeXJkbG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2Nr
KTsKK2ludCBfX3B0aHJlYWRfcndsb2NrX3dybG9jayAocHRocmVhZF9yd2xv
Y2tfdCAqcndsb2NrKTsKK2ludCBfX3B0aHJlYWRfcndsb2NrX3RyeXdybG9j
ayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKTsKK2ludCBfX3B0aHJlYWRf
cndsb2NrX3VubG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKTsKK2lu
dCBfX3B0aHJlYWRfcndsb2NrYXR0cl9pbml0IChwdGhyZWFkX3J3bG9ja2F0
dHJfdCAqcndsb2NrYXR0cik7CitpbnQgX19wdGhyZWFkX3J3bG9ja2F0dHJf
Z2V0cHNoYXJlZCAoY29uc3QgcHRocmVhZF9yd2xvY2thdHRyX3QgKmF0dHIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ICpw
c2hhcmVkKTsKK2ludCBfX3B0aHJlYWRfcndsb2NrYXR0cl9zZXRwc2hhcmVk
IChwdGhyZWFkX3J3bG9ja2F0dHJfdCAqYXR0ciwgaW50IHBzaGFyZWQpOwor
aW50IF9fcHRocmVhZF9yd2xvY2thdHRyX2Rlc3Ryb3kgKHB0aHJlYWRfcnds
b2NrYXR0cl90ICpyd2xvY2thdHRyKTsKKwogLyogVGhyZWFkIHNpZ25hbCAq
LwogaW50IF9fcHRocmVhZF9raWxsIChwdGhyZWFkX3QgdGhyZWFkLCBpbnQg
c2lnKTsKIGludCBfX3B0aHJlYWRfc2lnbWFzayAoaW50IG9wZXJhdGlvbiwg
Y29uc3Qgc2lnc2V0X3QgKiBzZXQsCg==

--7524116-12176-1046345225=:285--
