Return-Path: <cygwin-patches-return-9280-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 34659 invoked by alias); 31 Mar 2019 06:20:28 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Id: <cygwin-patches.cygwin.com>
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
Received: (qmail 34648 invoked by uid 89); 31 Mar 2019 06:20:27 -0000
Authentication-Results: sourceware.org; auth=none
X-Spam-SWARE-Status: No, score=-2.6 required=5.0 tests=AWL,BAYES_00,RCVD_IN_DNSWL_NONE,URIBL_BLOCKED autolearn=ham version=3.3.1 spammy=as, 3000000, states, H*c:HHHH
X-HELO: conssluserg-05.nifty.com
Received: from conssluserg-05.nifty.com (HELO conssluserg-05.nifty.com) (210.131.2.90) by sourceware.org (qpsmtpd/0.93/v0.84-503-g423c35a) with ESMTP; Sun, 31 Mar 2019 06:20:24 +0000
Received: from Express5800-S70 (ntsitm424054.sitm.nt.ngn.ppp.infoweb.ne.jp [219.97.74.54]) (authenticated)	by conssluserg-05.nifty.com with ESMTP id x2V6KEdo006701	for <cygwin-patches@cygwin.com>; Sun, 31 Mar 2019 15:20:14 +0900
DKIM-Filter: OpenDKIM Filter v2.10.3 conssluserg-05.nifty.com x2V6KEdo006701
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nifty.ne.jp;	s=dec2015msa; t=1554013214;	bh=HFIMygiFvAvfH29uuvaSboLch0EWM8Nhe0Smas3HuF4=;	h=Date:From:To:Subject:From;	b=lJ4Xgc700JY5MdxKZnIKsu0X+jIbBdtGkuld7EadmGSmorb/VsmkJAbxfHLGXmF6L	 ge+fnHKbeHZZKNKH699k1oUwiNHAqFA20AraOZIiWYEsudYbdmXeL52zu0rQQHUV4j	 RTe8qrZJGAGI0nTMwiHTV/jHwrnbfEOf9yIbaCNicuQm1zv2AS0qndHLOOxONlwoJh	 UXPjJkBmI47fsyq1KY8+iDAvKRbAaip0dKnyP2HpL2iluVMyJRENB8u1e00OP7GJ4I	 EwNAmG0GUCePcNG9URCQ/QTNmhuYukZSh/ydBgYmev7nsirciaP7Ajtr3WA9O1eifw	 Tq4iII7/oD8wg==
Date: Sun, 31 Mar 2019 06:20:00 -0000
From: Takashi Yano <takashi.yano@nifty.ne.jp>
To: cygwin-patches@cygwin.com
Subject: [PATCH] Reworks for console code
Message-Id: <20190331152018.c47d6a3a2bc5b9a58e4f06f5@nifty.ne.jp>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY"
X-IsSubscribed: yes
X-SW-Source: 2019-q1/txt/msg00090.txt.bz2

This is a multi-part message in MIME format.

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Content-length: 1561

Hi,

I would like to propose 3 patches attached to improve console code.

Patch 0001:
This revises console code for better color handling. This provides
24 bit color support for Windows 10 build 14931 or later. For legacy
console, fake 24 bit color support is implemented, which use the
nearest color from 16 system colors.

To check the color handling, use:
https://gist.github.com/hSATAC/1095100

Results are at:
http://tyan0.dip.jp/cgi-bin/FSWiki/wiki.cgi?page=24+bit+color+support+for+cygwin+console

Patch 0002:
Previously, select() would return by typing only one key even in
canonical mode. With this patch, it returns after one line is
completed.

To check this behaviour, use attached STC (confirm-select.c) and
type something and [Enter]. Type ^D to exit from the STC.

Expected result:
This is one line.
select() returns 1
read() returns 18
54, 68, 69, 73, 20, 69, 73, 20, 6f, 6e, 65, 20, 6c, 69, 6e, 65, 2e, 0a,
select() returns 1
read() returns 0

Cygwin current version:
select() returns 1
This is one line.
read() returns 18
54, 68, 69, 73, 20, 69, 73, 20, 6f, 6e, 65, 20, 6c, 69, 6e, 65, 2e, 0a,
select() returns 1
read() returns 0

Patch 0003:
POSIX states I/O functions shall be thread-safe, however, cygwin
console I/O functions were not. This patch makes console I/O
functions thread-safe.

To check this, use attached STC (confirm-thread-safe.c).
Expected resut is red 'A's at the first 12 lines and green 'B's
at the second 12 lines. However, the result is completely broken
in current cygwin.

-- 
Takashi Yano <takashi.yano@nifty.ne.jp>

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: application/octet-stream;
 name="0001-Cygwin-console-support-24-bit-color.patch"
Content-Disposition: attachment;
 filename="0001-Cygwin-console-support-24-bit-color.patch"
Content-Transfer-Encoding: base64
Content-length: 20383

RnJvbSA3YzU3N2E4OTcxZmY3MTY0ZjVmYzllMmMwZmQ1OWI2MmRiNDYyOTgz
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBUYWthc2hpIFlhbm8g
PHRha2FzaGkueWFub0BuaWZ0eS5uZS5qcD4KRGF0ZTogU3VuLCAzMSBNYXIg
MjAxOSAwNzo0MTo1NiArMDkwMApTdWJqZWN0OiBbUEFUQ0ggMS8zXSBDeWd3
aW46IGNvbnNvbGU6IHN1cHBvcnQgMjQgYml0IGNvbG9yCgotIEFkZCAyNCBi
aXQgY29sb3Igc3VwcG9ydCB1c2luZyB4dGVybSBjb21wYXRpYmlsaXR5IG1v
ZGUgaW4KICBXaW5kb3dzIDEwIGJ1aWxkIDE0OTMxIG9yIGxhdGVyLgotIEFk
ZCBmYWtlIDI0IGJpdCBjb2xvciBzdXBwb3J0IGZvciBsZWdhY3kgY29uc29s
ZSwgd2hpY2ggdXNlcwogIHRoZSBuZWFyZXN0IGNvbG9yIGZyb20gMTYgc3lz
dGVtIGNvbG9ycy4KLS0tCiB3aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmggICAg
ICAgICAgfCAgIDUgKwogd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9jb25zb2xl
LmNjIHwgMjM3ICsrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLQogd2lu
c3VwL2N5Z3dpbi9zZWxlY3QuY2MgICAgICAgICAgIHwgICA4ICsKIDMgZmls
ZXMgY2hhbmdlZCwgMjE4IGluc2VydGlvbnMoKyksIDMyIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaCBiL3dp
bnN1cC9jeWd3aW4vZmhhbmRsZXIuaAppbmRleCBiMzM2ZWI2M2EuLjNmMTc5
YTlmNiAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9maGFuZGxlci5oCisr
KyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaApAQCAtMTc3OCw2ICsxNzc4
LDggQEAgZW51bSBhbnNpX2ludGVuc2l0eQogI2RlZmluZSBlYXR0aXRsZSA3
CiAjZGVmaW5lIGdvdHBhcmVuIDgKICNkZWZpbmUgZ290cnBhcmVuIDkKKyNk
ZWZpbmUgZWF0cGFsZXR0ZSAxMAorI2RlZmluZSBlbmRwYWxldHRlIDExCiAj
ZGVmaW5lIE1BWEFSR1MgMTAKIAogZW51bSBjbHR5cGUKQEAgLTE3OTEsNiAr
MTc5Myw5IEBAIGVudW0gY2x0eXBlCiAKIGNsYXNzIGRldl9jb25zb2xlCiB7
CisgIGJvb2wgY2FwMjRiaXRfY29sb3I7IC8qIDI0Yml0LWNvbG9yIGNhcGFi
aWxpdHkgKi8KKyAgcGlkX3Qgb3duZXI7CisKICAgV09SRCBkZWZhdWx0X2Nv
bG9yLCB1bmRlcmxpbmVfY29sb3IsIGRpbV9jb2xvcjsKIAogICAvKiBVc2Vk
IHRvIGRldGVybWluZSBpZiBhbiBpbnB1dCBrZXlzdHJva2Ugc2hvdWxkIGJl
IG1vZGlmaWVkIHdpdGggTUVUQS4gKi8KZGlmZiAtLWdpdCBhL3dpbnN1cC9j
eWd3aW4vZmhhbmRsZXJfY29uc29sZS5jYyBiL3dpbnN1cC9jeWd3aW4vZmhh
bmRsZXJfY29uc29sZS5jYwppbmRleCAyODFjMjAwNWMuLjEyZjQ1MDgzNCAx
MDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9jb25zb2xlLmNj
CisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfY29uc29sZS5jYwpAQCAt
MTUsNiArMTUsNyBAQCBkZXRhaWxzLiAqLwogI2luY2x1ZGUgPHN5cy9wYXJh
bS5oPgogI2luY2x1ZGUgPHN5cy9jeWd3aW4uaD4KICNpbmNsdWRlIDxjeWd3
aW4va2QuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KICNpbmNsdWRlICJjeWdl
cnJuby5oIgogI2luY2x1ZGUgInNlY3VyaXR5LmgiCiAjaW5jbHVkZSAicGF0
aC5oIgpAQCAtMzIsNiArMzMsMTYgQEAgZGV0YWlscy4gKi8KICNpbmNsdWRl
ICJjaGlsZF9pbmZvLmgiCiAjaW5jbHVkZSAiY3lnd2FpdC5oIgogCisjaWZu
ZGVmIEVOQUJMRV9WSVJUVUFMX1RFUk1JTkFMX1BST0NFU1NJTkcKKyNkZWZp
bmUgRU5BQkxFX1ZJUlRVQUxfVEVSTUlOQUxfUFJPQ0VTU0lORyAweDAwMDQK
KyNlbmRpZiAvKiBFTkFCTEVfVklSVFVBTF9URVJNSU5BTF9QUk9DRVNTSU5H
ICovCisjaWZuZGVmIERJU0FCTEVfTkVXTElORV9BVVRPX1JFVFVSTgorI2Rl
ZmluZSBESVNBQkxFX05FV0xJTkVfQVVUT19SRVRVUk4gMHgwMDA4CisjZW5k
aWYgLyogRElTQUJMRV9ORVdMSU5FX0FVVE9fUkVUVVJOICovCisjaWZuZGVm
IEVOQUJMRV9WSVJUVUFMX1RFUk1JTkFMX0lOUFVUCisjZGVmaW5lIEVOQUJM
RV9WSVJUVUFMX1RFUk1JTkFMX0lOUFVUIDB4MDIwMAorI2VuZGlmIC8qIEVO
QUJMRV9WSVJUVUFMX1RFUk1JTkFMX0lOUFVUICovCisKIC8qIERvbid0IG1h
a2UgdGhpcyBiaWdnZXIgdGhhbiBOVF9NQVhfUEFUSCBhcyBsb25nIGFzIHRo
ZSB0ZW1wb3JhcnkgYnVmZmVyCiAgICBpcyBhbGxvY2F0ZWQgdXNpbmcgdG1w
X3BhdGhidWYhISEgKi8KICNkZWZpbmUgQ09OVkVSVF9MSU1JVCBOVF9NQVhf
UEFUSApAQCAtMTQ4LDcgKzE1OSwxMSBAQCBmaGFuZGxlcl9jb25zb2xlOjpz
ZXRfdW5pdCAoKQogICAgICAgaWYgKGNyZWF0ZWQpCiAJc2hhcmVkX2NvbnNv
bGVfaW5mby0+dHR5X21pbl9zdGF0ZS5zZXRudHR5IChERVZfQ09OU19NQUpP
UiwgY29uc29sZV91bml0IChtZSkpOwogICAgICAgZGV2c2V0ID0gKGZoX2Rl
dmljZXMpIHNoYXJlZF9jb25zb2xlX2luZm8tPnR0eV9taW5fc3RhdGUuZ2V0
bnR0eSAoKTsKKyAgICAgIGlmIChjcmVhdGVkKQorCWNvbi5vd25lciA9IGdl
dHBpZCAoKTsKICAgICB9CisgIGlmICghY3JlYXRlZCAmJiBzaGFyZWRfY29u
c29sZV9pbmZvICYmIGtpbGwgKGNvbi5vd25lciwgMCkgPT0gLTEpCisgICAg
Y29uLm93bmVyID0gZ2V0cGlkICgpOwogCiAgIGRldiAoKS5wYXJzZSAoZGV2
c2V0KTsKICAgaWYgKGRldnNldCAhPSBGSF9FUlJPUikKQEAgLTE2NywzMyAr
MTgyLDQ0IEBAIHZvaWQKIGZoYW5kbGVyX2NvbnNvbGU6OnNldHVwICgpCiB7
CiAgIGlmIChzZXRfdW5pdCAoKSkKLSAgICAgIHsKLQljb24uc2Nyb2xsX3Jl
Z2lvbi5Cb3R0b20gPSAtMTsKLQljb24uZHdMYXN0Q3Vyc29yUG9zaXRpb24u
WCA9IC0xOwotCWNvbi5kd0xhc3RDdXJzb3JQb3NpdGlvbi5ZID0gLTE7Ci0J
Y29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWCA9IC0xOwotCWNvbi5kd0xhc3RN
b3VzZVBvc2l0aW9uLlkgPSAtMTsKLQljb24uZHdMYXN0QnV0dG9uU3RhdGUg
PSAwOwkvKiBub25lIHByZXNzZWQgKi8KLQljb24ubGFzdF9idXR0b25fY29k
ZSA9IDM7CS8qIHJlbGVhc2VkICovCi0JY29uLnVuZGVybGluZV9jb2xvciA9
IEZPUkVHUk9VTkRfR1JFRU4gfCBGT1JFR1JPVU5EX0JMVUU7Ci0JY29uLmRp
bV9jb2xvciA9IEZPUkVHUk9VTkRfUkVEIHwgRk9SRUdST1VORF9HUkVFTiB8
IEZPUkVHUk9VTkRfQkxVRTsKLQljb24ubWV0YV9tYXNrID0gTEVGVF9BTFRf
UFJFU1NFRDsKLQkvKiBTZXQgdGhlIG1hc2sgdGhhdCBkZXRlcm1pbmVzIGlm
IGFuIGlucHV0IGtleXN0cm9rZSBpcyBtb2RpZmllZCBieQotCSAgIE1FVEEu
ICBXZSBzZXQgdGhpcyBiYXNlZCBvbiB0aGUga2V5Ym9hcmQgbGF5b3V0IGxh
bmd1YWdlIGxvYWRlZAotCSAgIGZvciB0aGUgY3VycmVudCB0aHJlYWQuICBU
aGUgbGVmdCA8QUxUPiBrZXkgYWx3YXlzIGdlbmVyYXRlcwotCSAgIE1FVEEs
IGJ1dCB0aGUgcmlnaHQgPEFMVD4ga2V5IG9ubHkgZ2VuZXJhdGVzIE1FVEEg
aWYgd2UgYXJlIHVzaW5nCi0JICAgYW4gRW5nbGlzaCBrZXlib2FyZCBiZWNh
dXNlIG1hbnkgImludGVybmF0aW9uYWwiIGtleWJvYXJkcwotCSAgIHJlcGxh
Y2UgY29tbW9uIHNoZWxsIHN5bWJvbHMgKCdbJywgJ3snLCBldGMuKSB3aXRo
IGFjY2VudGVkCi0JICAgbGFuZ3VhZ2Utc3BlY2lmaWMgY2hhcmFjdGVycyAo
dW1sYXV0LCBhY2NlbnQgZ3JhdmUsIGV0Yy4pLiAgT24KLQkgICB0aGVzZSBr
ZXlib2FyZHMgcmlnaHQgPEFMVD4gKGNhbGxlZCBBbHRHcikgaXMgdXNlZCB0
byBwcm9kdWNlIHRoZQotCSAgIHNoZWxsIHN5bWJvbHMgYW5kIHNob3VsZCBu
b3QgYmUgaW50ZXJwcmV0ZWQgYXMgTUVUQS4gKi8KLQlpZiAoUFJJTUFSWUxB
TkdJRCAoTE9XT1JEIChHZXRLZXlib2FyZExheW91dCAoMCkpKSA9PSBMQU5H
X0VOR0xJU0gpCi0JICBjb24ubWV0YV9tYXNrIHw9IFJJR0hUX0FMVF9QUkVT
U0VEOwotCWNvbi5zZXRfZGVmYXVsdF9hdHRyICgpOwotCWNvbi5iYWNrc3Bh
Y2Vfa2V5Y29kZSA9IENFUkFTRTsKLQljb24uY29uc19yYXBvaSA9IE5VTEw7
Ci0Jc2hhcmVkX2NvbnNvbGVfaW5mby0+dHR5X21pbl9zdGF0ZS5pc19jb25z
b2xlID0gdHJ1ZTsKLSAgICAgIH0KKyAgICB7CisgICAgICBjb24uc2Nyb2xs
X3JlZ2lvbi5Cb3R0b20gPSAtMTsKKyAgICAgIGNvbi5kd0xhc3RDdXJzb3JQ
b3NpdGlvbi5YID0gLTE7CisgICAgICBjb24uZHdMYXN0Q3Vyc29yUG9zaXRp
b24uWSA9IC0xOworICAgICAgY29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWCA9
IC0xOworICAgICAgY29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWSA9IC0xOwor
ICAgICAgY29uLmR3TGFzdEJ1dHRvblN0YXRlID0gMDsJLyogbm9uZSBwcmVz
c2VkICovCisgICAgICBjb24ubGFzdF9idXR0b25fY29kZSA9IDM7CS8qIHJl
bGVhc2VkICovCisgICAgICBjb24udW5kZXJsaW5lX2NvbG9yID0gRk9SRUdS
T1VORF9HUkVFTiB8IEZPUkVHUk9VTkRfQkxVRTsKKyAgICAgIGNvbi5kaW1f
Y29sb3IgPSBGT1JFR1JPVU5EX1JFRCB8IEZPUkVHUk9VTkRfR1JFRU4gfCBG
T1JFR1JPVU5EX0JMVUU7CisgICAgICBjb24ubWV0YV9tYXNrID0gTEVGVF9B
TFRfUFJFU1NFRDsKKyAgICAgIC8qIFNldCB0aGUgbWFzayB0aGF0IGRldGVy
bWluZXMgaWYgYW4gaW5wdXQga2V5c3Ryb2tlIGlzIG1vZGlmaWVkIGJ5CisJ
IE1FVEEuICBXZSBzZXQgdGhpcyBiYXNlZCBvbiB0aGUga2V5Ym9hcmQgbGF5
b3V0IGxhbmd1YWdlIGxvYWRlZAorCSBmb3IgdGhlIGN1cnJlbnQgdGhyZWFk
LiAgVGhlIGxlZnQgPEFMVD4ga2V5IGFsd2F5cyBnZW5lcmF0ZXMKKwkgTUVU
QSwgYnV0IHRoZSByaWdodCA8QUxUPiBrZXkgb25seSBnZW5lcmF0ZXMgTUVU
QSBpZiB3ZSBhcmUgdXNpbmcKKwkgYW4gRW5nbGlzaCBrZXlib2FyZCBiZWNh
dXNlIG1hbnkgImludGVybmF0aW9uYWwiIGtleWJvYXJkcworCSByZXBsYWNl
IGNvbW1vbiBzaGVsbCBzeW1ib2xzICgnWycsICd7JywgZXRjLikgd2l0aCBh
Y2NlbnRlZAorCSBsYW5ndWFnZS1zcGVjaWZpYyBjaGFyYWN0ZXJzICh1bWxh
dXQsIGFjY2VudCBncmF2ZSwgZXRjLikuICBPbgorCSB0aGVzZSBrZXlib2Fy
ZHMgcmlnaHQgPEFMVD4gKGNhbGxlZCBBbHRHcikgaXMgdXNlZCB0byBwcm9k
dWNlIHRoZQorCSBzaGVsbCBzeW1ib2xzIGFuZCBzaG91bGQgbm90IGJlIGlu
dGVycHJldGVkIGFzIE1FVEEuICovCisgICAgICBpZiAoUFJJTUFSWUxBTkdJ
RCAoTE9XT1JEIChHZXRLZXlib2FyZExheW91dCAoMCkpKSA9PSBMQU5HX0VO
R0xJU0gpCisJY29uLm1ldGFfbWFzayB8PSBSSUdIVF9BTFRfUFJFU1NFRDsK
KyAgICAgIGNvbi5zZXRfZGVmYXVsdF9hdHRyICgpOworICAgICAgY29uLmJh
Y2tzcGFjZV9rZXljb2RlID0gQ0VSQVNFOworICAgICAgY29uLmNvbnNfcmFw
b2kgPSBOVUxMOworICAgICAgc2hhcmVkX2NvbnNvbGVfaW5mby0+dHR5X21p
bl9zdGF0ZS5pc19jb25zb2xlID0gdHJ1ZTsKKyAgICAgIC8qIENoZWNrIGlm
IDI0Yml0IGNvbG9yIGlzIGF2YWlsYWJsZSAqLworICAgICAgRFdPUkQgZHdW
ZXJzaW9uID0gR2V0VmVyc2lvbiAoKTsKKyAgICAgIGR3VmVyc2lvbiA9IChM
T0JZVEUgKExPV09SRCAoZHdWZXJzaW9uKSkgPDwgMjQpCisJfCAoSElCWVRF
IChMT1dPUkQgKGR3VmVyc2lvbikpIDw8IDE2KSB8IEhJV09SRCAoZHdWZXJz
aW9uKTsKKyAgICAgIGlmIChkd1ZlcnNpb24gPj0gKCgxMCA8PCAyNCkgfCAo
MCA8PCAxNikgfCAxNDkzMSkpCisJeworCSAgY29uLmNhcDI0Yml0X2NvbG9y
ID0gdHJ1ZTsKKwkgIC8qIElmIHN5c3RlbSBoYXMgMjRiaXQgY29sb3IgY2Fw
YWJpbGl0eSwKKwkgICAgIHVzZSB4dGVybSBjb21wYXRpYmxlIG1vZGUuICov
CisJICBzZXRlbnYgKCJURVJNIiwgInh0ZXJtLTI1NmNvbG9yIiwgMSk7CisJ
fQorICAgIH0KIH0KIAogLyogUmV0dXJuIHRoZSB0dHkgc3RydWN0dXJlIGFz
c29jaWF0ZWQgd2l0aCBhIGdpdmVuIHR0eSBudW1iZXIuICBJZiB0aGUKQEAg
LTQzNSw3ICs0NjEsOCBAQCBmaGFuZGxlcl9jb25zb2xlOjpyZWFkICh2b2lk
ICpwdiwgc2l6ZV90JiBidWZsZW4pCiAJICAgICAgdG9hZGQgPSB0bXA7CiAJ
ICAgIH0KIAkgIC8qIEFsbG93IEN0cmwtU3BhY2UgdG8gZW1pdCBeQCAqLwot
CSAgZWxzZSBpZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFs
S2V5Q29kZSA9PSBWS19TUEFDRQorCSAgZWxzZSBpZiAoaW5wdXRfcmVjLkV2
ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZQorCQkgICA9PSAoY29uLmNh
cDI0Yml0X2NvbG9yID8gJzInIDogVktfU1BBQ0UpCiAJCSAgICYmIChjdHJs
X2tleV9zdGF0ZSAmIENUUkxfUFJFU1NFRCkKIAkJICAgJiYgIShjdHJsX2tl
eV9zdGF0ZSAmIEFMVF9QUkVTU0VEKSkKIAkgICAgdG9hZGQgPSAiIjsKQEAg
LTg1NSwxMCArODgyLDIzIEBAIGZoYW5kbGVyX2NvbnNvbGU6Om9wZW4gKGlu
dCBmbGFncywgbW9kZV90KQogICBnZXRfdHR5cCAoKS0+cnN0Y29ucyAoZmFs
c2UpOwogICBzZXRfb3Blbl9zdGF0dXMgKCk7CiAKKyAgaWYgKGdldHBpZCAo
KSA9PSBjb24ub3duZXIgJiYgY29uLmNhcDI0Yml0X2NvbG9yKQorICAgIHsK
KyAgICAgIERXT1JEIGR3TW9kZTsKKyAgICAgIC8qIEVuYWJsZSB4dGVybSBj
b21wYXRpYmxlIG1vZGUgaW4gb3V0cHV0ICovCisgICAgICBHZXRDb25zb2xl
TW9kZSAoZ2V0X291dHB1dF9oYW5kbGUgKCksICZkd01vZGUpOworICAgICAg
ZHdNb2RlIHw9IEVOQUJMRV9WSVJUVUFMX1RFUk1JTkFMX1BST0NFU1NJTkc7
CisgICAgICBTZXRDb25zb2xlTW9kZSAoZ2V0X291dHB1dF9oYW5kbGUgKCks
IGR3TW9kZSk7CisgICAgICAvKiBFbmFibGUgeHRlcm0gY29tcGF0aWJsZSBt
b2RlIGluIGlucHV0ICovCisgICAgICBHZXRDb25zb2xlTW9kZSAoZ2V0X2hh
bmRsZSAoKSwgJmR3TW9kZSk7CisgICAgICBkd01vZGUgfD0gRU5BQkxFX1ZJ
UlRVQUxfVEVSTUlOQUxfSU5QVVQ7CisgICAgICBTZXRDb25zb2xlTW9kZSAo
Z2V0X2hhbmRsZSAoKSwgZHdNb2RlKTsKKyAgICB9CisKICAgRFdPUkQgY2Zs
YWdzOwogICBpZiAoR2V0Q29uc29sZU1vZGUgKGdldF9oYW5kbGUgKCksICZj
ZmxhZ3MpKQotICAgIFNldENvbnNvbGVNb2RlIChnZXRfaGFuZGxlICgpLAot
CQkgICAgRU5BQkxFX1dJTkRPV19JTlBVVCB8IEVOQUJMRV9NT1VTRV9JTlBV
VCB8IGNmbGFncyk7CisgICAgU2V0Q29uc29sZU1vZGUgKGdldF9oYW5kbGUg
KCksIEVOQUJMRV9XSU5ET1dfSU5QVVQKKwkJICAgIHwgKGNvbi5jYXAyNGJp
dF9jb2xvciA/IDAgOiBFTkFCTEVfTU9VU0VfSU5QVVQpIHwgY2ZsYWdzKTsK
IAogICBkZWJ1Z19wcmludGYgKCJvcGVuZWQgY29uaW4kICVwLCBjb25vdXQk
ICVwIiwgZ2V0X2hhbmRsZSAoKSwKIAkJZ2V0X291dHB1dF9oYW5kbGUgKCkp
OwpAQCAtODc4LDYgKzkxOCwyMSBAQCBmaGFuZGxlcl9jb25zb2xlOjpvcGVu
X3NldHVwIChpbnQgZmxhZ3MpCiBpbnQKIGZoYW5kbGVyX2NvbnNvbGU6OmNs
b3NlICgpCiB7CisgIGRlYnVnX3ByaW50ZiAoImNsb3Npbmc6ICVwLCAlcCIs
IGdldF9oYW5kbGUgKCksIGdldF9vdXRwdXRfaGFuZGxlICgpKTsKKworICBp
ZiAoc2hhcmVkX2NvbnNvbGVfaW5mbyAmJiBnZXRwaWQgKCkgPT0gY29uLm93
bmVyICYmIGNvbi5jYXAyNGJpdF9jb2xvcikKKyAgICB7CisgICAgICBEV09S
RCBkd01vZGU7CisgICAgICAvKiBEaXNhYmxlIHh0ZXJtIGNvbXBhdGlibGUg
bW9kZSBpbiBpbnB1dCAqLworICAgICAgR2V0Q29uc29sZU1vZGUgKGdldF9o
YW5kbGUgKCksICZkd01vZGUpOworICAgICAgZHdNb2RlICY9IH5FTkFCTEVf
VklSVFVBTF9URVJNSU5BTF9JTlBVVDsKKyAgICAgIFNldENvbnNvbGVNb2Rl
IChnZXRfaGFuZGxlICgpLCBkd01vZGUpOworICAgICAgLyogRGlzYWJsZSB4
dGVybSBjb21wYXRpYmxlIG1vZGUgaW4gb3V0cHV0ICovCisgICAgICBHZXRD
b25zb2xlTW9kZSAoZ2V0X291dHB1dF9oYW5kbGUgKCksICZkd01vZGUpOwor
ICAgICAgZHdNb2RlICY9IH5FTkFCTEVfVklSVFVBTF9URVJNSU5BTF9QUk9D
RVNTSU5HOworICAgICAgU2V0Q29uc29sZU1vZGUgKGdldF9vdXRwdXRfaGFu
ZGxlICgpLCBkd01vZGUpOworICAgIH0KKwogICBDbG9zZUhhbmRsZSAoZ2V0
X2hhbmRsZSAoKSk7CiAgIENsb3NlSGFuZGxlIChnZXRfb3V0cHV0X2hhbmRs
ZSAoKSk7CiAgIGlmICghaGF2ZV9leGVjZWQpCkBAIC05ODcsNiArMTA0Miwx
MyBAQCBmaGFuZGxlcl9jb25zb2xlOjpvdXRwdXRfdGNzZXRhdHRyIChpbnQs
IHN0cnVjdCB0ZXJtaW9zIGNvbnN0ICp0KQogICAvKiBBbGwgdGhlIG91dHB1
dCBiaXRzIHdlIGNhbiBpZ25vcmUgKi8KIAogICBEV09SRCBmbGFncyA9IEVO
QUJMRV9QUk9DRVNTRURfT1VUUFVUIHwgRU5BQkxFX1dSQVBfQVRfRU9MX09V
VFBVVDsKKyAgLyogSWYgc3lzdGVtIGhhcyAyNGJpdCBjb2xvciBjYXBhYmls
aXR5LCB1c2UgeHRlcm0gY29tcGF0aWJsZSBtb2RlLiAqLworICBpZiAoY29u
LmNhcDI0Yml0X2NvbG9yKQorICAgIHsKKyAgICAgIGZsYWdzIHw9IEVOQUJM
RV9WSVJUVUFMX1RFUk1JTkFMX1BST0NFU1NJTkc7CisgICAgICBpZiAoISh0
LT5jX29mbGFnICYgT1BPU1QpIHx8ICEodC0+Y19vZmxhZyAmIE9OTENSKSkK
KwlmbGFncyB8PSBESVNBQkxFX05FV0xJTkVfQVVUT19SRVRVUk47CisgICAg
fQogCiAgIGludCByZXMgPSBTZXRDb25zb2xlTW9kZSAoZ2V0X291dHB1dF9o
YW5kbGUgKCksIGZsYWdzKSA/IDAgOiAtMTsKICAgaWYgKHJlcykKQEAgLTEw
NDMsNyArMTEwNSwxMCBAQCBmaGFuZGxlcl9jb25zb2xlOjppbnB1dF90Y3Nl
dGF0dHIgKGludCwgc3RydWN0IHRlcm1pb3MgY29uc3QgKnQpCiAgICAgICBm
bGFncyB8PSBFTkFCTEVfUFJPQ0VTU0VEX0lOUFVUOwogICAgIH0KIAotICBm
bGFncyB8PSBFTkFCTEVfV0lORE9XX0lOUFVUIHwgRU5BQkxFX01PVVNFX0lO
UFVUOworICBmbGFncyB8PSBFTkFCTEVfV0lORE9XX0lOUFVUIHwgKGNvbi5j
YXAyNGJpdF9jb2xvciA/IDAgOiBFTkFCTEVfTU9VU0VfSU5QVVQpOworICAv
KiBpZiBzeXN0ZW0gaGFzIDI0Yml0IGNvbG9yIGNhcGFiaWxpdHksIHVzZSB4
dGVybSBjb21wYXRpYmxlIG1vZGUuICovCisgIGlmIChjb24uY2FwMjRiaXRf
Y29sb3IpCisgICAgZmxhZ3MgfD0gRU5BQkxFX1ZJUlRVQUxfVEVSTUlOQUxf
SU5QVVQ7CiAKICAgaW50IHJlczsKICAgaWYgKGZsYWdzID09IG9mbGFncykK
QEAgLTE2MDIsMTEgKzE2NjcsMzIgQEAgc3RhdGljIGNvbnN0IGNoYXIgYmFz
ZV9jaGFyc1syNTZdID0KIC8qRjAgRjEgRjIgRjMgRjQgRjUgRjYgRjcgKi8g
Tk9SLCBOT1IsIE5PUiwgTk9SLCBOT1IsIE5PUiwgTk9SLCBOT1IsCiAvKkY4
IEY5IEZBIEZCIEZDIEZEIEZFIEZGICovIE5PUiwgTk9SLCBOT1IsIE5PUiwg
Tk9SLCBOT1IsIE5PUiwgTk9SIH07CiAKK3N0YXRpYyBjb25zdCBjaGFyIHRh
YmxlMjU2WzI1Nl0gPQoreworICAgMCwgNCwgMiwgNiwgMSwgNSwgMywgNywg
OCwxMiwxMCwxNCwgOSwxMywxMSwxNSwKKyAgIDAsIDEsIDEsIDEsIDksIDks
IDIsIDMsIDMsIDMsIDMsIDksIDIsIDMsIDMsIDMsCisgICAzLDExLCAyLCAz
LCAzLCAzLDExLDExLDEwLCAzLCAzLDExLDExLDExLDEwLDEwLAorICAxMSwx
MSwxMSwxMSwgNCwgNSwgNSwgNSwgNSwgOSwgNiwgOCwgOCwgOCwgOCwgOSwK
KyAgIDYsIDgsIDgsIDgsIDgsIDcsIDYsIDgsIDgsIDgsIDcsIDcsIDYsIDgs
IDgsIDcsCisgICA3LDExLDEwLDEwLCA3LCA3LDExLDExLCA0LCA1LCA1LCA1
LCA1LDEzLCA2LCA4LAorICAgOCwgOCwgOCwgNywgNiwgOCwgOCwgOCwgNywg
NywgNiwgOCwgOCwgNywgNywgNywKKyAgIDYsIDgsIDcsIDcsIDcsIDcsMTQs
IDcsIDcsIDcsIDcsIDcsIDQsIDUsIDUsIDUsCisgIDEzLDEzLCA2LCA4LCA4
LCA4LCA3LCA3LCA2LCA4LCA4LCA3LCA3LCA3LCA2LCA4LAorICAgNywgNywg
NywgNywxNCwgNywgNywgNywgNywgNywxNCwgNywgNywgNywgNywxNSwKKyAg
MTIsIDUsIDUsMTMsMTMsMTMsIDYsIDgsIDgsIDcsIDcsMTMsIDYsIDgsIDcs
IDcsCisgICA3LCA3LDE0LCA3LCA3LCA3LCA3LCA3LDE0LCA3LCA3LCA3LCA3
LDE1LDE0LDE0LAorICAgNywgNywxNSwxNSwxMiwxMiwxMywxMywxMywxMywx
MiwxMiwgNywgNywxMywxMywKKyAgMTQsIDcsIDcsIDcsIDcsIDcsMTQsIDcs
IDcsIDcsIDcsMTUsMTQsMTQsIDcsIDcsCisgIDE1LDE1LDE0LDE0LCA3LDE1
LDE1LDE1LCAwLCAwLCAwLCAwLCAwLCAwLCA4LCA4LAorICAgOCwgOCwgOCwg
OCwgOCwgOCwgOCwgOCwgNywgNywgNywgNywgNywgNywxNSwxNQorfTsKKwog
dm9pZAogZmhhbmRsZXJfY29uc29sZTo6Y2hhcl9jb21tYW5kIChjaGFyIGMp
CiB7CiAgIGludCB4LCB5LCBuOwogICBjaGFyIGJ1Zls0MF07CisgIGludCBy
LCBnLCBiOwogCiAgIHN3aXRjaCAoYykKICAgICB7CkBAIC0xNjc4LDYgKzE3
NjQsNDAgQEAgZmhhbmRsZXJfY29uc29sZTo6Y2hhcl9jb21tYW5kIChjaGFy
IGMpCiAJICAgICBjYXNlIDM3OgkJLyogV0hJVEUgZm9yZWcgKi8KIAkgICAg
ICAgY29uLmZnID0gRk9SRUdST1VORF9CTFVFIHwgRk9SRUdST1VORF9HUkVF
TiB8IEZPUkVHUk9VTkRfUkVEOwogCSAgICAgICBicmVhazsKKwkgICAgIGNh
c2UgMzg6CisJICAgICAgIGlmIChjb24ubmFyZ3MgPCAxKQorCQkgLyogU2Vx
dWVuY2UgZXJyb3IgKGFib3J0KSAqLworCQkgYnJlYWs7CisJICAgICAgIHN3
aXRjaCAoY29uLmFyZ3NbMV0pCisJCSB7CisJCSBjYXNlIDI6CisJCSAgIGlm
IChjb24ubmFyZ3MgIT0gNCkKKwkJICAgICAvKiBTZXF1ZW5jZSBlcnJvciAo
YWJvcnQpICovCisJCSAgICAgYnJlYWs7CisJCSAgIHIgPSBjb24uYXJnc1sy
XTsKKwkJICAgZyA9IGNvbi5hcmdzWzNdOworCQkgICBiID0gY29uLmFyZ3Nb
NF07CisJCSAgIHIgPSByIDwgKDk1ICsgMSkgLyAyID8gMCA6IHIgPiAyNTUg
PyA1IDogKHIgLSA1NSArIDIwKSAvIDQwOworCQkgICBnID0gZyA8ICg5NSAr
IDEpIC8gMiA/IDAgOiBnID4gMjU1ID8gNSA6IChnIC0gNTUgKyAyMCkgLyA0
MDsKKwkJICAgYiA9IGIgPCAoOTUgKyAxKSAvIDIgPyAwIDogYiA+IDI1NSA/
IDUgOiAoYiAtIDU1ICsgMjApIC8gNDA7CisJCSAgIGNvbi5mZyA9IHRhYmxl
MjU2WzE2ICsgciozNiArIGcqNiArIGJdOworCQkgICBicmVhazsKKwkJIGNh
c2UgNToKKwkJICAgaWYgKGNvbi5uYXJncyAhPSAyKQorCQkgICAgIC8qIFNl
cXVlbmNlIGVycm9yIChhYm9ydCkgKi8KKwkJICAgICBicmVhazsKKwkJICAg
eworCQkgICAgIGludCBpZHggPSBjb24uYXJnc1syXTsKKwkJICAgICBpZiAo
aWR4IDwgMCkKKwkJICAgICAgIGlkeCA9IDA7CisJCSAgICAgaWYgKGlkeCA+
IDI1NSkKKwkJICAgICAgIGlkeCA9IDI1NTsKKwkJICAgICBjb24uZmcgPSB0
YWJsZTI1NltpZHhdOworCQkgICB9CisJCSAgIGJyZWFrOworCQkgfQorCSAg
ICAgICBpICs9IGNvbi5uYXJnczsKKwkgICAgICAgYnJlYWs7CiAJICAgICBj
YXNlIDM5OgogCSAgICAgICBjb24uZmcgPSBjb24uZGVmYXVsdF9jb2xvciAm
IEZPUkVHUk9VTkRfQVRUUl9NQVNLOwogCSAgICAgICBicmVhazsKQEAgLTE3
MDUsNiArMTgyNSw0MCBAQCBmaGFuZGxlcl9jb25zb2xlOjpjaGFyX2NvbW1h
bmQgKGNoYXIgYykKIAkgICAgIGNhc2UgNDc6ICAgIC8qIFdISVRFIGJhY2tn
cm91bmQgKi8KIAkgICAgICAgY29uLmJnID0gQkFDS0dST1VORF9CTFVFIHwg
QkFDS0dST1VORF9HUkVFTiB8IEJBQ0tHUk9VTkRfUkVEOwogCSAgICAgICBi
cmVhazsKKwkgICAgIGNhc2UgNDg6CisJICAgICAgIGlmIChjb24ubmFyZ3Mg
PCAxKQorCQkgLyogU2VxdWVuY2UgZXJyb3IgKGFib3J0KSAqLworCQkgYnJl
YWs7CisJICAgICAgIHN3aXRjaCAoY29uLmFyZ3NbMV0pCisJCSB7CisJCSBj
YXNlIDI6CisJCSAgIGlmIChjb24ubmFyZ3MgIT0gNCkKKwkJICAgICAvKiBT
ZXF1ZW5jZSBlcnJvciAoYWJvcnQpICovCisJCSAgICAgYnJlYWs7CisJCSAg
IHIgPSBjb24uYXJnc1syXTsKKwkJICAgZyA9IGNvbi5hcmdzWzNdOworCQkg
ICBiID0gY29uLmFyZ3NbNF07CisJCSAgIHIgPSByIDwgKDk1ICsgMSkgLyAy
ID8gMCA6IHIgPiAyNTUgPyA1IDogKHIgLSA1NSArIDIwKSAvIDQwOworCQkg
ICBnID0gZyA8ICg5NSArIDEpIC8gMiA/IDAgOiBnID4gMjU1ID8gNSA6IChn
IC0gNTUgKyAyMCkgLyA0MDsKKwkJICAgYiA9IGIgPCAoOTUgKyAxKSAvIDIg
PyAwIDogYiA+IDI1NSA/IDUgOiAoYiAtIDU1ICsgMjApIC8gNDA7CisJCSAg
IGNvbi5iZyA9IHRhYmxlMjU2WzE2ICsgciozNiArIGcqNiArIGJdIDw8IDQ7
CisJCSAgIGJyZWFrOworCQkgY2FzZSA1OgorCQkgICBpZiAoY29uLm5hcmdz
ICE9IDIpCisJCSAgICAgLyogU2VxdWVuY2UgZXJyb3IgKGFib3J0KSAqLwor
CQkgICAgIGJyZWFrOworCQkgICB7CisJCSAgICAgaW50IGlkeCA9IGNvbi5h
cmdzWzJdOworCQkgICAgIGlmIChpZHggPCAwKQorCQkgICAgICAgaWR4ID0g
MDsKKwkJICAgICBpZiAoaWR4ID4gMjU1KQorCQkgICAgICAgaWR4ID0gMjU1
OworCQkgICAgIGNvbi5iZyA9IHRhYmxlMjU2W2lkeF0gPDwgNDsKKwkJICAg
fQorCQkgICBicmVhazsKKwkJIH0KKwkgICAgICAgaSArPSBjb24ubmFyZ3M7
CisJICAgICAgIGJyZWFrOwogCSAgICAgY2FzZSA0OToKIAkgICAgICAgY29u
LmJnID0gY29uLmRlZmF1bHRfY29sb3IgJiBCQUNLR1JPVU5EX0FUVFJfTUFT
SzsKIAkgICAgICAgYnJlYWs7CkBAIC0yMTQzLDEwICsyMjk3LDEyIEBAIGZo
YW5kbGVyX2NvbnNvbGU6OndyaXRlX25vcm1hbCAoY29uc3QgdW5zaWduZWQg
Y2hhciAqc3JjLAogICAvKiBMb29wIG92ZXIgc3JjIGJ1ZmZlciBhcyBsb25n
IGFzIHdlIGhhdmUganVzdCBzaW1wbGUgY2hhcmFjdGVycy4gIFN0b3AKICAg
ICAgYXMgc29vbiBhcyB3ZSByZWFjaCB0aGUgY29udmVyc2lvbiBsaW1pdCwg
b3IgaWYgd2UgZW5jb3VudGVyIGEgY29udHJvbAogICAgICBjaGFyYWN0ZXIg
b3IgYSB0cnVuY2F0ZWQgb3IgaW52YWxpZCBtdXRpYnl0ZSBzZXF1ZW5jZS4g
Ki8KKyAgLyogSWYgc3lzdGVtIGhhcyAyNGJpdCBjb2xvciBjYXBhYmlsaXR5
LCBqdXN0IHdyaXRlIGFsbCBjb250cm9sCisgICAgIHNlcXVlbmNlcyB0byBj
b25zb2xlIHNpbmNlIHh0ZXJtIGNvbXBhdGlibGUgbW9kZSBpcyBlbmFibGVk
LiAqLwogICBtZW1zZXQgKCZwcywgMCwgc2l6ZW9mIHBzKTsKICAgd2hpbGUg
KGZvdW5kIDwgZW5kCiAJICYmIGZvdW5kIC0gc3JjIDwgQ09OVkVSVF9MSU1J
VAotCSAmJiBiYXNlX2NoYXJzWypmb3VuZF0gPT0gTk9SKQorCSAmJiAoY29u
LmNhcDI0Yml0X2NvbG9yIHx8IGJhc2VfY2hhcnNbKmZvdW5kXSA9PSBOT1Ip
ICkKICAgICB7CiAgICAgICBzd2l0Y2ggKHJldCA9IGZfbWJ0b3djIChfUkVF
TlQsIE5VTEwsIChjb25zdCBjaGFyICopIGZvdW5kLAogCQkJICAgICAgIGVu
ZCAtIGZvdW5kLCAmcHMpKQpAQCAtMjM5NCw2ICsyNTUwLDggQEAgZmhhbmRs
ZXJfY29uc29sZTo6d3JpdGUgKGNvbnN0IHZvaWQgKnZzcmMsIHNpemVfdCBs
ZW4pCiAJICAgIGNvbi5yYXJnID0gY29uLnJhcmcgKiAxMCArICgqc3JjIC0g
JzAnKTsKIAkgIGVsc2UgaWYgKCpzcmMgPT0gJzsnICYmIChjb24ucmFyZyA9
PSAyIHx8IGNvbi5yYXJnID09IDApKQogCSAgICBjb24uc3RhdGUgPSBnZXR0
aXRsZTsKKwkgIGVsc2UgaWYgKCpzcmMgPT0gJzsnICYmIChjb24ucmFyZyA9
PSA0IHx8IGNvbi5yYXJnID09IDEwNCkpCisJICAgIGNvbi5zdGF0ZSA9IGVh
dHBhbGV0dGU7CiAJICBlbHNlCiAJICAgIGNvbi5zdGF0ZSA9IGVhdHRpdGxl
OwogCSAgc3JjKys7CkBAIC0yNDE2LDYgKzI1NzQsMjEgQEAgZmhhbmRsZXJf
Y29uc29sZTo6d3JpdGUgKGNvbnN0IHZvaWQgKnZzcmMsIHNpemVfdCBsZW4p
CiAJICAgIHNyYysrOwogCSAgICBicmVhazsKIAkgIH0KKwljYXNlIGVhdHBh
bGV0dGU6CisJICBpZiAoKnNyYyA9PSAnXDAzMycpCisJICAgIGNvbi5zdGF0
ZSA9IGVuZHBhbGV0dGU7CisJICBlbHNlIGlmICgqc3JjID09ICdcYScpCisJ
ICAgIGNvbi5zdGF0ZSA9IG5vcm1hbDsKKwkgIHNyYysrOworCSAgYnJlYWs7
CisJY2FzZSBlbmRwYWxldHRlOgorCSAgaWYgKCpzcmMgPT0gJ1xcJykKKwkg
ICAgY29uLnN0YXRlID0gbm9ybWFsOworCSAgZWxzZQorCSAgICAvKiBTZXF1
ZW5jZSBlcnJvciAoYWJvcnQpICovCisJICAgIGNvbi5zdGF0ZSA9IG5vcm1h
bDsKKwkgIHNyYysrOworCSAgYnJlYWs7CiAJY2FzZSBnb3RzcXVhcmU6CiAJ
ICBpZiAoKnNyYyA9PSAnOycpCiAJICAgIHsKZGlmZiAtLWdpdCBhL3dpbnN1
cC9jeWd3aW4vc2VsZWN0LmNjIGIvd2luc3VwL2N5Z3dpbi9zZWxlY3QuY2MK
aW5kZXggOWIxOGU4ZjgwLi4yOGFkY2YzZTcgMTAwNjQ0Ci0tLSBhL3dpbnN1
cC9jeWd3aW4vc2VsZWN0LmNjCisrKyBiL3dpbnN1cC9jeWd3aW4vc2VsZWN0
LmNjCkBAIC0xMDUzLDYgKzEwNTMsMTQgQEAgcGVla19jb25zb2xlIChzZWxl
Y3RfcmVjb3JkICptZSwgYm9vbCkKIAkJZWxzZSBpZiAoaXJlYy5FdmVudC5L
ZXlFdmVudC51Q2hhci5Vbmljb2RlQ2hhcgogCQkJIHx8IGZoYW5kbGVyX2Nv
bnNvbGU6OmdldF9ub25hc2NpaV9rZXkgKGlyZWMsIHRtcGJ1ZikpCiAJCSAg
cmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsKKwkJLyogQWxsb3cgQ3Ry
bC1TcGFjZSBmb3IgXkAgKi8KKwkJZWxzZSBpZiAoIChpcmVjLkV2ZW50Lktl
eUV2ZW50LndWaXJ0dWFsS2V5Q29kZSA9PSBWS19TUEFDRQorCQkJICAgfHwg
aXJlYy5FdmVudC5LZXlFdmVudC53VmlydHVhbEtleUNvZGUgPT0gJzInKQor
CQkJICYmIChpcmVjLkV2ZW50LktleUV2ZW50LmR3Q29udHJvbEtleVN0YXRl
ICYKKwkJCSAgICAgKExFRlRfQ1RSTF9QUkVTU0VEIHwgUklHSFRfQ1RSTF9Q
UkVTU0VEKSkKKwkJCSAmJiAhKGlyZWMuRXZlbnQuS2V5RXZlbnQuZHdDb250
cm9sS2V5U3RhdGUKKwkJCSAgICAgICYgKExFRlRfQUxUX1BSRVNTRUQgfCBS
SUdIVF9BTFRfUFJFU1NFRCkpICkKKwkJICByZXR1cm4gbWUtPnJlYWRfcmVh
ZHkgPSB0cnVlOwogCSAgICAgIH0KIAkgICAgLyogSWdub3JlIGtleSB1cCBl
dmVudHMsIGV4Y2VwdCBmb3IgQWx0K051bXBhZCBldmVudHMuICovCiAJICAg
IGVsc2UgaWYgKGlzX2FsdF9udW1wYWRfZXZlbnQgKCZpcmVjKSkKLS0gCjIu
MTcuMAoK

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: application/octet-stream;
 name="0002-Cygwin-console-fix-select-behaviour.patch"
Content-Disposition: attachment;
 filename="0002-Cygwin-console-fix-select-behaviour.patch"
Content-Transfer-Encoding: base64
Content-length: 40675

RnJvbSA0NjExYTA1MmM2MjY1YzcxYjFiMmFlMTgzNDM3MmYzODg0MDQ3OTk0
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBUYWthc2hpIFlhbm8g
PHRha2FzaGkueWFub0BuaWZ0eS5uZS5qcD4KRGF0ZTogU3VuLCAzMSBNYXIg
MjAxOSAwOTozMzo1NSArMDkwMApTdWJqZWN0OiBbUEFUQ0ggMi8zXSBDeWd3
aW46IGNvbnNvbGU6IGZpeCBzZWxlY3QoKSBiZWhhdmlvdXIKCi0gUHJldmlv
dXNseSwgc2VsZWN0KCkgd291bGQgcmV0dXJuIHdoZW4gb25seSBvbmUga2V5
IGlzIHR5cGVkIGV2ZW4KICBpbiBjYW5vbmljYWwgbW9kZS4gV2l0aCB0aGlz
IHBhdGNoLCBpdCByZXR1cm5zIGFmdGVyIG9uZSBsaW5lIGlzCiAgY29tcGxl
dGVkLgotLS0KIHdpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaCAgICAgICAgICB8
ICAxMyArLQogd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9jb25zb2xlLmNjIHwg
NzI4ICsrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogd2luc3VwL2N5
Z3dpbi9zZWxlY3QuY2MgICAgICAgICAgIHwgIDgxICsrLS0KIDMgZmlsZXMg
Y2hhbmdlZCwgNDE4IGluc2VydGlvbnMoKyksIDQwNCBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmggYi93aW5z
dXAvY3lnd2luL2ZoYW5kbGVyLmgKaW5kZXggM2YxNzlhOWY2Li5mODhiMDUw
MDkgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaAorKysg
Yi93aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmgKQEAgLTE4ODUsNiArMTg4NSwx
NSBAQCBwdWJsaWM6CiAgICAgdHR5X21pbiB0dHlfbWluX3N0YXRlOwogICAg
IGRldl9jb25zb2xlIGNvbjsKICAgfTsKKyAgYm9vbCBpbnB1dF9yZWFkeTsK
KyAgZW51bSBpbnB1dF9zdGF0ZXMKKyAgeworICAgIGlucHV0X2Vycm9yID0g
LTEsCisgICAgaW5wdXRfcHJvY2Vzc2luZyA9IDAsCisgICAgaW5wdXRfb2sg
PSAxLAorICAgIGlucHV0X3NpZ25hbGxlZCA9IDIsCisgICAgaW5wdXRfd2lu
Y2ggPSAzCisgIH07CiBwcml2YXRlOgogICBzdGF0aWMgY29uc3QgdW5zaWdu
ZWQgTUFYX1dSSVRFX0NIQVJTOwogICBzdGF0aWMgY29uc29sZV9zdGF0ZSAq
c2hhcmVkX2NvbnNvbGVfaW5mbzsKQEAgLTE5NzAsNyArMTk3OSw3IEBAIHBy
aXZhdGU6CiAgIHZvaWQgZml4dXBfYWZ0ZXJfZm9yayAoSEFORExFKSB7Zml4
dXBfYWZ0ZXJfZm9ya19leGVjIChmYWxzZSk7fQogICB2b2lkIHNldF9jbG9z
ZV9vbl9leGVjIChib29sIHZhbCk7CiAgIHZvaWQgc2V0X2lucHV0X3N0YXRl
ICgpOwotICB2b2lkIHNlbmRfd2luY2hfbWF5YmUgKCk7CisgIGJvb2wgc2Vu
ZF93aW5jaF9tYXliZSAoKTsKICAgdm9pZCBzZXR1cCAoKTsKICAgYm9vbCBz
ZXRfdW5pdCAoKTsKICAgc3RhdGljIGJvb2wgbmVlZF9pbnZpc2libGUgKCk7
CkBAIC0xOTkzLDYgKzIwMDIsOCBAQCBwcml2YXRlOgogICAgIGNvcHl0byAo
ZmgpOwogICAgIHJldHVybiBmaDsKICAgfQorCisgIGlucHV0X3N0YXRlcyBw
cm9jZXNzX2lucHV0X21lc3NhZ2UgKCk7CiAgIGZyaWVuZCB0dHlfbWluICog
dHR5X2xpc3Q6OmdldF9jdHR5cCAoKTsKIH07CiAKZGlmZiAtLWdpdCBhL3dp
bnN1cC9jeWd3aW4vZmhhbmRsZXJfY29uc29sZS5jYyBiL3dpbnN1cC9jeWd3
aW4vZmhhbmRsZXJfY29uc29sZS5jYwppbmRleCAxMmY0NTA4MzQuLjczMDE1
MjQ2YSAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9jb25z
b2xlLmNjCisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfY29uc29sZS5j
YwpAQCAtMjc3LDcgKzI3Nyw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6OnNldF9j
dXJzb3JfbWF5YmUgKCkKICAgICB9CiB9CiAKLXZvaWQKK2Jvb2wKIGZoYW5k
bGVyX2NvbnNvbGU6OnNlbmRfd2luY2hfbWF5YmUgKCkKIHsKICAgU0hPUlQg
eSA9IGNvbi5kd1dpblNpemUuWTsKQEAgLTI4OSw3ICsyODksOSBAQCBmaGFu
ZGxlcl9jb25zb2xlOjpzZW5kX3dpbmNoX21heWJlICgpCiAgICAgICBjb24u
c2Nyb2xsX3JlZ2lvbi5Ub3AgPSAwOwogICAgICAgY29uLnNjcm9sbF9yZWdp
b24uQm90dG9tID0gLTE7CiAgICAgICBnZXRfdHR5cCAoKS0+a2lsbF9wZ3Jw
IChTSUdXSU5DSCk7CisgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9CisgIHJl
dHVybiBmYWxzZTsKIH0KIAogLyogQ2hlY2sgd2hldGhlciBhIG1vdXNlIGV2
ZW50IGlzIHRvIGJlIHJlcG9ydGVkIGFzIGFuIGVzY2FwZSBzZXF1ZW5jZSAq
LwpAQCAtMzIyLDM2ICszMjQsMTcgQEAgZmhhbmRsZXJfY29uc29sZTo6bW91
c2VfYXdhcmUgKE1PVVNFX0VWRU5UX1JFQ09SRCYgbW91c2VfZXZlbnQpCiB2
b2lkIF9fcmVnMwogZmhhbmRsZXJfY29uc29sZTo6cmVhZCAodm9pZCAqcHYs
IHNpemVfdCYgYnVmbGVuKQogeworICB0ZXJtaW9zX3ByaW50ZiAoInJlYWQo
JXAsJWQpIiwgcHYsIGJ1Zmxlbik7CisKICAgcHVzaF9wcm9jZXNzX3N0YXRl
IHByb2Nlc3Nfc3RhdGUgKFBJRF9UVFlJTik7CiAKLSAgSEFORExFIGggPSBn
ZXRfaGFuZGxlICgpOworICBpbnQgY29waWVkX2NoYXJzID0gMDsKIAotI2Rl
ZmluZSBidWYgKChjaGFyICopIHB2KQorICBEV09SRCB0aW1lb3V0ID0gaXNf
bm9uYmxvY2tpbmcgKCkgPyAwIDogSU5GSU5JVEU7CiAKLSAgaW50IGNoOwog
ICBzZXRfaW5wdXRfc3RhdGUgKCk7CiAKLSAgLyogQ2hlY2sgY29uc29sZSBy
ZWFkLWFoZWFkIGJ1ZmZlciBmaWxsZWQgZnJvbSB0ZXJtaW5hbCByZXF1ZXN0
cyAqLwotICBpZiAoY29uLmNvbnNfcmFwb2kgJiYgKmNvbi5jb25zX3JhcG9p
KQotICAgIHsKLSAgICAgICpidWYgPSAqY29uLmNvbnNfcmFwb2krKzsKLSAg
ICAgIGJ1ZmxlbiA9IDE7Ci0gICAgICByZXR1cm47Ci0gICAgfQotCi0gIGlu
dCBjb3BpZWRfY2hhcnMgPSBnZXRfcmVhZGFoZWFkX2ludG9fYnVmZmVyIChi
dWYsIGJ1Zmxlbik7Ci0KLSAgaWYgKGNvcGllZF9jaGFycykKLSAgICB7Ci0g
ICAgICBidWZsZW4gPSBjb3BpZWRfY2hhcnM7Ci0gICAgICByZXR1cm47Ci0g
ICAgfQotCi0gIERXT1JEIHRpbWVvdXQgPSBpc19ub25ibG9ja2luZyAoKSA/
IDAgOiBJTkZJTklURTsKLSAgY2hhciB0bXBbNjBdOwotCi0gIHRlcm1pb3Mg
dGkgPSBnZXRfdHR5cCAoKS0+dGk7Ci0gIGZvciAoOzspCisgIHdoaWxlICgh
aW5wdXRfcmVhZHkgJiYgIWdldF9jb25zX3JlYWRhaGVhZF92YWxpZCAoKSkK
ICAgICB7CiAgICAgICBpbnQgYmdyZXM7CiAgICAgICBpZiAoKGJncmVzID0g
YmdfY2hlY2sgKFNJR1RUSU4pKSA8PSBiZ19lb2YpCkBAIC0zNjEsNyArMzQ0
LDcgQEAgZmhhbmRsZXJfY29uc29sZTo6cmVhZCAodm9pZCAqcHYsIHNpemVf
dCYgYnVmbGVuKQogCX0KIAogICAgICAgc2V0X2N1cnNvcl9tYXliZSAoKTsJ
LyogdG8gbWFrZSBjdXJzb3IgYXBwZWFyIG9uIHRoZSBzY3JlZW4gaW1tZWRp
YXRlbHkgKi8KLSAgICAgIHN3aXRjaCAoY3lnd2FpdCAoaCwgdGltZW91dCkp
CisgICAgICBzd2l0Y2ggKGN5Z3dhaXQgKGdldF9oYW5kbGUgKCksIHRpbWVv
dXQpKQogCXsKIAljYXNlIFdBSVRfT0JKRUNUXzA6CiAJICBicmVhazsKQEAg
LTM3OSwzNjcgKzM2Miw0MTAgQEAgZmhhbmRsZXJfY29uc29sZTo6cmVhZCAo
dm9pZCAqcHYsIHNpemVfdCYgYnVmbGVuKQogCSAgZ290byBlcnI7CiAJfQog
Ci0gICAgICBEV09SRCBucmVhZDsKLSAgICAgIElOUFVUX1JFQ09SRCBpbnB1
dF9yZWM7Ci0gICAgICBjb25zdCBjaGFyICp0b2FkZCA9IE5VTEw7CisjZGVm
aW5lIGJ1ZiAoKGNoYXIgKikgcHYpCiAKLSAgICAgIGlmICghUmVhZENvbnNv
bGVJbnB1dFcgKGgsICZpbnB1dF9yZWMsIDEsICZucmVhZCkpCisgICAgICBp
bnQgcmV0OworICAgICAgcmV0ID0gcHJvY2Vzc19pbnB1dF9tZXNzYWdlICgp
OworICAgICAgc3dpdGNoIChyZXQpCiAJewotCSAgc3lzY2FsbF9wcmludGYg
KCJSZWFkQ29uc29sZUlucHV0IGZhaWxlZCwgJUUiKTsKLQkgIGdvdG8gZXJy
OwkJLyogc2VlbXMgdG8gYmUgZmFpbHVyZSAqLworCWNhc2UgaW5wdXRfZXJy
b3I6CisJICBnb3RvIGVycjsKKwljYXNlIGlucHV0X3Byb2Nlc3Npbmc6CisJ
ICBjb250aW51ZTsKKwljYXNlIGlucHV0X29rOiAvKiBpbnB1dCByZWFkeSAq
LworCSAgYnJlYWs7CisJY2FzZSBpbnB1dF9zaWduYWxsZWQ6IC8qIHNpZ25h
bGxlZCAqLworCSAgZ290byBzaWdfZXhpdDsKKwljYXNlIGlucHV0X3dpbmNo
OgorCSAgY29udGludWU7CisJZGVmYXVsdDoKKwkgIC8qIFNob3VsZCBub3Qg
Y29tZSBoZXJlICovCisJICBnb3RvIGVycjsKIAl9CisgICAgfQogCi0gICAg
ICBjb25zdCBXQ0hBUiAmdW5pY29kZV9jaGFyID0gaW5wdXRfcmVjLkV2ZW50
LktleUV2ZW50LnVDaGFyLlVuaWNvZGVDaGFyOwotICAgICAgY29uc3QgRFdP
UkQgJmN0cmxfa2V5X3N0YXRlID0gaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50
LmR3Q29udHJvbEtleVN0YXRlOworICAvKiBDaGVjayBjb25zb2xlIHJlYWQt
YWhlYWQgYnVmZmVyIGZpbGxlZCBmcm9tIHRlcm1pbmFsIHJlcXVlc3RzICov
CisgIHdoaWxlIChjb24uY29uc19yYXBvaSAmJiAqY29uLmNvbnNfcmFwb2kg
JiYgYnVmbGVuKQorICAgIHsKKyAgICAgIGJ1Zltjb3BpZWRfY2hhcnMrK10g
PSAqY29uLmNvbnNfcmFwb2krKzsKKyAgICAgIGJ1ZmxlbiAtLTsKKyAgICB9
CiAKLSAgICAgIC8qIGNoZWNrIHRoZSBldmVudCB0aGF0IG9jY3VycmVkICov
Ci0gICAgICBzd2l0Y2ggKGlucHV0X3JlYy5FdmVudFR5cGUpCi0JewotCWNh
c2UgS0VZX0VWRU5UOgorICBjb3BpZWRfY2hhcnMgKz0KKyAgICBnZXRfcmVh
ZGFoZWFkX2ludG9fYnVmZmVyIChidWYgKyBjb3BpZWRfY2hhcnMsIGJ1Zmxl
bik7CiAKLQkgIGNvbi5uTW9kaWZpZXJzID0gMDsKKyAgaWYgKCFyYWxlbikK
KyAgICBpbnB1dF9yZWFkeSA9IGZhbHNlOworCisjdW5kZWYgYnVmCisKKyAg
YnVmbGVuID0gY29waWVkX2NoYXJzOworICByZXR1cm47CisKK2VycjoKKyAg
X19zZXRlcnJubyAoKTsKKyAgYnVmbGVuID0gKHNpemVfdCkgLTE7CisgIHJl
dHVybjsKKworc2lnX2V4aXQ6CisgIHNldF9zaWdfZXJybm8gKEVJTlRSKTsK
KyAgYnVmbGVuID0gKHNpemVfdCkgLTE7Cit9CisKK2ZoYW5kbGVyX2NvbnNv
bGU6OmlucHV0X3N0YXRlcworZmhhbmRsZXJfY29uc29sZTo6cHJvY2Vzc19p
bnB1dF9tZXNzYWdlICh2b2lkKQoreworICBjaGFyIHRtcFs2MF07CisKKyAg
aWYgKCFzaGFyZWRfY29uc29sZV9pbmZvKQorICAgIHJldHVybiBpbnB1dF9l
cnJvcjsKKworICB0ZXJtaW9zICp0aSA9ICYoZ2V0X3R0eXAgKCktPnRpKTsK
KworICBEV09SRCBucmVhZDsKKyAgSU5QVVRfUkVDT1JEIGlucHV0X3JlYzsK
KyAgY29uc3QgY2hhciAqdG9hZGQgPSBOVUxMOworCisgIGlmICghUmVhZENv
bnNvbGVJbnB1dFcgKGdldF9oYW5kbGUgKCksICZpbnB1dF9yZWMsIDEsICZu
cmVhZCkpCisgICAgeworICAgICAgdGVybWlvc19wcmludGYgKCJSZWFkQ29u
c29sZUlucHV0IGZhaWxlZCwgJUUiKTsKKyAgICAgIHJldHVybiBpbnB1dF9l
cnJvcjsKKyAgICB9CisKKyAgY29uc3QgV0NIQVIgJnVuaWNvZGVfY2hhciA9
IGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC51Q2hhci5Vbmljb2RlQ2hhcjsK
KyAgY29uc3QgRFdPUkQgJmN0cmxfa2V5X3N0YXRlID0gaW5wdXRfcmVjLkV2
ZW50LktleUV2ZW50LmR3Q29udHJvbEtleVN0YXRlOworCisgIC8qIGNoZWNr
IHRoZSBldmVudCB0aGF0IG9jY3VycmVkICovCisgIHN3aXRjaCAoaW5wdXRf
cmVjLkV2ZW50VHlwZSkKKyAgICB7CisgICAgY2FzZSBLRVlfRVZFTlQ6CisK
KyAgICAgIGNvbi5uTW9kaWZpZXJzID0gMDsKIAogI2lmZGVmIERFQlVHR0lO
RwotCSAgLyogYWxsb3cgbWFudWFsIHN3aXRjaGluZyB0by9mcm9tIHJhdyBt
b2RlIHZpYSBjdHJsLWFsdC1zY3JvbGxsb2NrICovCi0JICBpZiAoaW5wdXRf
cmVjLkV2ZW50LktleUV2ZW50LmJLZXlEb3duCi0JICAgICAgJiYgaW5wdXRf
cmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSA9PSBWS19TQ1JP
TEwKLQkgICAgICAmJiAoY3RybF9rZXlfc3RhdGUgJiAoTEVGVF9BTFRfUFJF
U1NFRCB8IExFRlRfQ1RSTF9QUkVTU0VEKSkKLQkJICA9PSAoTEVGVF9BTFRf
UFJFU1NFRCB8IExFRlRfQ1RSTF9QUkVTU0VEKSkKLQkgICAgewotCSAgICAg
IHNldF9yYXdfd2luMzJfa2V5Ym9hcmRfbW9kZSAoIWNvbi5yYXdfd2luMzJf
a2V5Ym9hcmRfbW9kZSk7Ci0JICAgICAgY29udGludWU7Ci0JICAgIH0KKyAg
ICAgIC8qIGFsbG93IG1hbnVhbCBzd2l0Y2hpbmcgdG8vZnJvbSByYXcgbW9k
ZSB2aWEgY3RybC1hbHQtc2Nyb2xsbG9jayAqLworICAgICAgaWYgKGlucHV0
X3JlYy5FdmVudC5LZXlFdmVudC5iS2V5RG93bgorCSAgJiYgaW5wdXRfcmVj
LkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSA9PSBWS19TQ1JPTEwK
KwkgICYmIChjdHJsX2tleV9zdGF0ZSAmIChMRUZUX0FMVF9QUkVTU0VEIHwg
TEVGVF9DVFJMX1BSRVNTRUQpKQorCSAgPT0gKExFRlRfQUxUX1BSRVNTRUQg
fCBMRUZUX0NUUkxfUFJFU1NFRCkpCisJeworCSAgc2V0X3Jhd193aW4zMl9r
ZXlib2FyZF9tb2RlICghY29uLnJhd193aW4zMl9rZXlib2FyZF9tb2RlKTsK
KwkgIHJldHVybiBpbnB1dF9wcm9jZXNzaW5nOworCX0KICNlbmRpZgogCi0J
ICBpZiAoY29uLnJhd193aW4zMl9rZXlib2FyZF9tb2RlKQorICAgICAgaWYg
KGNvbi5yYXdfd2luMzJfa2V5Ym9hcmRfbW9kZSkKKwl7CisJICBfX3NtYWxs
X3NwcmludGYgKHRtcCwgIlwwMzN7JXU7JXU7JXU7JXU7JXU7JWx1SyIsCisJ
CQkgICBpbnB1dF9yZWMuRXZlbnQuS2V5RXZlbnQuYktleURvd24sCisJCQkg
ICBpbnB1dF9yZWMuRXZlbnQuS2V5RXZlbnQud1JlcGVhdENvdW50LAorCQkJ
ICAgaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSwK
KwkJCSAgIGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC53VmlydHVhbFNjYW5D
b2RlLAorCQkJICAgaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LnVDaGFyLlVu
aWNvZGVDaGFyLAorCQkJICAgaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmR3
Q29udHJvbEtleVN0YXRlKTsKKwkgIHRvYWRkID0gdG1wOworCSAgbnJlYWQg
PSBzdHJsZW4gKHRvYWRkKTsKKwkgIGJyZWFrOworCX0KKworICAgICAgLyog
SWdub3JlIGtleSB1cCBldmVudHMsIGV4Y2VwdCBmb3IgQWx0K051bXBhZCBl
dmVudHMuICovCisgICAgICBpZiAoIWlucHV0X3JlYy5FdmVudC5LZXlFdmVu
dC5iS2V5RG93biAmJgorCSAgIWlzX2FsdF9udW1wYWRfZXZlbnQgKCZpbnB1
dF9yZWMpKQorCXJldHVybiBpbnB1dF9wcm9jZXNzaW5nOworICAgICAgLyog
SWdub3JlIEFsdCtOdW1wYWQga2V5cy4gIFRoZXkgYXJlIGV2ZW50dWFsbHkg
aGFuZGxlZCBiZWxvdyBhZnRlcgorCSByZWxlYXNpbmcgdGhlIEFsdCBrZXku
ICovCisgICAgICBpZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmJLZXlE
b3duCisJICAmJiBpc19hbHRfbnVtcGFkX2tleSAoJmlucHV0X3JlYykpCisJ
cmV0dXJuIGlucHV0X3Byb2Nlc3Npbmc7CisKKyAgICAgIGlmIChjdHJsX2tl
eV9zdGF0ZSAmIFNISUZUX1BSRVNTRUQpCisJY29uLm5Nb2RpZmllcnMgfD0g
MTsKKyAgICAgIGlmIChjdHJsX2tleV9zdGF0ZSAmIFJJR0hUX0FMVF9QUkVT
U0VEKQorCWNvbi5uTW9kaWZpZXJzIHw9IDI7CisgICAgICBpZiAoY3RybF9r
ZXlfc3RhdGUgJiBDVFJMX1BSRVNTRUQpCisJY29uLm5Nb2RpZmllcnMgfD0g
NDsKKyAgICAgIGlmIChjdHJsX2tleV9zdGF0ZSAmIExFRlRfQUxUX1BSRVNT
RUQpCisJY29uLm5Nb2RpZmllcnMgfD0gODsKKworICAgICAgLyogQWxsb3cg
QmFja3NwYWNlIHRvIGVtaXQgXj8gYW5kIGVzY2FwZSBzZXF1ZW5jZXMuICov
CisgICAgICBpZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFs
S2V5Q29kZSA9PSBWS19CQUNLKQorCXsKKwkgIGNoYXIgYyA9IGNvbi5iYWNr
c3BhY2Vfa2V5Y29kZTsKKwkgIG5yZWFkID0gMDsKKwkgIGlmIChjdHJsX2tl
eV9zdGF0ZSAmIEFMVF9QUkVTU0VEKQogCSAgICB7Ci0JICAgICAgX19zbWFs
bF9zcHJpbnRmICh0bXAsICJcMDMzeyV1OyV1OyV1OyV1OyV1OyVsdUsiLAot
CQkJCSAgICBpbnB1dF9yZWMuRXZlbnQuS2V5RXZlbnQuYktleURvd24sCi0J
CQkJICAgIGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC53UmVwZWF0Q291bnQs
Ci0JCQkJICAgIGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC53VmlydHVhbEtl
eUNvZGUsCi0JCQkJICAgIGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC53Vmly
dHVhbFNjYW5Db2RlLAotCQkJCSAgICBpbnB1dF9yZWMuRXZlbnQuS2V5RXZl
bnQudUNoYXIuVW5pY29kZUNoYXIsCi0JCQkJICAgIGlucHV0X3JlYy5FdmVu
dC5LZXlFdmVudC5kd0NvbnRyb2xLZXlTdGF0ZSk7Ci0JICAgICAgdG9hZGQg
PSB0bXA7Ci0JICAgICAgbnJlYWQgPSBzdHJsZW4gKHRvYWRkKTsKLQkgICAg
ICBicmVhazsKKwkgICAgICBpZiAoY29uLm1ldGFiaXQpCisJCWMgfD0gMHg4
MDsKKwkgICAgICBlbHNlCisJCXRtcFtucmVhZCsrXSA9ICdcZSc7CiAJICAg
IH0KLQotCSAgLyogSWdub3JlIGtleSB1cCBldmVudHMsIGV4Y2VwdCBmb3Ig
QWx0K051bXBhZCBldmVudHMuICovCi0JICBpZiAoIWlucHV0X3JlYy5FdmVu
dC5LZXlFdmVudC5iS2V5RG93biAmJgotCSAgICAgICFpc19hbHRfbnVtcGFk
X2V2ZW50ICgmaW5wdXRfcmVjKSkKLQkgICAgY29udGludWU7Ci0JICAvKiBJ
Z25vcmUgQWx0K051bXBhZCBrZXlzLiAgVGhleSBhcmUgZXZlbnR1YWxseSBo
YW5kbGVkIGJlbG93IGFmdGVyCi0JICAgICByZWxlYXNpbmcgdGhlIEFsdCBr
ZXkuICovCi0JICBpZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmJLZXlE
b3duCi0JICAgICAgJiYgaXNfYWx0X251bXBhZF9rZXkgKCZpbnB1dF9yZWMp
KQotCSAgICBjb250aW51ZTsKLQotCSAgaWYgKGN0cmxfa2V5X3N0YXRlICYg
U0hJRlRfUFJFU1NFRCkKLQkgICAgY29uLm5Nb2RpZmllcnMgfD0gMTsKLQkg
IGlmIChjdHJsX2tleV9zdGF0ZSAmIFJJR0hUX0FMVF9QUkVTU0VEKQotCSAg
ICBjb24ubk1vZGlmaWVycyB8PSAyOwotCSAgaWYgKGN0cmxfa2V5X3N0YXRl
ICYgQ1RSTF9QUkVTU0VEKQotCSAgICBjb24ubk1vZGlmaWVycyB8PSA0Owot
CSAgaWYgKGN0cmxfa2V5X3N0YXRlICYgTEVGVF9BTFRfUFJFU1NFRCkKLQkg
ICAgY29uLm5Nb2RpZmllcnMgfD0gODsKLQotCSAgLyogQWxsb3cgQmFja3Nw
YWNlIHRvIGVtaXQgXj8gYW5kIGVzY2FwZSBzZXF1ZW5jZXMuICovCi0JICBp
ZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSA9
PSBWS19CQUNLKQorCSAgdG1wW25yZWFkKytdID0gYzsKKwkgIHRtcFtucmVh
ZF0gPSAwOworCSAgdG9hZGQgPSB0bXA7CisJfQorICAgICAgLyogQWxsb3cg
Q3RybC1TcGFjZSB0byBlbWl0IF5AICovCisgICAgICBlbHNlIGlmIChpbnB1
dF9yZWMuRXZlbnQuS2V5RXZlbnQud1ZpcnR1YWxLZXlDb2RlCisJICAgICAg
ID09IChjb24uY2FwMjRiaXRfY29sb3IgPyAnMicgOiBWS19TUEFDRSkKKwkg
ICAgICAgJiYgKGN0cmxfa2V5X3N0YXRlICYgQ1RSTF9QUkVTU0VEKQorCSAg
ICAgICAmJiAhKGN0cmxfa2V5X3N0YXRlICYgQUxUX1BSRVNTRUQpKQorCXRv
YWRkID0gIiI7CisgICAgICBlbHNlIGlmICh1bmljb2RlX2NoYXIgPT0gMAor
CSAgICAgICAvKiBhcnJvdy9mdW5jdGlvbiBrZXlzICovCisJICAgICAgIHx8
IChpbnB1dF9yZWMuRXZlbnQuS2V5RXZlbnQuZHdDb250cm9sS2V5U3RhdGUg
JiBFTkhBTkNFRF9LRVkpKQorCXsKKwkgIHRvYWRkID0gZ2V0X25vbmFzY2lp
X2tleSAoaW5wdXRfcmVjLCB0bXApOworCSAgaWYgKCF0b2FkZCkKIAkgICAg
ewotCSAgICAgIGNoYXIgYyA9IGNvbi5iYWNrc3BhY2Vfa2V5Y29kZTsKLQkg
ICAgICBucmVhZCA9IDA7Ci0JICAgICAgaWYgKGN0cmxfa2V5X3N0YXRlICYg
QUxUX1BSRVNTRUQpCi0JCXsKLQkJICBpZiAoY29uLm1ldGFiaXQpCi0JCSAg
ICBjIHw9IDB4ODA7Ci0JCSAgZWxzZQotCQkgICAgdG1wW25yZWFkKytdID0g
J1xlJzsKLQkJfQotCSAgICAgIHRtcFtucmVhZCsrXSA9IGM7Ci0JICAgICAg
dG1wW25yZWFkXSA9IDA7Ci0JICAgICAgdG9hZGQgPSB0bXA7CisJICAgICAg
Y29uLm5Nb2RpZmllcnMgPSAwOworCSAgICAgIHJldHVybiBpbnB1dF9wcm9j
ZXNzaW5nOwogCSAgICB9Ci0JICAvKiBBbGxvdyBDdHJsLVNwYWNlIHRvIGVt
aXQgXkAgKi8KLQkgIGVsc2UgaWYgKGlucHV0X3JlYy5FdmVudC5LZXlFdmVu
dC53VmlydHVhbEtleUNvZGUKLQkJICAgPT0gKGNvbi5jYXAyNGJpdF9jb2xv
ciA/ICcyJyA6IFZLX1NQQUNFKQotCQkgICAmJiAoY3RybF9rZXlfc3RhdGUg
JiBDVFJMX1BSRVNTRUQpCi0JCSAgICYmICEoY3RybF9rZXlfc3RhdGUgJiBB
TFRfUFJFU1NFRCkpCi0JICAgIHRvYWRkID0gIiI7Ci0JICBlbHNlIGlmICh1
bmljb2RlX2NoYXIgPT0gMAotCSAgICAgIC8qIGFycm93L2Z1bmN0aW9uIGtl
eXMgKi8KLQkgICAgICB8fCAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmR3
Q29udHJvbEtleVN0YXRlICYgRU5IQU5DRURfS0VZKSkKKwkgIG5yZWFkID0g
c3RybGVuICh0b2FkZCk7CisJfQorICAgICAgZWxzZQorCXsKKwkgIG5yZWFk
ID0gY29uLmNvbl90b19zdHIgKHRtcCArIDEsIDU5LCB1bmljb2RlX2NoYXIp
OworCSAgLyogRGV0ZXJtaW5lIGlmIHRoZSBrZXlzdHJva2UgaXMgbW9kaWZp
ZWQgYnkgTUVUQS4gIFRoZSB0cmlja3kKKwkgICAgIHBhcnQgaXMgdG8gZGlz
dGluZ3Vpc2ggd2hldGhlciB0aGUgcmlnaHQgQWx0IGtleSBzaG91bGQgYmUK
KwkgICAgIHJlY29nbml6ZWQgYXMgQWx0LCBvciBhcyBBbHRHci4gKi8KKwkg
IGJvb2wgbWV0YSA9CisJICAgIC8qIEFsdCBidXQgbm90IEFsdEdyICg9IGxl
ZnQgY3RybCArIHJpZ2h0IGFsdCk/ICovCisJICAgIChjdHJsX2tleV9zdGF0
ZSAmIEFMVF9QUkVTU0VEKSAhPSAwCisJICAgICYmICgoY3RybF9rZXlfc3Rh
dGUgJiBDVFJMX1BSRVNTRUQpID09IDAKKwkJLyogYnV0IGFsc28gYWxsb3cg
QWx0LUFsdEdyOiAqLworCQl8fCAoY3RybF9rZXlfc3RhdGUgJiBBTFRfUFJF
U1NFRCkgPT0gQUxUX1BSRVNTRUQKKwkJfHwgKHVuaWNvZGVfY2hhciA8PSAw
eDFmIHx8IHVuaWNvZGVfY2hhciA9PSAweDdmKSk7CisJICBpZiAoIW1ldGEp
CiAJICAgIHsKLQkgICAgICB0b2FkZCA9IGdldF9ub25hc2NpaV9rZXkgKGlu
cHV0X3JlYywgdG1wKTsKLQkgICAgICBpZiAoIXRvYWRkKQotCQl7Ci0JCSAg
Y29uLm5Nb2RpZmllcnMgPSAwOwotCQkgIGNvbnRpbnVlOwotCQl9Ci0JICAg
ICAgbnJlYWQgPSBzdHJsZW4gKHRvYWRkKTsKKwkgICAgICAvKiBEZXRlcm1p
bmUgaWYgdGhlIGNoYXJhY3RlciBpcyBpbiB0aGUgY3VycmVudCBtdWx0aWJ5
dGUKKwkJIGNoYXJzZXQuICBUaGUgdGVzdCBpcyBlYXN5LiAgSWYgdGhlIG11
bHRpYnl0ZSBzZXF1ZW5jZQorCQkgaXMgPiAxIGFuZCB0aGUgZmlyc3QgYnl0
ZSBpcyBBU0NJSSBDQU4sIHRoZSBjaGFyYWN0ZXIKKwkJIGhhcyBiZWVuIHRy
YW5zbGF0ZWQgaW50byB0aGUgQVNDSUkgQ0FOICsgVVRGLTggcmVwbGFjZW1l
bnQKKwkJIHNlcXVlbmNlLiAgSWYgc28sIGp1c3QgaWdub3JlIHRoZSBrZXlw
cmVzcy4KKwkJIEZJWE1FOiBJcyB0aGVyZSBhIGJldHRlciBzb2x1dGlvbj8g
Ki8KKwkgICAgICBpZiAobnJlYWQgPiAxICYmIHRtcFsxXSA9PSAweDE4KQor
CQliZWVwICgpOworCSAgICAgIGVsc2UKKwkJdG9hZGQgPSB0bXAgKyAxOwor
CSAgICB9CisJICBlbHNlIGlmIChjb24ubWV0YWJpdCkKKwkgICAgeworCSAg
ICAgIHRtcFsxXSB8PSAweDgwOworCSAgICAgIHRvYWRkID0gdG1wICsgMTsK
IAkgICAgfQogCSAgZWxzZQogCSAgICB7Ci0JICAgICAgbnJlYWQgPSBjb24u
Y29uX3RvX3N0ciAodG1wICsgMSwgNTksIHVuaWNvZGVfY2hhcik7Ci0JICAg
ICAgLyogRGV0ZXJtaW5lIGlmIHRoZSBrZXlzdHJva2UgaXMgbW9kaWZpZWQg
YnkgTUVUQS4gIFRoZSB0cmlja3kKLQkJIHBhcnQgaXMgdG8gZGlzdGluZ3Vp
c2ggd2hldGhlciB0aGUgcmlnaHQgQWx0IGtleSBzaG91bGQgYmUKLQkJIHJl
Y29nbml6ZWQgYXMgQWx0LCBvciBhcyBBbHRHci4gKi8KLQkgICAgICBib29s
IG1ldGEgPQotCQkgICAgIC8qIEFsdCBidXQgbm90IEFsdEdyICg9IGxlZnQg
Y3RybCArIHJpZ2h0IGFsdCk/ICovCi0JCSAgICAgKGN0cmxfa2V5X3N0YXRl
ICYgQUxUX1BSRVNTRUQpICE9IDAKLQkJICAgICAmJiAoKGN0cmxfa2V5X3N0
YXRlICYgQ1RSTF9QUkVTU0VEKSA9PSAwCi0JCQkgICAgLyogYnV0IGFsc28g
YWxsb3cgQWx0LUFsdEdyOiAqLwotCQkJIHx8IChjdHJsX2tleV9zdGF0ZSAm
IEFMVF9QUkVTU0VEKSA9PSBBTFRfUFJFU1NFRAotCQkJIHx8ICh1bmljb2Rl
X2NoYXIgPD0gMHgxZiB8fCB1bmljb2RlX2NoYXIgPT0gMHg3ZikpOwotCSAg
ICAgIGlmICghbWV0YSkKKwkgICAgICB0bXBbMF0gPSAnXDAzMyc7CisJICAg
ICAgdG1wWzFdID0gY3lnX3RvbG93ZXIgKHRtcFsxXSk7CisJICAgICAgdG9h
ZGQgPSB0bXA7CisJICAgICAgbnJlYWQrKzsKKwkgICAgICBjb24ubk1vZGlm
aWVycyAmPSB+NDsKKwkgICAgfQorCX0KKyAgICAgIGJyZWFrOworCisgICAg
Y2FzZSBNT1VTRV9FVkVOVDoKKyAgICAgIHNlbmRfd2luY2hfbWF5YmUgKCk7
CisJeworCSAgTU9VU0VfRVZFTlRfUkVDT1JEJiBtb3VzZV9ldmVudCA9IGlu
cHV0X3JlYy5FdmVudC5Nb3VzZUV2ZW50OworCSAgLyogQXMgYSB1bmlxdWUg
Z3VhcmQgZm9yIG1vdXNlIHJlcG9ydCBnZW5lcmF0aW9uLAorCSAgICAgY2Fs
bCBtb3VzZV9hd2FyZSgpIHdoaWNoIGlzIGNvbW1vbiB3aXRoIHNlbGVjdCgp
LCBzbyB0aGUgcmVzdWx0CisJICAgICBvZiBzZWxlY3QoKSBhbmQgdGhlIGFj
dHVhbCByZWFkKCkgd2lsbCBiZSBjb25zaXN0ZW50IG9uIHRoZQorCSAgICAg
aXNzdWUgb2Ygd2hldGhlciBpbnB1dCAoaS5lLiBhIG1vdXNlIGVzY2FwZSBz
ZXF1ZW5jZSkgd2lsbAorCSAgICAgYmUgYXZhaWxhYmxlIG9yIG5vdCAqLwor
CSAgaWYgKG1vdXNlX2F3YXJlIChtb3VzZV9ldmVudCkpCisJICAgIHsKKwkg
ICAgICAvKiBOb3RlOiBSZXBvcnRlZCBtb3VzZSBwb3NpdGlvbiB3YXMgYWxy
ZWFkeSByZXRyaWV2ZWQgYnkKKwkJIG1vdXNlX2F3YXJlKCkgYW5kIGFkanVz
dGVkIGJ5IHdpbmRvdyBzY3JvbGwgYnVmZmVyIG9mZnNldCAqLworCisJICAg
ICAgLyogVHJlYXQgdGhlIGRvdWJsZS1jbGljayBldmVudCBsaWtlIGEgcmVn
dWxhciBidXR0b24gcHJlc3MgKi8KKwkgICAgICBpZiAobW91c2VfZXZlbnQu
ZHdFdmVudEZsYWdzID09IERPVUJMRV9DTElDSykKIAkJewotCQkgIC8qIERl
dGVybWluZSBpZiB0aGUgY2hhcmFjdGVyIGlzIGluIHRoZSBjdXJyZW50IG11
bHRpYnl0ZQotCQkgICAgIGNoYXJzZXQuICBUaGUgdGVzdCBpcyBlYXN5LiAg
SWYgdGhlIG11bHRpYnl0ZSBzZXF1ZW5jZQotCQkgICAgIGlzID4gMSBhbmQg
dGhlIGZpcnN0IGJ5dGUgaXMgQVNDSUkgQ0FOLCB0aGUgY2hhcmFjdGVyCi0J
CSAgICAgaGFzIGJlZW4gdHJhbnNsYXRlZCBpbnRvIHRoZSBBU0NJSSBDQU4g
KyBVVEYtOCByZXBsYWNlbWVudAotCQkgICAgIHNlcXVlbmNlLiAgSWYgc28s
IGp1c3QgaWdub3JlIHRoZSBrZXlwcmVzcy4KLQkJICAgICBGSVhNRTogSXMg
dGhlcmUgYSBiZXR0ZXIgc29sdXRpb24/ICovCi0JCSAgaWYgKG5yZWFkID4g
MSAmJiB0bXBbMV0gPT0gMHgxOCkKLQkJICAgIGJlZXAgKCk7Ci0JCSAgZWxz
ZQotCQkgICAgdG9hZGQgPSB0bXAgKyAxOworCQkgIHN5c2NhbGxfcHJpbnRm
ICgibW91c2U6IGRvdWJsZS1jbGljayAtPiBjbGljayIpOworCQkgIG1vdXNl
X2V2ZW50LmR3RXZlbnRGbGFncyA9IDA7CiAJCX0KLQkgICAgICBlbHNlIGlm
IChjb24ubWV0YWJpdCkKKworCSAgICAgIC8qIFRoaXMgY29kZSBhc3N1bWVz
IFdpbmRvd3MgbmV2ZXIgcmVwb3J0cyBtdWx0aXBsZSBidXR0b24KKwkJIGV2
ZW50cyBhdCB0aGUgc2FtZSB0aW1lLiAqLworCSAgICAgIGludCBiID0gMDsK
KwkgICAgICBjaGFyIHN6WzMyXTsKKwkgICAgICBjaGFyIG1vZGU2X3Rlcm0g
PSAnTSc7CisKKwkgICAgICBpZiAobW91c2VfZXZlbnQuZHdFdmVudEZsYWdz
ID09IE1PVVNFX1dIRUVMRUQpCiAJCXsKLQkJICB0bXBbMV0gfD0gMHg4MDsK
LQkJICB0b2FkZCA9IHRtcCArIDE7CisJCSAgaWYgKG1vdXNlX2V2ZW50LmR3
QnV0dG9uU3RhdGUgJiAweEZGODAwMDAwKQorCQkgICAgeworCQkgICAgICBi
ID0gMHg0MTsKKwkJICAgICAgc3RyY3B5IChzeiwgIndoZWVsIGRvd24iKTsK
KwkJICAgIH0KKwkJICBlbHNlCisJCSAgICB7CisJCSAgICAgIGIgPSAweDQw
OworCQkgICAgICBzdHJjcHkgKHN6LCAid2hlZWwgdXAiKTsKKwkJICAgIH0K
IAkJfQogCSAgICAgIGVsc2UKIAkJewotCQkgIHRtcFswXSA9ICdcMDMzJzsK
LQkJICB0bXBbMV0gPSBjeWdfdG9sb3dlciAodG1wWzFdKTsKLQkJICB0b2Fk
ZCA9IHRtcDsKLQkJICBucmVhZCsrOwotCQkgIGNvbi5uTW9kaWZpZXJzICY9
IH40OworCQkgIC8qIElnbm9yZSB1bmltcG9ydGFudCBtb3VzZSBidXR0b25z
ICovCisJCSAgbW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmPSAweDc7CisK
KwkJICBpZiAobW91c2VfZXZlbnQuZHdFdmVudEZsYWdzID09IE1PVVNFX01P
VkVEKQorCQkgICAgeworCQkgICAgICBiID0gY29uLmxhc3RfYnV0dG9uX2Nv
ZGU7CisJCSAgICB9CisJCSAgZWxzZSBpZiAobW91c2VfZXZlbnQuZHdCdXR0
b25TdGF0ZSA8IGNvbi5kd0xhc3RCdXR0b25TdGF0ZSAmJiAhY29uLmV4dF9t
b3VzZV9tb2RlNikKKwkJICAgIHsKKwkJICAgICAgYiA9IDM7CisJCSAgICAg
IHN0cmNweSAoc3osICJidG4gdXAiKTsKKwkJICAgIH0KKwkJICBlbHNlIGlm
ICgobW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmIDEpICE9IChjb24uZHdM
YXN0QnV0dG9uU3RhdGUgJiAxKSkKKwkJICAgIHsKKwkJICAgICAgYiA9IDA7
CisJCSAgICAgIHN0cmNweSAoc3osICJidG4xIGRvd24iKTsKKwkJICAgIH0K
KwkJICBlbHNlIGlmICgobW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmIDIp
ICE9IChjb24uZHdMYXN0QnV0dG9uU3RhdGUgJiAyKSkKKwkJICAgIHsKKwkJ
ICAgICAgYiA9IDI7CisJCSAgICAgIHN0cmNweSAoc3osICJidG4yIGRvd24i
KTsKKwkJICAgIH0KKwkJICBlbHNlIGlmICgobW91c2VfZXZlbnQuZHdCdXR0
b25TdGF0ZSAmIDQpICE9IChjb24uZHdMYXN0QnV0dG9uU3RhdGUgJiA0KSkK
KwkJICAgIHsKKwkJICAgICAgYiA9IDE7CisJCSAgICAgIHN0cmNweSAoc3os
ICJidG4zIGRvd24iKTsKKwkJICAgIH0KKworCQkgIGlmIChjb24uZXh0X21v
dXNlX21vZGU2IC8qIGRpc3Rpbmd1aXNoIHJlbGVhc2UgKi8KKwkJICAgICAg
JiYgbW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSA8IGNvbi5kd0xhc3RCdXR0
b25TdGF0ZSkKKwkJICAgIG1vZGU2X3Rlcm0gPSAnbSc7CisKKwkJICBjb24u
bGFzdF9idXR0b25fY29kZSA9IGI7CisKKwkJICBpZiAobW91c2VfZXZlbnQu
ZHdFdmVudEZsYWdzID09IE1PVVNFX01PVkVEKQorCQkgICAgeworCQkgICAg
ICBiICs9IDMyOworCQkgICAgICBzdHJjcHkgKHN6LCAibW92ZSIpOworCQkg
ICAgfQorCQkgIGVsc2UKKwkJICAgIHsKKwkJICAgICAgLyogUmVtZW1iZXIg
dGhlIG1vZGlmaWVkIGJ1dHRvbiBzdGF0ZSAqLworCQkgICAgICBjb24uZHdM
YXN0QnV0dG9uU3RhdGUgPSBtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlOwor
CQkgICAgfQogCQl9Ci0JICAgIH0KLQkgIGJyZWFrOwogCi0JY2FzZSBNT1VT
RV9FVkVOVDoKLQkgIHNlbmRfd2luY2hfbWF5YmUgKCk7Ci0JICB7Ci0JICAg
IE1PVVNFX0VWRU5UX1JFQ09SRCYgbW91c2VfZXZlbnQgPSBpbnB1dF9yZWMu
RXZlbnQuTW91c2VFdmVudDsKLQkgICAgLyogQXMgYSB1bmlxdWUgZ3VhcmQg
Zm9yIG1vdXNlIHJlcG9ydCBnZW5lcmF0aW9uLAotCSAgICAgICBjYWxsIG1v
dXNlX2F3YXJlKCkgd2hpY2ggaXMgY29tbW9uIHdpdGggc2VsZWN0KCksIHNv
IHRoZSByZXN1bHQKLQkgICAgICAgb2Ygc2VsZWN0KCkgYW5kIHRoZSBhY3R1
YWwgcmVhZCgpIHdpbGwgYmUgY29uc2lzdGVudCBvbiB0aGUKLQkgICAgICAg
aXNzdWUgb2Ygd2hldGhlciBpbnB1dCAoaS5lLiBhIG1vdXNlIGVzY2FwZSBz
ZXF1ZW5jZSkgd2lsbAotCSAgICAgICBiZSBhdmFpbGFibGUgb3Igbm90ICov
Ci0JICAgIGlmIChtb3VzZV9hd2FyZSAobW91c2VfZXZlbnQpKQotCSAgICAg
IHsKLQkJLyogTm90ZTogUmVwb3J0ZWQgbW91c2UgcG9zaXRpb24gd2FzIGFs
cmVhZHkgcmV0cmlldmVkIGJ5Ci0JCSAgIG1vdXNlX2F3YXJlKCkgYW5kIGFk
anVzdGVkIGJ5IHdpbmRvdyBzY3JvbGwgYnVmZmVyIG9mZnNldCAqLwotCi0J
CS8qIFRyZWF0IHRoZSBkb3VibGUtY2xpY2sgZXZlbnQgbGlrZSBhIHJlZ3Vs
YXIgYnV0dG9uIHByZXNzICovCi0JCWlmIChtb3VzZV9ldmVudC5kd0V2ZW50
RmxhZ3MgPT0gRE9VQkxFX0NMSUNLKQotCQkgIHsKLQkJICAgIHN5c2NhbGxf
cHJpbnRmICgibW91c2U6IGRvdWJsZS1jbGljayAtPiBjbGljayIpOwotCQkg
ICAgbW91c2VfZXZlbnQuZHdFdmVudEZsYWdzID0gMDsKLQkJICB9Ci0KLQkJ
LyogVGhpcyBjb2RlIGFzc3VtZXMgV2luZG93cyBuZXZlciByZXBvcnRzIG11
bHRpcGxlIGJ1dHRvbgotCQkgICBldmVudHMgYXQgdGhlIHNhbWUgdGltZS4g
Ki8KLQkJaW50IGIgPSAwOwotCQljaGFyIHN6WzMyXTsKLQkJY2hhciBtb2Rl
Nl90ZXJtID0gJ00nOwotCi0JCWlmIChtb3VzZV9ldmVudC5kd0V2ZW50Rmxh
Z3MgPT0gTU9VU0VfV0hFRUxFRCkKLQkJICB7Ci0JCSAgICBpZiAobW91c2Vf
ZXZlbnQuZHdCdXR0b25TdGF0ZSAmIDB4RkY4MDAwMDApCi0JCSAgICAgIHsK
LQkJCWIgPSAweDQxOwotCQkJc3RyY3B5IChzeiwgIndoZWVsIGRvd24iKTsK
LQkJICAgICAgfQotCQkgICAgZWxzZQotCQkgICAgICB7Ci0JCQliID0gMHg0
MDsKLQkJCXN0cmNweSAoc3osICJ3aGVlbCB1cCIpOwotCQkgICAgICB9Ci0J
CSAgfQotCQllbHNlCi0JCSAgewotCQkgICAgLyogSWdub3JlIHVuaW1wb3J0
YW50IG1vdXNlIGJ1dHRvbnMgKi8KLQkJICAgIG1vdXNlX2V2ZW50LmR3QnV0
dG9uU3RhdGUgJj0gMHg3OworCSAgICAgIC8qIFJlbWVtYmVyIG1vdXNlIHBv
c2l0aW9uICovCisJICAgICAgY29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWCA9
IGNvbi5kd01vdXNlUG9zaXRpb24uWDsKKwkgICAgICBjb24uZHdMYXN0TW91
c2VQb3NpdGlvbi5ZID0gY29uLmR3TW91c2VQb3NpdGlvbi5ZOwogCi0JCSAg
ICBpZiAobW91c2VfZXZlbnQuZHdFdmVudEZsYWdzID09IE1PVVNFX01PVkVE
KQotCQkgICAgICB7Ci0JCQliID0gY29uLmxhc3RfYnV0dG9uX2NvZGU7Ci0J
CSAgICAgIH0KLQkJICAgIGVsc2UgaWYgKG1vdXNlX2V2ZW50LmR3QnV0dG9u
U3RhdGUgPCBjb24uZHdMYXN0QnV0dG9uU3RhdGUgJiYgIWNvbi5leHRfbW91
c2VfbW9kZTYpCi0JCSAgICAgIHsKLQkJCWIgPSAzOwotCQkJc3RyY3B5IChz
eiwgImJ0biB1cCIpOwotCQkgICAgICB9Ci0JCSAgICBlbHNlIGlmICgobW91
c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmIDEpICE9IChjb24uZHdMYXN0QnV0
dG9uU3RhdGUgJiAxKSkKLQkJICAgICAgewotCQkJYiA9IDA7Ci0JCQlzdHJj
cHkgKHN6LCAiYnRuMSBkb3duIik7Ci0JCSAgICAgIH0KLQkJICAgIGVsc2Ug
aWYgKChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlICYgMikgIT0gKGNvbi5k
d0xhc3RCdXR0b25TdGF0ZSAmIDIpKQotCQkgICAgICB7Ci0JCQliID0gMjsK
LQkJCXN0cmNweSAoc3osICJidG4yIGRvd24iKTsKLQkJICAgICAgfQotCQkg
ICAgZWxzZSBpZiAoKG1vdXNlX2V2ZW50LmR3QnV0dG9uU3RhdGUgJiA0KSAh
PSAoY29uLmR3TGFzdEJ1dHRvblN0YXRlICYgNCkpCi0JCSAgICAgIHsKLQkJ
CWIgPSAxOwotCQkJc3RyY3B5IChzeiwgImJ0bjMgZG93biIpOwotCQkgICAg
ICB9Ci0KLQkJICAgIGlmIChjb24uZXh0X21vdXNlX21vZGU2IC8qIGRpc3Rp
bmd1aXNoIHJlbGVhc2UgKi8KLQkJCSYmIG1vdXNlX2V2ZW50LmR3QnV0dG9u
U3RhdGUgPCBjb24uZHdMYXN0QnV0dG9uU3RhdGUpCi0JCQltb2RlNl90ZXJt
ID0gJ20nOworCSAgICAgIC8qIFJlbWVtYmVyIHRoZSBtb2RpZmllcnMgKi8K
KwkgICAgICBjb24ubk1vZGlmaWVycyA9IDA7CisJICAgICAgaWYgKG1vdXNl
X2V2ZW50LmR3Q29udHJvbEtleVN0YXRlICYgU0hJRlRfUFJFU1NFRCkKKwkJ
Y29uLm5Nb2RpZmllcnMgfD0gMHg0OworCSAgICAgIGlmIChtb3VzZV9ldmVu
dC5kd0NvbnRyb2xLZXlTdGF0ZSAmIEFMVF9QUkVTU0VEKQorCQljb24ubk1v
ZGlmaWVycyB8PSAweDg7CisJICAgICAgaWYgKG1vdXNlX2V2ZW50LmR3Q29u
dHJvbEtleVN0YXRlICYgQ1RSTF9QUkVTU0VEKQorCQljb24ubk1vZGlmaWVy
cyB8PSAweDEwOwogCi0JCSAgICBjb24ubGFzdF9idXR0b25fY29kZSA9IGI7
CisJICAgICAgLyogSW5kaWNhdGUgdGhlIG1vZGlmaWVycyAqLworCSAgICAg
IGIgfD0gY29uLm5Nb2RpZmllcnM7CiAKLQkJICAgIGlmIChtb3VzZV9ldmVu
dC5kd0V2ZW50RmxhZ3MgPT0gTU9VU0VfTU9WRUQpCi0JCSAgICAgIHsKLQkJ
CWIgKz0gMzI7Ci0JCQlzdHJjcHkgKHN6LCAibW92ZSIpOwotCQkgICAgICB9
Ci0JCSAgICBlbHNlCi0JCSAgICAgIHsKLQkJCS8qIFJlbWVtYmVyIHRoZSBt
b2RpZmllZCBidXR0b24gc3RhdGUgKi8KLQkJCWNvbi5kd0xhc3RCdXR0b25T
dGF0ZSA9IG1vdXNlX2V2ZW50LmR3QnV0dG9uU3RhdGU7Ci0JCSAgICAgIH0K
LQkJICB9Ci0KLQkJLyogUmVtZW1iZXIgbW91c2UgcG9zaXRpb24gKi8KLQkJ
Y29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWCA9IGNvbi5kd01vdXNlUG9zaXRp
b24uWDsKLQkJY29uLmR3TGFzdE1vdXNlUG9zaXRpb24uWSA9IGNvbi5kd01v
dXNlUG9zaXRpb24uWTsKLQotCQkvKiBSZW1lbWJlciB0aGUgbW9kaWZpZXJz
ICovCi0JCWNvbi5uTW9kaWZpZXJzID0gMDsKLQkJaWYgKG1vdXNlX2V2ZW50
LmR3Q29udHJvbEtleVN0YXRlICYgU0hJRlRfUFJFU1NFRCkKLQkJICAgIGNv
bi5uTW9kaWZpZXJzIHw9IDB4NDsKLQkJaWYgKG1vdXNlX2V2ZW50LmR3Q29u
dHJvbEtleVN0YXRlICYgQUxUX1BSRVNTRUQpCi0JCSAgICBjb24ubk1vZGlm
aWVycyB8PSAweDg7Ci0JCWlmIChtb3VzZV9ldmVudC5kd0NvbnRyb2xLZXlT
dGF0ZSAmIENUUkxfUFJFU1NFRCkKLQkJICAgIGNvbi5uTW9kaWZpZXJzIHw9
IDB4MTA7Ci0KLQkJLyogSW5kaWNhdGUgdGhlIG1vZGlmaWVycyAqLwotCQli
IHw9IGNvbi5uTW9kaWZpZXJzOwotCi0JCS8qIFdlIGNhbiBub3cgY3JlYXRl
IHRoZSBjb2RlLiAqLwotCQlpZiAoY29uLmV4dF9tb3VzZV9tb2RlNikKLQkJ
ICB7Ci0JCSAgICBfX3NtYWxsX3NwcmludGYgKHRtcCwgIlwwMzNbPCVkOyVk
OyVkJWMiLCBiLAotCQkJCSAgICAgY29uLmR3TW91c2VQb3NpdGlvbi5YICsg
MSwKLQkJCQkgICAgIGNvbi5kd01vdXNlUG9zaXRpb24uWSArIDEsCi0JCQkJ
ICAgICBtb2RlNl90ZXJtKTsKLQkJICAgIG5yZWFkID0gc3RybGVuICh0bXAp
OwotCQkgIH0KLQkJZWxzZSBpZiAoY29uLmV4dF9tb3VzZV9tb2RlMTUpCi0J
CSAgewotCQkgICAgX19zbWFsbF9zcHJpbnRmICh0bXAsICJcMDMzWyVkOyVk
OyVkTSIsIGIgKyAzMiwKLQkJCQkgICAgIGNvbi5kd01vdXNlUG9zaXRpb24u
WCArIDEsCi0JCQkJICAgICBjb24uZHdNb3VzZVBvc2l0aW9uLlkgKyAxKTsK
LQkJICAgIG5yZWFkID0gc3RybGVuICh0bXApOwotCQkgIH0KLQkJZWxzZSBp
ZiAoY29uLmV4dF9tb3VzZV9tb2RlNSkKLQkJICB7Ci0JCSAgICB1bnNpZ25l
ZCBpbnQgeGNvZGUgPSBjb24uZHdNb3VzZVBvc2l0aW9uLlggKyAnICcgKyAx
OwotCQkgICAgdW5zaWduZWQgaW50IHljb2RlID0gY29uLmR3TW91c2VQb3Np
dGlvbi5ZICsgJyAnICsgMTsKLQotCQkgICAgX19zbWFsbF9zcHJpbnRmICh0
bXAsICJcMDMzW00lYyIsIGIgKyAnICcpOwotCQkgICAgbnJlYWQgPSA0Owot
CQkgICAgLyogdGhlIG5lYXQgbmVzdGVkIGVuY29kaW5nIGZ1bmN0aW9uIG9m
IG1pbnR0eQotCQkgICAgICAgZG9lcyBub3QgY29tcGlsZSBpbiBnKyssIHNv
IGxldCdzIHVuZm9sZCBpdDogKi8KLQkJICAgIGlmICh4Y29kZSA8IDB4ODAp
Ci0JCSAgICAgIHRtcCBbbnJlYWQrK10gPSB4Y29kZTsKLQkJICAgIGVsc2Ug
aWYgKHhjb2RlIDwgMHg4MDApCi0JCSAgICAgIHsKLQkJCXRtcCBbbnJlYWQr
K10gPSAweEMwICsgKHhjb2RlID4+IDYpOwotCQkJdG1wIFtucmVhZCsrXSA9
IDB4ODAgKyAoeGNvZGUgJiAweDNGKTsKLQkJICAgICAgfQotCQkgICAgZWxz
ZQotCQkgICAgICB0bXAgW25yZWFkKytdID0gMDsKLQkJICAgIGlmICh5Y29k
ZSA8IDB4ODApCi0JCSAgICAgIHRtcCBbbnJlYWQrK10gPSB5Y29kZTsKLQkJ
ICAgIGVsc2UgaWYgKHljb2RlIDwgMHg4MDApCi0JCSAgICAgIHsKLQkJCXRt
cCBbbnJlYWQrK10gPSAweEMwICsgKHljb2RlID4+IDYpOwotCQkJdG1wIFtu
cmVhZCsrXSA9IDB4ODAgKyAoeWNvZGUgJiAweDNGKTsKLQkJICAgICAgfQot
CQkgICAgZWxzZQotCQkgICAgICB0bXAgW25yZWFkKytdID0gMDsKLQkJICB9
Ci0JCWVsc2UKLQkJICB7Ci0JCSAgICB1bnNpZ25lZCBpbnQgeGNvZGUgPSBj
b24uZHdNb3VzZVBvc2l0aW9uLlggKyAnICcgKyAxOwotCQkgICAgdW5zaWdu
ZWQgaW50IHljb2RlID0gY29uLmR3TW91c2VQb3NpdGlvbi5ZICsgJyAnICsg
MTsKLQkJICAgIGlmICh4Y29kZSA+PSAyNTYpCi0JCSAgICAgIHhjb2RlID0g
MDsKLQkJICAgIGlmICh5Y29kZSA+PSAyNTYpCi0JCSAgICAgIHljb2RlID0g
MDsKLQkJICAgIF9fc21hbGxfc3ByaW50ZiAodG1wLCAiXDAzM1tNJWMlYyVj
IiwgYiArICcgJywKLQkJCQkgICAgIHhjb2RlLCB5Y29kZSk7Ci0JCSAgICBu
cmVhZCA9IDY7CS8qIHRtcCBtYXkgY29udGFpbiBOVUwgYnl0ZXMgKi8KLQkJ
ICB9Ci0JCXN5c2NhbGxfcHJpbnRmICgibW91c2U6ICVzIGF0ICglZCwlZCki
LCBzeiwKLQkJCQljb24uZHdNb3VzZVBvc2l0aW9uLlgsCi0JCQkJY29uLmR3
TW91c2VQb3NpdGlvbi5ZKTsKLQotCQl0b2FkZCA9IHRtcDsKLQkgICAgICB9
Ci0JICB9Ci0JICBicmVhazsKLQotCWNhc2UgRk9DVVNfRVZFTlQ6Ci0JICBp
ZiAoY29uLnVzZV9mb2N1cykKLQkgICAgewotCSAgICAgIGlmIChpbnB1dF9y
ZWMuRXZlbnQuRm9jdXNFdmVudC5iU2V0Rm9jdXMpCi0JCV9fc21hbGxfc3By
aW50ZiAodG1wLCAiXDAzM1tJIik7CisJICAgICAgLyogV2UgY2FuIG5vdyBj
cmVhdGUgdGhlIGNvZGUuICovCisJICAgICAgaWYgKGNvbi5leHRfbW91c2Vf
bW9kZTYpCisJCXsKKwkJICBfX3NtYWxsX3NwcmludGYgKHRtcCwgIlwwMzNb
PCVkOyVkOyVkJWMiLCBiLAorCQkJCSAgIGNvbi5kd01vdXNlUG9zaXRpb24u
WCArIDEsCisJCQkJICAgY29uLmR3TW91c2VQb3NpdGlvbi5ZICsgMSwKKwkJ
CQkgICBtb2RlNl90ZXJtKTsKKwkJICBucmVhZCA9IHN0cmxlbiAodG1wKTsK
KwkJfQorCSAgICAgIGVsc2UgaWYgKGNvbi5leHRfbW91c2VfbW9kZTE1KQor
CQl7CisJCSAgX19zbWFsbF9zcHJpbnRmICh0bXAsICJcMDMzWyVkOyVkOyVk
TSIsIGIgKyAzMiwKKwkJCQkgICBjb24uZHdNb3VzZVBvc2l0aW9uLlggKyAx
LAorCQkJCSAgIGNvbi5kd01vdXNlUG9zaXRpb24uWSArIDEpOworCQkgIG5y
ZWFkID0gc3RybGVuICh0bXApOworCQl9CisJICAgICAgZWxzZSBpZiAoY29u
LmV4dF9tb3VzZV9tb2RlNSkKKwkJeworCQkgIHVuc2lnbmVkIGludCB4Y29k
ZSA9IGNvbi5kd01vdXNlUG9zaXRpb24uWCArICcgJyArIDE7CisJCSAgdW5z
aWduZWQgaW50IHljb2RlID0gY29uLmR3TW91c2VQb3NpdGlvbi5ZICsgJyAn
ICsgMTsKKworCQkgIF9fc21hbGxfc3ByaW50ZiAodG1wLCAiXDAzM1tNJWMi
LCBiICsgJyAnKTsKKwkJICBucmVhZCA9IDQ7CisJCSAgLyogdGhlIG5lYXQg
bmVzdGVkIGVuY29kaW5nIGZ1bmN0aW9uIG9mIG1pbnR0eQorCQkgICAgIGRv
ZXMgbm90IGNvbXBpbGUgaW4gZysrLCBzbyBsZXQncyB1bmZvbGQgaXQ6ICov
CisJCSAgaWYgKHhjb2RlIDwgMHg4MCkKKwkJICAgIHRtcCBbbnJlYWQrK10g
PSB4Y29kZTsKKwkJICBlbHNlIGlmICh4Y29kZSA8IDB4ODAwKQorCQkgICAg
eworCQkgICAgICB0bXAgW25yZWFkKytdID0gMHhDMCArICh4Y29kZSA+PiA2
KTsKKwkJICAgICAgdG1wIFtucmVhZCsrXSA9IDB4ODAgKyAoeGNvZGUgJiAw
eDNGKTsKKwkJICAgIH0KKwkJICBlbHNlCisJCSAgICB0bXAgW25yZWFkKytd
ID0gMDsKKwkJICBpZiAoeWNvZGUgPCAweDgwKQorCQkgICAgdG1wIFtucmVh
ZCsrXSA9IHljb2RlOworCQkgIGVsc2UgaWYgKHljb2RlIDwgMHg4MDApCisJ
CSAgICB7CisJCSAgICAgIHRtcCBbbnJlYWQrK10gPSAweEMwICsgKHljb2Rl
ID4+IDYpOworCQkgICAgICB0bXAgW25yZWFkKytdID0gMHg4MCArICh5Y29k
ZSAmIDB4M0YpOworCQkgICAgfQorCQkgIGVsc2UKKwkJICAgIHRtcCBbbnJl
YWQrK10gPSAwOworCQl9CiAJICAgICAgZWxzZQotCQlfX3NtYWxsX3Nwcmlu
dGYgKHRtcCwgIlwwMzNbTyIpOworCQl7CisJCSAgdW5zaWduZWQgaW50IHhj
b2RlID0gY29uLmR3TW91c2VQb3NpdGlvbi5YICsgJyAnICsgMTsKKwkJICB1
bnNpZ25lZCBpbnQgeWNvZGUgPSBjb24uZHdNb3VzZVBvc2l0aW9uLlkgKyAn
ICcgKyAxOworCQkgIGlmICh4Y29kZSA+PSAyNTYpCisJCSAgICB4Y29kZSA9
IDA7CisJCSAgaWYgKHljb2RlID49IDI1NikKKwkJICAgIHljb2RlID0gMDsK
KwkJICBfX3NtYWxsX3NwcmludGYgKHRtcCwgIlwwMzNbTSVjJWMlYyIsIGIg
KyAnICcsCisJCQkJICAgeGNvZGUsIHljb2RlKTsKKwkJICBucmVhZCA9IDY7
CS8qIHRtcCBtYXkgY29udGFpbiBOVUwgYnl0ZXMgKi8KKwkJfQorCSAgICAg
IHN5c2NhbGxfcHJpbnRmICgibW91c2U6ICVzIGF0ICglZCwlZCkiLCBzeiwK
KwkJCSAgICAgIGNvbi5kd01vdXNlUG9zaXRpb24uWCwKKwkJCSAgICAgIGNv
bi5kd01vdXNlUG9zaXRpb24uWSk7CiAKIAkgICAgICB0b2FkZCA9IHRtcDsK
LQkgICAgICBucmVhZCA9IDM7CiAJICAgIH0KLQkgIGJyZWFrOwotCi0JY2Fz
ZSBXSU5ET1dfQlVGRkVSX1NJWkVfRVZFTlQ6Ci0JICBzZW5kX3dpbmNoX21h
eWJlICgpOwotCSAgLyogZmFsbCB0aHJvdWdoICovCi0JZGVmYXVsdDoKLQkg
IGNvbnRpbnVlOwogCX0KKyAgICAgIGJyZWFrOwogCi0gICAgICBpZiAodG9h
ZGQpCisgICAgY2FzZSBGT0NVU19FVkVOVDoKKyAgICAgIGlmIChjb24udXNl
X2ZvY3VzKQogCXsKLQkgIGxpbmVfZWRpdF9zdGF0dXMgcmVzID0gbGluZV9l
ZGl0ICh0b2FkZCwgbnJlYWQsIHRpKTsKLQkgIGlmIChyZXMgPT0gbGluZV9l
ZGl0X3NpZ25hbGxlZCkKLQkgICAgZ290byBzaWdfZXhpdDsKLQkgIGVsc2Ug
aWYgKHJlcyA9PSBsaW5lX2VkaXRfaW5wdXRfZG9uZSkKLQkgICAgYnJlYWs7
Ci0JfQotICAgIH0KKwkgIGlmIChpbnB1dF9yZWMuRXZlbnQuRm9jdXNFdmVu
dC5iU2V0Rm9jdXMpCisJICAgIF9fc21hbGxfc3ByaW50ZiAodG1wLCAiXDAz
M1tJIik7CisJICBlbHNlCisJICAgIF9fc21hbGxfc3ByaW50ZiAodG1wLCAi
XDAzM1tPIik7CiAKLSAgd2hpbGUgKGJ1ZmxlbikKLSAgICBpZiAoKGNoID0g
Z2V0X3JlYWRhaGVhZCAoKSkgPCAwKQorCSAgdG9hZGQgPSB0bXA7CisJICBu
cmVhZCA9IDM7CisJfQogICAgICAgYnJlYWs7Ci0gICAgZWxzZQotICAgICAg
ewotCWJ1Zltjb3BpZWRfY2hhcnMrK10gPSAodW5zaWduZWQgY2hhcikoY2gg
JiAweGZmKTsKLQlidWZsZW4tLTsKLSAgICAgIH0KLSN1bmRlZiBidWYKIAot
ICBidWZsZW4gPSBjb3BpZWRfY2hhcnM7Ci0gIHJldHVybjsKLQotZXJyOgot
ICBfX3NldGVycm5vICgpOwotICBidWZsZW4gPSAoc2l6ZV90KSAtMTsKLSAg
cmV0dXJuOworICAgIGNhc2UgV0lORE9XX0JVRkZFUl9TSVpFX0VWRU5UOgor
ICAgICAgaWYgKHNlbmRfd2luY2hfbWF5YmUgKCkpCisJcmV0dXJuIGlucHV0
X3dpbmNoOworICAgICAgLyogZmFsbCB0aHJvdWdoICovCisgICAgZGVmYXVs
dDoKKyAgICAgIHJldHVybiBpbnB1dF9wcm9jZXNzaW5nOworICAgIH0KIAot
c2lnX2V4aXQ6Ci0gIHNldF9zaWdfZXJybm8gKEVJTlRSKTsKLSAgYnVmbGVu
ID0gKHNpemVfdCkgLTE7CisgIGlmICh0b2FkZCkKKyAgICB7CisgICAgICBz
c2l6ZV90IHJldDsKKyAgICAgIGxpbmVfZWRpdF9zdGF0dXMgcmVzID0gbGlu
ZV9lZGl0ICh0b2FkZCwgbnJlYWQsICp0aSwgJnJldCk7CisgICAgICBpZiAo
cmVzID09IGxpbmVfZWRpdF9zaWduYWxsZWQpCisJcmV0dXJuIGlucHV0X3Np
Z25hbGxlZDsKKyAgICAgIGVsc2UgaWYgKHJlcyA9PSBsaW5lX2VkaXRfaW5w
dXRfZG9uZSkKKwl7CisJICBpbnB1dF9yZWFkeSA9IHRydWU7CisJICByZXR1
cm4gaW5wdXRfb2s7CisJfQorICAgIH0KKyAgcmV0dXJuIGlucHV0X3Byb2Nl
c3Npbmc7CiB9CiAKIHZvaWQKQEAgLTExNzUsNyArMTIwMSw3IEBAIGZoYW5k
bGVyX2NvbnNvbGU6OnRjZ2V0YXR0ciAoc3RydWN0IHRlcm1pb3MgKnQpCiB9
CiAKIGZoYW5kbGVyX2NvbnNvbGU6OmZoYW5kbGVyX2NvbnNvbGUgKGZoX2Rl
dmljZXMgdW5pdCkgOgotICBmaGFuZGxlcl90ZXJtaW9zICgpCisgIGZoYW5k
bGVyX3Rlcm1pb3MgKCksIGlucHV0X3JlYWR5IChmYWxzZSkKIHsKICAgaWYg
KHVuaXQgPiAwKQogICAgIGRldiAoKS5wYXJzZSAodW5pdCk7CkBAIC0yMDk1
LDYgKzIxMjEsOSBAQCBmaGFuZGxlcl9jb25zb2xlOjpjaGFyX2NvbW1hbmQg
KGNoYXIgYykKICAgICAgIGNvbi5jb25zX3JhcG9pID0gTlVMTDsKICAgICAg
IHN0cmNweSAoY29uLmNvbnNfcmFidWYsIGJ1Zik7CiAgICAgICBjb24uY29u
c19yYXBvaSA9IGNvbi5jb25zX3JhYnVmOworICAgICAgLyogV2FrZSB1cCBy
ZWFkKCkgb3Igc2VsZWN0KCkgYnkgc2VuZGluZyBhIG1lc3NhZ2UKKwkgd2hp
Y2ggaGFzIG5vIGVmZmVjdCAqLworICAgICAgUG9zdE1lc3NhZ2VXIChHZXRD
b25zb2xlV2luZG93ICgpLCBXTV9TRVRGT0NVUywgMCwgMCk7CiAgICAgICBi
cmVhazsKICAgICBjYXNlICduJzoKICAgICAgIHN3aXRjaCAoY29uLmFyZ3Nb
MF0pCkBAIC0yMTA3LDYgKzIxMzYsOSBAQCBmaGFuZGxlcl9jb25zb2xlOjpj
aGFyX2NvbW1hbmQgKGNoYXIgYykKIAkgIGNvbi5jb25zX3JhcG9pID0gTlVM
TDsKIAkgIHN0cmNweSAoY29uLmNvbnNfcmFidWYsIGJ1Zik7CiAJICBjb24u
Y29uc19yYXBvaSA9IGNvbi5jb25zX3JhYnVmOworCSAgLyogV2FrZSB1cCBy
ZWFkKCkgb3Igc2VsZWN0KCkgYnkgc2VuZGluZyBhIG1lc3NhZ2UKKwkgICAg
IHdoaWNoIGhhcyBubyBlZmZlY3QgKi8KKwkgIFBvc3RNZXNzYWdlVyAoR2V0
Q29uc29sZVdpbmRvdyAoKSwgV01fU0VURk9DVVMsIDAsIDApOwogCSAgYnJl
YWs7CiAJZGVmYXVsdDoKIAkgIGdvdG8gYmFkX2VzY2FwZTsKZGlmZiAtLWdp
dCBhL3dpbnN1cC9jeWd3aW4vc2VsZWN0LmNjIGIvd2luc3VwL2N5Z3dpbi9z
ZWxlY3QuY2MKaW5kZXggMjhhZGNmM2U3Li43OTBmMTU3OTEgMTAwNjQ0Ci0t
LSBhL3dpbnN1cC9jeWd3aW4vc2VsZWN0LmNjCisrKyBiL3dpbnN1cC9jeWd3
aW4vc2VsZWN0LmNjCkBAIC0yMDIsNyArMjAyLDkgQEAgc2VsZWN0IChpbnQg
bWF4ZmRzLCBmZF9zZXQgKnJlYWRmZHMsIGZkX3NldCAqd3JpdGVmZHMsIGZk
X3NldCAqZXhjZXB0ZmRzLAogCSAgICAgcmlnaHQgdmFsdWUgPj0gMCwgbWF0
Y2hpbmcgdGhlIG51bWJlciBvZiBiaXRzIHNldCBpbiB0aGUKIAkgICAgIGZk
cyByZWNvcmRzLiAgaWYgcmV0IGlzIDAsIGNvbnRpbnVlIHRvIGxvb3AuICov
CiAJICByZXQgPSBzZWwucG9sbCAocmVhZGZkcywgd3JpdGVmZHMsIGV4Y2Vw
dGZkcyk7Ci0JICBpZiAoIXJldCkKKwkgIGlmIChyZXQgPCAwKQorCSAgICB3
YWl0X3N0YXRlID0gc2VsZWN0X3N0dWZmOjpzZWxlY3Rfc2lnbmFsbGVkOwor
CSAgZWxzZSBpZiAoIXJldCkKIAkgICAgd2FpdF9zdGF0ZSA9IHNlbGVjdF9z
dHVmZjo6c2VsZWN0X3NldF96ZXJvOwogCX0KICAgICAgIC8qIEFsd2F5cyBj
bGVhbiB1cCBldmVyeXRoaW5nIGhlcmUuICBJZiB3ZSdyZSBsb29waW5nIHRo
ZW4gYnVpbGQgaXQKQEAgLTQ3OSw2ICs0ODEsNyBAQCB3YXNfdGltZW91dDoK
IAkgZXZlbnRzIGxpa2UgbW91c2UgbW92ZW1lbnRzLiAgVGhlIHZlcmlmeSBm
dW5jdGlvbiB3aWxsIGRldGVjdCB0aGVzZQogCSBzaXR1YXRpb25zLiAgSWYg
aXQgcmV0dXJucyBmYWxzZSwgdGhlbiB0aGlzIHdha2V1cCB3YXMgYSBmYWxz
ZSBhbGFybQogCSBhbmQgd2Ugc2hvdWxkIGdvIGJhY2sgdG8gd2FpdGluZy4g
Ki8KKyAgICAgIGludCByZXQgPSAwOwogICAgICAgd2hpbGUgKChzID0gcy0+
bmV4dCkpCiAJaWYgKHMtPnNhd19lcnJvciAoKSkKIAkgIHsKQEAgLTQ4OCw4
ICs0OTEsMTMgQEAgd2FzX3RpbWVvdXQ6CiAJICB9CiAJZWxzZSBpZiAoKCgo
d2FpdF9yZXQgPj0gbSAmJiBzLT53aW5kb3dzX2hhbmRsZSkKIAkgICAgICAg
ICAgIHx8IHMtPmggPT0gdzRbd2FpdF9yZXRdKSkKLQkJICYmIHMtPnZlcmlm
eSAocywgcmVhZGZkcywgd3JpdGVmZHMsIGV4Y2VwdGZkcykpCisJCSAmJiAo
cmV0ID0gcy0+dmVyaWZ5IChzLCByZWFkZmRzLCB3cml0ZWZkcywgZXhjZXB0
ZmRzKSkgPiAwKQogCSAgcmVzID0gc2VsZWN0X29rOworCWVsc2UgaWYgKHJl
dCA8IDApCisJICB7CisJICAgIHJlcyA9IHNlbGVjdF9zaWduYWxsZWQ7CisJ
ICAgIGdvdG8gb3V0OworCSAgfQogCiAgICAgICBzZWxlY3RfcHJpbnRmICgi
cmVzIGFmdGVyIHZlcmlmeSAlZCIsIHJlcyk7CiAgICAgICBicmVhazsKQEAg
LTUzOSw4ICs1NDcsMTIgQEAgc2VsZWN0X3N0dWZmOjpwb2xsIChmZF9zZXQg
KnJlYWRmZHMsIGZkX3NldCAqd3JpdGVmZHMsIGZkX3NldCAqZXhjZXB0ZmRz
KQogICBpbnQgbiA9IDA7CiAgIHNlbGVjdF9yZWNvcmQgKnMgPSAmc3RhcnQ7
CiAgIHdoaWxlICgocyA9IHMtPm5leHQpKQotICAgIG4gKz0gKCFzLT5wZWVr
IHx8IHMtPnBlZWsgKHMsIHRydWUpKSA/Ci0JIHNldF9iaXRzIChzLCByZWFk
ZmRzLCB3cml0ZWZkcywgZXhjZXB0ZmRzKSA6IDA7CisgICAgeworICAgICAg
aW50IHJldCA9IHMtPnBlZWsgPyBzLT5wZWVrIChzLCB0cnVlKSA6IDE7Cisg
ICAgICBpZiAocmV0IDwgMCkKKwlyZXR1cm4gLTE7CisgICAgICBuICs9IChy
ZXQgPiAwKSA/ICBzZXRfYml0cyAocywgcmVhZGZkcywgd3JpdGVmZHMsIGV4
Y2VwdGZkcykgOiAwOworICAgIH0KICAgcmV0dXJuIG47CiB9CiAKQEAgLTEw
MTAsMTYgKzEwMjIsMTAgQEAgcGVla19jb25zb2xlIChzZWxlY3RfcmVjb3Jk
ICptZSwgYm9vbCkKICAgICByZXR1cm4gbWUtPndyaXRlX3JlYWR5OwogCiAg
IGlmIChmaC0+Z2V0X2NvbnNfcmVhZGFoZWFkX3ZhbGlkICgpKQotICAgIHsK
LSAgICAgIHNlbGVjdF9wcmludGYgKCJjb25zX3JlYWRhaGVhZCIpOwotICAg
ICAgcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsKLSAgICB9CisgICAg
cmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsKIAotICBpZiAoZmgtPmdl
dF9yZWFkYWhlYWRfdmFsaWQgKCkpCi0gICAgewotICAgICAgc2VsZWN0X3By
aW50ZiAoInJlYWRhaGVhZCIpOwotICAgICAgcmV0dXJuIG1lLT5yZWFkX3Jl
YWR5ID0gdHJ1ZTsKLSAgICB9CisgIGlmIChmaC0+aW5wdXRfcmVhZHkpCisg
ICAgcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsKIAogICBpZiAobWUt
PnJlYWRfcmVhZHkpCiAgICAgewpAQCAtMTAzMCw1NCArMTAzNiwyMCBAQCBw
ZWVrX2NvbnNvbGUgKHNlbGVjdF9yZWNvcmQgKm1lLCBib29sKQogICBJTlBV
VF9SRUNPUkQgaXJlYzsKICAgRFdPUkQgZXZlbnRzX3JlYWQ7CiAgIEhBTkRM
RSBoOwotICBjaGFyIHRtcGJ1ZlsxN107CiAgIHNldF9oYW5kbGVfb3JfcmV0
dXJuX2lmX25vdF9vcGVuIChoLCBtZSk7CiAKLSAgZm9yICg7OykKKyAgd2hp
bGUgKCFmaC0+aW5wdXRfcmVhZHkgJiYgIWZoLT5nZXRfY29uc19yZWFkYWhl
YWRfdmFsaWQgKCkpCiAgICAgaWYgKGZoLT5iZ19jaGVjayAoU0lHVFRJTiwg
dHJ1ZSkgPD0gYmdfZW9mKQogICAgICAgcmV0dXJuIG1lLT5yZWFkX3JlYWR5
ID0gdHJ1ZTsKICAgICBlbHNlIGlmICghUGVla0NvbnNvbGVJbnB1dFcgKGgs
ICZpcmVjLCAxLCAmZXZlbnRzX3JlYWQpIHx8ICFldmVudHNfcmVhZCkKICAg
ICAgIGJyZWFrOwotICAgIGVsc2UKKyAgICBlbHNlIGlmIChmaGFuZGxlcl9j
b25zb2xlOjppbnB1dF93aW5jaCA9PSBmaC0+cHJvY2Vzc19pbnB1dF9tZXNz
YWdlICgpKQogICAgICAgewotCWZoLT5zZW5kX3dpbmNoX21heWJlICgpOwot
CWlmIChpcmVjLkV2ZW50VHlwZSA9PSBLRVlfRVZFTlQpCi0JICB7Ci0JICAg
IGlmIChpcmVjLkV2ZW50LktleUV2ZW50LmJLZXlEb3duKQotCSAgICAgIHsK
LQkJLyogSWdub3JlIEFsdCtOdW1wYWQga2V5cy4gVGhleSBhcmUgZXZlbnR1
YWxseSBoYW5kbGVkIGluIHRoZQotCQkgICBrZXktdXAgY2FzZSBiZWxvdy4g
Ki8KLQkJaWYgKGlzX2FsdF9udW1wYWRfa2V5ICgmaXJlYykpCi0JCSAgIDsK
LQkJLyogSGFuZGxlIG5vcm1hbCBpbnB1dC4gKi8KLQkJZWxzZSBpZiAoaXJl
Yy5FdmVudC5LZXlFdmVudC51Q2hhci5Vbmljb2RlQ2hhcgotCQkJIHx8IGZo
YW5kbGVyX2NvbnNvbGU6OmdldF9ub25hc2NpaV9rZXkgKGlyZWMsIHRtcGJ1
ZikpCi0JCSAgcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsKLQkJLyog
QWxsb3cgQ3RybC1TcGFjZSBmb3IgXkAgKi8KLQkJZWxzZSBpZiAoIChpcmVj
LkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSA9PSBWS19TUEFDRQot
CQkJICAgfHwgaXJlYy5FdmVudC5LZXlFdmVudC53VmlydHVhbEtleUNvZGUg
PT0gJzInKQotCQkJICYmIChpcmVjLkV2ZW50LktleUV2ZW50LmR3Q29udHJv
bEtleVN0YXRlICYKLQkJCSAgICAgKExFRlRfQ1RSTF9QUkVTU0VEIHwgUklH
SFRfQ1RSTF9QUkVTU0VEKSkKLQkJCSAmJiAhKGlyZWMuRXZlbnQuS2V5RXZl
bnQuZHdDb250cm9sS2V5U3RhdGUKLQkJCSAgICAgICYgKExFRlRfQUxUX1BS
RVNTRUQgfCBSSUdIVF9BTFRfUFJFU1NFRCkpICkKLQkJICByZXR1cm4gbWUt
PnJlYWRfcmVhZHkgPSB0cnVlOwotCSAgICAgIH0KLQkgICAgLyogSWdub3Jl
IGtleSB1cCBldmVudHMsIGV4Y2VwdCBmb3IgQWx0K051bXBhZCBldmVudHMu
ICovCi0JICAgIGVsc2UgaWYgKGlzX2FsdF9udW1wYWRfZXZlbnQgKCZpcmVj
KSkKLQkgICAgICByZXR1cm4gbWUtPnJlYWRfcmVhZHkgPSB0cnVlOwotCSAg
fQotCWVsc2UKLQkgIHsKLQkgICAgaWYgKGlyZWMuRXZlbnRUeXBlID09IE1P
VVNFX0VWRU5UCi0JCSYmIGZoLT5tb3VzZV9hd2FyZSAoaXJlYy5FdmVudC5N
b3VzZUV2ZW50KSkKLQkJcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsK
LQkgICAgaWYgKGlyZWMuRXZlbnRUeXBlID09IEZPQ1VTX0VWRU5UICYmIGZo
LT5mb2N1c19hd2FyZSAoKSkKLQkJcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0g
dHJ1ZTsKLQkgIH0KLQotCS8qIFJlYWQgYW5kIGRpc2NhcmQgdGhlIGV2ZW50
ICovCi0JUmVhZENvbnNvbGVJbnB1dFcgKGgsICZpcmVjLCAxLCAmZXZlbnRz
X3JlYWQpOworCXNldF9zaWdfZXJybm8gKEVJTlRSKTsKKwlyZXR1cm4gLTE7
CiAgICAgICB9CisgIGlmIChmaC0+aW5wdXRfcmVhZHkgfHwgZmgtPmdldF9j
b25zX3JlYWRhaGVhZF92YWxpZCAoKSkKKyAgICByZXR1cm4gbWUtPnJlYWRf
cmVhZHkgPSB0cnVlOwogCiAgIHJldHVybiBtZS0+d3JpdGVfcmVhZHk7CiB9
CkBAIC0xMDg5LDcgKzEwNjEsNiBAQCB2ZXJpZnlfY29uc29sZSAoc2VsZWN0
X3JlY29yZCAqbWUsIGZkX3NldCAqcmZkcywgZmRfc2V0ICp3ZmRzLAogICBy
ZXR1cm4gcGVla19jb25zb2xlIChtZSwgdHJ1ZSk7CiB9CiAKLQogc2VsZWN0
X3JlY29yZCAqCiBmaGFuZGxlcl9jb25zb2xlOjpzZWxlY3RfcmVhZCAoc2Vs
ZWN0X3N0dWZmICpzcykKIHsKQEAgLTExMDQsNyArMTA3NSw3IEBAIGZoYW5k
bGVyX2NvbnNvbGU6OnNlbGVjdF9yZWFkIChzZWxlY3Rfc3R1ZmYgKnNzKQog
ICBzLT5wZWVrID0gcGVla19jb25zb2xlOwogICBzLT5oID0gZ2V0X2hhbmRs
ZSAoKTsKICAgcy0+cmVhZF9zZWxlY3RlZCA9IHRydWU7Ci0gIHMtPnJlYWRf
cmVhZHkgPSBnZXRfcmVhZGFoZWFkX3ZhbGlkICgpOworICBzLT5yZWFkX3Jl
YWR5ID0gaW5wdXRfcmVhZHkgfHwgZ2V0X2NvbnNfcmVhZGFoZWFkX3ZhbGlk
ICgpOwogICByZXR1cm4gczsKIH0KIAotLSAKMi4xNy4wCgo=

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: application/octet-stream;
 name="0003-Cygwin-console-Make-I-O-functions-thread-safe.patch"
Content-Disposition: attachment;
 filename="0003-Cygwin-console-Make-I-O-functions-thread-safe.patch"
Content-Transfer-Encoding: base64
Content-length: 17857

RnJvbSBmYWUzM2QyYTQwNDVkYjA4MWVmYzI4ODllNjRhYzFiYmU3YWM1Mzcx
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBUYWthc2hpIFlhbm8g
PHRha2FzaGkueWFub0BuaWZ0eS5uZS5qcD4KRGF0ZTogU3VuLCAzMSBNYXIg
MjAxOSAxMzo0OTo1MSArMDkwMApTdWJqZWN0OiBbUEFUQ0ggMy8zXSBDeWd3
aW46IGNvbnNvbGU6IE1ha2UgSS9PIGZ1bmN0aW9ucyB0aHJlYWQtc2FmZQoK
LSBQT1NJWCBzdGF0ZXMgSS9PIGZ1bmN0aW9ucyBzaGFsbCBiZSB0aHJlYWQt
c2FmZSwgaG93ZXZlciwgY3lnd2luCiAgY29uc29sZSBJL08gZnVuY3Rpb25z
IHdlcmUgbm90LiBUaGlzIHBhdGNoIG1ha2VzIGNvbnNvbGUgSS9PCiAgZnVu
Y3Rpb25zIHRocmVhZC1zYWZlLgotLS0KIHdpbnN1cC9jeWd3aW4vZmhhbmRs
ZXIuaCAgICAgICAgICB8ICAxOCArKystCiB3aW5zdXAvY3lnd2luL2ZoYW5k
bGVyX2NvbnNvbGUuY2MgfCAxMzYgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKystCiB3aW5zdXAvY3lnd2luL3NlbGVjdC5jYyAgICAgICAgICAgfCAg
MjMgKysrLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTY1IGluc2VydGlvbnMoKyks
IDEyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4v
ZmhhbmRsZXIuaCBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaAppbmRleCBm
ODhiMDUwMDkuLjA0Nzc4ODhkNyAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dp
bi9maGFuZGxlci5oCisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaApA
QCAtMTY5OCw2ICsxNjk4LDEyIEBAIGNsYXNzIGZoYW5kbGVyX3NlcmlhbDog
cHVibGljIGZoYW5kbGVyX2Jhc2UKICAgfQogfTsKIAorI2RlZmluZSBhY3F1
aXJlX2lucHV0X211dGV4KG1zKSBcCisgIF9fYWNxdWlyZV9pbnB1dF9tdXRl
eCAoX19QUkVUVFlfRlVOQ1RJT05fXywgX19MSU5FX18sIG1zKQorCisjZGVm
aW5lIHJlbGVhc2VfaW5wdXRfbXV0ZXgoKSBcCisgIF9fcmVsZWFzZV9pbnB1
dF9tdXRleCAoX19QUkVUVFlfRlVOQ1RJT05fXywgX19MSU5FX18pCisKICNk
ZWZpbmUgYWNxdWlyZV9vdXRwdXRfbXV0ZXgobXMpIFwKICAgX19hY3F1aXJl
X291dHB1dF9tdXRleCAoX19QUkVUVFlfRlVOQ1RJT05fXywgX19MSU5FX18s
IG1zKQogCkBAIC0xODk4LDYgKzE5MDQsNyBAQCBwcml2YXRlOgogICBzdGF0
aWMgY29uc3QgdW5zaWduZWQgTUFYX1dSSVRFX0NIQVJTOwogICBzdGF0aWMg
Y29uc29sZV9zdGF0ZSAqc2hhcmVkX2NvbnNvbGVfaW5mbzsKICAgc3RhdGlj
IGJvb2wgaW52aXNpYmxlX2NvbnNvbGU7CisgIEhBTkRMRSBpbnB1dF9tdXRl
eCwgb3V0cHV0X211dGV4OwogCiAgIC8qIFVzZWQgd2hlbiB3ZSBlbmNvdW50
ZXIgYSB0cnVuY2F0ZWQgbXVsdGktYnl0ZSBzZXF1ZW5jZS4gIFRoZQogICAg
ICBsZWFkIGJ5dGVzIGFyZSBzdG9yZWQgaGVyZSBhbmQgcmV2aXNpdGVkIGlu
IHRoZSBuZXh0IHdyaXRlIGNhbGwuICovCkBAIC0xOTY3LDggKzE5NzQsMTEg
QEAgcHJpdmF0ZToKICAgYm9vbCBmb2N1c19hd2FyZSAoKSB7cmV0dXJuIHNo
YXJlZF9jb25zb2xlX2luZm8tPmNvbi51c2VfZm9jdXM7fQogICBib29sIGdl
dF9jb25zX3JlYWRhaGVhZF92YWxpZCAoKQogICB7Ci0gICAgcmV0dXJuIHNo
YXJlZF9jb25zb2xlX2luZm8tPmNvbi5jb25zX3JhcG9pICE9IE5VTEwgJiYK
KyAgICBhY3F1aXJlX2lucHV0X211dGV4IChJTkZJTklURSk7CisgICAgYm9v
bCByZXQgPSBzaGFyZWRfY29uc29sZV9pbmZvLT5jb24uY29uc19yYXBvaSAh
PSBOVUxMICYmCiAgICAgICAqc2hhcmVkX2NvbnNvbGVfaW5mby0+Y29uLmNv
bnNfcmFwb2k7CisgICAgcmVsZWFzZV9pbnB1dF9tdXRleCAoKTsKKyAgICBy
ZXR1cm4gcmV0OwogICB9CiAKICAgc2VsZWN0X3JlY29yZCAqc2VsZWN0X3Jl
YWQgKHNlbGVjdF9zdHVmZiAqKTsKQEAgLTIwMDQsNiArMjAxNCwxMiBAQCBw
cml2YXRlOgogICB9CiAKICAgaW5wdXRfc3RhdGVzIHByb2Nlc3NfaW5wdXRf
bWVzc2FnZSAoKTsKKyAgdm9pZCBzZXR1cF9pb19tdXRleCAodm9pZCk7Cisg
IERXT1JEIF9fYWNxdWlyZV9pbnB1dF9tdXRleCAoY29uc3QgY2hhciAqZm4s
IGludCBsbiwgRFdPUkQgbXMpOworICB2b2lkIF9fcmVsZWFzZV9pbnB1dF9t
dXRleCAoY29uc3QgY2hhciAqZm4sIGludCBsbik7CisgIERXT1JEIF9fYWNx
dWlyZV9vdXRwdXRfbXV0ZXggKGNvbnN0IGNoYXIgKmZuLCBpbnQgbG4sIERX
T1JEIG1zKTsKKyAgdm9pZCBfX3JlbGVhc2Vfb3V0cHV0X211dGV4IChjb25z
dCBjaGFyICpmbiwgaW50IGxuKTsKKwogICBmcmllbmQgdHR5X21pbiAqIHR0
eV9saXN0OjpnZXRfY3R0eXAgKCk7CiB9OwogCmRpZmYgLS1naXQgYS93aW5z
dXAvY3lnd2luL2ZoYW5kbGVyX2NvbnNvbGUuY2MgYi93aW5zdXAvY3lnd2lu
L2ZoYW5kbGVyX2NvbnNvbGUuY2MKaW5kZXggNzMwMTUyNDZhLi43NTc1ZmU1
ODIgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfY29uc29s
ZS5jYworKysgYi93aW5zdXAvY3lnd2luL2ZoYW5kbGVyX2NvbnNvbGUuY2MK
QEAgLTIzNyw2ICsyMzcsNDUgQEAgdHR5X2xpc3Q6OmdldF9jdHR5cCAoKQog
ICAgIHJldHVybiBOVUxMOwogfQogCit2b2lkCitmaGFuZGxlcl9jb25zb2xl
OjpzZXR1cF9pb19tdXRleCAodm9pZCkKK3sKKyAgY2hhciBidWZbTUFYX1BB
VEhdOworICBEV09SRCByZXM7CisKKyAgcmVzID0gV0FJVF9GQUlMRUQ7Cisg
IGlmICghaW5wdXRfbXV0ZXggfHwgV0FJVF9GQUlMRUQgPT0gKHJlcyA9IGFj
cXVpcmVfaW5wdXRfbXV0ZXggKDApKSkKKyAgICB7CisgICAgICBzaGFyZWRf
bmFtZSAoYnVmLCAiY3lnY29ucy5pbnB1dC5tdXRleCIsIGdldF9taW5vciAo
KSk7CisgICAgICBpbnB1dF9tdXRleCA9IE9wZW5NdXRleCAoTUFYSU1VTV9B
TExPV0VELCBUUlVFLCBidWYpOworICAgICAgaWYgKCFpbnB1dF9tdXRleCkK
KwlpbnB1dF9tdXRleCA9IENyZWF0ZU11dGV4ICgmc2VjX25vbmUsIEZBTFNF
LCBidWYpOworICAgICAgaWYgKCFpbnB1dF9tdXRleCkKKwl7CisJICBfX3Nl
dGVycm5vICgpOworCSAgcmV0dXJuOworCX0KKyAgICB9CisgIGlmIChyZXMg
PT0gV0FJVF9PQkpFQ1RfMCkKKyAgICByZWxlYXNlX2lucHV0X211dGV4ICgp
OworCisgIHJlcyA9IFdBSVRfRkFJTEVEOworICBpZiAoIW91dHB1dF9tdXRl
eCB8fCBXQUlUX0ZBSUxFRCA9PSAocmVzID0gYWNxdWlyZV9vdXRwdXRfbXV0
ZXggKDApKSkKKyAgICB7CisgICAgICBzaGFyZWRfbmFtZSAoYnVmLCAiY3ln
Y29ucy5vdXRwdXQubXV0ZXgiLCBnZXRfbWlub3IgKCkpOworICAgICAgb3V0
cHV0X211dGV4ID0gT3Blbk11dGV4IChNQVhJTVVNX0FMTE9XRUQsIFRSVUUs
IGJ1Zik7CisgICAgICBpZiAoIW91dHB1dF9tdXRleCkKKwlvdXRwdXRfbXV0
ZXggPSBDcmVhdGVNdXRleCAoJnNlY19ub25lLCBGQUxTRSwgYnVmKTsKKyAg
ICAgIGlmICghb3V0cHV0X211dGV4KQorCXsKKwkgIF9fc2V0ZXJybm8gKCk7
CisJICByZXR1cm47CisJfQorICAgIH0KKyAgaWYgKHJlcyA9PSBXQUlUX09C
SkVDVF8wKQorICAgIHJlbGVhc2Vfb3V0cHV0X211dGV4ICgpOworfQorCiBp
bmxpbmUgRFdPUkQKIGRldl9jb25zb2xlOjpjb25fdG9fc3RyIChjaGFyICpk
LCBpbnQgZGxlbiwgV0NIQVIgdykKIHsKQEAgLTM2NSw3ICs0MDQsOSBAQCBm
aGFuZGxlcl9jb25zb2xlOjpyZWFkICh2b2lkICpwdiwgc2l6ZV90JiBidWZs
ZW4pCiAjZGVmaW5lIGJ1ZiAoKGNoYXIgKikgcHYpCiAKICAgICAgIGludCBy
ZXQ7CisgICAgICBhY3F1aXJlX2lucHV0X211dGV4IChJTkZJTklURSk7CiAg
ICAgICByZXQgPSBwcm9jZXNzX2lucHV0X21lc3NhZ2UgKCk7CisgICAgICBy
ZWxlYXNlX2lucHV0X211dGV4ICgpOwogICAgICAgc3dpdGNoIChyZXQpCiAJ
ewogCWNhc2UgaW5wdXRfZXJyb3I6CkBAIC0zODUsNiArNDI2LDcgQEAgZmhh
bmRsZXJfY29uc29sZTo6cmVhZCAodm9pZCAqcHYsIHNpemVfdCYgYnVmbGVu
KQogICAgIH0KIAogICAvKiBDaGVjayBjb25zb2xlIHJlYWQtYWhlYWQgYnVm
ZmVyIGZpbGxlZCBmcm9tIHRlcm1pbmFsIHJlcXVlc3RzICovCisgIGFjcXVp
cmVfaW5wdXRfbXV0ZXggKElORklOSVRFKTsKICAgd2hpbGUgKGNvbi5jb25z
X3JhcG9pICYmICpjb24uY29uc19yYXBvaSAmJiBidWZsZW4pCiAgICAgewog
ICAgICAgYnVmW2NvcGllZF9jaGFycysrXSA9ICpjb24uY29uc19yYXBvaSsr
OwpAQCAtMzk2LDYgKzQzOCw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6OnJlYWQg
KHZvaWQgKnB2LCBzaXplX3QmIGJ1ZmxlbikKIAogICBpZiAoIXJhbGVuKQog
ICAgIGlucHV0X3JlYWR5ID0gZmFsc2U7CisgIHJlbGVhc2VfaW5wdXRfbXV0
ZXggKCk7CiAKICN1bmRlZiBidWYKIApAQCAtODk3LDYgKzk0MCw4IEBAIGZo
YW5kbGVyX2NvbnNvbGU6Om9wZW4gKGludCBmbGFncywgbW9kZV90KQogICAg
IH0KICAgc2V0X291dHB1dF9oYW5kbGUgKGgpOwogCisgIHNldHVwX2lvX211
dGV4ICgpOworCiAgIGlmIChjb24uZmlsbGluIChnZXRfb3V0cHV0X2hhbmRs
ZSAoKSkpCiAgICAgewogICAgICAgY29uLmN1cnJlbnRfd2luMzJfYXR0ciA9
IGNvbi5iLndBdHRyaWJ1dGVzOwpAQCAtOTQ2LDYgKzk5MSwxMSBAQCBmaGFu
ZGxlcl9jb25zb2xlOjpjbG9zZSAoKQogewogICBkZWJ1Z19wcmludGYgKCJj
bG9zaW5nOiAlcCwgJXAiLCBnZXRfaGFuZGxlICgpLCBnZXRfb3V0cHV0X2hh
bmRsZSAoKSk7CiAKKyAgQ2xvc2VIYW5kbGUgKGlucHV0X211dGV4KTsKKyAg
aW5wdXRfbXV0ZXggPSBOVUxMOworICBDbG9zZUhhbmRsZSAob3V0cHV0X211
dGV4KTsKKyAgb3V0cHV0X211dGV4ID0gTlVMTDsKKwogICBpZiAoc2hhcmVk
X2NvbnNvbGVfaW5mbyAmJiBnZXRwaWQgKCkgPT0gY29uLm93bmVyICYmIGNv
bi5jYXAyNGJpdF9jb2xvcikKICAgICB7CiAgICAgICBEV09SRCBkd01vZGU7
CkBAIC05NzIsNiArMTAyMiw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6OmlvY3Rs
ICh1bnNpZ25lZCBpbnQgY21kLCB2b2lkICphcmcpCiAgIGludCByZXMgPSBm
aGFuZGxlcl90ZXJtaW9zOjppb2N0bCAoY21kLCBhcmcpOwogICBpZiAocmVz
IDw9IDApCiAgICAgcmV0dXJuIHJlczsKKyAgYWNxdWlyZV9vdXRwdXRfbXV0
ZXggKElORklOSVRFKTsKICAgc3dpdGNoIChjbWQpCiAgICAgewogICAgICAg
Y2FzZSBUSU9DR1dJTlNaOgpAQCAtOTg3LDIwICsxMDM4LDI1IEBAIGZoYW5k
bGVyX2NvbnNvbGU6OmlvY3RsICh1bnNpZ25lZCBpbnQgY21kLCB2b2lkICph
cmcpCiAJICAgIHN5c2NhbGxfcHJpbnRmICgiV0lOU1o6IChyb3c9JWQsY29s
PSVkKSIsCiAJCQkgICAoKHN0cnVjdCB3aW5zaXplICopIGFyZyktPndzX3Jv
dywKIAkJCSAgICgoc3RydWN0IHdpbnNpemUgKikgYXJnKS0+d3NfY29sKTsK
KwkgICAgcmVsZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAJICAgIHJldHVybiAw
OwogCSAgfQogCWVsc2UKIAkgIHsKIAkgICAgc3lzY2FsbF9wcmludGYgKCJX
SU5TWiBmYWlsZWQiKTsKIAkgICAgX19zZXRlcnJubyAoKTsKKwkgICAgcmVs
ZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAJICAgIHJldHVybiAtMTsKIAkgIH0K
KwlyZWxlYXNlX291dHB1dF9tdXRleCAoKTsKIAlyZXR1cm4gMDsKICAgICAg
IGNhc2UgVElPQ1NXSU5TWjoKIAliZ19jaGVjayAoU0lHVFRPVSk7CisJcmVs
ZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAJcmV0dXJuIDA7CiAgICAgICBjYXNl
IEtER0tCTUVUQToKIAkqKGludCAqKSBhcmcgPSAoY29uLm1ldGFiaXQpID8g
S19NRVRBQklUIDogS19FU0NQUkVGSVg7CisJcmVsZWFzZV9vdXRwdXRfbXV0
ZXggKCk7CiAJcmV0dXJuIDA7CiAgICAgICBjYXNlIEtEU0tCTUVUQToKIAlp
ZiAoKGludHB0cl90KSBhcmcgPT0gS19NRVRBQklUKQpAQCAtMTAxMCwxNiAr
MTA2NiwyMCBAQCBmaGFuZGxlcl9jb25zb2xlOjppb2N0bCAodW5zaWduZWQg
aW50IGNtZCwgdm9pZCAqYXJnKQogCWVsc2UKIAkgIHsKIAkgICAgc2V0X2Vy
cm5vIChFSU5WQUwpOworCSAgICByZWxlYXNlX291dHB1dF9tdXRleCAoKTsK
IAkgICAgcmV0dXJuIC0xOwogCSAgfQorCXJlbGVhc2Vfb3V0cHV0X211dGV4
ICgpOwogCXJldHVybiAwOwogICAgICAgY2FzZSBUSU9DTElOVVg6CiAJaWYg
KCoodW5zaWduZWQgY2hhciAqKSBhcmcgPT0gNikKIAkgIHsKIAkgICAgKih1
bnNpZ25lZCBjaGFyICopIGFyZyA9ICh1bnNpZ25lZCBjaGFyKSBjb24ubk1v
ZGlmaWVyczsKKwkgICAgcmVsZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAJICAg
IHJldHVybiAwOwogCSAgfQogCXNldF9lcnJubyAoRUlOVkFMKTsKKwlyZWxl
YXNlX291dHB1dF9tdXRleCAoKTsKIAlyZXR1cm4gLTE7CiAgICAgICBjYXNl
IEZJT05SRUFEOgogCXsKQEAgLTEwMzIsMTcgKzEwOTIsMjAgQEAgZmhhbmRs
ZXJfY29uc29sZTo6aW9jdGwgKHVuc2lnbmVkIGludCBjbWQsIHZvaWQgKmFy
ZykKIAkgIGlmICghUGVla0NvbnNvbGVJbnB1dFcgKGdldF9oYW5kbGUgKCks
IGlucCwgSU5SRUNfU0laRSwgJm4pKQogCSAgICB7CiAJICAgICAgc2V0X2Vy
cm5vIChFSU5WQUwpOworCSAgICAgIHJlbGVhc2Vfb3V0cHV0X211dGV4ICgp
OwogCSAgICAgIHJldHVybiAtMTsKIAkgICAgfQogCSAgd2hpbGUgKG4tLSA+
IDApCiAJICAgIGlmIChpbnBbbl0uRXZlbnRUeXBlID09IEtFWV9FVkVOVCAm
JiBpbnBbbl0uRXZlbnQuS2V5RXZlbnQuYktleURvd24pCiAJICAgICAgKyty
ZXQ7CiAJICAqKGludCAqKSBhcmcgPSByZXQ7CisJICByZWxlYXNlX291dHB1
dF9tdXRleCAoKTsKIAkgIHJldHVybiAwOwogCX0KIAlicmVhazsKICAgICB9
CiAKKyAgcmVsZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAgIHJldHVybiBmaGFu
ZGxlcl9iYXNlOjppb2N0bCAoY21kLCBhcmcpOwogfQogCkBAIC0xMDY3LDYg
KzExMzAsNyBAQCBmaGFuZGxlcl9jb25zb2xlOjpvdXRwdXRfdGNzZXRhdHRy
IChpbnQsIHN0cnVjdCB0ZXJtaW9zIGNvbnN0ICp0KQogewogICAvKiBBbGwg
dGhlIG91dHB1dCBiaXRzIHdlIGNhbiBpZ25vcmUgKi8KIAorICBhY3F1aXJl
X291dHB1dF9tdXRleCAoSU5GSU5JVEUpOwogICBEV09SRCBmbGFncyA9IEVO
QUJMRV9QUk9DRVNTRURfT1VUUFVUIHwgRU5BQkxFX1dSQVBfQVRfRU9MX09V
VFBVVDsKICAgLyogSWYgc3lzdGVtIGhhcyAyNGJpdCBjb2xvciBjYXBhYmls
aXR5LCB1c2UgeHRlcm0gY29tcGF0aWJsZSBtb2RlLiAqLwogICBpZiAoY29u
LmNhcDI0Yml0X2NvbG9yKQpAQCAtMTA3OSw2ICsxMTQzLDcgQEAgZmhhbmRs
ZXJfY29uc29sZTo6b3V0cHV0X3Rjc2V0YXR0ciAoaW50LCBzdHJ1Y3QgdGVy
bWlvcyBjb25zdCAqdCkKICAgaW50IHJlcyA9IFNldENvbnNvbGVNb2RlIChn
ZXRfb3V0cHV0X2hhbmRsZSAoKSwgZmxhZ3MpID8gMCA6IC0xOwogICBpZiAo
cmVzKQogICAgIF9fc2V0ZXJybm9fZnJvbV93aW5fZXJyb3IgKEdldExhc3RF
cnJvciAoKSk7CisgIHJlbGVhc2Vfb3V0cHV0X211dGV4ICgpOwogICBzeXNj
YWxsX3ByaW50ZiAoIiVkID0gdGNzZXRhdHRyKCwlcCkgKEVOQUJMRSBGTEFH
UyAleSkgKGxmbGFnICV5IG9mbGFnICV5KSIsCiAJCSAgcmVzLCB0LCBmbGFn
cywgdC0+Y19sZmxhZywgdC0+Y19vZmxhZyk7CiAgIHJldHVybiByZXM7CkBA
IC0xMDg5LDYgKzExNTQsNyBAQCBmaGFuZGxlcl9jb25zb2xlOjppbnB1dF90
Y3NldGF0dHIgKGludCwgc3RydWN0IHRlcm1pb3MgY29uc3QgKnQpCiB7CiAg
IC8qIElnbm9yZSB0aGUgb3B0aW9uYWxfYWN0aW9ucyBzdHVmZiwgc2luY2Ug
YWxsIG91dHB1dCBpcyBlbWl0dGVkCiAgICAgIGluc3RhbnRseSAqLworICBh
Y3F1aXJlX2lucHV0X211dGV4IChJTkZJTklURSk7CiAKICAgRFdPUkQgb2Zs
YWdzOwogCkBAIC0xMTQ5LDYgKzEyMTUsNyBAQCBmaGFuZGxlcl9jb25zb2xl
OjppbnB1dF90Y3NldGF0dHIgKGludCwgc3RydWN0IHRlcm1pb3MgY29uc3Qg
KnQpCiAgICAgfQogCiAgIGdldF90dHlwICgpLT5yc3Rjb25zIChmYWxzZSk7
CisgIHJlbGVhc2VfaW5wdXRfbXV0ZXggKCk7CiAgIHJldHVybiByZXM7CiB9
CiAKQEAgLTEyMDEsNyArMTI2OCw4IEBAIGZoYW5kbGVyX2NvbnNvbGU6OnRj
Z2V0YXR0ciAoc3RydWN0IHRlcm1pb3MgKnQpCiB9CiAKIGZoYW5kbGVyX2Nv
bnNvbGU6OmZoYW5kbGVyX2NvbnNvbGUgKGZoX2RldmljZXMgdW5pdCkgOgot
ICBmaGFuZGxlcl90ZXJtaW9zICgpLCBpbnB1dF9yZWFkeSAoZmFsc2UpCisg
IGZoYW5kbGVyX3Rlcm1pb3MgKCksIGlucHV0X3JlYWR5IChmYWxzZSksCisg
IGlucHV0X211dGV4IChOVUxMKSwgb3V0cHV0X211dGV4IChOVUxMKQogewog
ICBpZiAodW5pdCA+IDApCiAgICAgZGV2ICgpLnBhcnNlICh1bml0KTsKQEAg
LTIxMTgsOSArMjE4NiwxMSBAQCBmaGFuZGxlcl9jb25zb2xlOjpjaGFyX2Nv
bW1hbmQgKGNoYXIgYykKIAkgZmhhbmRsZXJfY29uc29sZSBvYmplY3QgYXNz
b2NpYXRlZCB3aXRoIHN0YW5kYXJkIGlucHV0LgogCSBTbyBwdXRzX3JlYWRh
aGVhZCBkb2VzIG5vdCB3b3JrLgogCSBVc2UgYSBjb21tb24gY29uc29sZSBy
ZWFkLWFoZWFkIGJ1ZmZlciBpbnN0ZWFkLiAqLworICAgICAgYWNxdWlyZV9p
bnB1dF9tdXRleCAoSU5GSU5JVEUpOwogICAgICAgY29uLmNvbnNfcmFwb2kg
PSBOVUxMOwogICAgICAgc3RyY3B5IChjb24uY29uc19yYWJ1ZiwgYnVmKTsK
ICAgICAgIGNvbi5jb25zX3JhcG9pID0gY29uLmNvbnNfcmFidWY7CisgICAg
ICByZWxlYXNlX2lucHV0X211dGV4ICgpOwogICAgICAgLyogV2FrZSB1cCBy
ZWFkKCkgb3Igc2VsZWN0KCkgYnkgc2VuZGluZyBhIG1lc3NhZ2UKIAkgd2hp
Y2ggaGFzIG5vIGVmZmVjdCAqLwogICAgICAgUG9zdE1lc3NhZ2VXIChHZXRD
b25zb2xlV2luZG93ICgpLCBXTV9TRVRGT0NVUywgMCwgMCk7CkBAIC0yMTMz
LDkgKzIyMDMsMTEgQEAgZmhhbmRsZXJfY29uc29sZTo6Y2hhcl9jb21tYW5k
IChjaGFyIGMpCiAJICB5IC09IGNvbi5iLnNyV2luZG93LlRvcDsKIAkgIC8q
IHggLT0gY29uLmIuc3JXaW5kb3cuTGVmdDsJCS8vIG5vdCBhdmFpbGFibGUg
eWV0ICovCiAJICBfX3NtYWxsX3NwcmludGYgKGJ1ZiwgIlwwMzNbJWQ7JWRS
IiwgeSArIDEsIHggKyAxKTsKKwkgIGFjcXVpcmVfaW5wdXRfbXV0ZXggKElO
RklOSVRFKTsKIAkgIGNvbi5jb25zX3JhcG9pID0gTlVMTDsKIAkgIHN0cmNw
eSAoY29uLmNvbnNfcmFidWYsIGJ1Zik7CiAJICBjb24uY29uc19yYXBvaSA9
IGNvbi5jb25zX3JhYnVmOworCSAgcmVsZWFzZV9pbnB1dF9tdXRleCAoKTsK
IAkgIC8qIFdha2UgdXAgcmVhZCgpIG9yIHNlbGVjdCgpIGJ5IHNlbmRpbmcg
YSBtZXNzYWdlCiAJICAgICB3aGljaCBoYXMgbm8gZWZmZWN0ICovCiAJICBQ
b3N0TWVzc2FnZVcgKEdldENvbnNvbGVXaW5kb3cgKCksIFdNX1NFVEZPQ1VT
LCAwLCAwKTsKQEAgLTI0NzEsNiArMjU0Myw3IEBAIGZoYW5kbGVyX2NvbnNv
bGU6OndyaXRlIChjb25zdCB2b2lkICp2c3JjLCBzaXplX3QgbGVuKQogICAg
IHJldHVybiAoc3NpemVfdCkgYmc7CiAKICAgcHVzaF9wcm9jZXNzX3N0YXRl
IHByb2Nlc3Nfc3RhdGUgKFBJRF9UVFlPVSk7CisgIGFjcXVpcmVfb3V0cHV0
X211dGV4IChJTkZJTklURSk7CiAKICAgLyogUnVuIGFuZCBjaGVjayBmb3Ig
YW5zaSBzZXF1ZW5jZXMgKi8KICAgdW5zaWduZWQgY29uc3QgY2hhciAqc3Jj
ID0gKHVuc2lnbmVkIGNoYXIgKikgdnNyYzsKQEAgLTI0OTEsNyArMjU2NCwx
MCBAQCBmaGFuZGxlcl9jb25zb2xlOjp3cml0ZSAoY29uc3Qgdm9pZCAqdnNy
Yywgc2l6ZV90IGxlbikKIAljYXNlIG5vcm1hbDoKIAkgIHNyYyA9IHdyaXRl
X25vcm1hbCAoc3JjLCBlbmQpOwogCSAgaWYgKCFzcmMpIC8qIHdyaXRlX25v
cm1hbCBmYWlsZWQgKi8KLQkgICAgcmV0dXJuIC0xOworCSAgICB7CisJICAg
ICAgcmVsZWFzZV9vdXRwdXRfbXV0ZXggKCk7CisJICAgICAgcmV0dXJuIC0x
OworCSAgICB9CiAJICBicmVhazsKIAljYXNlIGdvdGVzYzoKIAkgIGlmICgq
c3JjID09ICdbJykJCS8qIENTSSBDb250cm9sIFNlcXVlbmNlIEludHJvZHVj
ZXIgKi8KQEAgLTI2NjAsNiArMjczNiw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6
OndyaXRlIChjb25zdCB2b2lkICp2c3JjLCBzaXplX3QgbGVuKQogCSAgYnJl
YWs7CiAJfQogICAgIH0KKyAgcmVsZWFzZV9vdXRwdXRfbXV0ZXggKCk7CiAK
ICAgc3lzY2FsbF9wcmludGYgKCIlbGQgPSBmaGFuZGxlcl9jb25zb2xlOjp3
cml0ZSguLi4pIiwgbGVuKTsKIApAQCAtMjc4Nyw2ICsyODY0LDcgQEAgdm9p
ZAogZmhhbmRsZXJfY29uc29sZTo6Zml4dXBfYWZ0ZXJfZm9ya19leGVjIChi
b29sIGV4ZWNpbmcpCiB7CiAgIHNldF91bml0ICgpOworICBzZXR1cF9pb19t
dXRleCAoKTsKIH0KIAogLy8gI2RlZmluZSBXSU5TVEFfQUNDRVNTIChXSU5T
VEFfUkVBREFUVFJJQlVURVMgfCBTVEFOREFSRF9SSUdIVFNfUkVBRCB8IFNU
QU5EQVJEX1JJR0hUU19XUklURSB8IFdJTlNUQV9DUkVBVEVERVNLVE9QIHwg
V0lOU1RBX0VYSVRXSU5ET1dTKQpAQCAtMjk2OSwzICszMDQ3LDU3IEBAIGZo
YW5kbGVyX2NvbnNvbGU6Om5lZWRfaW52aXNpYmxlICgpCiAgIGRlYnVnX3By
aW50ZiAoImludmlzaWJsZV9jb25zb2xlICVkIiwgaW52aXNpYmxlX2NvbnNv
bGUpOwogICByZXR1cm4gYjsKIH0KKworRFdPUkQKK2ZoYW5kbGVyX2NvbnNv
bGU6Ol9fYWNxdWlyZV9pbnB1dF9tdXRleCAoY29uc3QgY2hhciAqZm4sIGlu
dCBsbiwgRFdPUkQgbXMpCit7CisjaWZkZWYgREVCVUdHSU5HCisgIHN0cmFj
ZS5wcm50ZiAoX1NUUkFDRV9URVJNSU9TLCBmbiwgIiglZCk6IHRyeWluZyB0
byBnZXQgaW5wdXRfbXV0ZXgiLCBsbik7CisjZW5kaWYKKyAgRFdPUkQgcmVz
ID0gV2FpdEZvclNpbmdsZU9iamVjdCAoaW5wdXRfbXV0ZXgsIG1zKTsKKyAg
aWYgKHJlcyAhPSBXQUlUX09CSkVDVF8wKQorICAgIHN0cmFjZS5wcm50ZiAo
X1NUUkFDRV9URVJNSU9TLCBmbiwKKwkJICAiKCVkKTogRmFpbGVkIHRvIGFj
cXVpcmUgaW5wdXRfbXV0ZXggJTA4eCIsCisJCSAgbG4sIEdldExhc3RFcnJv
ciAoKSk7CisjaWZkZWYgREVCVUdHSU5HCisgIGVsc2UKKyAgICBzdHJhY2Uu
cHJudGYgKF9TVFJBQ0VfVEVSTUlPUywgZm4sICIoJWQpOiBnb3QgaW5wdXRf
bXV0ZXgiLCBsbik7CisjZW5kaWYKKyAgcmV0dXJuIHJlczsKK30KKwordm9p
ZAorZmhhbmRsZXJfY29uc29sZTo6X19yZWxlYXNlX2lucHV0X211dGV4IChj
b25zdCBjaGFyICpmbiwgaW50IGxuKQoreworICBSZWxlYXNlTXV0ZXggKGlu
cHV0X211dGV4KTsKKyNpZmRlZiBERUJVR0dJTkcKKyAgc3RyYWNlLnBybnRm
IChfU1RSQUNFX1RFUk1JT1MsIGZuLCAiKCVkKTogcmVsZWFzZSBpbnB1dF9t
dXRleCIsIGxuKTsKKyNlbmRpZgorfQorCitEV09SRAorZmhhbmRsZXJfY29u
c29sZTo6X19hY3F1aXJlX291dHB1dF9tdXRleCAoY29uc3QgY2hhciAqZm4s
IGludCBsbiwgRFdPUkQgbXMpCit7CisjaWZkZWYgREVCVUdHSU5HCisgIHN0
cmFjZS5wcm50ZiAoX1NUUkFDRV9URVJNSU9TLCBmbiwgIiglZCk6IHRyeWlu
ZyB0byBnZXQgb3V0cHV0X211dGV4IiwgbG4pOworI2VuZGlmCisgIERXT1JE
IHJlcyA9IFdhaXRGb3JTaW5nbGVPYmplY3QgKG91dHB1dF9tdXRleCwgbXMp
OworICBpZiAocmVzICE9IFdBSVRfT0JKRUNUXzApCisgICAgc3RyYWNlLnBy
bnRmIChfU1RSQUNFX1RFUk1JT1MsIGZuLAorCQkgICIoJWQpOiBGYWlsZWQg
dG8gYWNxdWlyZSBvdXRwdXRfbXV0ZXggJTA4eCIsCisJCSAgbG4sIEdldExh
c3RFcnJvciAoKSk7CisjaWZkZWYgREVCVUdHSU5HCisgIGVsc2UKKyAgICBz
dHJhY2UucHJudGYgKF9TVFJBQ0VfVEVSTUlPUywgZm4sICIoJWQpOiBnb3Qg
b3V0cHV0X211dGV4IiwgbG4pOworI2VuZGlmCisgIHJldHVybiByZXM7Cit9
CisKK3ZvaWQKK2ZoYW5kbGVyX2NvbnNvbGU6Ol9fcmVsZWFzZV9vdXRwdXRf
bXV0ZXggKGNvbnN0IGNoYXIgKmZuLCBpbnQgbG4pCit7CisgIFJlbGVhc2VN
dXRleCAob3V0cHV0X211dGV4KTsKKyNpZmRlZiBERUJVR0dJTkcKKyAgc3Ry
YWNlLnBybnRmIChfU1RSQUNFX1RFUk1JT1MsIGZuLCAiKCVkKTogcmVsZWFz
ZSBvdXRwdXRfbXV0ZXgiLCBsbik7CisjZW5kaWYKK30KZGlmZiAtLWdpdCBh
L3dpbnN1cC9jeWd3aW4vc2VsZWN0LmNjIGIvd2luc3VwL2N5Z3dpbi9zZWxl
Y3QuY2MKaW5kZXggNzkwZjE1NzkxLi44NTI0MmVjMDYgMTAwNjQ0Ci0tLSBh
L3dpbnN1cC9jeWd3aW4vc2VsZWN0LmNjCisrKyBiL3dpbnN1cC9jeWd3aW4v
c2VsZWN0LmNjCkBAIC0xMDM5LDE1ICsxMDM5LDIwIEBAIHBlZWtfY29uc29s
ZSAoc2VsZWN0X3JlY29yZCAqbWUsIGJvb2wpCiAgIHNldF9oYW5kbGVfb3Jf
cmV0dXJuX2lmX25vdF9vcGVuIChoLCBtZSk7CiAKICAgd2hpbGUgKCFmaC0+
aW5wdXRfcmVhZHkgJiYgIWZoLT5nZXRfY29uc19yZWFkYWhlYWRfdmFsaWQg
KCkpCi0gICAgaWYgKGZoLT5iZ19jaGVjayAoU0lHVFRJTiwgdHJ1ZSkgPD0g
YmdfZW9mKQotICAgICAgcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsK
LSAgICBlbHNlIGlmICghUGVla0NvbnNvbGVJbnB1dFcgKGgsICZpcmVjLCAx
LCAmZXZlbnRzX3JlYWQpIHx8ICFldmVudHNfcmVhZCkKLSAgICAgIGJyZWFr
OwotICAgIGVsc2UgaWYgKGZoYW5kbGVyX2NvbnNvbGU6OmlucHV0X3dpbmNo
ID09IGZoLT5wcm9jZXNzX2lucHV0X21lc3NhZ2UgKCkpCi0gICAgICB7Ci0J
c2V0X3NpZ19lcnJubyAoRUlOVFIpOwotCXJldHVybiAtMTsKLSAgICAgIH0K
KyAgICB7CisgICAgICBpZiAoZmgtPmJnX2NoZWNrIChTSUdUVElOLCB0cnVl
KSA8PSBiZ19lb2YpCisJcmV0dXJuIG1lLT5yZWFkX3JlYWR5ID0gdHJ1ZTsK
KyAgICAgIGVsc2UgaWYgKCFQZWVrQ29uc29sZUlucHV0VyAoaCwgJmlyZWMs
IDEsICZldmVudHNfcmVhZCkgfHwgIWV2ZW50c19yZWFkKQorCWJyZWFrOwor
ICAgICAgZmgtPmFjcXVpcmVfaW5wdXRfbXV0ZXggKElORklOSVRFKTsKKyAg
ICAgIGlmIChmaGFuZGxlcl9jb25zb2xlOjppbnB1dF93aW5jaCA9PSBmaC0+
cHJvY2Vzc19pbnB1dF9tZXNzYWdlICgpKQorCXsKKwkgIHNldF9zaWdfZXJy
bm8gKEVJTlRSKTsKKwkgIGZoLT5yZWxlYXNlX2lucHV0X211dGV4ICgpOwor
CSAgcmV0dXJuIC0xOworCX0KKyAgICAgIGZoLT5yZWxlYXNlX2lucHV0X211
dGV4ICgpOworICAgIH0KICAgaWYgKGZoLT5pbnB1dF9yZWFkeSB8fCBmaC0+
Z2V0X2NvbnNfcmVhZGFoZWFkX3ZhbGlkICgpKQogICAgIHJldHVybiBtZS0+
cmVhZF9yZWFkeSA9IHRydWU7CiAKLS0gCjIuMTcuMAoK

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: text/x-csrc;
 name="confirm-select.c"
Content-Disposition: attachment;
 filename="confirm-select.c"
Content-Transfer-Encoding: 7bit
Content-length: 540

#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>
#include <string.h>
#include <errno.h>

int main()
{
	fd_set fds;
	int ret;

	while (1) {
		FD_ZERO(&fds);
		FD_SET(0, &fds);
		errno = 0;
		ret = select(1, &fds, NULL, NULL, NULL);
		printf("select() returns %d\n", ret);
		if (FD_ISSET(0, &fds)) {
			char buf[1024];
			size_t n = read(0, buf, sizeof(buf));
			printf("read() returns %d\n", n);
			if (n <= 0) break;
			size_t i;
			for (i=0; i<n; i++) {
				printf("%02x, ", buf[i]);
			}
			printf("\n");
		}
	}
	return 0;
}

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY
Content-Type: text/x-csrc;
 name="confirm-thread-safe.c"
Content-Disposition: attachment;
 filename="confirm-thread-safe.c"
Content-Transfer-Encoding: 7bit
Content-length: 821

#include <stdio.h>
#include <pthread.h>
#include <unistd.h>
#include <string.h>

void *write_thread(void *arg)
{
	int n = (int)arg;
	const int rows = 12;
	const int cols = 79;
	char buf[64];
	for (int i=0; i<1; i++) {
		for (int r=1; r<=rows; r++) {
			for (int c=1; c<=cols; c++) {
				sprintf(buf, "\033[%d;%dH\033[%dm%c", r + n*rows, c, 31+n, 'A'+n);
				write(1, buf, strlen(buf));
			}
		}
	}
}

int main()
{
	pthread_t th1, th2;

	printf("\033[H\033[J");
	fflush(stdout);
	if (pthread_create(&th1, NULL, write_thread, (void*)0)) {
		perror ("1: pthred_create");
		return -1;
	}
	if (pthread_create(&th2, NULL, write_thread, (void*)1)) {
		perror ("2: pthred_create");
		return -1;
	}
	pthread_join(th1, NULL);
	pthread_join(th2, NULL);
	usleep(3000000);
	printf("\033[H\033[J\033[m");
	fflush(stdout);
	return 0;
}

--Multipart=_Sun__31_Mar_2019_15_20_18_+0900_HT9mPuTbeUUy=8DY--
