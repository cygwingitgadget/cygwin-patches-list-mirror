From: "Town, Brad" <btown@ceddec.com>
To: "'cygwin-patches@cygwin.com'" <cygwin-patches@cygwin.com>
Subject: RE: Mouse support
Date: Mon, 11 Dec 2000 07:45:00 -0000
Message-id: <F10D23B02E54D011A0AB0020AF9CEFE999EE92@lynx.ceddec.com>
X-SW-Source: 2000-q4/msg00043.html
Content-type: multipart/mixed; boundary="----------=_1583532846-65437-21"

This is a multi-part message in MIME format...

------------=_1583532846-65437-21
Content-length: 334

Attached is a patch to fhandler_console.cc that allows enabling and
disabling the mouse based on ^[[?1000h/l.  It's not perfect, but it works
well.  Included is a ChangeLog entry.

Also, terribly minor point:  It seems that the mouse code I submitted has
been included in the CVS sources, but my ChangeLog entry hasn't yet
appeared.


------------=_1583532846-65437-21
Content-Type: text/plain; charset=us-ascii; name="ChangeLog.mouse"
Content-Disposition: inline; filename="ChangeLog.mouse"
Content-Transfer-Encoding: base64
Content-Length: 293

TW9uIERlYyAxMSAxMDo0MDoxNyAyMDAwICBCcmFkbGV5IEEuIFRvd24gPHRv
d25iYUBwb2JveC5jb20+CgoJKiBmaGFuZGxlcl9jb25zb2xlLmNjOiBBZGRl
ZCBmbGFnIGZvciBlbmFibGluZyBhbmQgZGlzYWJsaW5nCgltb3VzZSBldmVu
dHMuCgkoZmhhbmRsZXJfY29uc29sZTo6cmVhZCk6IERpdHRvLgoJKGZoYW5k
bGVyX2NvbnNvbGU6OmNoYXJfY29tbWFuZCk6IERpdHRvLgo=

------------=_1583532846-65437-21
Content-Type: text/x-diff; charset=us-ascii; name="fhandler_console.cc.diff"
Content-Disposition: inline; filename="fhandler_console.cc.diff"
Content-Transfer-Encoding: base64
Content-Length: 9911

LS0tIGZoYW5kbGVyX2NvbnNvbGUuY2Mub3JpZwlNb24gRGVjIDExIDEwOjI3
OjU1IDIwMDAKKysrIGZoYW5kbGVyX2NvbnNvbGUuY2MubmV3CU1vbiBEZWMg
MTEgMTA6MzY6MTggMjAwMApAQCAtNDcsNiArNDcsOCBAQCBzdGF0aWMgc3Ry
dWN0CiAKIGNvbnN0IGNoYXIgKiBnZXRfbm9uYXNjaWlfa2V5IChJTlBVVF9S
RUNPUkQmLCBjaGFyICopOwogCitzdGF0aWMgQk9PTCB1c2VfbW91c2UgPSBG
QUxTRTsKKwogSEFORExFIGNvbnNvbGVfc2hhcmVkX2g7CiAKIHN0YXRpYyB0
dHlfbWluIE5PX0NPUFkgKnNoYXJlZF9jb25zb2xlX2luZm8gPSBOVUxMOwpA
QCAtMTg0LDcgKzE4Niw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6OnJlYWQgKHZv
aWQgKnB2LCBzaXplX3QKIAogICAgICAgRFdPUkQgbnJlYWQ7CiAgICAgICBJ
TlBVVF9SRUNPUkQgaW5wdXRfcmVjOwotICAgICAgY29uc3QgY2hhciAqdG9h
ZGQ7CisgICAgICBjb25zdCBjaGFyICp0b2FkZCA9IDA7CiAKICAgICAgIGlm
ICghUmVhZENvbnNvbGVJbnB1dCAoaCwgJmlucHV0X3JlYywgMSwgJm5yZWFk
KSkKIAl7CkBAIC0yMTcsNyArMjE5LDcgQEAgZmhhbmRsZXJfY29uc29sZTo6
cmVhZCAodm9pZCAqcHYsIHNpemVfdAogCSAgICAgIHRtcFsxXSA9IGljaDsK
IAkgICAgICAvKiBOZWVkIHRoaXMgY2hlY2sgc2luY2UgVVMgY29kZSBwYWdl
IHNlZW1zIHRvIGhhdmUgYSBidWcgd2hlbgogCQkgY29udmVydGluZyBhIENU
UkwtVS4gKi8KLQkgIGlmICgodW5zaWduZWQgY2hhcilpY2ggPiAweDdmICYm
IGN1cnJlbnRfY29kZXBhZ2UgPT0gYW5zaV9jcCkKKwkgICAgICBpZiAoKHVu
c2lnbmVkIGNoYXIpaWNoID4gMHg3ZiAmJiBjdXJyZW50X2NvZGVwYWdlID09
IGFuc2lfY3ApCiAJCU9lbVRvQ2hhckJ1ZmYgKHRtcCArIDEsIHRtcCArIDEs
IDEpOwogCSAgICAgIGlmICghKGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC5k
d0NvbnRyb2xLZXlTdGF0ZSAmIExFRlRfQUxUX1BSRVNTRUQpKQogCQl0b2Fk
ZCA9IHRtcCArIDE7CkBAIC0yMzQsODYgKzIzNiw5MCBAQCBmaGFuZGxlcl9j
b25zb2xlOjpyZWFkICh2b2lkICpwdiwgc2l6ZV90CiAJICBicmVhazsKIAog
CWNhc2UgTU9VU0VfRVZFTlQ6Ci0JICB7Ci0JICAgIE1PVVNFX0VWRU5UX1JF
Q09SRCAmIG1vdXNlX2V2ZW50ID0gaW5wdXRfcmVjLkV2ZW50Lk1vdXNlRXZl
bnQ7Ci0KLQkgICAgLyogVHJlYXQgdGhlIGRvdWJsZS1jbGljayBldmVudCBs
aWtlIGEgcmVndWxhciBidXR0b24gcHJlc3MgKi8KLQkgICAgaWYgKG1vdXNl
X2V2ZW50LmR3RXZlbnRGbGFncyA9PSBET1VCTEVfQ0xJQ0spCi0JICAgICAg
ewotCQlzeXNjYWxsX3ByaW50ZigibW91c2U6IGRvdWJsZS1jbGljayAtPiBj
bGljayIpOwotCQltb3VzZV9ldmVudC5kd0V2ZW50RmxhZ3MgPSAwOwotCSAg
ICAgIH0KLQotCSAgICAvKiBEaWQgc29tZXRoaW5nIG90aGVyIHRoYW4gYSBj
bGljayBvY2N1cj8gKi8KLQkgICAgaWYgKG1vdXNlX2V2ZW50LmR3RXZlbnRG
bGFncykKLQkgICAgICBjb250aW51ZTsKLQotCSAgICAvKiBJZiB0aGUgbW91
c2UgZXZlbnQgb2NjdXJyZWQgb3V0IG9mIHRoZSBhcmVhIHdlIGNhbiBoYW5k
bGUsCi0JICAgICAgIGlnbm9yZSBpdC4gKi8KLQkgICAgaW50IHggPSBtb3Vz
ZV9ldmVudC5kd01vdXNlUG9zaXRpb24uWDsKLQkgICAgaW50IHkgPSBtb3Vz
ZV9ldmVudC5kd01vdXNlUG9zaXRpb24uWTsKLQkgICAgaWYgKCh4ICsgJyAn
ICsgMSA+IDB4RkYpIHx8ICh5ICsgJyAnICsgMSA+IDB4RkYpKQotCSAgICAg
IHsKLQkJc3lzY2FsbF9wcmludGYoIm1vdXNlOiBwb3NpdGlvbiBvdXQgb2Yg
cmFuZ2UiKTsKLQkJY29udGludWU7Ci0JICAgICAgfQorCSAgaWYgKHVzZV9t
b3VzZSkKKwkgICAgeworCSAgICAgIE1PVVNFX0VWRU5UX1JFQ09SRCAmIG1v
dXNlX2V2ZW50ID0gaW5wdXRfcmVjLkV2ZW50Lk1vdXNlRXZlbnQ7CiAKLQkg
ICAgLyogSWdub3JlIHVuaW1wb3J0YW50IG1vdXNlIGJ1dHRvbnMgKi8KLQkg
ICAgbW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmPSAweDc7CisJICAgICAg
LyogVHJlYXQgdGhlIGRvdWJsZS1jbGljayBldmVudCBsaWtlIGEgcmVndWxh
ciBidXR0b24gcHJlc3MgKi8KKwkgICAgICBpZiAobW91c2VfZXZlbnQuZHdF
dmVudEZsYWdzID09IERPVUJMRV9DTElDSykKKwkJeworCQkgIHN5c2NhbGxf
cHJpbnRmKCJtb3VzZTogZG91YmxlLWNsaWNrIC0+IGNsaWNrIik7CisJCSAg
bW91c2VfZXZlbnQuZHdFdmVudEZsYWdzID0gMDsKKwkJfQogCi0JICAgIC8q
IFRoaXMgY29kZSBhc3N1bWVzIFdpbmRvd3MgbmV2ZXIgcmVwb3J0cyBtdWx0
aXBsZSBidXR0b24KLQkgICAgICAgZXZlbnRzIGF0IHRoZSBzYW1lIHRpbWUu
ICovCi0JICAgIHN0YXRpYyBEV09SRCBkd0xhc3RCdXR0b25TdGF0ZSA9IDA7
Ci0JICAgIGludCBiID0gMDsKLQkgICAgY2hhciBzelszMl07Ci0JICAgIGlm
IChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlID09IGR3TGFzdEJ1dHRvblN0
YXRlKQotCSAgICAgIHsKLQkJc3lzY2FsbF9wcmludGYoIm1vdXNlOiBidXR0
b24gc3RhdGUgdW5jaGFuZ2VkIik7CisJICAgICAgLyogRGlkIHNvbWV0aGlu
ZyBvdGhlciB0aGFuIGEgY2xpY2sgb2NjdXI/ICovCisJICAgICAgaWYgKG1v
dXNlX2V2ZW50LmR3RXZlbnRGbGFncykKIAkJY29udGludWU7Ci0JICAgICAg
fQotCSAgICBlbHNlIGlmIChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlIDwg
ZHdMYXN0QnV0dG9uU3RhdGUpCi0JICAgICAgewotCQliID0gMzsKLQkJc3Ry
Y3B5KHN6LCAiYnRuIHVwIik7Ci0JICAgICAgfQotCSAgICBlbHNlIGlmICgo
bW91c2VfZXZlbnQuZHdCdXR0b25TdGF0ZSAmIDEpICE9IChkd0xhc3RCdXR0
b25TdGF0ZSAmIDEpKQotCSAgICAgIHsKLQkJYiA9IDA7Ci0JCXN0cmNweShz
eiwgImJ0bjEgZG93biIpOwotCSAgICAgIH0KLQkgICAgZWxzZSBpZiAoKG1v
dXNlX2V2ZW50LmR3QnV0dG9uU3RhdGUgJiAyKSAhPSAoZHdMYXN0QnV0dG9u
U3RhdGUgJiAyKSkKLQkgICAgICB7Ci0JCWIgPSAxOwotCQlzdHJjcHkoc3os
ICJidG4yIGRvd24iKTsKLQkgICAgICB9Ci0JICAgIGVsc2UgaWYgKChtb3Vz
ZV9ldmVudC5kd0J1dHRvblN0YXRlICYgNCkgIT0gKGR3TGFzdEJ1dHRvblN0
YXRlICYgNCkpCi0JICAgICAgewotCQliID0gMjsKLQkJc3RyY3B5KHN6LCAi
YnRuMyBkb3duIik7Ci0JICAgICAgfQotCi0JICAgIC8qIFJlbWVtYmVyIHRo
ZSBjdXJyZW50IGJ1dHRvbiBzdGF0ZSAqLwotCSAgICBkd0xhc3RCdXR0b25T
dGF0ZSA9IG1vdXNlX2V2ZW50LmR3QnV0dG9uU3RhdGU7Ci0KLQkgICAgc3Rh
dGljIGludCBuTW9kaWZpZXJzID0gMDsKLQkgICAgLyogSWYgYSBidXR0b24g
d2FzIHByZXNzZWQsIHJlbWVtYmVyIHRoZSBtb2RpZmllcnMgKi8KLQkgICAg
aWYgKGIgIT0gMykKLQkgICAgICB7Ci0JCW5Nb2RpZmllcnMgPSAwOwotCQlp
ZiAobW91c2VfZXZlbnQuZHdDb250cm9sS2V5U3RhdGUgJiBTSElGVF9QUkVT
U0VEKQotCQkgIG5Nb2RpZmllcnMgfD0gMHg0OwotCQlpZiAobW91c2VfZXZl
bnQuZHdDb250cm9sS2V5U3RhdGUgJiAoUklHSFRfQUxUX1BSRVNTRUR8TEVG
VF9BTFRfUFJFU1NFRCkpCi0JCSAgbk1vZGlmaWVycyB8PSAweDg7Ci0JCWlm
IChtb3VzZV9ldmVudC5kd0NvbnRyb2xLZXlTdGF0ZSAmIChSSUdIVF9DVFJM
X1BSRVNTRUR8TEVGVF9DVFJMX1BSRVNTRUQpKQotCQkgIG5Nb2RpZmllcnMg
fD0gMHgxMDsKLQkgICAgICB9Ci0KLQkgICAgYiB8PSBuTW9kaWZpZXJzOwot
Ci0JICAgIC8qIFdlIGNhbiBub3cgY3JlYXRlIHRoZSBjb2RlLiAqLwotCSAg
ICBzcHJpbnRmKHRtcCwgIlwwMzNbTSVjJWMlYyIsIGIgKyAnICcsIHggKyAn
ICcgKyAxLCB5ICsgJyAnICsgMSk7Ci0JICAgIHN5c2NhbGxfcHJpbnRmKCJt
b3VzZTogJXMgYXQgKCVkLCVkKSIsIHN6LCB4LCB5KTsKLQkgIH0KKwkgICAg
ICAKKwkgICAgICAvKiBJZiB0aGUgbW91c2UgZXZlbnQgb2NjdXJyZWQgb3V0
IG9mIHRoZSBhcmVhIHdlIGNhbiBoYW5kbGUsCisJCSBpZ25vcmUgaXQuICov
CisJICAgICAgaW50IHggPSBtb3VzZV9ldmVudC5kd01vdXNlUG9zaXRpb24u
WDsKKwkgICAgICBpbnQgeSA9IG1vdXNlX2V2ZW50LmR3TW91c2VQb3NpdGlv
bi5ZOworCSAgICAgIGlmICgoeCArICcgJyArIDEgPiAweEZGKSB8fCAoeSAr
ICcgJyArIDEgPiAweEZGKSkKKwkJeworCQkgIHN5c2NhbGxfcHJpbnRmKCJt
b3VzZTogcG9zaXRpb24gb3V0IG9mIHJhbmdlIik7CisJCSAgY29udGludWU7
CisJCX0KKwkgICAgICAKKwkgICAgICAvKiBJZ25vcmUgdW5pbXBvcnRhbnQg
bW91c2UgYnV0dG9ucyAqLworCSAgICAgIG1vdXNlX2V2ZW50LmR3QnV0dG9u
U3RhdGUgJj0gMHg3OworCSAgICAgIAorCSAgICAgIC8qIFRoaXMgY29kZSBh
c3N1bWVzIFdpbmRvd3MgbmV2ZXIgcmVwb3J0cyBtdWx0aXBsZSBidXR0b24K
KwkJIGV2ZW50cyBhdCB0aGUgc2FtZSB0aW1lLiAqLworCSAgICAgIHN0YXRp
YyBEV09SRCBkd0xhc3RCdXR0b25TdGF0ZSA9IDA7CisJICAgICAgaW50IGIg
PSAwOworCSAgICAgIGNoYXIgc3pbMzJdOworCSAgICAgIGlmIChtb3VzZV9l
dmVudC5kd0J1dHRvblN0YXRlID09IGR3TGFzdEJ1dHRvblN0YXRlKQorCQl7
CisJCSAgc3lzY2FsbF9wcmludGYoIm1vdXNlOiBidXR0b24gc3RhdGUgdW5j
aGFuZ2VkIik7CisJCSAgY29udGludWU7CisJCX0KKwkgICAgICBlbHNlIGlm
IChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlIDwgZHdMYXN0QnV0dG9uU3Rh
dGUpCisJCXsKKwkJICBiID0gMzsKKwkJICBzdHJjcHkoc3osICJidG4gdXAi
KTsKKwkJfQorCSAgICAgIGVsc2UgaWYgKChtb3VzZV9ldmVudC5kd0J1dHRv
blN0YXRlICYgMSkgIT0gKGR3TGFzdEJ1dHRvblN0YXRlICYgMSkpCisJCXsK
KwkJICBiID0gMDsKKwkJICBzdHJjcHkoc3osICJidG4xIGRvd24iKTsKKwkJ
fQorCSAgICAgIGVsc2UgaWYgKChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRl
ICYgMikgIT0gKGR3TGFzdEJ1dHRvblN0YXRlICYgMikpCisJCXsKKwkJICBi
ID0gMTsKKwkJICBzdHJjcHkoc3osICJidG4yIGRvd24iKTsKKwkJfQorCSAg
ICAgIGVsc2UgaWYgKChtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlICYgNCkg
IT0gKGR3TGFzdEJ1dHRvblN0YXRlICYgNCkpCisJCXsKKwkJICBiID0gMjsK
KwkJICBzdHJjcHkoc3osICJidG4zIGRvd24iKTsKKwkJfQorCSAgICAgIAor
CSAgICAgIC8qIFJlbWVtYmVyIHRoZSBjdXJyZW50IGJ1dHRvbiBzdGF0ZSAq
LworCSAgICAgIGR3TGFzdEJ1dHRvblN0YXRlID0gbW91c2VfZXZlbnQuZHdC
dXR0b25TdGF0ZTsKKwkgICAgICAKKwkgICAgICBzdGF0aWMgaW50IG5Nb2Rp
ZmllcnMgPSAwOworCSAgICAgIC8qIElmIGEgYnV0dG9uIHdhcyBwcmVzc2Vk
LCByZW1lbWJlciB0aGUgbW9kaWZpZXJzICovCisJICAgICAgaWYgKGIgIT0g
MykKKwkJeworCQkgIG5Nb2RpZmllcnMgPSAwOworCQkgIGlmIChtb3VzZV9l
dmVudC5kd0NvbnRyb2xLZXlTdGF0ZSAmIFNISUZUX1BSRVNTRUQpCisJCSAg
ICBuTW9kaWZpZXJzIHw9IDB4NDsKKwkJICBpZiAobW91c2VfZXZlbnQuZHdD
b250cm9sS2V5U3RhdGUgJiAoUklHSFRfQUxUX1BSRVNTRUR8TEVGVF9BTFRf
UFJFU1NFRCkpCisJCSAgICBuTW9kaWZpZXJzIHw9IDB4ODsKKwkJICBpZiAo
bW91c2VfZXZlbnQuZHdDb250cm9sS2V5U3RhdGUgJiAoUklHSFRfQ1RSTF9Q
UkVTU0VEfExFRlRfQ1RSTF9QUkVTU0VEKSkKKwkJICAgIG5Nb2RpZmllcnMg
fD0gMHgxMDsKKwkJfQorCSAgICAgIAorCSAgICAgIGIgfD0gbk1vZGlmaWVy
czsKKwkgICAgICAKKwkgICAgICAvKiBXZSBjYW4gbm93IGNyZWF0ZSB0aGUg
Y29kZS4gKi8KKwkgICAgICBzcHJpbnRmKHRtcCwgIlwwMzNbTSVjJWMlYyIs
IGIgKyAnICcsIHggKyAnICcgKyAxLCB5ICsgJyAnICsgMSk7CisJICAgICAg
c3lzY2FsbF9wcmludGYoIm1vdXNlOiAlcyBhdCAoJWQsJWQpIiwgc3osIHgs
IHkpOworCisJICAgICAgdG9hZGQgPSB0bXA7CisJICAgICAgbnJlYWQgPSA2
OworCSAgICB9CiAJICBicmVhazsKIAogCWNhc2UgV0lORE9XX0JVRkZFUl9T
SVpFX0VWRU5UOgpAQCAtMzI0LDcgKzMzMCw3IEBAIGZoYW5kbGVyX2NvbnNv
bGU6OnJlYWQgKHZvaWQgKnB2LCBzaXplX3QKIAkgIGNvbnRpbnVlOwogCX0K
IAotICAgICAgaWYgKGxpbmVfZWRpdCAodG9hZGQsIG5yZWFkKSkKKyAgICAg
IGlmICh0b2FkZCAmJiBsaW5lX2VkaXQgKHRvYWRkLCBucmVhZCkpCiAJYnJl
YWs7CiAgICAgfQogCkBAIC05NTYsNiArOTYyLDEwIEBAIGZoYW5kbGVyX2Nv
bnNvbGU6OmNoYXJfY29tbWFuZCAoY2hhciBjKQogCSAgICAgY2FzZSAzNzoJ
CS8qIFdISVRFIGZvcmVnICovCiAJICAgICAgIGZnID0gRk9SRUdST1VORF9C
TFVFIHwgRk9SRUdST1VORF9HUkVFTiB8IEZPUkVHUk9VTkRfUkVEOwogCSAg
ICAgICBicmVhazsKKwkgICAgIGNhc2UgMzk6CQkvKiBEZWZhdWx0IGZvcmVn
ICovCisJICAgICAgIGZnID0gZGVmYXVsdF9jb2xvciAmIChGT1JFR1JPVU5E
X0JMVUUgfCBGT1JFR1JPVU5EX0dSRUVOIHwKKwkJCQkgICAgIEZPUkVHUk9V
TkRfUkVEKTsKKwkgICAgICAgYnJlYWs7CiAJICAgICBjYXNlIDQwOgkJLyog
QkxBQ0sgYmFja2dyb3VuZCAqLwogCSAgICAgICBiZyA9IDA7CiAJICAgICAg
IGJyZWFrOwpAQCAtOTkyLDcgKzEwMDIsMjEgQEAgZmhhbmRsZXJfY29uc29s
ZTo6Y2hhcl9jb21tYW5kIChjaGFyIGMpCiAgICAgICBicmVhazsKICAgICBj
YXNlICdoJzoKICAgICBjYXNlICdsJzoKLSAgICAgIC8qIElnbm9yZSAqLwor
ICAgICAgLyogRklYTUU6IE1vc3QsIGlmIG5vdCBhbGwsIG9mIHRoZXNlIHJl
cXVpcmUgYSAnPycgYmVmb3JlIHRoZQorCSBudW1iZXIuICBJbiBhbiBlYXJs
aWVyIHJvdXRpbmUsIHRoZXkgYXJlIGVhdGVuIGFzIHVua25vd24KKwkgY2hh
cmFjdGVycywgc28gXltbMTAwMGggd291bGQgYmUgdGhlIHNhbWUgYXMgXltb
PzEwMDBoLAorCSB3aGljaCBpcyBwcm9iYWJseSBub3QgZ29vZC4gKi8KKyAg
ICAgIHN3aXRjaCAoYXJnc19bMF0pCisJeworCWNhc2UgMTAwMDogLyogTW91
c2Ugc3VwcG9ydCAqLworCSAgdXNlX21vdXNlID0gKGMgPT0gJ2gnKSA/IFRS
VUUgOiBGQUxTRTsKKwkgIHN5c2NhbGxfcHJpbnRmKCJtb3VzZSBzdXBwb3J0
ICVzYWJsZWQiLCB1c2VfbW91c2UgPyAiZW4iIDogImRpcyIpOworCSAgYnJl
YWs7CisKKwlkZWZhdWx0OiAvKiBJZ25vcmUgKi8KKwkgIHN5c2NhbGxfcHJp
bnRmKCJ1bmtub3duIGgvbCBjb21tYW5kOiAlZCIsIGFyZ3NfWzBdKTsKKwkg
IGJyZWFrOworCX0KICAgICAgIGJyZWFrOwogICAgIGNhc2UgJ0onOgogICAg
ICAgc3dpdGNoIChhcmdzX1swXSkK

------------=_1583532846-65437-21--
