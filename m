From: Egor Duda <deo@logos-m.ru>
To: cygwin-patches@cygwin.com
Subject: Re: fhandler_console
Date: Fri, 23 Feb 2001 04:20:00 -0000
Message-id: <17613156858.20010223151715@logos-m.ru>
References: <16286062992.20010216183758@logos-m.ru> <20010219214951.A23483@redhat.com> <7888578378.20010220130012@logos-m.ru>
X-SW-Source: 2001-q1/msg00109.html
Content-type: multipart/mixed; boundary="----------=_1583532846-65438-12"

This is a multi-part message in MIME format...

------------=_1583532846-65438-12
Content-length: 955

Hi!

Tuesday, 20 February, 2001 Egor Duda deo@logos-m.ru wrote:

ED> i've   looked   a  bit deeper into fhandler_console code, and think it
ED> needs more fixing. for example, this command:

ED> echo -e -n "\033[?" && echo -e "1000h"

ED> won't  enable  mouse  events  reporting  ("saw_question_mark" should be
ED> persistent   across  write calls) and several other issues. so i think
ED> several variables  which are related to console "state" should be made
ED> members of  class  fhandler_console.

i've   moved   console  state variables inside fhandler_console class.
this is a combined patch (with raw keyboard mode patch i sent sometime
ago). it adds 4 new rendition commands (\033[24;27;39;49m), compatible
with  linux console and already described in Chuck's terminfo file for
cygwin, and emulate "blink" attribute with bright background.

Egor.            mailto:deo@logos-m.ru ICQ 5165414 FidoNet 2:5020/496.19
console.ChangeLog
console.diff


------------=_1583532846-65438-12
Content-Type: text/plain; charset=us-ascii; name="console.ChangeLog"
Content-Disposition: inline; filename="console.ChangeLog"
Content-Transfer-Encoding: base64
Content-Length: 2424

MjAwMS0wMi0yMyAgRWdvciBEdWRhICA8ZGVvQGxvZ29zLW0ucnU+CgoJKiBm
aGFuZGxlci5oIChjbGFzcyBmaGFuZGxlcl9jb25zb2xlKTogTWFrZSBhbGwg
dmFyaWFibGVzIHRoYXQKCWRlc2NyaWJlICJzdGF0ZSIgb2YgY29uc29sZSB0
byBiZSBtZW1iZXJzIG9mIGZoYW5kbGVyX2NvbnNvbGUuCglkZWZhdWx0X2Nv
bG9yIGlzIG5vdyB0aGUgY29sb3Igd2hpY2ggaXMgc2V0IHdoZW4gY29uc29s
ZSByZWNpZXZlcwoJcmVzZXQgY29tbWFuZC4KCSogZmhhbmRsZXJfY29uc29s
ZS5jYyAoZmhhbmRsZXJfY29uc29sZTo6ZmhhbmRsZXJfY29uc29sZSk6IFR1
cm4KCW1vdXNlIGhhbmRsaW5nIGFuZCByYXcga2V5Ym9hcmQgbW9kZSBvZmYg
YnkgZGVmYXVsdC4gSW5pdGlhbGl6ZQoJc3RhdGUgaW5mb3JtYXRpb24uCgkq
IGZoYW5kbGVyLmNjIChmaGFuZGxlcl9jb25zb2xlOjpzZXRfcmF3X3dpbjMy
X2tleWJvYXJkX21vZGUpOiBOZXcKCWZ1bmN0aW9uLgoJKiBmaGFuZGxlcl9j
b25zb2xlLmNjIChmaGFuZGxlcl9jb25zb2xlOjpzZXRfZGVmYXVsdF9hdHRy
KTogTmV3CglmdW5jdGlvbi4gUmVzZXQgY29uc29sZSBhdHRyaWJ1dGVzIHRv
IGRlZmF1bHQgdmFsdWVzLgoJKiBmaGFuZGxlcl9jb25zb2xlLmNjIChmaGFu
ZGxlcl9jb25zb2xlOjpvcGVuKTogUmVzZXQgYXR0cmlidXRlcy4KCSogZmhh
bmRsZXJfY29uc29sZS5jYyAoZmhhbmRsZXJfY29uc29sZTo6Z2V0X3dpbjMy
X2F0dHIpOiBOZXcgZnVuY3Rpb24uCglDYWxjdWxhdGUgd2luMzItc3R5bGUg
Y29uc29sZSBhdHRyaWJ1dGUgYmFzZWQgb24gdGVybWluYWwgYXR0cmlidXRl
cy4KCSogZmhhbmRsZXJfY29uc29sZS5jYyAoZmhhbmRsZXJfY29uc29sZTo6
c2V0X2N1cnNvcl9tYXliZSk6IFVzZQoJbWVtYmVyIHZhcmlhYmxlLgoJKiBm
aGFuZGxlcl9jb25zb2xlLmNjIChmaGFuZGxlcl9jb25zb2xlOjpyZWFkKTog
SWYgaW4gcmF3LXdpbjMyCglrZXlib2FyZCBtb2RlLCBlbmNvZGUgd2luMzIg
a2V5Ym9hcmQgZXZlbnRzIGluIFwwMzN7eDt5O3o7dDt1O3dLCglzZXF1ZW5j
ZXMuCgkqIGZoYW5kbGVyX2NvbnNvbGUuY2MgKGZoYW5kbGVyX2NvbnNvbGU6
OmR1cCk6IENvcHkgYWxsIHN0YXRlCglpbmZvcm1hdGlvbiB0byB0aGUgZHVw
KCllZCBoYW5kbGUuCgkqIGZoYW5kbGVyX2NvbnNvbGUuY2MgKGZoYW5kbGVy
X2NvbnNvbGU6OnNjcm9sbF9zY3JlZW4pOiBVc2UgY3VycmVudAoJZmlsbC1p
bglhdHRyaWJ1dGUuCgkqIGZoYW5kbGVyX2NvbnNvbGUuY2MgKGZoYW5kbGVy
X2NvbnNvbGU6OmNsZWFyX3NjcmVlbik6IERpdHRvLgoJKiBmaGFuZGxlcl9j
b25zb2xlLmNjIChmaGFuZGxlcl9jb25zb2xlOjpjaGFyX2NvbW1hbmQpOiBD
aGVjayBpZiB3ZQoJc2F3ICc/JyBzeW1ib2wgYnkgbWVtYmVyIHZhcmlhYmxl
LiBTZXQgdGVybWluYWwJYXR0cmlidXRlcyBvbiBcMDMzW1htCgljb21tYW5k
cy4gXDAzM1syNG0gLSB0dXJuIG9mZiB1bmRlcmxpbmUgbW9kZSwgXDAzM1sy
N20gLSB0dXJuIG9mZgoJcmV2ZXJzZSBtb2RlLCBcMDMzWzM5bSAtIHJlc3Rv
cmUgZGVmYXVsdCBmb3JlZ3JvdW5kIGNvbG9yLgoJXDAzM1s0OW0gLSByZXN0
b3JlIGRlZmF1bHQgYmFja2dyb3VuZCBjb2xvci4gXDAzM1syMDAwaCAtIHR1
cm4gb24gcmF3CglrZXlib2FyZCBtb2RlLCBcMDMzWzIwMDBsIC0gdHVybiBv
ZmYgcmF3IGtleWJvYXJkIG1vZGUuCgkqIGZoYW5kbGVyX2NvbnNvbGUuY2Mg
KGZoYW5kbGVyX2NvbnNvbGU6OndyaXRlKTogU2V0IGF0dHJpYnVlcyB0bwoJ
ZGVmYXVsdCB2YWx1ZXMgb24gcmVzZXQgY29tbWFuZC4K

------------=_1583532846-65438-12
Content-Type: text/x-diff; charset=us-ascii; name="console.diff"
Content-Disposition: inline; filename="console.diff"
Content-Transfer-Encoding: base64
Content-Length: 22058

SW5kZXg6IGZoYW5kbGVyLmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaCx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMS40MApkaWZmIC11IC1wIC0yIC1yMS40
MCBmaGFuZGxlci5oCi0tLSBmaGFuZGxlci5oCTIwMDEvMDEvMTcgMTQ6NTc6
MDkJMS40MAorKysgZmhhbmRsZXIuaAkyMDAxLzAyLzIzIDExOjU3OjQ3CkBA
IC01NzYsMTIgKzU3NiwxMiBAQCBwdWJsaWM6CiB9OwogCi0vKiBUaGlzIGlz
IGEgaW5wdXQgYW5kIG91dHB1dCBjb25zb2xlIGhhbmRsZSAqLwotY2xhc3Mg
ZmhhbmRsZXJfY29uc29sZTogcHVibGljIGZoYW5kbGVyX3Rlcm1pb3MKK2Vu
dW0gYW5zaV9pbnRlbnNpdHkKIHsKLXByaXZhdGU6Ci0KLS8qIE91dHB1dCBz
dGF0ZSAqLworICBJTlRFTlNJVFlfSU5WSVNJQkxFLAorICBJTlRFTlNJVFlf
RElNLAorICBJTlRFTlNJVFlfTk9STUFMLAorICBJTlRFTlNJVFlfQk9MRAor
fTsKIAotICAvLyBlbnVtIHtub3JtYWwsIGdvdGVzYywgZ290c3F1YXJlLCBn
b3RhcmcxLCBnb3Rjb21tYW5kfSBzdGF0ZTsKICNkZWZpbmUgbm9ybWFsIDEK
ICNkZWZpbmUgZ290ZXNjIDIKQEAgLTU5MywxMSArNTkzLDUzIEBAIHByaXZh
dGU6CiAjZGVmaW5lIGVhdHRpdGxlIDgKICNkZWZpbmUgTUFYQVJHUyAxMAor
CisvKiBUaGlzIGlzIGEgaW5wdXQgYW5kIG91dHB1dCBjb25zb2xlIGhhbmRs
ZSAqLworY2xhc3MgZmhhbmRsZXJfY29uc29sZTogcHVibGljIGZoYW5kbGVy
X3Rlcm1pb3MKK3sKK3ByaXZhdGU6CisKKyAgV09SRCBkZWZhdWx0X2NvbG9y
LCB1bmRlcmxpbmVfY29sb3IsIGRpbV9jb2xvcjsKKworLyogT3V0cHV0IHN0
YXRlICovCiAgIGludCBzdGF0ZV87CiAgIGludCBhcmdzX1tNQVhBUkdTXTsK
ICAgaW50IG5hcmdzXzsKKyAgdW5zaWduZWQgcmFyZzsKKyAgQk9PTCBzYXdf
cXVlc3Rpb25fbWFyazsKKworICBjaGFyIG15X3RpdGxlX2J1ZiBbVElUTEVT
SVpFICsgMV07CisKKyAgV09SRCBjdXJyZW50X3dpbjMyX2F0dHI7CisgIGFu
c2lfaW50ZW5zaXR5IGludGVuc2l0eTsKKyAgQk9PTCB1bmRlcmxpbmUsIGJs
aW5rLCByZXZlcnNlOworICBXT1JEIGZnLCBiZzsKKworICAvKiBzYXZlZCBj
dXJzb3IgY29vcmRpbmF0ZXMgKi8KKyAgaW50IHNhdmV4LCBzYXZleTsKKwor
ICBzdHJ1Y3QKKyAgICB7CisgICAgICBzaG9ydCBUb3AsIEJvdHRvbTsKKyAg
ICB9IHNjcm9sbF9yZWdpb247CisgIHN0cnVjdAorICAgIHsKKyAgICAgIFNI
T1JUIHdpblRvcDsKKyAgICAgIFNIT1JUIHdpbkJvdHRvbTsKKyAgICAgIENP
T1JEIGR3V2luU2l6ZTsKKyAgICAgIENPT1JEIGR3QnVmZmVyU2l6ZTsKKyAg
ICAgIENPT1JEIGR3Q3Vyc29yUG9zaXRpb247CisgICAgICBXT1JEIHdBdHRy
aWJ1dGVzOworICAgIH0gaW5mbzsKKworICBDT09SRCBkd0xhc3RDdXJzb3JQ
b3NpdGlvbjsKKyAgRFdPUkQgZHdMYXN0QnV0dG9uU3RhdGU7CisgIGludCBu
TW9kaWZpZXJzOwogCi0gIERXT1JEIGRlZmF1bHRfY29sb3I7CisgIEJPT0wg
dXNlX21vdXNlOworICBCT09MIHJhd193aW4zMl9rZXlib2FyZF9tb2RlOwog
CiAvKiBPdXRwdXQgY2FsbHMgKi8KKyAgdm9pZCBzZXRfZGVmYXVsdF9hdHRy
ICgpOworICBXT1JEIGdldF93aW4zMl9hdHRyICgpOwogCiAgIEJPT0wgZmls
bGluX2luZm8gKCk7CkBAIC02MDgsNSArNjUwLDYgQEAgcHJpdmF0ZToKICAg
dm9pZCBjdXJzb3JfcmVsIChpbnQsIGludCk7CiAgIGNvbnN0IHVuc2lnbmVk
IGNoYXIgKiB3cml0ZV9ub3JtYWwgKHVuc2lnbmVkIGNvbnN0IGNoYXIqLCB1
bnNpZ25lZCBjb25zdCBjaGFyICopOwotICB2b2lkIGNoYXJfY29tbWFuZCAo
Y2hhciwgYm9vbCk7CisgIHZvaWQgY2hhcl9jb21tYW5kIChjaGFyKTsKKyAg
Qk9PTCBzZXRfcmF3X3dpbjMyX2tleWJvYXJkX21vZGUgKEJPT0wpOwogICBp
bnQgb3V0cHV0X3Rjc2V0YXR0ciAoaW50IGEsIGNvbnN0IHN0cnVjdCB0ZXJt
aW9zICp0KTsKIApJbmRleDogZmhhbmRsZXJfY29uc29sZS5jYwo9PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3Vw
L2N5Z3dpbi9maGFuZGxlcl9jb25zb2xlLmNjLHYKcmV0cmlldmluZyByZXZp
c2lvbiAxLjM3CmRpZmYgLXUgLXAgLTIgLXIxLjM3IGZoYW5kbGVyX2NvbnNv
bGUuY2MKLS0tIGZoYW5kbGVyX2NvbnNvbGUuY2MJMjAwMS8wMi8xNCAyMjow
MDowOQkxLjM3CisrKyBmaGFuZGxlcl9jb25zb2xlLmNjCTIwMDEvMDIvMjMg
MTE6NTc6NDgKQEAgLTM3LDggKzM3LDQgQEAgZGV0YWlscy4gKi8KICAqIE5l
Z2F0aXZlIHZhbHVlcyByZXByZXNlbnRzIGN1cnJlbnQgc2NyZWVuIGRpbWVu
c2lvbnMKICAqLwotc3RhdGljIHN0cnVjdAotICAgIHsKLSAgICAgIHNob3J0
IFRvcCwgQm90dG9tOwotICAgIH0gc2Nyb2xsX3JlZ2lvbiA9IHswLCAtMX07
CiAKICNkZWZpbmUgc3JUb3AgKGluZm8ud2luVG9wICsgc2Nyb2xsX3JlZ2lv
bi5Ub3ApCkBAIC00OSw2ICs0NSw0IEBAIHN0YXRpYyBzdHJ1Y3QKIGNvbnN0
IGNoYXIgKiBnZXRfbm9uYXNjaWlfa2V5IChJTlBVVF9SRUNPUkQmLCBjaGFy
ICopOwogCi1zdGF0aWMgQk9PTCB1c2VfbW91c2UgPSBGQUxTRTsKLQogc3Rh
dGljIHR0eV9taW4gTk9fQ09QWSAqc2hhcmVkX2NvbnNvbGVfaW5mbyA9IE5V
TEw7CiAKQEAgLTExNywxOCArMTExLDI2IEBAIHNldF9jb25zb2xlX3N0YXRl
X2Zvcl9zcGF3biAoKQogfQogCitCT09MCitmaGFuZGxlcl9jb25zb2xlOjpz
ZXRfcmF3X3dpbjMyX2tleWJvYXJkX21vZGUgKEJPT0wgbmV3X21vZGUpCit7
CisgIEJPT0wgb2xkX21vZGUgPSByYXdfd2luMzJfa2V5Ym9hcmRfbW9kZTsK
KyAgcmF3X3dpbjMyX2tleWJvYXJkX21vZGUgPSBuZXdfbW9kZTsKKyAgc3lz
Y2FsbF9wcmludGYgKCJyYXcga2V5Ym9hcmQgbW9kZSAlc2FibGVkIiwgcmF3
X3dpbjMyX2tleWJvYXJkX21vZGUgPyAiZW4iIDogImRpcyIpOworICByZXR1
cm4gb2xkX21vZGU7Cit9OworCiB2b2lkCiBmaGFuZGxlcl9jb25zb2xlOjpz
ZXRfY3Vyc29yX21heWJlICgpCiB7CiAgIENPTlNPTEVfU0NSRUVOX0JVRkZF
Ul9JTkZPIG5vdzsKLSAgc3RhdGljIENPTlNPTEVfU0NSRUVOX0JVRkZFUl9J
TkZPIGxhc3QgPSB7ezAsIDB9LCB7LTEsIC0xfSwgMCwgezAsIDB9LCB7MCwg
MH19OwogCiAgIGlmICghR2V0Q29uc29sZVNjcmVlbkJ1ZmZlckluZm8gKGdl
dF9vdXRwdXRfaGFuZGxlKCksICZub3cpKQogICAgIHJldHVybjsKIAotICBp
ZiAobGFzdC5kd0N1cnNvclBvc2l0aW9uLlggIT0gbm93LmR3Q3Vyc29yUG9z
aXRpb24uWCB8fAotICAgICAgbGFzdC5kd0N1cnNvclBvc2l0aW9uLlkgIT0g
bm93LmR3Q3Vyc29yUG9zaXRpb24uWSkKKyAgaWYgKGR3TGFzdEN1cnNvclBv
c2l0aW9uLlggIT0gbm93LmR3Q3Vyc29yUG9zaXRpb24uWCB8fAorICAgICAg
ZHdMYXN0Q3Vyc29yUG9zaXRpb24uWSAhPSBub3cuZHdDdXJzb3JQb3NpdGlv
bi5ZKQogICAgIHsKICAgICAgIFNldENvbnNvbGVDdXJzb3JQb3NpdGlvbiAo
Z2V0X291dHB1dF9oYW5kbGUgKCksIG5vdy5kd0N1cnNvclBvc2l0aW9uKTsK
LSAgICAgIGxhc3QuZHdDdXJzb3JQb3NpdGlvbiA9IG5vdy5kd0N1cnNvclBv
c2l0aW9uOworICAgICAgZHdMYXN0Q3Vyc29yUG9zaXRpb24gPSBub3cuZHdD
dXJzb3JQb3NpdGlvbjsKICAgICB9CiB9CkBAIC0xNTQsNSArMTU2LDUgQEAg
ZmhhbmRsZXJfY29uc29sZTo6cmVhZCAodm9pZCAqcHYsIHNpemVfdAogICBI
QU5ETEUgdzRbMl07CiAgIERXT1JEIG53YWl0OwotICBjaGFyIHRtcFsxN107
CisgIGNoYXIgdG1wWzYwXTsKIAogICB3NFswXSA9IGg7CkBAIC0xOTksNCAr
MjAxLDMzIEBAIGZoYW5kbGVyX2NvbnNvbGU6OnJlYWQgKHZvaWQgKnB2LCBz
aXplX3QKIAl7CiAJY2FzZSBLRVlfRVZFTlQ6CisjZGVmaW5lIHZpcnR1YWxf
a2V5X2NvZGUgKGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC53VmlydHVhbEtl
eUNvZGUpCisjZGVmaW5lIGNvbnRyb2xfa2V5X3N0YXRlIChpbnB1dF9yZWMu
RXZlbnQuS2V5RXZlbnQuZHdDb250cm9sS2V5U3RhdGUpCisKKyNpZmRlZiBE
RUJVR0dJTkcKKyAgICAgICAgICAvKiBhbGxvdyBtYW51YWwgc3dpdGNoaW5n
IHRvL2Zyb20gcmF3IG1vZGUgdmlhIGN0cmwtYWx0LXNjcm9sbGxvY2sgKi8K
KyAgICAgICAgICBpZiAoaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmJLZXlE
b3duICYmCisgICAgICAgICAgICAgIHZpcnR1YWxfa2V5X2NvZGUgPT0gVktf
U0NST0xMICYmCisgICAgICAgICAgICAgIGNvbnRyb2xfa2V5X3N0YXRlICYg
KExFRlRfQUxUX1BSRVNTRUQgfCBMRUZUX0NUUkxfUFJFU1NFRCkgPT0gTEVG
VF9BTFRfUFJFU1NFRCB8IExFRlRfQ1RSTF9QUkVTU0VECisgICAgICAgICAg
ICAgKQorICAgICAgICAgICAgeyAgIAorICAgICAgICAgICAgICBzZXRfcmF3
X3dpbjMyX2tleWJvYXJkX21vZGUgKCAhcmF3X3dpbjMyX2tleWJvYXJkX21v
ZGUgKTsKKyAgICAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAgICB9
CisjZW5kaWYKKworICAgICAgICAgIGlmIChyYXdfd2luMzJfa2V5Ym9hcmRf
bW9kZSkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgX19zbWFsbF9z
cHJpbnRmKHRtcCwgIlwwMzN7JXU7JXU7JXU7JXU7JXU7JWx1SyIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0X3JlYy5FdmVu
dC5LZXlFdmVudC5iS2V5RG93biwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LndSZXBlYXRD
b3VudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5w
dXRfcmVjLkV2ZW50LktleUV2ZW50LndWaXJ0dWFsS2V5Q29kZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRfcmVjLkV2ZW50
LktleUV2ZW50LndWaXJ0dWFsU2NhbkNvZGUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGlucHV0X3JlYy5FdmVudC5LZXlFdmVudC51
Q2hhci5Vbmljb2RlQ2hhciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaW5wdXRfcmVjLkV2ZW50LktleUV2ZW50LmR3Q29udHJvbEtl
eVN0YXRlICk7CisgICAgICAgICAgICAgIHRvYWRkID0gdG1wOworICAgICAg
ICAgICAgICBucmVhZCA9IHN0cmxlbiAodG9hZGQpOworICAgICAgICAgICAg
ICBicmVhazsKKyAgICAgICAgICAgIH0KKwogCSAgaWYgKCFpbnB1dF9yZWMu
RXZlbnQuS2V5RXZlbnQuYktleURvd24pCiAJICAgIGNvbnRpbnVlOwpAQCAt
MjY2LDUgKzI5Nyw0IEBAIGZoYW5kbGVyX2NvbnNvbGU6OnJlYWQgKHZvaWQg
KnB2LCBzaXplX3QKIAkgICAgICAvKiBUaGlzIGNvZGUgYXNzdW1lcyBXaW5k
b3dzIG5ldmVyIHJlcG9ydHMgbXVsdGlwbGUgYnV0dG9uCiAJCSBldmVudHMg
YXQgdGhlIHNhbWUgdGltZS4gKi8KLQkgICAgICBzdGF0aWMgRFdPUkQgZHdM
YXN0QnV0dG9uU3RhdGUgPSAwOwogCSAgICAgIGludCBiID0gMDsKIAkgICAg
ICBjaGFyIHN6WzMyXTsKQEAgLTI5OCw1ICszMjgsNCBAQCBmaGFuZGxlcl9j
b25zb2xlOjpyZWFkICh2b2lkICpwdiwgc2l6ZV90CiAJICAgICAgZHdMYXN0
QnV0dG9uU3RhdGUgPSBtb3VzZV9ldmVudC5kd0J1dHRvblN0YXRlOwogCSAg
ICAgIAotCSAgICAgIHN0YXRpYyBpbnQgbk1vZGlmaWVycyA9IDA7CiAJICAg
ICAgLyogSWYgYSBidXR0b24gd2FzIHByZXNzZWQsIHJlbWVtYmVyIHRoZSBt
b2RpZmllcnMgKi8KIAkgICAgICBpZiAoYiAhPSAzKQpAQCAtMzU1LDE0ICsz
ODQsNCBAQCBmaGFuZGxlcl9jb25zb2xlOjpzZXRfaW5wdXRfc3RhdGUgKCkK
IH0KIAotc3RhdGljIHN0cnVjdAotICB7Ci0gICAgU0hPUlQgd2luVG9wOwot
ICAgIFNIT1JUIHdpbkJvdHRvbTsKLSAgICBDT09SRCBkd1dpblNpemU7Ci0g
ICAgQ09PUkQgZHdCdWZmZXJTaXplOwotICAgIENPT1JEIGR3Q3Vyc29yUG9z
aXRpb247Ci0gICAgV09SRCB3QXR0cmlidXRlczsKLSAgfSBpbmZvOwotCiBC
T09MCiBmaGFuZGxlcl9jb25zb2xlOjpmaWxsaW5faW5mbyAodm9pZCkKQEAg
LTQyMiw1ICs0NDEsNSBAQCBmaGFuZGxlcl9jb25zb2xlOjpzY3JvbGxfc2Ny
ZWVuIChpbnQgeDEsCiAgICAgZGVzdC5ZID0geW4gPiAwID8geW4gOiBpbmZv
LndpbkJvdHRvbTsKICAgZmlsbC5DaGFyLkFzY2lpQ2hhciA9ICcgJzsKLSAg
ZmlsbC5BdHRyaWJ1dGVzID0gZGVmYXVsdF9jb2xvcjsKKyAgZmlsbC5BdHRy
aWJ1dGVzID0gY3VycmVudF93aW4zMl9hdHRyOwogICBTY3JvbGxDb25zb2xl
U2NyZWVuQnVmZmVyIChnZXRfb3V0cHV0X2hhbmRsZSAoKSwgJnNyMSwgJnNy
MiwgZGVzdCwgJmZpbGwpOwogCkBAIC00NzQsNCArNDkzLDYgQEAgZmhhbmRs
ZXJfY29uc29sZTo6b3BlbiAoY29uc3QgY2hhciAqLCBpbgogICAgIGRlZmF1
bHRfY29sb3IgPSBpbmZvLndBdHRyaWJ1dGVzOwogCisgIHNldF9kZWZhdWx0
X2F0dHIgKCk7CisKICAgRFdPUkQgY2ZsYWdzOwogICBpZiAoR2V0Q29uc29s
ZU1vZGUgKGdldF9pb19oYW5kbGUgKCksICZjZmxhZ3MpKQpAQCAtNTEyLDYg
KzUzMywzNCBAQCBmaGFuZGxlcl9jb25zb2xlOjpkdXAgKGZoYW5kbGVyX2Jh
c2UgKmNoCiAgICAgc3lzdGVtX3ByaW50ZiAoImVycm9yIG9wZW5pbmcgY29u
c29sZSwgJUUiKTsKIAotICBmaGMtPnN0YXRlXyA9IHN0YXRlXzsKICAgZmhj
LT5kZWZhdWx0X2NvbG9yID0gZGVmYXVsdF9jb2xvcjsKKyAgZmhjLT51bmRl
cmxpbmVfY29sb3IgPSB1bmRlcmxpbmVfY29sb3I7CisgIGZoYy0+ZGltX2Nv
bG9yID0gZGltX2NvbG9yOworICBmaGMtPnN0YXRlXyA9IHN0YXRlXzsKKyAg
ZmhjLT5uYXJnc18gPSBuYXJnc187CisgIGZvciAoIGludCBpID0gMDsgaSA8
IE1BWEFSR1M7IGkrKyApIAorICAgIGZoYy0+YXJnc19baV0gPSBhcmdzX1tp
XTsKKyAgZmhjLT5yYXJnID0gcmFyZzsKKyAgZmhjLT5zYXdfcXVlc3Rpb25f
bWFyayA9IHNhd19xdWVzdGlvbl9tYXJrOworCisgIHN0cm5jcHkgKCBmaGMt
Pm15X3RpdGxlX2J1ZiwgbXlfdGl0bGVfYnVmLCBUSVRMRVNJWkUgKyAxKSA7
CisKKyAgZmhjLT5jdXJyZW50X3dpbjMyX2F0dHIgPSBjdXJyZW50X3dpbjMy
X2F0dHI7CisgIGZoYy0+aW50ZW5zaXR5ID0gaW50ZW5zaXR5OyAKKyAgZmhj
LT51bmRlcmxpbmUgPSB1bmRlcmxpbmU7CisgIGZoYy0+YmxpbmsgPSBibGlu
azsKKyAgZmhjLT5yZXZlcnNlID0gcmV2ZXJzZTsKKyAgZmhjLT5mZyA9IGZn
OworICBmaGMtPmJnID0gYmc7CisKKyAgZmhjLT5zYXZleCA9IHNhdmV4Owor
ICBmaGMtPnNhdmV5ID0gc2F2ZXk7CisKKyAgZmhjLT5zY3JvbGxfcmVnaW9u
ID0gc2Nyb2xsX3JlZ2lvbjsKKyAgZmhjLT5kd0xhc3RDdXJzb3JQb3NpdGlv
biA9IGR3TGFzdEN1cnNvclBvc2l0aW9uOworICBmaGMtPmR3TGFzdEJ1dHRv
blN0YXRlID0gZHdMYXN0QnV0dG9uU3RhdGU7CisgIGZoYy0+bk1vZGlmaWVy
cyA9IG5Nb2RpZmllcnM7CisKKyAgZmhjLT51c2VfbW91c2UgPSB1c2VfbW91
c2U7CisgIGZoYy0+cmF3X3dpbjMyX2tleWJvYXJkX21vZGUgPSByYXdfd2lu
MzJfa2V5Ym9hcmRfbW9kZTsKIAogICByZXR1cm4gMDsKQEAgLTcyMCw4ICs3
NjksNjAgQEAgZmhhbmRsZXJfY29uc29sZTo6ZmhhbmRsZXJfY29uc29sZSAo
Y29ucwogewogICBzZXRfY2IgKHNpemVvZiAqdGhpcyk7CisgIGRlZmF1bHRf
Y29sb3IgPSBkaW1fY29sb3IgPSBGT1JFR1JPVU5EX1JFRCB8IEZPUkVHUk9V
TkRfR1JFRU4gfCBGT1JFR1JPVU5EX0JMVUU7CisgIHVuZGVybGluZV9jb2xv
ciA9IEZPUkVHUk9VTkRfR1JFRU4gfCBGT1JFR1JPVU5EX0JMVUU7CiAgIHN0
YXRlXyA9IG5vcm1hbDsKKyAgbmFyZ3NfID0gMDsKKyAgZm9yICggaW50IGkg
PSAwOyBpIDwgTUFYQVJHUzsgaSsrICkgYXJnc18gW2ldID0gMDsKKyAgc2F2
ZXggPSBzYXZleSA9IDA7CisgIHNjcm9sbF9yZWdpb24uVG9wID0gMDsKKyAg
c2Nyb2xsX3JlZ2lvbi5Cb3R0b20gPSAtMTsKKyAgZHdMYXN0Q3Vyc29yUG9z
aXRpb24uWCA9IC0xOworICBkd0xhc3RDdXJzb3JQb3NpdGlvbi5ZID0gLTE7
CisgIGR3TGFzdEJ1dHRvblN0YXRlID0gMDsKKyAgbk1vZGlmaWVycyA9IDA7
CisgIHVzZV9tb3VzZSA9IHJhd193aW4zMl9rZXlib2FyZF9tb2RlID0gRkFM
U0U7CiAgIHNldF9uZWVkX2ZvcmtfZml4dXAgKCk7CiB9CiAKKyNkZWZpbmUg
Rk9SRUdST1VORF9BVFRSX01BU0sgKEZPUkVHUk9VTkRfUkVEIHwgRk9SRUdS
T1VORF9HUkVFTiB8IFwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEZPUkVHUk9VTkRfQkxVRSB8IEZPUkVHUk9VTkRfSU5URU5TSVRZKQorI2Rl
ZmluZSBCQUNLR1JPVU5EX0FUVFJfTUFTSyAoQkFDS0dST1VORF9SRUQgfCBC
QUNLR1JPVU5EX0dSRUVOIHwgXAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgQkFDS0dST1VORF9CTFVFIHwgQkFDS0dST1VORF9JTlRFTlNJVFkp
Cit2b2lkCitmaGFuZGxlcl9jb25zb2xlOjpzZXRfZGVmYXVsdF9hdHRyICgp
Cit7CisgIGJsaW5rID0gdW5kZXJsaW5lID0gcmV2ZXJzZSA9IEZBTFNFOwor
ICBpbnRlbnNpdHkgPSBJTlRFTlNJVFlfTk9STUFMOworICBmZyA9IGRlZmF1
bHRfY29sb3IgJiBGT1JFR1JPVU5EX0FUVFJfTUFTSzsKKyAgYmcgPSBkZWZh
dWx0X2NvbG9yICYgQkFDS0dST1VORF9BVFRSX01BU0s7Cit9CisKK1dPUkQK
K2ZoYW5kbGVyX2NvbnNvbGU6OmdldF93aW4zMl9hdHRyICgpCit7CisgIFdP
UkQgd2luX2ZnID0gZmc7CisgIFdPUkQgd2luX2JnID0gYmc7CisgIGlmICgg
cmV2ZXJzZSApCisgICAgeyAKKyAgICAgIFdPUkQgc2F2ZV9mZyA9IHdpbl9m
ZzsKKyAgICAgIHdpbl9mZyA9ICggd2luX2JnICYgQkFDS0dST1VORF9SRUQg
ICA/IEZPUkVHUk9VTkRfUkVEICAgOiAwICkgfAorICAgICAgICAgICAgICAg
KCB3aW5fYmcgJiBCQUNLR1JPVU5EX0dSRUVOID8gRk9SRUdST1VORF9HUkVF
TiA6IDAgKSB8CisgICAgICAgICAgICAgICAoIHdpbl9iZyAmIEJBQ0tHUk9V
TkRfQkxVRSAgPyBGT1JFR1JPVU5EX0JMVUUgIDogMCApIHwKKyAgICAgICAg
ICAgICAgICggd2luX2ZnICYgRk9SRUdST1VORF9JTlRFTlNJVFkgKTsKKyAg
ICAgIHdpbl9iZyA9ICggc2F2ZV9mZyAmIEZPUkVHUk9VTkRfUkVEICAgPyBC
QUNLR1JPVU5EX1JFRCAgIDogMCApIHwKKyAgICAgICAgICAgICAgICggc2F2
ZV9mZyAmIEZPUkVHUk9VTkRfR1JFRU4gPyBCQUNLR1JPVU5EX0dSRUVOIDog
MCApIHwKKyAgICAgICAgICAgICAgICggc2F2ZV9mZyAmIEZPUkVHUk9VTkRf
QkxVRSAgPyBCQUNLR1JPVU5EX0JMVUUgIDogMCApIHwKKyAgICAgICAgICAg
ICAgICggd2luX2JnICYgQkFDS0dST1VORF9JTlRFTlNJVFkgKTsKKyAgICB9
CisgIGlmICggdW5kZXJsaW5lICkgd2luX2ZnID0gdW5kZXJsaW5lX2NvbG9y
OworICAvKiBlbXVsYXRlIGJsaW5rIHdpdGggYnJpZ2h0IGJhY2tncm91bmQg
Ki8KKyAgaWYgKCBibGluayApIHdpbl9iZyB8PSBCQUNLR1JPVU5EX0lOVEVO
U0lUWTsKKyAgaWYgKCBpbnRlbnNpdHkgPT0gSU5URU5TSVRZX0lOVklTSUJM
RSApCisgICAgd2luX2ZnID0gd2luX2JnOworICBlbHNlIGlmICggaW50ZW5z
aXR5ID09IElOVEVOU0lUWV9CT0xEICkKKyAgICB3aW5fZmcgfD0gRk9SRUdS
T1VORF9JTlRFTlNJVFk7CisgIHJldHVybiAoIHdpbl9mZyB8IHdpbl9iZyAp
OworfQorCiAvKgogICogQ2xlYXIgdGhlIHNjcmVlbiBjb250ZXh0IGZyb20g
eDEveTEgdG8geDIveTIgY2VsbC4KQEAgLTc2Myw1ICs4NjQsNSBAQCBmaGFu
ZGxlcl9jb25zb2xlOjpjbGVhcl9zY3JlZW4gKGludCB4MSwgCiAJCQkgICAg
ICAgJmRvbmUpOwogICBGaWxsQ29uc29sZU91dHB1dEF0dHJpYnV0ZSAoZ2V0
X291dHB1dF9oYW5kbGUgKCksCi0JCQkgICAgICAgZGVmYXVsdF9jb2xvciwK
KwkJCSAgICAgICBjdXJyZW50X3dpbjMyX2F0dHIsCiAJCQkgICAgICAgbnVt
LAogCQkJICAgICAgIHRsYywKQEAgLTg1OSwxOCArOTYwLDcgQEAgc3RhdGlj
IGNvbnN0IGNoYXIgYmFzZV9jaGFyc1syNTZdID0KIC8qRjggRjkgRkEgRkIg
RkMgRkQgRkUgRkYgKi8gTk9SLCBOT1IsIE5PUiwgTk9SLCBOT1IsIE5PUiwg
Tk9SLCBOT1IgfTsKIAotLyojZGVmaW5lIHN5c2NhbGxfcHJpbnRmIHNtYWxs
X3ByaW50ZiovCi0KLXN0YXRpYyBpbnQgc2F2ZXgsIHNhdmV5OyAvKiBmb3Ig
Q1NJIHMsIENTSSB1ICovCi0KIHZvaWQKLWZoYW5kbGVyX2NvbnNvbGU6OmNo
YXJfY29tbWFuZCAoY2hhciBjLCBib29sIHNhd19xdWVzdGlvbl9tYXJrKQor
ZmhhbmRsZXJfY29uc29sZTo6Y2hhcl9jb21tYW5kIChjaGFyIGMpCiB7Ci0g
IC8vIEtlZXAgdGhlIGJhY2tncm91bmQgaW50ZW5zaXR5IHdpdGggdGhlIGNv
bHIgc2luY2UgdGhlcmUgZG9lc24ndCBzZWVtCi0gIC8vIHRvIGJlIGEgd2F5
IHRvIHNldCB0aGlzIHdpdGggdGVybWNhcC90ZXJtaW5mby4KLSAgc3RhdGlj
IGludCBmZyA9IGRlZmF1bHRfY29sb3IgJiAoRk9SRUdST1VORF9CTFVFIHwg
Rk9SRUdST1VORF9HUkVFTiB8Ci0JCQkJICAgRk9SRUdST1VORF9SRUQpLAot
CSAgICAgYmcgPSBkZWZhdWx0X2NvbG9yICYgKEJBQ0tHUk9VTkRfQkxVRSB8
IEJBQ0tHUk9VTkRfR1JFRU4gfAotCQkJCSAgIEJBQ0tHUk9VTkRfUkVEIHwg
QkFDS0dST1VORF9JTlRFTlNJVFkpLAotCQkJIGJvbGQgPSBkZWZhdWx0X2Nv
bG9yICYgRk9SRUdST1VORF9JTlRFTlNJVFk7CiAgIGludCB4LCB5OwogICBj
aGFyIGJ1Zls0MF07CkBAIC04ODUsNTggKzk3NSwzMCBAQCBmaGFuZGxlcl9j
b25zb2xlOjpjaGFyX2NvbW1hbmQgKGNoYXIgYywgCiAJICAgewogCSAgICAg
Y2FzZSAwOiAgICAvKiBub3JtYWwgY29sb3IgKi8KLQkgICAgICAgZmcgPSBk
ZWZhdWx0X2NvbG9yICYgKEZPUkVHUk9VTkRfQkxVRSB8IEZPUkVHUk9VTkRf
R1JFRU4gfAotCQkJCSAgICAgRk9SRUdST1VORF9SRUQpOwotCSAgICAgICBi
ZyA9IGRlZmF1bHRfY29sb3IgJiAoQkFDS0dST1VORF9CTFVFIHwgQkFDS0dS
T1VORF9HUkVFTiB8Ci0JCQkJICAgICBCQUNLR1JPVU5EX1JFRCB8IEJBQ0tH
Uk9VTkRfSU5URU5TSVRZKTsKLQkgICAgICAgYm9sZCA9IGRlZmF1bHRfY29s
b3IgJiBGT1JFR1JPVU5EX0lOVEVOU0lUWTsKKyAgICAgICAgICAgICAgIHNl
dF9kZWZhdWx0X2F0dHIgKCk7CiAJICAgICAgIGJyZWFrOwogCSAgICAgY2Fz
ZSAxOiAgICAvKiBib2xkICovCi0JICAgICAgIGZnID0gZGVmYXVsdF9jb2xv
ciAmIChGT1JFR1JPVU5EX0JMVUUgfCBGT1JFR1JPVU5EX0dSRUVOIHwKLQkJ
CQkgICAgIEZPUkVHUk9VTkRfUkVEKTsKLQkgICAgICAgYmcgPSBkZWZhdWx0
X2NvbG9yICYgKEJBQ0tHUk9VTkRfQkxVRSB8IEJBQ0tHUk9VTkRfR1JFRU4g
fAotCQkJCSAgICAgQkFDS0dST1VORF9SRUQgfCBCQUNLR1JPVU5EX0lOVEVO
U0lUWSk7Ci0JICAgICAgIGJvbGQgPSBGT1JFR1JPVU5EX0lOVEVOU0lUWTsK
KyAgICAgICAgICAgICAgIGludGVuc2l0eSA9IElOVEVOU0lUWV9CT0xEOwog
CSAgICAgICBicmVhazsKLQkgICAgIGNhc2UgNDogICAgLyogdW5kZXJsaW5l
IC0gc2ltdWxhdGUgd2l0aCBjeWFuICovCi0JICAgICAgIGZnID0gRk9SRUdS
T1VORF9CTFVFIHwgRk9SRUdST1VORF9HUkVFTjsKLQkgICAgICAgYmcgPSBk
ZWZhdWx0X2NvbG9yICYgKEJBQ0tHUk9VTkRfQkxVRSB8IEJBQ0tHUk9VTkRf
R1JFRU4gfAotCQkJCSAgICAgQkFDS0dST1VORF9SRUQgfCBCQUNLR1JPVU5E
X0lOVEVOU0lUWSk7Ci0JICAgICAgIGJvbGQgPSBkZWZhdWx0X2NvbG9yICYg
Rk9SRUdST1VORF9JTlRFTlNJVFk7CisJICAgICBjYXNlIDQ6ICAgIAorCSAg
ICAgICB1bmRlcmxpbmUgPSAxOwogCSAgICAgICBicmVhazsKIAkgICAgIGNh
c2UgNTogICAgLyogYmxpbmsgbW9kZSAqLwotCSAgICAgICBmZyA9IGRlZmF1
bHRfY29sb3IgJiAoRk9SRUdST1VORF9CTFVFIHwgRk9SRUdST1VORF9HUkVF
TiB8Ci0JCQkJICAgICBGT1JFR1JPVU5EX1JFRCk7Ci0JICAgICAgIGJnID0g
ZGVmYXVsdF9jb2xvciAmIChCQUNLR1JPVU5EX0JMVUUgfCBCQUNLR1JPVU5E
X0dSRUVOIHwKLQkJCQkgICAgIEJBQ0tHUk9VTkRfUkVEIHwgQkFDS0dST1VO
RF9JTlRFTlNJVFkpOwotCSAgICAgICBib2xkID0gZGVmYXVsdF9jb2xvciAm
IEZPUkVHUk9VTkRfSU5URU5TSVRZOworICAgICAgICAgICAgICAgYmxpbmsg
PSBUUlVFOwogCSAgICAgICBicmVhazsKIAkgICAgIGNhc2UgNzogICAgLyog
cmV2ZXJzZSAqLwotCSAgICAgICBmZyA9IChkZWZhdWx0X2NvbG9yICYgQkFD
S0dST1VORF9CTFVFKSA/IEZPUkVHUk9VTkRfQkxVRSA6IDA7Ci0JICAgICAg
IGZnIHw9IChkZWZhdWx0X2NvbG9yICYgQkFDS0dST1VORF9HUkVFTikgPyBG
T1JFR1JPVU5EX0dSRUVOIDogMDsKLQkgICAgICAgZmcgfD0gKGRlZmF1bHRf
Y29sb3IgJiBCQUNLR1JPVU5EX1JFRCkgPyBGT1JFR1JPVU5EX1JFRCA6IDA7
Ci0JICAgICAgIGZnIHw9IChkZWZhdWx0X2NvbG9yICYgQkFDS0dST1VORF9J
TlRFTlNJVFkpID8KLQkJCQkJICAgICBGT1JFR1JPVU5EX0lOVEVOU0lUWSA6
IDA7Ci0JICAgICAgIGJnID0gKGRlZmF1bHRfY29sb3IgJiBGT1JFR1JPVU5E
X0JMVUUpID8gQkFDS0dST1VORF9CTFVFIDogMDsKLQkgICAgICAgYmcgfD0g
KGRlZmF1bHRfY29sb3IgJiBGT1JFR1JPVU5EX0dSRUVOKSA/IEJBQ0tHUk9V
TkRfR1JFRU4gOiAwOwotCSAgICAgICBiZyB8PSAoZGVmYXVsdF9jb2xvciAm
IEZPUkVHUk9VTkRfUkVEKSA/IEJBQ0tHUk9VTkRfUkVEIDogMDsKLQkgICAg
ICAgYmcgfD0gKGRlZmF1bHRfY29sb3IgJiBGT1JFR1JPVU5EX0lOVEVOU0lU
WSkgPwotCQkJCQkgICAgIEJBQ0tHUk9VTkRfSU5URU5TSVRZIDogMDsKKyAg
ICAgICAgICAgICAgIHJldmVyc2UgPSBUUlVFOwogCSAgICAgICBicmVhazsK
IAkgICAgIGNhc2UgODogICAgLyogaW52aXNpYmxlICovCi0JICAgICAgIGZn
ID0gKGRlZmF1bHRfY29sb3IgJiBCQUNLR1JPVU5EX0JMVUUpID8gRk9SRUdS
T1VORF9CTFVFIDogMDsKLQkgICAgICAgZmcgfD0gKGRlZmF1bHRfY29sb3Ig
JiBCQUNLR1JPVU5EX0dSRUVOKSA/IEZPUkVHUk9VTkRfR1JFRU4gOiAwOwot
CSAgICAgICBmZyB8PSAoZGVmYXVsdF9jb2xvciAmIEJBQ0tHUk9VTkRfUkVE
KSA/IEZPUkVHUk9VTkRfUkVEIDogMDsKLQkgICAgICAgYmcgPSBkZWZhdWx0
X2NvbG9yICYgKEJBQ0tHUk9VTkRfQkxVRSB8IEJBQ0tHUk9VTkRfR1JFRU4g
fAotCQkJCSAgICAgQkFDS0dST1VORF9SRUQgfCBCQUNLR1JPVU5EX0lOVEVO
U0lUWSk7Ci0JICAgICAgIGJvbGQgPSAoZGVmYXVsdF9jb2xvciAmIEJBQ0tH
Uk9VTkRfSU5URU5TSVRZKSA/Ci0JCQkJCQkgICBGT1JFR1JPVU5EX0lOVEVO
U0lUWSA6IDA7CisgICAgICAgICAgICAgICBpbnRlbnNpdHkgPSBJTlRFTlNJ
VFlfSU5WSVNJQkxFOwogCSAgICAgICBicmVhazsKIAkgICAgIGNhc2UgOTog
ICAgLyogZGltICovCi0JICAgICAgIGZnID0gZGVmYXVsdF9jb2xvciAmIChG
T1JFR1JPVU5EX0JMVUUgfCBGT1JFR1JPVU5EX0dSRUVOIHwKLQkJCQkgICAg
IEZPUkVHUk9VTkRfUkVEKTsKLQkgICAgICAgYmcgPSBkZWZhdWx0X2NvbG9y
ICYgKEJBQ0tHUk9VTkRfQkxVRSB8IEJBQ0tHUk9VTkRfR1JFRU4gfAotCQkJ
CSAgICAgQkFDS0dST1VORF9SRUQgfCBCQUNLR1JPVU5EX0lOVEVOU0lUWSk7
Ci0JICAgICAgIGJvbGQgPSAoZmcgPT0gMCkgPyBGT1JFR1JPVU5EX0lOVEVO
U0lUWSA6IDA7CisgICAgICAgICAgICAgICBpbnRlbnNpdHkgPSBJTlRFTlNJ
VFlfRElNOwogCSAgICAgICBicmVhazsKKyAgICAgICAgICAgICBjYXNlIDI0
OgorICAgICAgICAgICAgICAgdW5kZXJsaW5lID0gRkFMU0U7CisgICAgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgICAgICBjYXNlIDI3OiAKKyAgICAg
ICAgICAgICAgIHJldmVyc2UgPSBGQUxTRTsKKyAgICAgICAgICAgICAgIGJy
ZWFrOwogCSAgICAgY2FzZSAzMDoJCS8qIEJMQUNLIGZvcmVncm91bmQgKi8K
IAkgICAgICAgZmcgPSAwOwpAQCAtOTYzLDQgKzEwMjUsNyBAQCBmaGFuZGxl
cl9jb25zb2xlOjpjaGFyX2NvbW1hbmQgKGNoYXIgYywgCiAJICAgICAgIGZn
ID0gRk9SRUdST1VORF9CTFVFIHwgRk9SRUdST1VORF9HUkVFTiB8IEZPUkVH
Uk9VTkRfUkVEOwogCSAgICAgICBicmVhazsKKyAgICAgICAgICAgICBjYXNl
IDM5OgorICAgICAgICAgICAgICAgZmcgPSBkZWZhdWx0X2NvbG9yICYgRk9S
RUdST1VORF9BVFRSX01BU0s7CisgICAgICAgICAgICAgICBicmVhazsKIAkg
ICAgIGNhc2UgNDA6CQkvKiBCTEFDSyBiYWNrZ3JvdW5kICovCiAJICAgICAg
IGJnID0gMDsKQEAgLTk4Nyw2ICsxMDUyLDEwIEBAIGZoYW5kbGVyX2NvbnNv
bGU6OmNoYXJfY29tbWFuZCAoY2hhciBjLCAKIAkgICAgICAgYmcgPSBCQUNL
R1JPVU5EX0JMVUUgfCBCQUNLR1JPVU5EX0dSRUVOIHwgQkFDS0dST1VORF9S
RUQ7CiAJICAgICAgIGJyZWFrOworICAgICAgICAgICAgIGNhc2UgNDk6Cisg
ICAgICAgICAgICAgICBiZyA9IGRlZmF1bHRfY29sb3IgJiBCQUNLR1JPVU5E
X0FUVFJfTUFTSzsKKyAgICAgICAgICAgICAgIGJyZWFrOwogCSAgIH0KLQkg
U2V0Q29uc29sZVRleHRBdHRyaWJ1dGUgKGdldF9vdXRwdXRfaGFuZGxlICgp
LCBmZyB8IGJnIHwgYm9sZCk7CisgICAgICAgICBjdXJyZW50X3dpbjMyX2F0
dHIgPSBnZXRfd2luMzJfYXR0ciAoKTsKKyAgCSBTZXRDb25zb2xlVGV4dEF0
dHJpYnV0ZSAoZ2V0X291dHB1dF9oYW5kbGUgKCksIGN1cnJlbnRfd2luMzJf
YXR0cik7CiAgICAgICBicmVhazsKICAgICBjYXNlICdoJzoKQEAgLTEwMDEs
NCArMTA3MCw3IEBAIGZoYW5kbGVyX2NvbnNvbGU6OmNoYXJfY29tbWFuZCAo
Y2hhciBjLCAKIAkgIGJyZWFrOwogCisgICAgICAgIGNhc2UgMjAwMDogLyog
UmF3IGtleWJvYXJkIG1vZGUgKi8KKwkgIHNldF9yYXdfd2luMzJfa2V5Ym9h
cmRfbW9kZSAoIChjID09ICdoJykgPyBUUlVFIDogRkFMU0UgKTsKKyAgICAg
ICAgICAKIAlkZWZhdWx0OiAvKiBJZ25vcmUgKi8KIAkgIHN5c2NhbGxfcHJp
bnRmKCJ1bmtub3duIGgvbCBjb21tYW5kOiAlZCIsIGFyZ3NfWzBdKTsKQEAg
LTEyNDUsNyArMTMxNyw0IEBAIGZoYW5kbGVyX2NvbnNvbGU6OndyaXRlIChj
b25zdCB2b2lkICp2c3IKICAgdW5zaWduZWQgY29uc3QgY2hhciAqc3JjID0g
KHVuc2lnbmVkIGNoYXIgKikgdnNyYzsKICAgdW5zaWduZWQgY29uc3QgY2hh
ciAqZW5kID0gc3JjICsgbGVuOwotICBzdGF0aWMgTk9fQ09QWSB1bnNpZ25l
ZCByYXJnOwotICBzdGF0aWMgTk9fQ09QWSBjaGFyIG15X3RpdGxlX2J1ZltU
SVRMRVNJWkUgKyAxXTsKLSAgYm9vbCBzYXdfcXVlc3Rpb25fbWFyayA9IDA7
CiAKICAgZGVidWdfcHJpbnRmICgiJXgsICVkIiwgdnNyYywgbGVuKTsKQEAg
LTEyNjYsNCArMTMzNSw1IEBAIGZoYW5kbGVyX2NvbnNvbGU6OndyaXRlIChj
b25zdCB2b2lkICp2c3IKIAkgICAgewogCSAgICAgIHN0YXRlXyA9IGdvdHNx
dWFyZTsKKyAgICAgICAgICAgICAgc2F3X3F1ZXN0aW9uX21hcmsgPSBGQUxT
RTsKIAkgICAgICBmb3IgKG5hcmdzXyA9IDA7IG5hcmdzXyA8IE1BWEFSR1M7
IG5hcmdzXysrKQogCQlhcmdzX1tuYXJnc19dID0gMDsKQEAgLTEyODQsNCAr
MTM1NCw1IEBAIGZoYW5kbGVyX2NvbnNvbGU6OndyaXRlIChjb25zdCB2b2lk
ICp2c3IKIAkgIGVsc2UgaWYgKCpzcmMgPT0gJ2MnKQkJLyogUmVzZXQgTGlu
dXggdGVybWluYWwgKi8KIAkgICAgeworICAgICAgICAgICAgICBzZXRfZGVm
YXVsdF9hdHRyICgpOwogCSAgICAgIGNsZWFyX3NjcmVlbiAoMCwgMCwgLTEs
IC0xKTsKIAkgICAgICBjdXJzb3Jfc2V0IChUUlVFLCAwLCAwKTsKQEAgLTEz
MjUsNSArMTM5Niw1IEBAIGZoYW5kbGVyX2NvbnNvbGU6OndyaXRlIChjb25z
dCB2b2lkICp2c3IKIAkgIGJyZWFrOwogCWNhc2UgZ290Y29tbWFuZDoKLQkg
IGNoYXJfY29tbWFuZCAoKnNyYysrLCBzYXdfcXVlc3Rpb25fbWFyayk7CisJ
ICBjaGFyX2NvbW1hbmQgKCpzcmMrKyk7CiAJICBzdGF0ZV8gPSBub3JtYWw7
CiAJICBicmVhazsKQEAgLTEzNzMsNSArMTQ0NCw1IEBAIGZoYW5kbGVyX2Nv
bnNvbGU6OndyaXRlIChjb25zdCB2b2lkICp2c3IKIAkgICAgewogCSAgICAg
IGlmICgqc3JjID09ICc/JykKLQkJc2F3X3F1ZXN0aW9uX21hcmsgPSAxOwor
CQlzYXdfcXVlc3Rpb25fbWFyayA9IFRSVUU7CiAJICAgICAgLyogaWdub3Jl
IGFueSBleHRyYSBjaGFycyBiZXR3ZWVuIFsgYW5kIGZpcnN0IGFyZyBvciBj
b21tYW5kICovCiAJICAgICAgc3JjKys7Cg==

------------=_1583532846-65438-12--
