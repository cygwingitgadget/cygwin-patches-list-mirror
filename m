Return-Path: <kbrown@cornell.edu>
Received: from NAM10-BN7-obe.outbound.protection.outlook.com
 (mail-bn7nam10on2097.outbound.protection.outlook.com [40.107.92.97])
 by sourceware.org (Postfix) with ESMTPS id 42EB43858405
 for <cygwin-patches@cygwin.com>; Tue, 23 Nov 2021 20:59:10 +0000 (GMT)
DMARC-Filter: OpenDMARC Filter v1.4.1 sourceware.org 42EB43858405
Authentication-Results: sourceware.org;
 dmarc=pass (p=none dis=none) header.from=cornell.edu
Authentication-Results: sourceware.org; spf=pass smtp.mailfrom=cornell.edu
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Jxc9p2CQCd2FrqtXVBjLcevGAgUXialuIn8L60d4uc0GIjeyqEgRIyJ8OQ9xfQ9vEDZJwcUZa2d5S0TGZXc+/qk7UG5XaJRVlzGRLqLlVWYEW+LCsORNFkajFZCV0oe52HJknAwD4Ev+aLB44DovY+cEyUV7OrfHY53dF7hmKO/Ru9FIeiUMqj6uJuyTKPCj6TIgvD2qk0zvaqNqBrhBRO6+AYH/Og9v8J9ZGRH62Df2riPKp8z7Tn1DVTG3QhXoniPYtbf+yjYQM5FtzaZp6NnegStzbxzrJzIbxCMjGCZldYFG7ak2v7XzbvJiDE6hPt2I4CIuwSuLn2tCqkKNug==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=pULeRwj2hkslGI4Nx+0BnZoO1RVjFZT+zrRkaFPl1PU=;
 b=IYh5lEigypimkEp6KVHwNRKHwVVexrr82LAAhYgWicRCxzJS/l2HiILQf/cbJ2MVYYgBCwdi/u/ykknwu85e8JspKClBKjzCgdXJ3VhMKPfz8eQUvHFkNmshbo/gnssVmKtwnUpAJqgu11Cg6sKl9aG7JdQi33JuNGaIAAxGchvVlw3YyzCqIKTT/D0q8zKfb/wuElKziBQoxK7v8BoQlS0axrEL0R2nnjG5K5sXxtJl2ks3xDKqpUE759ZE7UQ6L+P7a9KqJ8lSqzIyTPlWw8oCt1jYZfEuG2bdXifHDkymbTPY4QmFNVg217u0RL5AUuPQkeGoeKalHXEYa+42nw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=cornell.edu; dmarc=pass action=none header.from=cornell.edu;
 dkim=pass header.d=cornell.edu; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cornell.edu;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=pULeRwj2hkslGI4Nx+0BnZoO1RVjFZT+zrRkaFPl1PU=;
 b=Cl1ezAiA6VYEXXWyoXQaURo5VxmYafNlMhxgh4MlrNgQPnLB+BcV0knSHTigSD/NgmHDwpgJQ9zePpJBIwt/VTCGdDdr219mHY+aw6yipnVrBO78V0Ol86SJK/jGkKHUCokoCMKvbM5uCSIFBDoQBGFr+roe8Tum87zstYiG1lI=
Authentication-Results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=cornell.edu;
Received: from BN7PR04MB4388.namprd04.prod.outlook.com (2603:10b6:406:f8::19)
 by BN7PR04MB3843.namprd04.prod.outlook.com (2603:10b6:406:bd::25)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4713.19; Tue, 23 Nov
 2021 20:59:08 +0000
Received: from BN7PR04MB4388.namprd04.prod.outlook.com
 ([fe80::88c4:79c5:1eb1:b969]) by BN7PR04MB4388.namprd04.prod.outlook.com
 ([fe80::88c4:79c5:1eb1:b969%7]) with mapi id 15.20.4713.026; Tue, 23 Nov 2021
 20:59:08 +0000
Content-Type: multipart/mixed; boundary="------------8J0N9mhZTPZTl04i5qDXaEKX"
Message-ID: <9bb59713-39a9-99c4-04b6-b4d5a0f74ea2@cornell.edu>
Date: Tue, 23 Nov 2021 15:59:05 -0500
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101
 Thunderbird/91.3.1
Content-Language: en-US
To: "cygwin-patches@cygwin.com" <cygwin-patches@cygwin.com>
From: Ken Brown <kbrown@cornell.edu>
Subject: [PATCH] Cygwin: fhandler_fifo::raw_read: handle STATUS_PENDING
X-ClientProxiedBy: MN2PR10CA0028.namprd10.prod.outlook.com
 (2603:10b6:208:120::41) To BN7PR04MB4388.namprd04.prod.outlook.com
 (2603:10b6:406:f8::19)
MIME-Version: 1.0
Received: from [IPV6:2603:7081:7e3f:3419:e071:d504:5947:a8f5]
 (2603:7081:7e3f:3419:e071:d504:5947:a8f5) by
 MN2PR10CA0028.namprd10.prod.outlook.com (2603:10b6:208:120::41) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4713.19 via Frontend
 Transport; Tue, 23 Nov 2021 20:59:08 +0000
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 5aa3ec42-4620-4654-4647-08d9aec417a4
X-MS-TrafficTypeDiagnostic: BN7PR04MB3843:
X-Microsoft-Antispam-PRVS: <BN7PR04MB38430A152E6D874D6A3212D7D8609@BN7PR04MB3843.namprd04.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:6108;
X-MS-Exchange-SenderADCheck: 1
X-MS-Exchange-AntiSpam-Relay: 0
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: E7WuP96cc111XtfNYjtvytglA3IOZ4sNuY6qRZNg/sqvcI2WaXSQZEYjEdnWekYpIGewMQQTs4m7h6RH48NFPLvvc6Jy6UfX1bxX0OldZlmFJsW3kEYPgwCxpfJtpIq5m5PpkFeejQpjGnug95NgxDBqskT83WRbsW8CXR3pZSJguSNZueIl4tHP7SqFuVHy+rpVVvov+zGLhyvpeluYaQEuvu7bjeVCF4aUtG27E/Wqx5CWPFJo7OAoOt9KeARzbyXYCb1MdGH1sQxOQCKjsLRQMt0iTaeSgnHhWKod7QkaB8wWkbf4Ap/HLod8g1z3cYhMnalzzTHDbmalvF7yw6HkCj3JtT0/6v2+mamuKKks+HEX99xjVsWjNriZRNwahSbZlM+IPs8XL0Fcu/W9QYmB4V0LI0nL9upvQpQyRUS31Hd+n2c5KE8iSkyUXdHtb3YFKrabBqNMsKhb2xJVHyDwrlyivNTYjLlh4Vexzsjzvg5gbLQriwn19FvQms2pM914AxxQHAmPQhjOPmEz+cTx41FWpgR77JO63DmoxJjLmCvNGS3t+GUlZzVdFmG0dPcMNPr2HCYjJnhUcbP8wmdMHX8b/aQ4yo3hBbBrYonVA9D4/M70/oAOthYLBNyVsW+RNKthDToaCrJCmM1SG1bLBWbJi/VW8cZGoRQl0XQ+rii59vREG/NxqJ8W4TLnmFgQik0d8qCrujlaqQqTOHvEX0Zj1Tk0RXx8mJJP6dI=
X-Forefront-Antispam-Report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:BN7PR04MB4388.namprd04.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(4636009)(366004)(66946007)(66476007)(86362001)(75432002)(36756003)(31696002)(5660300002)(2616005)(235185007)(33964004)(66556008)(8676002)(6666004)(186003)(508600001)(316002)(786003)(6486002)(8936002)(31686004)(38100700002)(6916009)(564344004)(2906002)(43740500002)(45980500001);
 DIR:OUT; SFP:1102; 
X-MS-Exchange-AntiSpam-MessageData-ChunkCount: 1
X-MS-Exchange-AntiSpam-MessageData-0: =?utf-8?B?UEgrZXUvMDd3d2dIWjI0NlVORExHRlVHb1Q0a2lHL1d0ZVg4Q3ZNNzhXT1pG?=
 =?utf-8?B?WHhPRnRnUVpnc0twQVZaQmE1UGcxbFovK1ptVDNjckFQUmxwNk41SzN1UGVK?=
 =?utf-8?B?c2orQjRMbHNueDJRUzdXV1J4dVJIcFMzOGxab1l2N1NMMHo3ZW8wT2lSbEdj?=
 =?utf-8?B?WjlNWm1Qb2hxMDVmTjllQnMxYWVSaVcyK29XWjJ0ZHJ3eWEvbWlIV1p6U2Jm?=
 =?utf-8?B?Mm1WS1JMTzAvUnAxRWZuOWhvM3QyaDZUTTd2ZVNEU2lweWVGMU1pem9TSSt2?=
 =?utf-8?B?eWw2Z1FtRTMvekxYb0pvYk9LV1RObmx0RVlNTytNc2FkVW53SW1DWk45Y2NP?=
 =?utf-8?B?bXhaMkprMXc5NWhrSGVZdHJkamVPNmR2cXNwSFYrb0h0OGtrWUJXbzBBSGhI?=
 =?utf-8?B?eFRvMmc5VEcyNE5RUjRGWXFuYVYrdGhHNTJybnkxS3lMamRKTk4vMXpRZHA3?=
 =?utf-8?B?L0RocEltTitnOU53eXJrU2g2UXE0MmFxbXAzRk4xeGs0RzVwSTFuajV1em5M?=
 =?utf-8?B?WXgwVHdxUFFWOHlEUFFiR2wwK0tRTmVFU0pvVE1NMFpZc08wd1VlNnVOUTZz?=
 =?utf-8?B?dE5ZUERKVnRMNW1VU2tzSTNaRDNlRE5zNlppeHhNeGpiUnBzbnBMNXM3VTJk?=
 =?utf-8?B?Vyt1SlFIbXM0NDVPWGxLM29vNHZ2TkNGRjdOajBKK3pmTVBDRzNxb1JXaHlj?=
 =?utf-8?B?UnJ5ZE5tSEJ4eHUxbW1wUk4zTU45V1B0OU5DSzFVeHFMSmwzYzhBQm5iUk81?=
 =?utf-8?B?Nkg4WnhKcXdRMWYwZDR3YUNCM3EzdFZxQXAzNWk5NUFpYVN5Y2ErSERpUjB2?=
 =?utf-8?B?VUdvb1FiK0I0ZStJVk1kcHhnRk1jbDFHcVduN090azZla25SVGFsY1lXbTh0?=
 =?utf-8?B?N1h3dkF1bHJneTZwN21oZlZjdUc5dkJIY1ZYMm9QVnVDcXd0U2JxU2JxV1lt?=
 =?utf-8?B?ZjNLVUFESmk3U0Ezc1NpR1NpTVpEWFN0M280cS9tRjBScVF5SGgzOXJUVXZj?=
 =?utf-8?B?RnZCUTVVQ0ZFY2NjdGxHV1VSNUl1TGlkSk5vUnhZVHI0VEtNM2dWRDFOcE1F?=
 =?utf-8?B?NUhBU2U1TmplYTAweXRleURJZlBmaUN0c2lGSGVJc3lpNXE2eUdJMWpTc1ZF?=
 =?utf-8?B?cERKcUZpVTNycDJSazZwd25mNnc5OUI1K2xKVU5jeEVqdnhIVGpNdE04dE9L?=
 =?utf-8?B?cjB0WFFjQ0NsYTR5cVJmSTlReUluV3RFeU9PNUhGZDZmTGl6eDBlaGFWN0Jq?=
 =?utf-8?B?SW1TV2Uyb2NOVXVKMW84T1UwYjVaSUk3d1BCcTl0S2RVZmt2bW5zVDkrWmhW?=
 =?utf-8?B?WDV1bkM2ZlRrNmtUL0gvRDBtdGF4V2kxNXF1MlFTNjFhVFRnaFdMNU50N1Rw?=
 =?utf-8?B?REwxUHZxYzZ2a2R6S3VYWUc2ZjJURVRxZUlHclozK3BhZ3ZQelBmbDN3UEZN?=
 =?utf-8?B?TndNZ3lvZnhHRyt2U1pqRVRhSjhNMjRUdHh6SjBGTGYvbmpoVkttNXA5Vk1n?=
 =?utf-8?B?eE5scGwyYjZ3VEdkKzM1WXBmQTlNV0RpU3hTZWxFbnYvRjJqUlBWRnZXdzdB?=
 =?utf-8?B?NnAydE44am1TUEFXczNseDNhWkN4QzZ2ejY0K21idTVIL1FCaTQ2dy96ZkJK?=
 =?utf-8?B?a3p2UWFESzBxQ1VFTUtKMW1KZTFORnFUSDRMLzhqSHl1NUU1aUhWMlNabTdp?=
 =?utf-8?B?YUdMOFovV3RVMm9nQzA4MnpqS2dyWUZVbXJ4N2p3SlZ3ZDVPSndUaHEvckVu?=
 =?utf-8?B?RFlhUFV4b05VMmpQcDRqa1JtV1JGL0tXZ2hNL3orYnpYNVpSMThPS2dUb0Y3?=
 =?utf-8?B?YTNDSHlwd2c5NlQwUkdETFFydmtmRXNqeE4xTUNZNCtwckp4dkZhMzRsdUpP?=
 =?utf-8?B?WmVEY3JvcHlTeFFpNlNDSWY2Q2RWU3hBOU9ucWNyUmlXcWV4VjQvV2M2Rnd3?=
 =?utf-8?B?QVRJWWZYTHZ5UUR5Y24rUXFVaFNYSHRkeW5uNmZJQ2dvc0U5ZlNlNWY1bnd2?=
 =?utf-8?B?dDQ5VzBmM0lvYmdZUmJsZkRBWTlBVFlHZUFWTmp0OXFxU2VqRURjaVRZTkcv?=
 =?utf-8?B?U1pzUmRjd2RUMWV3RnJVN2JnZTFDMHZwWmFRMS9DWi9KaUJsL0w0U3lEblA1?=
 =?utf-8?B?THAwQjNMTEZDaldscHphdnIyRUZrVGtrMzJtTktTSXV6ZDh2R3c4MjN0M1VN?=
 =?utf-8?B?V294Z09WUUIzdjdkWWhMUmN2VWY2VDhTVVNjSnNLOHhCR0VmY05hNXltTERp?=
 =?utf-8?Q?AmOOJ+Hw6ykmLnGYWOyE1QFSWxUfKvERXDdBv44NbQ=3D?=
X-OriginatorOrg: cornell.edu
X-MS-Exchange-CrossTenant-Network-Message-Id: 5aa3ec42-4620-4654-4647-08d9aec417a4
X-MS-Exchange-CrossTenant-AuthSource: BN7PR04MB4388.namprd04.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 23 Nov 2021 20:59:08.5259 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 5d7e4366-1b9b-45cf-8e79-b14b27df46e1
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: qj2tgHmVtipOcRn52UblI4gAy4cX3PnDHtpERPYs5Vv4CZMHj7M+J8aALZJ/pWRrMTM/9h2G56aIbUktbaYepg==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN7PR04MB3843
X-Spam-Status: No, score=-10.7 required=5.0 tests=BAYES_00, DKIM_SIGNED,
 DKIM_VALID, DKIM_VALID_AU, DKIM_VALID_EF, GIT_PATCH_0, MSGID_FROM_MTA_HEADER,
 RCVD_IN_MSPIKE_H2, SPF_HELO_PASS, SPF_PASS,
 TXREP autolearn=ham autolearn_force=no version=3.4.4
X-Spam-Checker-Version: SpamAssassin 3.4.4 (2020-01-24) on
 server2.sourceware.org
X-BeenThere: cygwin-patches@cygwin.com
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Cygwin core component patch submission and discussion
 <cygwin-patches.cygwin.com>
List-Unsubscribe: <https://cygwin.com/mailman/options/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=unsubscribe>
List-Archive: <https://cygwin.com/pipermail/cygwin-patches/>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Help: <mailto:cygwin-patches-request@cygwin.com?subject=help>
List-Subscribe: <https://cygwin.com/mailman/listinfo/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=subscribe>
X-List-Received-Date: Tue, 23 Nov 2021 20:59:11 -0000

--------------8J0N9mhZTPZTl04i5qDXaEKX
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Patch attached.  Takashi, since you wrote the analogous patch for pipes, could 
you take a look?

Thanks.

Ken
--------------8J0N9mhZTPZTl04i5qDXaEKX
Content-Type: text/plain; charset=UTF-8;
 name="0001-Cygwin-fhandler_fifo-raw_read-handle-STATUS_PENDING.patch"
Content-Disposition: attachment;
 filename*0="0001-Cygwin-fhandler_fifo-raw_read-handle-STATUS_PENDING.pat";
 filename*1="ch"
Content-Transfer-Encoding: base64

RnJvbSA0ZjQ3ZTY0YjExZWQ4ZDQ3YzYyZmE4OWU5Yjk3MWY0NGI3ZTlhYjc1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLZW4gQnJvd24gPGticm93bkBjb3JuZWxsLmVkdT4KRGF0ZTog
VHVlLCAyMyBOb3YgMjAyMSAxMTo0MDo1NiAtMDUwMApTdWJqZWN0OiBbUEFUQ0hdIEN5Z3dpbjog
ZmhhbmRsZXJfZmlmbzo6cmF3X3JlYWQ6IGhhbmRsZSBTVEFUVVNfUEVORElORwoKTnRSZWFkRmls
ZSBjYW4gcmV0dXJuIFNUQVRVU19QRU5ESU5HIG9jY2FzaW9uYWxseSBldmVuIGluIG5vbi1ibG9j
a2luZwptb2RlLiAgQ2hlY2sgZm9yIHRoaXMgYW5kIHdhaXQgZm9yIE50UmVhZEZpbGUgdG8gY29t
cGxldGUuICBUbyBhdm9pZApjb2RlIHJlcGV0aXRpb24sIGRvIHRoaXMgaW4gYSBzdGF0aWMgaGVs
cGVyIGZ1bmN0aW9uIG50X3JlYWQuCi0tLQogd2luc3VwL2N5Z3dpbi9maGFuZGxlcl9maWZvLmNj
IHwgNzAgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQs
IDQ3IGluc2VydGlvbnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3dpbnN1cC9j
eWd3aW4vZmhhbmRsZXJfZmlmby5jYyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfZmlmby5jYwpp
bmRleCA0ODliYTUyOGMuLjM0YmQ4MzVhZSAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dpbi9maGFu
ZGxlcl9maWZvLmNjCisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfZmlmby5jYwpAQCAtMTIw
MSwxMiArMTIwMSwzOSBAQCBmaGFuZGxlcl9maWZvOjpyZWxlYXNlX3NlbGVjdF9zZW0gKGNvbnN0
IGNoYXIgKmZyb20pCiAgICAgUmVsZWFzZVNlbWFwaG9yZSAoc2VsZWN0X3NlbSwgbl9yZWxlYXNl
LCBOVUxMKTsKIH0KIAorLyogUmVhZCBmcm9tIGEgbm9uLWJsb2NraW5nIHBpcGUgYW5kIHdhaXQg
Zm9yIGNvbXBsZXRpb24uICovCitzdGF0aWMgTlRTVEFUVVMKK250X3JlYWQgKEhBTkRMRSBoLCBI
QU5ETEUgZXZ0LCBQSU9fU1RBVFVTX0JMT0NLIHBpbywgdm9pZCAqaW5fcHRyLCBzaXplX3QmIGxl
bikKK3sKKyAgTlRTVEFUVVMgc3RhdHVzOworCisgIFJlc2V0RXZlbnQgKGV2dCk7CisgIHN0YXR1
cyA9IE50UmVhZEZpbGUgKGgsIGV2dCwgTlVMTCwgTlVMTCwgcGlvLCBpbl9wdHIsIGxlbiwgTlVM
TCwgTlVMTCk7CisgIGlmIChzdGF0dXMgPT0gU1RBVFVTX1BFTkRJTkcpCisgICAgeworICAgICAg
LyogVmVyeSBzaG9ydC1saXZlZCAqLworICAgICAgc3RhdHVzID0gTnRXYWl0Rm9yU2luZ2xlT2Jq
ZWN0IChldnQsIEZBTFNFLCBOVUxMKTsKKyAgICAgIGlmIChOVF9TVUNDRVNTIChzdGF0dXMpKQor
CXN0YXR1cyA9IHBpby0+U3RhdHVzOworICAgIH0KKyAgcmV0dXJuIHN0YXR1czsKK30KKwogdm9p
ZCBfX3JlZzMKIGZoYW5kbGVyX2ZpZm86OnJhd19yZWFkICh2b2lkICppbl9wdHIsIHNpemVfdCYg
bGVuKQogeworICBIQU5ETEUgZXZ0OworCiAgIGlmICghbGVuKQogICAgIHJldHVybjsKIAorICBp
ZiAoIShldnQgPSBDcmVhdGVFdmVudCAoTlVMTCwgZmFsc2UsIGZhbHNlLCBOVUxMKSkpCisgICAg
eworICAgICAgX19zZXRlcnJubyAoKTsKKyAgICAgIGxlbiA9IChzaXplX3QpIC0xOworICAgICAg
cmV0dXJuOworICAgIH0KKwogICB3aGlsZSAoMSkKICAgICB7CiAgICAgICBpbnQgbmNvbm5lY3Rl
ZCA9IDA7CkBAIC0xMjQ0LDE3ICsxMjcxLDE1IEBAIGZoYW5kbGVyX2ZpZm86OnJhd19yZWFkICh2
b2lkICppbl9wdHIsIHNpemVfdCYgbGVuKQogCSAgTlRTVEFUVVMgc3RhdHVzOwogCSAgSU9fU1RB
VFVTX0JMT0NLIGlvOwogCi0JICBzdGF0dXMgPSBOdFJlYWRGaWxlIChmY19oYW5kbGVyW2pdLmgs
IE5VTEwsIE5VTEwsIE5VTEwsCi0JCQkgICAgICAgJmlvLCBpbl9wdHIsIGxlbiwgTlVMTCwgTlVM
TCk7CisJICBzdGF0dXMgPSBudF9yZWFkIChmY19oYW5kbGVyW2pdLmgsIGV2dCwgJmlvLCBpbl9w
dHIsIGxlbik7CiAJICBzd2l0Y2ggKHN0YXR1cykKIAkgICAgewogCSAgICBjYXNlIFNUQVRVU19T
VUNDRVNTOgogCSAgICBjYXNlIFNUQVRVU19CVUZGRVJfT1ZFUkZMT1c6Ci0JICAgICAgLyogaW8u
SW5mb3JtYXRpb24gaXMgc3VwcG9zZWRseSB2YWxpZCBpbiBsYXR0ZXIgY2FzZS4gKi8KIAkgICAg
ICBpZiAoaW8uSW5mb3JtYXRpb24gPiAwKQogCQl7CiAJCSAgbGVuID0gaW8uSW5mb3JtYXRpb247
Ci0JCSAgZ290byBvdXQ7CisJCSAgZ290byB1bmxvY2tfb3V0OwogCQl9CiAJICAgICAgYnJlYWs7
CiAJICAgIGNhc2UgU1RBVFVTX1BJUEVfRU1QVFk6CkBAIC0xMjY1LDcgKzEyOTAsNyBAQCBmaGFu
ZGxlcl9maWZvOjpyYXdfcmVhZCAodm9pZCAqaW5fcHRyLCBzaXplX3QmIGxlbikKIAkgICAgICBm
Y19oYW5kbGVyW2pdLnNldF9zdGF0ZSAoZmNfZGlzY29ubmVjdGVkKTsKIAkgICAgICBicmVhazsK
IAkgICAgZGVmYXVsdDoKLQkgICAgICBkZWJ1Z19wcmludGYgKCJOdFJlYWRGaWxlIHN0YXR1cyAl
eSIsIHN0YXR1cyk7CisJICAgICAgZGVidWdfcHJpbnRmICgibnRfcmVhZCBzdGF0dXMgJXkiLCBz
dGF0dXMpOwogCSAgICAgIGZjX2hhbmRsZXJbal0uc2V0X3N0YXRlIChmY19lcnJvcik7CiAJICAg
ICAgYnJlYWs7CiAJICAgIH0KQEAgLTEyNzgsOCArMTMwMyw3IEBAIGZoYW5kbGVyX2ZpZm86OnJh
d19yZWFkICh2b2lkICppbl9wdHIsIHNpemVfdCYgbGVuKQogCSAgICBOVFNUQVRVUyBzdGF0dXM7
CiAJICAgIElPX1NUQVRVU19CTE9DSyBpbzsKIAotCSAgICBzdGF0dXMgPSBOdFJlYWRGaWxlIChm
Y19oYW5kbGVyW2ldLmgsIE5VTEwsIE5VTEwsIE5VTEwsCi0JCQkJICZpbywgaW5fcHRyLCBsZW4s
IE5VTEwsIE5VTEwpOworCSAgICBzdGF0dXMgPSBudF9yZWFkIChmY19oYW5kbGVyW2ldLmgsIGV2
dCwgJmlvLCBpbl9wdHIsIGxlbik7CiAJICAgIHN3aXRjaCAoc3RhdHVzKQogCSAgICAgIHsKIAkg
ICAgICBjYXNlIFNUQVRVU19TVUNDRVNTOgpAQCAtMTI5MCw3ICsxMzE0LDcgQEAgZmhhbmRsZXJf
Zmlmbzo6cmF3X3JlYWQgKHZvaWQgKmluX3B0ciwgc2l6ZV90JiBsZW4pCiAJCSAgICBpZiAoaiA8
IG5oYW5kbGVycykKIAkJICAgICAgZmNfaGFuZGxlcltqXS5sYXN0X3JlYWQgPSBmYWxzZTsKIAkJ
ICAgIGZjX2hhbmRsZXJbaV0ubGFzdF9yZWFkID0gdHJ1ZTsKLQkJICAgIGdvdG8gb3V0OworCQkg
ICAgZ290byB1bmxvY2tfb3V0OwogCQkgIH0KIAkJYnJlYWs7CiAJICAgICAgY2FzZSBTVEFUVVNf
UElQRV9FTVBUWToKQEAgLTEzMDEsNyArMTMyNSw3IEBAIGZoYW5kbGVyX2ZpZm86OnJhd19yZWFk
ICh2b2lkICppbl9wdHIsIHNpemVfdCYgbGVuKQogCQlmY19oYW5kbGVyW2ldLnNldF9zdGF0ZSAo
ZmNfZGlzY29ubmVjdGVkKTsKIAkJYnJlYWs7CiAJICAgICAgZGVmYXVsdDoKLQkJZGVidWdfcHJp
bnRmICgiTnRSZWFkRmlsZSBzdGF0dXMgJXkiLCBzdGF0dXMpOworCQlkZWJ1Z19wcmludGYgKCJu
dF9yZWFkIHN0YXR1cyAleSIsIHN0YXR1cyk7CiAJCWZjX2hhbmRsZXJbaV0uc2V0X3N0YXRlIChm
Y19lcnJvcik7CiAJCWJyZWFrOwogCSAgICAgIH0KQEAgLTEzMTUsOCArMTMzOSw3IEBAIGZoYW5k
bGVyX2ZpZm86OnJhd19yZWFkICh2b2lkICppbl9wdHIsIHNpemVfdCYgbGVuKQogCSAgICBJT19T
VEFUVVNfQkxPQ0sgaW87CiAKIAkgICAgbmNvbm5lY3RlZCsrOwotCSAgICBzdGF0dXMgPSBOdFJl
YWRGaWxlIChmY19oYW5kbGVyW2ldLmgsIE5VTEwsIE5VTEwsIE5VTEwsCi0JCQkJICZpbywgaW5f
cHRyLCBsZW4sIE5VTEwsIE5VTEwpOworCSAgICBzdGF0dXMgPSBudF9yZWFkIChmY19oYW5kbGVy
W2ldLmgsIGV2dCwgJmlvLCBpbl9wdHIsIGxlbik7CiAJICAgIHN3aXRjaCAoc3RhdHVzKQogCSAg
ICAgIHsKIAkgICAgICBjYXNlIFNUQVRVU19TVUNDRVNTOgpAQCAtMTMyNyw3ICsxMzUwLDcgQEAg
ZmhhbmRsZXJfZmlmbzo6cmF3X3JlYWQgKHZvaWQgKmluX3B0ciwgc2l6ZV90JiBsZW4pCiAJCSAg
ICBpZiAoaiA8IG5oYW5kbGVycykKIAkJICAgICAgZmNfaGFuZGxlcltqXS5sYXN0X3JlYWQgPSBm
YWxzZTsKIAkJICAgIGZjX2hhbmRsZXJbaV0ubGFzdF9yZWFkID0gdHJ1ZTsKLQkJICAgIGdvdG8g
b3V0OworCQkgICAgZ290byB1bmxvY2tfb3V0OwogCQkgIH0KIAkJYnJlYWs7CiAJICAgICAgY2Fz
ZSBTVEFUVVNfUElQRV9FTVBUWToKQEAgLTEzMzcsMjUgKzEzNjAsMjUgQEAgZmhhbmRsZXJfZmlm
bzo6cmF3X3JlYWQgKHZvaWQgKmluX3B0ciwgc2l6ZV90JiBsZW4pCiAJCW5jb25uZWN0ZWQtLTsK
IAkJYnJlYWs7CiAJICAgICAgZGVmYXVsdDoKLQkJZGVidWdfcHJpbnRmICgiTnRSZWFkRmlsZSBz
dGF0dXMgJXkiLCBzdGF0dXMpOworCQlkZWJ1Z19wcmludGYgKCJudF9yZWFkIHN0YXR1cyAleSIs
IHN0YXR1cyk7CiAJCWZjX2hhbmRsZXJbaV0uc2V0X3N0YXRlIChmY19lcnJvcik7CiAJCW5jb25u
ZWN0ZWQtLTsKIAkJYnJlYWs7CiAJICAgICAgfQogCSAgfQotICAgICAgZmlmb19jbGllbnRfdW5s
b2NrICgpOwogICAgICAgaWYgKCFuY29ubmVjdGVkICYmIGhpdF9lb2YgKCkpCiAJewotCSAgcmVh
ZGluZ191bmxvY2sgKCk7CiAJICBsZW4gPSAwOwotCSAgcmV0dXJuOworCSAgZ290byB1bmxvY2tf
b3V0OwogCX0KKyAgICAgIGZpZm9fY2xpZW50X3VubG9jayAoKTsKIG1heWJlX3JldHJ5OgogICAg
ICAgcmVhZGluZ191bmxvY2sgKCk7CiAgICAgICBpZiAoaXNfbm9uYmxvY2tpbmcgKCkpCiAJewog
CSAgc2V0X2Vycm5vIChFQUdBSU4pOwotCSAgZ290byBlcnJvdXQ7CisJICBsZW4gPSAoc2l6ZV90
KSAtMTsKKwkgIGdvdG8gb3V0OwogCX0KICAgICAgIGVsc2UKIAl7CkBAIC0xMzcwLDcgKzEzOTMs
OCBAQCBtYXliZV9yZXRyeToKIAkgICAgICBlbHNlCiAJCXsKIAkJICBzZXRfZXJybm8gKEVJTlRS
KTsKLQkJICBnb3RvIGVycm91dDsKKwkJICBsZW4gPSAoc2l6ZV90KSAtMTsKKwkJICBnb3RvIG91
dDsKIAkJfQogCSAgICB9CiAJfQpAQCAtMTM3OCwxNyArMTQwMiwxNyBAQCBtYXliZV9yZXRyeToK
ICAgICAgIGlmIChpc2Nsb3NlZCAoKSkKIAl7CiAJICBzZXRfZXJybm8gKEVCQURGKTsKLQkgIGdv
dG8gZXJyb3V0OworCSAgbGVuID0gKHNpemVfdCkgLTE7CisJICBnb3RvIG91dDsKIAl9CiAgICAg
fQotZXJyb3V0OgotICBsZW4gPSAoc2l6ZV90KSAtMTsKLSAgcmV0dXJuOwotb3V0OgordW5sb2Nr
X291dDoKICAgZmlmb19jbGllbnRfdW5sb2NrICgpOwogICByZWFkaW5nX3VubG9jayAoKTsKK291
dDoKICAgaWYgKHNlbGVjdF9zZW0pCiAgICAgcmVsZWFzZV9zZWxlY3Rfc2VtICgicmF3X3JlYWQi
KTsKKyAgQ2xvc2VIYW5kbGUgKGV2dCk7CiB9CiAKIGludCBfX3JlZzIKLS0gCjIuMzMuMAoK

--------------8J0N9mhZTPZTl04i5qDXaEKX--
