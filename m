Return-Path: <cygwin-patches-return-8822-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 38765 invoked by alias); 18 Aug 2017 14:56:15 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Id: <cygwin-patches.cygwin.com>
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
Received: (qmail 36276 invoked by uid 89); 18 Aug 2017 14:56:14 -0000
Authentication-Results: sourceware.org; auth=none
X-Virus-Found: No
X-Spam-SWARE-Status: No, score=-25.8 required=5.0 tests=AWL,BAYES_00,GIT_PATCH_0,GIT_PATCH_1,GIT_PATCH_2,GIT_PATCH_3,RP_MATCHES_RCVD,SPF_HELO_PASS,SPF_PASS autolearn=ham version=3.3.2 spammy=
X-HELO: limerock04.mail.cornell.edu
Received: from limerock04.mail.cornell.edu (HELO limerock04.mail.cornell.edu) (128.84.13.244) by sourceware.org (qpsmtpd/0.93/v0.84-503-g423c35a) with ESMTP; Fri, 18 Aug 2017 14:56:10 +0000
X-CornellRouted: This message has been Routed already.
Received: from authusersmtp.mail.cornell.edu (granite3.serverfarm.cornell.edu [10.16.197.8])	by limerock04.mail.cornell.edu (8.14.4/8.14.4_cu) with ESMTP id v7IEu8eq024940	for <cygwin-patches@cygwin.com>; Fri, 18 Aug 2017 10:56:08 -0400
Received: from [192.168.0.4] (mta-68-175-129-7.twcny.rr.com [68.175.129.7] (may be forged))	(authenticated bits=0)	by authusersmtp.mail.cornell.edu (8.14.4/8.12.10) with ESMTP id v7IEu68U014535	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES128-SHA bits=128 verify=NOT)	for <cygwin-patches@cygwin.com>; Fri, 18 Aug 2017 10:56:07 -0400
Subject: Re: renameat2
To: cygwin-patches@cygwin.com
References: <992f81ea-736b-ebe3-2177-153b4d2e1852@cornell.edu> <7394aca1-ce7d-2a35-7d79-905da33cc100@redhat.com>
From: Ken Brown <kbrown@cornell.edu>
Message-ID: <00e1ca14-56a1-ff9c-7b83-489a583dad7a@cornell.edu>
Date: Sat, 19 Aug 2017 09:57:00 -0000
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Thunderbird/52.3.0
MIME-Version: 1.0
In-Reply-To: <7394aca1-ce7d-2a35-7d79-905da33cc100@redhat.com>
Content-Type: multipart/mixed; boundary="------------AC04E851B17DBFDD3964D7FB"
X-PMX-Cornell-Gauge: Gauge=XXXXX
X-PMX-CORNELL-AUTH-RESULTS: dkim-out=none;
X-IsSubscribed: yes
X-SW-Source: 2017-q3/txt/msg00024.txt.bz2

This is a multi-part message in MIME format.
--------------AC04E851B17DBFDD3964D7FB
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Transfer-Encoding: 7bit
Content-length: 400

On 8/18/2017 10:33 AM, Eric Blake wrote:
> Please only define RENAME_NOREPLACE for now; that way, software can
> probe what is defined to know what will work (defining a flag that will
> always be an error is not as useful as leaving it undefined - and while
> we may add RENAME_EXCHANGE support, I don't see how we can ever do
> RENAME_WHITEOUT).

Thanks for the feedback.  Revised patch attached.


--------------AC04E851B17DBFDD3964D7FB
Content-Type: text/plain; charset=UTF-8;
 name="0001-cygwin-Implement-renameat2.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="0001-cygwin-Implement-renameat2.patch"
Content-length: 7890

RnJvbSAxMzZiMGRmZDUzZTE0NzAwMmUxMzQwNDg2NThkMjBmNDUyNDAyYzlm
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBLZW4gQnJvd24gPGti
cm93bkBjb3JuZWxsLmVkdT4KRGF0ZTogVGh1LCAxNyBBdWcgMjAxNyAwOTox
MjoxNSAtMDQwMApTdWJqZWN0OiBbUEFUQ0hdIGN5Z3dpbjogSW1wbGVtZW50
IHJlbmFtZWF0MgoKRGVmaW5lIHRoZSBSRU5BTUVfTk9SRVBMQUNFIGZsYWcg
aW4gPGN5Z3dpbi9mcy5oPiBhcyBkZWZpbmVkIG9uIExpbnV4CmluIDxsaW51
eC9mcy5oPi4gIFRoZSBvdGhlciBSRU5BTUVfKiBmbGFncyBkZWZpbmVkIG9u
IExpbnV4IGFyZSBub3QKc3VwcG9ydGVkLgotLS0KIG5ld2xpYi9saWJjL2lu
Y2x1ZGUvc3RkaW8uaCAgICAgICAgICAgIHwgIDMgKysrCiB3aW5zdXAvY3ln
d2luL2NvbW1vbi5kaW4gICAgICAgICAgICAgICB8ICAxICsKIHdpbnN1cC9j
eWd3aW4vaW5jbHVkZS9jeWd3aW4vZnMuaCAgICAgIHwgIDYgKysrKysKIHdp
bnN1cC9jeWd3aW4vaW5jbHVkZS9jeWd3aW4vdmVyc2lvbi5oIHwgIDMgKyst
CiB3aW5zdXAvY3lnd2luL3N5c2NhbGxzLmNjICAgICAgICAgICAgICB8IDQx
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0KIDUgZmlsZXMg
Y2hhbmdlZCwgNDggaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9uZXdsaWIvbGliYy9pbmNsdWRlL3N0ZGlvLmggYi9uZXds
aWIvbGliYy9pbmNsdWRlL3N0ZGlvLmgKaW5kZXggNWQ4Y2IxMDkyLi4zMzFh
MWNmMDcgMTAwNjQ0Ci0tLSBhL25ld2xpYi9saWJjL2luY2x1ZGUvc3RkaW8u
aAorKysgYi9uZXdsaWIvbGliYy9pbmNsdWRlL3N0ZGlvLmgKQEAgLTM4NCw2
ICszODQsOSBAQCBpbnQJX0VYRlVOKHZkcHJpbnRmLCAoaW50LCBjb25zdCBj
aGFyICpfX3Jlc3RyaWN0LCBfX1ZBTElTVCkKICNlbmRpZgogI2lmIF9fQVRG
SUxFX1ZJU0lCTEUKIGludAlfRVhGVU4ocmVuYW1lYXQsIChpbnQsIGNvbnN0
IGNoYXIgKiwgaW50LCBjb25zdCBjaGFyICopKTsKKyMgaWZkZWYgX19DWUdX
SU5fXworaW50CV9FWEZVTihyZW5hbWVhdDIsIChpbnQsIGNvbnN0IGNoYXIg
KiwgaW50LCBjb25zdCBjaGFyICosIHVuc2lnbmVkIGludCkpOworIyBlbmRp
ZgogI2VuZGlmCiAKIC8qCmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2luL2Nv
bW1vbi5kaW4gYi93aW5zdXAvY3lnd2luL2NvbW1vbi5kaW4KaW5kZXggOGRh
NDMyYjhhLi5jYTZmZjNjZjkgMTAwNjQ0Ci0tLSBhL3dpbnN1cC9jeWd3aW4v
Y29tbW9uLmRpbgorKysgYi93aW5zdXAvY3lnd2luL2NvbW1vbi5kaW4KQEAg
LTExNjgsNiArMTE2OCw3IEBAIHJlbXF1b2YgTk9TSUdGRQogcmVtcXVvbCBO
T1NJR0ZFCiByZW5hbWUgU0lHRkUKIHJlbmFtZWF0IFNJR0ZFCityZW5hbWVh
dDIgU0lHRkUKIHJlc19jbG9zZSA9IF9fcmVzX2Nsb3NlIFNJR0ZFCiByZXNf
aW5pdCA9IF9fcmVzX2luaXQgU0lHRkUKIHJlc19ta3F1ZXJ5ID0gX19yZXNf
bWtxdWVyeSBTSUdGRQpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9pbmNs
dWRlL2N5Z3dpbi9mcy5oIGIvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dp
bi9mcy5oCmluZGV4IGY2MDZmZmMzOS4uNDhiMGNjYTQ1IDEwMDY0NAotLS0g
YS93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2ZzLmgKKysrIGIvd2lu
c3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi9mcy5oCkBAIC0xOSw0ICsxOSwx
MCBAQCBkZXRhaWxzLiAqLwogI2RlZmluZSBCTEtQQlNaR0VUICAgMHgwMDAw
MTI3YgogI2RlZmluZSBCTEtHRVRTSVpFNjQgMHgwMDA0MTI2OAogCisvKiBG
bGFncyBmb3IgcmVuYW1lYXQyLCBmcm9tIC91c3IvaW5jbHVkZS9saW51eC9m
cy5oLiAgRm9yIG5vdyB3ZQorICAgc3VwcG9ydCBvbmx5IFJFTkFNRV9OT1JF
UExBQ0UuICovCisjZGVmaW5lIFJFTkFNRV9OT1JFUExBQ0UgKDEgPDwgMCkK
Ky8qICNkZWZpbmUgUkVOQU1FX0VYQ0hBTkdFICAoMSA8PCAxKSAqLworLyog
I2RlZmluZSBSRU5BTUVfV0hJVEVPVVQgICgxIDw8IDIpICovCisKICNlbmRp
ZgpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi92
ZXJzaW9uLmggYi93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL3ZlcnNp
b24uaAppbmRleCBlZmQ0YWMwMTcuLjAzODRmNzdkYSAxMDA2NDQKLS0tIGEv
d2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi92ZXJzaW9uLmgKKysrIGIv
d2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi92ZXJzaW9uLmgKQEAgLTQ4
MSwxMiArNDgxLDEzIEBAIGRldGFpbHMuICovCiAgIDMxNDogRXhwb3J0IGV4
cGxpY2l0X2J6ZXJvLgogICAzMTU6IEV4cG9ydCBwdGhyZWFkX211dGV4X3Rp
bWVkbG9jay4KICAgMzE2OiBFeHBvcnQgcHRocmVhZF9yd2xvY2tfdGltZWRy
ZGxvY2ssIHB0aHJlYWRfcndsb2NrX3RpbWVkd3Jsb2NrLgorICAzMTc6IEV4
cG9ydCByZW5hbWVhdDIuICBBZGQgUkVOQU1FX05PUkVQTEFDRS4KIAogICBO
b3RlIHRoYXQgd2UgZm9yZ290IHRvIGJ1bXAgdGhlIGFwaSBmb3IgdWFsYXJt
LCBzdHJ0b2xsLCBzdHJ0b3VsbCwKICAgc2lnYWx0c3RhY2ssIHNldGhvc3Ru
YW1lLiAqLwogCiAjZGVmaW5lIENZR1dJTl9WRVJTSU9OX0FQSV9NQUpPUiAw
Ci0jZGVmaW5lIENZR1dJTl9WRVJTSU9OX0FQSV9NSU5PUiAzMTYKKyNkZWZp
bmUgQ1lHV0lOX1ZFUlNJT05fQVBJX01JTk9SIDMxNwogCiAvKiBUaGVyZSBp
cyBhbHNvIGEgY29tcGF0aWJpdHkgdmVyc2lvbiBudW1iZXIgYXNzb2NpYXRl
ZCB3aXRoIHRoZSBzaGFyZWQgbWVtb3J5CiAgICByZWdpb25zLiAgSXQgaXMg
aW5jcmVtZW50ZWQgd2hlbiBpbmNvbXBhdGlibGUgY2hhbmdlcyBhcmUgbWFk
ZSB0byB0aGUgc2hhcmVkCmRpZmYgLS1naXQgYS93aW5zdXAvY3lnd2luL3N5
c2NhbGxzLmNjIGIvd2luc3VwL2N5Z3dpbi9zeXNjYWxscy5jYwppbmRleCA4
ODU5MzE2MzIuLmQ3NTZmNWYzNSAxMDA2NDQKLS0tIGEvd2luc3VwL2N5Z3dp
bi9zeXNjYWxscy5jYworKysgYi93aW5zdXAvY3lnd2luL3N5c2NhbGxzLmNj
CkBAIC02MCw2ICs2MCw3IEBAIGRldGFpbHMuICovCiAjaW5jbHVkZSAidGxz
X3BidWYuaCIKICNpbmNsdWRlICJzeW5jLmgiCiAjaW5jbHVkZSAiY2hpbGRf
aW5mby5oIgorI2luY2x1ZGUgPGN5Z3dpbi9mcy5oPiAgLyogbmVlZGVkIGZv
ciBSRU5BTUVfTk9SRVBMQUNFICovCiAKICN1bmRlZiBfY2xvc2UKICN1bmRl
ZiBfbHNlZWsKQEAgLTIwNDgsOCArMjA0OSwxMiBAQCBudF9wYXRoX2hhc19l
eGVjdXRhYmxlX3N1ZmZpeCAoUFVOSUNPREVfU1RSSU5HIHVwYXRoKQogICBy
ZXR1cm4gZmFsc2U7CiB9CiAKLWV4dGVybiAiQyIgaW50Ci1yZW5hbWUgKGNv
bnN0IGNoYXIgKm9sZHBhdGgsIGNvbnN0IGNoYXIgKm5ld3BhdGgpCisvKiBJ
ZiBuZXdwYXRoIG5hbWVzIGFuIGV4aXN0aW5nIGZpbGUgYW5kIHRoZSBSRU5B
TUVfTk9SRVBMQUNFIGZsYWcgaXMKKyAgIHNwZWNpZmllZCwgZmFpbCB3aXRo
IEVFWElTVC4gIEV4Y2VwdGlvbjogRG9uJ3QgZmFpbCBpZiB0aGUgcHVycG9z
ZQorICAgb2YgdGhlIHJlbmFtZSBpcyBqdXN0IHRvIGNoYW5nZSB0aGUgY2Fz
ZSBvZiBvbGRwYXRoIG9uIGEKKyAgIGNhc2UtaW5zZW5zaXRpdmUgZmlsZSBz
eXN0ZW0uICovCitzdGF0aWMgaW50CityZW5hbWUyIChjb25zdCBjaGFyICpv
bGRwYXRoLCBjb25zdCBjaGFyICpuZXdwYXRoLCB1bnNpZ25lZCBpbnQgZmxh
Z3MpCiB7CiAgIHRtcF9wYXRoYnVmIHRwOwogICBpbnQgcmVzID0gLTE7CkBA
IC0yMDY4LDYgKzIwNzMsMTIgQEAgcmVuYW1lIChjb25zdCBjaGFyICpvbGRw
YXRoLCBjb25zdCBjaGFyICpuZXdwYXRoKQogCiAgIF9fdHJ5CiAgICAgewor
ICAgICAgaWYgKGZsYWdzICYgflJFTkFNRV9OT1JFUExBQ0UpCisJLyogUkVO
QU1FX05PUkVQTEFDRSBpcyB0aGUgb25seSBmbGFnIGN1cnJlbnRseSBzdXBw
b3J0ZWQuICovCisJeworCSAgc2V0X2Vycm5vIChFTk9UU1VQKTsKKwkgIF9f
bGVhdmU7CisJfQogICAgICAgaWYgKCEqb2xkcGF0aCB8fCAhKm5ld3BhdGgp
CiAJewogCSAgLyogUmVqZWN0IHJlbmFtZSgiIiwieCIpLCByZW5hbWUoIngi
LCIiKS4gICovCkBAIC0yMzM3LDYgKzIzNDgsMTMgQEAgcmVuYW1lIChjb25z
dCBjaGFyICpvbGRwYXRoLCBjb25zdCBjaGFyICpuZXdwYXRoKQogCSAgX19s
ZWF2ZTsKIAl9CiAKKyAgICAgIC8qIFNob3VsZCB3ZSByZXBsYWNlIGFuIGV4
aXN0aW5nIGZpbGU/ICovCisgICAgICBpZiAoKHJlbW92ZXBjIHx8IGRzdHBj
LT5leGlzdHMgKCkpICYmIChmbGFncyAmIFJFTkFNRV9OT1JFUExBQ0UpKQor
CXsKKwkgIHNldF9lcnJubyAoRUVYSVNUKTsKKwkgIF9fbGVhdmU7CisJfQor
CiAgICAgICAvKiBPcGVuaW5nIHRoZSBmaWxlIG11c3QgYmUgcGFydCBvZiB0
aGUgdHJhbnNhY3Rpb24uICBJdCdzIG5vdCBzdWZmaWNpZW50CiAJIHRvIGNh
bGwgb25seSBOdFNldEluZm9ybWF0aW9uRmlsZSB1bmRlciB0aGUgdHJhbnNh
Y3Rpb24uICBUaGVyZWZvcmUgd2UKIAkgaGF2ZSB0byBzdGFydCB0aGUgdHJh
bnNhY3Rpb24gaGVyZSwgaWYgbmVjZXNzYXJ5LiAqLwpAQCAtMjU3OCw2ICsy
NTk2LDEyIEBAIHJlbmFtZSAoY29uc3QgY2hhciAqb2xkcGF0aCwgY29uc3Qg
Y2hhciAqbmV3cGF0aCkKICAgcmV0dXJuIHJlczsKIH0KIAorZXh0ZXJuICJD
IiBpbnQKK3JlbmFtZSAoY29uc3QgY2hhciAqb2xkcGF0aCwgY29uc3QgY2hh
ciAqbmV3cGF0aCkKK3sKKyAgcmV0dXJuIHJlbmFtZTIgKG9sZHBhdGgsIG5l
d3BhdGgsIDApOworfQorCiBleHRlcm4gIkMiIGludAogc3lzdGVtIChjb25z
dCBjaGFyICpjbWRzdHJpbmcpCiB7CkBAIC00NzE5LDggKzQ3NDMsOCBAQCBy
ZWFkbGlua2F0IChpbnQgZGlyZmQsIGNvbnN0IGNoYXIgKl9fcmVzdHJpY3Qg
cGF0aG5hbWUsIGNoYXIgKl9fcmVzdHJpY3QgYnVmLAogfQogCiBleHRlcm4g
IkMiIGludAotcmVuYW1lYXQgKGludCBvbGRkaXJmZCwgY29uc3QgY2hhciAq
b2xkcGF0aG5hbWUsCi0JICBpbnQgbmV3ZGlyZmQsIGNvbnN0IGNoYXIgKm5l
d3BhdGhuYW1lKQorcmVuYW1lYXQyIChpbnQgb2xkZGlyZmQsIGNvbnN0IGNo
YXIgKm9sZHBhdGhuYW1lLAorCSAgIGludCBuZXdkaXJmZCwgY29uc3QgY2hh
ciAqbmV3cGF0aG5hbWUsIHVuc2lnbmVkIGludCBmbGFncykKIHsKICAgdG1w
X3BhdGhidWYgdHA7CiAgIF9fdHJ5CkBAIC00NzMxLDEzICs0NzU1LDIwIEBA
IHJlbmFtZWF0IChpbnQgb2xkZGlyZmQsIGNvbnN0IGNoYXIgKm9sZHBhdGhu
YW1lLAogICAgICAgY2hhciAqbmV3cGF0aCA9IHRwLmNfZ2V0ICgpOwogICAg
ICAgaWYgKGdlbl9mdWxsX3BhdGhfYXQgKG5ld3BhdGgsIG5ld2RpcmZkLCBu
ZXdwYXRobmFtZSkpCiAJX19sZWF2ZTsKLSAgICAgIHJldHVybiByZW5hbWUg
KG9sZHBhdGgsIG5ld3BhdGgpOworICAgICAgcmV0dXJuIHJlbmFtZTIgKG9s
ZHBhdGgsIG5ld3BhdGgsIGZsYWdzKTsKICAgICB9CiAgIF9fZXhjZXB0IChF
RkFVTFQpIHt9CiAgIF9fZW5kdHJ5CiAgIHJldHVybiAtMTsKIH0KIAorZXh0
ZXJuICJDIiBpbnQKK3JlbmFtZWF0IChpbnQgb2xkZGlyZmQsIGNvbnN0IGNo
YXIgKm9sZHBhdGhuYW1lLAorCSAgaW50IG5ld2RpcmZkLCBjb25zdCBjaGFy
ICpuZXdwYXRobmFtZSkKK3sKKyAgcmV0dXJuIHJlbmFtZWF0MiAob2xkZGly
ZmQsIG9sZHBhdGhuYW1lLCBuZXdkaXJmZCwgbmV3cGF0aG5hbWUsIDApOwor
fQorCiBleHRlcm4gIkMiIGludAogc2NhbmRpcmF0IChpbnQgZGlyZmQsIGNv
bnN0IGNoYXIgKnBhdGhuYW1lLCBzdHJ1Y3QgZGlyZW50ICoqKm5hbWVsaXN0
LAogCSAgIGludCAoKnNlbGVjdCkgKGNvbnN0IHN0cnVjdCBkaXJlbnQgKiks
Ci0tIAoyLjE0LjEKCg==

--------------AC04E851B17DBFDD3964D7FB--
