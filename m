Return-Path: <cygwin-patches-return-3632-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 21185 invoked by alias); 27 Feb 2003 12:27:31 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sources.redhat.com/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sources.redhat.com/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Received: (qmail 21176 invoked from network); 27 Feb 2003 12:27:31 -0000
X-Authentication-Warning: atacama.four-d.de: mail set sender to <tpfaff@gmx.net> using -f
Date: Thu, 27 Feb 2003 12:27:00 -0000
From: Thomas Pfaff <tpfaff@gmx.net>
To: cygwin-patches@cygwin.com
Subject: [PATCH]: Updated pthread_cond patch.
Message-ID: <Pine.WNT.4.44.0302271057100.285-400000@algeria.intern.net>
X-X-Sender: pfaff@antarctica.intern.net
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="3073274-21821-1046340774=:285"
Content-ID: <Pine.WNT.4.44.0302271326260.285@algeria.intern.net>
X-SW-Source: 2003-q1/txt/msg00281.txt.bz2

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--3073274-21821-1046340774=:285
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.WNT.4.44.0302271326261.285@algeria.intern.net>
Content-length: 1464


This is a slightly modified version of my still pending patch. The
modifications were made to support rwlocks.

2003-02-27  Thomas Pfaff  <tpfaff@gmx.net>

	* thread.h (pthread_cond::ExitingWait): Remove.
	(pthread_cond::mutex): Ditto.
	(pthread_cond::cond_access): Ditto.
	(pthread_cond::win32_obj_id): Ditto.
	(pthread_cond::TimedWait): Ditto.
	(pthread_cond::BroadCast): Ditto.
	(pthread_cond::Signal): Ditto.
	(pthread_cond::waiting): Change type to unsigned long.
	(pthread_cond::pending): New member.
	(pthread_cond::semWait): Ditto.
	(pthread_cond::mtxIn): Ditto.
	(pthread_cond::mtxOut): Ditto.
	(pthread_cond::mtxCond): Ditto.
	(pthread_cond::UnBlock): New method.
	(pthread_cond::Wait): Ditto.
	* thread.cc: Update list of cancellation points.
	(pthread_cond::pthread_cond): Rewrite.
	(pthread_cond::~pthread_cond): Ditto.
	(pthread_cond::TimedWait): Remove.
	(pthread_cond::BroadCast): Ditto.
	(pthread_cond::Signal): Ditto.
	(pthread_cond::UnBlock): Implement.
	(pthread_cond::Wait): Ditto.
	(pthread_cond::fixup_after_fork): Rewrite.
	(pthread_mutex::fixup_after_fork): Remove DETECT_BAD_APP
	conditional.
	(__pthread_cond_broadcast): Just return 0 if the condition is
	not initialized. Call pthread_cond::UnBlock to release blocked
	threads.
	(__pthread_cond_signal): Ditto.
	(__pthread_cond__dowait): Rewrite.
	(pthread_cond_timedwait): Add pthread_testcancel call. Fix
	waitlength calculation.
	(pthread_cond_wait): Add pthread_testcancel call.



--3073274-21821-1046340774=:285
Content-Type: TEXT/PLAIN; NAME="pthread_cond.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0302271112540.285@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="pthread_cond.patch"
Content-length: 21261

ZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi90aHJlYWQuY2Mgc3Jj
L3dpbnN1cC9jeWd3aW4vdGhyZWFkLmNjCi0tLSBzcmMub2xkL3dpbnN1cC9j
eWd3aW4vdGhyZWFkLmNjCTIwMDMtMDItMjcgMDk6MjU6NDkuMDAwMDAwMDAw
ICswMTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi90aHJlYWQuY2MJMjAwMy0w
Mi0yNyAwOToyODo0NC4wMDAwMDAwMDAgKzAxMDAKQEAgLTQ2Miw4ICs0NjIs
OCBAQCBvcGVuICgpCiAqcGF1c2UgKCkKIHBvbGwgKCkKIHByZWFkICgpCi1w
dGhyZWFkX2NvbmRfdGltZWR3YWl0ICgpCi1wdGhyZWFkX2NvbmRfd2FpdCAo
KQorKnB0aHJlYWRfY29uZF90aW1lZHdhaXQgKCkKKypwdGhyZWFkX2NvbmRf
d2FpdCAoKQogKnB0aHJlYWRfam9pbiAoKQogKnB0aHJlYWRfdGVzdGNhbmNl
bCAoKQogcHV0bXNnICgpCkBAIC04MTIsMzYgKzgxMiw1NyBAQCBwdGhyZWFk
X2NvbmQ6OmluaXRNdXRleCAoKQogICAgIGFwaV9mYXRhbCAoIkNvdWxkIG5v
dCBjcmVhdGUgd2luMzIgTXV0ZXggZm9yIHB0aHJlYWQgY29uZCBzdGF0aWMg
aW5pdGlhbGl6ZXIgc3VwcG9ydC4iKTsKIH0KIAotcHRocmVhZF9jb25kOjpw
dGhyZWFkX2NvbmQgKHB0aHJlYWRfY29uZGF0dHIgKmF0dHIpOnZlcmlmeWFi
bGVfb2JqZWN0IChQVEhSRUFEX0NPTkRfTUFHSUMpCitwdGhyZWFkX2NvbmQ6
OnB0aHJlYWRfY29uZCAocHRocmVhZF9jb25kYXR0ciAqYXR0cikgOgorICB2
ZXJpZnlhYmxlX29iamVjdCAoUFRIUkVBRF9DT05EX01BR0lDKSwKKyAgc2hh
cmVkICgwKSwgd2FpdGluZyAoMCksIHBlbmRpbmcgKDApLCBzZW1XYWl0IChO
VUxMKSwKKyAgbXR4Q29uZChOVUxMKSwgbmV4dCAoTlVMTCkKIHsKLSAgaW50
IHRlbXBlcnI7Ci0gIHRoaXMtPnNoYXJlZCA9IGF0dHIgPyBhdHRyLT5zaGFy
ZWQgOiBQVEhSRUFEX1BST0NFU1NfUFJJVkFURTsKLSAgdGhpcy0+bXV0ZXgg
PSBOVUxMOwotICB0aGlzLT53YWl0aW5nID0gMDsKLQotICB0aGlzLT53aW4z
Ml9vYmpfaWQgPSA6OkNyZWF0ZUV2ZW50ICgmc2VjX25vbmVfbmloLCBmYWxz
ZSwJLyogYXV0byBzaWduYWwgcmVzZXQgLSB3aGljaCBJIHRoaW5rIGlzIHB0
aHJlYWRzIGxpa2UgPyAqLwotCQkJCSAgICAgIGZhbHNlLAkvKiBzdGFydCBu
b24gc2lnbmFsZWQgKi8KLQkJCQkgICAgICBOVUxMIC8qIG5vIG5hbWUgKi8p
OwotICAvKiBUT0RPOiBtYWtlIGEgc2hhcmVkIG1lbSBtdXRleCBpZiBvdXQg
YXR0cmlidXRlcyByZXF1ZXN0IHNoYXJlZCBtZW0gY29uZCAqLwotICBjb25k
X2FjY2VzcyA9IE5VTEw7Ci0gIGlmICgodGVtcGVyciA9IHB0aHJlYWRfbXV0
ZXhfaW5pdCAoJnRoaXMtPmNvbmRfYWNjZXNzLCBOVUxMKSkpCisgIHB0aHJl
YWRfbXV0ZXggKnZlcmlmeWFibGVfbXV0ZXhfb2JqOworCisgIGlmIChhdHRy
KQorICAgIGlmIChhdHRyLT5zaGFyZWQgIT0gUFRIUkVBRF9QUk9DRVNTX1BS
SVZBVEUpCisgICAgICB7CisgICAgICAgIG1hZ2ljID0gMDsKKyAgICAgICAg
cmV0dXJuOworICAgICAgfQorCisgIHZlcmlmeWFibGVfbXV0ZXhfb2JqID0g
Jm10eEluOworICBpZiAoIXB0aHJlYWRfbXV0ZXg6OmlzR29vZE9iamVjdCAo
JnZlcmlmeWFibGVfbXV0ZXhfb2JqKSkKICAgICB7Ci0gICAgICBzeXN0ZW1f
cHJpbnRmICgiY291bGRuJ3QgaW5pdCBtdXRleCwgdGhpcyAlcCBlcnJubyAl
ZCIsIHRoaXMsIHRlbXBlcnIpOwotICAgICAgLyogd2UgbmVlZCB0aGUgbXV0
ZXggZm9yIGNvcnJlY3QgYmVoYXZpb3VyICovCisgICAgICB0aHJlYWRfcHJp
bnRmICgiSW50ZXJuYWwgY29uZCBtdXRleCBpcyBub3QgdmFsaWQuIHRoaXMg
JXAiLCB0aGlzKTsKICAgICAgIG1hZ2ljID0gMDsKKyAgICAgIHJldHVybjsK
KyAgICB9CisgIC8qIENoYW5nZSB0aGUgbXV0ZXggdHlwZSB0byBOT1JNQUwg
dG8gc3BlZWQgdXAgbXV0ZXggb3BlcmF0aW9ucyAqLworICBtdHhJbi50eXBl
ID0gUFRIUkVBRF9NVVRFWF9OT1JNQUw7CisKKyAgdmVyaWZ5YWJsZV9tdXRl
eF9vYmogPSAmbXR4T3V0OworICBpZiAoIXB0aHJlYWRfbXV0ZXg6OmlzR29v
ZE9iamVjdCAoJnZlcmlmeWFibGVfbXV0ZXhfb2JqKSkKKyAgICB7CisgICAg
ICB0aHJlYWRfcHJpbnRmICgiSW50ZXJuYWwgY29uZCBtdXRleCBpcyBub3Qg
dmFsaWQuIHRoaXMgJXAiLCB0aGlzKTsKKyAgICAgIG1hZ2ljID0gMDsKKyAg
ICAgIHJldHVybjsKKyAgICB9CisgIC8qIENoYW5nZSB0aGUgbXV0ZXggdHlw
ZSB0byBOT1JNQUwgdG8gc3BlZWQgdXAgbXV0ZXggb3BlcmF0aW9ucyAqLwor
ICBtdHhPdXQudHlwZSA9IFBUSFJFQURfTVVURVhfTk9STUFMOworCisgIHNl
bVdhaXQgPSA6OkNyZWF0ZVNlbWFwaG9yZSAoJnNlY19ub25lX25paCwgMCwg
TE9OR19NQVgsIE5VTEwpOworICBpZiAoIXNlbVdhaXQpCisgICAgeworICAg
ICAgZGVidWdfcHJpbnRmICgiQ3JlYXRlU2VtYXBob3JlIGZhaWxlZC4gJUUi
KTsKKyAgICAgIG1hZ2ljID0gMDsKKyAgICAgIHJldHVybjsKICAgICB9CiAK
LSAgaWYgKCF0aGlzLT53aW4zMl9vYmpfaWQpCi0gICAgbWFnaWMgPSAwOwog
ICAvKiB0aHJlYWRzYWZlIGFkZGl0aW9uIGlzIGVhc3kgKi8KICAgbmV4dCA9
IChwdGhyZWFkX2NvbmQgKikgSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIg
KCZNVF9JTlRFUkZBQ0UtPmNvbmRzLCB0aGlzKTsKIH0KIAogcHRocmVhZF9j
b25kOjp+cHRocmVhZF9jb25kICgpCiB7Ci0gIGlmICh3aW4zMl9vYmpfaWQp
Ci0gICAgQ2xvc2VIYW5kbGUgKHdpbjMyX29ial9pZCk7Ci0gIHB0aHJlYWRf
bXV0ZXhfZGVzdHJveSAoJmNvbmRfYWNjZXNzKTsKKyAgaWYgKHNlbVdhaXQp
CisgICAgQ2xvc2VIYW5kbGUgKHNlbVdhaXQpOworCiAgIC8qIEknbSBub3Qg
MTAwJSBzdXJlIHRoZSBuZXh0IGJpdCBpcyB0aHJlYWRzYWZlLiBJIHRoaW5r
IGl0IGlzLi4uICovCiAgIGlmIChNVF9JTlRFUkZBQ0UtPmNvbmRzID09IHRo
aXMpCiAgICAgSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZNVF9JTlRF
UkZBQ0UtPmNvbmRzLCB0aGlzLT5uZXh0KTsKQEAgLTg1NiwxMzIgKzg3Nywx
MjUgQEAgcHRocmVhZF9jb25kOjp+cHRocmVhZF9jb25kICgpCiB9CiAKIHZv
aWQKLXB0aHJlYWRfY29uZDo6QnJvYWRDYXN0ICgpCitwdGhyZWFkX2NvbmQ6
OlVuQmxvY2sgKGNvbnN0IGJvb2wgYWxsKQogewotICAvKiBUT0RPOiBpbXBs
ZW1lbnQgdGhlIHNhbWUgcmFjZSBmaXggYXMgU2lnbmFsIGhhcyAqLwotICBp
ZiAocHRocmVhZF9tdXRleF9sb2NrICgmY29uZF9hY2Nlc3MpKQotICAgIHN5
c3RlbV9wcmludGYgKCJGYWlsZWQgdG8gbG9jayBjb25kaXRpb24gdmFyaWFi
bGUgYWNjZXNzIG11dGV4LCB0aGlzICVwIiwgdGhpcyk7Ci0gIGludCBjb3Vu
dCA9IHdhaXRpbmc7Ci0gIGlmICghcHRocmVhZF9tdXRleDo6aXNHb29kT2Jq
ZWN0ICgmbXV0ZXgpKQotICAgIHsKLSAgICAgIGlmIChwdGhyZWFkX211dGV4
X3VubG9jayAoJmNvbmRfYWNjZXNzKSkKLQlzeXN0ZW1fcHJpbnRmICgiRmFp
bGVkIHRvIHVubG9jayBjb25kaXRpb24gdmFyaWFibGUgYWNjZXNzIG11dGV4
LCB0aGlzICVwIiwgdGhpcyk7Ci0gICAgICAvKiBUaGlzIGlzbid0IGFuZCBB
UEkgZXJyb3IgLSB1c2VycyBhcmUgYWxsb3dlZCB0byBjYWxsIHRoaXMgd2hl
biBubyB0aHJlYWRzCi0JIGFyZSB3YWl0aW5nCi0JIHN5c3RlbV9wcmludGYg
KCJCcm9hZGNhc3QgY2FsbGVkIHdpdGggaW52YWxpZCBtdXRleCIpOwotICAg
ICAgKi8KLSAgICAgIHJldHVybjsKLSAgICB9Ci0gIHdoaWxlIChjb3VudC0t
KQotICAgIFB1bHNlRXZlbnQgKHdpbjMyX29ial9pZCk7Ci0gIGlmIChwdGhy
ZWFkX211dGV4X3VubG9jayAoJmNvbmRfYWNjZXNzKSkKLSAgICBzeXN0ZW1f
cHJpbnRmICgiRmFpbGVkIHRvIHVubG9jayBjb25kaXRpb24gdmFyaWFibGUg
YWNjZXNzIG11dGV4LCB0aGlzICVwIiwgdGhpcyk7Ci19CisgIHVuc2lnbmVk
IGxvbmcgcmVsZWFzZWFibGU7CiAKLXZvaWQKLXB0aHJlYWRfY29uZDo6U2ln
bmFsICgpCi17Ci0gIGlmIChwdGhyZWFkX211dGV4X2xvY2sgKCZjb25kX2Fj
Y2VzcykpCi0gICAgc3lzdGVtX3ByaW50ZiAoIkZhaWxlZCB0byBsb2NrIGNv
bmRpdGlvbiB2YXJpYWJsZSBhY2Nlc3MgbXV0ZXgsIHRoaXMgJXAiLCB0aGlz
KTsKLSAgaWYgKCFwdGhyZWFkX211dGV4Ojppc0dvb2RPYmplY3QgKCZtdXRl
eCkpCi0gICAgewotICAgICAgaWYgKHB0aHJlYWRfbXV0ZXhfdW5sb2NrICgm
Y29uZF9hY2Nlc3MpKQotCXN5c3RlbV9wcmludGYgKCJGYWlsZWQgdG8gdW5s
b2NrIGNvbmRpdGlvbiB2YXJpYWJsZSBhY2Nlc3MgbXV0ZXgsIHRoaXMgJXAi
LAotCQkgICAgICAgdGhpcyk7Ci0gICAgICByZXR1cm47Ci0gICAgfQotICBp
bnQgdGVtcCA9IHdhaXRpbmc7Ci0gIGlmICghdGVtcCkKLSAgICAvKiBub3Ro
aW5nIHRvIHNpZ25hbCAqLwotICAgIHsKLSAgICAgIGlmIChwdGhyZWFkX211
dGV4X3VubG9jayAoJmNvbmRfYWNjZXNzKSkKLQlzeXN0ZW1fcHJpbnRmICgi
RmFpbGVkIHRvIHVubG9jayBjb25kaXRpb24gdmFyaWFibGUgYWNjZXNzIG11
dGV4LCB0aGlzICVwIiwgdGhpcyk7Ci0gICAgICByZXR1cm47Ci0gICAgfQot
ICAvKiBQcmltZSB0aGUgZGV0ZWN0aW9uIGZsYWcgKi8KLSAgRXhpdGluZ1dh
aXQgPSAxOwotICAvKiBTaWduYWwgYW55IHdhaXRpbmcgdGhyZWFkICovCi0g
IFB1bHNlRXZlbnQgKHdpbjMyX29ial9pZCk7Ci0gIC8qIE5vIG9uZSBjYW4g
c3RhcnQgd2FpdGluZyB1bnRpbCB3ZSByZWxlYXNlIHRoZSBjb25kaXRpb24g
YWNjZXNzIG11dGV4ICovCi0gIC8qIFRoZSByZWxlYXNlZCB0aHJlYWQgd2ls
bCBkZWNyZW1lbnQgd2FpdGluZyB3aGVuIGl0IGdldHMgYSB0aW1lIHNsaWNl
Li4uCi0gICAgIHdpdGhvdXQgd2FpdGluZyBmb3IgdGhlIGFjY2VzcyBtdXRl
eAotICAgKiBJbnRlckxvY2tlZEluY3JlbWVudCBvbiA5OCArLCBOVDQgKyBy
ZXR1cm5zIHRoZSBpbmNyZW1lbnRlZCB2YWx1ZS4KLSAgICogT24gOTUsIG50
IDMuNTEgPCBpdCByZXR1cm5zIGEgc2lnbiBjb3JyZWN0IG51bWJlciAtIDA9
MCwgKyBmb3IgZ3JlYXRlciB0aGFuIDAsIC0KLSAgICogZm9yIGxlc3MgdGhh
biAwLgotICAgKiBCZWNhdXNlIG9mIHRoaXMgd2UgY2Fubm90IHNwaW4gb24g
dGhlIHdhaXRpbmcgY291bnQsIGJ1dCByYXRoZXIgd2UgbmVlZCBhCi0gICAq
IGRlZGljYXRlZCBmbGFnIGZvciBhIHRocmVhZCBleGl0aW5nIHRoZSBXYWl0
IGZ1bmN0aW9uLgotICAgKiBBbHNvIG5vdCB0aGF0IEludGVybG9ja2VkKiBz
eW5jIENQVSBjYWNoZXMgd2l0aCBtZW1vcnkuCi0gICAqLwotICBpbnQgc3Bp
bnMgPSAxMDsKLSAgLyogV2hlbiBFeGl0aW5nV2FpdCBpcyBub256ZXJvIGFm
dGVyIGEgZGVjcmVtZW50LCB0aGUgbGVhdmluZyB0aHJlYWQgaGFzCi0gICAq
IGRvbmUgaXQncyB0aGluZworICAvKiAKKyAgICogQmxvY2sgb3V0Z29pbmcg
dGhyZWFkcyAoYW5kIGF2b2lkIHNpbXVsdGFub3VzIHVuYmxvY2tzKQogICAg
Ki8KLSAgd2hpbGUgKEludGVybG9ja2VkRGVjcmVtZW50ICgmRXhpdGluZ1dh
aXQpID09IDAgJiYgc3BpbnMpCisgIG10eE91dC5Mb2NrICgpOworCisgIHJl
bGVhc2VhYmxlID0gd2FpdGluZyAtIHBlbmRpbmc7CisgIGlmIChyZWxlYXNl
YWJsZSkKICAgICB7Ci0gICAgICBJbnRlcmxvY2tlZEluY3JlbWVudCAoJkV4
aXRpbmdXYWl0KTsKLSAgICAgIC8qIGdpdmUgdXAgdGhlIGNwdSB0byBmb3Jj
ZSBhIGNvbnRleHQgc3dpdGNoLiAqLwotICAgICAgbG93X3ByaW9yaXR5X3Ns
ZWVwICgwKTsKLSAgICAgIGlmIChzcGlucyA9PSA1KQotCS8qIHdlJ3ZlIGhh
ZCA1IHRpbWVzbGljZXMsIGFuZCB0aGUgd29rZW4gdGhyZWFkIHN0aWxsIGhh
c24ndCBkb25lIGl0J3MKLQkgKiB0aGluZyAtIG1heWJlIHdlIHJhY2VkIGl0
IHdpdGggdGhlIGV2ZW50PyAqLwotCVB1bHNlRXZlbnQgKHdpbjMyX29ial9p
ZCk7Ci0gICAgICBzcGlucy0tOworICAgICAgdW5zaWduZWQgbG9uZyByZWxl
YXNlZDsKKworICAgICAgaWYgKCFwZW5kaW5nKQorICAgICAgICB7CisgICAg
ICAgICAgLyogCisgICAgICAgICAgICogQmxvY2sgaW5jb21pbmcgdGhyZWFk
cyB1bnRpbCBhbGwgd2FpdGluZyB0aHJlYWRzIGFyZSByZWxlYXNlZC4KKyAg
ICAgICAgICAgKi8KKyAgICAgICAgICBtdHhJbi5Mb2NrICgpOworCisgICAg
ICAgICAgLyogCisgICAgICAgICAgICogQ2FsY3VsYXRlIHJlbGVhc2VhYmxl
IGFnYWluIGJlY2F1c2UgdGhyZWFkcyBjYW4gZW50ZXIgdW50aWwKKyAgICAg
ICAgICAgKiB0aGUgc2VtYXBob3JlIGhhcyBiZWVuIHRha2VuLCBidXQgdGhl
eSBjYW4gbm90IGxlYXZlLCB0aGVyZWZvcmUgcGVuZGluZworICAgICAgICAg
ICAqIGlzIHVuY2hhbmdlZCBhbmQgcmVsZWFzZWFibGUgY2FuIG9ubHkgZ2V0
IGhpZ2hlcgorICAgICAgICAgICAqLworICAgICAgICAgIHJlbGVhc2VhYmxl
ID0gd2FpdGluZyAtIHBlbmRpbmc7CisgICAgICAgIH0KKworICAgICAgcmVs
ZWFzZWQgPSBhbGwgPyByZWxlYXNlYWJsZSA6IDE7CisgICAgICBwZW5kaW5n
ICs9IHJlbGVhc2VkOworICAgICAgLyoKKyAgICAgICAqIFNpZ25hbCB0aHJl
YWRzCisgICAgICAgKi8KKyAgICAgIDo6UmVsZWFzZVNlbWFwaG9yZSAoc2Vt
V2FpdCwgcmVsZWFzZWQsIE5VTEwpOwogICAgIH0KLSAgaWYgKHdhaXRpbmcg
KyAxICE9IHRlbXApCi0gICAgc3lzdGVtX3ByaW50ZiAoIlJlbGVhc2VkIHRv
byBtYW55IHRocmVhZHMgLSAlZCBub3cgJWQgb3JpZ2luYWxseSIsIHdhaXRp
bmcsIHRlbXApOwotICBpZiAocHRocmVhZF9tdXRleF91bmxvY2sgKCZjb25k
X2FjY2VzcykpCi0gICAgc3lzdGVtX3ByaW50ZiAoIkZhaWxlZCB0byB1bmxv
Y2sgY29uZGl0aW9uIHZhcmlhYmxlIGFjY2VzcyBtdXRleCwgdGhpcyAlcCIs
IHRoaXMpOworCisgIC8qCisgICAqIEFuZCBsZXQgdGhlIHRocmVhZHMgcmVs
ZWFzZS4KKyAgICovCisgIG10eE91dC5VbkxvY2sgKCk7CiB9CiAKIGludAot
cHRocmVhZF9jb25kOjpUaW1lZFdhaXQgKERXT1JEIGR3TWlsbGlzZWNvbmRz
KQorcHRocmVhZF9jb25kOjpXYWl0IChwdGhyZWFkX211dGV4X3QgbXV0ZXgs
IERXT1JEIGR3TWlsbGlzZWNvbmRzKQogewogICBEV09SRCBydjsKIAotICAv
LyBGSVhNRTogcmFjZSBjb25kaXRpb24gKHBvdGVudGlhbGx5IGRyb3AgZXZl
bnRzCi0gIC8vIFBvc3NpYmxlIHNvbHV0aW9uIChzaW5nbGUgcHJvY2VzcyBv
bmx5KSAtIHBsYWNlIHRoaXMgaW4gYSBjcml0aWNhbCBzZWN0aW9uLgotICBt
dXRleC0+VW5Mb2NrICgpOwotICBydiA9IFdhaXRGb3JTaW5nbGVPYmplY3Qg
KHdpbjMyX29ial9pZCwgZHdNaWxsaXNlY29uZHMpOwotI2lmIDAKLSAgLyog
d2UgbmVlZCB0byB1c2UgbmF0aXZlIHdpbjMyIG11dGV4J3MgaGVyZSwgYmVj
YXVzZSB0aGUgY3lnd2luIG9uZXMgbm93IHVzZQotICAgKiBjcml0aWNhbCBz
ZWN0aW9ucywgd2hpY2ggYXJlIGZhc3RlciwgYnV0IGludHJvZHVjZSBhIHJh
Y2UgX2hlcmVfLiBVbnRpbCB0aGVuCi0gICAqIFRoZSBOVCB2YXJpYW50IG9m
IHRoZSBjb2RlIGlzIHJlZHVuZGFudC4KLSAgICovCi0KLSAgcnYgPSBTaWdu
YWxPYmplY3RBbmRXYWl0IChtdXRleC0+d2luMzJfb2JqX2lkLCB3aW4zMl9v
YmpfaWQsIGR3TWlsbGlzZWNvbmRzLAotCQkJICAgIGZhbHNlKTsKLSNlbmRp
ZgotICBzd2l0Y2ggKHJ2KQorICBtdHhJbi5Mb2NrICgpOworICBpZiAoMSA9
PSBJbnRlcmxvY2tlZEluY3JlbWVudCAoKGxvbmcgKikmd2FpdGluZykpCisg
ICAgbXR4Q29uZCA9IG11dGV4OworICBlbHNlIGlmIChtdHhDb25kICE9IG11
dGV4KQogICAgIHsKLSAgICBjYXNlIFdBSVRfRkFJTEVEOgotICAgICAgcmV0
dXJuIDA7CQkJLyogUE9TSVggZG9lc24ndCBhbGxvdyBlcnJvcnMgYWZ0ZXIg
d2UgbW9kaWZ5IHRoZSBtdXRleCBzdGF0ZSAqLwotICAgIGNhc2UgV0FJVF9B
QkFORE9ORUQ6Ci0gICAgY2FzZSBXQUlUX1RJTUVPVVQ6Ci0gICAgICByZXR1
cm4gRVRJTUVET1VUOwotICAgIGNhc2UgV0FJVF9PQkpFQ1RfMDoKLSAgICAg
IHJldHVybiAwOwkJCS8qIHdlIGhhdmUgYmVlbiBzaWduYWxlZCAqLwotICAg
IGRlZmF1bHQ6Ci0gICAgICByZXR1cm4gMDsKKyAgICAgIEludGVybG9ja2Vk
RGVjcmVtZW50ICgobG9uZyAqKSZ3YWl0aW5nKTsKKyAgICAgIG10eEluLlVu
TG9jayAoKTsKKyAgICAgIHJldHVybiBFSU5WQUw7CiAgICAgfQorICBtdHhJ
bi5VbkxvY2sgKCk7CisKKyAgLyoKKyAgICogUmVsZWFzZSB0aGUgbXV0ZXgg
YW5kIHdhaXQgb24gc2VtYXBob3JlCisgICAqLworICArK211dGV4LT5jb25k
d2FpdHM7CisgIG11dGV4LT5VbkxvY2sgKCk7CisKKyAgcnYgPSBwdGhyZWFk
OjpjYW5jZWxhYmxlX3dhaXQgKHNlbVdhaXQsIGR3TWlsbGlzZWNvbmRzLCBm
YWxzZSk7CisKKyAgbXR4T3V0LkxvY2sgKCk7CisgIAorICBpZiAocnYgIT0g
V0FJVF9PQkpFQ1RfMCkKKyAgICB7CisgICAgICAvKgorICAgICAgICogSXQg
bWlnaHQgaGFwcGVuIHRoYXQgYSBzaWduYWwgaXMgc2VudCB3aGlsZSB0aGUg
dGhyZWFkIGdvdCBjYW5jZWxlZAorICAgICAgICogb3IgdGltZWQgb3V0LiBU
cnkgdG8gdGFrZSBvbmUuCisgICAgICAgKiBJZiB0aGUgdGhyZWFkIGdldHMg
b25lIHRoYW4gYSBzaWduYWx8YnJvYWRjYXN0IGlzIGluIHByb2dyZXNzLgor
ICAgICAgICovIAorICAgICAgaWYgKFdBSVRfT0JKRUNUXzAgPT0gV2FpdEZv
clNpbmdsZU9iamVjdCAoc2VtV2FpdCwgMCkpCisgICAgICAgIC8qCisgICAg
ICAgICAqIHRocmVhZCBnb3QgY2FuY2VsbGVkIG90IHRpbWVkIG91dCB3aGls
ZSBhIHNpZ25hbGxpbmcgaXMgaW4gcHJvZ3Jlc3MuCisgICAgICAgICAqIFNl
dCB3YWl0IHJlc3VsdCBiYWNrIHRvIHNpZ25hbGVkCisgICAgICAgICAqLwor
ICAgICAgICBydiA9IFdBSVRfT0JKRUNUXzA7CisgICAgfQorCisgIEludGVy
bG9ja2VkRGVjcmVtZW50ICgobG9uZyAqKSZ3YWl0aW5nKTsKKworICBpZiAo
cnYgPT0gV0FJVF9PQkpFQ1RfMCAmJiAwID09IC0tcGVuZGluZykKKyAgICAv
KgorICAgICAqIEFsbCBzaWduYWxlZCB0aHJlYWRzIGFyZSByZWxlYXNlZCwK
KyAgICAgKiBuZXcgdGhyZWFkcyBjYW4gZW50ZXIgV2FpdAorICAgICAqLwor
ICAgIG10eEluLlVuTG9jayAoKTsKKworICBtdHhPdXQuVW5Mb2NrICgpOwor
IAorICBtdXRleC0+TG9jayAoKTsKKyAgLS1tdXRleC0+Y29uZHdhaXRzOwor
CisgIGlmIChydiA9PSBXQUlUX0NBTkNFTEVEKQorICAgIHB0aHJlYWQ6OnN0
YXRpY19jYW5jZWxfc2VsZiAoKTsKKyAgZWxzZSBpZiAocnYgPT0gV0FJVF9U
SU1FT1VUKQorICAgIHJldHVybiBFVElNRURPVVQ7CisKKyAgcmV0dXJuIDA7
CiB9CiAKIHZvaWQKIHB0aHJlYWRfY29uZDo6Zml4dXBfYWZ0ZXJfZm9yayAo
KQogewotICBkZWJ1Z19wcmludGYgKCJjb25kICV4IGluIGZpeHVwX2FmdGVy
X2ZvcmsiLCB0aGlzKTsKLSAgaWYgKHNoYXJlZCAhPSBQVEhSRUFEX1BST0NF
U1NfUFJJVkFURSkKLSAgICBhcGlfZmF0YWwgKCJkb2Vzbid0IHVuZGVyc3Rh
bmQgUFJPQ0VTU19TSEFSRUQgY29uZGl0aW9uIHZhcmlhYmxlcyIpOwotICAv
KiBGSVhNRTogZHVwbGljYXRlIGNvZGUgaGVyZSBhbmQgaW4gdGhlIGNvbnN0
cnVjdG9yLiAqLwotICB0aGlzLT53aW4zMl9vYmpfaWQgPSA6OkNyZWF0ZUV2
ZW50ICgmc2VjX25vbmVfbmloLCBmYWxzZSwgZmFsc2UsIE5VTEwpOwotICBp
ZiAoIXdpbjMyX29ial9pZCkKLSAgICBhcGlfZmF0YWwgKCJmYWlsZWQgdG8g
Y3JlYXRlIG5ldyB3aW4zMiBtdXRleCIpOwotI2lmIERFVEVDVF9CQURfQVBQ
UwotICBpZiAod2FpdGluZykKLSAgICBhcGlfZmF0YWwgKCJGb3JrZWQgKCkg
d2hpbGUgYSBjb25kaXRpb24gdmFyaWFibGUgaGFzIHdhaXRpbmcgdGhyZWFk
cy5cblJlcG9ydCB0byBjeWd3aW5AY3lnd2luLmNvbSIpOwotI2Vsc2UKLSAg
d2FpdGluZyA9IDA7Ci0gIG11dGV4ID0gTlVMTDsKLSNlbmRpZgorICB3YWl0
aW5nID0gcGVuZGluZyA9IDA7CisgIG10eENvbmQgPSBOVUxMOworCisgIC8q
IFVubG9jayBldmVudHVhbGx5IGxvY2tlZCBtdXRleGVzICovCisgIG10eElu
LlVuTG9jayAoKTsKKyAgbXR4T3V0LlVuTG9jayAoKTsKKworICBzZW1XYWl0
ID0gOjpDcmVhdGVTZW1hcGhvcmUgKCZzZWNfbm9uZV9uaWgsIDAsIExPTkdf
TUFYLCBOVUxMKTsKKyAgaWYgKCFzZW1XYWl0KQorICAgIGFwaV9mYXRhbCAo
InB0aHJlYWRfY29uZDo6Zml4dXBfYWZ0ZXJfZm9yayAoKSBmYWlsZWQgdG8g
cmVjcmVhdGUgd2luMzIgc2VtYXBob3JlIik7CiB9CiAKIC8qIHB0aHJlYWRf
a2V5ICovCkBAIC0xMzI1LDEyICsxMzM5LDcgQEAgcHRocmVhZF9tdXRleDo6
Zml4dXBfYWZ0ZXJfZm9yayAoKQogICBpZiAoIXdpbjMyX29ial9pZCkKICAg
ICBhcGlfZmF0YWwgKCJwdGhyZWFkX211dGV4OjpmaXh1cF9hZnRlcl9mb3Jr
ICgpIGZhaWxlZCB0byByZWNyZWF0ZSB3aW4zMiBzZW1hcGhvcmUgZm9yIG11
dGV4Iik7CiAKLSNpZiBERVRFQ1RfQkFEX0FQUFMKLSAgaWYgKGNvbmR3YWl0
cykKLSAgICBhcGlfZmF0YWwgKCJGb3JrZWQgKCkgd2hpbGUgYSBtdXRleCBo
YXMgY29uZGl0aW9uIHZhcmlhYmxlcyB3YWl0aW5nIG9uIGl0LlxuUmVwb3J0
IHRvIGN5Z3dpbkBjeWd3aW4uY29tIik7Ci0jZWxzZQogICBjb25kd2FpdHMg
PSAwOwotI2VuZGlmCiB9CiAKIGJvb2wKQEAgLTIxNjgsMTEgKzIxNzcsMTEg
QEAgaW50CiBfX3B0aHJlYWRfY29uZF9icm9hZGNhc3QgKHB0aHJlYWRfY29u
ZF90ICpjb25kKQogewogICBpZiAocHRocmVhZF9jb25kOjppc0dvb2RJbml0
aWFsaXplciAoY29uZCkpCi0gICAgcHRocmVhZF9jb25kOjppbml0IChjb25k
LCBOVUxMKTsKKyAgICByZXR1cm4gMDsKICAgaWYgKCFwdGhyZWFkX2NvbmQ6
OmlzR29vZE9iamVjdCAoY29uZCkpCiAgICAgcmV0dXJuIEVJTlZBTDsKIAot
ICAoKmNvbmQpLT5Ccm9hZENhc3QgKCk7CisgICgqY29uZCktPlVuQmxvY2sg
KHRydWUpOwogCiAgIHJldHVybiAwOwogfQpAQCAtMjE4MSw4MiArMjE5MCw0
NyBAQCBpbnQKIF9fcHRocmVhZF9jb25kX3NpZ25hbCAocHRocmVhZF9jb25k
X3QgKmNvbmQpCiB7CiAgIGlmIChwdGhyZWFkX2NvbmQ6OmlzR29vZEluaXRp
YWxpemVyIChjb25kKSkKLSAgICBwdGhyZWFkX2NvbmQ6OmluaXQgKGNvbmQs
IE5VTEwpOworICAgIHJldHVybiAwOwogICBpZiAoIXB0aHJlYWRfY29uZDo6
aXNHb29kT2JqZWN0IChjb25kKSkKICAgICByZXR1cm4gRUlOVkFMOwogCi0g
ICgqY29uZCktPlNpZ25hbCAoKTsKKyAgKCpjb25kKS0+VW5CbG9jayAoZmFs
c2UpOwogCiAgIHJldHVybiAwOwogfQogCi1pbnQKK3N0YXRpYyBpbnQKIF9f
cHRocmVhZF9jb25kX2Rvd2FpdCAocHRocmVhZF9jb25kX3QgKmNvbmQsIHB0
aHJlYWRfbXV0ZXhfdCAqbXV0ZXgsCi0JCSAgICAgICBsb25nIHdhaXRsZW5n
dGgpCisJCSAgICAgICBEV09SRCB3YWl0bGVuZ3RoKQogewotLy8gYW5kIHll
cyBjb25kX2FjY2VzcyBoZXJlIGlzIHN0aWxsIG9wZW4gdG8gYSByYWNlLiAo
d2UgaW5jcmVtZW50LCBjb250ZXh0IHN3YXAsCi0vLyBicm9hZGNhc3Qgb2Nj
dXJzIC0gIHdlIG1pc3MgdGhlIGJyb2FkY2FzdC4gdGhlIGZ1bmN0aW9ucyBh
cmVuJ3Qgc3BsaXQgcHJvcGVybHkuCi0gIGludCBydjsKLSAgcHRocmVhZF9t
dXRleCAqKnRoZW11dGV4ID0gTlVMTDsKLSAgaWYgKHB0aHJlYWRfbXV0ZXg6
OmlzR29vZEluaXRpYWxpemVyIChtdXRleCkpCi0gICAgcHRocmVhZF9tdXRl
eDo6aW5pdCAobXV0ZXgsIE5VTEwpOwotICB0aGVtdXRleCA9IG11dGV4Owor
ICBpZiAoIXB0aHJlYWRfbXV0ZXg6OmlzR29vZE9iamVjdCAobXV0ZXgpKQor
ICAgIHJldHVybiBFSU5WQUw7CisgIGlmICghcHRocmVhZF9tdXRleDo6Y2Fu
QmVVbmxvY2tlZCAobXV0ZXgpKQorICAgIHJldHVybiBFUEVSTTsKKwogICBp
ZiAocHRocmVhZF9jb25kOjppc0dvb2RJbml0aWFsaXplciAoY29uZCkpCiAg
ICAgcHRocmVhZF9jb25kOjppbml0IChjb25kLCBOVUxMKTsKLQotICBpZiAo
IXB0aHJlYWRfbXV0ZXg6OmlzR29vZE9iamVjdCAodGhlbXV0ZXgpKQotICAg
IHJldHVybiBFSU5WQUw7CiAgIGlmICghcHRocmVhZF9jb25kOjppc0dvb2RP
YmplY3QgKGNvbmQpKQogICAgIHJldHVybiBFSU5WQUw7CiAKLSAgLyogaWYg
dGhlIGNvbmQgdmFyaWFibGUgaXMgYmxvY2tlZCwgdGhlbiB0aGUgYWJvdmUg
dGltZXIgdGVzdCBtYXliZSB3cm9uZy4gKnNocnVnKiovCi0gIGlmIChwdGhy
ZWFkX211dGV4X2xvY2sgKCYoKmNvbmQpLT5jb25kX2FjY2VzcykpCi0gICAg
c3lzdGVtX3ByaW50ZiAoIkZhaWxlZCB0byBsb2NrIGNvbmRpdGlvbiB2YXJp
YWJsZSBhY2Nlc3MgbXV0ZXgsIHRoaXMgJXAiLCAqY29uZCk7Ci0KLSAgaWYg
KCgqY29uZCktPndhaXRpbmcpCi0gICAgaWYgKCgqY29uZCktPm11dGV4ICYm
ICgoKmNvbmQpLT5tdXRleCAhPSAoKnRoZW11dGV4KSkpCi0gICAgICB7Ci0J
aWYgKHB0aHJlYWRfbXV0ZXhfdW5sb2NrICgmKCpjb25kKS0+Y29uZF9hY2Nl
c3MpKQotCSAgc3lzdGVtX3ByaW50ZiAoIkZhaWxlZCB0byB1bmxvY2sgY29u
ZGl0aW9uIHZhcmlhYmxlIGFjY2VzcyBtdXRleCwgdGhpcyAlcCIsICpjb25k
KTsKLQlyZXR1cm4gRUlOVkFMOwotICAgICAgfQotICBJbnRlcmxvY2tlZElu
Y3JlbWVudCAoJigoKmNvbmQpLT53YWl0aW5nKSk7Ci0KLSAgKCpjb25kKS0+
bXV0ZXggPSAoKnRoZW11dGV4KTsKLSAgSW50ZXJsb2NrZWRJbmNyZW1lbnQg
KCYoKCp0aGVtdXRleCktPmNvbmR3YWl0cykpOwotICBpZiAocHRocmVhZF9t
dXRleF91bmxvY2sgKCYoKmNvbmQpLT5jb25kX2FjY2VzcykpCi0gICAgc3lz
dGVtX3ByaW50ZiAoIkZhaWxlZCB0byB1bmxvY2sgY29uZGl0aW9uIHZhcmlh
YmxlIGFjY2VzcyBtdXRleCwgdGhpcyAlcCIsICpjb25kKTsKLSAgLyogQXQg
dGhpcyBwb2ludCBjYWxscyB0byBTaWduYWwgd2lsbCBwcm9ncmVzcyBldmVi
biBpZiB3ZSBhcmVuJyB5ZXQgd2FpdGluZwotICAgICBIb3dldmVyLCB0aGUg
bG9vcCB0aGVyZSBzaG91bGQgYWxsb3cgdXMgdG8gZ2V0IHNjaGVkdWxlZCBh
bmQgY2FsbCB3YWl0LAotICAgICBhbmQgaGF2ZSB0aGVtIGNhbGwgUHVsc2VF
dmVudCBhZ2FpbiBpZiB3ZSBkb250JyByZXNwb25kLiAgKi8KLSAgcnYgPSAo
KmNvbmQpLT5UaW1lZFdhaXQgKHdhaXRsZW5ndGgpOwotICAvKiB0aGlzIG1h
eSBhbGxvdyBhIHJhY2Ugb24gdGhlIG11dGV4IGFjcXVpc2l0aW9uIGFuZCB3
YWl0cy4KLSAgICAgQnV0IGRvaW5nIHRoaXMgd2l0aGluIHRoZSBjb25kIGFj
Y2VzcyBtdXRleCBjcmVhdGVzIGEgZGlmZmVyZW50IHJhY2UgKi8KLSAgSW50
ZXJsb2NrZWREZWNyZW1lbnQgKCYoKCpjb25kKS0+d2FpdGluZykpOwotICAv
KiBUZWxsIFNpZ25hbCB0aGF0IHdlIGhhdmUgYmVlbiByZWxlYXNlZCAqLwot
ICBJbnRlcmxvY2tlZERlY3JlbWVudCAoJigoKmNvbmQpLT5FeGl0aW5nV2Fp
dCkpOwotICAoKnRoZW11dGV4KS0+TG9jayAoKTsKLSAgaWYgKHB0aHJlYWRf
bXV0ZXhfbG9jayAoJigqY29uZCktPmNvbmRfYWNjZXNzKSkKLSAgICBzeXN0
ZW1fcHJpbnRmICgiRmFpbGVkIHRvIGxvY2sgY29uZGl0aW9uIHZhcmlhYmxl
IGFjY2VzcyBtdXRleCwgdGhpcyAlcCIsICpjb25kKTsKLSAgaWYgKCgqY29u
ZCktPndhaXRpbmcgPT0gMCkKLSAgICAoKmNvbmQpLT5tdXRleCA9IE5VTEw7
Ci0gIEludGVybG9ja2VkRGVjcmVtZW50ICgmKCgqdGhlbXV0ZXgpLT5jb25k
d2FpdHMpKTsKLSAgaWYgKHB0aHJlYWRfbXV0ZXhfdW5sb2NrICgmKCpjb25k
KS0+Y29uZF9hY2Nlc3MpKQotICAgIHN5c3RlbV9wcmludGYgKCJGYWlsZWQg
dG8gdW5sb2NrIGNvbmRpdGlvbiB2YXJpYWJsZSBhY2Nlc3MgbXV0ZXgsIHRo
aXMgJXAiLCAqY29uZCk7Ci0KLSAgcmV0dXJuIHJ2OworICByZXR1cm4gKCpj
b25kKS0+V2FpdCAoKm11dGV4LCB3YWl0bGVuZ3RoKTsKIH0KIAogZXh0ZXJu
ICJDIiBpbnQKIHB0aHJlYWRfY29uZF90aW1lZHdhaXQgKHB0aHJlYWRfY29u
ZF90ICpjb25kLCBwdGhyZWFkX211dGV4X3QgKm11dGV4LAogCQkJY29uc3Qg
c3RydWN0IHRpbWVzcGVjICphYnN0aW1lKQogeworICBzdHJ1Y3QgdGltZXZh
bCB0djsKKyAgbG9uZyB3YWl0bGVuZ3RoOworCisgIHB0aHJlYWRfdGVzdGNh
bmNlbCAoKTsKKwogICBpZiAoY2hlY2tfdmFsaWRfcG9pbnRlciAoYWJzdGlt
ZSkpCiAgICAgcmV0dXJuIEVJTlZBTDsKLSAgc3RydWN0IHRpbWViIGN1cnJT
eXNUaW1lOwotICBsb25nIHdhaXRsZW5ndGg7Ci0gIGZ0aW1lICgmY3VyclN5
c1RpbWUpOwotICB3YWl0bGVuZ3RoID0gKGFic3RpbWUtPnR2X3NlYyAtIGN1
cnJTeXNUaW1lLnRpbWUpICogMTAwMDsKKworICBnZXR0aW1lb2ZkYXkgKCZ0
diwgTlVMTCk7CisgIHdhaXRsZW5ndGggPSBhYnN0aW1lLT50dl9zZWMgKiAx
MDAwICsgYWJzdGltZS0+dHZfbnNlYyAvICgxMDAwICogMTAwMCk7CisgIHdh
aXRsZW5ndGggLT0gdHYudHZfc2VjICogMTAwMCArIHR2LnR2X3VzZWMgLyAx
MDAwOwogICBpZiAod2FpdGxlbmd0aCA8IDApCiAgICAgcmV0dXJuIEVUSU1F
RE9VVDsKICAgcmV0dXJuIF9fcHRocmVhZF9jb25kX2Rvd2FpdCAoY29uZCwg
bXV0ZXgsIHdhaXRsZW5ndGgpOwpAQCAtMjI2NSw2ICsyMjM5LDggQEAgcHRo
cmVhZF9jb25kX3RpbWVkd2FpdCAocHRocmVhZF9jb25kX3QgKgogZXh0ZXJu
ICJDIiBpbnQKIHB0aHJlYWRfY29uZF93YWl0IChwdGhyZWFkX2NvbmRfdCAq
Y29uZCwgcHRocmVhZF9tdXRleF90ICptdXRleCkKIHsKKyAgcHRocmVhZF90
ZXN0Y2FuY2VsICgpOworCiAgIHJldHVybiBfX3B0aHJlYWRfY29uZF9kb3dh
aXQgKGNvbmQsIG11dGV4LCBJTkZJTklURSk7CiB9CiAKZGlmZiAtdXJwIHNy
Yy5vbGQvd2luc3VwL2N5Z3dpbi90aHJlYWQuaCBzcmMvd2luc3VwL2N5Z3dp
bi90aHJlYWQuaAotLS0gc3JjLm9sZC93aW5zdXAvY3lnd2luL3RocmVhZC5o
CTIwMDMtMDItMjcgMDk6MjU6NDkuMDAwMDAwMDAwICswMTAwCisrKyBzcmMv
d2luc3VwL2N5Z3dpbi90aHJlYWQuaAkyMDAzLTAyLTI3IDA5OjI3OjM2LjAw
MDAwMDAwMCArMDEwMApAQCAtNDk0LDE2ICs0OTQsMjAgQEAgcHVibGljOgog
ICBzdGF0aWMgaW50IGluaXQgKHB0aHJlYWRfY29uZF90ICosIGNvbnN0IHB0
aHJlYWRfY29uZGF0dHJfdCAqKTsKIAogICBpbnQgc2hhcmVkOwotICBMT05H
IHdhaXRpbmc7Ci0gIExPTkcgRXhpdGluZ1dhaXQ7Ci0gIHB0aHJlYWRfbXV0
ZXggKm11dGV4OwotICAvKiB0byBhbGxvdyBhdG9taWMgYmVoYXZpb3VyIGZv
ciBjb25kX2Jyb2FkY2FzdCAqLwotICBwdGhyZWFkX211dGV4X3QgY29uZF9h
Y2Nlc3M7Ci0gIEhBTkRMRSB3aW4zMl9vYmpfaWQ7CisKKyAgdW5zaWduZWQg
bG9uZyB3YWl0aW5nOworICB1bnNpZ25lZCBsb25nIHBlbmRpbmc7CisgIEhB
TkRMRSBzZW1XYWl0OworCisgIHB0aHJlYWRfbXV0ZXggbXR4SW47CisgIHB0
aHJlYWRfbXV0ZXggbXR4T3V0OworCisgIHB0aHJlYWRfbXV0ZXhfdCBtdHhD
b25kOworCiAgIGNsYXNzIHB0aHJlYWRfY29uZCAqIG5leHQ7Ci0gIGludCBU
aW1lZFdhaXQgKERXT1JEIGR3TWlsbGlzZWNvbmRzKTsKLSAgdm9pZCBCcm9h
ZENhc3QgKCk7Ci0gIHZvaWQgU2lnbmFsICgpOworCisgIHZvaWQgVW5CbG9j
ayAoY29uc3QgYm9vbCBhbGwpOworICBpbnQgV2FpdCAocHRocmVhZF9tdXRl
eF90IG11dGV4LCBEV09SRCBkd01pbGxpc2Vjb25kcyA9IElORklOSVRFKTsK
ICAgdm9pZCBmaXh1cF9hZnRlcl9mb3JrICgpOwogCiAgIHB0aHJlYWRfY29u
ZCAocHRocmVhZF9jb25kYXR0ciAqKTsK

--3073274-21821-1046340774=:285
Content-Type: TEXT/PLAIN; NAME="condvar9.c"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0302271112541.285@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="condvar9.c"
Content-length: 6027

LyoKICogRmlsZTogY29uZHZhcjkuYwogKgogKgogKiBUZXN0IFN5bm9wc2lz
OgogKiAtIFRlc3QgbXVsdGlwbGUgcHRocmVhZF9jb25kX2Jyb2FkY2FzdHMg
d2l0aCB0aHJlYWQgY2FuY2VsYXRpb24uCiAqCiAqIFRlc3QgTWV0aG9kIChW
YWxpZGF0aW9uIG9yIEZhbHNpZmljYXRpb24pOgogKiAtIFZhbGlkYXRpb24K
ICoKICogUmVxdWlyZW1lbnRzIFRlc3RlZDoKICogLSAKICoKICogRmVhdHVy
ZXMgVGVzdGVkOgogKiAtIAogKgogKiBDYXNlcyBUZXN0ZWQ6CiAqIC0gCiAq
CiAqIERlc2NyaXB0aW9uOgogKiAtIE1ha2UgTlVNVEhSRUFEUyB0aHJlYWRz
IHdhaXQgb24gQ1YsIGNhbmNlbCBvbmUsIGJyb2FkY2FzdCBzaWduYWwgdGhl
bSwKICogICBhbmQgdGhlbiByZXBlYXQuCiAqCiAqIEVudmlyb25tZW50Ogog
KiAtIAogKgogKiBJbnB1dDoKICogLSBOb25lLgogKgogKiBPdXRwdXQ6CiAq
IC0gRmlsZSBuYW1lLCBMaW5lIG51bWJlciwgYW5kIGZhaWxlZCBleHByZXNz
aW9uIG9uIGZhaWx1cmUuCiAqIC0gTm8gb3V0cHV0IG9uIHN1Y2Nlc3MuCiAq
CiAqIEFzc3VtcHRpb25zOgogKiAtIAogKgogKiBQYXNzIENyaXRlcmlhOgog
KiAtIFByb2Nlc3MgcmV0dXJucyB6ZXJvIGV4aXQgc3RhdHVzLgogKgogKiBG
YWlsIENyaXRlcmlhOgogKiAtIFByb2Nlc3MgcmV0dXJucyBub24temVybyBl
eGl0IHN0YXR1cy4KICovCgojaW5jbHVkZSAidGVzdC5oIgojaW5jbHVkZSA8
c3lzL3RpbWViLmg+CgovKgogKiBDcmVhdGUgTlVNVEhSRUFEUyB0aHJlYWRz
IGluIGFkZGl0aW9uIHRvIHRoZSBNYWluIHRocmVhZC4KICovCmVudW0gewog
IE5VTVRIUkVBRFMgPSA5Cn07Cgp0eXBlZGVmIHN0cnVjdCBiYWdfdF8gYmFn
X3Q7CnN0cnVjdCBiYWdfdF8gewogIGludCB0aHJlYWRudW07CiAgaW50IHN0
YXJ0ZWQ7CiAgLyogQWRkIG1vcmUgcGVyLXRocmVhZCBzdGF0ZSB2YXJpYWJs
ZXMgaGVyZSAqLwp9OwoKc3RhdGljIGJhZ190IHRocmVhZGJhZ1tOVU1USFJF
QURTICsgMV07Cgp0eXBlZGVmIHN0cnVjdCBjdnRoaW5nX3RfIGN2dGhpbmdf
dDsKCnN0cnVjdCBjdnRoaW5nX3RfIHsKICBwdGhyZWFkX2NvbmRfdCBub3Ri
dXN5OwogIHB0aHJlYWRfbXV0ZXhfdCBsb2NrOwogIGludCBzaGFyZWQ7Cn07
CgpzdGF0aWMgY3Z0aGluZ190IGN2dGhpbmcgPSB7CiAgUFRIUkVBRF9DT05E
X0lOSVRJQUxJWkVSLAogIFBUSFJFQURfTVVURVhfSU5JVElBTElaRVIsCiAg
MAp9OwoKc3RhdGljIHB0aHJlYWRfbXV0ZXhfdCBzdGFydF9mbGFnID0gUFRI
UkVBRF9NVVRFWF9JTklUSUFMSVpFUjsKCnN0YXRpYyBzdHJ1Y3QgdGltZXNw
ZWMgYWJzdGltZSA9IHsgMCwgMCB9OwoKc3RhdGljIGludCBhd29rZW47Cgpz
dGF0aWMgdm9pZCAqCm15dGhyZWFkKHZvaWQgKiBhcmcpCnsKICBiYWdfdCAq
IGJhZyA9IChiYWdfdCAqKSBhcmc7CgogIGFzc2VydChiYWcgPT0gJnRocmVh
ZGJhZ1tiYWctPnRocmVhZG51bV0pOwogIGFzc2VydChiYWctPnN0YXJ0ZWQg
PT0gMCk7CiAgYmFnLT5zdGFydGVkID0gMTsKCiAgLyogV2FpdCBmb3IgdGhl
IHN0YXJ0IGd1biAqLwogIGFzc2VydChwdGhyZWFkX211dGV4X2xvY2soJnN0
YXJ0X2ZsYWcpID09IDApOwogIGFzc2VydChwdGhyZWFkX211dGV4X3VubG9j
aygmc3RhcnRfZmxhZykgPT0gMCk7CgogIGFzc2VydChwdGhyZWFkX211dGV4
X2xvY2soJmN2dGhpbmcubG9jaykgPT0gMCk7CgogIC8qCiAgICogcHRocmVh
ZF9jb25kX3RpbWVkd2FpdCBpcyBhIGNhbmNlbGF0aW9uIHBvaW50IGFuZCB3
ZQogICAqIGdvaW5nIHRvIGNhbmNlbCBvbmUgZGVsaWJlcmF0ZWx5LgogICAq
LwojaWZkZWYgX01TQ19WRVIKI3ByYWdtYSBpbmxpbmVfZGVwdGgoMCkKI2Vu
ZGlmCiAgcHRocmVhZF9jbGVhbnVwX3B1c2gocHRocmVhZF9tdXRleF91bmxv
Y2ssICh2b2lkICopICZjdnRoaW5nLmxvY2spOwoKICB3aGlsZSAoISAoY3Z0
aGluZy5zaGFyZWQgPiAwKSkKICAgIGFzc2VydChwdGhyZWFkX2NvbmRfdGlt
ZWR3YWl0KCZjdnRoaW5nLm5vdGJ1c3ksICZjdnRoaW5nLmxvY2ssICZhYnN0
aW1lKSA9PSAwKTsKCiAgcHRocmVhZF9jbGVhbnVwX3BvcCgwKTsKI2lmZGVm
IF9NU0NfVkVSCiNwcmFnbWEgaW5saW5lX2RlcHRoKCkKI2VuZGlmCgogIGFz
c2VydChjdnRoaW5nLnNoYXJlZCA+IDApOwoKICBhd29rZW4rKzsKCiAgYXNz
ZXJ0KHB0aHJlYWRfbXV0ZXhfdW5sb2NrKCZjdnRoaW5nLmxvY2spID09IDAp
OwoKICByZXR1cm4gKHZvaWQgKikgMDsKfQoKaW50Cm1haW4oKQp7CiAgaW50
IGZhaWxlZCA9IDA7CiAgaW50IGk7CiAgaW50IGZpcnN0LCBsYXN0OwogIGlu
dCBjYW5jZWxlZFRocmVhZHMgPSAwOwogIHB0aHJlYWRfdCB0W05VTVRIUkVB
RFMgKyAxXTsKICBzdHJ1Y3QgdGltZWIgY3VyclN5c1RpbWU7CiAgY29uc3Qg
RFdPUkQgTkFOT1NFQ19QRVJfTUlMTElTRUMgPSAxMDAwMDAwOwoKICBhc3Nl
cnQoKHRbMF0gPSBwdGhyZWFkX3NlbGYoKSkgIT0gTlVMTCk7CgogIGFzc2Vy
dChjdnRoaW5nLm5vdGJ1c3kgPT0gUFRIUkVBRF9DT05EX0lOSVRJQUxJWkVS
KTsKCiAgYXNzZXJ0KGN2dGhpbmcubG9jayA9PSBQVEhSRUFEX01VVEVYX0lO
SVRJQUxJWkVSKTsKCiAgLyogZ2V0IGN1cnJlbnQgc3lzdGVtIHRpbWUgKi8K
ICBmdGltZSgmY3VyclN5c1RpbWUpOwoKICBhYnN0aW1lLnR2X3NlYyA9IGN1
cnJTeXNUaW1lLnRpbWU7CiAgYWJzdGltZS50dl9uc2VjID0gTkFOT1NFQ19Q
RVJfTUlMTElTRUMgKiBjdXJyU3lzVGltZS5taWxsaXRtOwogCiAgYWJzdGlt
ZS50dl9zZWMgKz0gNTsKCiAgYXNzZXJ0KCh0WzBdID0gcHRocmVhZF9zZWxm
KCkpICE9IE5VTEwpOwoKICBhd29rZW4gPSAwOwoKICBmb3IgKGZpcnN0ID0g
MSwgbGFzdCA9IE5VTVRIUkVBRFMgLyAyOwogICAgICAgZmlyc3QgPCBOVU1U
SFJFQURTOwogICAgICAgZmlyc3QgPSBsYXN0ICsgMSwgbGFzdCA9IE5VTVRI
UkVBRFMpCiAgICB7CiAgICAgIGFzc2VydChwdGhyZWFkX211dGV4X2xvY2so
JnN0YXJ0X2ZsYWcpID09IDApOwoKICAgICAgZm9yIChpID0gZmlyc3Q7IGkg
PD0gbGFzdDsgaSsrKQoJewoJICB0aHJlYWRiYWdbaV0uc3RhcnRlZCA9IDA7
CgkgIHRocmVhZGJhZ1tpXS50aHJlYWRudW0gPSBpOwoJICBhc3NlcnQocHRo
cmVhZF9jcmVhdGUoJnRbaV0sIE5VTEwsIG15dGhyZWFkLCAodm9pZCAqKSAm
dGhyZWFkYmFnW2ldKSA9PSAwKTsKCSAgYXNzZXJ0KHB0aHJlYWRfZGV0YWNo
KHRbaV0pID09IDApOwoJfQoKICAgICAgLyoKICAgICAgICogQ29kZSB0byBj
b250cm9sIG9yIG11bmlwdWxhdGUgY2hpbGQgdGhyZWFkcyBzaG91bGQgcHJv
YmFibHkgZ28gaGVyZS4KICAgICAgICovCiAgICAgIGN2dGhpbmcuc2hhcmVk
ID0gMDsKCiAgICAgIGFzc2VydChwdGhyZWFkX211dGV4X3VubG9jaygmc3Rh
cnRfZmxhZykgPT0gMCk7CgogICAgICAvKgogICAgICAgKiBHaXZlIHRocmVh
ZHMgdGltZSB0byBzdGFydC4KICAgICAgICovCiAgICAgIFNsZWVwKDEwMDAp
OwoKICAgICAgYXNzZXJ0KHB0aHJlYWRfbXV0ZXhfbG9jaygmY3Z0aGluZy5s
b2NrKSA9PSAwKTsKCiAgICAgIGN2dGhpbmcuc2hhcmVkKys7CgogICAgICBh
c3NlcnQocHRocmVhZF9tdXRleF91bmxvY2soJmN2dGhpbmcubG9jaykgPT0g
MCk7CgogICAgICBhc3NlcnQocHRocmVhZF9jYW5jZWwodFsoZmlyc3QgKyBs
YXN0KSAvIDJdKSA9PSAwKTsKICAgICAgY2FuY2VsZWRUaHJlYWRzKys7Cgog
ICAgICBhc3NlcnQocHRocmVhZF9jb25kX2Jyb2FkY2FzdCgmY3Z0aGluZy5u
b3RidXN5KSA9PSAwKTsKCiAgICAgIC8qCiAgICAgICAqIEdpdmUgdGhyZWFk
cyB0aW1lIHRvIGNvbXBsZXRlLgogICAgICAgKi8KICAgICAgU2xlZXAoMTAw
MCk7CiAgICB9CgoKICAvKgogICAqIFN0YW5kYXJkIGNoZWNrIHRoYXQgYWxs
IHRocmVhZHMgc3RhcnRlZC4KICAgKi8KICBmb3IgKGkgPSAxOyBpIDw9IE5V
TVRIUkVBRFM7IGkrKykKICAgIHsgCiAgICAgIGZhaWxlZCA9ICF0aHJlYWRi
YWdbaV0uc3RhcnRlZDsKCiAgICAgIGlmIChmYWlsZWQpCgl7CgkgIGZwcmlu
dGYoc3RkZXJyLCAiVGhyZWFkICVkOiBzdGFydGVkICVkXG4iLCBpLCB0aHJl
YWRiYWdbaV0uc3RhcnRlZCk7Cgl9CiAgICB9CgogIC8qIAogICAqIENsZWFu
dXAgdGhlIENWLgogICAqLwogIAogIGFzc2VydChwdGhyZWFkX211dGV4X2Rl
c3Ryb3koJmN2dGhpbmcubG9jaykgPT0gMCk7CgogIGFzc2VydChjdnRoaW5n
LmxvY2sgPT0gTlVMTCk7CgogIGFzc2VydChwdGhyZWFkX2NvbmRfZGVzdHJv
eSgmY3Z0aGluZy5ub3RidXN5KSA9PSAwKTsKCiAgYXNzZXJ0KGN2dGhpbmcu
bm90YnVzeSA9PSBOVUxMKTsKCiAgYXNzZXJ0KCFmYWlsZWQpOwoKICAvKgog
ICAqIENoZWNrIGFueSByZXN1bHRzIGhlcmUuCiAgICovCgogIGFzc2VydChh
d29rZW4gPT0gTlVNVEhSRUFEUyAtIGNhbmNlbGVkVGhyZWFkcyk7CgogIC8q
CiAgICogU3VjY2Vzcy4KICAgKi8KICByZXR1cm4gMDsKfQo=

--3073274-21821-1046340774=:285
Content-Type: TEXT/PLAIN; NAME="condvar7.c"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0302271112542.285@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="condvar7.c"
Content-length: 5551

LyoKICogRmlsZTogY29uZHZhcjcuYwogKgogKgogKiBUZXN0IFN5bm9wc2lz
OgogKiAtIFRlc3QgcHRocmVhZF9jb25kX2Jyb2FkY2FzdCB3aXRoIHRocmVh
ZCBjYW5jZWxhdGlvbi4KICoKICogVGVzdCBNZXRob2QgKFZhbGlkYXRpb24g
b3IgRmFsc2lmaWNhdGlvbik6CiAqIC0gVmFsaWRhdGlvbgogKgogKiBSZXF1
aXJlbWVudHMgVGVzdGVkOgogKiAtIAogKgogKiBGZWF0dXJlcyBUZXN0ZWQ6
CiAqIC0gCiAqCiAqIENhc2VzIFRlc3RlZDoKICogLSAKICoKICogRGVzY3Jp
cHRpb246CiAqIC0gVGVzdCBicm9hZGNhc3Qgd2l0aCBOVU1USFJFQURTICg9
NSkgd2FpdGluZyBDVnMsIG9uZSBpcyBjYW5jZWxlZCB3aGlsZSB3YWl0aW5n
LgogKgogKiBFbnZpcm9ubWVudDoKICogLSAKICoKICogSW5wdXQ6CiAqIC0g
Tm9uZS4KICoKICogT3V0cHV0OgogKiAtIEZpbGUgbmFtZSwgTGluZSBudW1i
ZXIsIGFuZCBmYWlsZWQgZXhwcmVzc2lvbiBvbiBmYWlsdXJlLgogKiAtIE5v
IG91dHB1dCBvbiBzdWNjZXNzLgogKgogKiBBc3N1bXB0aW9uczoKICogLSAK
ICoKICogUGFzcyBDcml0ZXJpYToKICogLSBQcm9jZXNzIHJldHVybnMgemVy
byBleGl0IHN0YXR1cy4KICoKICogRmFpbCBDcml0ZXJpYToKICogLSBQcm9j
ZXNzIHJldHVybnMgbm9uLXplcm8gZXhpdCBzdGF0dXMuCiAqLwoKI2luY2x1
ZGUgInRlc3QuaCIKI2luY2x1ZGUgPHN5cy90aW1lYi5oPgoKLyoKICogQ3Jl
YXRlIE5VTVRIUkVBRFMgdGhyZWFkcyBpbiBhZGRpdGlvbiB0byB0aGUgTWFp
biB0aHJlYWQuCiAqLwplbnVtIHsKICBOVU1USFJFQURTID0gNQp9OwoKdHlw
ZWRlZiBzdHJ1Y3QgYmFnX3RfIGJhZ190OwpzdHJ1Y3QgYmFnX3RfIHsKICBp
bnQgdGhyZWFkbnVtOwogIGludCBzdGFydGVkOwogIC8qIEFkZCBtb3JlIHBl
ci10aHJlYWQgc3RhdGUgdmFyaWFibGVzIGhlcmUgKi8KfTsKCnN0YXRpYyBi
YWdfdCB0aHJlYWRiYWdbTlVNVEhSRUFEUyArIDFdOwoKdHlwZWRlZiBzdHJ1
Y3QgY3Z0aGluZ190XyBjdnRoaW5nX3Q7CgpzdHJ1Y3QgY3Z0aGluZ190XyB7
CiAgcHRocmVhZF9jb25kX3Qgbm90YnVzeTsKICBwdGhyZWFkX211dGV4X3Qg
bG9jazsKICBpbnQgc2hhcmVkOwp9OwoKc3RhdGljIGN2dGhpbmdfdCBjdnRo
aW5nID0gewogIFBUSFJFQURfQ09ORF9JTklUSUFMSVpFUiwKICBQVEhSRUFE
X01VVEVYX0lOSVRJQUxJWkVSLAogIDAKfTsKCnN0YXRpYyBwdGhyZWFkX211
dGV4X3Qgc3RhcnRfZmxhZyA9IFBUSFJFQURfTVVURVhfSU5JVElBTElaRVI7
CgpzdGF0aWMgc3RydWN0IHRpbWVzcGVjIGFic3RpbWUgPSB7IDAsIDAgfTsK
CnN0YXRpYyBpbnQgYXdva2VuOwoKdm9pZCAqCm15dGhyZWFkKHZvaWQgKiBh
cmcpCnsKICBiYWdfdCAqIGJhZyA9IChiYWdfdCAqKSBhcmc7CgogIGFzc2Vy
dChiYWcgPT0gJnRocmVhZGJhZ1tiYWctPnRocmVhZG51bV0pOwogIGFzc2Vy
dChiYWctPnN0YXJ0ZWQgPT0gMCk7CiAgYmFnLT5zdGFydGVkID0gMTsKCiAg
LyogV2FpdCBmb3IgdGhlIHN0YXJ0IGd1biAqLwogIGFzc2VydChwdGhyZWFk
X211dGV4X2xvY2soJnN0YXJ0X2ZsYWcpID09IDApOwogIGFzc2VydChwdGhy
ZWFkX211dGV4X3VubG9jaygmc3RhcnRfZmxhZykgPT0gMCk7CgogIGFzc2Vy
dChwdGhyZWFkX211dGV4X2xvY2soJmN2dGhpbmcubG9jaykgPT0gMCk7Cgoj
aWZkZWYgX01TQ19WRVIKI3ByYWdtYSBpbmxpbmVfZGVwdGgoMCkKI2VuZGlm
CiAgcHRocmVhZF9jbGVhbnVwX3B1c2gocHRocmVhZF9tdXRleF91bmxvY2ss
ICh2b2lkICopICZjdnRoaW5nLmxvY2spOwoKICB3aGlsZSAoISAoY3Z0aGlu
Zy5zaGFyZWQgPiAwKSkKICAgIGFzc2VydChwdGhyZWFkX2NvbmRfdGltZWR3
YWl0KCZjdnRoaW5nLm5vdGJ1c3ksICZjdnRoaW5nLmxvY2ssICZhYnN0aW1l
KSA9PSAwKTsKCiAgcHRocmVhZF9jbGVhbnVwX3BvcCgwKTsKI2lmZGVmIF9N
U0NfVkVSCiNwcmFnbWEgaW5saW5lX2RlcHRoKCkKI2VuZGlmCgogIGFzc2Vy
dChjdnRoaW5nLnNoYXJlZCA+IDApOwoKICBhd29rZW4rKzsKCiAgYXNzZXJ0
KHB0aHJlYWRfbXV0ZXhfdW5sb2NrKCZjdnRoaW5nLmxvY2spID09IDApOwoK
ICByZXR1cm4gKHZvaWQgKikgMDsKfQoKaW50Cm1haW4oKQp7CiAgaW50IGZh
aWxlZCA9IDA7CiAgaW50IGk7CiAgcHRocmVhZF90IHRbTlVNVEhSRUFEUyAr
IDFdOwogIHN0cnVjdCB0aW1lYiBjdXJyU3lzVGltZTsKICBjb25zdCBEV09S
RCBOQU5PU0VDX1BFUl9NSUxMSVNFQyA9IDEwMDAwMDA7CgogIGN2dGhpbmcu
c2hhcmVkID0gMDsKCiAgYXNzZXJ0KCh0WzBdID0gcHRocmVhZF9zZWxmKCkp
ICE9IE5VTEwpOwoKICBhc3NlcnQoY3Z0aGluZy5ub3RidXN5ID09IFBUSFJF
QURfQ09ORF9JTklUSUFMSVpFUik7CgogIGFzc2VydChjdnRoaW5nLmxvY2sg
PT0gUFRIUkVBRF9NVVRFWF9JTklUSUFMSVpFUik7CgogIGFzc2VydChwdGhy
ZWFkX211dGV4X2xvY2soJnN0YXJ0X2ZsYWcpID09IDApOwoKICAvKiBnZXQg
Y3VycmVudCBzeXN0ZW0gdGltZSAqLwogIGZ0aW1lKCZjdXJyU3lzVGltZSk7
CgogIGFic3RpbWUudHZfc2VjID0gY3VyclN5c1RpbWUudGltZTsKICBhYnN0
aW1lLnR2X25zZWMgPSBOQU5PU0VDX1BFUl9NSUxMSVNFQyAqIGN1cnJTeXNU
aW1lLm1pbGxpdG07CgogIGFic3RpbWUudHZfc2VjICs9IDEwOwoKICBhc3Nl
cnQoKHRbMF0gPSBwdGhyZWFkX3NlbGYoKSkgIT0gTlVMTCk7CgogIGF3b2tl
biA9IDA7CgogIGZvciAoaSA9IDE7IGkgPD0gTlVNVEhSRUFEUzsgaSsrKQog
ICAgewogICAgICB0aHJlYWRiYWdbaV0uc3RhcnRlZCA9IDA7CiAgICAgIHRo
cmVhZGJhZ1tpXS50aHJlYWRudW0gPSBpOwogICAgICBhc3NlcnQocHRocmVh
ZF9jcmVhdGUoJnRbaV0sIE5VTEwsIG15dGhyZWFkLCAodm9pZCAqKSAmdGhy
ZWFkYmFnW2ldKSA9PSAwKTsKICAgIH0KCiAgLyoKICAgKiBDb2RlIHRvIGNv
bnRyb2wgb3IgbXVuaXB1bGF0ZSBjaGlsZCB0aHJlYWRzIHNob3VsZCBwcm9i
YWJseSBnbyBoZXJlLgogICAqLwoKICBhc3NlcnQocHRocmVhZF9tdXRleF91
bmxvY2soJnN0YXJ0X2ZsYWcpID09IDApOwoKICAvKgogICAqIEdpdmUgdGhy
ZWFkcyB0aW1lIHRvIHN0YXJ0LgogICAqLwogIFNsZWVwKDEwMDApOwoKICBh
c3NlcnQocHRocmVhZF9tdXRleF9sb2NrKCZjdnRoaW5nLmxvY2spID09IDAp
OwoKICBjdnRoaW5nLnNoYXJlZCsrOwoKICBhc3NlcnQocHRocmVhZF9tdXRl
eF91bmxvY2soJmN2dGhpbmcubG9jaykgPT0gMCk7CgogIC8qCiAgICogQ2Fu
Y2VsIG9uZSBvZiB0aGUgdGhyZWFkcy4KICAgKi8KICBhc3NlcnQocHRocmVh
ZF9jYW5jZWwodFszXSkgPT0gMCk7CiAgU2xlZXAoNTAwKTsKCiAgLyoKICAg
KiBTaWduYWwgYWxsIHJlbWFpbmluZyB3YWl0aW5nIHRocmVhZHMuCiAgICov
CiAgYXNzZXJ0KHB0aHJlYWRfY29uZF9icm9hZGNhc3QoJmN2dGhpbmcubm90
YnVzeSkgPT0gMCk7CgogIC8qCiAgICogR2l2ZSB0aHJlYWRzIHRpbWUgdG8g
Y29tcGxldGUuCiAgICovCiAgU2xlZXAoMjAwMCk7CgogIC8qIAogICAqIENs
ZWFudXAgdGhlIENWLgogICAqLwogIAogIGFzc2VydChwdGhyZWFkX211dGV4
X2Rlc3Ryb3koJmN2dGhpbmcubG9jaykgPT0gMCk7CgogIGFzc2VydChjdnRo
aW5nLmxvY2sgPT0gTlVMTCk7CgogIGFzc2VydChwdGhyZWFkX2NvbmRfZGVz
dHJveSgmY3Z0aGluZy5ub3RidXN5KSA9PSAwKTsKCiAgYXNzZXJ0KGN2dGhp
bmcubm90YnVzeSA9PSBOVUxMKTsKCiAgLyoKICAgKiBTdGFuZGFyZCBjaGVj
ayB0aGF0IGFsbCB0aHJlYWRzIHN0YXJ0ZWQuCiAgICovCiAgZm9yIChpID0g
MTsgaSA8PSBOVU1USFJFQURTOyBpKyspCiAgICB7IAogICAgICBmYWlsZWQg
PSAhdGhyZWFkYmFnW2ldLnN0YXJ0ZWQ7CgogICAgICBpZiAoZmFpbGVkKQoJ
ewoJICBmcHJpbnRmKHN0ZGVyciwgIlRocmVhZCAlZDogc3RhcnRlZCAlZFxu
IiwgaSwgdGhyZWFkYmFnW2ldLnN0YXJ0ZWQpOwoJfQogICAgfQoKICBhc3Nl
cnQoIWZhaWxlZCk7CgogIC8qCiAgICogQ2hlY2sgYW55IHJlc3VsdHMgaGVy
ZS4KICAgKi8KCiAgYXNzZXJ0KGF3b2tlbiA9PSAoTlVNVEhSRUFEUyAtIDEp
KTsKCiAgLyoKICAgKiBTdWNjZXNzLgogICAqLwogIHJldHVybiAwOwp9Cg==

--3073274-21821-1046340774=:285--
