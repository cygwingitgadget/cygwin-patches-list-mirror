Return-Path: <cygwin-patches-return-3718-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 24674 invoked by alias); 19 Mar 2003 13:49:52 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sources.redhat.com/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sources.redhat.com/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Received: (qmail 24663 invoked from network); 19 Mar 2003 13:49:52 -0000
X-Authentication-Warning: atacama.four-d.de: mail set sender to <tpfaff@gmx.net> using -f
Date: Wed, 19 Mar 2003 13:49:00 -0000
From: Thomas Pfaff <tpfaff@gmx.net>
To: cygwin-patches@cygwin.com
Subject: [PATCH] Add unsigned long Interlocked functions
Message-ID: <Pine.WNT.4.44.0303191441120.257-200000@algeria.intern.net>
X-X-Sender: pfaff@antarctica.intern.net
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="160110-8113-1048081419=:257"
Content-ID: <Pine.WNT.4.44.0303191443550.257@algeria.intern.net>
X-SW-Source: 2003-q1/txt/msg00367.txt.bz2

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--160110-8113-1048081419=:257
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.WNT.4.44.0303191443551.257@algeria.intern.net>
Content-length: 467


2003-03-19  Thomas Pfaff  <tpfaff@gmx.net>

	* thread.cc (pthread_cond::Wait): Remove typecasts for unsigned
	long values when calling Interlocked functions. Use new UL functions
	instead.
	(pthread_mutex::_Lock): Ditto.
	(pthread_mutex::_TryLock): Ditto.
	* winbase.h (InterlockedIncrementUL): New inline function for type
	safety with unsigned parameters.
	(InterlockedDecrementUL): Ditto.
	(InterlockedExchangeUL): Ditto.
	(InterlockedCompareExchangeUL): Ditto.


--160110-8113-1048081419=:257
Content-Type: TEXT/PLAIN; NAME="Interlocked.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0303191443390.257@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="Interlocked.patch"
Content-length: 4181

ZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi90aHJlYWQuY2Mgc3Jj
L3dpbnN1cC9jeWd3aW4vdGhyZWFkLmNjCi0tLSBzcmMub2xkL3dpbnN1cC9j
eWd3aW4vdGhyZWFkLmNjCTIwMDMtMDMtMTkgMTQ6MjI6MjQuMDAwMDAwMDAw
ICswMTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi90aHJlYWQuY2MJMjAwMy0w
My0xOSAxNDoyNzo0NS4wMDAwMDAwMDAgKzAxMDAKQEAgLTkzNCwxMSArOTM0
LDExIEBAIHB0aHJlYWRfY29uZDo6V2FpdCAocHRocmVhZF9tdXRleF90IG11
dGUKICAgRFdPUkQgcnY7CiAKICAgbXR4SW4uTG9jayAoKTsKLSAgaWYgKDEg
PT0gSW50ZXJsb2NrZWRJbmNyZW1lbnQgKChsb25nICopJndhaXRpbmcpKQor
ICBpZiAoMSA9PSBJbnRlcmxvY2tlZEluY3JlbWVudFVMICgmd2FpdGluZykp
CiAgICAgbXR4Q29uZCA9IG11dGV4OwogICBlbHNlIGlmIChtdHhDb25kICE9
IG11dGV4KQogICAgIHsKLSAgICAgIEludGVybG9ja2VkRGVjcmVtZW50ICgo
bG9uZyAqKSZ3YWl0aW5nKTsKKyAgICAgIEludGVybG9ja2VkRGVjcmVtZW50
VUwgKCZ3YWl0aW5nKTsKICAgICAgIG10eEluLlVuTG9jayAoKTsKICAgICAg
IHJldHVybiBFSU5WQUw7CiAgICAgfQpAQCAtOTY5LDcgKzk2OSw3IEBAIHB0
aHJlYWRfY29uZDo6V2FpdCAocHRocmVhZF9tdXRleF90IG11dGUKICAgICAg
ICAgcnYgPSBXQUlUX09CSkVDVF8wOwogICAgIH0KIAotICBJbnRlcmxvY2tl
ZERlY3JlbWVudCAoKGxvbmcgKikmd2FpdGluZyk7CisgIEludGVybG9ja2Vk
RGVjcmVtZW50VUwgKCZ3YWl0aW5nKTsKIAogICBpZiAocnYgPT0gV0FJVF9P
QkpFQ1RfMCAmJiAwID09IC0tcGVuZGluZykKICAgICAvKgpAQCAtMTU5Niwx
MSArMTU5NiwxMSBAQCBwdGhyZWFkX211dGV4OjpfTG9jayAocHRocmVhZF90
IHNlbGYpCiB7CiAgIGludCByZXN1bHQgPSAwOwogCi0gIGlmICgxID09IElu
dGVybG9ja2VkSW5jcmVtZW50ICgobG9uZyAqKSZsb2NrX2NvdW50ZXIpKQor
ICBpZiAoMSA9PSBJbnRlcmxvY2tlZEluY3JlbWVudFVMICgmbG9ja19jb3Vu
dGVyKSkKICAgICBTZXRPd25lciAoc2VsZik7CiAgIGVsc2UgaWYgKFBUSFJF
QURfTVVURVhfTk9STUFMICE9IHR5cGUgJiYgcHRocmVhZF9lcXVhbCAob3du
ZXIsIHNlbGYpKQogICAgIHsKLSAgICAgIEludGVybG9ja2VkRGVjcmVtZW50
ICgobG9uZyAqKSAmbG9ja19jb3VudGVyKTsKKyAgICAgIEludGVybG9ja2Vk
RGVjcmVtZW50VUwgKCZsb2NrX2NvdW50ZXIpOwogICAgICAgaWYgKFBUSFJF
QURfTVVURVhfUkVDVVJTSVZFID09IHR5cGUpCiAJcmVzdWx0ID0gTG9ja1Jl
Y3Vyc2l2ZSAoKTsKICAgICAgIGVsc2UKQEAgLTE2MjAsNyArMTYyMCw3IEBA
IHB0aHJlYWRfbXV0ZXg6Ol9UcnlMb2NrIChwdGhyZWFkX3Qgc2VsZikKIHsK
ICAgaW50IHJlc3VsdCA9IDA7CiAKLSAgaWYgKDAgPT0gSW50ZXJsb2NrZWRD
b21wYXJlRXhjaGFuZ2UgKChsb25nICopJmxvY2tfY291bnRlciwgMSwgMCAp
KQorICBpZiAoMCA9PSBJbnRlcmxvY2tlZENvbXBhcmVFeGNoYW5nZVVMICgm
bG9ja19jb3VudGVyLCAxLCAwICkpCiAgICAgU2V0T3duZXIgKHNlbGYpOwog
ICBlbHNlIGlmIChQVEhSRUFEX01VVEVYX1JFQ1VSU0lWRSA9PSB0eXBlICYm
IHB0aHJlYWRfZXF1YWwgKG93bmVyLCBzZWxmKSkKICAgICByZXN1bHQgPSBM
b2NrUmVjdXJzaXZlICgpOwpAQCAtMTYzOSw3ICsxNjM5LDcgQEAgcHRocmVh
ZF9tdXRleDo6X1VuTG9jayAocHRocmVhZF90IHNlbGYpCiAgIGlmICgwID09
IC0tcmVjdXJzaW9uX2NvdW50ZXIpCiAgICAgewogICAgICAgb3duZXIgPSBO
VUxMOwotICAgICAgaWYgKEludGVybG9ja2VkRGVjcmVtZW50ICgobG9uZyAq
KSZsb2NrX2NvdW50ZXIpKQorICAgICAgaWYgKEludGVybG9ja2VkRGVjcmVt
ZW50VUwgKCZsb2NrX2NvdW50ZXIpKQogCS8vIEFub3RoZXIgdGhyZWFkIGlz
IHdhaXRpbmcKIAk6OlJlbGVhc2VTZW1hcGhvcmUgKHdpbjMyX29ial9pZCwg
MSwgTlVMTCk7CiAgICAgfQpkaWZmIC11cnAgc3JjLm9sZC93aW5zdXAvY3ln
d2luL3dpbmJhc2UuaCBzcmMvd2luc3VwL2N5Z3dpbi93aW5iYXNlLmgKLS0t
IHNyYy5vbGQvd2luc3VwL2N5Z3dpbi93aW5iYXNlLmgJMjAwMy0wMy0xOSAx
NDoyMzoxNS4wMDAwMDAwMDAgKzAxMDAKKysrIHNyYy93aW5zdXAvY3lnd2lu
L3dpbmJhc2UuaAkyMDAzLTAzLTE5IDE0OjI1OjIwLjAwMDAwMDAwMCArMDEw
MApAQCAtNTcsNiArNTcsMzAgQEAgaWxvY2tjbXBleGNoIChsb25nICp0LCBs
b25nIHYsIGxvbmcgYykKICN1bmRlZiBJbnRlcmxvY2tlZENvbXBhcmVFeGNo
YW5nZQogI2RlZmluZSBJbnRlcmxvY2tlZENvbXBhcmVFeGNoYW5nZSBpbG9j
a2NtcGV4Y2gKIAorZXh0ZXJuIF9faW5saW5lX18gdW5zaWduZWQgbG9uZwor
SW50ZXJsb2NrZWRJbmNyZW1lbnRVTCAodW5zaWduZWQgbG9uZyAqbSkKK3sK
KyAgcmV0dXJuICh1bnNpZ25lZCBsb25nKSBJbnRlcmxvY2tlZEluY3JlbWVu
dCAoKGxvbmcqKSBtKTsKK30KKworZXh0ZXJuIF9faW5saW5lX18gdW5zaWdu
ZWQgbG9uZworSW50ZXJsb2NrZWREZWNyZW1lbnRVTCh1bnNpZ25lZCBsb25n
ICptKQoreworICByZXR1cm4gKHVuc2lnbmVkIGxvbmcpIEludGVybG9ja2Vk
RGVjcmVtZW50ICgobG9uZyopIG0pOworfQorCitleHRlcm4gX19pbmxpbmVf
XyB1bnNpZ25lZCBsb25nCitJbnRlcmxvY2tlZEV4Y2hhbmdlVUwgKHVuc2ln
bmVkIGxvbmcgKnQsIHVuc2lnbmVkIGxvbmcgdikKK3sKKyAgcmV0dXJuICh1
bnNpZ25lZCBsb25nKSBJbnRlcmxvY2tlZEV4Y2hhbmdlICgobG9uZyopIHQs
IChsb25nKSB2KTsKK30KKworZXh0ZXJuIF9faW5saW5lX18gdW5zaWduZWQg
bG9uZworSW50ZXJsb2NrZWRDb21wYXJlRXhjaGFuZ2VVTCh1bnNpZ25lZCBs
b25nICp0LCB1bnNpZ25lZCBsb25nIHYsIHVuc2lnbmVkIGxvbmcgYykKK3sK
KyAgcmV0dXJuICh1bnNpZ25lZCBsb25nKSBJbnRlcmxvY2tlZENvbXBhcmVF
eGNoYW5nZSAoKGxvbmcqKSB0LCAobG9uZykgdiwgKGxvbmcpIGMpOworfQor
CiAjaWZuZGVmIEVYUENHZgogI2RlZmluZSBERUNMQVJFX1RMU19TVE9SQUdF
IGRvIHt9IHdoaWxlICgwKQogI2Vsc2UK

--160110-8113-1048081419=:257--
