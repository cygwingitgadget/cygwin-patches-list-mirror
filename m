Return-Path: <cygwin-patches-return-9441-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 128415 invoked by alias); 7 Jun 2019 18:05:36 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Id: <cygwin-patches.cygwin.com>
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
Received: (qmail 128327 invoked by uid 89); 7 Jun 2019 18:05:36 -0000
Authentication-Results: sourceware.org; auth=none
X-Spam-SWARE-Status: No, score=-22.7 required=5.0 tests=AWL,BAYES_00,GIT_PATCH_0,GIT_PATCH_1,GIT_PATCH_2,GIT_PATCH_3,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_PASS autolearn=ham version=3.3.1 spammy=500000
X-HELO: NAM01-BY2-obe.outbound.protection.outlook.com
Received: from mail-eopbgr810109.outbound.protection.outlook.com (HELO NAM01-BY2-obe.outbound.protection.outlook.com) (40.107.81.109) by sourceware.org (qpsmtpd/0.93/v0.84-503-g423c35a) with ESMTP; Fri, 07 Jun 2019 18:05:33 +0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cornell.edu; s=selector2; h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck; bh=p88aTwBech1OE1pUfEA42bEzhyozPcf3HAqAdoxixro=; b=S6kQXDDUen/XYMZSAQ4+j/wFj42igOHhnbm3t4nmJv4dVE6ySE0+cdDpGpUnXbgLFk5F5y/gtAKOR/UZvxz1dp1QoXqvPkXXNeOGLAYYCqdrEtiNFOlF9dWxDADhU1AFnewwGaLKEIZ4Ov8H0nfx26oPc7xregJyEfbESKQoR60=
Received: from DM6PR04MB5211.namprd04.prod.outlook.com (20.178.24.208) by DM6PR04MB4779.namprd04.prod.outlook.com (20.176.107.208) with Microsoft SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.1965.14; Fri, 7 Jun 2019 18:05:30 +0000
Received: from DM6PR04MB5211.namprd04.prod.outlook.com ([fe80::510a:3a42:f346:a4d8]) by DM6PR04MB5211.namprd04.prod.outlook.com ([fe80::510a:3a42:f346:a4d8%7]) with mapi id 15.20.1965.011; Fri, 7 Jun 2019 18:05:30 +0000
From: Ken Brown <kbrown@cornell.edu>
To: "cygwin-patches@cygwin.com" <cygwin-patches@cygwin.com>
Subject: [PATCH draft v2 4/6] Cygwin: fhandler_pipe: fix permission problem
Date: Fri, 07 Jun 2019 18:05:00 -0000
Message-ID: <20190607180511.46369-5-kbrown@cornell.edu>
References: <20190607180511.46369-1-kbrown@cornell.edu>
In-Reply-To: <20190607180511.46369-1-kbrown@cornell.edu>
authentication-results: spf=none (sender IP is ) smtp.mailfrom=kbrown@cornell.edu;
x-ms-oob-tlc-oobclassifiers: OLM:9508;
received-spf: None (protection.outlook.com: cornell.edu does not designate permitted sender hosts)
x-ms-exchange-senderadcheck: 1
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: ksb2@cornell.edu
X-IsSubscribed: yes
X-SW-Source: 2019-q2/txt/msg00150.txt.bz2

VGhlIHJlYWQgaGFuZGxlcyBvZiBwaXBlcyBjcmVhdGVkIGJ5IENyZWF0ZU5h
bWVkUGlwZSBkb24ndCBoYXZlDQpGSUxFX1dSSVRFX0FUVFJJQlVURVMgYWNj
ZXNzIHVubGVzcyB0aGUgcGlwZSBpcyBjcmVhdGVkIHdpdGgNClBJUEVfQUND
RVNTX0RVUExFWC4gIFRoaXMgY2F1c2VzIHNldF9waXBlX25vbl9ibG9ja2lu
ZyB0byBmYWlsIG9uIHN1Y2gNCmhhbmRsZXMuICBUbyBmaXggdGhpcywgYWRk
IGEgaGVscGVyIGZ1bmN0aW9uIG50X2NyZWF0ZSwgd2hpY2ggdXNlcw0KTnRD
cmVhdGVOYW1lZFBpcGVGaWxlIGluc3RlYWQgb2YgQ3JlYXRlTmFtZWRQaXBl
IGFuZCBnaXZlcyB1cyBtb3JlDQpmbGV4aWJpbGl0eSBpbiBzZXR0aW5nIGFj
Y2VzcyByaWdodHMuDQoNClVzZSB0aGlzIGhlbHBlciBmdW5jdGlvbiBpbiBm
aGFuZGxlcl9waXBlOjpjcmVhdGUgKGZoYW5kbGVyX3BpcGUgKlsyXSwNCnVu
c2lnbmVkLCBpbnQpLCB3aGljaCBpcyB0aGUgdmVyc2lvbiBvZiBmaGFuZGxl
cl9waXBlOjpjcmVhdGUgdXNlZCBieQ0KdGhlIHBpcGUgYW5kIHBpcGUyIHN5
c3RlbSBjYWxscy4NCg0KRm9yIGNvbnZlbmllbmNlLCBhbHNvIGFkZCBhIHN0
YXRpYyBtZW1iZXIgZnVuY3Rpb24NCmZoYW5kbGVyX3BpcGU6Om5wZnNfaGFu
ZGxlIHNpbWlsYXIgdG8gdGhvc2UgdXNlZCBieSBmaGFuZGxlcl9maWZvIGFu
ZA0KZmhhbmRsZXJfc29ja2V0X3VuaXguDQotLS0NCiB3aW5zdXAvY3lnd2lu
L2ZoYW5kbGVyLmggICAgICAgfCAgIDEgKw0KIHdpbnN1cC9jeWd3aW4vZmhh
bmRsZXJfcGlwZS5jYyB8IDE4OSArKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKy0NCiAyIGZpbGVzIGNoYW5nZWQsIDE4OCBpbnNlcnRpb25zKCsp
LCAyIGRlbGV0aW9ucygtKQ0KDQpkaWZmIC0tZ2l0IGEvd2luc3VwL2N5Z3dp
bi9maGFuZGxlci5oIGIvd2luc3VwL2N5Z3dpbi9maGFuZGxlci5oDQppbmRl
eCA1YWUyNjJjNWMuLjdhYTAxZDEwMSAxMDA2NDQNCi0tLSBhL3dpbnN1cC9j
eWd3aW4vZmhhbmRsZXIuaA0KKysrIGIvd2luc3VwL2N5Z3dpbi9maGFuZGxl
ci5oDQpAQCAtMTIxNiw2ICsxMjE2LDcgQEAgcHVibGljOg0KICAgaW50IF9f
cmVnMyBmYWR2aXNlIChvZmZfdCwgb2ZmX3QsIGludCk7DQogICBpbnQgX19y
ZWczIGZ0cnVuY2F0ZSAob2ZmX3QsIGJvb2wpOw0KICAgaW50IGluaXQgKEhB
TkRMRSwgRFdPUkQsIG1vZGVfdCwgaW50NjRfdCk7DQorICBzdGF0aWMgTlRT
VEFUVVMgbnBmc19oYW5kbGUgKEhBTkRMRSAmKTsNCiAgIHN0YXRpYyBpbnQg
Y3JlYXRlIChmaGFuZGxlcl9waXBlICpbMl0sIHVuc2lnbmVkLCBpbnQpOw0K
ICAgc3RhdGljIERXT1JEIGNyZWF0ZSAoTFBTRUNVUklUWV9BVFRSSUJVVEVT
LCBIQU5ETEUgKiwgSEFORExFICosIERXT1JELA0KIAkJICAgICAgIGNvbnN0
IGNoYXIgKiwgRFdPUkQsIGludDY0X3QgKnVuaXF1ZV9pZCA9IE5VTEwpOw0K
ZGlmZiAtLWdpdCBhL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfcGlwZS5jYyBi
L3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJfcGlwZS5jYw0KaW5kZXggNzY0MGZh
ZTM2Li4yN2ZkYzhlNzYgMTAwNjQ0DQotLS0gYS93aW5zdXAvY3lnd2luL2Zo
YW5kbGVyX3BpcGUuY2MNCisrKyBiL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXJf
cGlwZS5jYw0KQEAgLTM1LDcgKzM1LDEyIEBAIGZoYW5kbGVyX3BpcGU6OmZo
YW5kbGVyX3BpcGUgKCkNCiAgIG5lZWRfZm9ya19maXh1cCAodHJ1ZSk7DQog
fQ0KIA0KLS8qIFRoaXMgYWxzbyBzZXRzIHRoZSBwaXBlJ3MgcmVhZCBtb2Rl
IHRvIGJ5dGVfc3RyZWFtIHVuY29uZGl0aW9uYWxseS4gKi8NCisvKiBUaGUg
Zm9sbG93aW5nIGZ1bmN0aW9uIGlzIGludGVuZGVkIGZvciBmaGFuZGxlcl9w
aXBlIG9iamVjdHMNCisgICBjcmVhdGVkIGJ5IHRoZSBzZWNvbmQgdmVyc2lv
biBvZiBmaGFuZGxlcl9waXBlOjpjcmVhdGUgYmVsb3cuICBTZWUNCisgICB0
aGUgY29tbWVudCBwcmVjZWRpbmcgdGhlIGxhdHRlci4NCisNCisgICBJbiBh
ZGRpdGlvbiB0byBzZXR0aW5nIHRoZSBibG9ja2luZyBtb2RlIG9mIHRoZSBw
aXBlIGhhbmRsZSwgaXQNCisgICBhbHNvIHNldHMgdGhlIHBpcGUncyByZWFk
IG1vZGUgdG8gYnl0ZV9zdHJlYW0gdW5jb25kaXRpb25hbGx5LiAqLw0KIHZv
aWQNCiBmaGFuZGxlcl9waXBlOjpzZXRfcGlwZV9ub25fYmxvY2tpbmcgKGJv
b2wgbm9uYmxvY2tpbmcpDQogew0KQEAgLTU2Niw2ICs1NzEsMjQgQEAgZmhh
bmRsZXJfcGlwZTo6Y3JlYXRlIChMUFNFQ1VSSVRZX0FUVFJJQlVURVMgc2Ff
cHRyLCBQSEFORExFIHIsIFBIQU5ETEUgdywNCiAgIHJldHVybiAwOw0KIH0N
CiANCisvKiBUaGUgbmV4dCB2ZXJzaW9uIG9mIGZoYW5kbGVyX3BpcGU6OmNy
ZWF0ZSB1c2VkIHRvIGNhbGwgdGhlIHByZXZpb3VzDQorICAgdmVyc2lvbi4g
IEJ1dCB0aGUgcmVhZCBoYW5kbGUgY3JlYXRlZCBieSB0aGUgbGF0dGVyIGRv
ZXNuJ3QgaGF2ZQ0KKyAgIEZJTEVfV1JJVEVfQVRUUklCVVRFUyBhY2Nlc3Mg
dW5sZXNzIHRoZSBwaXBlIGlzIGNyZWF0ZWQgd2l0aA0KKyAgIFBJUEVfQUND
RVNTX0RVUExFWCwgYW5kIGl0IGRvZXNuJ3Qgc2VlbSBwb3NzaWJsZSB0byBh
ZGQgdGhhdCBhY2Nlc3MNCisgICByaWdodC4gIFRoaXMgY2F1c2VzIHNldF9w
aXBlX25vbl9ibG9ja2luZyB0byBmYWlsLg0KKw0KKyAgIFRvIGZpeCB0aGlz
IHdlIHdpbGwgZGVmaW5lIGEgaGVscGVyIGZ1bmN0aW9uICdudF9jcmVhdGUn
IHRoYXQgaXMNCisgICBzaW1pbGFyIHRvIHRoZSBhYm92ZSBmaGFuZGxlcl9w
aXBlOjpjcmVhdGUgYnV0IHVzZXMNCisgICBOdENyZWF0ZU5hbWVkUGlwZUZp
bGUgaW5zdGVhZCBvZiBDcmVhdGVOYW1lZFBpcGU7IHRoaXMgZ2l2ZXMgbW9y
ZQ0KKyAgIGZsZXhpYmlsaXR5IGluIHNldHRpbmcgdGhlIGFjY2VzcyByaWdo
dHMuICBXZSB3aWxsIHVzZSB0aGlzIGhlbHBlcg0KKyAgIGZ1bmN0aW9uIGlu
IHRoZSB2ZXJzaW9uIG9mIGZoYW5kbGVyX3BpcGU6OmNyZWF0ZSBiZWxvdywg
d2hpY2gNCisgICBzdWZmaWNlcyBmb3IgYWxsIG9mIG91ciB1c2VzIG9mIHNl
dF9waXBlX25vbl9ibG9ja2luZy4gIEZvcg0KKyAgIHNpbXBsaWNpdHksIG50
X2NyZWF0ZSB3aWxsIG9taXQgdGhlICdvcGVuX21vZGUnIGFuZCAnbmFtZScN
CisgICBwYXJhbWV0ZXJzLCB3aGljaCBhcmVuJ3QgbmVlZGVkIGZvciBvdXIg
cHVycG9zZXMuICAqLw0KKw0KK3N0YXRpYyBpbnQgbnRfY3JlYXRlIChMUFNF
Q1VSSVRZX0FUVFJJQlVURVMsIFBIQU5ETEUsIFBIQU5ETEUsIERXT1JELA0K
KwkJICAgICAgaW50NjRfdCAqKTsNCisNCiBpbnQNCiBmaGFuZGxlcl9waXBl
OjpjcmVhdGUgKGZoYW5kbGVyX3BpcGUgKmZoc1syXSwgdW5zaWduZWQgcHNp
emUsIGludCBtb2RlKQ0KIHsNCkBAIC01NzQsNyArNTk3LDcgQEAgZmhhbmRs
ZXJfcGlwZTo6Y3JlYXRlIChmaGFuZGxlcl9waXBlICpmaHNbMl0sIHVuc2ln
bmVkIHBzaXplLCBpbnQgbW9kZSkNCiAgIGludCByZXMgPSAtMTsNCiAgIGlu
dDY0X3QgdW5pcXVlX2lkOw0KIA0KLSAgaW50IHJldCA9IGNyZWF0ZSAoc2Es
ICZyLCAmdywgcHNpemUsIE5VTEwsIDAsICZ1bmlxdWVfaWQpOw0KKyAgaW50
IHJldCA9IG50X2NyZWF0ZSAoc2EsICZyLCAmdywgcHNpemUsICZ1bmlxdWVf
aWQpOw0KICAgaWYgKHJldCkNCiAgICAgX19zZXRlcnJub19mcm9tX3dpbl9l
cnJvciAocmV0KTsNCiAgIGVsc2UgaWYgKChmaHNbMF0gPSAoZmhhbmRsZXJf
cGlwZSAqKSBidWlsZF9maF9kZXYgKCpwaXBlcl9kZXYpKSA9PSBOVUxMKQ0K
QEAgLTYwMSw2ICs2MjQsMTY4IEBAIGZoYW5kbGVyX3BpcGU6OmNyZWF0ZSAo
ZmhhbmRsZXJfcGlwZSAqZmhzWzJdLCB1bnNpZ25lZCBwc2l6ZSwgaW50IG1v
ZGUpDQogICByZXR1cm4gcmVzOw0KIH0NCiANCitOVFNUQVRVUw0KK2ZoYW5k
bGVyX3BpcGU6Om5wZnNfaGFuZGxlIChIQU5ETEUgJm5waCkNCit7DQorICBz
dGF0aWMgTk9fQ09QWSBTUldMT0NLIG5wZnNfbG9jazsNCisgIHN0YXRpYyBO
T19DT1BZIEhBTkRMRSBucGZzX2Rpcmg7DQorDQorICBOVFNUQVRVUyBzdGF0
dXMgPSBTVEFUVVNfU1VDQ0VTUzsNCisgIE9CSkVDVF9BVFRSSUJVVEVTIGF0
dHI7DQorICBJT19TVEFUVVNfQkxPQ0sgaW87DQorDQorICAvKiBMb2NrbGVz
cyBhZnRlciBmaXJzdCBjYWxsLiAqLw0KKyAgaWYgKG5wZnNfZGlyaCkNCisg
ICAgew0KKyAgICAgIG5waCA9IG5wZnNfZGlyaDsNCisgICAgICByZXR1cm4g
U1RBVFVTX1NVQ0NFU1M7DQorICAgIH0NCisgIEFjcXVpcmVTUldMb2NrRXhj
bHVzaXZlICgmbnBmc19sb2NrKTsNCisgIGlmICghbnBmc19kaXJoKQ0KKyAg
ICB7DQorICAgICAgSW5pdGlhbGl6ZU9iamVjdEF0dHJpYnV0ZXMgKCZhdHRy
LCAmcm9fdV9ucGZzLCAwLCBOVUxMLCBOVUxMKTsNCisgICAgICBzdGF0dXMg
PSBOdE9wZW5GaWxlICgmbnBmc19kaXJoLCBGSUxFX1JFQURfQVRUUklCVVRF
UyB8IFNZTkNIUk9OSVpFLA0KKwkJCSAgICZhdHRyLCAmaW8sIEZJTEVfU0hB
UkVfUkVBRCB8IEZJTEVfU0hBUkVfV1JJVEUsDQorCQkJICAgMCk7DQorICAg
IH0NCisgIFJlbGVhc2VTUldMb2NrRXhjbHVzaXZlICgmbnBmc19sb2NrKTsN
CisgIGlmIChOVF9TVUNDRVNTIChzdGF0dXMpKQ0KKyAgICBucGggPSBucGZz
X2Rpcmg7DQorICByZXR1cm4gc3RhdHVzOw0KK30NCisNCitzdGF0aWMgaW50
DQorbnRfY3JlYXRlIChMUFNFQ1VSSVRZX0FUVFJJQlVURVMgc2FfcHRyLCBQ
SEFORExFIHIsIFBIQU5ETEUgdywNCisJCURXT1JEIHBzaXplLCBpbnQ2NF90
ICp1bmlxdWVfaWQpDQorew0KKyAgTlRTVEFUVVMgc3RhdHVzOw0KKyAgSEFO
RExFIG5wZnNoOw0KKyAgQUNDRVNTX01BU0sgYWNjZXNzOw0KKyAgT0JKRUNU
X0FUVFJJQlVURVMgYXR0cjsNCisgIElPX1NUQVRVU19CTE9DSyBpbzsNCisg
IExBUkdFX0lOVEVHRVIgdGltZW91dDsNCisNCisgIC8qIERlZmF1bHQgdG8g
ZXJyb3IuICovDQorICBpZiAocikNCisgICAgKnIgPSBOVUxMOw0KKyAgaWYg
KHcpDQorICAgICp3ID0gTlVMTDsNCisNCisgIHN0YXR1cyA9IGZoYW5kbGVy
X3BpcGU6Om5wZnNfaGFuZGxlIChucGZzaCk7DQorICBpZiAoIU5UX1NVQ0NF
U1MgKHN0YXR1cykpDQorICAgIHsNCisgICAgICBfX3NldGVycm5vX2Zyb21f
bnRfc3RhdHVzIChzdGF0dXMpOw0KKyAgICAgIHJldHVybiBHZXRMYXN0RXJy
b3IgKCk7DQorICAgIH0NCisNCisgIC8qIEVuc3VyZSB0aGF0IHRoZXJlIGlz
IGVub3VnaCBwaXBlIGJ1ZmZlciBzcGFjZSBmb3IgYXRvbWljIHdyaXRlcy4g
ICovDQorICBpZiAoIXBzaXplKQ0KKyAgICBwc2l6ZSA9IERFRkFVTFRfUElQ
RUJVRlNJWkU7DQorDQorICBVTklDT0RFX1NUUklORyBwaXBlbmFtZTsNCisg
IFdDSEFSIHBpcGVuYW1lX2J1ZltNQVhfUEFUSF07DQorICBzaXplX3QgbGVu
ID0gX19zbWFsbF9zd3ByaW50ZiAocGlwZW5hbWVfYnVmLCBMIiVTLSV1LSIs
DQorCQkJCSAmY3lnaGVhcC0+aW5zdGFsbGF0aW9uX2tleSwNCisJCQkJIEdl
dEN1cnJlbnRQcm9jZXNzSWQgKCkpOw0KKw0KKyAgYWNjZXNzID0gR0VORVJJ
Q19SRUFEIHwgRklMRV9XUklURV9BVFRSSUJVVEVTOw0KKw0KKyAgVUxPTkcg
cGlwZV90eXBlID0gcGlwZV9ieXRlID8gRklMRV9QSVBFX0JZVEVfU1RSRUFN
X1RZUEUNCisgICAgOiBGSUxFX1BJUEVfTUVTU0FHRV9UWVBFOw0KKw0KKyAg
LyogUmV0cnkgTnRDcmVhdGVOYW1lZFBpcGVGaWxlIGFzIGxvbmcgYXMgdGhl
IHBpcGUgbmFtZSBpcyBpbiB1c2UuDQorICAgICBSZXRyeWluZyB3aWxsIHBy
b2JhYmx5IG5ldmVyIGJlIG5lY2Vzc2FyeSwgYnV0IHdlIHdhbnQNCisgICAg
IHRvIGJlIGFzIHJvYnVzdCBhcyBwb3NzaWJsZS4gICovDQorICBEV09SRCBl
cnIgPSAwOw0KKyAgd2hpbGUgKHIgJiYgISpyKQ0KKyAgICB7DQorICAgICAg
c3RhdGljIHZvbGF0aWxlIFVMT05HIHBpcGVfdW5pcXVlX2lkOw0KKyAgICAg
IExPTkcgaWQgPSBJbnRlcmxvY2tlZEluY3JlbWVudCAoKExPTkcgKikgJnBp
cGVfdW5pcXVlX2lkKTsNCisgICAgICBfX3NtYWxsX3N3cHJpbnRmIChwaXBl
bmFtZV9idWYgKyBsZW4sIEwicGlwZS1udC0lcCIsIGlkKTsNCisgICAgICBp
ZiAodW5pcXVlX2lkKQ0KKwkqdW5pcXVlX2lkID0gKChpbnQ2NF90KSBpZCA8
PCAzMiB8IEdldEN1cnJlbnRQcm9jZXNzSWQgKCkpOw0KKw0KKyAgICAgIGRl
YnVnX3ByaW50ZiAoIm5hbWUgJVcsIHNpemUgJXUsIG1vZGUgJXMiLCBwaXBl
bmFtZV9idWYsIHBzaXplLA0KKwkJICAgIChwaXBlX3R5cGUgJiBGSUxFX1BJ
UEVfTUVTU0FHRV9UWVBFKQ0KKwkJICAgID8gIlBJUEVfVFlQRV9NRVNTQUdF
IiA6ICJQSVBFX1RZUEVfQllURSIpOw0KKw0KKyAgICAgIFJ0bEluaXRVbmlj
b2RlU3RyaW5nICgmcGlwZW5hbWUsIHBpcGVuYW1lX2J1Zik7DQorDQorICAg
ICAgSW5pdGlhbGl6ZU9iamVjdEF0dHJpYnV0ZXMgKCZhdHRyLCAmcGlwZW5h
bWUsDQorCQkJCSAgc2FfcHRyLT5iSW5oZXJpdEhhbmRsZSA/IE9CSl9JTkhF
UklUIDogMCwNCisJCQkJICBucGZzaCwgc2FfcHRyLT5scFNlY3VyaXR5RGVz
Y3JpcHRvcik7DQorDQorICAgICAgdGltZW91dC5RdWFkUGFydCA9IC01MDAw
MDA7DQorICAgICAgc3RhdHVzID0gTnRDcmVhdGVOYW1lZFBpcGVGaWxlIChy
LCBhY2Nlc3MsICZhdHRyLCAmaW8sDQorCQkJCSAgICAgIEZJTEVfU0hBUkVf
UkVBRCB8IEZJTEVfU0hBUkVfV1JJVEUsDQorCQkJCSAgICAgIEZJTEVfQ1JF
QVRFLCAwLCBwaXBlX3R5cGUsDQorCQkJCSAgICAgIEZJTEVfUElQRV9CWVRF
X1NUUkVBTV9NT0RFLA0KKwkJCQkgICAgICAwLCAxLCBwc2l6ZSwgcHNpemUs
ICZ0aW1lb3V0KTsNCisNCisgICAgICBpZiAoTlRfU1VDQ0VTUyAoc3RhdHVz
KSkNCisJew0KKwkgIGRlYnVnX3ByaW50ZiAoInBpcGUgcmVhZCBoYW5kbGUg
JXAiLCAqcik7DQorCSAgZXJyID0gMDsNCisJICBicmVhazsNCisJfQ0KKw0K
KyAgICAgIHN3aXRjaCAoc3RhdHVzKQ0KKwl7DQorCWNhc2UgU1RBVFVTX1BJ
UEVfQlVTWToNCisJY2FzZSBTVEFUVVNfSU5TVEFOQ0VfTk9UX0FWQUlMQUJM
RToNCisJY2FzZSBTVEFUVVNfUElQRV9OT1RfQVZBSUxBQkxFOg0KKwkgIC8q
IFRoZSBwaXBlIGlzIGFscmVhZHkgb3BlbiB3aXRoIGNvbXBhdGlibGUgcGFy
YW1ldGVycy4NCisJICAgICBQaWNrIGEgbmV3IG5hbWUgYW5kIHJldHJ5LiAg
Ki8NCisJICBkZWJ1Z19wcmludGYgKCJwaXBlIGJ1c3ksIHJldHJ5aW5nIik7
DQorCSAgKnIgPSBOVUxMOw0KKwkgIGJyZWFrOw0KKwljYXNlIFNUQVRVU19B
Q0NFU1NfREVOSUVEOg0KKwkgIC8qIFRoZSBwaXBlIGlzIGFscmVhZHkgb3Bl
biB3aXRoIGluY29tcGF0aWJsZSBwYXJhbWV0ZXJzLg0KKwkgICAgIFBpY2sg
YSBuZXcgbmFtZSBhbmQgcmV0cnkuICAqLw0KKwkgIGRlYnVnX3ByaW50ZiAo
InBpcGUgYWNjZXNzIGRlbmllZCwgcmV0cnlpbmciKTsNCisJICAqciA9IE5V
TEw7DQorCSAgYnJlYWs7DQorCWRlZmF1bHQ6DQorCSAgew0KKwkgICAgX19z
ZXRlcnJub19mcm9tX250X3N0YXR1cyAoc3RhdHVzKTsNCisJICAgIGVyciA9
IEdldExhc3RFcnJvciAoKTsNCisJICAgIGRlYnVnX3ByaW50ZiAoImZhaWxl
ZCwgJUUiKTsNCisJICAgICpyID0gSU5WQUxJRF9IQU5ETEVfVkFMVUU7DQor
CSAgfQ0KKwl9DQorICAgIH0NCisNCisgIGlmIChlcnIpDQorICAgIHsNCisg
ICAgICAqciA9IE5VTEw7DQorICAgICAgcmV0dXJuIGVycjsNCisgICAgfQ0K
Kw0KKyAgaWYgKCF3KQ0KKyAgICBkZWJ1Z19wcmludGYgKCJwaXBlIHdyaXRl
IGhhbmRsZSBOVUxMIik7DQorICBlbHNlDQorICAgIHsNCisgICAgICBkZWJ1
Z19wcmludGYgKCJOdE9wZW5GaWxlOiBuYW1lICVTIiwgJnBpcGVuYW1lKTsN
CisNCisgICAgICBhY2Nlc3MgPSBHRU5FUklDX1dSSVRFIHwgRklMRV9SRUFE
X0FUVFJJQlVURVM7DQorICAgICAgc3RhdHVzID0gTnRPcGVuRmlsZSAodywg
YWNjZXNzLCAmYXR0ciwgJmlvLCAwLCAwKTsNCisgICAgICBpZiAoIU5UX1NV
Q0NFU1MgKHN0YXR1cykpDQorCXsNCisJICBEV09SRCBlcnIgPSBHZXRMYXN0
RXJyb3IgKCk7DQorCSAgZGVidWdfcHJpbnRmICgiTnRPcGVuRmlsZSBmYWls
ZWQsIHIgJXAsICVFIiwgcik7DQorCSAgaWYgKHIpDQorCSAgICBDbG9zZUhh
bmRsZSAoKnIpOw0KKwkgICp3ID0gTlVMTDsNCisJICByZXR1cm4gZXJyOw0K
Kwl9DQorDQorICAgICAgZGVidWdfcHJpbnRmICgicGlwZSB3cml0ZSBoYW5k
bGUgJXAiLCAqdyk7DQorICAgIH0NCisNCisgIC8qIFN1Y2Nlc3MuICovDQor
ICByZXR1cm4gMDsNCit9DQorDQogaW50DQogZmhhbmRsZXJfcGlwZTo6aW9j
dGwgKHVuc2lnbmVkIGludCBjbWQsIHZvaWQgKnApDQogew0KLS0gDQoyLjIx
LjANCg0K
