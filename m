Return-Path: <cygwin-patches-return-3758-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 16577 invoked by alias); 27 Mar 2003 11:11:41 -0000
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sources.redhat.com/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sources.redhat.com/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
Received: (qmail 16515 invoked from network); 27 Mar 2003 11:11:39 -0000
X-Authentication-Warning: atacama.four-d.de: mail set sender to <tpfaff@gmx.net> using -f
Date: Thu, 27 Mar 2003 11:11:00 -0000
From: Thomas Pfaff <tpfaff@gmx.net>
To: cygwin-patches@cygwin.com
Subject: [PATCH] The great pthread rename
Message-ID: <Pine.WNT.4.44.0303271208480.486-200000@algeria.intern.net>
X-X-Sender: pfaff@antarctica.intern.net
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="168231-7068-1048763429=:486"
Content-ID: <Pine.WNT.4.44.0303271210330.486@algeria.intern.net>
X-SW-Source: 2003-q1/txt/msg00407.txt.bz2

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--168231-7068-1048763429=:486
Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
Content-ID: <Pine.WNT.4.44.0303271210331.486@algeria.intern.net>
Content-length: 424

Do not try to force me to comment every bit of this patch ;-)

2003-03-27  Thomas Pfaff  <tpfaff@gmx.net>

	* thread.h: Change class names, methods, members and local vars
	according to the GNU coding style.
	* thread.cc: Ditto.
	* dcrt0.cc (dll_crt0_1): Rename pthread::initMainThread call to
	pthread::init_mainthread.
	* pthread.cc (pthead_getsequence_np): Rename pthread::isGoodObject
	call to pthread::is_good_object.


--168231-7068-1048763429=:486
Content-Type: TEXT/PLAIN; NAME="pthread_rename.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.WNT.4.44.0303271210290.486@algeria.intern.net>
Content-Description: 
Content-Disposition: ATTACHMENT; FILENAME="pthread_rename.patch"
Content-length: 104807

ZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi9kY3J0MC5jYyBzcmMv
d2luc3VwL2N5Z3dpbi9kY3J0MC5jYwotLS0gc3JjLm9sZC93aW5zdXAvY3ln
d2luL2RjcnQwLmNjCTIwMDMtMDMtMjcgMTA6MDA6MjUuMDAwMDAwMDAwICsw
MTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9kY3J0MC5jYwkyMDAzLTAzLTI3
IDEwOjAyOjM1LjAwMDAwMDAwMCArMDEwMApAQCAtNjMxLDcgKzYzMSw3IEBA
IGRsbF9jcnQwXzEgKCkKICAgUHJvdGVjdEhhbmRsZSAoaE1haW5UaHJlYWQp
OwogICBjeWd0aHJlYWQ6OmluaXQgKCk7CiAKLSAgcHRocmVhZDo6aW5pdE1h
aW5UaHJlYWQgKCF1c2VyX2RhdGEtPmZvcmtlZSk7CisgIHB0aHJlYWQ6Omlu
aXRfbWFpbnRocmVhZCAoIXVzZXJfZGF0YS0+Zm9ya2VlKTsKIAogICAvKiBJ
bml0aWFsaXplIGRlYnVnIG11dG8sIGlmIERMTCBpcyBidWlsdCB3aXRoIC0t
ZW5hYmxlLWRlYnVnZ2luZy4KICAgICAgTmVlZCB0byBkbyB0aGlzIGJlZm9y
ZSBhbnkgaGVscGVyIHRocmVhZHMgc3RhcnQuICovCmRpZmYgLXVycCBzcmMu
b2xkL3dpbnN1cC9jeWd3aW4vcHRocmVhZC5jYyBzcmMvd2luc3VwL2N5Z3dp
bi9wdGhyZWFkLmNjCi0tLSBzcmMub2xkL3dpbnN1cC9jeWd3aW4vcHRocmVh
ZC5jYwkyMDAzLTAzLTI3IDEwOjAwOjI1LjAwMDAwMDAwMCArMDEwMAorKysg
c3JjL3dpbnN1cC9jeWd3aW4vcHRocmVhZC5jYwkyMDAzLTAzLTI2IDE0OjM4
OjA4LjAwMDAwMDAwMCArMDEwMApAQCAtNzMsNyArNzMsNyBAQCBwdGhyZWFk
X2NvbnRpbnVlIChwdGhyZWFkX3QgdGhyZWFkKQogdW5zaWduZWQgbG9uZwog
cHRocmVhZF9nZXRzZXF1ZW5jZV9ucCAocHRocmVhZF90ICogdGhyZWFkKQog
ewotICBpZiAoIXB0aHJlYWQ6OmlzR29vZE9iamVjdCAodGhyZWFkKSkKKyAg
aWYgKCFwdGhyZWFkOjppc19nb29kX29iamVjdCAodGhyZWFkKSkKICAgICBy
ZXR1cm4gRUlOVkFMOwogICByZXR1cm4gKCp0aHJlYWQpLT5nZXRzZXF1ZW5j
ZV9ucCAoKTsKIH0KZGlmZiAtdXJwIHNyYy5vbGQvd2luc3VwL2N5Z3dpbi90
aHJlYWQuY2Mgc3JjL3dpbnN1cC9jeWd3aW4vdGhyZWFkLmNjCi0tLSBzcmMu
b2xkL3dpbnN1cC9jeWd3aW4vdGhyZWFkLmNjCTIwMDMtMDMtMjcgMTA6MDA6
MjUuMDAwMDAwMDAwICswMTAwCisrKyBzcmMvd2luc3VwL2N5Z3dpbi90aHJl
YWQuY2MJMjAwMy0wMy0yNyAxMDowNzo0MS4wMDAwMDAwMDAgKzAxMDAKQEAg
LTcyLDcgKzcyLDcgQEAgX3JlZW50X3dpbnN1cCAoKQogfQogCiBib29sCi1u
YXRpdmVNdXRleDo6aW5pdCAoKQorbmF0aXZlX211dGV4Ojppbml0ICgpCiB7
CiAgIHRoZUhhbmRsZSA9IENyZWF0ZU11dGV4ICgmc2VjX25vbmVfbmloLCBG
QUxTRSwgTlVMTCk7CiAgIGlmICghdGhlSGFuZGxlKQpAQCAtODQsNyArODQs
NyBAQCBuYXRpdmVNdXRleDo6aW5pdCAoKQogfQogCiBib29sCi1uYXRpdmVN
dXRleDo6bG9jayAoKQorbmF0aXZlX211dGV4Ojpsb2NrICgpCiB7CiAgIERX
T1JEIHdhaXRSZXN1bHQgPSBXYWl0Rm9yU2luZ2xlT2JqZWN0ICh0aGVIYW5k
bGUsIElORklOSVRFKTsKICAgaWYgKHdhaXRSZXN1bHQgIT0gV0FJVF9PQkpF
Q1RfMCkKQEAgLTk2LDcgKzk2LDcgQEAgbmF0aXZlTXV0ZXg6OmxvY2sgKCkK
IH0KIAogdm9pZAotbmF0aXZlTXV0ZXg6OnVubG9jayAoKQorbmF0aXZlX211
dGV4Ojp1bmxvY2sgKCkKIHsKICAgaWYgKCFSZWxlYXNlTXV0ZXggKHRoZUhh
bmRsZSkpCiAgICAgc3lzdGVtX3ByaW50ZiAoIlJlY2VpdmVkIGEgdW5leHBl
Y3RlZCByZXN1bHQgcmVsZWFzaW5nIG11dGV4LiAlRSIpOwpAQCAtMTk3LDkg
KzE5Nyw5IEBAIE1UaW50ZXJmYWNlOjpJbml0IChpbnQgZm9ya2VkKQogICBp
ZiAoIWZvcmtlZCkKICAgICByZWVudF9rZXkuc2V0ICgmcmVlbnRzKTsKIAot
ICBwdGhyZWFkX211dGV4Ojppbml0TXV0ZXggKCk7Ci0gIHB0aHJlYWRfY29u
ZDo6aW5pdE11dGV4ICgpOwotICBwdGhyZWFkX3J3bG9jazo6aW5pdE11dGV4
ICgpOworICBwdGhyZWFkX211dGV4Ojppbml0X211dGV4ICgpOworICBwdGhy
ZWFkX2NvbmQ6OmluaXRfbXV0ZXggKCk7CisgIHB0aHJlYWRfcndsb2NrOjpp
bml0X211dGV4ICgpOwogfQogCiB2b2lkCkBAIC0yMTUsNyArMjE1LDcgQEAg
TVRpbnRlcmZhY2U6OmZpeHVwX2FmdGVyX2ZvcmsgKHZvaWQpCiAgIHB0aHJl
YWRfa2V5OjpmaXh1cF9hZnRlcl9mb3JrICgpOwogCiAgIHRocmVhZGNvdW50
ID0gMTsKLSAgcHRocmVhZDo6aW5pdE1haW5UaHJlYWQgKHRydWUpOworICBw
dGhyZWFkOjppbml0X21haW50aHJlYWQgKHRydWUpOwogCiAgIHB0aHJlYWRf
bXV0ZXg6OmZpeHVwX2FmdGVyX2ZvcmsgKCk7CiAgIHB0aHJlYWRfY29uZDo6
Zml4dXBfYWZ0ZXJfZm9yayAoKTsKQEAgLTIyNywxMiArMjI3LDEyIEBAIE1U
aW50ZXJmYWNlOjpmaXh1cF9hZnRlcl9mb3JrICh2b2lkKQogCiAvKiBzdGF0
aWMgbWV0aG9kcyAqLwogdm9pZAotcHRocmVhZDo6aW5pdE1haW5UaHJlYWQg
KGJvb2wgZG9faW5pdCkKK3B0aHJlYWQ6OmluaXRfbWFpbnRocmVhZCAoYm9v
bCBkb19pbml0KQogewogICBpZiAoIWRvX2luaXQpCiAgICAgcmV0dXJuOwog
Ci0gIHB0aHJlYWQgKnRocmVhZCA9IGdldFRsc1NlbGZQb2ludGVyICgpOwor
ICBwdGhyZWFkICp0aHJlYWQgPSBnZXRfdGxzX3NlbGZfcG9pbnRlciAoKTsK
ICAgaWYgKCF0aHJlYWQpCiAgICAgewogICAgICAgdGhyZWFkID0gbmV3IHB0
aHJlYWQgKCk7CkBAIC0yNDAsMjYgKzI0MCwyNiBAQCBwdGhyZWFkOjppbml0
TWFpblRocmVhZCAoYm9vbCBkb19pbml0KQogCWFwaV9mYXRhbCAoImZhaWxl
ZCB0byBjcmVhdGUgbWFpbnRocmVhZCBvYmplY3QiKTsKICAgICB9CiAKLSAg
dGhyZWFkLT5pbml0Q3VycmVudFRocmVhZCAoKTsKKyAgdGhyZWFkLT5pbml0
X2N1cnJlbnRfdGhyZWFkICgpOwogfQogCiBwdGhyZWFkICoKIHB0aHJlYWQ6
OnNlbGYgKCkKIHsKLSAgcHRocmVhZCAqdGhyZWFkID0gZ2V0VGxzU2VsZlBv
aW50ZXIgKCk7CisgIHB0aHJlYWQgKnRocmVhZCA9IGdldF90bHNfc2VsZl9w
b2ludGVyICgpOwogICBpZiAodGhyZWFkKQogICAgIHJldHVybiB0aHJlYWQ7
Ci0gIHJldHVybiBwdGhyZWFkTnVsbDo6Z2V0TnVsbHB0aHJlYWQgKCk7Cisg
IHJldHVybiBwdGhyZWFkX251bGw6OmdldF9udWxsX3B0aHJlYWQgKCk7CiB9
CiAKIHZvaWQKLXB0aHJlYWQ6OnNldFRsc1NlbGZQb2ludGVyIChwdGhyZWFk
ICp0aGlzVGhyZWFkKQorcHRocmVhZDo6c2V0X3Rsc19zZWxmX3BvaW50ZXIg
KHB0aHJlYWQgKnRoaXNUaHJlYWQpCiB7CiAgIE1UX0lOVEVSRkFDRS0+dGhy
ZWFkX3NlbGZfa2V5LnNldCAodGhpc1RocmVhZCk7CiB9CiAKIHB0aHJlYWQg
KgotcHRocmVhZDo6Z2V0VGxzU2VsZlBvaW50ZXIgKCkKK3B0aHJlYWQ6Omdl
dF90bHNfc2VsZl9wb2ludGVyICgpCiB7CiAgIHJldHVybiAocHRocmVhZCAq
KSBNVF9JTlRFUkZBQ0UtPnRocmVhZF9zZWxmX2tleS5nZXQgKCk7CiB9CkBA
IC0yODIsNyArMjgyLDcgQEAgcHRocmVhZDo6fnB0aHJlYWQgKCkKIH0KIAog
dm9pZAotcHRocmVhZDo6c2V0VGhyZWFkSWR0b0N1cnJlbnQgKCkKK3B0aHJl
YWQ6OnNldF90aHJlYWRfaWRfdG9fY3VycmVudCAoKQogewogICB0aHJlYWRf
aWQgPSBHZXRDdXJyZW50VGhyZWFkSWQgKCk7CiB9CkBAIC0zMDQsNyArMzA0
LDcgQEAgcHRocmVhZDo6cHJlY3JlYXRlIChwdGhyZWFkX2F0dHIgKm5ld2F0
dAogICAgICAgYXR0ci5zdGFja3NpemUgPSBuZXdhdHRyLT5zdGFja3NpemU7
CiAgICAgfQogCi0gIGlmICghcHRocmVhZF9tdXRleDo6aXNHb29kT2JqZWN0
ICgmdmVyaWZ5YWJsZV9tdXRleF9vYmopKQorICBpZiAoIXB0aHJlYWRfbXV0
ZXg6OmlzX2dvb2Rfb2JqZWN0ICgmdmVyaWZ5YWJsZV9tdXRleF9vYmopKQog
ICAgIHsKICAgICAgIHRocmVhZF9wcmludGYgKCJOZXcgdGhyZWFkIG9iamVj
dCBhY2Nlc3MgbXV0ZXggaXMgbm90IHZhbGlkLiB0aGlzICVwIiwKIAkJICAg
ICB0aGlzKTsKQEAgLTM2OSwxNiArMzY5LDE2IEBAIHB0aHJlYWQ6OmV4aXQg
KHZvaWQgKnZhbHVlX3B0cikKICAgLy8gcnVuIGNsZWFudXAgaGFuZGxlcnMK
ICAgcG9wX2FsbF9jbGVhbnVwX2hhbmRsZXJzICgpOwogCi0gIHB0aHJlYWRf
a2V5OjpydW5BbGxEZXN0cnVjdG9ycyAoKTsKKyAgcHRocmVhZF9rZXk6OnJ1
bl9hbGxfZGVzdHJ1Y3RvcnMgKCk7CiAKLSAgbXV0ZXguTG9jayAoKTsKKyAg
bXV0ZXgubG9jayAoKTsKICAgLy8gY2xlYW51cCBpZiB0aHJlYWQgaXMgaW4g
ZGV0YWNoZWQgc3RhdGUgYW5kIG5vdCBqb2luZWQKICAgaWYgKHB0aHJlYWRf
ZXF1YWwgKGpvaW5lciwgdGhyZWFkKSkKICAgICBkZWxldGUgdGhpczsKICAg
ZWxzZQogICAgIHsKICAgICAgIHJldHVybl9wdHIgPSB2YWx1ZV9wdHI7Ci0g
ICAgICBtdXRleC5VbkxvY2sgKCk7CisgICAgICBtdXRleC51bmxvY2sgKCk7
CiAgICAgfQogCiAgIGlmIChJbnRlcmxvY2tlZERlY3JlbWVudCAoJk1UX0lO
VEVSRkFDRS0+dGhyZWFkY291bnQpID09IDApCkBAIC0zOTMsMjAgKzM5Mywy
MCBAQCBwdGhyZWFkOjpjYW5jZWwgKHZvaWQpCiAgIGNsYXNzIHB0aHJlYWQg
KnRocmVhZCA9IHRoaXM7CiAgIGNsYXNzIHB0aHJlYWQgKnNlbGYgPSBwdGhy
ZWFkOjpzZWxmICgpOwogCi0gIG11dGV4LkxvY2sgKCk7CisgIG11dGV4Lmxv
Y2sgKCk7CiAKICAgaWYgKGNhbmNlbHR5cGUgPT0gUFRIUkVBRF9DQU5DRUxf
REVGRVJSRUQgfHwKICAgICAgIGNhbmNlbHN0YXRlID09IFBUSFJFQURfQ0FO
Q0VMX0RJU0FCTEUpCiAgICAgewogICAgICAgLy8gY2FuY2VsIGRlZmVycmVk
Ci0gICAgICBtdXRleC5VbkxvY2sgKCk7CisgICAgICBtdXRleC51bmxvY2sg
KCk7CiAgICAgICBTZXRFdmVudCAoY2FuY2VsX2V2ZW50KTsKICAgICAgIHJl
dHVybiAwOwogICAgIH0KIAogICBlbHNlIGlmIChwdGhyZWFkX2VxdWFsICh0
aHJlYWQsIHNlbGYpKQogICAgIHsKLSAgICAgIG11dGV4LlVuTG9jayAoKTsK
KyAgICAgIG11dGV4LnVubG9jayAoKTsKICAgICAgIGNhbmNlbF9zZWxmICgp
OwogICAgICAgcmV0dXJuIDA7IC8vIE5ldmVyIHJlYWNoZWQKICAgICB9CkBA
IC00MjEsNyArNDIxLDcgQEAgcHRocmVhZDo6Y2FuY2VsICh2b2lkKQogICAg
ICAgY29udGV4dC5FaXAgPSAoRFdPUkQpIHB0aHJlYWQ6OnN0YXRpY19jYW5j
ZWxfc2VsZjsKICAgICAgIFNldFRocmVhZENvbnRleHQgKHdpbjMyX29ial9p
ZCwgJmNvbnRleHQpOwogICAgIH0KLSAgbXV0ZXguVW5Mb2NrICgpOworICBt
dXRleC51bmxvY2sgKCk7CiAgIFJlc3VtZVRocmVhZCAod2luMzJfb2JqX2lk
KTsKIAogICByZXR1cm4gMDsKQEAgLTYyNCw3ICs2MjQsNyBAQCBwdGhyZWFk
OjpjYW5jZWxhYmxlX3dhaXQgKEhBTkRMRSBvYmplY3QsCiAgIEhBTkRMRSB3
YWl0X29iamVjdHNbMl07CiAgIHB0aHJlYWRfdCB0aHJlYWQgPSBzZWxmICgp
OwogCi0gIGlmICghaXNHb29kT2JqZWN0ICgmdGhyZWFkKSB8fCB0aHJlYWQt
PmNhbmNlbHN0YXRlID09IFBUSFJFQURfQ0FOQ0VMX0RJU0FCTEUpCisgIGlm
ICghaXNfZ29vZF9vYmplY3QgKCZ0aHJlYWQpIHx8IHRocmVhZC0+Y2FuY2Vs
c3RhdGUgPT0gUFRIUkVBRF9DQU5DRUxfRElTQUJMRSkKICAgICByZXR1cm4g
V2FpdEZvclNpbmdsZU9iamVjdCAob2JqZWN0LCB0aW1lb3V0KTsKIAogICAv
LyBEbyBub3QgY2hhbmdlIHRoZSB3YWl0IG9yZGVyCkBAIC02NDUsNyArNjQ1
LDcgQEAgcHRocmVhZDo6c2V0Y2FuY2Vsc3RhdGUgKGludCBzdGF0ZSwgaW50
IAogewogICBpbnQgcmVzdWx0ID0gMDsKIAotICBtdXRleC5Mb2NrICgpOwor
ICBtdXRleC5sb2NrICgpOwogCiAgIGlmIChzdGF0ZSAhPSBQVEhSRUFEX0NB
TkNFTF9FTkFCTEUgJiYgc3RhdGUgIT0gUFRIUkVBRF9DQU5DRUxfRElTQUJM
RSkKICAgICByZXN1bHQgPSBFSU5WQUw7CkBAIC02NTYsNyArNjU2LDcgQEAg
cHRocmVhZDo6c2V0Y2FuY2Vsc3RhdGUgKGludCBzdGF0ZSwgaW50IAogICAg
ICAgY2FuY2Vsc3RhdGUgPSBzdGF0ZTsKICAgICB9CiAKLSAgbXV0ZXguVW5M
b2NrICgpOworICBtdXRleC51bmxvY2sgKCk7CiAKICAgcmV0dXJuIHJlc3Vs
dDsKIH0KQEAgLTY2Niw3ICs2NjYsNyBAQCBwdGhyZWFkOjpzZXRjYW5jZWx0
eXBlIChpbnQgdHlwZSwgaW50ICpvCiB7CiAgIGludCByZXN1bHQgPSAwOwog
Ci0gIG11dGV4LkxvY2sgKCk7CisgIG11dGV4LmxvY2sgKCk7CiAKICAgaWYg
KHR5cGUgIT0gUFRIUkVBRF9DQU5DRUxfREVGRVJSRUQgJiYgdHlwZSAhPSBQ
VEhSRUFEX0NBTkNFTF9BU1lOQ0hST05PVVMpCiAgICAgcmVzdWx0ID0gRUlO
VkFMOwpAQCAtNjc3LDcgKzY3Nyw3IEBAIHB0aHJlYWQ6OnNldGNhbmNlbHR5
cGUgKGludCB0eXBlLCBpbnQgKm8KICAgICAgIGNhbmNlbHR5cGUgPSB0eXBl
OwogICAgIH0KIAotICBtdXRleC5VbkxvY2sgKCk7CisgIG11dGV4LnVubG9j
ayAoKTsKIAogICByZXR1cm4gcmVzdWx0OwogfQpAQCAtNjk5LDcgKzY5OSw3
IEBAIHB0aHJlYWQ6OnBvcF9jbGVhbnVwX2hhbmRsZXIgKGludCBjb25zdCAK
ICAgICAvLyBUT0RPOiBzZW5kIGEgc2lnbmFsIG9yIHNvbWV0aGluZyB0byB0
aGUgdGhyZWFkID8KICAgICBhcGlfZmF0YWwgKCJBdHRlbXB0IHRvIGV4ZWN1
dGUgYSBjbGVhbnVwIGhhbmRsZXIgYWNyb3NzIHRocmVhZHMiKTsKIAotICBt
dXRleC5Mb2NrICgpOworICBtdXRleC5sb2NrICgpOwogCiAgIGlmIChjbGVh
bnVwX3N0YWNrICE9IE5VTEwpCiAgICAgewpAQCAtNzEwLDcgKzcxMCw3IEBA
IHB0aHJlYWQ6OnBvcF9jbGVhbnVwX2hhbmRsZXIgKGludCBjb25zdCAKICAg
ICAgIGNsZWFudXBfc3RhY2sgPSBoYW5kbGVyLT5uZXh0OwogICAgIH0KIAot
ICBtdXRleC5VbkxvY2sgKCk7CisgIG11dGV4LnVubG9jayAoKTsKIH0KIAog
dm9pZApAQCAtNzI3LDI2ICs3MjcsMjYgQEAgcHRocmVhZDo6Y2FuY2VsX3Nl
bGYgKCkKIH0KIAogRFdPUkQKLXB0aHJlYWQ6OmdldFRocmVhZElkICgpCitw
dGhyZWFkOjpnZXRfdGhyZWFkX2lkICgpCiB7CiAgIHJldHVybiB0aHJlYWRf
aWQ7CiB9CiAKIHZvaWQKLXB0aHJlYWQ6OmluaXRDdXJyZW50VGhyZWFkICgp
CitwdGhyZWFkOjppbml0X2N1cnJlbnRfdGhyZWFkICgpCiB7CiAgIGNhbmNl
bF9ldmVudCA9IDo6Q3JlYXRlRXZlbnQgKCZzZWNfbm9uZV9uaWgsIFRSVUUs
IEZBTFNFLCBOVUxMKTsKICAgaWYgKCFEdXBsaWNhdGVIYW5kbGUgKEdldEN1
cnJlbnRQcm9jZXNzICgpLCBHZXRDdXJyZW50VGhyZWFkICgpLAogCQkJR2V0
Q3VycmVudFByb2Nlc3MgKCksICZ3aW4zMl9vYmpfaWQsCiAJCQkwLCBGQUxT
RSwgRFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKICAgICB3aW4zMl9vYmpfaWQg
PSBOVUxMOwotICBzZXRUaHJlYWRJZHRvQ3VycmVudCAoKTsKLSAgc2V0VGxz
U2VsZlBvaW50ZXIgKHRoaXMpOworICBzZXRfdGhyZWFkX2lkX3RvX2N1cnJl
bnQgKCk7CisgIHNldF90bHNfc2VsZl9wb2ludGVyICh0aGlzKTsKIH0KIAog
Lyogc3RhdGljIG1lbWJlcnMgKi8KIGJvb2wKLXB0aHJlYWRfYXR0cjo6aXNH
b29kT2JqZWN0IChwdGhyZWFkX2F0dHJfdCBjb25zdCAqYXR0cikKK3B0aHJl
YWRfYXR0cjo6aXNfZ29vZF9vYmplY3QgKHB0aHJlYWRfYXR0cl90IGNvbnN0
ICphdHRyKQogewogICBpZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAo
YXR0ciwgUFRIUkVBRF9BVFRSX01BR0lDKSAhPSBWQUxJRF9PQkpFQ1QpCiAg
ICAgcmV0dXJuIGZhbHNlOwpAQCAtNzY3LDcgKzc2Nyw3IEBAIHB0aHJlYWRf
YXR0cjo6fnB0aHJlYWRfYXR0ciAoKQogfQogCiBib29sCi1wdGhyZWFkX2Nv
bmRhdHRyOjppc0dvb2RPYmplY3QgKHB0aHJlYWRfY29uZGF0dHJfdCBjb25z
dCAqYXR0cikKK3B0aHJlYWRfY29uZGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChw
dGhyZWFkX2NvbmRhdHRyX3QgY29uc3QgKmF0dHIpCiB7CiAgIGlmICh2ZXJp
ZnlhYmxlX29iamVjdF9pc3ZhbGlkIChhdHRyLCBQVEhSRUFEX0NPTkRBVFRS
X01BR0lDKSAhPSBWQUxJRF9PQkpFQ1QpCiAgICAgcmV0dXJuIGZhbHNlOwpA
QCAtNzg2LDIyICs3ODYsMjIgQEAgcHRocmVhZF9jb25kYXR0cjo6fnB0aHJl
YWRfY29uZGF0dHIgKCkKIExpc3Q8cHRocmVhZF9jb25kPiBwdGhyZWFkX2Nv
bmQ6OmNvbmRzOwogCiAvKiBUaGlzIGlzIHVzZWQgZm9yIGNvbmQgY3JlYXRp
b24gcHJvdGVjdGlvbiB3aXRoaW4gYSBzaW5nbGUgcHJvY2VzcyBvbmx5ICov
Ci1uYXRpdmVNdXRleCBOT19DT1BZIHB0aHJlYWRfY29uZDo6Y29uZEluaXRp
YWxpemF0aW9uTG9jazsKK25hdGl2ZV9tdXRleCBOT19DT1BZIHB0aHJlYWRf
Y29uZDo6Y29uZF9pbml0aWFsaXphdGlvbl9sb2NrOwogCiAvKiBXZSBjYW4g
b25seSBiZSBjYWxsZWQgb25jZS4KICAgIFRPRE86IChubyBydXNoKSB1c2Ug
YSBub24gY29waWVkIG1lbW9yeSBzZWN0aW9uIHRvCiAgICBob2xkIGFuIGlu
aXRpYWxpemF0aW9uIGZsYWcuICAqLwogdm9pZAotcHRocmVhZF9jb25kOjpp
bml0TXV0ZXggKCkKK3B0aHJlYWRfY29uZDo6aW5pdF9tdXRleCAoKQogewot
ICBpZiAoIWNvbmRJbml0aWFsaXphdGlvbkxvY2suaW5pdCAoKSkKKyAgaWYg
KCFjb25kX2luaXRpYWxpemF0aW9uX2xvY2suaW5pdCAoKSkKICAgICBhcGlf
ZmF0YWwgKCJDb3VsZCBub3QgY3JlYXRlIHdpbjMyIE11dGV4IGZvciBwdGhy
ZWFkIGNvbmQgc3RhdGljIGluaXRpYWxpemVyIHN1cHBvcnQuIik7CiB9CiAK
IHB0aHJlYWRfY29uZDo6cHRocmVhZF9jb25kIChwdGhyZWFkX2NvbmRhdHRy
ICphdHRyKSA6CiAgIHZlcmlmeWFibGVfb2JqZWN0IChQVEhSRUFEX0NPTkRf
TUFHSUMpLAotICBzaGFyZWQgKDApLCB3YWl0aW5nICgwKSwgcGVuZGluZyAo
MCksIHNlbVdhaXQgKE5VTEwpLAotICBtdHhDb25kKE5VTEwpLCBuZXh0IChO
VUxMKQorICBzaGFyZWQgKDApLCB3YWl0aW5nICgwKSwgcGVuZGluZyAoMCks
IHNlbV93YWl0IChOVUxMKSwKKyAgbXR4X2NvbmQoTlVMTCksIG5leHQgKE5V
TEwpCiB7CiAgIHB0aHJlYWRfbXV0ZXggKnZlcmlmeWFibGVfbXV0ZXhfb2Jq
OwogCkBAIC04MTIsNTQgKzgxMiw1NyBAQCBwdGhyZWFkX2NvbmQ6OnB0aHJl
YWRfY29uZCAocHRocmVhZF9jb25kCiAgICAgICAgIHJldHVybjsKICAgICAg
IH0KIAotICB2ZXJpZnlhYmxlX211dGV4X29iaiA9ICZtdHhJbjsKLSAgaWYg
KCFwdGhyZWFkX211dGV4Ojppc0dvb2RPYmplY3QgKCZ2ZXJpZnlhYmxlX211
dGV4X29iaikpCisgIHZlcmlmeWFibGVfbXV0ZXhfb2JqID0gJm10eF9pbjsK
KyAgaWYgKCFwdGhyZWFkX211dGV4Ojppc19nb29kX29iamVjdCAoJnZlcmlm
eWFibGVfbXV0ZXhfb2JqKSkKICAgICB7CiAgICAgICB0aHJlYWRfcHJpbnRm
ICgiSW50ZXJuYWwgY29uZCBtdXRleCBpcyBub3QgdmFsaWQuIHRoaXMgJXAi
LCB0aGlzKTsKICAgICAgIG1hZ2ljID0gMDsKICAgICAgIHJldHVybjsKICAg
ICB9Ci0gIC8qIENoYW5nZSB0aGUgbXV0ZXggdHlwZSB0byBOT1JNQUwgdG8g
c3BlZWQgdXAgbXV0ZXggb3BlcmF0aW9ucyAqLwotICBtdHhJbi50eXBlID0g
UFRIUkVBRF9NVVRFWF9OT1JNQUw7CisgIC8qCisgICAqIENoYW5nZSB0aGUg
bXV0ZXggdHlwZSB0byBOT1JNQUwuCisgICAqIFRoaXMgbXV0ZXggTVVTVCBi
ZSBvZiB0eXBlIG5vcm1hbAorICAqLworICBtdHhfaW4udHlwZSA9IFBUSFJF
QURfTVVURVhfTk9STUFMOwogCi0gIHZlcmlmeWFibGVfbXV0ZXhfb2JqID0g
Jm10eE91dDsKLSAgaWYgKCFwdGhyZWFkX211dGV4Ojppc0dvb2RPYmplY3Qg
KCZ2ZXJpZnlhYmxlX211dGV4X29iaikpCisgIHZlcmlmeWFibGVfbXV0ZXhf
b2JqID0gJm10eF9vdXQ7CisgIGlmICghcHRocmVhZF9tdXRleDo6aXNfZ29v
ZF9vYmplY3QgKCZ2ZXJpZnlhYmxlX211dGV4X29iaikpCiAgICAgewogICAg
ICAgdGhyZWFkX3ByaW50ZiAoIkludGVybmFsIGNvbmQgbXV0ZXggaXMgbm90
IHZhbGlkLiB0aGlzICVwIiwgdGhpcyk7CiAgICAgICBtYWdpYyA9IDA7CiAg
ICAgICByZXR1cm47CiAgICAgfQogICAvKiBDaGFuZ2UgdGhlIG11dGV4IHR5
cGUgdG8gTk9STUFMIHRvIHNwZWVkIHVwIG11dGV4IG9wZXJhdGlvbnMgKi8K
LSAgbXR4T3V0LnR5cGUgPSBQVEhSRUFEX01VVEVYX05PUk1BTDsKKyAgbXR4
X291dC50eXBlID0gUFRIUkVBRF9NVVRFWF9OT1JNQUw7CiAKLSAgc2VtV2Fp
dCA9IDo6Q3JlYXRlU2VtYXBob3JlICgmc2VjX25vbmVfbmloLCAwLCBMT05H
X01BWCwgTlVMTCk7Ci0gIGlmICghc2VtV2FpdCkKKyAgc2VtX3dhaXQgPSA6
OkNyZWF0ZVNlbWFwaG9yZSAoJnNlY19ub25lX25paCwgMCwgTE9OR19NQVgs
IE5VTEwpOworICBpZiAoIXNlbV93YWl0KQogICAgIHsKICAgICAgIGRlYnVn
X3ByaW50ZiAoIkNyZWF0ZVNlbWFwaG9yZSBmYWlsZWQuICVFIik7CiAgICAg
ICBtYWdpYyA9IDA7CiAgICAgICByZXR1cm47CiAgICAgfQogCi0gIGNvbmRz
Lkluc2VydCAodGhpcyk7CisgIGNvbmRzLmluc2VydCAodGhpcyk7CiB9CiAK
IHB0aHJlYWRfY29uZDo6fnB0aHJlYWRfY29uZCAoKQogewotICBpZiAoc2Vt
V2FpdCkKLSAgICBDbG9zZUhhbmRsZSAoc2VtV2FpdCk7CisgIGlmIChzZW1f
d2FpdCkKKyAgICBDbG9zZUhhbmRsZSAoc2VtX3dhaXQpOwogCi0gIGNvbmRz
LlJlbW92ZSAodGhpcyk7CisgIGNvbmRzLnJlbW92ZSAodGhpcyk7CiB9CiAK
IHZvaWQKLXB0aHJlYWRfY29uZDo6VW5CbG9jayAoY29uc3QgYm9vbCBhbGwp
CitwdGhyZWFkX2NvbmQ6OnVuYmxvY2sgKGNvbnN0IGJvb2wgYWxsKQogewog
ICB1bnNpZ25lZCBsb25nIHJlbGVhc2VhYmxlOwogCiAgIC8qIAogICAgKiBC
bG9jayBvdXRnb2luZyB0aHJlYWRzIChhbmQgYXZvaWQgc2ltdWx0YW5vdXMg
dW5ibG9ja3MpCiAgICAqLwotICBtdHhPdXQuTG9jayAoKTsKKyAgbXR4X291
dC5sb2NrICgpOwogCiAgIHJlbGVhc2VhYmxlID0gd2FpdGluZyAtIHBlbmRp
bmc7CiAgIGlmIChyZWxlYXNlYWJsZSkKQEAgLTg3MSw3ICs4NzQsNyBAQCBw
dGhyZWFkX2NvbmQ6OlVuQmxvY2sgKGNvbnN0IGJvb2wgYWxsKQogICAgICAg
ICAgIC8qIAogICAgICAgICAgICAqIEJsb2NrIGluY29taW5nIHRocmVhZHMg
dW50aWwgYWxsIHdhaXRpbmcgdGhyZWFkcyBhcmUgcmVsZWFzZWQuCiAgICAg
ICAgICAgICovCi0gICAgICAgICAgbXR4SW4uTG9jayAoKTsKKyAgICAgICAg
ICBtdHhfaW4ubG9jayAoKTsKIAogICAgICAgICAgIC8qIAogICAgICAgICAg
ICAqIENhbGN1bGF0ZSByZWxlYXNlYWJsZSBhZ2FpbiBiZWNhdXNlIHRocmVh
ZHMgY2FuIGVudGVyIHVudGlsCkBAIC04ODYsNDAgKzg4OSw0MCBAQCBwdGhy
ZWFkX2NvbmQ6OlVuQmxvY2sgKGNvbnN0IGJvb2wgYWxsKQogICAgICAgLyoK
ICAgICAgICAqIFNpZ25hbCB0aHJlYWRzCiAgICAgICAgKi8KLSAgICAgIDo6
UmVsZWFzZVNlbWFwaG9yZSAoc2VtV2FpdCwgcmVsZWFzZWQsIE5VTEwpOwor
ICAgICAgOjpSZWxlYXNlU2VtYXBob3JlIChzZW1fd2FpdCwgcmVsZWFzZWQs
IE5VTEwpOwogICAgIH0KIAogICAvKgogICAgKiBBbmQgbGV0IHRoZSB0aHJl
YWRzIHJlbGVhc2UuCiAgICAqLwotICBtdHhPdXQuVW5Mb2NrICgpOworICBt
dHhfb3V0LnVubG9jayAoKTsKIH0KIAogaW50Ci1wdGhyZWFkX2NvbmQ6Oldh
aXQgKHB0aHJlYWRfbXV0ZXhfdCBtdXRleCwgRFdPUkQgZHdNaWxsaXNlY29u
ZHMpCitwdGhyZWFkX2NvbmQ6OndhaXQgKHB0aHJlYWRfbXV0ZXhfdCBtdXRl
eCwgRFdPUkQgZHdNaWxsaXNlY29uZHMpCiB7CiAgIERXT1JEIHJ2OwogCi0g
IG10eEluLkxvY2sgKCk7CisgIG10eF9pbi5sb2NrICgpOwogICBpZiAoMSA9
PSBJbnRlcmxvY2tlZEluY3JlbWVudCAoKGxvbmcgKikmd2FpdGluZykpCi0g
ICAgbXR4Q29uZCA9IG11dGV4OwotICBlbHNlIGlmIChtdHhDb25kICE9IG11
dGV4KQorICAgIG10eF9jb25kID0gbXV0ZXg7CisgIGVsc2UgaWYgKG10eF9j
b25kICE9IG11dGV4KQogICAgIHsKICAgICAgIEludGVybG9ja2VkRGVjcmVt
ZW50ICgobG9uZyAqKSZ3YWl0aW5nKTsKLSAgICAgIG10eEluLlVuTG9jayAo
KTsKKyAgICAgIG10eF9pbi51bmxvY2sgKCk7CiAgICAgICByZXR1cm4gRUlO
VkFMOwogICAgIH0KLSAgbXR4SW4uVW5Mb2NrICgpOworICBtdHhfaW4udW5s
b2NrICgpOwogCiAgIC8qCiAgICAqIFJlbGVhc2UgdGhlIG11dGV4IGFuZCB3
YWl0IG9uIHNlbWFwaG9yZQogICAgKi8KICAgKyttdXRleC0+Y29uZHdhaXRz
OwotICBtdXRleC0+VW5Mb2NrICgpOworICBtdXRleC0+dW5sb2NrICgpOwog
Ci0gIHJ2ID0gcHRocmVhZDo6Y2FuY2VsYWJsZV93YWl0IChzZW1XYWl0LCBk
d01pbGxpc2Vjb25kcywgZmFsc2UpOworICBydiA9IHB0aHJlYWQ6OmNhbmNl
bGFibGVfd2FpdCAoc2VtX3dhaXQsIGR3TWlsbGlzZWNvbmRzLCBmYWxzZSk7
CiAKLSAgbXR4T3V0LkxvY2sgKCk7CisgIG10eF9vdXQubG9jayAoKTsKICAg
CiAgIGlmIChydiAhPSBXQUlUX09CSkVDVF8wKQogICAgIHsKQEAgLTkyOCw3
ICs5MzEsNyBAQCBwdGhyZWFkX2NvbmQ6OldhaXQgKHB0aHJlYWRfbXV0ZXhf
dCBtdXRlCiAgICAgICAgKiBvciB0aW1lZCBvdXQuIFRyeSB0byB0YWtlIG9u
ZS4KICAgICAgICAqIElmIHRoZSB0aHJlYWQgZ2V0cyBvbmUgdGhhbiBhIHNp
Z25hbHxicm9hZGNhc3QgaXMgaW4gcHJvZ3Jlc3MuCiAgICAgICAgKi8gCi0g
ICAgICBpZiAoV0FJVF9PQkpFQ1RfMCA9PSBXYWl0Rm9yU2luZ2xlT2JqZWN0
IChzZW1XYWl0LCAwKSkKKyAgICAgIGlmIChXQUlUX09CSkVDVF8wID09IFdh
aXRGb3JTaW5nbGVPYmplY3QgKHNlbV93YWl0LCAwKSkKICAgICAgICAgLyoK
ICAgICAgICAgICogdGhyZWFkIGdvdCBjYW5jZWxsZWQgb3QgdGltZWQgb3V0
IHdoaWxlIGEgc2lnbmFsbGluZyBpcyBpbiBwcm9ncmVzcy4KICAgICAgICAg
ICogU2V0IHdhaXQgcmVzdWx0IGJhY2sgdG8gc2lnbmFsZWQKQEAgLTk0Mywx
MSArOTQ2LDExIEBAIHB0aHJlYWRfY29uZDo6V2FpdCAocHRocmVhZF9tdXRl
eF90IG11dGUKICAgICAgKiBBbGwgc2lnbmFsZWQgdGhyZWFkcyBhcmUgcmVs
ZWFzZWQsCiAgICAgICogbmV3IHRocmVhZHMgY2FuIGVudGVyIFdhaXQKICAg
ICAgKi8KLSAgICBtdHhJbi5VbkxvY2sgKCk7CisgICAgbXR4X2luLnVubG9j
ayAoKTsKIAotICBtdHhPdXQuVW5Mb2NrICgpOworICBtdHhfb3V0LnVubG9j
ayAoKTsKICAKLSAgbXV0ZXgtPkxvY2sgKCk7CisgIG11dGV4LT5sb2NrICgp
OwogICAtLW11dGV4LT5jb25kd2FpdHM7CiAKICAgaWYgKHJ2ID09IFdBSVRf
Q0FOQ0VMRUQpCkBAIC05NTksMjIgKzk2MiwyMiBAQCBwdGhyZWFkX2NvbmQ6
OldhaXQgKHB0aHJlYWRfbXV0ZXhfdCBtdXRlCiB9CiAKIHZvaWQKLXB0aHJl
YWRfY29uZDo6Rml4dXBBZnRlckZvcmsgKCkKK3B0aHJlYWRfY29uZDo6X2Zp
eHVwX2FmdGVyX2ZvcmsgKCkKIHsKICAgd2FpdGluZyA9IHBlbmRpbmcgPSAw
OwotICBtdHhDb25kID0gTlVMTDsKKyAgbXR4X2NvbmQgPSBOVUxMOwogCiAg
IC8qIFVubG9jayBldmVudHVhbGx5IGxvY2tlZCBtdXRleGVzICovCi0gIG10
eEluLlVuTG9jayAoKTsKLSAgbXR4T3V0LlVuTG9jayAoKTsKKyAgbXR4X2lu
LnVubG9jayAoKTsKKyAgbXR4X291dC51bmxvY2sgKCk7CiAKLSAgc2VtV2Fp
dCA9IDo6Q3JlYXRlU2VtYXBob3JlICgmc2VjX25vbmVfbmloLCAwLCBMT05H
X01BWCwgTlVMTCk7Ci0gIGlmICghc2VtV2FpdCkKLSAgICBhcGlfZmF0YWwg
KCJwdGhyZWFkX2NvbmQ6OkZpeHVwQWZ0ZXJGb3JrICgpIGZhaWxlZCB0byBy
ZWNyZWF0ZSB3aW4zMiBzZW1hcGhvcmUiKTsKKyAgc2VtX3dhaXQgPSA6OkNy
ZWF0ZVNlbWFwaG9yZSAoJnNlY19ub25lX25paCwgMCwgTE9OR19NQVgsIE5V
TEwpOworICBpZiAoIXNlbV93YWl0KQorICAgIGFwaV9mYXRhbCAoInB0aHJl
YWRfY29uZDo6X2ZpeHVwX2FmdGVyX2ZvcmsgKCkgZmFpbGVkIHRvIHJlY3Jl
YXRlIHdpbjMyIHNlbWFwaG9yZSIpOwogfQogCiBib29sCi1wdGhyZWFkX3J3
bG9ja2F0dHI6OmlzR29vZE9iamVjdCAocHRocmVhZF9yd2xvY2thdHRyX3Qg
Y29uc3QgKmF0dHIpCitwdGhyZWFkX3J3bG9ja2F0dHI6OmlzX2dvb2Rfb2Jq
ZWN0IChwdGhyZWFkX3J3bG9ja2F0dHJfdCBjb25zdCAqYXR0cikKIHsKICAg
aWYgKHZlcmlmeWFibGVfb2JqZWN0X2lzdmFsaWQgKGF0dHIsIFBUSFJFQURf
UldMT0NLQVRUUl9NQUdJQykgIT0gVkFMSURfT0JKRUNUKQogICAgIHJldHVy
biBmYWxzZTsKQEAgLTk5MywyMiArOTk2LDIyIEBAIHB0aHJlYWRfcndsb2Nr
YXR0cjo6fnB0aHJlYWRfcndsb2NrYXR0ciAKIExpc3Q8cHRocmVhZF9yd2xv
Y2s+IHB0aHJlYWRfcndsb2NrOjpyd2xvY2tzOwogCiAvKiBUaGlzIGlzIHVz
ZWQgZm9yIHJ3bG9jayBjcmVhdGlvbiBwcm90ZWN0aW9uIHdpdGhpbiBhIHNp
bmdsZSBwcm9jZXNzIG9ubHkgKi8KLW5hdGl2ZU11dGV4IE5PX0NPUFkgcHRo
cmVhZF9yd2xvY2s6OnJ3bG9ja0luaXRpYWxpemF0aW9uTG9jazsKK25hdGl2
ZV9tdXRleCBOT19DT1BZIHB0aHJlYWRfcndsb2NrOjpyd2xvY2tfaW5pdGlh
bGl6YXRpb25fbG9jazsKIAogLyogV2UgY2FuIG9ubHkgYmUgY2FsbGVkIG9u
Y2UuCiAgICBUT0RPOiAobm8gcnVzaCkgdXNlIGEgbm9uIGNvcGllZCBtZW1v
cnkgc2VjdGlvbiB0bwogICAgaG9sZCBhbiBpbml0aWFsaXphdGlvbiBmbGFn
LiAgKi8KIHZvaWQKLXB0aHJlYWRfcndsb2NrOjppbml0TXV0ZXggKCkKK3B0
aHJlYWRfcndsb2NrOjppbml0X211dGV4ICgpCiB7Ci0gIGlmICghcndsb2Nr
SW5pdGlhbGl6YXRpb25Mb2NrLmluaXQgKCkpCisgIGlmICghcndsb2NrX2lu
aXRpYWxpemF0aW9uX2xvY2suaW5pdCAoKSkKICAgICBhcGlfZmF0YWwgKCJD
b3VsZCBub3QgY3JlYXRlIHdpbjMyIE11dGV4IGZvciBwdGhyZWFkIHJ3bG9j
ayBzdGF0aWMgaW5pdGlhbGl6ZXIgc3VwcG9ydC4iKTsKIH0KIAogcHRocmVh
ZF9yd2xvY2s6OnB0aHJlYWRfcndsb2NrIChwdGhyZWFkX3J3bG9ja2F0dHIg
KmF0dHIpIDoKICAgdmVyaWZ5YWJsZV9vYmplY3QgKFBUSFJFQURfUldMT0NL
X01BR0lDKSwKLSAgc2hhcmVkICgwKSwgd2FpdGluZ1JlYWRlcnMgKDApLCB3
YWl0aW5nV3JpdGVycyAoMCksIHdyaXRlciAoTlVMTCksCi0gIHJlYWRlcnMg
KE5VTEwpLCBtdHggKE5VTEwpLCBjb25kUmVhZGVycyAoTlVMTCksIGNvbmRX
cml0ZXJzIChOVUxMKSwKKyAgc2hhcmVkICgwKSwgd2FpdGluZ19yZWFkZXJz
ICgwKSwgd2FpdGluZ193cml0ZXJzICgwKSwgd3JpdGVyIChOVUxMKSwKKyAg
cmVhZGVycyAoTlVMTCksIG10eCAoTlVMTCksIGNvbmRfcmVhZGVycyAoTlVM
TCksIGNvbmRfd3JpdGVycyAoTlVMTCksCiAgIG5leHQgKE5VTEwpCiB7CiAg
IHB0aHJlYWRfbXV0ZXggKnZlcmlmeWFibGVfbXV0ZXhfb2JqID0gJm10eDsK
QEAgLTEwMjEsNyArMTAyNCw3IEBAIHB0aHJlYWRfcndsb2NrOjpwdGhyZWFk
X3J3bG9jayAocHRocmVhZF8KICAgICAgICAgcmV0dXJuOwogICAgICAgfQog
Ci0gIGlmICghcHRocmVhZF9tdXRleDo6aXNHb29kT2JqZWN0ICgmdmVyaWZ5
YWJsZV9tdXRleF9vYmopKQorICBpZiAoIXB0aHJlYWRfbXV0ZXg6OmlzX2dv
b2Rfb2JqZWN0ICgmdmVyaWZ5YWJsZV9tdXRleF9vYmopKQogICAgIHsKICAg
ICAgIHRocmVhZF9wcmludGYgKCJJbnRlcm5hbCByd2xvY2sgbXV0ZXggaXMg
bm90IHZhbGlkLiB0aGlzICVwIiwgdGhpcyk7CiAgICAgICBtYWdpYyA9IDA7
CkBAIC0xMDMwLDE2ICsxMDMzLDE2IEBAIHB0aHJlYWRfcndsb2NrOjpwdGhy
ZWFkX3J3bG9jayAocHRocmVhZF8KICAgLyogQ2hhbmdlIHRoZSBtdXRleCB0
eXBlIHRvIE5PUk1BTCB0byBzcGVlZCB1cCBtdXRleCBvcGVyYXRpb25zICov
CiAgIG10eC50eXBlID0gUFRIUkVBRF9NVVRFWF9OT1JNQUw7CiAKLSAgdmVy
aWZ5YWJsZV9jb25kX29iaiA9ICZjb25kUmVhZGVyczsKLSAgaWYgKCFwdGhy
ZWFkX2NvbmQ6OmlzR29vZE9iamVjdCAoJnZlcmlmeWFibGVfY29uZF9vYmop
KQorICB2ZXJpZnlhYmxlX2NvbmRfb2JqID0gJmNvbmRfcmVhZGVyczsKKyAg
aWYgKCFwdGhyZWFkX2NvbmQ6OmlzX2dvb2Rfb2JqZWN0ICgmdmVyaWZ5YWJs
ZV9jb25kX29iaikpCiAgICAgewogICAgICAgdGhyZWFkX3ByaW50ZiAoIklu
dGVybmFsIHJ3bG9jayByZWFkZXJzIGNvbmQgaXMgbm90IHZhbGlkLiB0aGlz
ICVwIiwgdGhpcyk7CiAgICAgICBtYWdpYyA9IDA7CiAgICAgICByZXR1cm47
CiAgICAgfQogCi0gIHZlcmlmeWFibGVfY29uZF9vYmogPSAmY29uZFdyaXRl
cnM7Ci0gIGlmICghcHRocmVhZF9jb25kOjppc0dvb2RPYmplY3QgKCZ2ZXJp
ZnlhYmxlX2NvbmRfb2JqKSkKKyAgdmVyaWZ5YWJsZV9jb25kX29iaiA9ICZj
b25kX3dyaXRlcnM7CisgIGlmICghcHRocmVhZF9jb25kOjppc19nb29kX29i
amVjdCAoJnZlcmlmeWFibGVfY29uZF9vYmopKQogICAgIHsKICAgICAgIHRo
cmVhZF9wcmludGYgKCJJbnRlcm5hbCByd2xvY2sgd3JpdGVycyBjb25kIGlz
IG5vdCB2YWxpZC4gdGhpcyAlcCIsIHRoaXMpOwogICAgICAgbWFnaWMgPSAw
OwpAQCAtMTA0NywyNCArMTA1MCwyNCBAQCBwdGhyZWFkX3J3bG9jazo6cHRo
cmVhZF9yd2xvY2sgKHB0aHJlYWRfCiAgICAgfQogCiAKLSAgcndsb2Nrcy5J
bnNlcnQgKHRoaXMpOworICByd2xvY2tzLmluc2VydCAodGhpcyk7CiB9CiAK
IHB0aHJlYWRfcndsb2NrOjp+cHRocmVhZF9yd2xvY2sgKCkKIHsKLSAgcnds
b2Nrcy5SZW1vdmUgKHRoaXMpOworICByd2xvY2tzLnJlbW92ZSAodGhpcyk7
CiB9CiAKIGludAotcHRocmVhZF9yd2xvY2s6OlJkTG9jayAoKQorcHRocmVh
ZF9yd2xvY2s6OnJkbG9jayAoKQogewogICBpbnQgcmVzdWx0ID0gMDsKICAg
c3RydWN0IFJXTE9DS19SRUFERVIgKnJlYWRlcjsKICAgcHRocmVhZF90IHNl
bGYgPSBwdGhyZWFkOjpzZWxmICgpOwogCi0gIG10eC5Mb2NrICgpOworICBt
dHgubG9jayAoKTsKIAotICBpZiAobG9va3VwUmVhZGVyIChzZWxmKSkKKyAg
aWYgKGxvb2t1cF9yZWFkZXIgKHNlbGYpKQogICAgIHsKICAgICAgIHJlc3Vs
dCA9IEVERUFETEs7CiAgICAgICBnb3RvIERPTkU7CkBAIC0xMDc3LDM1ICsx
MDgwLDM1IEBAIHB0aHJlYWRfcndsb2NrOjpSZExvY2sgKCkKICAgICAgIGdv
dG8gRE9ORTsKICAgICB9CiAKLSAgd2hpbGUgKHdyaXRlciB8fCB3YWl0aW5n
V3JpdGVycykKKyAgd2hpbGUgKHdyaXRlciB8fCB3YWl0aW5nX3dyaXRlcnMp
CiAgICAgeyAgCi0gICAgICBwdGhyZWFkX2NsZWFudXBfcHVzaCAocHRocmVh
ZF9yd2xvY2s6OlJkTG9ja0NsZWFudXAsIHRoaXMpOworICAgICAgcHRocmVh
ZF9jbGVhbnVwX3B1c2ggKHB0aHJlYWRfcndsb2NrOjpyZGxvY2tfY2xlYW51
cCwgdGhpcyk7CiAKLSAgICAgICsrd2FpdGluZ1JlYWRlcnM7Ci0gICAgICBj
b25kUmVhZGVycy5XYWl0ICgmbXR4KTsKLSAgICAgIC0td2FpdGluZ1JlYWRl
cnM7CisgICAgICArK3dhaXRpbmdfcmVhZGVyczsKKyAgICAgIGNvbmRfcmVh
ZGVycy53YWl0ICgmbXR4KTsKKyAgICAgIC0td2FpdGluZ19yZWFkZXJzOwog
CiAgICAgICBwdGhyZWFkX2NsZWFudXBfcG9wICgwKTsKICAgICB9CiAKICAg
cmVhZGVyLT50aHJlYWQgPSBzZWxmOwotICBhZGRSZWFkZXIgKHJlYWRlcik7
CisgIGFkZF9yZWFkZXIgKHJlYWRlcik7CiAKICBET05FOgotICBtdHguVW5M
b2NrICgpOworICBtdHgudW5sb2NrICgpOwogCiAgIHJldHVybiByZXN1bHQ7
CiB9CiAKIGludAotcHRocmVhZF9yd2xvY2s6OlRyeVJkTG9jayAoKQorcHRo
cmVhZF9yd2xvY2s6OnRyeXJkbG9jayAoKQogewogICBpbnQgcmVzdWx0ID0g
MDsKICAgcHRocmVhZF90IHNlbGYgPSBwdGhyZWFkOjpzZWxmICgpOwogCi0g
IG10eC5Mb2NrICgpOworICBtdHgubG9jayAoKTsKIAotICBpZiAod3JpdGVy
IHx8IHdhaXRpbmdXcml0ZXJzIHx8IGxvb2t1cFJlYWRlciAoc2VsZikpCisg
IGlmICh3cml0ZXIgfHwgd2FpdGluZ193cml0ZXJzIHx8IGxvb2t1cF9yZWFk
ZXIgKHNlbGYpKQogICAgIHJlc3VsdCA9IEVCVVNZOwogICBlbHNlCiAgICAg
ewpAQCAtMTExMywyNiArMTExNiwyNiBAQCBwdGhyZWFkX3J3bG9jazo6VHJ5
UmRMb2NrICgpCiAgICAgICBpZiAocmVhZGVyKQogICAgICAgICB7CiAgICAg
ICAgICAgcmVhZGVyLT50aHJlYWQgPSBzZWxmOwotICAgICAgICAgIGFkZFJl
YWRlciAocmVhZGVyKTsKKyAgICAgICAgICBhZGRfcmVhZGVyIChyZWFkZXIp
OwogICAgICAgICB9CiAgICAgICBlbHNlCiAgICAgICAgIHJlc3VsdCA9IEVB
R0FJTjsKICAgICB9CiAgICAgCi0gIG10eC5VbkxvY2sgKCk7CisgIG10eC51
bmxvY2sgKCk7CiAKICAgcmV0dXJuIHJlc3VsdDsKIH0KIAogaW50Ci1wdGhy
ZWFkX3J3bG9jazo6V3JMb2NrICgpCitwdGhyZWFkX3J3bG9jazo6d3Jsb2Nr
ICgpCiB7CiAgIGludCByZXN1bHQgPSAwOwogICBwdGhyZWFkX3Qgc2VsZiA9
IHB0aHJlYWQ6OnNlbGYgKCk7CiAKLSAgbXR4LkxvY2sgKCk7CisgIG10eC5s
b2NrICgpOwogCi0gIGlmICh3cml0ZXIgPT0gc2VsZiB8fCBsb29rdXBSZWFk
ZXIgKHNlbGYpKQorICBpZiAod3JpdGVyID09IHNlbGYgfHwgbG9va3VwX3Jl
YWRlciAoc2VsZikpCiAgICAgewogICAgICAgcmVzdWx0ID0gRURFQURMSzsK
ICAgICAgIGdvdG8gRE9ORTsKQEAgLTExNDAsMTEgKzExNDMsMTEgQEAgcHRo
cmVhZF9yd2xvY2s6OldyTG9jayAoKQogCiAgIHdoaWxlICh3cml0ZXIgfHwg
cmVhZGVycykKICAgICB7ICAKLSAgICAgIHB0aHJlYWRfY2xlYW51cF9wdXNo
IChwdGhyZWFkX3J3bG9jazo6V3JMb2NrQ2xlYW51cCwgdGhpcyk7CisgICAg
ICBwdGhyZWFkX2NsZWFudXBfcHVzaCAocHRocmVhZF9yd2xvY2s6OndybG9j
a19jbGVhbnVwLCB0aGlzKTsKIAotICAgICAgKyt3YWl0aW5nV3JpdGVyczsK
LSAgICAgIGNvbmRXcml0ZXJzLldhaXQgKCZtdHgpOwotICAgICAgLS13YWl0
aW5nV3JpdGVyczsKKyAgICAgICsrd2FpdGluZ193cml0ZXJzOworICAgICAg
Y29uZF93cml0ZXJzLndhaXQgKCZtdHgpOworICAgICAgLS13YWl0aW5nX3dy
aXRlcnM7CiAKICAgICAgIHB0aHJlYWRfY2xlYW51cF9wb3AgKDApOwogICAg
IH0KQEAgLTExNTIsMzYgKzExNTUsMzYgQEAgcHRocmVhZF9yd2xvY2s6Oldy
TG9jayAoKQogICB3cml0ZXIgPSBzZWxmOwogCiAgRE9ORToKLSAgbXR4LlVu
TG9jayAoKTsKKyAgbXR4LnVubG9jayAoKTsKIAogICByZXR1cm4gcmVzdWx0
OwogfQogCiBpbnQKLXB0aHJlYWRfcndsb2NrOjpUcnlXckxvY2sgKCkKK3B0
aHJlYWRfcndsb2NrOjp0cnl3cmxvY2sgKCkKIHsKICAgaW50IHJlc3VsdCA9
IDA7CiAgIHB0aHJlYWRfdCBzZWxmID0gcHRocmVhZDo6c2VsZiAoKTsKIAot
ICBtdHguTG9jayAoKTsKKyAgbXR4LmxvY2sgKCk7CiAKICAgaWYgKHdyaXRl
ciB8fCByZWFkZXJzKQogICAgIHJlc3VsdCA9IEVCVVNZOwogICBlbHNlCiAg
ICAgd3JpdGVyID0gc2VsZjsKICAgICAKLSAgbXR4LlVuTG9jayAoKTsKKyAg
bXR4LnVubG9jayAoKTsKIAogICByZXR1cm4gcmVzdWx0OwogfQogCiBpbnQK
LXB0aHJlYWRfcndsb2NrOjpVbkxvY2sgKCkKK3B0aHJlYWRfcndsb2NrOjp1
bmxvY2sgKCkKIHsKICAgaW50IHJlc3VsdCA9IDA7CiAgIHB0aHJlYWRfdCBz
ZWxmID0gcHRocmVhZDo6c2VsZiAoKTsKIAotICBtdHguTG9jayAoKTsKKyAg
bXR4LmxvY2sgKCk7CiAKICAgaWYgKHdyaXRlcikKICAgICB7CkBAIC0xMTk1
LDcgKzExOTgsNyBAQCBwdGhyZWFkX3J3bG9jazo6VW5Mb2NrICgpCiAgICAg
fQogICBlbHNlCiAgICAgewotICAgICAgc3RydWN0IFJXTE9DS19SRUFERVIg
KnJlYWRlciA9IGxvb2t1cFJlYWRlciAoc2VsZik7CisgICAgICBzdHJ1Y3Qg
UldMT0NLX1JFQURFUiAqcmVhZGVyID0gbG9va3VwX3JlYWRlciAoc2VsZik7
CiAKICAgICAgIGlmICghcmVhZGVyKQogICAgICAgICB7CkBAIC0xMjAzLDMz
ICsxMjA2LDMzIEBAIHB0aHJlYWRfcndsb2NrOjpVbkxvY2sgKCkKICAgICAg
ICAgICBnb3RvIERPTkU7CiAgICAgICAgIH0KIAotICAgICAgcmVtb3ZlUmVh
ZGVyIChyZWFkZXIpOworICAgICAgcmVtb3ZlX3JlYWRlciAocmVhZGVyKTsK
ICAgICAgIGRlbGV0ZSByZWFkZXI7CiAgICAgfQogCi0gIGlmICh3YWl0aW5n
V3JpdGVycykKKyAgaWYgKHdhaXRpbmdfd3JpdGVycykKICAgICB7CiAgICAg
ICBpZiAoIXJlYWRlcnMpCi0gICAgICAgIGNvbmRXcml0ZXJzLlVuQmxvY2sg
KGZhbHNlKTsKKyAgICAgICAgY29uZF93cml0ZXJzLnVuYmxvY2sgKGZhbHNl
KTsKICAgICB9Ci0gIGVsc2UgaWYgKHdhaXRpbmdSZWFkZXJzKQotICAgIGNv
bmRSZWFkZXJzLlVuQmxvY2sgKHRydWUpOworICBlbHNlIGlmICh3YWl0aW5n
X3JlYWRlcnMpCisgICAgY29uZF9yZWFkZXJzLnVuYmxvY2sgKHRydWUpOwog
CiAgRE9ORToKLSAgbXR4LlVuTG9jayAoKTsKKyAgbXR4LnVubG9jayAoKTsK
IAogICByZXR1cm4gcmVzdWx0OwogfQogCiB2b2lkCi1wdGhyZWFkX3J3bG9j
azo6YWRkUmVhZGVyIChzdHJ1Y3QgUldMT0NLX1JFQURFUiAqcmQpCitwdGhy
ZWFkX3J3bG9jazo6YWRkX3JlYWRlciAoc3RydWN0IFJXTE9DS19SRUFERVIg
KnJkKQogewogICByZC0+bmV4dCA9IChzdHJ1Y3QgUldMT0NLX1JFQURFUiAq
KQogICAgIEludGVybG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmcmVhZGVycywg
cmQpOwogfQogCiB2b2lkCi1wdGhyZWFkX3J3bG9jazo6cmVtb3ZlUmVhZGVy
IChzdHJ1Y3QgUldMT0NLX1JFQURFUiAqcmQpCitwdGhyZWFkX3J3bG9jazo6
cmVtb3ZlX3JlYWRlciAoc3RydWN0IFJXTE9DS19SRUFERVIgKnJkKQogewog
ICBpZiAocmVhZGVycyA9PSByZCkKICAgICBJbnRlcmxvY2tlZEV4Y2hhbmdl
UG9pbnRlciAoJnJlYWRlcnMsIHJkLT5uZXh0KTsKQEAgLTEyNDQsNyArMTI0
Nyw3IEBAIHB0aHJlYWRfcndsb2NrOjpyZW1vdmVSZWFkZXIgKHN0cnVjdCBS
V0wKIH0KIAogc3RydWN0IHB0aHJlYWRfcndsb2NrOjpSV0xPQ0tfUkVBREVS
ICoKLXB0aHJlYWRfcndsb2NrOjpsb29rdXBSZWFkZXIgKHB0aHJlYWRfdCB0
aHJlYWQpCitwdGhyZWFkX3J3bG9jazo6bG9va3VwX3JlYWRlciAocHRocmVh
ZF90IHRocmVhZCkKIHsKICAgc3RydWN0IFJXTE9DS19SRUFERVIgKnRlbXAg
PSByZWFkZXJzOwogCkBAIC0xMjU1LDM0ICsxMjU4LDM0IEBAIHB0aHJlYWRf
cndsb2NrOjpsb29rdXBSZWFkZXIgKHB0aHJlYWRfdCAKIH0KIAogdm9pZAot
cHRocmVhZF9yd2xvY2s6OlJkTG9ja0NsZWFudXAgKHZvaWQgKmFyZykKK3B0
aHJlYWRfcndsb2NrOjpyZGxvY2tfY2xlYW51cCAodm9pZCAqYXJnKQogewog
ICBwdGhyZWFkX3J3bG9jayAqcndsb2NrID0gKHB0aHJlYWRfcndsb2NrICop
IGFyZzsKIAotICAtLShyd2xvY2stPndhaXRpbmdSZWFkZXJzKTsKLSAgcnds
b2NrLT5tdHguVW5Mb2NrICgpOworICAtLShyd2xvY2stPndhaXRpbmdfcmVh
ZGVycyk7CisgIHJ3bG9jay0+bXR4LnVubG9jayAoKTsKIH0KIAogdm9pZAot
cHRocmVhZF9yd2xvY2s6OldyTG9ja0NsZWFudXAgKHZvaWQgKmFyZykKK3B0
aHJlYWRfcndsb2NrOjp3cmxvY2tfY2xlYW51cCAodm9pZCAqYXJnKQogewog
ICBwdGhyZWFkX3J3bG9jayAqcndsb2NrID0gKHB0aHJlYWRfcndsb2NrICop
IGFyZzsKIAotICAtLShyd2xvY2stPndhaXRpbmdXcml0ZXJzKTsKLSAgcnds
b2NrLT5tdHguVW5Mb2NrICgpOworICAtLShyd2xvY2stPndhaXRpbmdfd3Jp
dGVycyk7CisgIHJ3bG9jay0+bXR4LnVubG9jayAoKTsKIH0KIAogdm9pZAot
cHRocmVhZF9yd2xvY2s6OkZpeHVwQWZ0ZXJGb3JrICgpCitwdGhyZWFkX3J3
bG9jazo6X2ZpeHVwX2FmdGVyX2ZvcmsgKCkKIHsKICAgcHRocmVhZF90IHNl
bGYgPSBwdGhyZWFkOjpzZWxmICgpOwogICBzdHJ1Y3QgUldMT0NLX1JFQURF
UiAqKnRlbXAgPSAmcmVhZGVyczsKIAotICB3YWl0aW5nUmVhZGVycyA9IDA7
Ci0gIHdhaXRpbmdXcml0ZXJzID0gMDsKKyAgd2FpdGluZ19yZWFkZXJzID0g
MDsKKyAgd2FpdGluZ193cml0ZXJzID0gMDsKIAogICAvKiBVbmxvY2sgZXZl
bnR1YWxseSBsb2NrZWQgbXV0ZXggKi8KLSAgbXR4LlVuTG9jayAoKTsKKyAg
bXR4LnVubG9jayAoKTsKICAgLyoKICAgICogUmVtb3ZlIGFsbCByZWFkZXJz
IGV4Y2VwdCBzZWxmCiAgICAqLwpAQCAtMTMwNSw3ICsxMzA4LDcgQEAgcHRo
cmVhZF9yd2xvY2s6OkZpeHVwQWZ0ZXJGb3JrICgpCiBMaXN0PHB0aHJlYWRf
a2V5PiBwdGhyZWFkX2tleTo6a2V5czsKIAogYm9vbAotcHRocmVhZF9rZXk6
OmlzR29vZE9iamVjdCAocHRocmVhZF9rZXlfdCBjb25zdCAqa2V5KQorcHRo
cmVhZF9rZXk6OmlzX2dvb2Rfb2JqZWN0IChwdGhyZWFkX2tleV90IGNvbnN0
ICprZXkpCiB7CiAgIGlmICh2ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkIChr
ZXksIFBUSFJFQURfS0VZX01BR0lDKSAhPSBWQUxJRF9PQkpFQ1QpCiAgICAg
cmV0dXJuIGZhbHNlOwpAQCAtMTMxNiwxMSArMTMxOSwxMSBAQCBwdGhyZWFk
X2tleTo6aXNHb29kT2JqZWN0IChwdGhyZWFkX2tleV90CiAKIHB0aHJlYWRf
a2V5OjpwdGhyZWFkX2tleSAodm9pZCAoKmFEZXN0cnVjdG9yKSAodm9pZCAq
KSk6dmVyaWZ5YWJsZV9vYmplY3QgKFBUSFJFQURfS0VZX01BR0lDKSwgZGVz
dHJ1Y3RvciAoYURlc3RydWN0b3IpCiB7Ci0gIGR3VGxzSW5kZXggPSBUbHNB
bGxvYyAoKTsKLSAgaWYgKGR3VGxzSW5kZXggPT0gVExTX09VVF9PRl9JTkRF
WEVTKQorICB0bHNfaW5kZXggPSBUbHNBbGxvYyAoKTsKKyAgaWYgKHRsc19p
bmRleCA9PSBUTFNfT1VUX09GX0lOREVYRVMpCiAgICAgbWFnaWMgPSAwOwog
ICBlbHNlCi0gICAga2V5cy5JbnNlcnQgKHRoaXMpOworICAgIGtleXMuaW5z
ZXJ0ICh0aGlzKTsKIH0KIAogcHRocmVhZF9rZXk6On5wdGhyZWFkX2tleSAo
KQpAQCAtMTMyOSw4ICsxMzMyLDggQEAgcHRocmVhZF9rZXk6On5wdGhyZWFk
X2tleSAoKQogICAgKi8KICAgaWYgKG1hZ2ljICE9IDApCiAgICAgewotICAg
ICAga2V5cy5SZW1vdmUgKHRoaXMpOwotICAgICAgVGxzRnJlZSAoZHdUbHNJ
bmRleCk7CisgICAgICBrZXlzLnJlbW92ZSAodGhpcyk7CisgICAgICBUbHNG
cmVlICh0bHNfaW5kZXgpOwogICAgIH0KIH0KIApAQCAtMTMzOCwzNiArMTM0
MSwzNiBAQCBpbnQKIHB0aHJlYWRfa2V5OjpzZXQgKGNvbnN0IHZvaWQgKnZh
bHVlKQogewogICAvKiB0aGUgT1MgZnVuY3Rpb24gZG9lc24ndCBwZXJmb3Jt
IGVycm9yIGNoZWNraW5nICovCi0gIFRsc1NldFZhbHVlIChkd1Rsc0luZGV4
LCAodm9pZCAqKSB2YWx1ZSk7CisgIFRsc1NldFZhbHVlICh0bHNfaW5kZXgs
ICh2b2lkICopIHZhbHVlKTsKICAgcmV0dXJuIDA7CiB9CiAKIHZvaWQgKgog
cHRocmVhZF9rZXk6OmdldCAoKSBjb25zdAogewotICBpbnQgc2F2ZWRFcnJv
ciA9IDo6R2V0TGFzdEVycm9yICgpOwotICB2b2lkICpyZXN1bHQgPSBUbHNH
ZXRWYWx1ZSAoZHdUbHNJbmRleCk7Ci0gIDo6U2V0TGFzdEVycm9yIChzYXZl
ZEVycm9yKTsKKyAgaW50IHNhdmVkX2Vycm9yID0gOjpHZXRMYXN0RXJyb3Ig
KCk7CisgIHZvaWQgKnJlc3VsdCA9IFRsc0dldFZhbHVlICh0bHNfaW5kZXgp
OworICA6OlNldExhc3RFcnJvciAoc2F2ZWRfZXJyb3IpOwogICByZXR1cm4g
cmVzdWx0OwogfQogCiB2b2lkCi1wdGhyZWFkX2tleTo6c2F2ZUtleVRvQnVm
ZmVyICgpCitwdGhyZWFkX2tleTo6c2F2ZV9rZXlfdG9fYnVmZmVyICgpCiB7
CiAgIGZvcmtfYnVmID0gZ2V0ICgpOwogfQogCiB2b2lkCi1wdGhyZWFkX2tl
eTo6cmVjcmVhdGVLZXlGcm9tQnVmZmVyICgpCitwdGhyZWFkX2tleTo6cmVj
cmVhdGVfa2V5X2Zyb21fYnVmZmVyICgpCiB7Ci0gIGR3VGxzSW5kZXggPSBU
bHNBbGxvYyAoKTsKLSAgaWYgKGR3VGxzSW5kZXggPT0gVExTX09VVF9PRl9J
TkRFWEVTKQotICAgIGFwaV9mYXRhbCAoInB0aHJlYWRfa2V5OjpyZWNyZWF0
ZUtleUZyb21CdWZmZXIgKCkgZmFpbGVkIHRvIHJlYWxsb2NhdGUgVGxzIHN0
b3JhZ2UiKTsKKyAgdGxzX2luZGV4ID0gVGxzQWxsb2MgKCk7CisgIGlmICh0
bHNfaW5kZXggPT0gVExTX09VVF9PRl9JTkRFWEVTKQorICAgIGFwaV9mYXRh
bCAoInB0aHJlYWRfa2V5OjpyZWNyZWF0ZV9rZXlfZnJvbV9idWZmZXIgKCkg
ZmFpbGVkIHRvIHJlYWxsb2NhdGUgVGxzIHN0b3JhZ2UiKTsKICAgc2V0IChm
b3JrX2J1Zik7CiB9CiAKIHZvaWQKLXB0aHJlYWRfa2V5OjpydW5EZXN0cnVj
dG9yICgpCitwdGhyZWFkX2tleTo6cnVuX2Rlc3RydWN0b3IgKCkKIHsKICAg
aWYgKGRlc3RydWN0b3IpCiAgICAgewpAQCAtMTQwNSw3ICsxNDA4LDcgQEAg
cHRocmVhZF9rZXk6OnJ1bkRlc3RydWN0b3IgKCkKIAogLyogc3RhdGljIG1l
bWJlcnMgKi8KIGJvb2wKLXB0aHJlYWRfbXV0ZXg6OmlzR29vZE9iamVjdCAo
cHRocmVhZF9tdXRleF90IGNvbnN0ICptdXRleCkKK3B0aHJlYWRfbXV0ZXg6
OmlzX2dvb2Rfb2JqZWN0IChwdGhyZWFkX211dGV4X3QgY29uc3QgKm11dGV4
KQogewogICBpZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAobXV0ZXgs
IFBUSFJFQURfTVVURVhfTUFHSUMpICE9IFZBTElEX09CSkVDVCkKICAgICBy
ZXR1cm4gZmFsc2U7CkBAIC0xNDEzLDcgKzE0MTYsNyBAQCBwdGhyZWFkX211
dGV4Ojppc0dvb2RPYmplY3QgKHB0aHJlYWRfbXV0CiB9CiAKIGJvb2wKLXB0
aHJlYWRfbXV0ZXg6OmlzR29vZEluaXRpYWxpemVyIChwdGhyZWFkX211dGV4
X3QgY29uc3QgKm11dGV4KQorcHRocmVhZF9tdXRleDo6aXNfZ29vZF9pbml0
aWFsaXplciAocHRocmVhZF9tdXRleF90IGNvbnN0ICptdXRleCkKIHsKICAg
aWYgKHZlcmlmeWFibGVfb2JqZWN0X2lzdmFsaWQgKG11dGV4LCBQVEhSRUFE
X01VVEVYX01BR0lDLCBQVEhSRUFEX01VVEVYX0lOSVRJQUxJWkVSKSAhPSBW
QUxJRF9TVEFUSUNfT0JKRUNUKQogICAgIHJldHVybiBmYWxzZTsKQEAgLTE0
MjEsNyArMTQyNCw3IEBAIHB0aHJlYWRfbXV0ZXg6OmlzR29vZEluaXRpYWxp
emVyIChwdGhyZWEKIH0KIAogYm9vbAotcHRocmVhZF9tdXRleDo6aXNHb29k
SW5pdGlhbGl6ZXJPck9iamVjdCAocHRocmVhZF9tdXRleF90IGNvbnN0ICpt
dXRleCkKK3B0aHJlYWRfbXV0ZXg6OmlzX2dvb2RfaW5pdGlhbGl6ZXJfb3Jf
b2JqZWN0IChwdGhyZWFkX211dGV4X3QgY29uc3QgKm11dGV4KQogewogICBp
ZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAobXV0ZXgsIFBUSFJFQURf
TVVURVhfTUFHSUMsIFBUSFJFQURfTVVURVhfSU5JVElBTElaRVIpID09IElO
VkFMSURfT0JKRUNUKQogICAgIHJldHVybiBmYWxzZTsKQEAgLTE0MjksNyAr
MTQzMiw3IEBAIHB0aHJlYWRfbXV0ZXg6OmlzR29vZEluaXRpYWxpemVyT3JP
YmplY3QKIH0KIAogYm9vbAotcHRocmVhZF9tdXRleDo6aXNHb29kSW5pdGlh
bGl6ZXJPckJhZE9iamVjdCAocHRocmVhZF9tdXRleF90IGNvbnN0ICptdXRl
eCkKK3B0aHJlYWRfbXV0ZXg6OmlzX2dvb2RfaW5pdGlhbGl6ZXJfb3JfYmFk
X29iamVjdCAocHRocmVhZF9tdXRleF90IGNvbnN0ICptdXRleCkKIHsKICAg
dmVyaWZ5YWJsZV9vYmplY3Rfc3RhdGUgb2JqZWN0U3RhdGUgPSB2ZXJpZnlh
YmxlX29iamVjdF9pc3ZhbGlkIChtdXRleCwgUFRIUkVBRF9NVVRFWF9NQUdJ
QywgUFRIUkVBRF9NVVRFWF9JTklUSUFMSVpFUik7CiAgIGlmIChvYmplY3RT
dGF0ZSA9PSBWQUxJRF9PQkpFQ1QpCkBAIC0xNDM4LDExICsxNDQxLDExIEBA
IHB0aHJlYWRfbXV0ZXg6OmlzR29vZEluaXRpYWxpemVyT3JCYWRPYmoKIH0K
IAogYm9vbAotcHRocmVhZF9tdXRleDo6Y2FuQmVVbmxvY2tlZCAocHRocmVh
ZF9tdXRleF90IGNvbnN0ICptdXRleCkKK3B0aHJlYWRfbXV0ZXg6OmNhbl9i
ZV91bmxvY2tlZCAocHRocmVhZF9tdXRleF90IGNvbnN0ICptdXRleCkKIHsK
ICAgcHRocmVhZF90IHNlbGYgPSBwdGhyZWFkOjpzZWxmICgpOwogCi0gIGlm
ICghaXNHb29kT2JqZWN0IChtdXRleCkpCisgIGlmICghaXNfZ29vZF9vYmpl
Y3QgKG11dGV4KSkKICAgICByZXR1cm4gZmFsc2U7CiAgIC8qCiAgICAqIENo
ZWNrIGlmIHRoZSBtdXRleCBpcyBvd25lZCBieSB0aGUgY3VycmVudCB0aHJl
YWQgYW5kIGNhbiBiZSB1bmxvY2tlZApAQCAtMTQ1MywxNSArMTQ1NiwxNSBA
QCBwdGhyZWFkX211dGV4OjpjYW5CZVVubG9ja2VkIChwdGhyZWFkX211CiBM
aXN0PHB0aHJlYWRfbXV0ZXg+IHB0aHJlYWRfbXV0ZXg6Om11dGV4ZXM7CiAK
IC8qIFRoaXMgaXMgdXNlZCBmb3IgbXV0ZXggY3JlYXRpb24gcHJvdGVjdGlv
biB3aXRoaW4gYSBzaW5nbGUgcHJvY2VzcyBvbmx5ICovCi1uYXRpdmVNdXRl
eCBOT19DT1BZIHB0aHJlYWRfbXV0ZXg6Om11dGV4SW5pdGlhbGl6YXRpb25M
b2NrOworbmF0aXZlX211dGV4IE5PX0NPUFkgcHRocmVhZF9tdXRleDo6bXV0
ZXhfaW5pdGlhbGl6YXRpb25fbG9jazsKIAogLyogV2UgY2FuIG9ubHkgYmUg
Y2FsbGVkIG9uY2UuCiAgICBUT0RPOiAobm8gcnVzaCkgdXNlIGEgbm9uIGNv
cGllZCBtZW1vcnkgc2VjdGlvbiB0bwogICAgaG9sZCBhbiBpbml0aWFsaXph
dGlvbiBmbGFnLiAgKi8KIHZvaWQKLXB0aHJlYWRfbXV0ZXg6OmluaXRNdXRl
eCAoKQorcHRocmVhZF9tdXRleDo6aW5pdF9tdXRleCAoKQogewotICBpZiAo
IW11dGV4SW5pdGlhbGl6YXRpb25Mb2NrLmluaXQgKCkpCisgIGlmICghbXV0
ZXhfaW5pdGlhbGl6YXRpb25fbG9jay5pbml0ICgpKQogICAgIGFwaV9mYXRh
bCAoIkNvdWxkIG5vdCBjcmVhdGUgd2luMzIgTXV0ZXggZm9yIHB0aHJlYWQg
bXV0ZXggc3RhdGljIGluaXRpYWxpemVyIHN1cHBvcnQuIik7CiB9CiAKQEAg
LTE0OTEsNyArMTQ5NCw3IEBAIHB0aHJlYWRfbXV0ZXg6OnB0aHJlYWRfbXV0
ZXggKHB0aHJlYWRfbXUKICAgICAgIHR5cGUgPSBhdHRyLT5tdXRleHR5cGU7
CiAgICAgfQogCi0gIG11dGV4ZXMuSW5zZXJ0ICh0aGlzKTsKKyAgbXV0ZXhl
cy5pbnNlcnQgKHRoaXMpOwogfQogCiBwdGhyZWFkX211dGV4Ojp+cHRocmVh
ZF9tdXRleCAoKQpAQCAtMTQ5OSw0MiArMTUwMiw0MiBAQCBwdGhyZWFkX211
dGV4Ojp+cHRocmVhZF9tdXRleCAoKQogICBpZiAod2luMzJfb2JqX2lkKQog
ICAgIENsb3NlSGFuZGxlICh3aW4zMl9vYmpfaWQpOwogCi0gIG11dGV4ZXMu
UmVtb3ZlICh0aGlzKTsKKyAgbXV0ZXhlcy5yZW1vdmUgKHRoaXMpOwogfQog
CiBpbnQKLXB0aHJlYWRfbXV0ZXg6Ol9Mb2NrIChwdGhyZWFkX3Qgc2VsZikK
K3B0aHJlYWRfbXV0ZXg6Ol9sb2NrIChwdGhyZWFkX3Qgc2VsZikKIHsKICAg
aW50IHJlc3VsdCA9IDA7CiAKICAgaWYgKDEgPT0gSW50ZXJsb2NrZWRJbmNy
ZW1lbnQgKChsb25nICopJmxvY2tfY291bnRlcikpCi0gICAgU2V0T3duZXIg
KHNlbGYpOworICAgIHNldF9vd25lciAoc2VsZik7CiAgIGVsc2UgaWYgKFBU
SFJFQURfTVVURVhfTk9STUFMICE9IHR5cGUgJiYgcHRocmVhZF9lcXVhbCAo
b3duZXIsIHNlbGYpKQogICAgIHsKICAgICAgIEludGVybG9ja2VkRGVjcmVt
ZW50ICgobG9uZyAqKSAmbG9ja19jb3VudGVyKTsKICAgICAgIGlmIChQVEhS
RUFEX01VVEVYX1JFQ1VSU0lWRSA9PSB0eXBlKQotCXJlc3VsdCA9IExvY2tS
ZWN1cnNpdmUgKCk7CisJcmVzdWx0ID0gbG9ja19yZWN1cnNpdmUgKCk7CiAg
ICAgICBlbHNlCiAJcmVzdWx0ID0gRURFQURMSzsKICAgICB9CiAgIGVsc2UK
ICAgICB7CiAgICAgICBXYWl0Rm9yU2luZ2xlT2JqZWN0ICh3aW4zMl9vYmpf
aWQsIElORklOSVRFKTsKLSAgICAgIFNldE93bmVyIChzZWxmKTsKKyAgICAg
IHNldF9vd25lciAoc2VsZik7CiAgICAgfQogCiAgIHJldHVybiByZXN1bHQ7
CiB9CiAKIGludAotcHRocmVhZF9tdXRleDo6X1RyeUxvY2sgKHB0aHJlYWRf
dCBzZWxmKQorcHRocmVhZF9tdXRleDo6X3RyeWxvY2sgKHB0aHJlYWRfdCBz
ZWxmKQogewogICBpbnQgcmVzdWx0ID0gMDsKIAogICBpZiAoMCA9PSBJbnRl
cmxvY2tlZENvbXBhcmVFeGNoYW5nZSAoKGxvbmcgKikmbG9ja19jb3VudGVy
LCAxLCAwICkpCi0gICAgU2V0T3duZXIgKHNlbGYpOworICAgIHNldF9vd25l
ciAoc2VsZik7CiAgIGVsc2UgaWYgKFBUSFJFQURfTVVURVhfUkVDVVJTSVZF
ID09IHR5cGUgJiYgcHRocmVhZF9lcXVhbCAob3duZXIsIHNlbGYpKQotICAg
IHJlc3VsdCA9IExvY2tSZWN1cnNpdmUgKCk7CisgICAgcmVzdWx0ID0gbG9j
a19yZWN1cnNpdmUgKCk7CiAgIGVsc2UKICAgICByZXN1bHQgPSBFQlVTWTsK
IApAQCAtMTU0Miw3ICsxNTQ1LDcgQEAgcHRocmVhZF9tdXRleDo6X1RyeUxv
Y2sgKHB0aHJlYWRfdCBzZWxmKQogfQogCiBpbnQKLXB0aHJlYWRfbXV0ZXg6
Ol9VbkxvY2sgKHB0aHJlYWRfdCBzZWxmKQorcHRocmVhZF9tdXRleDo6X3Vu
bG9jayAocHRocmVhZF90IHNlbGYpCiB7CiAgIGlmICghcHRocmVhZF9lcXVh
bCAob3duZXIsIHNlbGYpKQogICAgIHJldHVybiBFUEVSTTsKQEAgLTE1NTks
OSArMTU2Miw5IEBAIHB0aHJlYWRfbXV0ZXg6Ol9VbkxvY2sgKHB0aHJlYWRf
dCBzZWxmKQogfQogCiBpbnQKLXB0aHJlYWRfbXV0ZXg6Ol9EZXN0cm95IChw
dGhyZWFkX3Qgc2VsZikKK3B0aHJlYWRfbXV0ZXg6Ol9kZXN0cm95IChwdGhy
ZWFkX3Qgc2VsZikKIHsKLSAgaWYgKGNvbmR3YWl0cyB8fCBfVHJ5TG9jayAo
c2VsZikpCisgIGlmIChjb25kd2FpdHMgfHwgX3RyeWxvY2sgKHNlbGYpKQog
ICAgIC8vIERvIG5vdCBkZXN0cm95IGEgY29uZHdhaXRlZCBvciBsb2NrZWQg
bXV0ZXgKICAgICByZXR1cm4gRUJVU1k7CiAgIGVsc2UgaWYgKHJlY3Vyc2lv
bl9jb3VudGVyICE9IDEpCkBAIC0xNTc2LDExICsxNTc5LDExIEBAIHB0aHJl
YWRfbXV0ZXg6Ol9EZXN0cm95IChwdGhyZWFkX3Qgc2VsZikKIH0KIAogdm9p
ZAotcHRocmVhZF9tdXRleDo6Rml4dXBBZnRlckZvcmsgKCkKK3B0aHJlYWRf
bXV0ZXg6Ol9maXh1cF9hZnRlcl9mb3JrICgpCiB7Ci0gIGRlYnVnX3ByaW50
ZiAoIm11dGV4ICV4IGluIEZpeHVwQWZ0ZXJGb3JrIiwgdGhpcyk7CisgIGRl
YnVnX3ByaW50ZiAoIm11dGV4ICV4IGluIF9maXh1cF9hZnRlcl9mb3JrIiwg
dGhpcyk7CiAgIGlmIChwc2hhcmVkICE9IFBUSFJFQURfUFJPQ0VTU19QUklW
QVRFKQotICAgIGFwaV9mYXRhbCAoInB0aHJlYWRfbXV0ZXg6OkZpeHVwQWZ0
ZXJGb3JrICgpIGRvZXNuJ3R1bmRlcnN0YW5kIFBST0NFU1NfU0hBUkVEIG11
dGV4J3MiKTsKKyAgICBhcGlfZmF0YWwgKCJwdGhyZWFkX211dGV4OjpfZml4
dXBfYWZ0ZXJfZm9yayAoKSBkb2Vzbid0dW5kZXJzdGFuZCBQUk9DRVNTX1NI
QVJFRCBtdXRleCdzIik7CiAKICAgaWYgKE5VTEwgPT0gb3duZXIpCiAgICAg
LyogbXV0ZXggaGFzIG5vIG93bmVyLCByZXNldCB0byBpbml0aWFsICovCkBA
IC0xNTkxLDEzICsxNTk0LDEzIEBAIHB0aHJlYWRfbXV0ZXg6OkZpeHVwQWZ0
ZXJGb3JrICgpCiAKICAgd2luMzJfb2JqX2lkID0gOjpDcmVhdGVTZW1hcGhv
cmUgKCZzZWNfbm9uZV9uaWgsIDAsIExPTkdfTUFYLCBOVUxMKTsKICAgaWYg
KCF3aW4zMl9vYmpfaWQpCi0gICAgYXBpX2ZhdGFsICgicHRocmVhZF9tdXRl
eDo6Rml4dXBBZnRlckZvcmsgKCkgZmFpbGVkIHRvIHJlY3JlYXRlIHdpbjMy
IHNlbWFwaG9yZSBmb3IgbXV0ZXgiKTsKKyAgICBhcGlfZmF0YWwgKCJwdGhy
ZWFkX211dGV4OjpfZml4dXBfYWZ0ZXJfZm9yayAoKSBmYWlsZWQgdG8gcmVj
cmVhdGUgd2luMzIgc2VtYXBob3JlIGZvciBtdXRleCIpOwogCiAgIGNvbmR3
YWl0cyA9IDA7CiB9CiAKIGJvb2wKLXB0aHJlYWRfbXV0ZXhhdHRyOjppc0dv
b2RPYmplY3QgKHB0aHJlYWRfbXV0ZXhhdHRyX3QgY29uc3QgKiBhdHRyKQor
cHRocmVhZF9tdXRleGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChwdGhyZWFkX211
dGV4YXR0cl90IGNvbnN0ICogYXR0cikKIHsKICAgaWYgKHZlcmlmeWFibGVf
b2JqZWN0X2lzdmFsaWQgKGF0dHIsIFBUSFJFQURfTVVURVhBVFRSX01BR0lD
KSAhPSBWQUxJRF9PQkpFQ1QpCiAgICAgcmV0dXJuIGZhbHNlOwpAQCAtMTYy
NCw3ICsxNjI3LDcgQEAgc2VtYXBob3JlOjpzZW1hcGhvcmUgKGludCBwc2hh
cmVkLCB1bnNpZwogICB0aGlzLT5zaGFyZWQgPSBwc2hhcmVkOwogICBjdXJy
ZW50dmFsdWUgPSB2YWx1ZTsKIAotICBzZW1hcGhvcmVzLkluc2VydCAodGhp
cyk7CisgIHNlbWFwaG9yZXMuaW5zZXJ0ICh0aGlzKTsKIH0KIAogc2VtYXBo
b3JlOjp+c2VtYXBob3JlICgpCkBAIC0xNjMyLDExICsxNjM1LDExIEBAIHNl
bWFwaG9yZTo6fnNlbWFwaG9yZSAoKQogICBpZiAod2luMzJfb2JqX2lkKQog
ICAgIENsb3NlSGFuZGxlICh3aW4zMl9vYmpfaWQpOwogCi0gIHNlbWFwaG9y
ZXMuUmVtb3ZlICh0aGlzKTsKKyAgc2VtYXBob3Jlcy5yZW1vdmUgKHRoaXMp
OwogfQogCiB2b2lkCi1zZW1hcGhvcmU6OlBvc3QgKCkKK3NlbWFwaG9yZTo6
X3Bvc3QgKCkKIHsKICAgLyogd2UgY2FuJ3QgdXNlIHRoZSBjdXJyZW50dmFs
dWUsIGJlY2F1c2UgdGhlIHdhaXQgZnVuY3Rpb25zIGRvbid0IGxldCB1cyBh
Y2Nlc3MgaXQgKi8KICAgUmVsZWFzZVNlbWFwaG9yZSAod2luMzJfb2JqX2lk
LCAxLCBOVUxMKTsKQEAgLTE2NDQsNyArMTY0Nyw3IEBAIHNlbWFwaG9yZTo6
UG9zdCAoKQogfQogCiBpbnQKLXNlbWFwaG9yZTo6VHJ5V2FpdCAoKQorc2Vt
YXBob3JlOjpfdHJ5d2FpdCAoKQogewogICAvKiBGSVhNRTogc2lnbmFscyBz
aG91bGQgYmUgYWJsZSB0byBpbnRlcnJ1cHQgc2VtYXBob3Jlcy4uLgogICAg
KldlIHByb2JhYmx5IG5lZWQgV2FpdEZvck11bHRpcGxlT2JqZWN0cyBoZXJl
LgpAQCAtMTY1OSw3ICsxNjYyLDcgQEAgc2VtYXBob3JlOjpUcnlXYWl0ICgp
CiB9CiAKIHZvaWQKLXNlbWFwaG9yZTo6V2FpdCAoKQorc2VtYXBob3JlOjpf
d2FpdCAoKQogewogICBzd2l0Y2ggKHB0aHJlYWQ6OmNhbmNlbGFibGVfd2Fp
dCAod2luMzJfb2JqX2lkLCBJTkZJTklURSkpCiAgICAgewpAQCAtMTY3Myw5
ICsxNjc2LDkgQEAgc2VtYXBob3JlOjpXYWl0ICgpCiB9CiAKIHZvaWQKLXNl
bWFwaG9yZTo6Rml4dXBBZnRlckZvcmsgKCkKK3NlbWFwaG9yZTo6X2ZpeHVw
X2FmdGVyX2ZvcmsgKCkKIHsKLSAgZGVidWdfcHJpbnRmICgic2VtICV4IGlu
IEZpeHVwQWZ0ZXJGb3JrIiwgdGhpcyk7CisgIGRlYnVnX3ByaW50ZiAoInNl
bSAleCBpbiBfZml4dXBfYWZ0ZXJfZm9yayIsIHRoaXMpOwogICBpZiAoc2hh
cmVkICE9IFBUSFJFQURfUFJPQ0VTU19QUklWQVRFKQogICAgIGFwaV9mYXRh
bCAoImRvZXNuJ3QgdW5kZXJzdGFuZCBQUk9DRVNTX1NIQVJFRCBzZW1hcGhv
cmVzIHZhcmlhYmxlcyIpOwogICAvKiBGSVhNRTogZHVwbGljYXRlIGNvZGUg
aGVyZSBhbmQgaW4gdGhlIGNvbnN0cnVjdG9yLiAqLwpAQCAtMTc1NSwxNCAr
MTc1OCwxNCBAQCBwdGhyZWFkOjp0aHJlYWRfaW5pdF93cmFwcGVyICh2b2lk
ICpfYXJnCiAKICAgTVRfSU5URVJGQUNFLT5yZWVudF9rZXkuc2V0ICgmbG9j
YWxfcmVlbnQpOwogCi0gIHRocmVhZC0+c2V0VGhyZWFkSWR0b0N1cnJlbnQg
KCk7Ci0gIHNldFRsc1NlbGZQb2ludGVyICh0aHJlYWQpOworICB0aHJlYWQt
PnNldF90aHJlYWRfaWRfdG9fY3VycmVudCAoKTsKKyAgc2V0X3Rsc19zZWxm
X3BvaW50ZXIgKHRocmVhZCk7CiAKLSAgdGhyZWFkLT5tdXRleC5Mb2NrICgp
OworICB0aHJlYWQtPm11dGV4LmxvY2sgKCk7CiAgIC8vIGlmIHRocmVhZCBp
cyBkZXRhY2hlZCBmb3JjZSBjbGVhbnVwIG9uIGV4aXQKICAgaWYgKHRocmVh
ZC0+YXR0ci5qb2luYWJsZSA9PSBQVEhSRUFEX0NSRUFURV9ERVRBQ0hFRCAm
JiB0aHJlYWQtPmpvaW5lciA9PSBOVUxMKQogICAgIHRocmVhZC0+am9pbmVy
ID0gdGhyZWFkOwotICB0aHJlYWQtPm11dGV4LlVuTG9jayAoKTsKKyAgdGhy
ZWFkLT5tdXRleC51bmxvY2sgKCk7CiAKICNpZmRlZiBfQ1lHX1RIUkVBRF9G
QUlMU0FGRQogICBpZiAoX1JFRU5UID09IF9pbXB1cmVfcHRyKQpAQCAtMTc4
Niw3ICsxNzg5LDcgQEAgcHRocmVhZDo6dGhyZWFkX2luaXRfd3JhcHBlciAo
dm9pZCAqX2FyZwogfQogCiBib29sCi1wdGhyZWFkOjppc0dvb2RPYmplY3Qg
KHB0aHJlYWRfdCBjb25zdCAqdGhyZWFkKQorcHRocmVhZDo6aXNfZ29vZF9v
YmplY3QgKHB0aHJlYWRfdCBjb25zdCAqdGhyZWFkKQogewogICBpZiAodmVy
aWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAodGhyZWFkLCBQVEhSRUFEX01BR0lD
KSAhPSBWQUxJRF9PQkpFQ1QpCiAgICAgcmV0dXJuIGZhbHNlOwpAQCAtMTc5
Niw3ICsxNzk5LDcgQEAgcHRocmVhZDo6aXNHb29kT2JqZWN0IChwdGhyZWFk
X3QgY29uc3QgKgogdW5zaWduZWQgbG9uZwogcHRocmVhZDo6Z2V0c2VxdWVu
Y2VfbnAgKCkKIHsKLSAgcmV0dXJuIGdldFRocmVhZElkICgpOworICByZXR1
cm4gZ2V0X3RocmVhZF9pZCAoKTsKIH0KIAogaW50CkBAIC0xODA0LDEyICsx
ODA3LDEyIEBAIHB0aHJlYWQ6OmNyZWF0ZSAocHRocmVhZF90ICp0aHJlYWQs
IGNvbnMKIAkJICB2b2lkICooKnN0YXJ0X3JvdXRpbmUpICh2b2lkICopLCB2
b2lkICphcmcpCiB7CiAgIERFQ0xBUkVfVExTX1NUT1JBR0U7Ci0gIGlmIChh
dHRyICYmICFwdGhyZWFkX2F0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisg
IGlmIChhdHRyICYmICFwdGhyZWFkX2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChh
dHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwogCiAgICp0aHJlYWQgPSBuZXcg
cHRocmVhZCAoKTsKICAgKCp0aHJlYWQpLT5jcmVhdGUgKHN0YXJ0X3JvdXRp
bmUsIGF0dHIgPyAqYXR0ciA6IE5VTEwsIGFyZyk7Ci0gIGlmICghaXNHb29k
T2JqZWN0ICh0aHJlYWQpKQorICBpZiAoIWlzX2dvb2Rfb2JqZWN0ICh0aHJl
YWQpKQogICAgIHsKICAgICAgIGRlbGV0ZSAoKnRocmVhZCk7CiAgICAgICAq
dGhyZWFkID0gTlVMTDsKQEAgLTE4NDYsNyArMTg0OSw3IEBAIHB0aHJlYWQ6
Om9uY2UgKHB0aHJlYWRfb25jZV90ICpvbmNlX2NvbnQKIGludAogcHRocmVh
ZDo6Y2FuY2VsIChwdGhyZWFkX3QgdGhyZWFkKQogewotICBpZiAoIWlzR29v
ZE9iamVjdCAoJnRocmVhZCkpCisgIGlmICghaXNfZ29vZF9vYmplY3QgKCZ0
aHJlYWQpKQogICAgIHJldHVybiBFU1JDSDsKIAogICByZXR1cm4gdGhyZWFk
LT5jYW5jZWwgKCk7CkBAIC0xOTczLDcgKzE5NzYsNyBAQCBwdGhyZWFkX2F0
dHJfaW5pdCAocHRocmVhZF9hdHRyX3QgKmF0dHIpCiAgIGlmIChjaGVja192
YWxpZF9wb2ludGVyIChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwogICAq
YXR0ciA9IG5ldyBwdGhyZWFkX2F0dHI7Ci0gIGlmICghcHRocmVhZF9hdHRy
Ojppc0dvb2RPYmplY3QgKGF0dHIpKQorICBpZiAoIXB0aHJlYWRfYXR0cjo6
aXNfZ29vZF9vYmplY3QgKGF0dHIpKQogICAgIHsKICAgICAgIGRlbGV0ZSAo
KmF0dHIpOwogICAgICAgKmF0dHIgPSBOVUxMOwpAQCAtMTk4Niw3ICsxOTg5
LDcgQEAgZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfYXR0cl9nZXRpbmhlcml0
c2NoZWQgKGNvbnN0IHB0aHJlYWRfYXR0cl90ICphdHRyLAogCQkJCWludCAq
aW5oZXJpdHNjaGVkKQogewotICBpZiAoIXB0aHJlYWRfYXR0cjo6aXNHb29k
T2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX2F0dHI6OmlzX2dvb2Rf
b2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwogICAqaW5oZXJp
dHNjaGVkID0gKCphdHRyKS0+aW5oZXJpdHNjaGVkOwogICByZXR1cm4gMDsK
QEAgLTE5OTYsNyArMTk5OSw3IEBAIGV4dGVybiAiQyIgaW50CiBwdGhyZWFk
X2F0dHJfZ2V0c2NoZWRwYXJhbSAoY29uc3QgcHRocmVhZF9hdHRyX3QgKmF0
dHIsCiAJCQkgICAgICBzdHJ1Y3Qgc2NoZWRfcGFyYW0gKnBhcmFtKQogewot
ICBpZiAoIXB0aHJlYWRfYXR0cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAg
aWYgKCFwdGhyZWFkX2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAg
ICByZXR1cm4gRUlOVkFMOwogICAqcGFyYW0gPSAoKmF0dHIpLT5zY2hlZHBh
cmFtOwogICByZXR1cm4gMDsKQEAgLTIwMDgsNyArMjAxMSw3IEBAIHB0aHJl
YWRfYXR0cl9nZXRzY2hlZHBhcmFtIChjb25zdCBwdGhyZWEKIGV4dGVybiAi
QyIgaW50CiBwdGhyZWFkX2F0dHJfZ2V0c2NoZWRwb2xpY3kgKGNvbnN0IHB0
aHJlYWRfYXR0cl90ICphdHRyLCBpbnQgKnBvbGljeSkKIHsKLSAgaWYgKCFw
dGhyZWFkX2F0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRo
cmVhZF9hdHRyOjppc19nb29kX29iamVjdCAoYXR0cikpCiAgICAgcmV0dXJu
IEVJTlZBTDsKICAgKnBvbGljeSA9IFNDSEVEX0ZJRk87CiAgIHJldHVybiAw
OwpAQCAtMjAxOCw3ICsyMDIxLDcgQEAgcHRocmVhZF9hdHRyX2dldHNjaGVk
cG9saWN5IChjb25zdCBwdGhyZQogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRf
YXR0cl9nZXRzY29wZSAoY29uc3QgcHRocmVhZF9hdHRyX3QgKmF0dHIsIGlu
dCAqY29udGVudGlvbnNjb3BlKQogewotICBpZiAoIXB0aHJlYWRfYXR0cjo6
aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX2F0dHI6Omlz
X2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwogICAq
Y29udGVudGlvbnNjb3BlID0gKCphdHRyKS0+Y29udGVudGlvbnNjb3BlOwog
ICByZXR1cm4gMDsKQEAgLTIwMjcsNyArMjAzMCw3IEBAIHB0aHJlYWRfYXR0
cl9nZXRzY29wZSAoY29uc3QgcHRocmVhZF9hdHQKIGV4dGVybiAiQyIgaW50
CiBwdGhyZWFkX2F0dHJfc2V0ZGV0YWNoc3RhdGUgKHB0aHJlYWRfYXR0cl90
ICphdHRyLCBpbnQgZGV0YWNoc3RhdGUpCiB7Ci0gIGlmICghcHRocmVhZF9h
dHRyOjppc0dvb2RPYmplY3QgKGF0dHIpKQorICBpZiAoIXB0aHJlYWRfYXR0
cjo6aXNfZ29vZF9vYmplY3QgKGF0dHIpKQogICAgIHJldHVybiBFSU5WQUw7
CiAgIGlmIChkZXRhY2hzdGF0ZSA8IDAgfHwgZGV0YWNoc3RhdGUgPiAxKQog
ICAgIHJldHVybiBFSU5WQUw7CkBAIC0yMDM4LDcgKzIwNDEsNyBAQCBwdGhy
ZWFkX2F0dHJfc2V0ZGV0YWNoc3RhdGUgKHB0aHJlYWRfYXR0CiBleHRlcm4g
IkMiIGludAogcHRocmVhZF9hdHRyX2dldGRldGFjaHN0YXRlIChjb25zdCBw
dGhyZWFkX2F0dHJfdCAqYXR0ciwgaW50ICpkZXRhY2hzdGF0ZSkKIHsKLSAg
aWYgKCFwdGhyZWFkX2F0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlm
ICghcHRocmVhZF9hdHRyOjppc19nb29kX29iamVjdCAoYXR0cikpCiAgICAg
cmV0dXJuIEVJTlZBTDsKICAgKmRldGFjaHN0YXRlID0gKCphdHRyKS0+am9p
bmFibGU7CiAgIHJldHVybiAwOwpAQCAtMjA0Nyw3ICsyMDUwLDcgQEAgcHRo
cmVhZF9hdHRyX2dldGRldGFjaHN0YXRlIChjb25zdCBwdGhyZQogZXh0ZXJu
ICJDIiBpbnQKIHB0aHJlYWRfYXR0cl9zZXRpbmhlcml0c2NoZWQgKHB0aHJl
YWRfYXR0cl90ICphdHRyLCBpbnQgaW5oZXJpdHNjaGVkKQogewotICBpZiAo
IXB0aHJlYWRfYXR0cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFw
dGhyZWFkX2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1
cm4gRUlOVkFMOwogICBpZiAoaW5oZXJpdHNjaGVkICE9IFBUSFJFQURfSU5I
RVJJVF9TQ0hFRAogICAgICAgJiYgaW5oZXJpdHNjaGVkICE9IFBUSFJFQURf
RVhQTElDSVRfU0NIRUQpCkBAIC0yMDYwLDcgKzIwNjMsNyBAQCBleHRlcm4g
IkMiIGludAogcHRocmVhZF9hdHRyX3NldHNjaGVkcGFyYW0gKHB0aHJlYWRf
YXR0cl90ICphdHRyLAogCQkJICAgICAgY29uc3Qgc3RydWN0IHNjaGVkX3Bh
cmFtICpwYXJhbSkKIHsKLSAgaWYgKCFwdGhyZWFkX2F0dHI6OmlzR29vZE9i
amVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9hdHRyOjppc19nb29kX29i
amVjdCAoYXR0cikpCiAgICAgcmV0dXJuIEVJTlZBTDsKICAgaWYgKCF2YWxp
ZF9zY2hlZF9wYXJhbWV0ZXJzIChwYXJhbSkpCiAgICAgcmV0dXJuIEVOT1RT
VVA7CkBAIC0yMDcyLDcgKzIwNzUsNyBAQCBwdGhyZWFkX2F0dHJfc2V0c2No
ZWRwYXJhbSAocHRocmVhZF9hdHRyCiBleHRlcm4gIkMiIGludAogcHRocmVh
ZF9hdHRyX3NldHNjaGVkcG9saWN5IChwdGhyZWFkX2F0dHJfdCAqYXR0ciwg
aW50IHBvbGljeSkKIHsKLSAgaWYgKCFwdGhyZWFkX2F0dHI6OmlzR29vZE9i
amVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9hdHRyOjppc19nb29kX29i
amVjdCAoYXR0cikpCiAgICAgcmV0dXJuIEVJTlZBTDsKICAgaWYgKHBvbGlj
eSAhPSBTQ0hFRF9GSUZPKQogICAgIHJldHVybiBFTk9UU1VQOwpAQCAtMjA4
Miw3ICsyMDg1LDcgQEAgcHRocmVhZF9hdHRyX3NldHNjaGVkcG9saWN5IChw
dGhyZWFkX2F0dAogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfYXR0cl9zZXRz
Y29wZSAocHRocmVhZF9hdHRyX3QgKmF0dHIsIGludCBjb250ZW50aW9uc2Nv
cGUpCiB7Ci0gIGlmICghcHRocmVhZF9hdHRyOjppc0dvb2RPYmplY3QgKGF0
dHIpKQorICBpZiAoIXB0aHJlYWRfYXR0cjo6aXNfZ29vZF9vYmplY3QgKGF0
dHIpKQogICAgIHJldHVybiBFSU5WQUw7CiAgIGlmIChjb250ZW50aW9uc2Nv
cGUgIT0gUFRIUkVBRF9TQ09QRV9TWVNURU0KICAgICAgICYmIGNvbnRlbnRp
b25zY29wZSAhPSBQVEhSRUFEX1NDT1BFX1BST0NFU1MpCkBAIC0yMDk4LDcg
KzIxMDEsNyBAQCBwdGhyZWFkX2F0dHJfc2V0c2NvcGUgKHB0aHJlYWRfYXR0
cl90ICphCiBleHRlcm4gIkMiIGludAogcHRocmVhZF9hdHRyX3NldHN0YWNr
c2l6ZSAocHRocmVhZF9hdHRyX3QgKmF0dHIsIHNpemVfdCBzaXplKQogewot
ICBpZiAoIXB0aHJlYWRfYXR0cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAg
aWYgKCFwdGhyZWFkX2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAg
ICByZXR1cm4gRUlOVkFMOwogICAoKmF0dHIpLT5zdGFja3NpemUgPSBzaXpl
OwogICByZXR1cm4gMDsKQEAgLTIxMDcsNyArMjExMCw3IEBAIHB0aHJlYWRf
YXR0cl9zZXRzdGFja3NpemUgKHB0aHJlYWRfYXR0cl8KIGV4dGVybiAiQyIg
aW50CiBwdGhyZWFkX2F0dHJfZ2V0c3RhY2tzaXplIChjb25zdCBwdGhyZWFk
X2F0dHJfdCAqYXR0ciwgc2l6ZV90ICpzaXplKQogewotICBpZiAoIXB0aHJl
YWRfYXR0cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFk
X2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlO
VkFMOwogICAqc2l6ZSA9ICgqYXR0ciktPnN0YWNrc2l6ZTsKICAgcmV0dXJu
IDA7CkBAIC0yMTE2LDcgKzIxMTksNyBAQCBwdGhyZWFkX2F0dHJfZ2V0c3Rh
Y2tzaXplIChjb25zdCBwdGhyZWFkCiBleHRlcm4gIkMiIGludAogcHRocmVh
ZF9hdHRyX2Rlc3Ryb3kgKHB0aHJlYWRfYXR0cl90ICphdHRyKQogewotICBp
ZiAoIXB0aHJlYWRfYXR0cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYg
KCFwdGhyZWFkX2F0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICBy
ZXR1cm4gRUlOVkFMOwogICBkZWxldGUgKCphdHRyKTsKICAgKmF0dHIgPSBO
VUxMOwpAQCAtMjEzNCwyNyArMjEzNywyNyBAQCBwdGhyZWFkOjpqb2luIChw
dGhyZWFkX3QgKnRocmVhZCwgdm9pZCAqCiAgICBpZiAocmV0dXJuX3ZhbCkK
ICAgICAgKnJldHVybl92YWwgPSBOVUxMOwogCi0gICBpZiAoIWlzR29vZE9i
amVjdCAoJmpvaW5lcikpCisgICBpZiAoIWlzX2dvb2Rfb2JqZWN0ICgmam9p
bmVyKSkKICAgICAgcmV0dXJuIEVJTlZBTDsKIAotICBpZiAoIWlzR29vZE9i
amVjdCAodGhyZWFkKSkKKyAgaWYgKCFpc19nb29kX29iamVjdCAodGhyZWFk
KSkKICAgICByZXR1cm4gRVNSQ0g7CiAKICAgaWYgKHB0aHJlYWRfZXF1YWwg
KCp0aHJlYWQsam9pbmVyKSkKICAgICByZXR1cm4gRURFQURMSzsKIAotICAo
KnRocmVhZCktPm11dGV4LkxvY2sgKCk7CisgICgqdGhyZWFkKS0+bXV0ZXgu
bG9jayAoKTsKIAogICBpZiAoKCp0aHJlYWQpLT5hdHRyLmpvaW5hYmxlID09
IFBUSFJFQURfQ1JFQVRFX0RFVEFDSEVEKQogICAgIHsKLSAgICAgICgqdGhy
ZWFkKS0+bXV0ZXguVW5Mb2NrICgpOworICAgICAgKCp0aHJlYWQpLT5tdXRl
eC51bmxvY2sgKCk7CiAgICAgICByZXR1cm4gRUlOVkFMOwogICAgIH0KICAg
ZWxzZQogICAgIHsKICAgICAgICgqdGhyZWFkKS0+am9pbmVyID0gam9pbmVy
OwogICAgICAgKCp0aHJlYWQpLT5hdHRyLmpvaW5hYmxlID0gUFRIUkVBRF9D
UkVBVEVfREVUQUNIRUQ7Ci0gICAgICAoKnRocmVhZCktPm11dGV4LlVuTG9j
ayAoKTsKKyAgICAgICgqdGhyZWFkKS0+bXV0ZXgudW5sb2NrICgpOwogCiAg
ICAgICBzd2l0Y2ggKGNhbmNlbGFibGVfd2FpdCAoKCp0aHJlYWQpLT53aW4z
Ml9vYmpfaWQsIElORklOSVRFLCBmYWxzZSkpCiAJewpAQCAtMjE4MiwxMyAr
MjE4NSwxMyBAQCBwdGhyZWFkOjpqb2luIChwdGhyZWFkX3QgKnRocmVhZCwg
dm9pZCAqCiBpbnQKIHB0aHJlYWQ6OmRldGFjaCAocHRocmVhZF90ICp0aHJl
YWQpCiB7Ci0gIGlmICghaXNHb29kT2JqZWN0ICh0aHJlYWQpKQorICBpZiAo
IWlzX2dvb2Rfb2JqZWN0ICh0aHJlYWQpKQogICAgIHJldHVybiBFU1JDSDsK
IAotICAoKnRocmVhZCktPm11dGV4LkxvY2sgKCk7CisgICgqdGhyZWFkKS0+
bXV0ZXgubG9jayAoKTsKICAgaWYgKCgqdGhyZWFkKS0+YXR0ci5qb2luYWJs
ZSA9PSBQVEhSRUFEX0NSRUFURV9ERVRBQ0hFRCkKICAgICB7Ci0gICAgICAo
KnRocmVhZCktPm11dGV4LlVuTG9jayAoKTsKKyAgICAgICgqdGhyZWFkKS0+
bXV0ZXgudW5sb2NrICgpOwogICAgICAgcmV0dXJuIEVJTlZBTDsKICAgICB9
CiAKQEAgLTIxOTgsMTIgKzIyMDEsMTIgQEAgcHRocmVhZDo6ZGV0YWNoIChw
dGhyZWFkX3QgKnRocmVhZCkKICAgICAgIC8vIGZvcmNlIGNsZWFudXAgb24g
ZXhpdAogICAgICAgKCp0aHJlYWQpLT5qb2luZXIgPSAqdGhyZWFkOwogICAg
ICAgKCp0aHJlYWQpLT5hdHRyLmpvaW5hYmxlID0gUFRIUkVBRF9DUkVBVEVf
REVUQUNIRUQ7Ci0gICAgICAoKnRocmVhZCktPm11dGV4LlVuTG9jayAoKTsK
KyAgICAgICgqdGhyZWFkKS0+bXV0ZXgudW5sb2NrICgpOwogICAgIH0KICAg
ZWxzZQogICAgIHsKICAgICAgIC8vIHRocmVhZCBoYXMgYWxyZWFkeSB0ZXJt
aW5hdGVkLgotICAgICAgKCp0aHJlYWQpLT5tdXRleC5VbkxvY2sgKCk7Cisg
ICAgICAoKnRocmVhZCktPm11dGV4LnVubG9jayAoKTsKICAgICAgIGRlbGV0
ZSAoKnRocmVhZCk7CiAgICAgfQogCkBAIC0yMjEzLDcgKzIyMTYsNyBAQCBw
dGhyZWFkOjpkZXRhY2ggKHB0aHJlYWRfdCAqdGhyZWFkKQogaW50CiBwdGhy
ZWFkOjpzdXNwZW5kIChwdGhyZWFkX3QgKnRocmVhZCkKIHsKLSAgaWYgKCFp
c0dvb2RPYmplY3QgKHRocmVhZCkpCisgIGlmICghaXNfZ29vZF9vYmplY3Qg
KHRocmVhZCkpCiAgICAgcmV0dXJuIEVTUkNIOwogCiAgIGlmICgoKnRocmVh
ZCktPnN1c3BlbmRlZCA9PSBmYWxzZSkKQEAgLTIyMjksNyArMjIzMiw3IEBA
IHB0aHJlYWQ6OnN1c3BlbmQgKHB0aHJlYWRfdCAqdGhyZWFkKQogaW50CiBw
dGhyZWFkOjpyZXN1bWUgKHB0aHJlYWRfdCAqdGhyZWFkKQogewotICBpZiAo
IWlzR29vZE9iamVjdCAodGhyZWFkKSkKKyAgaWYgKCFpc19nb29kX29iamVj
dCAodGhyZWFkKSkKICAgICByZXR1cm4gRVNSQ0g7CiAKICAgaWYgKCgqdGhy
ZWFkKS0+c3VzcGVuZGVkID09IHRydWUpCkBAIC0yMjUzLDcgKzIyNTYsNyBA
QCBleHRlcm4gIkMiIGludAogcHRocmVhZF9nZXRzY2hlZHBhcmFtIChwdGhy
ZWFkX3QgdGhyZWFkLCBpbnQgKnBvbGljeSwKIAkJCSBzdHJ1Y3Qgc2NoZWRf
cGFyYW0gKnBhcmFtKQogewotICBpZiAoIXB0aHJlYWQ6OmlzR29vZE9iamVj
dCAoJnRocmVhZCkpCisgIGlmICghcHRocmVhZDo6aXNfZ29vZF9vYmplY3Qg
KCZ0aHJlYWQpKQogICAgIHJldHVybiBFU1JDSDsKICAgKnBvbGljeSA9IFND
SEVEX0ZJRk87CiAgIC8qIHdlIGRvbid0IHJldHVybiB0aGUgY3VycmVudCBl
ZmZlY3RpdmUgcHJpb3JpdHksIHdlIHJldHVybiB0aGUgY3VycmVudApAQCAt
MjI2OCwxMiArMjI3MSwxMiBAQCBwdGhyZWFkX2tleV9jcmVhdGUgKHB0aHJl
YWRfa2V5X3QgKmtleSwgCiB7CiAgIC8qIFRoZSBvcGVuZ3JvdXAgZG9jcyBk
b24ndCBkZWZpbmUgaWYgd2Ugc2hvdWxkIGNoZWNrIHRoaXMgb3Igbm90LAog
ICAgICBidXQgY3JlYXRpb24gaXMgcmVsYXRpdmVseSByYXJlLiAgKi8KLSAg
aWYgKHB0aHJlYWRfa2V5Ojppc0dvb2RPYmplY3QgKGtleSkpCisgIGlmIChw
dGhyZWFkX2tleTo6aXNfZ29vZF9vYmplY3QgKGtleSkpCiAgICAgcmV0dXJu
IEVCVVNZOwogCiAgICprZXkgPSBuZXcgcHRocmVhZF9rZXkgKGRlc3RydWN0
b3IpOwogCi0gIGlmICghcHRocmVhZF9rZXk6OmlzR29vZE9iamVjdCAoa2V5
KSkKKyAgaWYgKCFwdGhyZWFkX2tleTo6aXNfZ29vZF9vYmplY3QgKGtleSkp
CiAgICAgewogICAgICAgZGVsZXRlICgqa2V5KTsKICAgICAgICprZXkgPSBO
VUxMOwpAQCAtMjI4NSw3ICsyMjg4LDcgQEAgcHRocmVhZF9rZXlfY3JlYXRl
IChwdGhyZWFkX2tleV90ICprZXksIAogZXh0ZXJuICJDIiBpbnQKIHB0aHJl
YWRfa2V5X2RlbGV0ZSAocHRocmVhZF9rZXlfdCBrZXkpCiB7Ci0gIGlmICgh
cHRocmVhZF9rZXk6OmlzR29vZE9iamVjdCAoJmtleSkpCisgIGlmICghcHRo
cmVhZF9rZXk6OmlzX2dvb2Rfb2JqZWN0ICgma2V5KSkKICAgICByZXR1cm4g
RUlOVkFMOwogCiAgIGRlbGV0ZSAoa2V5KTsKQEAgLTIzMDksNyArMjMxMiw3
IEBAIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX3NldHNjaGVkcGFyYW0gKHB0
aHJlYWRfdCB0aHJlYWQsIGludCBwb2xpY3ksCiAJCQkgY29uc3Qgc3RydWN0
IHNjaGVkX3BhcmFtICpwYXJhbSkKIHsKLSAgaWYgKCFwdGhyZWFkOjppc0dv
b2RPYmplY3QgKCZ0aHJlYWQpKQorICBpZiAoIXB0aHJlYWQ6OmlzX2dvb2Rf
b2JqZWN0ICgmdGhyZWFkKSkKICAgICByZXR1cm4gRVNSQ0g7CiAgIGlmIChw
b2xpY3kgIT0gU0NIRURfRklGTykKICAgICByZXR1cm4gRU5PVFNVUDsKQEAg
LTIzMjYsNyArMjMyOSw3IEBAIHB0aHJlYWRfc2V0c2NoZWRwYXJhbSAocHRo
cmVhZF90IHRocmVhZCwKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX3NldHNw
ZWNpZmljIChwdGhyZWFkX2tleV90IGtleSwgY29uc3Qgdm9pZCAqdmFsdWUp
CiB7Ci0gIGlmICghcHRocmVhZF9rZXk6OmlzR29vZE9iamVjdCAoJmtleSkp
CisgIGlmICghcHRocmVhZF9rZXk6OmlzX2dvb2Rfb2JqZWN0ICgma2V5KSkK
ICAgICByZXR1cm4gRUlOVkFMOwogICAoa2V5KS0+c2V0ICh2YWx1ZSk7CiAg
IHJldHVybiAwOwpAQCAtMjMzNSw3ICsyMzM4LDcgQEAgcHRocmVhZF9zZXRz
cGVjaWZpYyAocHRocmVhZF9rZXlfdCBrZXksIAogZXh0ZXJuICJDIiB2b2lk
ICoKIHB0aHJlYWRfZ2V0c3BlY2lmaWMgKHB0aHJlYWRfa2V5X3Qga2V5KQog
ewotICBpZiAoIXB0aHJlYWRfa2V5Ojppc0dvb2RPYmplY3QgKCZrZXkpKQor
ICBpZiAoIXB0aHJlYWRfa2V5Ojppc19nb29kX29iamVjdCAoJmtleSkpCiAg
ICAgcmV0dXJuIE5VTEw7CiAKICAgcmV0dXJuIChrZXkpLT5nZXQgKCk7CkBA
IC0yMzQ0LDcgKzIzNDcsNyBAQCBwdGhyZWFkX2dldHNwZWNpZmljIChwdGhy
ZWFkX2tleV90IGtleSkKIAogLyogVGhyZWFkIHN5bmNocm9uaXNhdGlvbiAq
LwogYm9vbAotcHRocmVhZF9jb25kOjppc0dvb2RPYmplY3QgKHB0aHJlYWRf
Y29uZF90IGNvbnN0ICpjb25kKQorcHRocmVhZF9jb25kOjppc19nb29kX29i
amVjdCAocHRocmVhZF9jb25kX3QgY29uc3QgKmNvbmQpCiB7CiAgIGlmICh2
ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkIChjb25kLCBQVEhSRUFEX0NPTkRf
TUFHSUMpICE9IFZBTElEX09CSkVDVCkKICAgICByZXR1cm4gZmFsc2U7CkBA
IC0yMzUyLDcgKzIzNTUsNyBAQCBwdGhyZWFkX2NvbmQ6OmlzR29vZE9iamVj
dCAocHRocmVhZF9jb25kCiB9CiAKIGJvb2wKLXB0aHJlYWRfY29uZDo6aXNH
b29kSW5pdGlhbGl6ZXIgKHB0aHJlYWRfY29uZF90IGNvbnN0ICpjb25kKQor
cHRocmVhZF9jb25kOjppc19nb29kX2luaXRpYWxpemVyIChwdGhyZWFkX2Nv
bmRfdCBjb25zdCAqY29uZCkKIHsKICAgaWYgKHZlcmlmeWFibGVfb2JqZWN0
X2lzdmFsaWQgKGNvbmQsIFBUSFJFQURfQ09ORF9NQUdJQywgUFRIUkVBRF9D
T05EX0lOSVRJQUxJWkVSKSAhPSBWQUxJRF9TVEFUSUNfT0JKRUNUKQogICAg
IHJldHVybiBmYWxzZTsKQEAgLTIzNjAsNyArMjM2Myw3IEBAIHB0aHJlYWRf
Y29uZDo6aXNHb29kSW5pdGlhbGl6ZXIgKHB0aHJlYWQKIH0KIAogYm9vbAot
cHRocmVhZF9jb25kOjppc0dvb2RJbml0aWFsaXplck9yT2JqZWN0IChwdGhy
ZWFkX2NvbmRfdCBjb25zdCAqY29uZCkKK3B0aHJlYWRfY29uZDo6aXNfZ29v
ZF9pbml0aWFsaXplcl9vcl9vYmplY3QgKHB0aHJlYWRfY29uZF90IGNvbnN0
ICpjb25kKQogewogICBpZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAo
Y29uZCwgUFRIUkVBRF9DT05EX01BR0lDLCBQVEhSRUFEX0NPTkRfSU5JVElB
TElaRVIpID09IElOVkFMSURfT0JKRUNUKQogICAgIHJldHVybiBmYWxzZTsK
QEAgLTIzNjgsNyArMjM3MSw3IEBAIHB0aHJlYWRfY29uZDo6aXNHb29kSW5p
dGlhbGl6ZXJPck9iamVjdCAKIH0KIAogYm9vbAotcHRocmVhZF9jb25kOjpp
c0dvb2RJbml0aWFsaXplck9yQmFkT2JqZWN0IChwdGhyZWFkX2NvbmRfdCBj
b25zdCAqY29uZCkKK3B0aHJlYWRfY29uZDo6aXNfZ29vZF9pbml0aWFsaXpl
cl9vcl9iYWRfb2JqZWN0IChwdGhyZWFkX2NvbmRfdCBjb25zdCAqY29uZCkK
IHsKICAgdmVyaWZ5YWJsZV9vYmplY3Rfc3RhdGUgb2JqZWN0U3RhdGUgPSB2
ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkIChjb25kLCBQVEhSRUFEX0NPTkRf
TUFHSUMsIFBUSFJFQURfQ09ORF9JTklUSUFMSVpFUik7CiAgIGlmIChvYmpl
Y3RTdGF0ZSA9PSBWQUxJRF9PQkpFQ1QpCkBAIC0yMzc5LDkgKzIzODIsOSBA
QCBwdGhyZWFkX2NvbmQ6OmlzR29vZEluaXRpYWxpemVyT3JCYWRPYmplCiBl
eHRlcm4gIkMiIGludAogcHRocmVhZF9jb25kX2Rlc3Ryb3kgKHB0aHJlYWRf
Y29uZF90ICpjb25kKQogewotICBpZiAocHRocmVhZF9jb25kOjppc0dvb2RJ
bml0aWFsaXplciAoY29uZCkpCisgIGlmIChwdGhyZWFkX2NvbmQ6OmlzX2dv
b2RfaW5pdGlhbGl6ZXIgKGNvbmQpKQogICAgIHJldHVybiAwOwotICBpZiAo
IXB0aHJlYWRfY29uZDo6aXNHb29kT2JqZWN0IChjb25kKSkKKyAgaWYgKCFw
dGhyZWFkX2NvbmQ6OmlzX2dvb2Rfb2JqZWN0IChjb25kKSkKICAgICByZXR1
cm4gRUlOVkFMOwogCiAgIC8qIHJlYWRzIGFyZSBhdG9taWMgKi8KQEAgLTIz
OTcsMzggKzI0MDAsMzggQEAgcHRocmVhZF9jb25kX2Rlc3Ryb3kgKHB0aHJl
YWRfY29uZF90ICpjbwogaW50CiBwdGhyZWFkX2NvbmQ6OmluaXQgKHB0aHJl
YWRfY29uZF90ICpjb25kLCBjb25zdCBwdGhyZWFkX2NvbmRhdHRyX3QgKmF0
dHIpCiB7Ci0gIGlmIChhdHRyICYmICFwdGhyZWFkX2NvbmRhdHRyOjppc0dv
b2RPYmplY3QgKGF0dHIpKQorICBpZiAoYXR0ciAmJiAhcHRocmVhZF9jb25k
YXR0cjo6aXNfZ29vZF9vYmplY3QgKGF0dHIpKQogICAgIHJldHVybiBFSU5W
QUw7Ci0gIGlmICghY29uZEluaXRpYWxpemF0aW9uTG9jay5sb2NrICgpKQor
ICBpZiAoIWNvbmRfaW5pdGlhbGl6YXRpb25fbG9jay5sb2NrICgpKQogICAg
IHJldHVybiBFSU5WQUw7CiAKLSAgaWYgKCFpc0dvb2RJbml0aWFsaXplck9y
QmFkT2JqZWN0IChjb25kKSkKKyAgaWYgKCFpc19nb29kX2luaXRpYWxpemVy
X29yX2JhZF9vYmplY3QgKGNvbmQpKQogICAgIHsKLSAgICAgIGNvbmRJbml0
aWFsaXphdGlvbkxvY2sudW5sb2NrICgpOworICAgICAgY29uZF9pbml0aWFs
aXphdGlvbl9sb2NrLnVubG9jayAoKTsKICAgICAgIHJldHVybiBFQlVTWTsK
ICAgICB9CiAKICAgKmNvbmQgPSBuZXcgcHRocmVhZF9jb25kIChhdHRyID8g
KCphdHRyKSA6IE5VTEwpOwotICBpZiAoIWlzR29vZE9iamVjdCAoY29uZCkp
CisgIGlmICghaXNfZ29vZF9vYmplY3QgKGNvbmQpKQogICAgIHsKICAgICAg
IGRlbGV0ZSAoKmNvbmQpOwogICAgICAgKmNvbmQgPSBOVUxMOwotICAgICAg
Y29uZEluaXRpYWxpemF0aW9uTG9jay51bmxvY2sgKCk7CisgICAgICBjb25k
X2luaXRpYWxpemF0aW9uX2xvY2sudW5sb2NrICgpOwogICAgICAgcmV0dXJu
IEVBR0FJTjsKICAgICB9Ci0gIGNvbmRJbml0aWFsaXphdGlvbkxvY2sudW5s
b2NrICgpOworICBjb25kX2luaXRpYWxpemF0aW9uX2xvY2sudW5sb2NrICgp
OwogICByZXR1cm4gMDsKIH0KIAogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRf
Y29uZF9icm9hZGNhc3QgKHB0aHJlYWRfY29uZF90ICpjb25kKQogewotICBp
ZiAocHRocmVhZF9jb25kOjppc0dvb2RJbml0aWFsaXplciAoY29uZCkpCisg
IGlmIChwdGhyZWFkX2NvbmQ6OmlzX2dvb2RfaW5pdGlhbGl6ZXIgKGNvbmQp
KQogICAgIHJldHVybiAwOwotICBpZiAoIXB0aHJlYWRfY29uZDo6aXNHb29k
T2JqZWN0IChjb25kKSkKKyAgaWYgKCFwdGhyZWFkX2NvbmQ6OmlzX2dvb2Rf
b2JqZWN0IChjb25kKSkKICAgICByZXR1cm4gRUlOVkFMOwogCi0gICgqY29u
ZCktPlVuQmxvY2sgKHRydWUpOworICAoKmNvbmQpLT51bmJsb2NrICh0cnVl
KTsKIAogICByZXR1cm4gMDsKIH0KQEAgLTI0MzYsMTIgKzI0MzksMTIgQEAg
cHRocmVhZF9jb25kX2Jyb2FkY2FzdCAocHRocmVhZF9jb25kX3QgKgogZXh0
ZXJuICJDIiBpbnQKIHB0aHJlYWRfY29uZF9zaWduYWwgKHB0aHJlYWRfY29u
ZF90ICpjb25kKQogewotICBpZiAocHRocmVhZF9jb25kOjppc0dvb2RJbml0
aWFsaXplciAoY29uZCkpCisgIGlmIChwdGhyZWFkX2NvbmQ6OmlzX2dvb2Rf
aW5pdGlhbGl6ZXIgKGNvbmQpKQogICAgIHJldHVybiAwOwotICBpZiAoIXB0
aHJlYWRfY29uZDo6aXNHb29kT2JqZWN0IChjb25kKSkKKyAgaWYgKCFwdGhy
ZWFkX2NvbmQ6OmlzX2dvb2Rfb2JqZWN0IChjb25kKSkKICAgICByZXR1cm4g
RUlOVkFMOwogCi0gICgqY29uZCktPlVuQmxvY2sgKGZhbHNlKTsKKyAgKCpj
b25kKS0+dW5ibG9jayAoZmFsc2UpOwogCiAgIHJldHVybiAwOwogfQpAQCAt
MjQ1MCwxNyArMjQ1MywxNyBAQCBzdGF0aWMgaW50CiBfX3B0aHJlYWRfY29u
ZF9kb3dhaXQgKHB0aHJlYWRfY29uZF90ICpjb25kLCBwdGhyZWFkX211dGV4
X3QgKm11dGV4LAogCQkgICAgICAgRFdPUkQgd2FpdGxlbmd0aCkKIHsKLSAg
aWYgKCFwdGhyZWFkX211dGV4Ojppc0dvb2RPYmplY3QgKG11dGV4KSkKKyAg
aWYgKCFwdGhyZWFkX211dGV4Ojppc19nb29kX29iamVjdCAobXV0ZXgpKQog
ICAgIHJldHVybiBFSU5WQUw7Ci0gIGlmICghcHRocmVhZF9tdXRleDo6Y2Fu
QmVVbmxvY2tlZCAobXV0ZXgpKQorICBpZiAoIXB0aHJlYWRfbXV0ZXg6OmNh
bl9iZV91bmxvY2tlZCAobXV0ZXgpKQogICAgIHJldHVybiBFUEVSTTsKIAot
ICBpZiAocHRocmVhZF9jb25kOjppc0dvb2RJbml0aWFsaXplciAoY29uZCkp
CisgIGlmIChwdGhyZWFkX2NvbmQ6OmlzX2dvb2RfaW5pdGlhbGl6ZXIgKGNv
bmQpKQogICAgIHB0aHJlYWRfY29uZDo6aW5pdCAoY29uZCwgTlVMTCk7Ci0g
IGlmICghcHRocmVhZF9jb25kOjppc0dvb2RPYmplY3QgKGNvbmQpKQorICBp
ZiAoIXB0aHJlYWRfY29uZDo6aXNfZ29vZF9vYmplY3QgKGNvbmQpKQogICAg
IHJldHVybiBFSU5WQUw7CiAKLSAgcmV0dXJuICgqY29uZCktPldhaXQgKCpt
dXRleCwgd2FpdGxlbmd0aCk7CisgIHJldHVybiAoKmNvbmQpLT53YWl0ICgq
bXV0ZXgsIHdhaXRsZW5ndGgpOwogfQogCiBleHRlcm4gIkMiIGludApAQCAt
MjQ5Nyw3ICsyNTAwLDcgQEAgcHRocmVhZF9jb25kYXR0cl9pbml0IChwdGhy
ZWFkX2NvbmRhdHRyXwogICBpZiAoY2hlY2tfdmFsaWRfcG9pbnRlciAoY29u
ZGF0dHIpKQogICAgIHJldHVybiBFSU5WQUw7CiAgICpjb25kYXR0ciA9IG5l
dyBwdGhyZWFkX2NvbmRhdHRyOwotICBpZiAoIXB0aHJlYWRfY29uZGF0dHI6
OmlzR29vZE9iamVjdCAoY29uZGF0dHIpKQorICBpZiAoIXB0aHJlYWRfY29u
ZGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChjb25kYXR0cikpCiAgICAgewogICAg
ICAgZGVsZXRlICgqY29uZGF0dHIpOwogICAgICAgKmNvbmRhdHRyID0gTlVM
TDsKQEAgLTI1MDksNyArMjUxMiw3IEBAIHB0aHJlYWRfY29uZGF0dHJfaW5p
dCAocHRocmVhZF9jb25kYXR0cl8KIGV4dGVybiAiQyIgaW50CiBwdGhyZWFk
X2NvbmRhdHRyX2dldHBzaGFyZWQgKGNvbnN0IHB0aHJlYWRfY29uZGF0dHJf
dCAqYXR0ciwgaW50ICpwc2hhcmVkKQogewotICBpZiAoIXB0aHJlYWRfY29u
ZGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9j
b25kYXR0cjo6aXNfZ29vZF9vYmplY3QgKGF0dHIpKQogICAgIHJldHVybiBF
SU5WQUw7CiAgICpwc2hhcmVkID0gKCphdHRyKS0+c2hhcmVkOwogICByZXR1
cm4gMDsKQEAgLTI1MTgsNyArMjUyMSw3IEBAIHB0aHJlYWRfY29uZGF0dHJf
Z2V0cHNoYXJlZCAoY29uc3QgcHRocmUKIGV4dGVybiAiQyIgaW50CiBwdGhy
ZWFkX2NvbmRhdHRyX3NldHBzaGFyZWQgKHB0aHJlYWRfY29uZGF0dHJfdCAq
YXR0ciwgaW50IHBzaGFyZWQpCiB7Ci0gIGlmICghcHRocmVhZF9jb25kYXR0
cjo6aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX2NvbmRh
dHRyOjppc19nb29kX29iamVjdCAoYXR0cikpCiAgICAgcmV0dXJuIEVJTlZB
TDsKICAgaWYgKChwc2hhcmVkIDwgMCkgfHwgKHBzaGFyZWQgPiAxKSkKICAg
ICByZXR1cm4gRUlOVkFMOwpAQCAtMjUzMiw3ICsyNTM1LDcgQEAgcHRocmVh
ZF9jb25kYXR0cl9zZXRwc2hhcmVkIChwdGhyZWFkX2NvbgogZXh0ZXJuICJD
IiBpbnQKIHB0aHJlYWRfY29uZGF0dHJfZGVzdHJveSAocHRocmVhZF9jb25k
YXR0cl90ICpjb25kYXR0cikKIHsKLSAgaWYgKCFwdGhyZWFkX2NvbmRhdHRy
Ojppc0dvb2RPYmplY3QgKGNvbmRhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX2Nv
bmRhdHRyOjppc19nb29kX29iamVjdCAoY29uZGF0dHIpKQogICAgIHJldHVy
biBFSU5WQUw7CiAgIGRlbGV0ZSAoKmNvbmRhdHRyKTsKICAgKmNvbmRhdHRy
ID0gTlVMTDsKQEAgLTI1NDEsNyArMjU0NCw3IEBAIHB0aHJlYWRfY29uZGF0
dHJfZGVzdHJveSAocHRocmVhZF9jb25kYXQKIAogLyogUlcgbG9ja3MgKi8K
IGJvb2wKLXB0aHJlYWRfcndsb2NrOjppc0dvb2RPYmplY3QgKHB0aHJlYWRf
cndsb2NrX3QgY29uc3QgKnJ3bG9jaykKK3B0aHJlYWRfcndsb2NrOjppc19n
b29kX29iamVjdCAocHRocmVhZF9yd2xvY2tfdCBjb25zdCAqcndsb2NrKQog
ewogICBpZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAocndsb2NrLCBQ
VEhSRUFEX1JXTE9DS19NQUdJQykgIT0gVkFMSURfT0JKRUNUKQogICAgIHJl
dHVybiBmYWxzZTsKQEAgLTI1NDksNyArMjU1Miw3IEBAIHB0aHJlYWRfcnds
b2NrOjppc0dvb2RPYmplY3QgKHB0aHJlYWRfcncKIH0KIAogYm9vbAotcHRo
cmVhZF9yd2xvY2s6OmlzR29vZEluaXRpYWxpemVyIChwdGhyZWFkX3J3bG9j
a190IGNvbnN0ICpyd2xvY2spCitwdGhyZWFkX3J3bG9jazo6aXNfZ29vZF9p
bml0aWFsaXplciAocHRocmVhZF9yd2xvY2tfdCBjb25zdCAqcndsb2NrKQog
ewogICBpZiAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAocndsb2NrLCBQ
VEhSRUFEX1JXTE9DS19NQUdJQywgUFRIUkVBRF9SV0xPQ0tfSU5JVElBTEla
RVIpICE9IFZBTElEX1NUQVRJQ19PQkpFQ1QpCiAgICAgcmV0dXJuIGZhbHNl
OwpAQCAtMjU1Nyw3ICsyNTYwLDcgQEAgcHRocmVhZF9yd2xvY2s6OmlzR29v
ZEluaXRpYWxpemVyIChwdGhyZQogfQogCiBib29sCi1wdGhyZWFkX3J3bG9j
azo6aXNHb29kSW5pdGlhbGl6ZXJPck9iamVjdCAocHRocmVhZF9yd2xvY2tf
dCBjb25zdCAqcndsb2NrKQorcHRocmVhZF9yd2xvY2s6OmlzX2dvb2RfaW5p
dGlhbGl6ZXJfb3Jfb2JqZWN0IChwdGhyZWFkX3J3bG9ja190IGNvbnN0ICpy
d2xvY2spCiB7CiAgIGlmICh2ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkIChy
d2xvY2ssIFBUSFJFQURfUldMT0NLX01BR0lDLCBQVEhSRUFEX1JXTE9DS19J
TklUSUFMSVpFUikgPT0gSU5WQUxJRF9PQkpFQ1QpCiAgICAgcmV0dXJuIGZh
bHNlOwpAQCAtMjU2NSw3ICsyNTY4LDcgQEAgcHRocmVhZF9yd2xvY2s6Omlz
R29vZEluaXRpYWxpemVyT3JPYmplYwogfQogCiBib29sCi1wdGhyZWFkX3J3
bG9jazo6aXNHb29kSW5pdGlhbGl6ZXJPckJhZE9iamVjdCAocHRocmVhZF9y
d2xvY2tfdCBjb25zdCAqcndsb2NrKQorcHRocmVhZF9yd2xvY2s6OmlzX2dv
b2RfaW5pdGlhbGl6ZXJfb3JfYmFkX29iamVjdCAocHRocmVhZF9yd2xvY2tf
dCBjb25zdCAqcndsb2NrKQogewogICB2ZXJpZnlhYmxlX29iamVjdF9zdGF0
ZSBvYmplY3RTdGF0ZSA9IHZlcmlmeWFibGVfb2JqZWN0X2lzdmFsaWQgKHJ3
bG9jaywgUFRIUkVBRF9SV0xPQ0tfTUFHSUMsIFBUSFJFQURfUldMT0NLX0lO
SVRJQUxJWkVSKTsKICAgaWYgKG9iamVjdFN0YXRlID09IFZBTElEX09CSkVD
VCkKQEAgLTI1NzYsMTMgKzI1NzksMTMgQEAgcHRocmVhZF9yd2xvY2s6Omlz
R29vZEluaXRpYWxpemVyT3JCYWRPYgogZXh0ZXJuICJDIiBpbnQKIHB0aHJl
YWRfcndsb2NrX2Rlc3Ryb3kgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykK
IHsKLSAgaWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFsaXplciAo
cndsb2NrKSkKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc19nb29kX2luaXRp
YWxpemVyIChyd2xvY2spKQogICAgIHJldHVybiAwOwotICBpZiAoIXB0aHJl
YWRfcndsb2NrOjppc0dvb2RPYmplY3QgKHJ3bG9jaykpCisgIGlmICghcHRo
cmVhZF9yd2xvY2s6OmlzX2dvb2Rfb2JqZWN0IChyd2xvY2spKQogICAgIHJl
dHVybiBFSU5WQUw7CiAKICAgaWYgKCgqcndsb2NrKS0+d3JpdGVyIHx8ICgq
cndsb2NrKS0+cmVhZGVycyB8fAotICAgICAgKCpyd2xvY2spLT53YWl0aW5n
UmVhZGVycyB8fCAoKnJ3bG9jayktPndhaXRpbmdXcml0ZXJzKQorICAgICAg
KCpyd2xvY2spLT53YWl0aW5nX3JlYWRlcnMgfHwgKCpyd2xvY2spLT53YWl0
aW5nX3dyaXRlcnMpCiAgICAgcmV0dXJuIEVCVVNZOwogCiAgIGRlbGV0ZSAo
KnJ3bG9jayk7CkBAIC0yNTk0LDI2ICsyNTk3LDI2IEBAIHB0aHJlYWRfcnds
b2NrX2Rlc3Ryb3kgKHB0aHJlYWRfcndsb2NrX3QKIGludAogcHRocmVhZF9y
d2xvY2s6OmluaXQgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaywgY29uc3Qg
cHRocmVhZF9yd2xvY2thdHRyX3QgKmF0dHIpCiB7Ci0gIGlmIChhdHRyICYm
ICFwdGhyZWFkX3J3bG9ja2F0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisg
IGlmIChhdHRyICYmICFwdGhyZWFkX3J3bG9ja2F0dHI6OmlzX2dvb2Rfb2Jq
ZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwotICBpZiAoIXJ3bG9j
a0luaXRpYWxpemF0aW9uTG9jay5sb2NrICgpKQorICBpZiAoIXJ3bG9ja19p
bml0aWFsaXphdGlvbl9sb2NrLmxvY2sgKCkpCiAgICAgcmV0dXJuIEVJTlZB
TDsKIAotICBpZiAoIWlzR29vZEluaXRpYWxpemVyT3JCYWRPYmplY3QgKHJ3
bG9jaykpCisgIGlmICghaXNfZ29vZF9pbml0aWFsaXplcl9vcl9iYWRfb2Jq
ZWN0IChyd2xvY2spKQogICAgIHsKLSAgICAgIHJ3bG9ja0luaXRpYWxpemF0
aW9uTG9jay51bmxvY2sgKCk7CisgICAgICByd2xvY2tfaW5pdGlhbGl6YXRp
b25fbG9jay51bmxvY2sgKCk7CiAgICAgICByZXR1cm4gRUJVU1k7CiAgICAg
fQogCiAgICpyd2xvY2sgPSBuZXcgcHRocmVhZF9yd2xvY2sgKGF0dHIgPyAo
KmF0dHIpIDogTlVMTCk7Ci0gIGlmICghaXNHb29kT2JqZWN0IChyd2xvY2sp
KQorICBpZiAoIWlzX2dvb2Rfb2JqZWN0IChyd2xvY2spKQogICAgIHsKICAg
ICAgIGRlbGV0ZSAoKnJ3bG9jayk7CiAgICAgICAqcndsb2NrID0gTlVMTDsK
LSAgICAgIHJ3bG9ja0luaXRpYWxpemF0aW9uTG9jay51bmxvY2sgKCk7Cisg
ICAgICByd2xvY2tfaW5pdGlhbGl6YXRpb25fbG9jay51bmxvY2sgKCk7CiAg
ICAgICByZXR1cm4gRUFHQUlOOwogICAgIH0KLSAgcndsb2NrSW5pdGlhbGl6
YXRpb25Mb2NrLnVubG9jayAoKTsKKyAgcndsb2NrX2luaXRpYWxpemF0aW9u
X2xvY2sudW5sb2NrICgpOwogICByZXR1cm4gMDsKIH0KIApAQCAtMjYyMiwy
MyArMjYyNSwyMyBAQCBwdGhyZWFkX3J3bG9ja19yZGxvY2sgKHB0aHJlYWRf
cndsb2NrX3QgCiB7CiAgIHB0aHJlYWRfdGVzdGNhbmNlbCAoKTsKIAotICBp
ZiAocHRocmVhZF9yd2xvY2s6OmlzR29vZEluaXRpYWxpemVyIChyd2xvY2sp
KQorICBpZiAocHRocmVhZF9yd2xvY2s6OmlzX2dvb2RfaW5pdGlhbGl6ZXIg
KHJ3bG9jaykpCiAgICAgcHRocmVhZF9yd2xvY2s6OmluaXQgKHJ3bG9jaywg
TlVMTCk7Ci0gIGlmICghcHRocmVhZF9yd2xvY2s6OmlzR29vZE9iamVjdCAo
cndsb2NrKSkKKyAgaWYgKCFwdGhyZWFkX3J3bG9jazo6aXNfZ29vZF9vYmpl
Y3QgKHJ3bG9jaykpCiAgICAgcmV0dXJuIEVJTlZBTDsKIAotICByZXR1cm4g
KCpyd2xvY2spLT5SZExvY2sgKCk7CisgIHJldHVybiAoKnJ3bG9jayktPnJk
bG9jayAoKTsKIH0KIAogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfcndsb2Nr
X3RyeXJkbG9jayAocHRocmVhZF9yd2xvY2tfdCAqcndsb2NrKQogewotICBp
ZiAocHRocmVhZF9yd2xvY2s6OmlzR29vZEluaXRpYWxpemVyIChyd2xvY2sp
KQorICBpZiAocHRocmVhZF9yd2xvY2s6OmlzX2dvb2RfaW5pdGlhbGl6ZXIg
KHJ3bG9jaykpCiAgICAgcHRocmVhZF9yd2xvY2s6OmluaXQgKHJ3bG9jaywg
TlVMTCk7Ci0gIGlmICghcHRocmVhZF9yd2xvY2s6OmlzR29vZE9iamVjdCAo
cndsb2NrKSkKKyAgaWYgKCFwdGhyZWFkX3J3bG9jazo6aXNfZ29vZF9vYmpl
Y3QgKHJ3bG9jaykpCiAgICAgcmV0dXJuIEVJTlZBTDsKIAotICByZXR1cm4g
KCpyd2xvY2spLT5UcnlSZExvY2sgKCk7CisgIHJldHVybiAoKnJ3bG9jaykt
PnRyeXJkbG9jayAoKTsKIH0KIAogZXh0ZXJuICJDIiBpbnQKQEAgLTI2NDYs
MzQgKzI2NDksMzQgQEAgcHRocmVhZF9yd2xvY2tfd3Jsb2NrIChwdGhyZWFk
X3J3bG9ja190IAogewogICBwdGhyZWFkX3Rlc3RjYW5jZWwgKCk7CiAKLSAg
aWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFsaXplciAocndsb2Nr
KSkKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc19nb29kX2luaXRpYWxpemVy
IChyd2xvY2spKQogICAgIHB0aHJlYWRfcndsb2NrOjppbml0IChyd2xvY2ss
IE5VTEwpOwotICBpZiAoIXB0aHJlYWRfcndsb2NrOjppc0dvb2RPYmplY3Qg
KHJ3bG9jaykpCisgIGlmICghcHRocmVhZF9yd2xvY2s6OmlzX2dvb2Rfb2Jq
ZWN0IChyd2xvY2spKQogICAgIHJldHVybiBFSU5WQUw7CiAKLSAgcmV0dXJu
ICgqcndsb2NrKS0+V3JMb2NrICgpOworICByZXR1cm4gKCpyd2xvY2spLT53
cmxvY2sgKCk7CiB9CiAKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX3J3bG9j
a190cnl3cmxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykKIHsKLSAg
aWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFsaXplciAocndsb2Nr
KSkKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc19nb29kX2luaXRpYWxpemVy
IChyd2xvY2spKQogICAgIHB0aHJlYWRfcndsb2NrOjppbml0IChyd2xvY2ss
IE5VTEwpOwotICBpZiAoIXB0aHJlYWRfcndsb2NrOjppc0dvb2RPYmplY3Qg
KHJ3bG9jaykpCisgIGlmICghcHRocmVhZF9yd2xvY2s6OmlzX2dvb2Rfb2Jq
ZWN0IChyd2xvY2spKQogICAgIHJldHVybiBFSU5WQUw7CiAKLSAgcmV0dXJu
ICgqcndsb2NrKS0+VHJ5V3JMb2NrICgpOworICByZXR1cm4gKCpyd2xvY2sp
LT50cnl3cmxvY2sgKCk7CiB9CiAKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFk
X3J3bG9ja191bmxvY2sgKHB0aHJlYWRfcndsb2NrX3QgKnJ3bG9jaykKIHsK
LSAgaWYgKHB0aHJlYWRfcndsb2NrOjppc0dvb2RJbml0aWFsaXplciAocnds
b2NrKSkKKyAgaWYgKHB0aHJlYWRfcndsb2NrOjppc19nb29kX2luaXRpYWxp
emVyIChyd2xvY2spKQogICAgIHJldHVybiAwOwotICBpZiAoIXB0aHJlYWRf
cndsb2NrOjppc0dvb2RPYmplY3QgKHJ3bG9jaykpCisgIGlmICghcHRocmVh
ZF9yd2xvY2s6OmlzX2dvb2Rfb2JqZWN0IChyd2xvY2spKQogICAgIHJldHVy
biBFSU5WQUw7CiAKLSAgcmV0dXJuICgqcndsb2NrKS0+VW5Mb2NrICgpOwor
ICByZXR1cm4gKCpyd2xvY2spLT51bmxvY2sgKCk7CiB9CiAKIGV4dGVybiAi
QyIgaW50CkBAIC0yNjgyLDcgKzI2ODUsNyBAQCBwdGhyZWFkX3J3bG9ja2F0
dHJfaW5pdCAocHRocmVhZF9yd2xvY2thCiAgIGlmIChjaGVja192YWxpZF9w
b2ludGVyIChyd2xvY2thdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwogICAq
cndsb2NrYXR0ciA9IG5ldyBwdGhyZWFkX3J3bG9ja2F0dHI7Ci0gIGlmICgh
cHRocmVhZF9yd2xvY2thdHRyOjppc0dvb2RPYmplY3QgKHJ3bG9ja2F0dHIp
KQorICBpZiAoIXB0aHJlYWRfcndsb2NrYXR0cjo6aXNfZ29vZF9vYmplY3Qg
KHJ3bG9ja2F0dHIpKQogICAgIHsKICAgICAgIGRlbGV0ZSAoKnJ3bG9ja2F0
dHIpOwogICAgICAgKnJ3bG9ja2F0dHIgPSBOVUxMOwpAQCAtMjY5NCw3ICsy
Njk3LDcgQEAgcHRocmVhZF9yd2xvY2thdHRyX2luaXQgKHB0aHJlYWRfcnds
b2NrYQogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfcndsb2NrYXR0cl9nZXRw
c2hhcmVkIChjb25zdCBwdGhyZWFkX3J3bG9ja2F0dHJfdCAqYXR0ciwgaW50
ICpwc2hhcmVkKQogewotICBpZiAoIXB0aHJlYWRfcndsb2NrYXR0cjo6aXNH
b29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX3J3bG9ja2F0dHI6
OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwog
ICAqcHNoYXJlZCA9ICgqYXR0ciktPnNoYXJlZDsKICAgcmV0dXJuIDA7CkBA
IC0yNzAzLDcgKzI3MDYsNyBAQCBwdGhyZWFkX3J3bG9ja2F0dHJfZ2V0cHNo
YXJlZCAoY29uc3QgcHRoCiBleHRlcm4gIkMiIGludAogcHRocmVhZF9yd2xv
Y2thdHRyX3NldHBzaGFyZWQgKHB0aHJlYWRfcndsb2NrYXR0cl90ICphdHRy
LCBpbnQgcHNoYXJlZCkKIHsKLSAgaWYgKCFwdGhyZWFkX3J3bG9ja2F0dHI6
OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9yd2xvY2th
dHRyOjppc19nb29kX29iamVjdCAoYXR0cikpCiAgICAgcmV0dXJuIEVJTlZB
TDsKICAgaWYgKChwc2hhcmVkIDwgMCkgfHwgKHBzaGFyZWQgPiAxKSkKICAg
ICByZXR1cm4gRUlOVkFMOwpAQCAtMjcxNyw3ICsyNzIwLDcgQEAgcHRocmVh
ZF9yd2xvY2thdHRyX3NldHBzaGFyZWQgKHB0aHJlYWRfcgogZXh0ZXJuICJD
IiBpbnQKIHB0aHJlYWRfcndsb2NrYXR0cl9kZXN0cm95IChwdGhyZWFkX3J3
bG9ja2F0dHJfdCAqcndsb2NrYXR0cikKIHsKLSAgaWYgKCFwdGhyZWFkX3J3
bG9ja2F0dHI6OmlzR29vZE9iamVjdCAocndsb2NrYXR0cikpCisgIGlmICgh
cHRocmVhZF9yd2xvY2thdHRyOjppc19nb29kX29iamVjdCAocndsb2NrYXR0
cikpCiAgICAgcmV0dXJuIEVJTlZBTDsKICAgZGVsZXRlICgqcndsb2NrYXR0
cik7CiAgICpyd2xvY2thdHRyID0gTlVMTDsKQEAgLTI3MzEsNyArMjczNCw3
IEBAIHB0aHJlYWRfa2lsbCAocHRocmVhZF90IHRocmVhZCwgaW50IHNpZykK
ICAgLy8gbG9jayBteXNlbGYsIGZvciB0aGUgdXNlIG9mIHRocmVhZDJzaWdu
YWwKICAgLy8gdHdvIGRpZmZlcmVudCBraWxscyBtaWdodCBjbGFzaDogRklY
TUUKIAotICBpZiAoIXB0aHJlYWQ6OmlzR29vZE9iamVjdCAoJnRocmVhZCkp
CisgIGlmICghcHRocmVhZDo6aXNfZ29vZF9vYmplY3QgKCZ0aHJlYWQpKQog
ICAgIHJldHVybiBFSU5WQUw7CiAKICAgaWYgKHRocmVhZC0+c2lncykKQEAg
LTI3ODMsMjYgKzI3ODYsMjYgQEAgaW50CiBwdGhyZWFkX211dGV4Ojppbml0
IChwdGhyZWFkX211dGV4X3QgKm11dGV4LAogCQkgICAgICBjb25zdCBwdGhy
ZWFkX211dGV4YXR0cl90ICphdHRyKQogewotICBpZiAoYXR0ciAmJiAhcHRo
cmVhZF9tdXRleGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikgfHwgY2hlY2tf
dmFsaWRfcG9pbnRlciAobXV0ZXgpKQorICBpZiAoYXR0ciAmJiAhcHRocmVh
ZF9tdXRleGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSB8fCBjaGVja192
YWxpZF9wb2ludGVyIChtdXRleCkpCiAgICAgcmV0dXJuIEVJTlZBTDsKLSAg
aWYgKCFtdXRleEluaXRpYWxpemF0aW9uTG9jay5sb2NrICgpKQorICBpZiAo
IW11dGV4X2luaXRpYWxpemF0aW9uX2xvY2subG9jayAoKSkKICAgICByZXR1
cm4gRUlOVkFMOwogCi0gIGlmICghaXNHb29kSW5pdGlhbGl6ZXJPckJhZE9i
amVjdCAobXV0ZXgpKQorICBpZiAoIWlzX2dvb2RfaW5pdGlhbGl6ZXJfb3Jf
YmFkX29iamVjdCAobXV0ZXgpKQogICAgIHsKLSAgICAgIG11dGV4SW5pdGlh
bGl6YXRpb25Mb2NrLnVubG9jayAoKTsKKyAgICAgIG11dGV4X2luaXRpYWxp
emF0aW9uX2xvY2sudW5sb2NrICgpOwogICAgICAgcmV0dXJuIEVCVVNZOwog
ICAgIH0KIAogICAqbXV0ZXggPSBuZXcgcHRocmVhZF9tdXRleCAoYXR0ciA/
ICgqYXR0cikgOiBOVUxMKTsKLSAgaWYgKCFpc0dvb2RPYmplY3QgKG11dGV4
KSkKKyAgaWYgKCFpc19nb29kX29iamVjdCAobXV0ZXgpKQogICAgIHsKICAg
ICAgIGRlbGV0ZSAoKm11dGV4KTsKICAgICAgICptdXRleCA9IE5VTEw7Ci0g
ICAgICBtdXRleEluaXRpYWxpemF0aW9uTG9jay51bmxvY2sgKCk7CisgICAg
ICBtdXRleF9pbml0aWFsaXphdGlvbl9sb2NrLnVubG9jayAoKTsKICAgICAg
IHJldHVybiBFQUdBSU47CiAgICAgfQotICBtdXRleEluaXRpYWxpemF0aW9u
TG9jay51bmxvY2sgKCk7CisgIG11dGV4X2luaXRpYWxpemF0aW9uX2xvY2su
dW5sb2NrICgpOwogICByZXR1cm4gMDsKIH0KIApAQCAtMjgxMSw5ICsyODE0
LDkgQEAgcHRocmVhZF9tdXRleF9nZXRwcmlvY2VpbGluZyAoY29uc3QgcHRo
cgogCQkJCWludCAqcHJpb2NlaWxpbmcpCiB7CiAgIHB0aHJlYWRfbXV0ZXhf
dCAqdGhlbXV0ZXggPSAocHRocmVhZF9tdXRleF90ICopIG11dGV4OwotICBp
ZiAocHRocmVhZF9tdXRleDo6aXNHb29kSW5pdGlhbGl6ZXIgKG11dGV4KSkK
KyAgaWYgKHB0aHJlYWRfbXV0ZXg6OmlzX2dvb2RfaW5pdGlhbGl6ZXIgKG11
dGV4KSkKICAgICBwdGhyZWFkX211dGV4Ojppbml0ICgocHRocmVhZF9tdXRl
eF90ICopIG11dGV4LCBOVUxMKTsKLSAgaWYgKCFwdGhyZWFkX211dGV4Ojpp
c0dvb2RPYmplY3QgKHRoZW11dGV4KSkKKyAgaWYgKCFwdGhyZWFkX211dGV4
Ojppc19nb29kX29iamVjdCAodGhlbXV0ZXgpKQogICAgIHJldHVybiBFSU5W
QUw7CiAgIC8qIFdlIGRvbid0IGRlZmluZSBfUE9TSVhfVEhSRUFEX1BSSU9f
UFJPVEVDVCBiZWNhdXNlIHdlIGRvJ3QgY3VycmVudGx5IHN1cHBvcnQKICAg
ICAgbXV0ZXggcHJpb3JpdGllcy4KQEAgLTI4MjksOCArMjgzMiw4IEBAIGV4
dGVybiAiQyIgaW50CiBwdGhyZWFkX211dGV4X2xvY2sgKHB0aHJlYWRfbXV0
ZXhfdCAqbXV0ZXgpCiB7CiAgIHB0aHJlYWRfbXV0ZXhfdCAqdGhlbXV0ZXgg
PSBtdXRleDsKLSAgLyogVGhpcyBjb3VsZCBiZSBzaW1wbGlmaWVkIHZpYSBp
c0dvb2RJbml0aWFsaXplck9yT2JqZWN0Ci0gICAgIGFuZCBpc0dvb2RJbml0
aWFsaXplciwgYnV0IGluIGEgcGVyZm9ybWFuY2UgY3JpdGljYWwgY2FsbCBs
aWtlIHRoaXMuLi4uCisgIC8qIFRoaXMgY291bGQgYmUgc2ltcGxpZmllZCB2
aWEgaXNfZ29vZF9pbml0aWFsaXplcl9vcl9vYmplY3QKKyAgICAgYW5kIGlz
X2dvb2RfaW5pdGlhbGl6ZXIsIGJ1dCBpbiBhIHBlcmZvcm1hbmNlIGNyaXRp
Y2FsIGNhbGwgbGlrZSB0aGlzLi4uLgogICAgICBuby4gICovCiAgIHN3aXRj
aCAodmVyaWZ5YWJsZV9vYmplY3RfaXN2YWxpZCAodGhlbXV0ZXgsIFBUSFJF
QURfTVVURVhfTUFHSUMsIFBUSFJFQURfTVVURVhfSU5JVElBTElaRVIpKQog
ICAgIHsKQEAgLTI4MzgsNyArMjg0MSw3IEBAIHB0aHJlYWRfbXV0ZXhfbG9j
ayAocHRocmVhZF9tdXRleF90ICptdXQKICAgICAgIHJldHVybiBFSU5WQUw7
CiAgICAgICBicmVhazsKICAgICBjYXNlIFZBTElEX1NUQVRJQ19PQkpFQ1Q6
Ci0gICAgICBpZiAocHRocmVhZF9tdXRleDo6aXNHb29kSW5pdGlhbGl6ZXIg
KG11dGV4KSkKKyAgICAgIGlmIChwdGhyZWFkX211dGV4Ojppc19nb29kX2lu
aXRpYWxpemVyIChtdXRleCkpCiAJewogCSAgaW50IHJ2ID0gcHRocmVhZF9t
dXRleDo6aW5pdCAobXV0ZXgsIE5VTEwpOwogCSAgaWYgKHJ2ICYmIHJ2ICE9
IEVCVVNZKQpAQCAtMjg1MCwyOCArMjg1MywyOCBAQCBwdGhyZWFkX211dGV4
X2xvY2sgKHB0aHJlYWRfbXV0ZXhfdCAqbXV0CiAgICAgY2FzZSBWQUxJRF9P
QkpFQ1Q6CiAgICAgICBicmVhazsKICAgICB9Ci0gIHJldHVybiAoKnRoZW11
dGV4KS0+TG9jayAoKTsKKyAgcmV0dXJuICgqdGhlbXV0ZXgpLT5sb2NrICgp
OwogfQogCiBleHRlcm4gIkMiIGludAogcHRocmVhZF9tdXRleF90cnlsb2Nr
IChwdGhyZWFkX211dGV4X3QgKm11dGV4KQogewogICBwdGhyZWFkX211dGV4
X3QgKnRoZW11dGV4ID0gbXV0ZXg7Ci0gIGlmIChwdGhyZWFkX211dGV4Ojpp
c0dvb2RJbml0aWFsaXplciAobXV0ZXgpKQorICBpZiAocHRocmVhZF9tdXRl
eDo6aXNfZ29vZF9pbml0aWFsaXplciAobXV0ZXgpKQogICAgIHB0aHJlYWRf
bXV0ZXg6OmluaXQgKG11dGV4LCBOVUxMKTsKLSAgaWYgKCFwdGhyZWFkX211
dGV4Ojppc0dvb2RPYmplY3QgKHRoZW11dGV4KSkKKyAgaWYgKCFwdGhyZWFk
X211dGV4Ojppc19nb29kX29iamVjdCAodGhlbXV0ZXgpKQogICAgIHJldHVy
biBFSU5WQUw7Ci0gIHJldHVybiAoKnRoZW11dGV4KS0+VHJ5TG9jayAoKTsK
KyAgcmV0dXJuICgqdGhlbXV0ZXgpLT50cnlsb2NrICgpOwogfQogCiBleHRl
cm4gIkMiIGludAogcHRocmVhZF9tdXRleF91bmxvY2sgKHB0aHJlYWRfbXV0
ZXhfdCAqbXV0ZXgpCiB7Ci0gIGlmIChwdGhyZWFkX211dGV4Ojppc0dvb2RJ
bml0aWFsaXplciAobXV0ZXgpKQorICBpZiAocHRocmVhZF9tdXRleDo6aXNf
Z29vZF9pbml0aWFsaXplciAobXV0ZXgpKQogICAgIHB0aHJlYWRfbXV0ZXg6
OmluaXQgKG11dGV4LCBOVUxMKTsKLSAgaWYgKCFwdGhyZWFkX211dGV4Ojpp
c0dvb2RPYmplY3QgKG11dGV4KSkKKyAgaWYgKCFwdGhyZWFkX211dGV4Ojpp
c19nb29kX29iamVjdCAobXV0ZXgpKQogICAgIHJldHVybiBFSU5WQUw7Ci0g
IHJldHVybiAoKm11dGV4KS0+VW5Mb2NrICgpOworICByZXR1cm4gKCptdXRl
eCktPnVubG9jayAoKTsKIH0KIAogZXh0ZXJuICJDIiBpbnQKQEAgLTI4Nzks
MTIgKzI4ODIsMTIgQEAgcHRocmVhZF9tdXRleF9kZXN0cm95IChwdGhyZWFk
X211dGV4X3QgKgogewogICBpbnQgcnY7CiAKLSAgaWYgKHB0aHJlYWRfbXV0
ZXg6OmlzR29vZEluaXRpYWxpemVyIChtdXRleCkpCisgIGlmIChwdGhyZWFk
X211dGV4Ojppc19nb29kX2luaXRpYWxpemVyIChtdXRleCkpCiAgICAgcmV0
dXJuIDA7Ci0gIGlmICghcHRocmVhZF9tdXRleDo6aXNHb29kT2JqZWN0ICht
dXRleCkpCisgIGlmICghcHRocmVhZF9tdXRleDo6aXNfZ29vZF9vYmplY3Qg
KG11dGV4KSkKICAgICByZXR1cm4gRUlOVkFMOwogCi0gIHJ2ID0gKCptdXRl
eCktPkRlc3Ryb3kgKCk7CisgIHJ2ID0gKCptdXRleCktPmRlc3Ryb3kgKCk7
CiAgIGlmIChydikKICAgICByZXR1cm4gcnY7CiAKQEAgLTI4OTcsOSArMjkw
MCw5IEBAIHB0aHJlYWRfbXV0ZXhfc2V0cHJpb2NlaWxpbmcgKHB0aHJlYWRf
bXUKIAkJCQlpbnQgKm9sZF9jZWlsaW5nKQogewogICBwdGhyZWFkX211dGV4
X3QgKnRoZW11dGV4ID0gbXV0ZXg7Ci0gIGlmIChwdGhyZWFkX211dGV4Ojpp
c0dvb2RJbml0aWFsaXplciAobXV0ZXgpKQorICBpZiAocHRocmVhZF9tdXRl
eDo6aXNfZ29vZF9pbml0aWFsaXplciAobXV0ZXgpKQogICAgIHB0aHJlYWRf
bXV0ZXg6OmluaXQgKG11dGV4LCBOVUxMKTsKLSAgaWYgKCFwdGhyZWFkX211
dGV4Ojppc0dvb2RPYmplY3QgKHRoZW11dGV4KSkKKyAgaWYgKCFwdGhyZWFk
X211dGV4Ojppc19nb29kX29iamVjdCAodGhlbXV0ZXgpKQogICAgIHJldHVy
biBFSU5WQUw7CiAgIHJldHVybiBFTk9TWVM7CiB9CkBAIC0yOTEwLDcgKzI5
MTMsNyBAQCBleHRlcm4gIkMiIGludAogcHRocmVhZF9tdXRleGF0dHJfZ2V0
cHJvdG9jb2wgKGNvbnN0IHB0aHJlYWRfbXV0ZXhhdHRyX3QgKmF0dHIsCiAJ
CQkJIGludCAqcHJvdG9jb2wpCiB7Ci0gIGlmICghcHRocmVhZF9tdXRleGF0
dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9tdXRl
eGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlO
VkFMOwogICByZXR1cm4gRU5PU1lTOwogfQpAQCAtMjkxOSw3ICsyOTIyLDcg
QEAgZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfbXV0ZXhhdHRyX2dldHBzaGFy
ZWQgKGNvbnN0IHB0aHJlYWRfbXV0ZXhhdHRyX3QgKmF0dHIsCiAJCQkJaW50
ICpwc2hhcmVkKQogewotICBpZiAoIXB0aHJlYWRfbXV0ZXhhdHRyOjppc0dv
b2RPYmplY3QgKGF0dHIpKQorICBpZiAoIXB0aHJlYWRfbXV0ZXhhdHRyOjpp
c19nb29kX29iamVjdCAoYXR0cikpCiAgICAgcmV0dXJuIEVJTlZBTDsKICAg
KnBzaGFyZWQgPSAoKmF0dHIpLT5wc2hhcmVkOwogICByZXR1cm4gMDsKQEAg
LTI5MjgsNyArMjkzMSw3IEBAIHB0aHJlYWRfbXV0ZXhhdHRyX2dldHBzaGFy
ZWQgKGNvbnN0IHB0aHIKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX211dGV4
YXR0cl9nZXR0eXBlIChjb25zdCBwdGhyZWFkX211dGV4YXR0cl90ICphdHRy
LCBpbnQgKnR5cGUpCiB7Ci0gIGlmICghcHRocmVhZF9tdXRleGF0dHI6Omlz
R29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9tdXRleGF0dHI6
OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4gRUlOVkFMOwog
ICAqdHlwZSA9ICgqYXR0ciktPm11dGV4dHlwZTsKICAgcmV0dXJuIDA7CkBA
IC0yOTM4LDExICsyOTQxLDExIEBAIHB0aHJlYWRfbXV0ZXhhdHRyX2dldHR5
cGUgKGNvbnN0IHB0aHJlYWQKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX211
dGV4YXR0cl9pbml0IChwdGhyZWFkX211dGV4YXR0cl90ICphdHRyKQogewot
ICBpZiAocHRocmVhZF9tdXRleGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikp
CisgIGlmIChwdGhyZWFkX211dGV4YXR0cjo6aXNfZ29vZF9vYmplY3QgKGF0
dHIpKQogICAgIHJldHVybiBFQlVTWTsKIAogICAqYXR0ciA9IG5ldyBwdGhy
ZWFkX211dGV4YXR0ciAoKTsKLSAgaWYgKCFwdGhyZWFkX211dGV4YXR0cjo6
aXNHb29kT2JqZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX211dGV4YXR0
cjo6aXNfZ29vZF9vYmplY3QgKGF0dHIpKQogICAgIHsKICAgICAgIGRlbGV0
ZSAoKmF0dHIpOwogICAgICAgKmF0dHIgPSBOVUxMOwpAQCAtMjk1NCw3ICsy
OTU3LDcgQEAgcHRocmVhZF9tdXRleGF0dHJfaW5pdCAocHRocmVhZF9tdXRl
eGF0dAogZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfbXV0ZXhhdHRyX2Rlc3Ry
b3kgKHB0aHJlYWRfbXV0ZXhhdHRyX3QgKmF0dHIpCiB7Ci0gIGlmICghcHRo
cmVhZF9tdXRleGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICgh
cHRocmVhZF9tdXRleGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAg
ICByZXR1cm4gRUlOVkFMOwogICBkZWxldGUgKCphdHRyKTsKICAgKmF0dHIg
PSBOVUxMOwpAQCAtMjk2Niw3ICsyOTY5LDcgQEAgcHRocmVhZF9tdXRleGF0
dHJfZGVzdHJveSAocHRocmVhZF9tdXRleAogZXh0ZXJuICJDIiBpbnQKIHB0
aHJlYWRfbXV0ZXhhdHRyX3NldHByb3RvY29sIChwdGhyZWFkX211dGV4YXR0
cl90ICphdHRyLCBpbnQgcHJvdG9jb2wpCiB7Ci0gIGlmICghcHRocmVhZF9t
dXRleGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVh
ZF9tdXRleGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1
cm4gRUlOVkFMOwogICByZXR1cm4gRU5PU1lTOwogfQpAQCAtMjk3Niw3ICsy
OTc5LDcgQEAgZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfbXV0ZXhhdHRyX3Nl
dHByaW9jZWlsaW5nIChwdGhyZWFkX211dGV4YXR0cl90ICphdHRyLAogCQkJ
CSAgICBpbnQgcHJpb2NlaWxpbmcpCiB7Ci0gIGlmICghcHRocmVhZF9tdXRl
eGF0dHI6OmlzR29vZE9iamVjdCAoYXR0cikpCisgIGlmICghcHRocmVhZF9t
dXRleGF0dHI6OmlzX2dvb2Rfb2JqZWN0IChhdHRyKSkKICAgICByZXR1cm4g
RUlOVkFMOwogICByZXR1cm4gRU5PU1lTOwogfQpAQCAtMjk4NSw3ICsyOTg4
LDcgQEAgZXh0ZXJuICJDIiBpbnQKIHB0aHJlYWRfbXV0ZXhhdHRyX2dldHBy
aW9jZWlsaW5nIChjb25zdCBwdGhyZWFkX211dGV4YXR0cl90ICphdHRyLAog
CQkJCSAgICBpbnQgKnByaW9jZWlsaW5nKQogewotICBpZiAoIXB0aHJlYWRf
bXV0ZXhhdHRyOjppc0dvb2RPYmplY3QgKGF0dHIpKQorICBpZiAoIXB0aHJl
YWRfbXV0ZXhhdHRyOjppc19nb29kX29iamVjdCAoYXR0cikpCiAgICAgcmV0
dXJuIEVJTlZBTDsKICAgcmV0dXJuIEVOT1NZUzsKIH0KQEAgLTI5OTMsNyAr
Mjk5Niw3IEBAIHB0aHJlYWRfbXV0ZXhhdHRyX2dldHByaW9jZWlsaW5nIChj
b25zdCAKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX211dGV4YXR0cl9zZXRw
c2hhcmVkIChwdGhyZWFkX211dGV4YXR0cl90ICphdHRyLCBpbnQgcHNoYXJl
ZCkKIHsKLSAgaWYgKCFwdGhyZWFkX211dGV4YXR0cjo6aXNHb29kT2JqZWN0
IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX211dGV4YXR0cjo6aXNfZ29vZF9v
YmplY3QgKGF0dHIpKQogICAgIHJldHVybiBFSU5WQUw7CiAgIC8qIHdlIGRv
bid0IHVzZSBwc2hhcmVkIGZvciBhbnl0aGluZyBhcyB5ZXQuIFdlIG5lZWQg
dG8gdGVzdCBQUk9DRVNTX1NIQVJFRAogICAgKmZ1bmN0aW9uYWxpdHkKQEAg
LTMwMDgsNyArMzAxMSw3IEBAIHB0aHJlYWRfbXV0ZXhhdHRyX3NldHBzaGFy
ZWQgKHB0aHJlYWRfbXUKIGV4dGVybiAiQyIgaW50CiBwdGhyZWFkX211dGV4
YXR0cl9zZXR0eXBlIChwdGhyZWFkX211dGV4YXR0cl90ICphdHRyLCBpbnQg
dHlwZSkKIHsKLSAgaWYgKCFwdGhyZWFkX211dGV4YXR0cjo6aXNHb29kT2Jq
ZWN0IChhdHRyKSkKKyAgaWYgKCFwdGhyZWFkX211dGV4YXR0cjo6aXNfZ29v
ZF9vYmplY3QgKGF0dHIpKQogICAgIHJldHVybiBFSU5WQUw7CiAKICAgc3dp
dGNoICh0eXBlKQpAQCAtMzAyOSw3ICszMDMyLDcgQEAgcHRocmVhZF9tdXRl
eGF0dHJfc2V0dHlwZSAocHRocmVhZF9tdXRleAogCiAvKiBzdGF0aWMgbWVt
YmVycyAqLwogYm9vbAotc2VtYXBob3JlOjppc0dvb2RPYmplY3QgKHNlbV90
IGNvbnN0ICogc2VtKQorc2VtYXBob3JlOjppc19nb29kX29iamVjdCAoc2Vt
X3QgY29uc3QgKiBzZW0pCiB7CiAgIGlmICh2ZXJpZnlhYmxlX29iamVjdF9p
c3ZhbGlkIChzZW0sIFNFTV9NQUdJQykgIT0gVkFMSURfT0JKRUNUKQogICAg
IHJldHVybiBmYWxzZTsKQEAgLTMwNDAsNyArMzA0Myw3IEBAIGludAogc2Vt
YXBob3JlOjppbml0IChzZW1fdCAqc2VtLCBpbnQgcHNoYXJlZCwgdW5zaWdu
ZWQgaW50IHZhbHVlKQogewogICAvKiBvcGVuZ3JvdXAgY2FsbHMgdGhpcyB1
bmRlZmluZWQgKi8KLSAgaWYgKGlzR29vZE9iamVjdCAoc2VtKSkKKyAgaWYg
KGlzX2dvb2Rfb2JqZWN0IChzZW0pKQogICAgIHJldHVybiBFQlVTWTsKIAog
ICBpZiAodmFsdWUgPiBTRU1fVkFMVUVfTUFYKQpAQCAtMzA0OCw3ICszMDUx
LDcgQEAgc2VtYXBob3JlOjppbml0IChzZW1fdCAqc2VtLCBpbnQgcHNoYXJl
ZAogCiAgICpzZW0gPSBuZXcgc2VtYXBob3JlIChwc2hhcmVkLCB2YWx1ZSk7
CiAKLSAgaWYgKCFpc0dvb2RPYmplY3QgKHNlbSkpCisgIGlmICghaXNfZ29v
ZF9vYmplY3QgKHNlbSkpCiAgICAgewogICAgICAgZGVsZXRlICgqc2VtKTsK
ICAgICAgICpzZW0gPSBOVUxMOwpAQCAtMzA2MCw3ICszMDYzLDcgQEAgc2Vt
YXBob3JlOjppbml0IChzZW1fdCAqc2VtLCBpbnQgcHNoYXJlZAogaW50CiBz
ZW1hcGhvcmU6OmRlc3Ryb3kgKHNlbV90ICpzZW0pCiB7Ci0gIGlmICghaXNH
b29kT2JqZWN0IChzZW0pKQorICBpZiAoIWlzX2dvb2Rfb2JqZWN0IChzZW0p
KQogICAgIHJldHVybiBFSU5WQUw7CiAKICAgLyogRklYTUUgLSBuZXcgZmVh
dHVyZSAtIHRlc3QgZm9yIGJ1c3kgYWdhaW5zdCB0aHJlYWRzLi4uICovCkBA
IC0zMDc1LDEwOCArMzA3OCwxMDggQEAgc2VtYXBob3JlOjp3YWl0IChzZW1f
dCAqc2VtKQogewogICBwdGhyZWFkX3Rlc3RjYW5jZWwgKCk7CiAKLSAgaWYg
KCFpc0dvb2RPYmplY3QgKHNlbSkpCisgIGlmICghaXNfZ29vZF9vYmplY3Qg
KHNlbSkpCiAgICAgewogICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwogICAg
ICAgcmV0dXJuIC0xOwogICAgIH0KIAotICAoKnNlbSktPldhaXQgKCk7Cisg
ICgqc2VtKS0+X3dhaXQgKCk7CiAgIHJldHVybiAwOwogfQogCiBpbnQKIHNl
bWFwaG9yZTo6dHJ5d2FpdCAoc2VtX3QgKnNlbSkKIHsKLSAgaWYgKCFpc0dv
b2RPYmplY3QgKHNlbSkpCisgIGlmICghaXNfZ29vZF9vYmplY3QgKHNlbSkp
CiAgICAgewogICAgICAgc2V0X2Vycm5vIChFSU5WQUwpOwogICAgICAgcmV0
dXJuIC0xOwogICAgIH0KIAotICByZXR1cm4gKCpzZW0pLT5UcnlXYWl0ICgp
OworICByZXR1cm4gKCpzZW0pLT5fdHJ5d2FpdCAoKTsKIH0KIAogaW50CiBz
ZW1hcGhvcmU6OnBvc3QgKHNlbV90ICpzZW0pCiB7Ci0gIGlmICghaXNHb29k
T2JqZWN0IChzZW0pKQorICBpZiAoIWlzX2dvb2Rfb2JqZWN0IChzZW0pKQog
ICAgIHJldHVybiBFSU5WQUw7CiAKLSAgKCpzZW0pLT5Qb3N0ICgpOworICAo
KnNlbSktPl9wb3N0ICgpOwogICByZXR1cm4gMDsKIH0KIAotLyogcHRocmVh
ZE51bGwgKi8KKy8qIHB0aHJlYWRfbnVsbCAqLwogcHRocmVhZCAqCi1wdGhy
ZWFkTnVsbDo6Z2V0TnVsbHB0aHJlYWQgKCkKK3B0aHJlYWRfbnVsbDo6Z2V0
X251bGxfcHRocmVhZCAoKQogewogICAvKiBiZWNhdXNlIG9mIHdlaXJkIGVu
dHJ5IHBvaW50cyAqLwogICBfaW5zdGFuY2UubWFnaWMgPSAwOwogICByZXR1
cm4gJl9pbnN0YW5jZTsKIH0KIAotcHRocmVhZE51bGw6OnB0aHJlYWROdWxs
ICgpCitwdGhyZWFkX251bGw6OnB0aHJlYWRfbnVsbCAoKQogewogICBhdHRy
LmpvaW5hYmxlID0gUFRIUkVBRF9DUkVBVEVfREVUQUNIRUQ7CiAgIC8qIE1h
cmsgb3Vyc2VsdmVzIGFzIGludmFsaWQgKi8KICAgbWFnaWMgPSAwOwogfQog
Ci1wdGhyZWFkTnVsbDo6fnB0aHJlYWROdWxsICgpCitwdGhyZWFkX251bGw6
On5wdGhyZWFkX251bGwgKCkKIHsKIH0KIAogdm9pZAotcHRocmVhZE51bGw6
OmNyZWF0ZSAodm9pZCAqKCopKHZvaWQgKiksIHB0aHJlYWRfYXR0ciAqLCB2
b2lkICopCitwdGhyZWFkX251bGw6OmNyZWF0ZSAodm9pZCAqKCopKHZvaWQg
KiksIHB0aHJlYWRfYXR0ciAqLCB2b2lkICopCiB7CiB9CiAKIHZvaWQKLXB0
aHJlYWROdWxsOjpleGl0ICh2b2lkICp2YWx1ZV9wdHIpCitwdGhyZWFkX251
bGw6OmV4aXQgKHZvaWQgKnZhbHVlX3B0cikKIHsKICAgRXhpdFRocmVhZCAo
MCk7CiB9CiAKIGludAotcHRocmVhZE51bGw6OmNhbmNlbCAoKQorcHRocmVh
ZF9udWxsOjpjYW5jZWwgKCkKIHsKICAgcmV0dXJuIDA7CiB9CiAKIHZvaWQK
LXB0aHJlYWROdWxsOjp0ZXN0Y2FuY2VsICgpCitwdGhyZWFkX251bGw6OnRl
c3RjYW5jZWwgKCkKIHsKIH0KIAogaW50Ci1wdGhyZWFkTnVsbDo6c2V0Y2Fu
Y2Vsc3RhdGUgKGludCBzdGF0ZSwgaW50ICpvbGRzdGF0ZSkKK3B0aHJlYWRf
bnVsbDo6c2V0Y2FuY2Vsc3RhdGUgKGludCBzdGF0ZSwgaW50ICpvbGRzdGF0
ZSkKIHsKICAgcmV0dXJuIEVJTlZBTDsKIH0KIAogaW50Ci1wdGhyZWFkTnVs
bDo6c2V0Y2FuY2VsdHlwZSAoaW50IHR5cGUsIGludCAqb2xkdHlwZSkKK3B0
aHJlYWRfbnVsbDo6c2V0Y2FuY2VsdHlwZSAoaW50IHR5cGUsIGludCAqb2xk
dHlwZSkKIHsKICAgcmV0dXJuIEVJTlZBTDsKIH0KIAogdm9pZAotcHRocmVh
ZE51bGw6OnB1c2hfY2xlYW51cF9oYW5kbGVyIChfX3B0aHJlYWRfY2xlYW51
cF9oYW5kbGVyICpoYW5kbGVyKQorcHRocmVhZF9udWxsOjpwdXNoX2NsZWFu
dXBfaGFuZGxlciAoX19wdGhyZWFkX2NsZWFudXBfaGFuZGxlciAqaGFuZGxl
cikKIHsKIH0KIAogdm9pZAotcHRocmVhZE51bGw6OnBvcF9jbGVhbnVwX2hh
bmRsZXIgKGludCBjb25zdCBleGVjdXRlKQorcHRocmVhZF9udWxsOjpwb3Bf
Y2xlYW51cF9oYW5kbGVyIChpbnQgY29uc3QgZXhlY3V0ZSkKIHsKIH0KIAog
dW5zaWduZWQgbG9uZwotcHRocmVhZE51bGw6OmdldHNlcXVlbmNlX25wICgp
CitwdGhyZWFkX251bGw6OmdldHNlcXVlbmNlX25wICgpCiB7CiAgIHJldHVy
biAwOwogfQogCi1wdGhyZWFkTnVsbCBwdGhyZWFkTnVsbDo6X2luc3RhbmNl
OworcHRocmVhZF9udWxsIHB0aHJlYWRfbnVsbDo6X2luc3RhbmNlOwogCiAj
ZW5kaWYgLy8gTVRfU0FGRQpkaWZmIC11cnAgc3JjLm9sZC93aW5zdXAvY3ln
d2luL3RocmVhZC5oIHNyYy93aW5zdXAvY3lnd2luL3RocmVhZC5oCi0tLSBz
cmMub2xkL3dpbnN1cC9jeWd3aW4vdGhyZWFkLmgJMjAwMy0wMy0yNyAxMDow
MDoyNS4wMDAwMDAwMDAgKzAxMDAKKysrIHNyYy93aW5zdXAvY3lnd2luL3Ro
cmVhZC5oCTIwMDMtMDMtMjcgMTA6MDE6NDQuMDAwMDAwMDAwICswMTAwCkBA
IC0xMjMsNyArMTIzLDcgQEAgdm9pZCBBc3NlcnRSZXNvdXJjZU93bmVyIChp
bnQsIGludCk7CiAjZW5kaWYKIH0KIAotY2xhc3MgbmF0aXZlTXV0ZXgKK2Ns
YXNzIG5hdGl2ZV9tdXRleAogewogcHVibGljOgogICBib29sIGluaXQgKCk7
CkBAIC0xODksNTkgKzE4OSw1OSBAQCB0eXBlZGVmIGVudW0KIHZlcmlmeWFi
bGVfb2JqZWN0X3N0YXRlIHZlcmlmeWFibGVfb2JqZWN0X2lzdmFsaWQgKHZv
aWQgY29uc3QgKiwgbG9uZyk7CiB2ZXJpZnlhYmxlX29iamVjdF9zdGF0ZSB2
ZXJpZnlhYmxlX29iamVjdF9pc3ZhbGlkICh2b2lkIGNvbnN0ICosIGxvbmcs
IHZvaWQgKik7CiAKLXRlbXBsYXRlIDxjbGFzcyBMaXN0Tm9kZT4gY2xhc3Mg
TGlzdCB7Cit0ZW1wbGF0ZSA8Y2xhc3MgbGlzdF9ub2RlPiBjbGFzcyBMaXN0
IHsKIHB1YmxpYzoKICAgTGlzdCgpIDogaGVhZChOVUxMKQogICB7CiAgIH0K
IAotICB2b2lkIEluc2VydCAoTGlzdE5vZGUgKmFOb2RlKQorICB2b2lkIGlu
c2VydCAobGlzdF9ub2RlICpub2RlKQogICB7Ci0gICAgaWYgKCFhTm9kZSkK
KyAgICBpZiAoIW5vZGUpCiAgICAgICByZXR1cm47Ci0gICAgYU5vZGUtPm5l
eHQgPSAoTGlzdE5vZGUgKikgSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIg
KCZoZWFkLCBhTm9kZSk7CisgICAgbm9kZS0+bmV4dCA9IChsaXN0X25vZGUg
KikgSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZoZWFkLCBub2RlKTsK
ICAgfQogCi0gIExpc3ROb2RlICpSZW1vdmUgKCBMaXN0Tm9kZSAqYU5vZGUp
CisgIGxpc3Rfbm9kZSAqcmVtb3ZlICggbGlzdF9ub2RlICpub2RlKQogICB7
Ci0gICAgaWYgKCFhTm9kZSB8fCAhaGVhZCkKKyAgICBpZiAoIW5vZGUgfHwg
IWhlYWQpCiAgICAgICByZXR1cm4gTlVMTDsKLSAgICBpZiAoYU5vZGUgPT0g
aGVhZCkKLSAgICAgIHJldHVybiBQb3AgKCk7CisgICAgaWYgKG5vZGUgPT0g
aGVhZCkKKyAgICAgIHJldHVybiBwb3AgKCk7CiAKLSAgICBMaXN0Tm9kZSAq
cmVzdWx0UHJldiA9IGhlYWQ7Ci0gICAgd2hpbGUgKHJlc3VsdFByZXYgJiYg
cmVzdWx0UHJldi0+bmV4dCAmJiAhKGFOb2RlID09IHJlc3VsdFByZXYtPm5l
eHQpKQotICAgICAgcmVzdWx0UHJldiA9IHJlc3VsdFByZXYtPm5leHQ7Ci0g
ICAgaWYgKHJlc3VsdFByZXYpCi0gICAgICByZXR1cm4gKExpc3ROb2RlICop
SW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZyZXN1bHRQcmV2LT5uZXh0
LCByZXN1bHRQcmV2LT5uZXh0LT5uZXh0KTsKKyAgICBsaXN0X25vZGUgKnJl
c3VsdF9wcmV2ID0gaGVhZDsKKyAgICB3aGlsZSAocmVzdWx0X3ByZXYgJiYg
cmVzdWx0X3ByZXYtPm5leHQgJiYgIShub2RlID09IHJlc3VsdF9wcmV2LT5u
ZXh0KSkKKyAgICAgIHJlc3VsdF9wcmV2ID0gcmVzdWx0X3ByZXYtPm5leHQ7
CisgICAgaWYgKHJlc3VsdF9wcmV2KQorICAgICAgcmV0dXJuIChsaXN0X25v
ZGUgKilJbnRlcmxvY2tlZEV4Y2hhbmdlUG9pbnRlciAoJnJlc3VsdF9wcmV2
LT5uZXh0LCByZXN1bHRfcHJldi0+bmV4dC0+bmV4dCk7CiAgICAgcmV0dXJu
IE5VTEw7CiAgIH0KIAotICBMaXN0Tm9kZSAqUG9wICgpCisgIGxpc3Rfbm9k
ZSAqcG9wICgpCiAgIHsKLSAgICByZXR1cm4gKExpc3ROb2RlICopIEludGVy
bG9ja2VkRXhjaGFuZ2VQb2ludGVyICgmaGVhZCwgaGVhZC0+bmV4dCk7Cisg
ICAgcmV0dXJuIChsaXN0X25vZGUgKikgSW50ZXJsb2NrZWRFeGNoYW5nZVBv
aW50ZXIgKCZoZWFkLCBoZWFkLT5uZXh0KTsKICAgfQogCiAgIC8qIHBvb3Ig
bWFucyBnZW5lcmljIHByb2dyYW1taW5nLiAqLwotICB2b2lkIGZvckVhY2gg
KHZvaWQgKExpc3ROb2RlOjoqY2FsbGJhY2spICgpKQorICB2b2lkIGZvcl9l
YWNoICh2b2lkIChsaXN0X25vZGU6OipjYWxsYmFjaykgKCkpCiAgIHsKLSAg
ICBMaXN0Tm9kZSAqYU5vZGUgPSBoZWFkOwotICAgIHdoaWxlIChhTm9kZSkK
KyAgICBsaXN0X25vZGUgKm5vZGUgPSBoZWFkOworICAgIHdoaWxlIChub2Rl
KQogICAgICAgewotICAgICAgICAoYU5vZGUtPipjYWxsYmFjaykgKCk7Ci0g
ICAgICAgIGFOb2RlID0gYU5vZGUtPm5leHQ7CisgICAgICAgIChub2RlLT4q
Y2FsbGJhY2spICgpOworICAgICAgICBub2RlID0gbm9kZS0+bmV4dDsKICAg
ICAgIH0KICAgfQogCiBwcm90ZWN0ZWQ6Ci0gIExpc3ROb2RlICpoZWFkOwor
ICBsaXN0X25vZGUgKmhlYWQ7CiB9OwogCiBjbGFzcyBwdGhyZWFkX2tleTpw
dWJsaWMgdmVyaWZ5YWJsZV9vYmplY3QKIHsKIHB1YmxpYzoKLSAgc3RhdGlj
IGJvb2wgaXNHb29kT2JqZWN0IChwdGhyZWFkX2tleV90IGNvbnN0ICopOwot
ICBEV09SRCBkd1Rsc0luZGV4OworICBzdGF0aWMgYm9vbCBpc19nb29kX29i
amVjdCAocHRocmVhZF9rZXlfdCBjb25zdCAqKTsKKyAgRFdPUkQgdGxzX2lu
ZGV4OwogCiAgIGludCBzZXQgKGNvbnN0IHZvaWQgKik7CiAgIHZvaWQgKmdl
dCAoKSBjb25zdDsKQEAgLTI1MCwzNCArMjUwLDM0IEBAIHB1YmxpYzoKICAg
fnB0aHJlYWRfa2V5ICgpOwogICBzdGF0aWMgdm9pZCBmaXh1cF9iZWZvcmVf
Zm9yaygpCiAgIHsKLSAgICBrZXlzLmZvckVhY2ggKCZwdGhyZWFkX2tleTo6
c2F2ZUtleVRvQnVmZmVyKTsKKyAgICBrZXlzLmZvcl9lYWNoICgmcHRocmVh
ZF9rZXk6OnNhdmVfa2V5X3RvX2J1ZmZlcik7CiAgIH0KIAogICBzdGF0aWMg
dm9pZCBmaXh1cF9hZnRlcl9mb3JrKCkKICAgewotICAgIGtleXMuZm9yRWFj
aCAoJnB0aHJlYWRfa2V5OjpyZWNyZWF0ZUtleUZyb21CdWZmZXIpOworICAg
IGtleXMuZm9yX2VhY2ggKCZwdGhyZWFkX2tleTo6cmVjcmVhdGVfa2V5X2Zy
b21fYnVmZmVyKTsKICAgfQogCi0gIHN0YXRpYyB2b2lkIHJ1bkFsbERlc3Ry
dWN0b3JzICgpCisgIHN0YXRpYyB2b2lkIHJ1bl9hbGxfZGVzdHJ1Y3RvcnMg
KCkKICAgewotICAgIGtleXMuZm9yRWFjaCAoJnB0aHJlYWRfa2V5OjpydW5E
ZXN0cnVjdG9yKTsKKyAgICBrZXlzLmZvcl9lYWNoICgmcHRocmVhZF9rZXk6
OnJ1bl9kZXN0cnVjdG9yKTsKICAgfQogCiAgIC8qIExpc3Qgc3VwcG9ydCBj
YWxscyAqLwogICBjbGFzcyBwdGhyZWFkX2tleSAqbmV4dDsKIHByaXZhdGU6
CiAgIHN0YXRpYyBMaXN0PHB0aHJlYWRfa2V5PiBrZXlzOwotICB2b2lkIHNh
dmVLZXlUb0J1ZmZlciAoKTsKLSAgdm9pZCByZWNyZWF0ZUtleUZyb21CdWZm
ZXIgKCk7CisgIHZvaWQgc2F2ZV9rZXlfdG9fYnVmZmVyICgpOworICB2b2lk
IHJlY3JlYXRlX2tleV9mcm9tX2J1ZmZlciAoKTsKICAgdm9pZCAoKmRlc3Ry
dWN0b3IpICh2b2lkICopOwotICB2b2lkIHJ1bkRlc3RydWN0b3IgKCk7Cisg
IHZvaWQgcnVuX2Rlc3RydWN0b3IgKCk7CiAgIHZvaWQgKmZvcmtfYnVmOwog
fTsKIAogY2xhc3MgcHRocmVhZF9hdHRyOnB1YmxpYyB2ZXJpZnlhYmxlX29i
amVjdAogewogcHVibGljOgotICBzdGF0aWMgYm9vbCBpc0dvb2RPYmplY3Qo
cHRocmVhZF9hdHRyX3QgY29uc3QgKik7CisgIHN0YXRpYyBib29sIGlzX2dv
b2Rfb2JqZWN0KHB0aHJlYWRfYXR0cl90IGNvbnN0ICopOwogICBpbnQgam9p
bmFibGU7CiAgIGludCBjb250ZW50aW9uc2NvcGU7CiAgIGludCBpbmhlcml0
c2NoZWQ7CkBAIC0yOTEsNyArMjkxLDcgQEAgcHVibGljOgogY2xhc3MgcHRo
cmVhZF9tdXRleGF0dHI6cHVibGljIHZlcmlmeWFibGVfb2JqZWN0CiB7CiBw
dWJsaWM6Ci0gIHN0YXRpYyBib29sIGlzR29vZE9iamVjdChwdGhyZWFkX211
dGV4YXR0cl90IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBpc19nb29kX29i
amVjdChwdGhyZWFkX211dGV4YXR0cl90IGNvbnN0ICopOwogICBpbnQgcHNo
YXJlZDsKICAgaW50IG11dGV4dHlwZTsKICAgcHRocmVhZF9tdXRleGF0dHIg
KCk7CkBAIC0zMDEsMTIgKzMwMSwxMiBAQCBwdWJsaWM6CiBjbGFzcyBwdGhy
ZWFkX211dGV4OnB1YmxpYyB2ZXJpZnlhYmxlX29iamVjdAogewogcHVibGlj
OgotICBzdGF0aWMgYm9vbCBpc0dvb2RPYmplY3QgKHB0aHJlYWRfbXV0ZXhf
dCBjb25zdCAqKTsKLSAgc3RhdGljIGJvb2wgaXNHb29kSW5pdGlhbGl6ZXIg
KHB0aHJlYWRfbXV0ZXhfdCBjb25zdCAqKTsKLSAgc3RhdGljIGJvb2wgaXNH
b29kSW5pdGlhbGl6ZXJPck9iamVjdCAocHRocmVhZF9tdXRleF90IGNvbnN0
ICopOwotICBzdGF0aWMgYm9vbCBpc0dvb2RJbml0aWFsaXplck9yQmFkT2Jq
ZWN0IChwdGhyZWFkX211dGV4X3QgY29uc3QgKm11dGV4KTsKLSAgc3RhdGlj
IGJvb2wgY2FuQmVVbmxvY2tlZCAocHRocmVhZF9tdXRleF90IGNvbnN0ICpt
dXRleCk7Ci0gIHN0YXRpYyB2b2lkIGluaXRNdXRleCAoKTsKKyAgc3RhdGlj
IGJvb2wgaXNfZ29vZF9vYmplY3QgKHB0aHJlYWRfbXV0ZXhfdCBjb25zdCAq
KTsKKyAgc3RhdGljIGJvb2wgaXNfZ29vZF9pbml0aWFsaXplciAocHRocmVh
ZF9tdXRleF90IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBpc19nb29kX2lu
aXRpYWxpemVyX29yX29iamVjdCAocHRocmVhZF9tdXRleF90IGNvbnN0ICop
OworICBzdGF0aWMgYm9vbCBpc19nb29kX2luaXRpYWxpemVyX29yX2JhZF9v
YmplY3QgKHB0aHJlYWRfbXV0ZXhfdCBjb25zdCAqbXV0ZXgpOworICBzdGF0
aWMgYm9vbCBjYW5fYmVfdW5sb2NrZWQgKHB0aHJlYWRfbXV0ZXhfdCBjb25z
dCAqbXV0ZXgpOworICBzdGF0aWMgdm9pZCBpbml0X211dGV4ICgpOwogICBz
dGF0aWMgaW50IGluaXQgKHB0aHJlYWRfbXV0ZXhfdCAqLCBjb25zdCBwdGhy
ZWFkX211dGV4YXR0cl90ICopOwogCiAgIHVuc2lnbmVkIGxvbmcgbG9ja19j
b3VudGVyOwpAQCAtMzE3LDM2ICszMTcsMzYgQEAgcHVibGljOgogICBpbnQg
dHlwZTsKICAgaW50IHBzaGFyZWQ7CiAKLSAgcHRocmVhZF90IEdldFB0aHJl
YWRTZWxmICgpIGNvbnN0CisgIHB0aHJlYWRfdCBnZXRfcHRocmVhZF9zZWxm
ICgpIGNvbnN0CiAgIHsKICAgICByZXR1cm4gUFRIUkVBRF9NVVRFWF9OT1JN
QUwgPT0gdHlwZSA/IE1VVEVYX09XTkVSX0FOT05ZTU9VUyA6CiAgICAgICA6
OnB0aHJlYWRfc2VsZiAoKTsKICAgfQogCi0gIGludCBMb2NrICgpCisgIGlu
dCBsb2NrICgpCiAgIHsKLSAgICByZXR1cm4gX0xvY2sgKEdldFB0aHJlYWRT
ZWxmICgpKTsKKyAgICByZXR1cm4gX2xvY2sgKGdldF9wdGhyZWFkX3NlbGYg
KCkpOwogICB9Ci0gIGludCBUcnlMb2NrICgpCisgIGludCB0cnlsb2NrICgp
CiAgIHsKLSAgICByZXR1cm4gX1RyeUxvY2sgKEdldFB0aHJlYWRTZWxmICgp
KTsKKyAgICByZXR1cm4gX3RyeWxvY2sgKGdldF9wdGhyZWFkX3NlbGYgKCkp
OwogICB9Ci0gIGludCBVbkxvY2sgKCkKKyAgaW50IHVubG9jayAoKQogICB7
Ci0gICAgcmV0dXJuIF9VbkxvY2sgKEdldFB0aHJlYWRTZWxmICgpKTsKKyAg
ICByZXR1cm4gX3VubG9jayAoZ2V0X3B0aHJlYWRfc2VsZiAoKSk7CiAgIH0K
LSAgaW50IERlc3Ryb3kgKCkKKyAgaW50IGRlc3Ryb3kgKCkKICAgewotICAg
IHJldHVybiBfRGVzdHJveSAoR2V0UHRocmVhZFNlbGYgKCkpOworICAgIHJl
dHVybiBfZGVzdHJveSAoZ2V0X3B0aHJlYWRfc2VsZiAoKSk7CiAgIH0KIAot
ICB2b2lkIFNldE93bmVyIChwdGhyZWFkX3Qgc2VsZikKKyAgdm9pZCBzZXRf
b3duZXIgKHB0aHJlYWRfdCBzZWxmKQogICB7CiAgICAgcmVjdXJzaW9uX2Nv
dW50ZXIgPSAxOwogICAgIG93bmVyID0gc2VsZjsKICAgfQogCi0gIGludCBM
b2NrUmVjdXJzaXZlICgpCisgIGludCBsb2NrX3JlY3Vyc2l2ZSAoKQogICB7
CiAgICAgaWYgKFVJTlRfTUFYID09IHJlY3Vyc2lvbl9jb3VudGVyKQogICAg
ICAgcmV0dXJuIEVBR0FJTjsKQEAgLTM2MSwxOSArMzYxLDE5IEBAIHB1Ymxp
YzoKICAgY2xhc3MgcHRocmVhZF9tdXRleCAqIG5leHQ7CiAgIHN0YXRpYyB2
b2lkIGZpeHVwX2FmdGVyX2ZvcmsgKCkKICAgewotICAgIG11dGV4ZXMuZm9y
RWFjaCAoJnB0aHJlYWRfbXV0ZXg6OkZpeHVwQWZ0ZXJGb3JrKTsKKyAgICBt
dXRleGVzLmZvcl9lYWNoICgmcHRocmVhZF9tdXRleDo6X2ZpeHVwX2FmdGVy
X2ZvcmspOwogICB9CiAKLSAgdm9pZCBGaXh1cEFmdGVyRm9yayAoKTsKLQog
cHJpdmF0ZToKLSAgaW50IF9Mb2NrIChwdGhyZWFkX3Qgc2VsZik7Ci0gIGlu
dCBfVHJ5TG9jayAocHRocmVhZF90IHNlbGYpOwotICBpbnQgX1VuTG9jayAo
cHRocmVhZF90IHNlbGYpOwotICBpbnQgX0Rlc3Ryb3kgKHB0aHJlYWRfdCBz
ZWxmKTsKKyAgaW50IF9sb2NrIChwdGhyZWFkX3Qgc2VsZik7CisgIGludCBf
dHJ5bG9jayAocHRocmVhZF90IHNlbGYpOworICBpbnQgX3VubG9jayAocHRo
cmVhZF90IHNlbGYpOworICBpbnQgX2Rlc3Ryb3kgKHB0aHJlYWRfdCBzZWxm
KTsKKworICB2b2lkIF9maXh1cF9hZnRlcl9mb3JrICgpOwogCiAgIHN0YXRp
YyBMaXN0PHB0aHJlYWRfbXV0ZXg+IG11dGV4ZXM7Ci0gIHN0YXRpYyBuYXRp
dmVNdXRleCBtdXRleEluaXRpYWxpemF0aW9uTG9jazsKKyAgc3RhdGljIG5h
dGl2ZV9tdXRleCBtdXRleF9pbml0aWFsaXphdGlvbl9sb2NrOwogfTsKIAog
I2RlZmluZSBXQUlUX0NBTkNFTEVEICAgKFdBSVRfT0JKRUNUXzAgKyAxKQpA
QCAtNDAxLDggKzQwMSw4IEBAIHB1YmxpYzoKICAgcHRocmVhZCAoKTsKICAg
dmlydHVhbCB+cHRocmVhZCAoKTsKIAotICBzdGF0aWMgdm9pZCBpbml0TWFp
blRocmVhZCAoYm9vbCk7Ci0gIHN0YXRpYyBib29sIGlzR29vZE9iamVjdChw
dGhyZWFkX3QgY29uc3QgKik7CisgIHN0YXRpYyB2b2lkIGluaXRfbWFpbnRo
cmVhZCAoYm9vbCk7CisgIHN0YXRpYyBib29sIGlzX2dvb2Rfb2JqZWN0KHB0
aHJlYWRfdCBjb25zdCAqKTsKICAgc3RhdGljIHZvaWQgYXRmb3JrcHJlcGFy
ZSgpOwogICBzdGF0aWMgdm9pZCBhdGZvcmtwYXJlbnQoKTsKICAgc3RhdGlj
IHZvaWQgYXRmb3JrY2hpbGQoKTsKQEAgLTQ0NiwxOSArNDQ2LDE5IEBAIHBy
aXZhdGU6CiAgIHZvaWQgcG9wX2FsbF9jbGVhbnVwX2hhbmRsZXJzICh2b2lk
KTsKICAgdm9pZCBwcmVjcmVhdGUgKHB0aHJlYWRfYXR0ciAqKTsKICAgdm9p
ZCBwb3N0Y3JlYXRlICgpOwotICB2b2lkIHNldFRocmVhZElkdG9DdXJyZW50
ICgpOwotICBzdGF0aWMgdm9pZCBzZXRUbHNTZWxmUG9pbnRlciAocHRocmVh
ZCAqKTsKLSAgc3RhdGljIHB0aHJlYWQgKmdldFRsc1NlbGZQb2ludGVyICgp
OworICB2b2lkIHNldF90aHJlYWRfaWRfdG9fY3VycmVudCAoKTsKKyAgc3Rh
dGljIHZvaWQgc2V0X3Rsc19zZWxmX3BvaW50ZXIgKHB0aHJlYWQgKik7Cisg
IHN0YXRpYyBwdGhyZWFkICpnZXRfdGxzX3NlbGZfcG9pbnRlciAoKTsKICAg
dm9pZCBjYW5jZWxfc2VsZiAoKTsKLSAgRFdPUkQgZ2V0VGhyZWFkSWQgKCk7
Ci0gIHZvaWQgaW5pdEN1cnJlbnRUaHJlYWQgKCk7CisgIERXT1JEIGdldF90
aHJlYWRfaWQgKCk7CisgIHZvaWQgaW5pdF9jdXJyZW50X3RocmVhZCAoKTsK
IH07CiAKLWNsYXNzIHB0aHJlYWROdWxsIDogcHVibGljIHB0aHJlYWQKK2Ns
YXNzIHB0aHJlYWRfbnVsbCA6IHB1YmxpYyBwdGhyZWFkCiB7CiAgIHB1Ymxp
YzoKLSAgc3RhdGljIHB0aHJlYWQgKmdldE51bGxwdGhyZWFkKCk7Ci0gIH5w
dGhyZWFkTnVsbCgpOworICBzdGF0aWMgcHRocmVhZCAqZ2V0X251bGxfcHRo
cmVhZCgpOworICB+cHRocmVhZF9udWxsKCk7CiAKICAgLyogRnJvbSBwdGhy
ZWFkIFRoZXNlIHNob3VsZCBuZXZlciBnZXQgY2FsbGVkCiAgICogYXMgdGhl
IG9qYmVjdCBpcyBub3QgdmVyaWZ5YWJsZQpAQCAtNDc0LDE0ICs0NzQsMTQg
QEAgY2xhc3MgcHRocmVhZE51bGwgOiBwdWJsaWMgcHRocmVhZAogICB1bnNp
Z25lZCBsb25nIGdldHNlcXVlbmNlX25wKCk7CiAKICAgcHJpdmF0ZToKLSAg
cHRocmVhZE51bGwgKCk7Ci0gIHN0YXRpYyBwdGhyZWFkTnVsbCBfaW5zdGFu
Y2U7CisgIHB0aHJlYWRfbnVsbCAoKTsKKyAgc3RhdGljIHB0aHJlYWRfbnVs
bCBfaW5zdGFuY2U7CiB9OwogCiBjbGFzcyBwdGhyZWFkX2NvbmRhdHRyOnB1
YmxpYyB2ZXJpZnlhYmxlX29iamVjdAogewogcHVibGljOgotICBzdGF0aWMg
Ym9vbCBpc0dvb2RPYmplY3QocHRocmVhZF9jb25kYXR0cl90IGNvbnN0ICop
OworICBzdGF0aWMgYm9vbCBpc19nb29kX29iamVjdChwdGhyZWFkX2NvbmRh
dHRyX3QgY29uc3QgKik7CiAgIGludCBzaGFyZWQ7CiAKICAgcHRocmVhZF9j
b25kYXR0ciAoKTsKQEAgLTQ5MSwyNiArNDkxLDI2IEBAIHB1YmxpYzoKIGNs
YXNzIHB0aHJlYWRfY29uZDpwdWJsaWMgdmVyaWZ5YWJsZV9vYmplY3QKIHsK
IHB1YmxpYzoKLSAgc3RhdGljIGJvb2wgaXNHb29kT2JqZWN0IChwdGhyZWFk
X2NvbmRfdCBjb25zdCAqKTsKLSAgc3RhdGljIGJvb2wgaXNHb29kSW5pdGlh
bGl6ZXIgKHB0aHJlYWRfY29uZF90IGNvbnN0ICopOwotICBzdGF0aWMgYm9v
bCBpc0dvb2RJbml0aWFsaXplck9yT2JqZWN0IChwdGhyZWFkX2NvbmRfdCBj
b25zdCAqKTsKLSAgc3RhdGljIGJvb2wgaXNHb29kSW5pdGlhbGl6ZXJPckJh
ZE9iamVjdCAocHRocmVhZF9jb25kX3QgY29uc3QgKik7Ci0gIHN0YXRpYyB2
b2lkIGluaXRNdXRleCAoKTsKKyAgc3RhdGljIGJvb2wgaXNfZ29vZF9vYmpl
Y3QgKHB0aHJlYWRfY29uZF90IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBp
c19nb29kX2luaXRpYWxpemVyIChwdGhyZWFkX2NvbmRfdCBjb25zdCAqKTsK
KyAgc3RhdGljIGJvb2wgaXNfZ29vZF9pbml0aWFsaXplcl9vcl9vYmplY3Qg
KHB0aHJlYWRfY29uZF90IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBpc19n
b29kX2luaXRpYWxpemVyX29yX2JhZF9vYmplY3QgKHB0aHJlYWRfY29uZF90
IGNvbnN0ICopOworICBzdGF0aWMgdm9pZCBpbml0X211dGV4ICgpOwogICBz
dGF0aWMgaW50IGluaXQgKHB0aHJlYWRfY29uZF90ICosIGNvbnN0IHB0aHJl
YWRfY29uZGF0dHJfdCAqKTsKIAogICBpbnQgc2hhcmVkOwogCiAgIHVuc2ln
bmVkIGxvbmcgd2FpdGluZzsKICAgdW5zaWduZWQgbG9uZyBwZW5kaW5nOwot
ICBIQU5ETEUgc2VtV2FpdDsKKyAgSEFORExFIHNlbV93YWl0OwogCi0gIHB0
aHJlYWRfbXV0ZXggbXR4SW47Ci0gIHB0aHJlYWRfbXV0ZXggbXR4T3V0Owor
ICBwdGhyZWFkX211dGV4IG10eF9pbjsKKyAgcHRocmVhZF9tdXRleCBtdHhf
b3V0OwogCi0gIHB0aHJlYWRfbXV0ZXhfdCBtdHhDb25kOworICBwdGhyZWFk
X211dGV4X3QgbXR4X2NvbmQ7CiAKLSAgdm9pZCBVbkJsb2NrIChjb25zdCBi
b29sIGFsbCk7Ci0gIGludCBXYWl0IChwdGhyZWFkX211dGV4X3QgbXV0ZXgs
IERXT1JEIGR3TWlsbGlzZWNvbmRzID0gSU5GSU5JVEUpOworICB2b2lkIHVu
YmxvY2sgKGNvbnN0IGJvb2wgYWxsKTsKKyAgaW50IHdhaXQgKHB0aHJlYWRf
bXV0ZXhfdCBtdXRleCwgRFdPUkQgZHdNaWxsaXNlY29uZHMgPSBJTkZJTklU
RSk7CiAKICAgcHRocmVhZF9jb25kIChwdGhyZWFkX2NvbmRhdHRyICopOwog
ICB+cHRocmVhZF9jb25kICgpOwpAQCAtNTE4LDIwICs1MTgsMjAgQEAgcHVi
bGljOgogICBjbGFzcyBwdGhyZWFkX2NvbmQgKiBuZXh0OwogICBzdGF0aWMg
dm9pZCBmaXh1cF9hZnRlcl9mb3JrICgpCiAgIHsKLSAgICBjb25kcy5mb3JF
YWNoICgmcHRocmVhZF9jb25kOjpGaXh1cEFmdGVyRm9yayk7CisgICAgY29u
ZHMuZm9yX2VhY2ggKCZwdGhyZWFkX2NvbmQ6Ol9maXh1cF9hZnRlcl9mb3Jr
KTsKICAgfQogCi0gIHZvaWQgRml4dXBBZnRlckZvcmsgKCk7Ci0KIHByaXZh
dGU6CisgIHZvaWQgX2ZpeHVwX2FmdGVyX2ZvcmsgKCk7CisKICAgc3RhdGlj
IExpc3Q8cHRocmVhZF9jb25kPiBjb25kczsKLSAgc3RhdGljIG5hdGl2ZU11
dGV4IGNvbmRJbml0aWFsaXphdGlvbkxvY2s7CisgIHN0YXRpYyBuYXRpdmVf
bXV0ZXggY29uZF9pbml0aWFsaXphdGlvbl9sb2NrOwogfTsKIAogY2xhc3Mg
cHRocmVhZF9yd2xvY2thdHRyOnB1YmxpYyB2ZXJpZnlhYmxlX29iamVjdAog
ewogcHVibGljOgotICBzdGF0aWMgYm9vbCBpc0dvb2RPYmplY3QocHRocmVh
ZF9yd2xvY2thdHRyX3QgY29uc3QgKik7CisgIHN0YXRpYyBib29sIGlzX2dv
b2Rfb2JqZWN0KHB0aHJlYWRfcndsb2NrYXR0cl90IGNvbnN0ICopOwogICBp
bnQgc2hhcmVkOwogCiAgIHB0aHJlYWRfcndsb2NrYXR0ciAoKTsKQEAgLTU0
MSwxNyArNTQxLDE3IEBAIHB1YmxpYzoKIGNsYXNzIHB0aHJlYWRfcndsb2Nr
OnB1YmxpYyB2ZXJpZnlhYmxlX29iamVjdAogewogcHVibGljOgotICBzdGF0
aWMgYm9vbCBpc0dvb2RPYmplY3QgKHB0aHJlYWRfcndsb2NrX3QgY29uc3Qg
Kik7Ci0gIHN0YXRpYyBib29sIGlzR29vZEluaXRpYWxpemVyIChwdGhyZWFk
X3J3bG9ja190IGNvbnN0ICopOwotICBzdGF0aWMgYm9vbCBpc0dvb2RJbml0
aWFsaXplck9yT2JqZWN0IChwdGhyZWFkX3J3bG9ja190IGNvbnN0ICopOwot
ICBzdGF0aWMgYm9vbCBpc0dvb2RJbml0aWFsaXplck9yQmFkT2JqZWN0IChw
dGhyZWFkX3J3bG9ja190IGNvbnN0ICopOwotICBzdGF0aWMgdm9pZCBpbml0
TXV0ZXggKCk7CisgIHN0YXRpYyBib29sIGlzX2dvb2Rfb2JqZWN0IChwdGhy
ZWFkX3J3bG9ja190IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBpc19nb29k
X2luaXRpYWxpemVyIChwdGhyZWFkX3J3bG9ja190IGNvbnN0ICopOworICBz
dGF0aWMgYm9vbCBpc19nb29kX2luaXRpYWxpemVyX29yX29iamVjdCAocHRo
cmVhZF9yd2xvY2tfdCBjb25zdCAqKTsKKyAgc3RhdGljIGJvb2wgaXNfZ29v
ZF9pbml0aWFsaXplcl9vcl9iYWRfb2JqZWN0IChwdGhyZWFkX3J3bG9ja190
IGNvbnN0ICopOworICBzdGF0aWMgdm9pZCBpbml0X211dGV4ICgpOwogICBz
dGF0aWMgaW50IGluaXQgKHB0aHJlYWRfcndsb2NrX3QgKiwgY29uc3QgcHRo
cmVhZF9yd2xvY2thdHRyX3QgKik7CiAKICAgaW50IHNoYXJlZDsKIAotICB1
bnNpZ25lZCBsb25nIHdhaXRpbmdSZWFkZXJzOwotICB1bnNpZ25lZCBsb25n
IHdhaXRpbmdXcml0ZXJzOworICB1bnNpZ25lZCBsb25nIHdhaXRpbmdfcmVh
ZGVyczsKKyAgdW5zaWduZWQgbG9uZyB3YWl0aW5nX3dyaXRlcnM7CiAgIHB0
aHJlYWRfdCB3cml0ZXI7CiAgIHN0cnVjdCBSV0xPQ0tfUkVBREVSCiAgIHsK
QEAgLTU1OSwxNyArNTU5LDE3IEBAIHB1YmxpYzoKICAgICBwdGhyZWFkX3Qg
dGhyZWFkOwogICB9ICpyZWFkZXJzOwogCi0gIGludCBSZExvY2sgKCk7Ci0g
IGludCBUcnlSZExvY2sgKCk7CisgIGludCByZGxvY2sgKCk7CisgIGludCB0
cnlyZGxvY2sgKCk7CiAKLSAgaW50IFdyTG9jayAoKTsKLSAgaW50IFRyeVdy
TG9jayAoKTsKKyAgaW50IHdybG9jayAoKTsKKyAgaW50IHRyeXdybG9jayAo
KTsKIAotICBpbnQgVW5Mb2NrICgpOworICBpbnQgdW5sb2NrICgpOwogCiAg
IHB0aHJlYWRfbXV0ZXggbXR4OwotICBwdGhyZWFkX2NvbmQgY29uZFJlYWRl
cnM7Ci0gIHB0aHJlYWRfY29uZCBjb25kV3JpdGVyczsKKyAgcHRocmVhZF9j
b25kIGNvbmRfcmVhZGVyczsKKyAgcHRocmVhZF9jb25kIGNvbmRfd3JpdGVy
czsKIAogICBwdGhyZWFkX3J3bG9jayAocHRocmVhZF9yd2xvY2thdHRyICop
OwogICB+cHRocmVhZF9yd2xvY2sgKCk7CkBAIC01NzcsMjIgKzU3NywyMiBA
QCBwdWJsaWM6CiAgIGNsYXNzIHB0aHJlYWRfcndsb2NrICogbmV4dDsKICAg
c3RhdGljIHZvaWQgZml4dXBfYWZ0ZXJfZm9yayAoKQogICB7Ci0gICAgcnds
b2Nrcy5mb3JFYWNoICgmcHRocmVhZF9yd2xvY2s6OkZpeHVwQWZ0ZXJGb3Jr
KTsKKyAgICByd2xvY2tzLmZvcl9lYWNoICgmcHRocmVhZF9yd2xvY2s6Ol9m
aXh1cF9hZnRlcl9mb3JrKTsKICAgfQogCi0gIHZvaWQgRml4dXBBZnRlckZv
cmsgKCk7Ci0KIHByaXZhdGU6CiAgIHN0YXRpYyBMaXN0PHB0aHJlYWRfcnds
b2NrPiByd2xvY2tzOwogCi0gIHZvaWQgYWRkUmVhZGVyIChzdHJ1Y3QgUldM
T0NLX1JFQURFUiAqcmQpOwotICB2b2lkIHJlbW92ZVJlYWRlciAoc3RydWN0
IFJXTE9DS19SRUFERVIgKnJkKTsKLSAgc3RydWN0IFJXTE9DS19SRUFERVIg
Kmxvb2t1cFJlYWRlciAocHRocmVhZF90IHRocmVhZCk7CisgIHZvaWQgYWRk
X3JlYWRlciAoc3RydWN0IFJXTE9DS19SRUFERVIgKnJkKTsKKyAgdm9pZCBy
ZW1vdmVfcmVhZGVyIChzdHJ1Y3QgUldMT0NLX1JFQURFUiAqcmQpOworICBz
dHJ1Y3QgUldMT0NLX1JFQURFUiAqbG9va3VwX3JlYWRlciAocHRocmVhZF90
IHRocmVhZCk7CiAKLSAgc3RhdGljIHZvaWQgUmRMb2NrQ2xlYW51cCAodm9p
ZCAqYXJnKTsKLSAgc3RhdGljIHZvaWQgV3JMb2NrQ2xlYW51cCAodm9pZCAq
YXJnKTsKKyAgc3RhdGljIHZvaWQgcmRsb2NrX2NsZWFudXAgKHZvaWQgKmFy
Zyk7CisgIHN0YXRpYyB2b2lkIHdybG9ja19jbGVhbnVwICh2b2lkICphcmcp
OwogCi0gIHN0YXRpYyBuYXRpdmVNdXRleCByd2xvY2tJbml0aWFsaXphdGlv
bkxvY2s7CisgIHZvaWQgX2ZpeHVwX2FmdGVyX2ZvcmsgKCk7CisKKyAgc3Rh
dGljIG5hdGl2ZV9tdXRleCByd2xvY2tfaW5pdGlhbGl6YXRpb25fbG9jazsK
IH07CiAKIGNsYXNzIHB0aHJlYWRfb25jZQpAQCAtNjA2LDcgKzYwNiw3IEBA
IHB1YmxpYzoKIGNsYXNzIHNlbWFwaG9yZTpwdWJsaWMgdmVyaWZ5YWJsZV9v
YmplY3QKIHsKIHB1YmxpYzoKLSAgc3RhdGljIGJvb2wgaXNHb29kT2JqZWN0
KHNlbV90IGNvbnN0ICopOworICBzdGF0aWMgYm9vbCBpc19nb29kX29iamVj
dChzZW1fdCBjb25zdCAqKTsKICAgLyogQVBJIGNhbGxzICovCiAgIHN0YXRp
YyBpbnQgaW5pdCAoc2VtX3QgKiBzZW0sIGludCBwc2hhcmVkLCB1bnNpZ25l
ZCBpbnQgdmFsdWUpOwogICBzdGF0aWMgaW50IGRlc3Ryb3kgKHNlbV90ICog
c2VtKTsKQEAgLTYxNyw5ICs2MTcsNiBAQCBwdWJsaWM6CiAgIEhBTkRMRSB3
aW4zMl9vYmpfaWQ7CiAgIGludCBzaGFyZWQ7CiAgIGxvbmcgY3VycmVudHZh
bHVlOwotICB2b2lkIFdhaXQgKCk7Ci0gIHZvaWQgUG9zdCAoKTsKLSAgaW50
IFRyeVdhaXQgKCk7CiAKICAgc2VtYXBob3JlIChpbnQsIHVuc2lnbmVkIGlu
dCk7CiAgIH5zZW1hcGhvcmUgKCk7CkBAIC02MjcsMTIgKzYyNCwxNiBAQCBw
dWJsaWM6CiAgIGNsYXNzIHNlbWFwaG9yZSAqIG5leHQ7CiAgIHN0YXRpYyB2
b2lkIGZpeHVwX2FmdGVyX2ZvcmsgKCkKICAgewotICAgIHNlbWFwaG9yZXMu
Zm9yRWFjaCAoJnNlbWFwaG9yZTo6Rml4dXBBZnRlckZvcmspOworICAgIHNl
bWFwaG9yZXMuZm9yX2VhY2ggKCZzZW1hcGhvcmU6Ol9maXh1cF9hZnRlcl9m
b3JrKTsKICAgfQogCi0gIHZvaWQgRml4dXBBZnRlckZvcmsgKCk7Ci0KIHBy
aXZhdGU6CisgIHZvaWQgX3dhaXQgKCk7CisgIHZvaWQgX3Bvc3QgKCk7Cisg
IGludCBfdHJ5d2FpdCAoKTsKKworICB2b2lkIF9maXh1cF9hZnRlcl9mb3Jr
ICgpOworCiAgIHN0YXRpYyBMaXN0PHNlbWFwaG9yZT4gc2VtYXBob3JlczsK
IH07CiAK

--168231-7068-1048763429=:486--
