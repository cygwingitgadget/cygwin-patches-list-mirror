From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-developers@cygwin.com>, <cygwin-patches@cygwin.com>
Subject: Re: hierarchy in setup (category stuff)
Date: Fri, 29 Jun 2001 17:49:00 -0000
Message-id: <032001c100fe$d62310c0$806410ac@local>
References: <04e801c0faa2$f9008260$0200a8c0@lifelesswks> <20010621222615.C13746@redhat.com> <3B3324A7.49FFC98A@yahoo.com> <054c01c0fbef$5f600e20$0200a8c0@lifelesswks> <06a001c0fc51$7a87e210$0200a8c0@lifelesswks> <20010629114004.A6990@redhat.com> <VA.00000842.01fd0b44@thesoftwaresource.com> <20010629172912.A8991@redhat.com>
X-SW-Source: 2001-q2/msg00369.html
Content-type: multipart/mixed; boundary="----------=_1583532848-65438-83"

This is a multi-part message in MIME format...

------------=_1583532848-65438-83
Content-length: 1797

This is what I've got right now.

>Known bugs:
>1) The partial view when you enter the package list has a scroll bar one
>line too many long.

Not addressed. May not be present with the default view now categories.

>2) The category view always shows _all_ packages. There's no
>category-partial view. Do we need one?

not addressed.

3) I haven't added the lex rule for multi category parsing yet (but the
suporting c code is there.

I've changed the default view to categories. (It's the view constructor
call).

> >> I just played with this and I like what I see.
> >>
> >> I had a hard time getting all of the changes into the current CVS,
though,
> >> and the view was sort of screwed up.

clean patch attached.

> Either way, there would still be problems.  I think that they are mainly
because
> of Michael's white space fixes.
>
> I sometimes wish that we had a C/C++ aware version of patch.

My .2c: update your CVS server. I have much much less problems with merges
with the sourceforge CVS server.

> >> Robert, if you are still interested, then I think that this is
definitely the
> >> way to go.  If you have something worth checking in, then please do so.

I'll draw up change log stuff and send something to cygwin-patches... or did
you want me to hit CVS directly?

> I've included a new patch below.  I took another stab at this and found
that I'd
> wiped out a huge chunk of a function.  setup.exe seems to work much better
now.
>
> I've also included a setup.ini with categories.  I haven't added
dependencies yet.
>
> I'm thinking that we should just nuke the "latest" and "contrib"
directories and
> create directories based on the name of the categories.

I don't think we even need separate directories - they don't do much once
the package system manages the view :].

Rob

------------=_1583532848-65438-83
Content-Type: text/x-c++; charset=us-ascii; name="choose.h"
Content-Disposition: inline; filename="choose.h"
Content-Transfer-Encoding: base64
Content-Length: 2347

LyoKICogQ29weXJpZ2h0IChjKSAyMDAwLCBSZWQgSGF0LCBJbmMuCiAqCiAq
ICAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogKiAgICAgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBh
cyBwdWJsaXNoZWQgYnkKICogICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5k
YXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCiAq
ICAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgog
KiAgICAgQSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZSBjYW4gYmUgZm91bmQgYXQKICogICAgIGh0dHA6Ly93d3cuZ251Lm9yZy8K
ICoKICogV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bo
b3RtYWlsLmNvbT4KICoKICovCgojaWZuZGVmIF9DSE9PU0VfSF8KI2RlZmlu
ZSBfQ0hPT1NFX0hfCgojaW5jbHVkZSAiaW5pLmgiCgojZGVmaW5lIENBVEVH
T1JZX0VYUEFOREVEICAwCiNkZWZpbmUgQ0FURUdPUllfQ09MTEFQU0VEIDEK
CgpzdHJ1Y3QgX2hlYWRlcgp7CiAgY2hhciAqdGV4dDsKICBpbnQgc2xlbjsK
ICBpbnQgd2lkdGg7CiAgaW50IHg7Cn07Cgp0eXBlZGVmIGNsYXNzIF92aWV3
IHZpZXc7CgpjbGFzcyBwaWNrX2xpbmUKewogIHB1YmxpYzoKICAgIHZvaWQg
c2V0X2xpbmUgKFBhY2thZ2UgKl9wa2cpOwogICAgdm9pZCBzZXRfbGluZSAo
Q2F0ZWdvcnkgKl9jYXQpOwogICAgdm9pZCBwYWludCAoSERDIGhkYywgaW50
IHgsIGludCB5LCBpbnQgcm93LCBpbnQgc2hvd19jYXQpOwogICAgUGFja2Fn
ZSAqZ2V0X3BrZyAodm9pZCkgeyByZXR1cm4gcGtnOyB9OwogICAgQ2F0ZWdv
cnkgKmdldF9jYXRlZ29yeSAodm9pZCkgeyByZXR1cm4gY2F0OyB9OwogICAg
aW50IGNsaWNrIChpbnQgeCk7CiAgcHJpdmF0ZToKICAgIFBhY2thZ2UgKnBr
ZzsKICAgIENhdGVnb3J5ICpjYXQ7Cn07CgpjbGFzcyBfdmlldwp7CiAgcHVi
bGljOgogICAgaW50IG51bV9jb2x1bW5zOwogICAgdmlld3MgZ2V0X3ZpZXdf
bW9kZSAoKSB7IHJldHVybiB2aWV3X21vZGU7IH07CiAgICB2b2lkIHNldF92
aWV3X21vZGUodmlld3MgX21vZGUpOwogICAgc3RydWN0IF9oZWFkZXIgKmhl
YWRlcnM7CiAgICBfdmlldyAodmlld3MgbW9kZSwgSERDIGRjKTsKICAgIGNo
YXIgKm1vZGVfY2FwdGlvbiAoKTsKICAgIHZvaWQgaW5zZXJ0X3BrZyAoUGFj
a2FnZSAqKTsKICAgIHZvaWQgaW5zZXJ0X2NhdGVnb3J5IChDYXRlZ29yeSAq
LCBpbnQpOwogICAgdm9pZCBjbGVhcl92aWV3ICh2b2lkKTsKICAgIGludCBj
bGljayAoaW50IHJvdywgaW50IHgpOwogICAgaW50IGN1cnJlbnRfY29sOwog
ICAgaW50IG5ld19jb2w7CiAgICBpbnQgc3JjX2NvbDsKICAgIGludCBjYXRf
Y29sOwogICAgaW50IHBrZ19jb2w7CiAgICBpbnQgbGFzdF9jb2w7CiAgICBw
aWNrX2xpbmUgKiBsaW5lczsKICAgIGludCBubGluZXM7CgogIHByaXZhdGU6
CiAgICB2aWV3cyB2aWV3X21vZGU7CiAgICB2b2lkIHNldF9oZWFkZXJzICh2
b2lkKTsKICAgIHZvaWQgaW5pdF9oZWFkZXJzIChIREMgZGMpOwogICAgdm9p
ZCBpbnNlcnRfYXQgKGludCwgcGlja19saW5lKTsKICAgIHZvaWQgaW5zZXJ0
X3VuZGVyIChpbnQgbGluZW4sIHBpY2tfbGluZSBsaW5lKTsgCgp9OwoKI2Vu
ZGlmIC8qIF9DSE9PU0VfSF8gKi8K

------------=_1583532848-65438-83
Content-Type: text/x-diff; charset=us-ascii; name="currentsetup.patch"
Content-Disposition: inline; filename="currentsetup.patch"
Content-Transfer-Encoding: base64
Content-Length: 49415

PyBjaG9vc2UuaAo/IGN1cnJlbnRzZXR1cC5wYXRjaAo/IGRlcGVuZHMyLnBh
dGNoCj8gZGVwZW5kczQucGF0Y2gKPyBoaWVyYXJjaHkucGF0Y2gKPyBoaWVy
YXJjaHkyLnBhdGNoCj8gaG9tZS5wYXRjaAo/IHdvcmsucGF0Y2gKSW5kZXg6
IGNob29zZS5jYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAv
Y3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL2Nob29zZS5jYyx2CnJldHJp
ZXZpbmcgcmV2aXNpb24gMi4zNQpkaWZmIC11IC1wIC1yMi4zNSBjaG9vc2Uu
Y2MKLS0tIGNob29zZS5jYwkyMDAxLzA2LzI1IDA1OjU1OjIyCTIuMzUKKysr
IGNob29zZS5jYwkyMDAxLzA2LzMwIDAwOjQ4OjIyCkBAIC0yNSw3ICsyNSw3
IEBACiAgICBpbnN0YWxsIHBhY2thZ2VzLCBvciB0byBpbnN0YWxsIHBhY2th
Z2VzIHRoYXQgYXJlbid0IGluc3RhbGxlZCBieQogICAgZGVmYXVsdC4gKi8K
IAotc3RhdGljIGNoYXIgKmN2c2lkID0gIlxuJSUlICRJZDogY2hvb3NlLmNj
LHYgMi4zNSAyMDAxLzA2LzI1IDA1OjU1OjIyIGNnZiBFeHAgJFxuIjsKK3N0
YXRpYyBjaGFyICpjdnNpZCA9ICJcbiUlJSAkSWQ6IGNob29zZS5jYyx2IDIu
MzMgMjAwMS8wNi8xNiAxODo1MDoxMyBjZ2YgRXhwICRcbiI7CiAKICNpbmNs
dWRlICJ3aW4zMi5oIgogI2luY2x1ZGUgPHN0ZGlvLmg+CkBAIC00Myw2ICs0
Myw3IEBAIHN0YXRpYyBjaGFyICpjdnNpZCA9ICJcbiUlJSAkSWQ6IGNob29z
ZS4KICNpbmNsdWRlICJmaW5kLmgiCiAjaW5jbHVkZSAiZmlsZW1hbmlwLmgi
CiAjaW5jbHVkZSAibW91bnQuaCIKKyNpbmNsdWRlICJjaG9vc2UuaCIKIAog
I2luY2x1ZGUgInBvcnQuaCIKIApAQCAtNTUsOCArNTYsNiBAQCBzdGF0aWMg
Y2hhciAqY3ZzaWQgPSAiXG4lJSUgJElkOiBjaG9vc2UuCiAKIHN0YXRpYyBp
bnQgaW5pdGlhbGl6ZWQgPSAwOwogCi1zdGF0aWMgaW50IGZ1bGxfbGlzdCA9
IDA7Ci0KIHN0YXRpYyBpbnQgc2Nyb2xsX3VsY194LCBzY3JvbGxfdWxjX3k7
CiAKIHN0YXRpYyBIV05EIGx2LCBuZXh0YnV0dG9uLCBjaG9vc2VfaW5zdF90
ZXh0OwpAQCAtNjYsMjkgKzY1LDMwIEBAIHN0YXRpYyBIQU5ETEUgc3lzZm9u
dDsKIHN0YXRpYyBpbnQgcm93X2hlaWdodDsKIHN0YXRpYyBIQU5ETEUgYm1f
c3BpbiwgYm1fcnRhcnJvdywgYm1fY2hlY2t5ZXMsIGJtX2NoZWNrbm8sIGJt
X2NoZWNrbmE7CiBzdGF0aWMgSERDIGJpdG1hcF9kYzsKK3N0YXRpYyB2aWV3
ICpjaG9vc2VyID0gTlVMTDsKKworc3RhdGljIHN0cnVjdCBfaGVhZGVyIHBr
Z19oZWFkZXJzW10gPSB7CisgIHsgIkN1cnJlbnQiLCA3LCAwLCAwIH0sCisg
IHsgIk5ldyIsIDMsIDAsIDAgfSwKKyAgeyAiU3JjPyIsIDQsIDAsIDAgfSwK
KyAgeyAiQ2F0ZWdvcnkiLCA4LCAwLCAwIH0sCisgIHsgIlBhY2thZ2UiLCA3
LCAwLCAwIH0sCisgIHsgMCwgMCwgMCwgMCB9Cit9OwogCi1zdGF0aWMgc3Ry
dWN0Ci0gIHsKLSAgICBjaGFyICp0ZXh0OwotICAgIGludCBzbGVuOwotICAg
IGludCB3aWR0aDsKLSAgICBpbnQgeDsKLSAgfQotaGVhZGVyc1tdID0gewor
c3RhdGljIHN0cnVjdCBfaGVhZGVyIGNhdF9oZWFkZXJzW10gPSB7CisgIHsg
IkNhdGVnb3J5IiwgOCwgMCwgMCB9LAogICB7ICJDdXJyZW50IiwgNywgMCwg
MCB9LAotI2RlZmluZSBDVVJSRU5UX0NPTCAwCiAgIHsgIk5ldyIsIDMsIDAs
IDAgfSwKLSNkZWZpbmUgTkVXX0NPTCAxCiAgIHsgIlNyYz8iLCA0LCAwLCAw
IH0sCi0jZGVmaW5lIFNSQ19DT0wgMgogICB7ICJQYWNrYWdlIiwgNywgMCwg
MCB9LAotI2RlZmluZSBQQUNLQUdFX0NPTCAzCiAgIHsgMCwgMCwgMCwgMCB9
CiB9OwotI2RlZmluZSBOVU1fQ09MVU1OUyAoc2l6ZW9mIChoZWFkZXJzKSAv
IChzaXplb2YgKGhlYWRlcnNbMF0pKSAtIDEpCiAKLWludCAqcGFja2FnZV9p
bmRleGVzLCBuaW5kZXhlczsKK3N0YXRpYyBpbnQgYWRkX3JlcXVpcmVkKFBh
Y2thZ2UgKnBrZyk7CitzdGF0aWMgdm9pZCBzZXRfdmlld19tb2RlIChIV05E
IGgsIHZpZXdzIG1vZGUpOwogCisKIHN0YXRpYyBib29sCiBpc2luc3RhbGxl
ZCAoUGFja2FnZSAqcGtnLCBpbnQgdHJ1c3QpCiB7CkBAIC0xMDAsMTEgKzEw
MCw5IEBAIGlzaW5zdGFsbGVkIChQYWNrYWdlICpwa2csIGludCB0cnVzdCkK
IHN0YXRpYyB2b2lkCiBzZXRfYWN0aW9uIChQYWNrYWdlICpwa2csIGJvb2wg
cHJlaW5jKQogeworICBwa2ctPnNyY3BpY2tlZCA9IDA7CiAgIGlmICghcGtn
LT5hY3Rpb24gfHwgcHJlaW5jKQotICAgIHsKLSAgICAgICgoaW50KSBwa2ct
PmFjdGlvbikrKzsKLSAgICAgIHBrZy0+c3JjcGlja2VkID0gMDsKLSAgICB9
CisgICAgKChpbnQpIHBrZy0+YWN0aW9uKSsrOwogCiAgIC8qIEV4ZXJjaXNl
IHRoZSBhY3Rpb24gc3RhdGUgbWFjaGluZS4gKi8KICAgZm9yICg7OyAoKGlu
dCkgcGtnLT5hY3Rpb24pKyspCkBAIC0xNDcsMzMgKzE0NSw4OSBAQCBzZXRf
YWN0aW9uIChQYWNrYWdlICpwa2csIGJvb2wgcHJlaW5jKQogICAgICAgY2Fz
ZSBBQ1RJT05fVU5JTlNUQUxMOgogCWlmIChwa2ctPmluc3RhbGxlZCkKIAkg
IHJldHVybjsKLQlicmVhazsKICAgICAgIGNhc2UgQUNUSU9OX1JFRE86Ci0J
aWYgKHBrZy0+aW5zdGFsbGVkICYmIHBrZy0+aW5mb1twa2ctPmluc3RhbGxl
ZF9peF0uaW5zdGFsbF9leGlzdHMpCisJaWYgKHBrZy0+aW5zdGFsbGVkKQog
CSAgewogCSAgICBwa2ctPnRydXN0ID0gcGtnLT5pbnN0YWxsZWRfaXg7CiAJ
ICAgIHJldHVybjsKIAkgIH0KLQlicmVhazsKICAgICAgIGNhc2UgQUNUSU9O
X1NSQ19PTkxZOgotCWlmIChwa2ctPmluZm9bcGtnLT50cnVzdF0uc291cmNl
X2V4aXN0cykKLQkgIHsKLQkgICAgcGtnLT5zcmNwaWNrZWQgPSAxOwotCSAg
ICByZXR1cm47Ci0JICB9CisJaWYgKHBrZy0+aW5zdGFsbGVkICYmIHBrZy0+
aW5zdGFsbGVkLT5zb3VyY2VfZXhpc3RzKQorCSAgcmV0dXJuOwogCWJyZWFr
OwogICAgICAgY2FzZSBBQ1RJT05fU0FNRV9MQVNUOgogCXBrZy0+YWN0aW9u
ID0gQUNUSU9OX1NLSVA7CiAJLyogRmFsbCB0aHJvdWdoIGludGVudGlvbmFs
bHkgKi8KICAgICAgIGNhc2UgQUNUSU9OX1NLSVA6Ci0JaWYgKCFwa2ctPmlu
c3RhbGxlZCB8fCAhcGtnLT5pbmZvW3BrZy0+aW5zdGFsbGVkX2l4XS5pbnN0
YWxsX2V4aXN0cykKLQkgIHJldHVybjsKLQlicmVhazsKKwlyZXR1cm47CiAg
ICAgICBkZWZhdWx0OgogCWxvZyAoMCwgInNob3VsZCBuZXZlciBnZXQgaGVy
ZSAlZFxuIiwgcGtnLT5hY3Rpb24pOwogICAgICAgfQogfQogCitzdGF0aWMg
aW50CithZGRfcmVxdWlyZWQgKFBhY2thZ2UgKnBrZykKK3sKKyAgRGVwZW5k
ZW5jeSAqZHA7CisgIFBhY2thZ2UgKnJlcXVpcmVkOworICBpbnQgYzsKKyAg
aW50IGNoYW5nZWQgPSAwOworICBkcCA9IHBrZy0+cmVxdWlyZWQ7CisgIHN3
aXRjaCAocGtnLT5hY3Rpb24pCisgICAgeworICAgIGNhc2UgQUNUSU9OX1VO
SU5TVEFMTDoKKyAgICBjYXNlIEFDVElPTl9FUlJPUjoKKyAgICBjYXNlIEFD
VElPTl9VTktOT1dOOgorICAgIGNhc2UgQUNUSU9OX1NSQ19PTkxZOgorICAg
IGNhc2UgQUNUSU9OX1NLSVA6CisgICAgICByZXR1cm4gMDsKKyAgICBkZWZh
dWx0OgorICAgICAgYnJlYWs7CisgICAgfQorICB3aGlsZSAoZHApCisgICAg
eworICAgICAgaWYgKChyZXF1aXJlZCA9IGdldHBrZ2J5bmFtZShkcC0+cGFj
a2FnZSkpID09IE5VTEwpCisgICAgICAgIHsKKyAgICAgICAgICBkcD1kcC0+
bmV4dDsKKyAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgfQorICAgICAg
c3dpdGNoIChyZXF1aXJlZC0+YWN0aW9uKQorICAgICAgICB7CisJY2FzZSBB
Q1RJT05fUFJFVjoKKwljYXNlIEFDVElPTl9DVVJSOgorCWNhc2UgQUNUSU9O
X1RFU1Q6CisJY2FzZSBBQ1RJT05fTEFTVDoKKwljYXNlIEFDVElPTl9TQU1F
X0NVUlI6CisJY2FzZSBBQ1RJT05fU0FNRV9URVNUOgorCWNhc2UgQUNUSU9O
X1NBTUVfUFJFVjoKKwljYXNlIEFDVElPTl9SRURPOgorCWNhc2UgQUNUSU9O
X1NBTUVfTEFTVDoKKwkgIC8qIHdlIGFyZSBpbnN0YWxsaW5nIGEgdXNlciBz
ZWxlY3RlZCB2ZXJzaW9uICovCisJICBicmVhazsKKwkKKwljYXNlIEFDVElP
Tl9VTklOU1RBTEw6CisJICAvKiBpdCdzIGFscmVhZHkgaW5zdGFsbGVkIC0g
bGVhdmUgaXQgKi8KKwkgIHJlcXVpcmVkLT5hY3Rpb24gPSBBQ1RJT05fU0tJ
UDsKKwkgIGJyZWFrOworCWNhc2UgQUNUSU9OX0VSUk9SOgorCWNhc2UgQUNU
SU9OX1VOS05PV046CisJY2FzZSBBQ1RJT05fU1JDX09OTFk6CisJY2FzZSBB
Q1RJT05fU0tJUDoKKwkgIC8qIHRoZSBjdXJyZW50IGluc3RhbGwgd2lsbCBm
YWlsICovCisJICByZXF1aXJlZC0+YWN0aW9uID0gQUNUSU9OX1BSRVY7IC8q
IHRoaXMgZmluZCBwcmV2LCB0aGVuIGN1cnIsIHRoZW4gdGVzdC4gKi8KKwkg
IHNldF9hY3Rpb24ocmVxdWlyZWQsIDApOwkgIC8qIHdlIG5lZWQgYSBmaW5k
X2Jlc3QgdGhhdCBnZXRzIGluc3RhbGxlZCwgKi8KKwkgIGNoYW5nZWQrKzsJ
CQkgIC8qIHRoZW4gY3VycmVudCwgdGhlbiBwcmV2LCB0aGVuIHRlc3QgKi8K
KwkgIGNob29zZXItPmluc2VydF9wa2cgKHJlcXVpcmVkKTsKKwkgIGJyZWFr
OworCWRlZmF1bHQ6CisJICBsb2cgKDAsICJzaG91bGQgbmV2ZXIgZ2V0IGhl
cmUgJWRcbiIsIHJlcXVpcmVkLT5hY3Rpb24pOworCX0KKyAgICAgIGNoYW5n
ZWQgKz0gYWRkX3JlcXVpcmVkIChyZXF1aXJlZCk7CisgICAgICBkcD1kcC0+
bmV4dDsKKyAgICB9CisgIHJldHVybiBjaGFuZ2VkOworfQorCiAvKiBSZXR1
cm4gYW4gYXBwcm9wcmlhdGUgY2FwdGlvbiBnaXZlbiB0aGUgY3VycmVudCBh
Y3Rpb24uICovCiBjb25zdCBjaGFyICoKIGNob29zZV9jYXB0aW9uIChQYWNr
YWdlICpwa2cpCkBAIC0yMjYsNTYgKzI4MCwxOSBAQCBwYWludCAoSFdORCBo
d25kKQogICB5ID0gY3IudG9wIC0gc2Nyb2xsX3VsY195ICsgaGVhZGVyX2hl
aWdodDsKIAogCi0gIGZvciAoaSA9IDA7IGhlYWRlcnNbaV0udGV4dDsgaSsr
KQorICBmb3IgKGkgPSAwOyBpIDw9IGNob29zZXItPmxhc3RfY29sIDsgaSsr
KQogICAgIHsKLSAgICAgIFRleHRPdXQgKGhkYywgeCArIGhlYWRlcnNbaV0u
eCwgMywgaGVhZGVyc1tpXS50ZXh0LCBoZWFkZXJzW2ldLnNsZW4pOwotICAg
ICAgTW92ZVRvRXggKGhkYywgeCArIGhlYWRlcnNbaV0ueCwgaGVhZGVyX2hl
aWdodC0zLCAmcCk7Ci0gICAgICBMaW5lVG8gKGhkYywgeCArIGhlYWRlcnNb
aV0ueCArIGhlYWRlcnNbaV0ud2lkdGgsIGhlYWRlcl9oZWlnaHQtMyk7Cisg
ICAgICBUZXh0T3V0IChoZGMsIHggKyBjaG9vc2VyLT5oZWFkZXJzW2ldLngs
IDMsIGNob29zZXItPmhlYWRlcnNbaV0udGV4dCwgY2hvb3Nlci0+aGVhZGVy
c1tpXS5zbGVuKTsKKyAgICAgIE1vdmVUb0V4IChoZGMsIHggKyBjaG9vc2Vy
LT5oZWFkZXJzW2ldLngsIGhlYWRlcl9oZWlnaHQtMywgJnApOworICAgICAg
TGluZVRvIChoZGMsIHggKyBjaG9vc2VyLT5oZWFkZXJzW2ldLnggKyBjaG9v
c2VyLT5oZWFkZXJzW2ldLndpZHRoLCBoZWFkZXJfaGVpZ2h0LTMpOwogICAg
IH0KIAogICBJbnRlcnNlY3RDbGlwUmVjdCAoaGRjLCBjci5sZWZ0LCBjci50
b3AgKyBoZWFkZXJfaGVpZ2h0LCBjci5yaWdodCwgY3IuYm90dG9tKTsKLQot
ICBmb3IgKGlpID0gMDsgaWkgPCBuaW5kZXhlczsgaWkrKykKLSAgICB7Ci0g
ICAgICBpID0gcGFja2FnZV9pbmRleGVzW2lpXTsKLSAgICAgIFBhY2thZ2Ug
KnBrZyA9IHBhY2thZ2UgKyBpOwotICAgICAgaW50IHIgPSB5ICsgaWkgKiBy
b3dfaGVpZ2h0OwotICAgICAgaW50IGJ5ID0gciArIHRtLnRtSGVpZ2h0IC0g
MTE7Ci0gICAgICBpZiAocGtnLT5pbnN0YWxsZWQpCi0JewotCSAgVGV4dE91
dCAoaGRjLCB4ICsgaGVhZGVyc1tDVVJSRU5UX0NPTF0ueCwgciwKLQkJICAg
cGtnLT5pbnN0YWxsZWQtPnZlcnNpb24sIHN0cmxlbiAocGtnLT5pbnN0YWxs
ZWQtPnZlcnNpb24pKTsKLQkgIFNlbGVjdE9iamVjdCAoYml0bWFwX2RjLCBi
bV9ydGFycm93KTsKLQkgIEJpdEJsdCAoaGRjLCB4ICsgaGVhZGVyc1tDVVJS
RU5UX0NPTF0ueCArIGhlYWRlcnNbMF0ud2lkdGggKwotCQkgIElDT05fTUFS
R0lOLzIgKyBITUFSR0lOLzIsIGJ5LAotCQkgIDExLCAxMSwgYml0bWFwX2Rj
LCAwLCAwLCBTUkNDT1BZKTsKLQl9CiAKLSAgICAgIGNvbnN0IGNoYXIgKnMg
PSBjaG9vc2VfY2FwdGlvbiAocGtnKTsKLSAgICAgIFRleHRPdXQgKGhkYywg
eCArIGhlYWRlcnNbTkVXX0NPTF0ueCArIE5FV19DT0xfU0laRV9TTE9QLCBy
LAotCSAgICAgICBzLCBzdHJsZW4gKHMpKTsKLSAgICAgIFNlbGVjdE9iamVj
dCAoYml0bWFwX2RjLCBibV9zcGluKTsKLSAgICAgIEJpdEJsdCAoaGRjLCB4
ICsgaGVhZGVyc1tORVdfQ09MXS54LCBieSwgMTEsIDExLAotCSAgICAgIGJp
dG1hcF9kYywgMCwgMCwgU1JDQ09QWSk7CisgIGZvciAoaWkgPSAwOyBpaSA8
IGNob29zZXItPm5saW5lczsgaWkrKykKKyAgICAgIGNob29zZXItPmxpbmVz
W2lpXS5wYWludCAoaGRjLCB4LCB5LCBpaSwgKGNob29zZXItPmdldF92aWV3
X21vZGUgKCkgPT0gVklFV19DQVRFR09SWSkgPyAwIDogMSk7CiAKLSAgICAg
IEhBTkRMRSBjaGVja19ibTsKLSAgICAgIGlmIChwa2ctPnNyY3BpY2tlZCkK
LQljaGVja19ibSA9IGJtX2NoZWNreWVzOwotICAgICAgZWxzZQotCWNoZWNr
X2JtID0gYm1fY2hlY2tubzsKLQotICAgICAgU2VsZWN0T2JqZWN0IChiaXRt
YXBfZGMsIGNoZWNrX2JtKTsKLSAgICAgIEJpdEJsdCAoaGRjLCB4ICsgaGVh
ZGVyc1tTUkNfQ09MXS54LCBieSwgMTEsIDExLAotCSAgICAgIGJpdG1hcF9k
YywgMCwgMCwgU1JDQ09QWSk7Ci0KLSAgICAgIGlmIChwYWNrYWdlW2ldLnNk
ZXNjKQotCXMgPSBwYWNrYWdlW2ldLnNkZXNjOwotICAgICAgZWxzZQotCXMg
PSBwYWNrYWdlW2ldLm5hbWU7Ci0gICAgICBUZXh0T3V0IChoZGMsIHggKyBo
ZWFkZXJzW1BBQ0tBR0VfQ09MXS54LCByLCBzLCBzdHJsZW4gKHMpKTsKLSAg
ICB9Ci0KLSAgaWYgKG5pbmRleGVzID09IDApCisgIGlmIChjaG9vc2VyLT5u
bGluZXMgPT0gMCkKICAgICB7CiAgICAgICBzdGF0aWMgY2hhciAqbXNnID0g
Ik5vdGhpbmcgdG8gSW5zdGFsbC9VcGRhdGUiOwogICAgICAgaWYgKHNvdXJj
ZSA9PSBJRENfU09VUkNFX0RPV05MT0FEKQpAQCAtMzYwLDkgKzM3Nyw5IEBA
IGxpc3RfaHNjcm9sbCAoSFdORCBod25kLCBIV05EIGhjdGwsIFVJTlQKIHN0
YXRpYyBMUkVTVUxUIENBTExCQUNLCiBsaXN0X2NsaWNrIChIV05EIGh3bmQs
IEJPT0wgZGJsY2xrLCBpbnQgeCwgaW50IHksIFVJTlQgaGl0Q29kZSkKIHsK
LSAgaW50IHI7CisgIGludCByLHJlZnJlc2g7CiAKLSAgaWYgKG5pbmRleGVz
ID09IDApCisgIGlmIChjaG9vc2VyLT5ubGluZXMgPT0gMCkKICAgICByZXR1
cm4gMDsKIAogICBpZiAoeSA8IGhlYWRlcl9oZWlnaHQpCkBAIC0zNzIsMjYg
KzM4OSwzOCBAQCBsaXN0X2NsaWNrIChIV05EIGh3bmQsIEJPT0wgZGJsY2xr
LCBpbnQgCiAKICAgciA9ICh5ICsgUk9XX01BUkdJTi8yKSAvIHJvd19oZWln
aHQ7CiAKLSAgaWYgKHIgPCAwIHx8IHIgPj0gbmluZGV4ZXMpCisgIGlmIChy
IDwgMCB8fCByID49IGNob29zZXItPm5saW5lcykKICAgICByZXR1cm4gMDsK
KworICByZWZyZXNoID0gY2hvb3Nlci0+Y2xpY2sgKHIsIHgpOworIAorICBp
ZiAocmVmcmVzaCkKKyAgICB7CisgICAgICBSRUNUIHI7CisgICAgICBHZXRD
bGllbnRSZWN0IChsdiwgJnIpOworICAgICAgU0NST0xMSU5GTyBzaTsKKyAg
ICAgIG1lbXNldCAoJnNpLCAwLCBzaXplb2YgKHNpKSk7CisgICAgICBzaS5j
YlNpemUgPSBzaXplb2YgKHNpKTsKKyAgICAgIHNpLmZNYXNrID0gU0lGX0FM
TDsgLyogU0lGX1JBTkdFIHdhcyBnaXZpbmcgc3RyYW5nZSBiZWhhdmlvdXIg
Ki8KKyAgICAgIHNpLm5NaW4gPSAwOworCisgICAgICBzaS5uTWF4ID0gY2hv
b3Nlci0+bmxpbmVzICogcm93X2hlaWdodDsKKyAgICAgIHNpLm5QYWdlID0g
ci5ib3R0b20gLSBoZWFkZXJfaGVpZ2h0OworICAgICAgc2kublBvcyA9IHNj
cm9sbF91bGNfeTsKKyAgICAgIFNldFNjcm9sbEluZm8gKGx2LCBTQl9WRVJU
LCAmc2ksIFRSVUUpOwogCi0gIFBhY2thZ2UgKnBrZyA9IHBhY2thZ2UgKyBw
YWNrYWdlX2luZGV4ZXNbcl07CisgICAgICBJbnZhbGlkYXRlUmVjdCAobHYs
ICZyLCBUUlVFKTsKIAotICBpZiAoeCA+PSBoZWFkZXJzW05FV19DT0xdLngg
LSAoSE1BUkdJTiAvIDIpCi0gICAgICAmJiB4IDw9IGhlYWRlcnNbTkVXX0NP
TCArIDFdLnggLSAoSE1BUkdJTiAvIDIpKQotICAgIHNldF9hY3Rpb24gKHBr
ZywgMSk7Ci0KLSAgaWYgKHBrZy0+aW5mb1twa2ctPnRydXN0XS5zb3VyY2Vf
ZXhpc3RzCi0gICAgICAmJiB4ID49IGhlYWRlcnNbU1JDX0NPTF0ueCAtIEhN
QVJHSU4gLyAyCi0gICAgICAmJiB4IDw9IGhlYWRlcnNbU1JDX0NPTCArIDFd
LnggLSAoSE1BUkdJTiAvIDIpKQotICAgIHBrZy0+c3JjcGlja2VkIF49IDE7
Ci0KLSAgUkVDVCByZWN0OwotICByZWN0LmxlZnQgPSBoZWFkZXJzW05FV19D
T0xdLnggLSBzY3JvbGxfdWxjX3g7Ci0gIHJlY3QucmlnaHQgPSBoZWFkZXJz
W1NSQ19DT0wgKyAxXS54IC0gc2Nyb2xsX3VsY194OwotICByZWN0LnRvcCA9
IGhlYWRlcl9oZWlnaHQgKyByICogcm93X2hlaWdodCAtIHNjcm9sbF91bGNf
eTsKLSAgcmVjdC5ib3R0b20gPSByZWN0LnRvcCArIHJvd19oZWlnaHQ7Ci0g
IEludmFsaWRhdGVSZWN0IChod25kLCAmcmVjdCwgVFJVRSk7CisgICAgfQor
ICBlbHNlCisgICAgeworICAgICAgUkVDVCByZWN0OworICAgICAgcmVjdC5s
ZWZ0ID0gY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5uZXdfY29sXS54IC0g
c2Nyb2xsX3VsY194OworICAgICAgcmVjdC5yaWdodCA9IGNob29zZXItPmhl
YWRlcnNbY2hvb3Nlci0+c3JjX2NvbCArIDFdLnggLSBzY3JvbGxfdWxjX3g7
CisgICAgICByZWN0LnRvcCA9IGhlYWRlcl9oZWlnaHQgKyByICogcm93X2hl
aWdodCAtIHNjcm9sbF91bGNfeTsKKyAgICAgIHJlY3QuYm90dG9tID0gcmVj
dC50b3AgKyByb3dfaGVpZ2h0OworICAgICAgSW52YWxpZGF0ZVJlY3QgKGh3
bmQsICZyZWN0LCBUUlVFKTsKKyAgICB9CiB9CiAKIHN0YXRpYyBMUkVTVUxU
IENBTExCQUNLCkBAIC00MzcsMTQgKzQ2NiwxNCBAQCByZWdpc3Rlcl93aW5k
b3dzIChISU5TVEFOQ0UgaGluc3QpCiB9CiAKIHN0YXRpYyB2b2lkCi1ub3Rl
X3dpZHRoIChIREMgZGMsIGNoYXIgKnN0cmluZywgaW50IGFkZGVuZCwgaW50
IGNvbHVtbikKK25vdGVfd2lkdGggKHN0cnVjdCBfaGVhZGVyICpoZHJzLCBI
REMgZGMsIGNoYXIgKnN0cmluZywgaW50IGFkZGVuZCwgaW50IGNvbHVtbikK
IHsKICAgaWYgKCFzdHJpbmcpCiAgICAgcmV0dXJuOwogICBTSVpFIHM7CiAg
IEdldFRleHRFeHRlbnRQb2ludDMyIChkYywgc3RyaW5nLCBzdHJsZW4gKHN0
cmluZyksICZzKTsKLSAgaWYgKGhlYWRlcnNbY29sdW1uXS53aWR0aCA8IHMu
Y3ggKyBhZGRlbmQpCi0gICAgaGVhZGVyc1tjb2x1bW5dLndpZHRoID0gcy5j
eCArIGFkZGVuZDsKKyAgaWYgKGhkcnNbY29sdW1uXS53aWR0aCA8IHMuY3gg
KyBhZGRlbmQpCisgICAgaGRyc1tjb2x1bW5dLndpZHRoID0gcy5jeCArIGFk
ZGVuZDsKIH0KIAogc3RhdGljIGludApAQCAtNDg3LDYgKzUxNiwxNCBAQCBz
ZXRfZXhpc3RlbmNlICgpCiB9CiAKIHN0YXRpYyB2b2lkCitmaWxsX21pc3Np
bmdfY2F0ZWdvcnkgKCkKK3sKKyAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNr
YWdlOyBwa2ctPm5hbWU7IHBrZysrKQorICAgIGlmICghcGtnLT5jYXRlZ29y
eSkKKyAgICAgIGFkZF9jYXRlZ29yeSAocGtnLCByZWdpc3Rlcl9jYXRlZ29y
eSAoIk1pc2MiKSk7Cit9CisKK3N0YXRpYyB2b2lkCiBkZWZhdWx0X3RydXN0
IChIV05EIGgsIHRydXN0cyB0cnVzdCkKIHsKICAgaW50IGksIHQsIGM7CkBA
IC00OTQsNiArNTMxLDkgQEAgZGVmYXVsdF90cnVzdCAoSFdORCBoLCB0cnVz
dHMgdHJ1c3QpCiAgIGZvciAoUGFja2FnZSAqcGtnID0gcGFja2FnZTsgcGtn
LT5uYW1lOyBwa2crKykKICAgICB7CiAgICAgICBwa2ctPmFjdGlvbiA9IChh
Y3Rpb25zKSB0cnVzdDsKKyAgICAgIGlmIChwa2ctPmNhdGVnb3J5ICYmICEo
Z2V0cGFja2FnZWNhdGVnb3J5YnluYW1lIChwa2csICJSZXF1aXJlZCIpIHx8
CisJCQkgICAgIGdldHBhY2thZ2VjYXRlZ29yeWJ5bmFtZSAocGtnLCAiTWlz
YyIpKSkKKwlwa2ctPmFjdGlvbiA9IEFDVElPTl9TS0lQOwogICAgICAgc2V0
X2FjdGlvbiAocGtnLCAwKTsKICAgICB9CiAgIFJFQ1QgcjsKQEAgLTUwMywy
NCArNTQzLDQ1MCBAQCBkZWZhdWx0X3RydXN0IChIV05EIGgsIHRydXN0cyB0
cnVzdCkKICAgICBTZXRGb2N1cyAobmV4dGJ1dHRvbik7CiB9CiAKLXN0YXRp
YyB2b2lkCi1zZXRfZnVsbF9saXN0IChIV05EIGgsIGludCBpc2Z1bGwpCit2
b2lkCitwaWNrX2xpbmU6OnNldF9saW5lIChQYWNrYWdlICpfcGtnKQorewor
ICBwa2cgPSBfcGtnOworICBjYXQgPSBOVUxMOworfQorCit2b2lkCitwaWNr
X2xpbmU6OnNldF9saW5lIChDYXRlZ29yeSAqX2NhdCkKK3sKKyAgY2F0ID0g
X2NhdDsKKyAgcGtnID0gTlVMTDsKK30KKwordm9pZAorcGlja19saW5lOjpw
YWludCAoSERDIGhkYywgaW50IHgsIGludCB5LCBpbnQgcm93LCBpbnQgc2hv
d19jYXQpCit7CisgIGludCByID0geSArIHJvdyAqIHJvd19oZWlnaHQ7Cisg
IGludCBieSA9IHIgKyB0bS50bUhlaWdodCAtIDExOworICBpZiAocGtnKQor
ICAgIHsKKyAgICAgIGlmIChwa2ctPmluc3RhbGxlZCkKKyAgICAgICAgewor
ICAgICAgICAgIFRleHRPdXQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNb
Y2hvb3Nlci0+Y3VycmVudF9jb2xdLngsIHIsCisgICAgICAgICAgICAgICAg
ICAgcGtnLT5pbnN0YWxsZWQtPnZlcnNpb24sIHN0cmxlbiAocGtnLT5pbnN0
YWxsZWQtPnZlcnNpb24pKTsKKyAgICAgICAgICBTZWxlY3RPYmplY3QgKGJp
dG1hcF9kYywgYm1fcnRhcnJvdyk7CisgICAgICAgICAgQml0Qmx0IChoZGMs
IHggKyBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmN1cnJlbnRfY29sXS54
ICsgY2hvb3Nlci0+aGVhZGVyc1swXS53aWR0aCArIElDT05fTUFSR0lOLzIg
KyBITUFSR0lOLzIsIGJ5LAorICAgICAgICAgICAgICAgICAgMTEsIDExLCBi
aXRtYXBfZGMsIDAsIDAsIFNSQ0NPUFkpOworICAgICAgICB9CisKKyAgICAg
IGNvbnN0IGNoYXIgKnMgPSBjaG9vc2VfY2FwdGlvbiAocGtnKTsKKyAgICAg
IFRleHRPdXQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+
bmV3X2NvbF0ueCArIE5FV19DT0xfU0laRV9TTE9QLCByLAorICAgICAgICAg
ICAgICAgcywgc3RybGVuIChzKSk7CisgICAgICBTZWxlY3RPYmplY3QgKGJp
dG1hcF9kYywgYm1fc3Bpbik7CisgICAgICBCaXRCbHQgKGhkYywgeCArIGNo
b29zZXItPmhlYWRlcnNbY2hvb3Nlci0+bmV3X2NvbF0ueCwgYnksIDExLCAx
MSwKKyAgICAgICAgICAgICAgYml0bWFwX2RjLCAwLCAwLCBTUkNDT1BZKTsK
KworICAgICAgSEFORExFIGNoZWNrX2JtOworICAgICAgaWYgKHBrZy0+c3Jj
cGlja2VkKQorICAgICAgICBjaGVja19ibSA9IGJtX2NoZWNreWVzOworICAg
ICAgZWxzZQorICAgICAgICBjaGVja19ibSA9IGJtX2NoZWNrbm87CisKKyAg
ICAgIFNlbGVjdE9iamVjdCAoYml0bWFwX2RjLCBjaGVja19ibSk7CisgICAg
ICBCaXRCbHQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+
c3JjX2NvbF0ueCwgYnksIDExLCAxMSwKKyAgICAgICAgICAgICAgYml0bWFw
X2RjLCAwLCAwLCBTUkNDT1BZKTsKKworCS8qIHNob3dzICJmaXJzdCIgY2F0
ZWdvcnkgLSBkbyB3ZSB3YW50IHRvIHNob3cgYW55PyAqLworICAgICAgaWYg
KHBrZy0+Y2F0ZWdvcnkgJiYgc2hvd19jYXQpCisgICAgICAgVGV4dE91dCAo
aGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5jYXRfY29sXS54
LCByLCBwa2ctPmNhdGVnb3J5LT5uYW1lLCBzdHJsZW4gKHBrZy0+Y2F0ZWdv
cnktPm5hbWUpKTsKKworICAgICAgaWYgKHBrZy0+c2Rlc2MpCisgICAgICAg
IHMgPSBwa2ctPnNkZXNjOworICAgICAgZWxzZQorICAgICAgICBzID0gcGtn
LT5uYW1lOworICAgICAgVGV4dE91dCAoaGRjLCB4ICsgY2hvb3Nlci0+aGVh
ZGVyc1tjaG9vc2VyLT5wa2dfY29sXS54LCByLCBzLCBzdHJsZW4gKHMpKTsK
KyAgICB9CisgIGVsc2UgaWYgKGNhdCkKKyAgICB7CisgICAgICBUZXh0T3V0
IChoZGMsIHggKyBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmNhdF9jb2xd
LngsIHIsIGNhdC0+bmFtZSwgc3RybGVuIChjYXQtPm5hbWUpKTsKKyAgICB9
Cit9CisKK2ludAorcGlja19saW5lOjpjbGljayAoaW50IHgpCit7CisgIGlm
IChwa2cpCisgICAgeworICAgICAgaWYgKHggPj0gY2hvb3Nlci0+aGVhZGVy
c1tjaG9vc2VyLT5zcmNfY29sXS54IC0gSE1BUkdJTi8yICYmIHggPD0gY2hv
b3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5zcmNfY29sICsgMV0ueCAtIEhNQVJH
SU4vMikKKyAgICAgIHBrZy0+c3JjcGlja2VkIF49IDE7CisKKyAgICBpZiAo
eCA+PSBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPm5ld19jb2xdLnggLSAo
SE1BUkdJTiAvIDIpICYmIHggPD0gY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2Vy
LT5uZXdfY29sICsgMV0ueCAtIEhNQVJHSU4vMikKKyAgICAgIHsKKyAgICAg
ICAgc2V0X2FjdGlvbiAocGtnLCAxKTsKKyAgICAgICAgLyogQWRkIGFueSBw
YWNrYWdlcyB0aGF0IGFyZSBuZWVkZWQgYnkgdGhpcyBwYWNrYWdlICovCisg
ICAgICAgIHJldHVybiBhZGRfcmVxdWlyZWQgIChwa2cpOworICAgICAgfQor
ICAgIH0KKyAgZWxzZSBpZiAoY2F0KQorICAgIHsKKyAgICAgIC8qIGhhbmRs
ZSB0aGUgY2F0YWxvZyBiZWluZyBjbGlja2VkIC4uLiBkb2VzIHRoaXMgYmVs
b25nIHVwIGEgbGV2ZWwuLiA/ICovCisgICAgfQorICAKKyAgcmV0dXJuIDA7
Cit9CisKK192aWV3OjpfdmlldyAodmlld3MgX21vZGUsIEhEQyBkYykKK3sK
KyAgbGluZXMgPSBOVUxMOworICBubGluZXMgPSAwOworICB2aWV3X21vZGUg
PSBWSUVXX1BBQ0tBR0U7CisgIHNldF9oZWFkZXJzICgpOworICBpbml0X2hl
YWRlcnMgKGRjKTsKKyAgdmlld19tb2RlID0gVklFV19DQVRFR09SWTsKKyAg
c2V0X2hlYWRlcnMgKCk7CisgIGluaXRfaGVhZGVycyAoZGMpOworCisgIHZp
ZXdfbW9kZSA9IF9tb2RlOworICBzZXRfaGVhZGVycyAoKTsKK30KKwordm9p
ZAorX3ZpZXc6OnNldF92aWV3X21vZGUgKHZpZXdzIF9tb2RlKQoreworICBp
ZiAoX21vZGUgPT0gTlZJRVcpCisgICAgICB2aWV3X21vZGUgPSBWSUVXX1BB
Q0tBR0VfRlVMTDsKKyAgZWxzZQorICAgIHZpZXdfbW9kZSA9IF9tb2RlOwor
ICBzZXRfaGVhZGVycyAoKTsKK30KKworY2hhciAqCitfdmlldzo6bW9kZV9j
YXB0aW9uICgpCit7CisgIHN3aXRjaCAodmlld19tb2RlKQorICAgIHsKKyAg
ICBjYXNlIFZJRVdfVU5LTk9XTjogICAgICByZXR1cm4gIiI7CisgICAgY2Fz
ZSBWSUVXX1BBQ0tBR0VfRlVMTDogcmV0dXJuICJGdWxsIjsKKyAgICBjYXNl
IFZJRVdfUEFDS0FHRTogICAgICByZXR1cm4gIlBhcnRpYWwiOworICAgIGNh
c2UgVklFV19DQVRFR09SWTogICAgIHJldHVybiAiQ2F0ZWdvcnkiOworICAg
IGRlZmF1bHQ6ICAgICAgICAgICAgICAgIHJldHVybiAiIjsKKyAgICB9Cit9
CisKK3ZvaWQKK192aWV3OjpzZXRfaGVhZGVycyAodm9pZCkKK3sKKyAgc3dp
dGNoICh2aWV3X21vZGUpCisgICAgeworICAgIGNhc2UgVklFV19VTktOT1dO
OgorICAgICAgcmV0dXJuOworICAgIGNhc2UgVklFV19QQUNLQUdFX0ZVTEw6
IAorICAgIGNhc2UgVklFV19QQUNLQUdFOiAgICAgIAorICAgICAgaGVhZGVy
cyA9IHBrZ19oZWFkZXJzOworICAgICAgY3VycmVudF9jb2wgPSAwOworICAg
ICAgbmV3X2NvbCA9IDE7CisgICAgICBzcmNfY29sID0gMjsKKyAgICAgIGNh
dF9jb2wgPSAzOworICAgICAgcGtnX2NvbCA9IDQ7CisgICAgICBsYXN0X2Nv
bCA9IDQ7CisgICAgICBicmVhazsKKyAgICBjYXNlIFZJRVdfQ0FURUdPUlk6
CisgICAgICBoZWFkZXJzID0gY2F0X2hlYWRlcnM7CisgICAgICBjdXJyZW50
X2NvbCA9IDE7CisgICAgICBuZXdfY29sID0gMjsKKyAgICAgIHNyY19jb2wg
PSAzOworICAgICAgY2F0X2NvbCA9IDA7CisgICAgICBwa2dfY29sID0gNDsK
KyAgICAgIGxhc3RfY29sID0gNDsKKyAgICBkZWZhdWx0OgorICAgICAgcmV0
dXJuOworICAgIH0KK30KKwordm9pZAorX3ZpZXc6OmluaXRfaGVhZGVycyAo
SERDIGRjKQogewogICBpbnQgaTsKLSAgZnVsbF9saXN0ID0gaXNmdWxsOwor
CisgIGZvciAoaSA9IDA7IGhlYWRlcnNbaV0udGV4dDsgaSsrKQorICAgIGhl
YWRlcnNbaV0ud2lkdGggPSAwOworCisgIGZvciAoaSA9IDA7IGhlYWRlcnNb
aV0udGV4dDsgaSsrKQorICAgIG5vdGVfd2lkdGggKGhlYWRlcnMsIGRjLCBo
ZWFkZXJzW2ldLnRleHQsIDAsIGkpOworICBmb3IgKFBhY2thZ2UgKnBrZyA9
IHBhY2thZ2U7IHBrZy0+bmFtZTsgcGtnKyspCisgICAgeworICAgICAgaWYg
KHBrZy0+aW5zdGFsbGVkKQorICAgICAgICB7CisgICAgICAgICAgbm90ZV93
aWR0aCAoaGVhZGVycywgZGMsIHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uLCAw
LCBjdXJyZW50X2NvbCk7CisgICAgICAgICAgbm90ZV93aWR0aCAoaGVhZGVy
cywgZGMsIHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uLCBORVdfQ09MX1NJWkVf
U0xPUCwgbmV3X2NvbCk7CisgICAgICAgIH0KKyAgICAgIGZvciAoSW5mbyAq
aW5mID0gcGtnLT5pbmZvc2NhbjsgaW5mIDwgcGtnLT5pbmZvZW5kOyBpbmYr
KykKKyAgICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywgZGMsIGluZi0+dmVy
c2lvbiwgTkVXX0NPTF9TSVpFX1NMT1AsIG5ld19jb2wpOworICAgICAgZm9y
IChDYXRlZ29yeSAqY2F0ID0gcGtnLT5jYXRlZ29yeTsgY2F0IDsgY2F0ID0g
Y2F0LT5uZXh0KQorCW5vdGVfd2lkdGggKGhlYWRlcnMsIGRjLCBjYXQtPm5h
bWUsIDAsIGNhdF9jb2wpOworICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywg
ZGMsIHBrZy0+bmFtZSwgMCwgcGtnX2NvbCk7CisgICAgICBub3RlX3dpZHRo
IChoZWFkZXJzLCBkYywgcGtnLT5zZGVzYywgMCwgcGtnX2NvbCk7CisgICAg
fQorICBub3RlX3dpZHRoIChoZWFkZXJzLCBkYywgImtlZXAiLCBORVdfQ09M
X1NJWkVfU0xPUCwgbmV3X2NvbCk7CisgIG5vdGVfd2lkdGggKGhlYWRlcnMs
IGRjLCAidW5pbnN0YWxsIiwgTkVXX0NPTF9TSVpFX1NMT1AsIG5ld19jb2wp
OworCisgIGhlYWRlcnNbMF0ueCA9IEhNQVJHSU4vMjsKKyAgZm9yIChpID0g
MTsgaSA8PSBsYXN0X2NvbCA7IGkrKykKKyAgICBoZWFkZXJzW2ldLnggPSBo
ZWFkZXJzW2ktMV0ueCArIGhlYWRlcnNbaS0xXS53aWR0aCArICgoaSA9PSBu
ZXdfY29sKSA/IE5FV19DT0xfU0laRV9TTE9QIDogMCkgKyBITUFSR0lOOwor
OworfQorCit2b2lkCitfdmlldzo6aW5zZXJ0X3BrZyAoUGFja2FnZSAqcGtn
KQoreworICBwaWNrX2xpbmUgbGluZTsKKyAgbGluZS5zZXRfbGluZSAocGtn
KTsKKyAgaWYgKHZpZXdfbW9kZSAhPSBWSUVXX0NBVEVHT1JZKQorICAgIHsK
KyAgICAgIGlmIChsaW5lcyA9PSBOVUxMKQorICAgICAgICB7CisgICAgICAg
ICAgbGluZXMgPSAocGlja19saW5lICopIG1hbGxvYyAoKG5wYWNrYWdlcyAr
IG5jYXRlZ29yaWVzKSAqIHNpemVvZiAocGlja19saW5lKSk7CisgICAgICAg
ICAgbWVtc2V0IChsaW5lcywgJ1wwJywgKG5wYWNrYWdlcyArIG5jYXRlZ29y
aWVzKSAqIHNpemVvZiAocGlja19saW5lKSApOworCSAgbmxpbmVzID0gMDsK
KwkgIGluc2VydF9hdCAoMCwgbGluZSk7CisgICAgICAgIH0KKyAgICAgIGVs
c2UKKwlpbnNlcnRfdW5kZXIgKDAsIGxpbmUpOworICAgIH0KKyAgZWxzZQor
ICAgIHsKKy8vICAgICAgYXNzZXJ0IChsaW5lcyk7IC8qIHByb3RlY3QgYWdh
aW5zdCBhIGNvZGluZyBjaGFuZ2UgaW4gZnV0dXJlICovCisgICAgICBmb3Ig
KENhdGVnb3J5ICpjYXQgPSBwa2ctPmNhdGVnb3J5OyBjYXQ7IGNhdCA9IGNh
dC0+bmV4dCkKKwl7CisJICAvKiBpbnNlcnQgdGhlIHBhY2thZ2UgdW5kZXIg
dGhpcyBjYXRlZ29yeSBpbiB0aGUgbGlzdC4gSWYgdGhpcyBjYXRlZ29yeSBp
cyBub3QKKwkgICAgIHZpc2libGUsIGFkZCBpdCAqLworCSAgaW50IG49MDsK
KwkgIHdoaWxlIChuIDwgbmxpbmVzKQorCSAgICB7CisJICAgICAgLyogdGhp
cyBzaG91bGQgYmUgYSBnZW5lcmljIGNhbGwgdG8gbGlzdF9zb3J0X2NtcCAq
LworCSAgICAgIGlmIChsaW5lc1tuXS5nZXRfY2F0ZWdvcnkgKCkKKwkJICAm
JiBjYXQtPm5hbWUgPT0gbGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpLT5uYW1l
KQorCQkgIGluc2VydF91bmRlciAobiwgbGluZSk7CisJICAgICAgbisrOwor
CSAgICB9CisJICBpZiAobiA9PSBubGluZXMpCisJICAgIHsKKwkgICAgICAv
KiB0aGUgY2F0ZWdvcnkgd2Fzbid0IHZpc2libGUgLSBpbnNlcnQgYXQgdGhl
IGVuZCAqLworCSAgICAgIGluc2VydF9jYXRlZ29yeSAoY2F0LCBDQVRFR09S
WV9DT0xMQVBTRUQpOworCSAgICAgIGluc2VydF9wa2cgKHBrZyk7CisJICAg
IH0KKwl9CisgICAgfQorfQorCit2b2lkCitfdmlldzo6aW5zZXJ0X2NhdGVn
b3J5IChDYXRlZ29yeSAqY2F0LCBpbnQgY29sbGFwc2VkKQoreworICBwaWNr
X2xpbmUgbGluZTsKKyAgbGluZS5zZXRfbGluZSAoY2F0KTsKKyAgaWYgKGxp
bmVzID09IE5VTEwpCisgICAgeworICAgICAgbGluZXMgPSAocGlja19saW5l
ICopIG1hbGxvYyAoKG5wYWNrYWdlcyArIG5jYXRlZ29yaWVzKSAqIHNpemVv
ZiAocGlja19saW5lKSk7CisgICAgICBtZW1zZXQgKGxpbmVzLCAnXDAnLCAo
bnBhY2thZ2VzICsgbmNhdGVnb3JpZXMpICogc2l6ZW9mIChwaWNrX2xpbmUp
ICk7CisgICAgICBubGluZXMgPSAwOworICAgICAgaW5zZXJ0X2F0ICgwLCBs
aW5lKTsKKyAgICAgIGlmICghY29sbGFwc2VkKQorCWZvciAoQ2F0ZWdvcnlQ
YWNrYWdlICpjYXRwa2cgPSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBr
ZyA9IGNhdHBrZy0+bmV4dCkKKwkgIGluc2VydF9wa2cgKGdldHBrZ2J5bmFt
ZSAoY2F0cGtnLT5wa2cpKTsKKyAgICB9CisgIGVsc2UKKyAgICB7CisgICAg
ICBpbnQgbj0wOworICAgICAgd2hpbGUgKG4gPCBubGluZXMpCisgICAgICAg
IHsKKyAgICAgICAgICAvKiB0aGlzIHNob3VsZCBiZSBhIGdlbmVyaWMgY2Fs
bCB0byBsaXN0X3NvcnRfY21wICovCisgICAgICAgICAgaWYgKGxpbmVzW25d
LmdldF9jYXRlZ29yeSAoKQorICAgICAgICAgICAgICAmJiBzdHJjYXNlY21w
IChjYXQtPm5hbWUsIGxpbmVzW25dLmdldF9jYXRlZ29yeSAoKS0+bmFtZSkg
PCAwKQorICAgICAgICAgICAgeworCSAgICAgIGluc2VydF9hdCAobiwgbGlu
ZSk7CisJICAgICAgaWYgKCFjb2xsYXBzZWQpCisJCWZvciAoQ2F0ZWdvcnlQ
YWNrYWdlICpjYXRwa2cgPSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBr
ZyA9IGNhdHBrZy0+bmV4dCkKKwkJICBpbnNlcnRfcGtnIChnZXRwa2dieW5h
bWUgKGNhdHBrZy0+cGtnKSk7CisgICAgICAgICAgICAgIG4gPSBubGluZXM7
CisgICAgICAgICAgICB9CisgICAgICAgICAgZWxzZSBpZiAobGluZXNbbl0u
Z2V0X2NhdGVnb3J5ICgpID09IGNhdCkKKyAgICAgICAgICAgIG4gPSBubGlu
ZXM7CisgICAgICAgICAgbisrOworCisgICAgICAgIH0KKyAgICAgIGlmIChu
ID09IG5saW5lcykKKyAgICAgICAgeworICAgICAgICAgIC8qIGluc2VydCBh
dCB0aGUgZW5kICovCisJICBpbnNlcnRfYXQgKG4sIGxpbmUpOworCSAgaWYg
KCFjb2xsYXBzZWQpCisJICAgIGZvciAoQ2F0ZWdvcnlQYWNrYWdlICpjYXRw
a2cgPSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNhdHBrZy0+
bmV4dCkKKwkgICAgICBpbnNlcnRfcGtnIChnZXRwa2dieW5hbWUgKGNhdHBr
Zy0+cGtnKSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKKy8qIGluc2VydCBh
IG5ldyBsaW5lIGF0IGxpbmUgbiAqLwordm9pZAorX3ZpZXc6Omluc2VydF9h
dCAoaW50IG4sIHBpY2tfbGluZSBsaW5lKQoreworICBpZiAobiA8IDAgfHwg
biA+IG5saW5lcykKKyAgICByZXR1cm47CisgIG1lbW1vdmUgKCZsaW5lc1tu
ICsgMV0sICZsaW5lc1tuXSwgKG5saW5lcyAtIG4pICogc2l6ZW9mIChwaWNr
X2xpbmUpKTsKKyAgbGluZXNbbl0gPSBsaW5lOworICBubGluZXMrKzsKK30K
KworLyogaW5zZXJ0IGEgbmV3IGxpbmUgaW4gdGhlIGNob29zZXIsIGF0IHRo
ZSBuZXh0IGRlcHRoIGluIGZyb20gbGluZW4gKi8KK3ZvaWQKK192aWV3Ojpp
bnNlcnRfdW5kZXIgKGludCBsaW5lbiwgcGlja19saW5lIGxpbmUpCit7Cisg
IGludCBuOworICAvKiBzcGVjaWFsIGNhc2UgLSBlbXB0eSB2aWV3ICovCisg
IGlmIChubGluZXMgPT0gMCkKKyAgICB7CisgICAgICBpbnNlcnRfYXQgKDAs
IGxpbmUpOworICAgICAgcmV0dXJuOworICAgIH0KKyAgLyogcGFydCAxIC0g
ZmluZCB0aGUgYXBwcm9wcmlhdGUgYnVja2V0IGJlZ2lubmluZyAqLworICBp
ZiAobGluZXNbbGluZW5dLmdldF9jYXRlZ29yeSAoKSkKKyAgICB7CisgICAg
ICBuID0gbGluZW4gKyAxOworICAgIH0KKyAgZWxzZSBpZiAobGluZXNbbGlu
ZW5dLmdldF9wa2cgKCkpCisgICAgeworICAgICAgbiA9IGxpbmVuOworICAg
ICAgLyogd2FsayB1cCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBidWNrZXQg
Ki8KKyAgICAgIHdoaWxlIChuID4gMCAmJiBsaW5lc1tuIC0gMV0uZ2V0X3Br
ZyAoKSkKKwluLS07CisgICAgfQorICAvKiBwYXJ0IDIgLSBpbnNlcnQgaW4g
c29ydGVkIG9yZGVyIGluIHRoZSBidWNrZXQgKi8KKyAgd2hpbGUgKG4gPCBu
bGluZXMpCisgICAgeworICAgICAgaWYgKGxpbmVzW25dLmdldF9jYXRlZ29y
eSAoKSB8fCAobGluZXNbbl0uZ2V0X3BrZyAoKQorCSAgJiYgc3RyY2FzZWNt
cCAobGluZS5nZXRfcGtnICgpLT5uYW1lLCBsaW5lc1tuXS5nZXRfcGtnICgp
LT5uYW1lKSA8IDApKQorCXsKKwkgIGluc2VydF9hdCAobiwgbGluZSk7CisJ
ICBuID0gbmxpbmVzOworCX0KKyAgICAgIGVsc2UgaWYgKGxpbmVzW25dLmdl
dF9wa2cgKCkgPT0gbGluZS5nZXRfcGtnICgpKQorCXsKKwkgIG4gPSBubGlu
ZXM7CisJfQorICAgICAgbisrOworICAgIH0KKyAgaWYgKG4gPT0gbmxpbmVz
KQorICAgIHsKKyAgICAgIC8qIGluc2VydCBhdCB0aGUgZW5kIG9mIHRoaXMg
YnVja2V0ICovCisgICAgICBpbnNlcnRfYXQgKG4sIGxpbmUpOworICAgIH0K
K30KKwordm9pZAorX3ZpZXc6OmNsZWFyX3ZpZXcgKHZvaWQpCit7CisgIG5s
aW5lcyA9IDA7Cit9CisKK3N0YXRpYyB2aWV3cwordmlld3NwbHVzcGx1cyh2
aWV3cyB0aGV2aWV3KQoreworICBzd2l0Y2ggKHRoZXZpZXcpCisgICAgewor
ICAgIGNhc2UgVklFV19VTktOT1dOOiAgICAgIHJldHVybiBWSUVXX1BBQ0tB
R0VfRlVMTDsKKyAgICBjYXNlIFZJRVdfUEFDS0FHRV9GVUxMOiByZXR1cm4g
VklFV19QQUNLQUdFOworICAgIGNhc2UgVklFV19QQUNLQUdFOiAgICAgIHJl
dHVybiBWSUVXX0NBVEVHT1JZOworICAgIGNhc2UgVklFV19DQVRFR09SWTog
ICAgIHJldHVybiBOVklFVzsKKyAgICBkZWZhdWx0OiAgICAgICAgICAgICAg
ICByZXR1cm4gVklFV19VTktOT1dOOworICAgIH0KK30KKworaW50Citfdmll
dzo6Y2xpY2sgKGludCByb3csIGludCB4KQoreworICBpZiAocm93ID4gbmxp
bmVzKQorICAgIHJldHVybiAwOworICBpZiAobGluZXNbcm93XS5nZXRfcGtn
ICgpKQorICAgIHJldHVybiBsaW5lc1tyb3ddLmNsaWNrICh4KTsKKyAgZWxz
ZQorICAgIHsKKyAgICAgIC8qIGlmIHdlIGFyZSB0aGUgbGFzdCBsaW5lIG9y
IHRoZSBuZXh0IGxpbmUgaXMgYSBjYXRlZ29yeSB0b28sIGV4cGFuZCAqLwor
ICAgICAgaWYgKHJvdyA9PSAobmxpbmVzIC0xKSB8fCBsaW5lc1tyb3cgKyAx
XS5nZXRfY2F0ZWdvcnkgKCkpCisJeworCSAgaW50IGNvdW50ID0gbmxpbmVz
OworCSAgZm9yIChDYXRlZ29yeVBhY2thZ2UgKmNhdHBrZyA9IGxpbmVzW3Jv
d10uZ2V0X2NhdGVnb3J5ICgpLT5wYWNrYWdlczsgY2F0cGtnOyBjYXRwa2cg
PSBjYXRwa2ctPm5leHQpCisJICAgIHsKKwkgICAgICBQYWNrYWdlICogcGtn
ID0gZ2V0cGtnYnluYW1lIChjYXRwa2ctPnBrZyk7CisJICAgICAgaW50IG4g
PSByb3cgKyAxOworCSAgICAgIHBpY2tfbGluZSBsaW5lOworCSAgICAgIGxp
bmUuc2V0X2xpbmUgKHBrZyk7CisJICAgICAgLyogdGhpcyBpcyBhIG5hc3R5
IGhhY2suIEl0IHdpbGwgZ28gYXdheSB3aGVuIHRoZSBoaWVyYXJjaHkgaXMg
Y29kZWQgKi8KKwkgICAgICB3aGlsZSAobiA8IG5saW5lcykKKwkgICAgICAg
IHsKKwkJICBpZiAobGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpIHx8IChsaW5l
c1tuXS5nZXRfcGtnICgpCisJCSAgICAgICYmIHN0cmNhc2VjbXAgKHBrZy0+
bmFtZSwgbGluZXNbbl0uZ2V0X3BrZyAoKS0+bmFtZSkgPCAwKSkKKwkJICAg
IHsKKwkJICAgICAgaW5zZXJ0X2F0IChuLCBsaW5lKTsKKwkJICAgICAgbiA9
IG5saW5lczsKKwkJICAgIH0KKwkJICBlbHNlIGlmIChsaW5lc1tuXS5nZXRf
cGtnICgpID09IHBrZykKKwkJICAgIHsKKwkJICAgICAgbiA9IG5saW5lczsK
KwkJICAgIH0KKwkJICBuKys7CisJCX0KKwkgICAgICBpZiAobiA9PSBubGlu
ZXMpCisJCXsKKwkJICAvKiBpbnNlcnQgYXQgdGhlIGVuZCBvZiB0aGlzIGNh
dGVnb3J5ICovCisJCSAgaW5zZXJ0X2F0IChuLCBsaW5lKTsKKwkJICBuPW5s
aW5lcyArIDE7CisJCX0KKwkgICAgfQorCSAgcmV0dXJuIG5saW5lcyAtIGNv
dW50OworCX0KKyAgICAgIGVsc2UKKwkvKiBjb250cmFjdCAqLworCXsKKwkg
IGludCBjb3VudCA9IDAsIG4gPSByb3cgKyAxOworCSAgd2hpbGUgKG4gPCBu
bGluZXMgJiEgbGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpKQorCSAgICB7CisJ
ICAgICAgbWVtbW92ZSAoJmxpbmVzW25dLCAmbGluZXNbbiArIDFdLCAobmxp
bmVzIC0gbikgKiBzaXplb2YgKHBpY2tfbGluZSkpOworCSAgICAgIG5saW5l
cy0tOworCSAgICAgIGNvdW50Kys7CisJICAgIH0KKwkgIHJldHVybiBjb3Vu
dDsKKwl9CisgICAgfQorfQogCi0gIGlmIChwYWNrYWdlX2luZGV4ZXMgPT0g
MCkKLSAgICBwYWNrYWdlX2luZGV4ZXMgPSAoaW50ICopIG1hbGxvYyAobnBh
Y2thZ2VzICogc2l6ZW9mIChpbnQpKTsKIAotICBuaW5kZXhlcyA9IDA7Citz
dGF0aWMgdm9pZAorc2V0X3ZpZXdfbW9kZSAoSFdORCBoLCB2aWV3cyBtb2Rl
KQoreworICBpbnQgaTsKKyAgY2hvb3Nlci0+c2V0X3ZpZXdfbW9kZSAobW9k
ZSk7CisKKyAgY2hvb3Nlci0+Y2xlYXJfdmlldyAoKTsKICAgZm9yIChQYWNr
YWdlICpwa2cgPSBwYWNrYWdlOyBwa2ctPm5hbWU7IHBrZysrKQogICAgIGlm
ICghcGtnLT5leGNsdWRlKQogICAgICAgewotCXNldF9hY3Rpb24gKHBrZywg
MCk7Ci0JaWYgKGlzZnVsbCB8fCAhaXNfZnVsbF9hY3Rpb24gKHBrZykpCi0J
ICBwYWNrYWdlX2luZGV4ZXNbbmluZGV4ZXMrK10gPSBwa2cgLSBwYWNrYWdl
OworICAgICAgICBzZXRfYWN0aW9uIChwa2csIDApOwogICAgICAgfQogCisg
IHN3aXRjaCAoY2hvb3Nlci0+Z2V0X3ZpZXdfbW9kZSAoKSkKKyAgICB7Cisg
ICAgY2FzZSBWSUVXX1BBQ0tBR0U6CisgICAgICBmb3IgKFBhY2thZ2UgKnBr
ZyA9IHBhY2thZ2U7IHBrZy0+bmFtZTsgcGtnKyspCisJaWYgKCFwa2ctPmV4
Y2x1ZGUgJiYgaXNfZG93bmxvYWRfYWN0aW9uIChwa2cpKSAKKwkgIGNob29z
ZXItPmluc2VydF9wa2cgKHBrZyk7IAorICAgICAgYnJlYWs7CisgICAgY2Fz
ZSBWSUVXX1BBQ0tBR0VfRlVMTDoKKyAgICAgIGZvciAoUGFja2FnZSAqcGtn
ID0gcGFja2FnZTsgcGtnLT5uYW1lOyBwa2crKykKKwlpZiAoIXBrZy0+ZXhj
bHVkZSkgCisJICBjaG9vc2VyLT5pbnNlcnRfcGtnIChwa2cpOyAKKyAgICAg
IGJyZWFrOworICAgIGNhc2UgVklFV19DQVRFR09SWToKKyAgICAgIC8qIHN0
YXJ0IGNvbGxhcHNlZC4gVE9ETzogbWFrZSB0aGlzIGEgY2hvb3NlciBmbGFn
ICovCisgICAgICBmb3IgKENhdGVnb3J5ICpjYXQgPSBjYXRlZ29yeTsgY2F0
OyBjYXQgPSBjYXQtPm5leHQpCisJY2hvb3Nlci0+aW5zZXJ0X2NhdGVnb3J5
IChjYXQsIENBVEVHT1JZX0NPTExBUFNFRCk7CisgICAgICBicmVhazsKKyAg
ICBkZWZhdWx0OgorICAgICAgYnJlYWs7CisgICAgfQorCiAgIFJFQ1QgcjsK
ICAgR2V0Q2xpZW50UmVjdCAoaCwgJnIpOwogICBTQ1JPTExJTkZPIHNpOwpA
QCAtNTI4LDExICs5OTQsMTEgQEAgc2V0X2Z1bGxfbGlzdCAoSFdORCBoLCBp
bnQgaXNmdWxsKQogICBzaS5jYlNpemUgPSBzaXplb2YgKHNpKTsKICAgc2ku
Zk1hc2sgPSBTSUZfQUxMOwogICBzaS5uTWluID0gMDsKLSAgc2kubk1heCA9
IGhlYWRlcnNbMl0ueCArIGhlYWRlcnNbMl0ud2lkdGggKyBITUFSR0lOOwor
ICBzaS5uTWF4ID0gY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5sYXN0X2Nv
bF0ueCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+bGFzdF9jb2xdLndp
ZHRoICsgSE1BUkdJTjsKICAgc2kublBhZ2UgPSByLnJpZ2h0OwogICBTZXRT
Y3JvbGxJbmZvIChoLCBTQl9IT1JaLCAmc2ksIFRSVUUpOwogCi0gIHNpLm5N
YXggPSBuaW5kZXhlcyAqIHJvd19oZWlnaHQ7CisgIHNpLm5NYXggPSBjaG9v
c2VyLT5ubGluZXMgKiByb3dfaGVpZ2h0OwogICBzaS5uUGFnZSA9IHIuYm90
dG9tIC0gaGVhZGVyX2hlaWdodDsKICAgU2V0U2Nyb2xsSW5mbyAoaCwgU0Jf
VkVSVCwgJnNpLCBUUlVFKTsKIApAQCAtNTU5LDEwICsxMDI1LDYgQEAgY3Jl
YXRlX2xpc3R2aWV3IChIV05EIGRsZywgUkVDVCAqcikKIAkJICAgICAgIGhp
bnN0YW5jZSwKIAkJICAgICAgIDApOwogICBTaG93V2luZG93IChsdiwgU1df
U0hPVyk7Ci0KLSAgZm9yIChpID0gMDsgaGVhZGVyc1tpXS50ZXh0OyBpKysp
Ci0gICAgaGVhZGVyc1tpXS53aWR0aCA9IDA7Ci0KICAgSERDIGRjID0gR2V0
REMgKGx2KTsKICAgc3lzZm9udCA9IEdldFN0b2NrT2JqZWN0IChERUZBVUxU
X0dVSV9GT05UKTsKICAgU2VsZWN0T2JqZWN0IChkYywgc3lzZm9udCk7CkBA
IC01NzYsMzIgKzEwMzgsMTQgQEAgY3JlYXRlX2xpc3R2aWV3IChIV05EIGRs
ZywgUkVDVCAqcikKICAgaWYgKHJvd19oZWlnaHQgPCBpcmgpCiAgICAgcm93
X2hlaWdodCA9IGlyaDsKIAotICBmb3IgKGkgPSAwOyBoZWFkZXJzW2ldLnRl
eHQ7IGkrKykKLSAgICBub3RlX3dpZHRoIChkYywgaGVhZGVyc1tpXS50ZXh0
LCAwLCBpKTsKLSAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdlOyBwa2ct
Pm5hbWU7IHBrZysrKQotICAgIHsKLSAgICAgIGlmIChwa2ctPmluc3RhbGxl
ZCkKLQl7Ci0JICBub3RlX3dpZHRoIChkYywgcGtnLT5pbnN0YWxsZWQtPnZl
cnNpb24sIDAsIENVUlJFTlRfQ09MKTsKLQkgIG5vdGVfd2lkdGggKGRjLCBw
a2ctPmluc3RhbGxlZC0+dmVyc2lvbiwgTkVXX0NPTF9TSVpFX1NMT1AsIE5F
V19DT0wpOwotCX0KLSAgICAgIGZvciAoSW5mbyAqaW5mID0gcGtnLT5pbmZv
c2NhbjsgaW5mIDwgcGtnLT5pbmZvZW5kOyBpbmYrKykKLQlub3RlX3dpZHRo
IChkYywgaW5mLT52ZXJzaW9uLCBORVdfQ09MX1NJWkVfU0xPUCwgTkVXX0NP
TCk7Ci0gICAgICBub3RlX3dpZHRoIChkYywgcGtnLT5uYW1lLCAwLCBQQUNL
QUdFX0NPTCk7Ci0gICAgICBub3RlX3dpZHRoIChkYywgcGtnLT5zZGVzYywg
MCwgUEFDS0FHRV9DT0wpOwotICAgIH0KLSAgbm90ZV93aWR0aCAoZGMsICJr
ZWVwIiwgTkVXX0NPTF9TSVpFX1NMT1AsIE5FV19DT0wpOwotICBub3RlX3dp
ZHRoIChkYywgInVuaW5zdGFsbCIsIE5FV19DT0xfU0laRV9TTE9QLCBORVdf
Q09MKTsKLQotICBoZWFkZXJzW0NVUlJFTlRfQ09MXS54ID0gSE1BUkdJTi8y
OwotICBoZWFkZXJzW05FV19DT0xdLnggPSBoZWFkZXJzW0NVUlJFTlRfQ09M
XS54ICsgaGVhZGVyc1tDVVJSRU5UX0NPTF0ud2lkdGggKwotICAgIE5FV19D
T0xfU0laRV9TTE9QICsgSE1BUkdJTjsKLSAgaGVhZGVyc1tTUkNfQ09MXS54
ID0gaGVhZGVyc1tORVdfQ09MXS54ICsgaGVhZGVyc1tORVdfQ09MXS53aWR0
aCArIEhNQVJHSU47Ci0gIGhlYWRlcnNbUEFDS0FHRV9DT0xdLnggPSBoZWFk
ZXJzW1NSQ19DT0xdLnggKyBoZWFkZXJzW1NSQ19DT0xdLndpZHRoICsKLSAg
ICBITUFSR0lOOworICBjaG9vc2VyID0gbmV3ICh2aWV3KSAoVklFV19DQVRF
R09SWSwgZGMpOwogCiAgIGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9DVVJS
KTsKLSAgc2V0X2Z1bGxfbGlzdCAobHYsIGZ1bGxfbGlzdCk7CisgIHNldF92
aWV3X21vZGUgKGx2LCBWSUVXX1BBQ0tBR0UpOworICBpZiAoIVNldERsZ0l0
ZW1UZXh0IChkbGcsIElEQ19DSE9PU0VfVklFV0NBUFRJT04sIGNob29zZXIt
Pm1vZGVfY2FwdGlvbigpKSkKKyAgICBsb2cgKExPR19CQUJCTEUsICJGYWls
ZWQgdG8gc2V0IFZpZXcgYnV0dG9uIGNhcHRpb24gJWQiLCBHZXRMYXN0RXJy
b3IoKSApOworICBmb3IgKFBhY2thZ2UgKmZvbyA9IHBhY2thZ2U7IGZvby0+
bmFtZTsgZm9vKyspCisgICAgYWRkX3JlcXVpcmVkKGZvbyk7CiAgIHN0YXRp
YyBpbnQgdGFbXSA9IHsgSURDX0NIT09TRV9DVVJSLCAwIH07CiAgIHJic2V0
IChkbGcsIHRhLCBJRENfQ0hPT1NFX0NVUlIpOwogCkBAIC02MTUsMTggKzEw
NTksMjYgQEAgZGlhbG9nX2NtZCAoSFdORCBoLCBpbnQgaWQsIEhXTkQgaHdu
ZGN0bAogICAgIHsKICAgICBjYXNlIElEQ19DSE9PU0VfUFJFVjoKICAgICAg
IGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9QUkVWKTsKLSAgICAgIHNldF9m
dWxsX2xpc3QgKGx2LCBmdWxsX2xpc3QpOworICAgICAgZm9yIChQYWNrYWdl
ICpmb28gPSBwYWNrYWdlOyBmb28tPm5hbWU7IGZvbysrKQorICAgICAgICBh
ZGRfcmVxdWlyZWQoZm9vKTsKKyAgICAgIHNldF92aWV3X21vZGUgKGx2LCBj
aG9vc2VyLT5nZXRfdmlld19tb2RlICgpKTsKICAgICAgIGJyZWFrOwogICAg
IGNhc2UgSURDX0NIT09TRV9DVVJSOgogICAgICAgZGVmYXVsdF90cnVzdCAo
bHYsIFRSVVNUX0NVUlIpOwotICAgICAgc2V0X2Z1bGxfbGlzdCAobHYsIGZ1
bGxfbGlzdCk7CisgICAgICBmb3IgKFBhY2thZ2UgKmZvbyA9IHBhY2thZ2U7
IGZvby0+bmFtZTsgZm9vKyspCisgICAgICAgIGFkZF9yZXF1aXJlZChmb28p
OworICAgICAgc2V0X3ZpZXdfbW9kZSAobHYsIGNob29zZXItPmdldF92aWV3
X21vZGUgKCkpOwogICAgICAgYnJlYWs7CiAgICAgY2FzZSBJRENfQ0hPT1NF
X0VYUDoKICAgICAgIGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9URVNUKTsK
LSAgICAgIHNldF9mdWxsX2xpc3QgKGx2LCBmdWxsX2xpc3QpOworICAgICAg
Zm9yIChQYWNrYWdlICpmb28gPSBwYWNrYWdlOyBmb28tPm5hbWU7IGZvbysr
KQorICAgICAgICBhZGRfcmVxdWlyZWQoZm9vKTsKKyAgICAgIHNldF92aWV3
X21vZGUgKGx2LCBjaG9vc2VyLT5nZXRfdmlld19tb2RlICgpKTsKICAgICAg
IGJyZWFrOwotICAgIGNhc2UgSURDX0NIT09TRV9GVUxMUEFSVDoKLSAgICAg
IHNldF9mdWxsX2xpc3QgKGx2LCAhZnVsbF9saXN0KTsKKyAgICBjYXNlIElE
Q19DSE9PU0VfVklFVzoKKyAgICAgIHNldF92aWV3X21vZGUgKGx2LCB2aWV3
c3BsdXNwbHVzIChjaG9vc2VyLT5nZXRfdmlld19tb2RlICgpKSk7CisgICAg
ICBpZiAoIVNldERsZ0l0ZW1UZXh0IChoLCBJRENfQ0hPT1NFX1ZJRVdDQVBU
SU9OLCBjaG9vc2VyLT5tb2RlX2NhcHRpb24oKSkpCisJbG9nIChMT0dfQkFC
QkxFLCAiRmFpbGVkIHRvIHNldCBWaWV3IGJ1dHRvbiBjYXB0aW9uICVkIiwg
R2V0TGFzdEVycm9yKCkgKTsKICAgICAgIGJyZWFrOwogCiAgICAgY2FzZSBJ
RE9LOgpAQCAtODA0LDYgKzEyNTYsMjggQEAgZ2V0cGtnYnluYW1lIChjb25z
dCBjaGFyICpwa2duYW1lKQogICByZXR1cm4gTlVMTDsKIH0KIAorLyogUmV0
dXJuIGEgcG9pbnRlciB0byBhIGNhdGVnb3J5IGdpdmVuIHRoZSBuYW1lLiAq
LworQ2F0ZWdvcnkgKgorZ2V0Y2F0ZWdvcnlieW5hbWUgKGNvbnN0IGNoYXIg
KmNhdGVnb3J5bmFtZSkKK3sKKyAgZm9yIChDYXRlZ29yeSAqY2F0ID0gY2F0
ZWdvcnk7IGNhdDsgY2F0PWNhdC0+bmV4dCkKKyAgICBpZiAoc3RyY2FzZWNt
cCAoY2F0LT5uYW1lLCBjYXRlZ29yeW5hbWUpID09IDApCisgICAgICByZXR1
cm4gY2F0OworCisgIHJldHVybiBOVUxMOworfQorCisvKiBSZXR1cm4gYSBw
b2ludGVyIHRvIGEgY2F0ZWdvcnkgb2YgYSBnaXZlbiBwYWNrYWdlIGdpdmVu
IHRoZSBuYW1lLiAqLworQ2F0ZWdvcnkgKgorZ2V0cGFja2FnZWNhdGVnb3J5
YnluYW1lIChQYWNrYWdlICpwa2csIGNvbnN0IGNoYXIgKmNhdGVnb3J5bmFt
ZSkKK3sKKyAgZm9yIChDYXRlZ29yeSAqY2F0ID0gcGtnLT5jYXRlZ29yeTsg
Y2F0OyBjYXQgPSBjYXQtPm5leHQpCisgICAgaWYgKHN0cmNhc2VjbXAgKGNh
dC0+bmFtZSwgY2F0ZWdvcnluYW1lKSA9PSAwKQorICAgICAgcmV0dXJuIGNh
dDsKKworICByZXR1cm4gTlVMTDsKK30KKwogc3RhdGljIHZvaWQKIHNjYW4y
IChjaGFyICpwYXRoLCB1bnNpZ25lZCBpbnQgc2l6ZSkKIHsKQEAgLTkzNiw3
ICsxNDEwLDcgQEAgcGFja2FnZV9zb3J0IChjb25zdCB2b2lkICp2YSwgY29u
c3Qgdm9pZAogewogICBQYWNrYWdlICphID0gKFBhY2thZ2UgKil2YTsKICAg
UGFja2FnZSAqYiA9IChQYWNrYWdlICopdmI7Ci0gIHJldHVybiBzdHJjbXAg
KGEtPm5hbWUsIGItPm5hbWUpOworICByZXR1cm4gc3RyY2FzZWNtcCAoYS0+
bmFtZSwgYi0+bmFtZSk7CiB9CiAKIHZvaWQKQEAgLTk0NiwxNSArMTQyMCwx
NSBAQCBkb19jaG9vc2UgKEhJTlNUQU5DRSBoKQogCiAgIG5leHRidXR0b24g
PSAwOwogICBibV9zcGluID0gTG9hZEltYWdlIChoLCBNQUtFSU5UUkVTT1VS
Q0UgKElEQl9TUElOKSwgSU1BR0VfQklUTUFQLCAwLCAwLCAwKTsKLSAgYm1f
cnRhcnJvdyA9IExvYWRJbWFnZSAoaCwgTUFLRUlOVFJFU09VUkNFIChJREJf
UlRBUlJPVyksIElNQUdFX0JJVE1BUCwKLQkJCSAgMCwgMCwgMCk7CisgIGJt
X3J0YXJyb3cgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRSRVNPVVJDRSAoSURC
X1JUQVJST1cpLCBJTUFHRV9CSVRNQVAsIAorICAJCQkgIDAsIDAsIDApOwog
CiAgIGJtX2NoZWNreWVzID0gTG9hZEltYWdlIChoLCBNQUtFSU5UUkVTT1VS
Q0UgKElEQl9DSEVDS19ZRVMpLCBJTUFHRV9CSVRNQVAsCi0JCQkgICAwLCAw
LCAwKTsKKyAgCQkJICAgMCwgMCwgMCk7CiAgIGJtX2NoZWNrbm8gPSBMb2Fk
SW1hZ2UgKGgsIE1BS0VJTlRSRVNPVVJDRSAoSURCX0NIRUNLX05PKSwgSU1B
R0VfQklUTUFQLAotCQkJICAwLCAwLCAwKTsKKyAgCQkJICAgMCwgMCwgMCk7
CiAgIGJtX2NoZWNrbmEgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRSRVNPVVJD
RSAoSURCX0NIRUNLX05BKSwgSU1BR0VfQklUTUFQLAotCQkJICAwLCAwLCAw
KTsKKyAgCQkJICAgMCwgMCwgMCk7CiAKICAgcmVnaXN0ZXJfd2luZG93cyAo
aCk7CiAKQEAgLTk2Myw2ICsxNDM3LDcgQEAgZG9fY2hvb3NlIChISU5TVEFO
Q0UgaCkKIAogICByZWFkX2luc3RhbGxlZF9kYiAoKTsKICAgc2V0X2V4aXN0
ZW5jZSAoKTsKKyAgZmlsbF9taXNzaW5nX2NhdGVnb3J5ICgpOwogCiAgIHFz
b3J0IChwYWNrYWdlLCBucGFja2FnZXMsIHNpemVvZiAocGFja2FnZVswXSks
IHBhY2thZ2Vfc29ydCk7CiAKQEAgLTk4NiwyNCArMTQ2MSwyNCBAQCBkb19j
aG9vc2UgKEhJTlNUQU5DRSBoKQogCQkJICAgICAgIDogInVua25vd24iKTsK
ICAgICAgIGNvbnN0IGNoYXIgKmV4Y2x1ZGVkID0gKHBrZy0+ZXhjbHVkZSA/
ICJ5ZXMiIDogIm5vIik7CiAKLSAgICAgIGxvZyAoTE9HX0JBQkJMRSwKLQkg
ICAiWyVzXSBhY3Rpb249JXMgdHJ1c3Q9JXMgaW5zdGFsbGVkPSVzIGV4Y2x1
ZGVkPSVzIHNyYz89JXMiLAorICAgICAgbG9nIChMT0dfQkFCQkxFLCAiWyVz
XSBhY3Rpb249JXMgdHJ1c3Q9JXMgaW5zdGFsbGVkPSVzIGV4Y2x1ZGVkPSVz
IHNyYz89JXMiCisJICAgImNhdGVnb3J5PSVzIiwKIAkgICBwa2ctPm5hbWUs
IGFjdGlvbiwgdHJ1c3QsIGluc3RhbGxlZCwKLQkgICBleGNsdWRlZCwgcGtn
LT5zcmNwaWNrZWQgPyAieWVzIiA6ICJubyIpOworCSAgIGV4Y2x1ZGVkLCBw
a2ctPnNyY3BpY2tlZCA/ICJ5ZXMiIDogIm5vIiwgcGtnLT5jYXRlZ29yeSk7
CiAgICAgICBmb3IgKGludCB0ID0gMTsgdCA8IE5UUlVTVDsgdCsrKQogCXsK
IAkgIGlmIChwa2ctPmluZm9bdF0uaW5zdGFsbCkKLQkgICAgbG9nIChMT0df
QkFCQkxFLCAiICAgICBbJXNdIHZlcj0lc1xuIgotCQkJICAgICAiICAgICAg
ICAgIGluc3Q9JXMgJWQgZXhpc3RzPSVzXG4iCi0JCQkgICAgICIgICAgICAg
ICAgc3JjPSVzICVkIGV4aXN0cz0lcyIsCisJICAgIGxvZyAoTE9HX0JBQkJM
RSwgIiAgICAgWyVzXSB2ZXI9JXNcclxuIgorCQkJICAgICAiICAgICAgICAg
IGluc3Q9JXMgJWQgZXhpc3RzPSVzXHJcbiIKKwkJCSAgICAgIgkJc3JjPSVz
ICVkIGV4aXN0cz0lcyIsCiAJCSBpbmZvc1t0XSwKIAkJIHBrZy0+aW5mb1t0
XS52ZXJzaW9uID86ICIobm9uZSkiLAogCQkgcGtnLT5pbmZvW3RdLmluc3Rh
bGwgPzogIihub25lKSIsCiAJCSBwa2ctPmluZm9bdF0uaW5zdGFsbF9zaXpl
LAotCQkgKHBrZy0+aW5mb1t0XS5pbnN0YWxsX2V4aXN0cykgPyAieWVzIiA6
ICJubyIsCisJCSAocGtnLT5pbmZvW3RdLmluc3RhbGxfZXhpc3RzKSA/ICJ5
ZXMiOiJubyIsCiAJCSBwa2ctPmluZm9bdF0uc291cmNlID86ICIobm9uZSki
LAogCQkgcGtnLT5pbmZvW3RdLnNvdXJjZV9zaXplLAotCQkgKHBrZy0+aW5m
b1t0XS5zb3VyY2VfZXhpc3RzKSA/ICJ5ZXMiIDogIm5vIik7CisJCSAocGtn
LT5pbmZvW3RdLnNvdXJjZV9leGlzdHMgPT0gMSkgPyAieWVzIjoibm8iKTsK
IAl9CiAgICAgfQogfQpJbmRleDogaW5pLmgKPT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQpSQ1MgZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jaW5zdGFsbC9p
bmkuaCx2CnJldHJpZXZpbmcgcmV2aXNpb24gMi4xMwpkaWZmIC11IC1wIC1y
Mi4xMyBpbmkuaAotLS0gaW5pLmgJMjAwMS8wNi8yNSAwNTo0ODozOAkyLjEz
CisrKyBpbmkuaAkyMDAxLzA2LzMwIDAwOjQ4OjIyCkBAIC0xMyw2ICsxMyw5
IEBACiAgKgogICovCiAKKyNpZm5kZWYgX0lOSV9IXworI2RlZmluZSBfSU5J
X0hfCisKIC8qIFdoZW4gc2V0dXAuaW5pIGlzIHBhcnNlZCwgdGhlIGluZm9y
bWF0aW9uIGlzIHN0b3JlZCBhY2NvcmRpbmcgdG8KICAgIHRoZSBkZWNsYXJh
dGlvbnMgaGVyZS4gIGluaS5jYyAodmlhIGluaWxleCBhbmQgaW5pcGFyc2Up
CiAgICBpbml0aWFsaXplcyB0aGVzZSBzdHJ1Y3R1cmVzLiAgY2hvb3NlLmNj
IHNldHMgdGhlIGFjdGlvbiBhbmQgdHJ1c3QKQEAgLTYyLDYgKzY1LDE1IEBA
IHR5cGVkZWYgZW51bQogICBFWENMVURFX05PVF9GT1VORAogfSBleGNsdWRl
czsKIAordHlwZWRlZiBlbnVtIAoreworICBWSUVXX1VOS05PV04sCisgIFZJ
RVdfUEFDS0FHRV9GVUxMLAorICBWSUVXX1BBQ0tBR0UsCisgIFZJRVdfQ0FU
RUdPUlksCisgIE5WSUVXCit9IHZpZXdzOworCiAjZGVmaW5lIGlzX2Rvd25s
b2FkX2FjdGlvbihwa2cpIFwKICAgKChwa2cpLT5hY3Rpb24gPT0gQUNUSU9O
X1BSRVYgfHwgXAogICAgKHBrZyktPmFjdGlvbiA9PSBBQ1RJT05fQ1VSUiB8
fCBcCkBAIC03OSwxMCArOTEsNiBAQCB0eXBlZGVmIGVudW0KICAgIChwa2cp
LT5hY3Rpb24gPT0gQUNUSU9OX1BSRVYgfHwgXAogICAgKHBrZyktPmFjdGlv
biA9PSBBQ1RJT05fVU5JTlNUQUxMKQogCi0jZGVmaW5lIGlzX2Z1bGxfYWN0
aW9uKHBrZykgXAotICAoKChwa2cpLT5hY3Rpb24gPj0gQUNUSU9OX1NBTUVf
UFJFViAmJiAocGtnKS0+YWN0aW9uIDw9IEFDVElPTl9TQU1FX1RFU1QpIFwK
LSAgIHx8IChwa2cpLT5hY3Rpb24gPT0gQUNUSU9OX1NLSVApCi0KICNkZWZp
bmUgU1JDQUNUSU9OX05PCQkwCiAjZGVmaW5lIFNSQ0FDVElPTl9ZRVMJCTEK
IHR5cGVkZWYgc3RydWN0IF9JbmZvCkBAIC0xMDEsNiArMTA5LDE5IEBAIHR5
cGVkZWYgc3RydWN0IF9JbmZvCiAjZW5kaWYKIH0gSW5mbzsJCQkvKiArMSBm
b3IgVFJVU1RfVU5LTk9XTiAqLwogCit0eXBlZGVmIHN0cnVjdCBfQ2F0ZWdv
cnlQYWNrYWdlCit7CisgIHN0cnVjdCBfQ2F0ZWdvcnlQYWNrYWdlICpuZXh0
OyAgLyogVGhlIG5leHQgcGFja2FnZSBwb2ludGVyIGluIHRoZSBsaXN0ICov
CisgIGNoYXIgKnBrZzsJCQkgIC8qIFRoaXMgc2hvdWxkIGJlIFBhY2thZ2Ug
KiwgYnV0IHRoZSBwYWNrYWdlcyBjYW4gbW92ZSovCit9IENhdGVnb3J5UGFj
a2FnZTsKKwordHlwZWRlZiBzdHJ1Y3QgX0NhdGVnb3J5Cit7CisgIHN0cnVj
dCBfQ2F0ZWdvcnkgKm5leHQ7IC8qIHRoZSBuZXh0IGNhdGVnb3J5IGluIHRo
ZSBsaXN0ICovCisgIGNoYXIgKm5hbWU7CQkgIC8qIHRoZSBjYXRlZ29yeSAq
LworICBDYXRlZ29yeVBhY2thZ2UgKnBhY2thZ2VzOyAvKiB0aGUgcGFja2Fn
ZXMgaW4gdGhpcyBjYXRlZ29yeSAqLworfSBDYXRlZ29yeTsKKwogdHlwZWRl
ZiBzdHJ1Y3QgX0RlcGVuZGVuY3kKIHsKICAgc3RydWN0IF9EZXBlbmRlbmN5
ICpuZXh0OyAvKiB0aGUgbmV4dCBwYWNrYWdlIGluIHRoaXMgZGVwZW5kZW5j
eSBsaXN0ICovCkBAIC0xMTIsNyArMTMzLDcgQEAgdHlwZWRlZiBzdHJ1Y3QK
ICAgY2hhciAqbmFtZTsJCS8qIHBhY2thZ2UgbmFtZSwgbGlrZSAiY3lnd2lu
IiAqLwogICBjaGFyICpzZGVzYzsJCS8qIHNob3J0IGRlc2NyaXB0aW9uIChy
ZXBsYWNlcyAibmFtZSIgaWYgcHJvdmlkZWQpICovCiAgIGNoYXIgKmxkZXNj
OwkJLyogbG9uZyBkZXNjcmlwdGlvbiAobXVsdGktbGluZSkgKi8KLSAgY2hh
ciAqY2F0ZWdvcnk7IC8qIHRoZSBjYXRlZ29yeSB0aGUgcGFja2FnZSBiZWxv
bmdzIHRvLCBsaWtlICJyZXF1aXJlZCIgb3IgIlhGcmVlODYiICovCisgIENh
dGVnb3J5ICpjYXRlZ29yeTsgICAvKiB0aGUgY2F0ZWdvcmllcyB0aGUgcGFj
a2FnZSBiZWxvbmdzIHRvICovIAogICBEZXBlbmRlbmN5ICpyZXF1aXJlZDsg
LyogdGhlIHBhY2thZ2VzIHJlcXVpcmVkIGZvciB0aGlzIHBhY2thZ2UgdG8g
d29yayAqLwogICBhY3Rpb25zIGFjdGlvbjsJLyogQSByYW5nZSBvZiBzdGF0
ZXMgYXBwbGljYWJsZSB0byB0aGlzIHBhY2thZ2UgKi8KICAgdHJ1c3RzIHRy
dXN0OwkJLyogU2VsZWN0cyBhbW9uZyBpbmZvW10gYmVsb3csIGEgc3Vic2V0
IG9mIGFjdGlvbiAqLwpAQCAtMTMzLDYgKzE1NCw4IEBAIHR5cGVkZWYgc3Ry
dWN0CiAKIGV4dGVybiBQYWNrYWdlICpwYWNrYWdlOwogZXh0ZXJuIGludCBu
cGFja2FnZXM7CitleHRlcm4gQ2F0ZWdvcnkgKmNhdGVnb3J5OworZXh0ZXJu
IGludCBuY2F0ZWdvcmllczsKIAogI2lmZGVmIF9fY3BsdXNwbHVzCiBleHRl
cm4gIkMiIHsKQEAgLTE0Miw3ICsxNjUsMTMgQEAgUGFja2FnZSAqbmV3X3Bh
Y2thZ2UgKGNoYXIgKm5hbWUpOwogdm9pZAlpbmlfaW5pdCAoY2hhciAqc3Ry
aW5nKTsKIFBhY2thZ2UgKmdldHBrZ2J5bmFtZSAoY29uc3QgY2hhciAqcGtn
bmFtZSk7CiB2b2lkICAgIG5ld19yZXF1aXJlbWVudCAoUGFja2FnZSAqcGFj
a2FnZSwgY2hhciAqZGVwZW5kc29uKTsKK0NhdGVnb3J5ICpnZXRjYXRlZ29y
eWJ5bmFtZSAoY29uc3QgY2hhciAqY2F0ZWdvcnluYW1lKTsKK0NhdGVnb3J5
ICpnZXRwYWNrYWdlY2F0ZWdvcnlieW5hbWUgKFBhY2thZ2UgKnBrZywgY29u
c3QgY2hhciAqY2F0ZWdvcnluYW1lKTsgCitDYXRlZ29yeSAqcmVnaXN0ZXJf
Y2F0ZWdvcnkgKGNoYXIgKm5hbWUpOwordm9pZCAgICBhZGRfY2F0ZWdvcnkg
KFBhY2thZ2UgKnBhY2thZ2UsIENhdGVnb3J5ICpjYXQpOwogCiAjaWZkZWYg
X19jcGx1c3BsdXMKIH0KICNlbmRpZgorCisjZW5kaWYgLyogX0lOSV9IXyAq
LwpJbmRleDogaW5pcGFyc2UueQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL2luaXBhcnNl
LnksdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuOQpkaWZmIC11IC1wIC1yMi45
IGluaXBhcnNlLnkKLS0tIGluaXBhcnNlLnkJMjAwMS8wNi8xNSAwNDowNToz
MQkyLjkKKysrIGluaXBhcnNlLnkJMjAwMS8wNi8zMCAwMDo0ODoyMgpAQCAt
ODYsNyArODYsOCBAQCBzaW1wbGVfbGluZQogIDogVkVSU0lPTiBTVFJJTkcJ
CXsgY3B0LT52ZXJzaW9uID0gJDI7IH0KICB8IFNERVNDIFNUUklORwkJCXsg
Y3AtPnNkZXNjID0gJDI7IH0KICB8IExERVNDIFNUUklORwkJCXsgY3AtPmxk
ZXNjID0gJDI7IH0KLSB8IENBVEVHT1JZIFNUUklORwkJeyBjcC0+Y2F0ZWdv
cnkgPSAkMjsgfQorIHwgQ0FURUdPUlkgU1RSSU5HCQl7IGFkZF9jYXRlZ29y
eSAoY3AsIHJlZ2lzdGVyX2NhdGVnb3J5ICgkMikpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB9CiAgfCBSRVFVSVJFUyByZXF1aXJlcwog
IHwgSU5TVEFMTCBTVFJJTkcgU1RSSU5HCXsgY3B0LT5pbnN0YWxsID0gJDI7
CiAJCQkJICBjcHQtPmluc3RhbGxfc2l6ZSA9IGF0b2koJDMpOwpAQCAtMTIx
LDExICsxMjIsMTMgQEAgcmVxdWlyZXMKIFBhY2thZ2UgKnBhY2thZ2UgPSBO
VUxMOwogaW50IG5wYWNrYWdlcyA9IDA7CiBzdGF0aWMgaW50IG1heHBhY2th
Z2VzID0gMDsKK0NhdGVnb3J5ICpjYXRlZ29yeSA9IE5VTEw7CitpbnQgbmNh
dGVnb3JpZXMgPSAwOwogCiBQYWNrYWdlICoKIG5ld19wYWNrYWdlIChjaGFy
ICpuYW1lKQogewotICBpZiAocGFja2FnZSA9PSAwKQorICBpZiAocGFja2Fn
ZSA9PSBOVUxMKQogICAgIG1heHBhY2thZ2VzID0gbnBhY2thZ2VzID0gMDsK
ICAgaWYgKG5wYWNrYWdlcyA+PSBtYXhwYWNrYWdlcykKICAgICB7CkBAIC0x
NDksNyArMTUyLDcgQEAgbmV3X3BhY2thZ2UgKGNoYXIgKm5hbWUpCiB9CiAK
IHZvaWQKLW5ld19yZXF1aXJlbWVudChQYWNrYWdlICpwYWNrYWdlLCBjaGFy
ICpkZXBlbmRzb24pCituZXdfcmVxdWlyZW1lbnQgKFBhY2thZ2UgKnBhY2th
Z2UsIGNoYXIgKmRlcGVuZHNvbikKIHsKICAgRGVwZW5kZW5jeSAqZHA7CiAg
IGlmICghZGVwZW5kc29uKQpAQCAtMTU4LDQgKzE2MSw1OCBAQCBuZXdfcmVx
dWlyZW1lbnQoUGFja2FnZSAqcGFja2FnZSwgY2hhciAqCiAgIGRwLT5uZXh0
ID0gY3AtPnJlcXVpcmVkOwogICBkcC0+cGFja2FnZSA9IGRlcGVuZHNvbjsK
ICAgY3AtPnJlcXVpcmVkID0gZHA7Cit9CisKK0NhdGVnb3J5ICoKK3JlZ2lz
dGVyX2NhdGVnb3J5IChjaGFyICpuYW1lKQoreworICBDYXRlZ29yeSAqdGVt
cGNhdDsKKyAgaWYgKGNhdGVnb3J5ID09IE5VTEwpCisgICAgbmNhdGVnb3Jp
ZXMgPSAwOworICB0ZW1wY2F0ID0gZ2V0Y2F0ZWdvcnlieW5hbWUgKG5hbWUp
OworICBpZiAoIXRlbXBjYXQpCisgICAgeworICAgICAgQ2F0ZWdvcnkgKnNv
cnRjYXQgPSBjYXRlZ29yeTsKKyAgICAgIHRlbXBjYXQgPSBuZXcgKENhdGVn
b3J5KTsKKyAgICAgIG1lbXNldCAodGVtcGNhdCwgJ1wwJywgc2l6ZW9mIChD
YXRlZ29yeSkpOworICAgICAgdGVtcGNhdC0+bmFtZSA9IHN0cmR1cCAobmFt
ZSk7CisgICAgICBpZiAoIXNvcnRjYXQgfHwgc3RyY2FzZWNtcChzb3J0Y2F0
LT5uYW1lLCBuYW1lKSA+IDApCisJeworCSAgdGVtcGNhdC0+bmV4dCA9IGNh
dGVnb3J5OworCSAgY2F0ZWdvcnkgPSB0ZW1wY2F0OworCX0KKyAgICAgIGVs
c2UKKwl7CisJICB3aGlsZSAoc29ydGNhdC0+bmV4dCAmJiAKKwkJIHN0cmNh
c2VjbXAoc29ydGNhdC0+bmV4dC0+bmFtZSwgdGVtcGNhdC0+bmFtZSkgPCAw
KQorCSAgICB7CisJICAgICAgdGVtcGNhdC0+bmV4dCA9IHNvcnRjYXQtPm5l
eHQ7CisJICAgICAgc29ydGNhdC0+bmV4dCA9IHRlbXBjYXQ7CisJICAgIH0K
Kwl9CisgICAgICBuY2F0ZWdvcmllcysrOworICAgIH0KKyAgcmV0dXJuIHRl
bXBjYXQ7Cit9CisKK3ZvaWQKK2FkZF9jYXRlZ29yeSAoUGFja2FnZSAqcGFj
a2FnZSwgQ2F0ZWdvcnkgKmNhdCkKK3sKKyAgLyogYWRkIGEgbmV3IHJlY29y
ZCBmb3IgdGhlIHBhY2thZ2UgbGlzdCAqLworICAvKiBUT0RPOiBhbHBhYmV0
aWNhbCBpbnNlcnRzID8gKi8KKyAgQ2F0ZWdvcnkgKnRlbXBjYXQ7CisgIENh
dGVnb3J5UGFja2FnZSAqdGVtcGxpbms7CisgIHRlbXBjYXQgPSBuZXcgKENh
dGVnb3J5KTsKKyAgbWVtc2V0ICh0ZW1wY2F0LCAnXDAnLCBzaXplb2YgKENh
dGVnb3J5KSk7CisgIHRlbXBjYXQtPm5leHQgPSBwYWNrYWdlLT5jYXRlZ29y
eTsKKyAgdGVtcGNhdC0+bmFtZSA9IGNhdC0+bmFtZTsKKyAgcGFja2FnZS0+
Y2F0ZWdvcnkgPSB0ZW1wY2F0OworCisgIHRlbXBsaW5rID0gbmV3IChDYXRl
Z29yeVBhY2thZ2UpOworICB0ZW1wbGluay0+bmV4dCA9IGNhdC0+cGFja2Fn
ZXM7CisgIHRlbXBsaW5rLT5wa2cgPSBwYWNrYWdlLT5uYW1lOworICBjYXQt
PnBhY2thZ2VzID0gdGVtcGxpbms7CisgCisgIC8qIGhhY2sgdG8gZW5zdXJl
IHdlIGFsbG9jYXRlIGVub3VnaCBzcGFjZSAqLworICBuY2F0ZWdvcmllcysr
OyAKIH0KSW5kZXg6IHJlcy5yYwo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL3Jlcy5yYyx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMi4yMApkaWZmIC11IC1wIC1yMi4yMCBy
ZXMucmMKLS0tIHJlcy5yYwkyMDAxLzA1LzI4IDA4OjMxOjAyCTIuMjAKKysr
IHJlcy5yYwkyMDAxLzA2LzMwIDAwOjQ4OjIzCkBAIC0yNDAsNyArMjQwLDgg
QEAgQkVHSU4KICAgICBDT05UUk9MICAgICAgICAgIlNQSU4iLElEQ19TVEFU
SUMsIlN0YXRpYyIsU1NfQklUTUFQLDU1LDE3MCwxNSwxMwogICAgIExURVhU
ICAgICAgICAgICAiPSBjbGljayB0byBjaG9vc2UgYWN0aW9uLCAocCkgPSBw
cmV2aW91cyB2ZXJzaW9uLCAoeCkgPSBleHBlcmltZW50YWwiLAogICAgICAg
ICAgICAgICAgICAgICBJRENfU1RBVElDLDY1LDE3MCwyMjAsOAotICAgIFBV
U0hCVVRUT04gICAgICAiRnVsbC9QYXJ0IixJRENfQ0hPT1NFX0ZVTExQQVJU
LDI4Myw1LDM1LDEwCisgICAgUFVTSEJVVFRPTiAgICAgICJWaWV3IixJRENf
Q0hPT1NFX1ZJRVcsMjc4LDUsMjAsMTAKKyAgICBMVEVYVCAgICAgICAgICAg
IiIsICAgSURDX0NIT09TRV9WSUVXQ0FQVElPTiwgMzAwLDUsMzAsMTAKICAg
ICBDT05UUk9MICAgICAgICAgIkUmeHAiLElEQ19DSE9PU0VfRVhQLCJCdXR0
b24iLEJTX0FVVE9SQURJT0JVVFRPTiB8IAogICAgICAgICAgICAgICAgICAg
ICBXU19HUk9VUCwyNDgsNSwyNSwxMAogICAgIENPTlRST0wgICAgICAgICAi
JkN1cnIiLElEQ19DSE9PU0VfQ1VSUiwiQnV0dG9uIixCU19BVVRPUkFESU9C
VVRUT04sMjIyLApJbmRleDogcmVzb3VyY2UuaAo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxs
L3Jlc291cmNlLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuMTEKZGlmZiAt
dSAtcCAtcjIuMTEgcmVzb3VyY2UuaAotLS0gcmVzb3VyY2UuaAkyMDAxLzA1
LzI4IDA4OjMxOjAyCTIuMTEKKysrIHJlc291cmNlLmgJMjAwMS8wNi8zMCAw
MDo0ODoyMwpAQCAtODQsNyArODQsNyBAQAogI2RlZmluZSBJRENfTkVUX1BB
U1NXRCAgICAgICAgICAgICAgICAgIDEwMzEKICNkZWZpbmUgSURDX1ZFUlNJ
T04gICAgICAgICAgICAgICAgICAgICAxMDMzCiAjZGVmaW5lIElEQ19MSVNU
VklFV19QT1MgICAgICAgICAgICAgICAgMTAzNAotI2RlZmluZSBJRENfQ0hP
T1NFX0ZVTExQQVJUICAgICAgICAgICAgIDEwMzUKKyNkZWZpbmUgSURDX0NI
T09TRV9WSUVXICAgICAgICAgICAgICAgICAxMDM1CiAjZGVmaW5lIElEQ19D
SE9PU0VfRVhQICAgICAgICAgICAgICAgICAgMTAzNgogI2RlZmluZSBJRENf
Q0hPT1NFX0NVUlIgICAgICAgICAgICAgICAgIDEwMzcKICNkZWZpbmUgSURD
X0NIT09TRV9QUkVWICAgICAgICAgICAgICAgICAxMDM4CkBAIC0xMDAsNiAr
MTAwLDcgQEAKICNkZWZpbmUgSURDX0RMU19QUFJPR1JFU1NfVEVYVCAgICAg
ICAgICAxMDQ4CiAjZGVmaW5lIElEQ19ETFNfSVBST0dSRVNTX1RFWFQgICAg
ICAgICAgMTA0OQogI2RlZmluZSBJRENfQ0hPT1NFX0lOU1RfVEVYVCAgICAg
IDEwNTAKKyNkZWZpbmUgSURDX0NIT09TRV9WSUVXQ0FQVElPTiAgICAgICAg
ICAxMDUxCiAjZGVmaW5lIElEQ19TVEFUSUMgICAgICAgICAgICAgICAgICAg
ICAgLTEKIAogLy8gTmV4dCBkZWZhdWx0IHZhbHVlcyBmb3IgbmV3IG9iamVj
dHMKQEAgLTExMCw3ICsxMTEsNyBAQAogI2RlZmluZSBfQVBTXzNEX0NPTlRS
T0xTICAgICAgICAgICAgICAgICAgICAgMQogI2RlZmluZSBfQVBTX05FWFRf
UkVTT1VSQ0VfVkFMVUUgICAgICAgIDEyNwogI2RlZmluZSBfQVBTX05FWFRf
Q09NTUFORF9WQUxVRSAgICAgICAgIDQwMDAzCi0jZGVmaW5lIF9BUFNfTkVY
VF9DT05UUk9MX1ZBTFVFICAgICAgICAgMTA1MQorI2RlZmluZSBfQVBTX05F
WFRfQ09OVFJPTF9WQUxVRSAgICAgICAgIDEwNTIKICNkZWZpbmUgX0FQU19O
RVhUX1NZTUVEX1ZBTFVFICAgICAgICAgICAxMDEKICNlbmRpZgogI2VuZGlm
Cg==

------------=_1583532848-65438-83--
