From: "Robert Collins" <robert.collins@itdomain.com.au>
To: "Robert Collins" <robert.collins@itdomain.com.au>, <cygwin-developers@sources.redhat.com>, <cygwin-patches@cygwin.com>
Subject: Re: hierarchy in setup (category stuff)
Date: Sat, 23 Jun 2001 18:59:00 -0000
Message-id: <06a001c0fc51$7a87e210$0200a8c0@lifelesswks>
References: <04e801c0faa2$f9008260$0200a8c0@lifelesswks> <20010621222615.C13746@redhat.com> <3B3324A7.49FFC98A@yahoo.com> <054c01c0fbef$5f600e20$0200a8c0@lifelesswks>
X-SW-Source: 2001-q2/msg00329.html
Content-type: multipart/mixed; boundary="----------=_1583532848-65438-78"

This is a multi-part message in MIME format...

------------=_1583532848-65438-78
Content-length: 557

----- Original Message -----
From: "Robert Collins" <robert.collins@itdomain.com.au>


>
> I've attached my current sandbox changes. The code _is not finished_.
(I
> am _looking_ at adding the prev/curr/exp capability to whole
categories
> as well as the code cleanliness I mention below).
>

Still not 100%, but much cleaner and easier to read:

Known bugs:
1) The partial view when you enter the package list has a scroll bar one
line too many long.
2) The category view always shows _all_ packages. There's no
category-partial view. Do we need one?

Rob

------------=_1583532848-65438-78
Content-Type: text/x-c++; charset=us-ascii; name="choose.h"
Content-Disposition: inline; filename="choose.h"
Content-Transfer-Encoding: base64
Content-Length: 2347

LyoKICogQ29weXJpZ2h0IChjKSAyMDAwLCBSZWQgSGF0LCBJbmMuCiAqCiAq
ICAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogKiAgICAgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBh
cyBwdWJsaXNoZWQgYnkKICogICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5k
YXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCiAq
ICAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgog
KiAgICAgQSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZSBjYW4gYmUgZm91bmQgYXQKICogICAgIGh0dHA6Ly93d3cuZ251Lm9yZy8K
ICoKICogV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bo
b3RtYWlsLmNvbT4KICoKICovCgojaWZuZGVmIF9DSE9PU0VfSF8KI2RlZmlu
ZSBfQ0hPT1NFX0hfCgojaW5jbHVkZSAiaW5pLmgiCgojZGVmaW5lIENBVEVH
T1JZX0VYUEFOREVEICAwCiNkZWZpbmUgQ0FURUdPUllfQ09MTEFQU0VEIDEK
CgpzdHJ1Y3QgX2hlYWRlcgp7CiAgY2hhciAqdGV4dDsKICBpbnQgc2xlbjsK
ICBpbnQgd2lkdGg7CiAgaW50IHg7Cn07Cgp0eXBlZGVmIGNsYXNzIF92aWV3
IHZpZXc7CgpjbGFzcyBwaWNrX2xpbmUKewogIHB1YmxpYzoKICAgIHZvaWQg
c2V0X2xpbmUgKFBhY2thZ2UgKl9wa2cpOwogICAgdm9pZCBzZXRfbGluZSAo
Q2F0ZWdvcnkgKl9jYXQpOwogICAgdm9pZCBwYWludCAoSERDIGhkYywgaW50
IHgsIGludCB5LCBpbnQgcm93LCBpbnQgc2hvd19jYXQpOwogICAgUGFja2Fn
ZSAqZ2V0X3BrZyAodm9pZCkgeyByZXR1cm4gcGtnOyB9OwogICAgQ2F0ZWdv
cnkgKmdldF9jYXRlZ29yeSAodm9pZCkgeyByZXR1cm4gY2F0OyB9OwogICAg
aW50IGNsaWNrIChpbnQgeCk7CiAgcHJpdmF0ZToKICAgIFBhY2thZ2UgKnBr
ZzsKICAgIENhdGVnb3J5ICpjYXQ7Cn07CgpjbGFzcyBfdmlldwp7CiAgcHVi
bGljOgogICAgaW50IG51bV9jb2x1bW5zOwogICAgdmlld3MgZ2V0X3ZpZXdf
bW9kZSAoKSB7IHJldHVybiB2aWV3X21vZGU7IH07CiAgICB2b2lkIHNldF92
aWV3X21vZGUodmlld3MgX21vZGUpOwogICAgc3RydWN0IF9oZWFkZXIgKmhl
YWRlcnM7CiAgICBfdmlldyAodmlld3MgbW9kZSwgSERDIGRjKTsKICAgIGNo
YXIgKm1vZGVfY2FwdGlvbiAoKTsKICAgIHZvaWQgaW5zZXJ0X3BrZyAoUGFj
a2FnZSAqKTsKICAgIHZvaWQgaW5zZXJ0X2NhdGVnb3J5IChDYXRlZ29yeSAq
LCBpbnQpOwogICAgdm9pZCBjbGVhcl92aWV3ICh2b2lkKTsKICAgIGludCBj
bGljayAoaW50IHJvdywgaW50IHgpOwogICAgaW50IGN1cnJlbnRfY29sOwog
ICAgaW50IG5ld19jb2w7CiAgICBpbnQgc3JjX2NvbDsKICAgIGludCBjYXRf
Y29sOwogICAgaW50IHBrZ19jb2w7CiAgICBpbnQgbGFzdF9jb2w7CiAgICBw
aWNrX2xpbmUgKiBsaW5lczsKICAgIGludCBubGluZXM7CgogIHByaXZhdGU6
CiAgICB2aWV3cyB2aWV3X21vZGU7CiAgICB2b2lkIHNldF9oZWFkZXJzICh2
b2lkKTsKICAgIHZvaWQgaW5pdF9oZWFkZXJzIChIREMgZGMpOwogICAgdm9p
ZCBpbnNlcnRfYXQgKGludCwgcGlja19saW5lKTsKICAgIHZvaWQgaW5zZXJ0
X3VuZGVyIChpbnQgbGluZW4sIHBpY2tfbGluZSBsaW5lKTsgCgp9OwoKI2Vu
ZGlmIC8qIF9DSE9PU0VfSF8gKi8K

------------=_1583532848-65438-78
Content-Type: text/x-diff; charset=us-ascii; name="hierarchy2.patch"
Content-Disposition: inline; filename="hierarchy2.patch"
Content-Transfer-Encoding: base64
Content-Length: 45084

PyAudGFyLmNjLnN3cAo/IGNob29zZS5oCj8gZGVwZW5kczIucGF0Y2gKPyBk
ZXBlbmRzNC5wYXRjaAo/IGhpZXJhcmNoeS5wYXRjaAo/IGhpZXJhcmNoeTIu
cGF0Y2gKPyBob21lLnBhdGNoCj8gb3JjaW5zdGFsbAo/IHdvcmsucGF0Y2gK
SW5kZXg6IGNob29zZS5jYwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBm
aWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL2Nob29zZS5jYyx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMi4zMwpkaWZmIC11IC1wIC1yMi4zMyBj
aG9vc2UuY2MKLS0tIGNob29zZS5jYwkyMDAxLzA2LzE2IDE4OjUwOjEzCTIu
MzMKKysrIGNob29zZS5jYwkyMDAxLzA2LzI0IDAxOjQ3OjIxCkBAIC00Myw2
ICs0Myw3IEBAIHN0YXRpYyBjaGFyICpjdnNpZCA9ICJcbiUlJSAkSWQ6IGNo
b29zZS4KICNpbmNsdWRlICJmaW5kLmgiCiAjaW5jbHVkZSAiZmlsZW1hbmlw
LmgiCiAjaW5jbHVkZSAibW91bnQuaCIKKyNpbmNsdWRlICJjaG9vc2UuaCIK
IAogI2luY2x1ZGUgInBvcnQuaCIKIApAQCAtNTUsOCArNTYsNiBAQCBzdGF0
aWMgY2hhciAqY3ZzaWQgPSAiXG4lJSUgJElkOiBjaG9vc2UuCiAKIHN0YXRp
YyBpbnQgaW5pdGlhbGl6ZWQgPSAwOwogCi1zdGF0aWMgaW50IGZ1bGxfbGlz
dCA9IDA7Ci0KIHN0YXRpYyBpbnQgc2Nyb2xsX3VsY194LCBzY3JvbGxfdWxj
X3k7CiAKIHN0YXRpYyBIV05EIGx2LCBuZXh0YnV0dG9uLCBjaG9vc2VfaW5z
dF90ZXh0OwpAQCAtNjYsMjkgKzY1LDMwIEBAIHN0YXRpYyBIQU5ETEUgc3lz
Zm9udDsKIHN0YXRpYyBpbnQgcm93X2hlaWdodDsKIHN0YXRpYyBIQU5ETEUg
Ym1fc3BpbiwgYm1fcnRhcnJvdywgYm1fY2hlY2t5ZXMsIGJtX2NoZWNrbm8s
IGJtX2NoZWNrbmE7CiBzdGF0aWMgSERDIGJpdG1hcF9kYzsKK3N0YXRpYyB2
aWV3ICpjaG9vc2VyID0gTlVMTDsKKworc3RhdGljIHN0cnVjdCBfaGVhZGVy
IHBrZ19oZWFkZXJzW10gPSB7CisgIHsgIkN1cnJlbnQiLCA3LCAwLCAwIH0s
CisgIHsgIk5ldyIsIDMsIDAsIDAgfSwKKyAgeyAiU3JjPyIsIDQsIDAsIDAg
fSwKKyAgeyAiQ2F0ZWdvcnkiLCA4LCAwLCAwIH0sCisgIHsgIlBhY2thZ2Ui
LCA3LCAwLCAwIH0sCisgIHsgMCwgMCwgMCwgMCB9Cit9OwogCi1zdGF0aWMg
c3RydWN0Ci0gIHsKLSAgICBjaGFyICp0ZXh0OwotICAgIGludCBzbGVuOwot
ICAgIGludCB3aWR0aDsKLSAgICBpbnQgeDsKLSAgfQotaGVhZGVyc1tdID0g
eworc3RhdGljIHN0cnVjdCBfaGVhZGVyIGNhdF9oZWFkZXJzW10gPSB7Cisg
IHsgIkNhdGVnb3J5IiwgOCwgMCwgMCB9LAogICB7ICJDdXJyZW50IiwgNywg
MCwgMCB9LAotI2RlZmluZSBDVVJSRU5UX0NPTCAwCiAgIHsgIk5ldyIsIDMs
IDAsIDAgfSwKLSNkZWZpbmUgTkVXX0NPTCAxCiAgIHsgIlNyYz8iLCA0LCAw
LCAwIH0sCi0jZGVmaW5lIFNSQ19DT0wgMgogICB7ICJQYWNrYWdlIiwgNywg
MCwgMCB9LAotI2RlZmluZSBQQUNLQUdFX0NPTCAzCiAgIHsgMCwgMCwgMCwg
MCB9CiB9OwotI2RlZmluZSBOVU1fQ09MVU1OUyAoc2l6ZW9mIChoZWFkZXJz
KSAvIChzaXplb2YgKGhlYWRlcnNbMF0pKSAtIDEpCiAKLWludCAqcGFja2Fn
ZV9pbmRleGVzLCBuaW5kZXhlczsKK3N0YXRpYyBpbnQgYWRkX3JlcXVpcmVk
KFBhY2thZ2UgKnBrZyk7CitzdGF0aWMgdm9pZCBzZXRfdmlld19tb2RlIChI
V05EIGgsIHZpZXdzIG1vZGUpOwogCisKIHN0YXRpYyBib29sCiBpc2luc3Rh
bGxlZCAoUGFja2FnZSAqcGtnLCBpbnQgdHJ1c3QpCiB7CkBAIC0xNjUsNiAr
MTY1LDY5IEBAIHNldF9hY3Rpb24gKFBhY2thZ2UgKnBrZywgYm9vbCBwcmVp
bmMpCiAgICAgICB9CiB9CiAKK3N0YXRpYyBpbnQKK2FkZF9yZXF1aXJlZCAo
UGFja2FnZSAqcGtnKQoreworICBEZXBlbmRlbmN5ICpkcDsKKyAgUGFja2Fn
ZSAqcmVxdWlyZWQ7CisgIGludCBjOworICBpbnQgY2hhbmdlZCA9IDA7Cisg
IGRwID0gcGtnLT5yZXF1aXJlZDsKKyAgc3dpdGNoIChwa2ctPmFjdGlvbikK
KyAgICB7CisgICAgY2FzZSBBQ1RJT05fVU5JTlNUQUxMOgorICAgIGNhc2Ug
QUNUSU9OX0VSUk9SOgorICAgIGNhc2UgQUNUSU9OX1VOS05PV046CisgICAg
Y2FzZSBBQ1RJT05fU1JDX09OTFk6CisgICAgY2FzZSBBQ1RJT05fU0tJUDoK
KyAgICAgIHJldHVybiAwOworICAgIGRlZmF1bHQ6CisgICAgICBicmVhazsK
KyAgICB9CisgIHdoaWxlIChkcCkKKyAgICB7CisgICAgICBpZiAoKHJlcXVp
cmVkID0gZ2V0cGtnYnluYW1lKGRwLT5wYWNrYWdlKSkgPT0gTlVMTCkKKyAg
ICAgICAgeworICAgICAgICAgIGRwPWRwLT5uZXh0OworICAgICAgICAgIGNv
bnRpbnVlOworICAgICAgICB9CisgICAgICBzd2l0Y2ggKHJlcXVpcmVkLT5h
Y3Rpb24pCisgICAgICAgIHsKKwljYXNlIEFDVElPTl9QUkVWOgorCWNhc2Ug
QUNUSU9OX0NVUlI6CisJY2FzZSBBQ1RJT05fVEVTVDoKKwljYXNlIEFDVElP
Tl9MQVNUOgorCWNhc2UgQUNUSU9OX1NBTUVfQ1VSUjoKKwljYXNlIEFDVElP
Tl9TQU1FX1RFU1Q6CisJY2FzZSBBQ1RJT05fU0FNRV9QUkVWOgorCWNhc2Ug
QUNUSU9OX1JFRE86CisJY2FzZSBBQ1RJT05fU0FNRV9MQVNUOgorCSAgLyog
d2UgYXJlIGluc3RhbGxpbmcgYSB1c2VyIHNlbGVjdGVkIHZlcnNpb24gKi8K
KwkgIGJyZWFrOworCQorCWNhc2UgQUNUSU9OX1VOSU5TVEFMTDoKKwkgIC8q
IGl0J3MgYWxyZWFkeSBpbnN0YWxsZWQgLSBsZWF2ZSBpdCAqLworCSAgcmVx
dWlyZWQtPmFjdGlvbiA9IEFDVElPTl9TS0lQOworCSAgYnJlYWs7CisJY2Fz
ZSBBQ1RJT05fRVJST1I6CisJY2FzZSBBQ1RJT05fVU5LTk9XTjoKKwljYXNl
IEFDVElPTl9TUkNfT05MWToKKwljYXNlIEFDVElPTl9TS0lQOgorCSAgLyog
dGhlIGN1cnJlbnQgaW5zdGFsbCB3aWxsIGZhaWwgKi8KKwkgIHJlcXVpcmVk
LT5hY3Rpb24gPSBBQ1RJT05fUFJFVjsgLyogdGhpcyBmaW5kIHByZXYsIHRo
ZW4gY3VyciwgdGhlbiB0ZXN0LiAqLworCSAgc2V0X2FjdGlvbihyZXF1aXJl
ZCwgMCk7CSAgLyogd2UgbmVlZCBhIGZpbmRfYmVzdCB0aGF0IGdldHMgaW5z
dGFsbGVkLCAqLworCSAgY2hhbmdlZCsrOwkJCSAgLyogdGhlbiBjdXJyZW50
LCB0aGVuIHByZXYsIHRoZW4gdGVzdCAqLworCSAgY2hvb3Nlci0+aW5zZXJ0
X3BrZyAocmVxdWlyZWQpOworCSAgYnJlYWs7CisJZGVmYXVsdDoKKwkgIGxv
ZyAoMCwgInNob3VsZCBuZXZlciBnZXQgaGVyZSAlZFxuIiwgcmVxdWlyZWQt
PmFjdGlvbik7CisJfQorICAgICAgY2hhbmdlZCArPSBhZGRfcmVxdWlyZWQg
KHJlcXVpcmVkKTsKKyAgICAgIGRwPWRwLT5uZXh0OworICAgIH0KKyAgcmV0
dXJuIGNoYW5nZWQ7Cit9CisKIC8qIFJldHVybiBhbiBhcHByb3ByaWF0ZSBj
YXB0aW9uIGdpdmVuIHRoZSBjdXJyZW50IGFjdGlvbi4gKi8KIGNvbnN0IGNo
YXIgKgogY2hvb3NlX2NhcHRpb24gKFBhY2thZ2UgKnBrZykKQEAgLTIxNyw1
NSArMjgwLDE5IEBAIHBhaW50IChIV05EIGh3bmQpCiAgIHkgPSBjci50b3Ag
LSBzY3JvbGxfdWxjX3kgKyBoZWFkZXJfaGVpZ2h0OwogCiAKLSAgZm9yIChp
ID0gMDsgaGVhZGVyc1tpXS50ZXh0OyBpKyspCisgIGZvciAoaSA9IDA7IGkg
PD0gY2hvb3Nlci0+bGFzdF9jb2wgOyBpKyspCiAgICAgewotICAgICAgVGV4
dE91dCAoaGRjLCB4ICsgaGVhZGVyc1tpXS54LCAzLCBoZWFkZXJzW2ldLnRl
eHQsIGhlYWRlcnNbaV0uc2xlbik7Ci0gICAgICBNb3ZlVG9FeCAoaGRjLCB4
ICsgaGVhZGVyc1tpXS54LCBoZWFkZXJfaGVpZ2h0LTMsICZwKTsKLSAgICAg
IExpbmVUbyAoaGRjLCB4ICsgaGVhZGVyc1tpXS54ICsgaGVhZGVyc1tpXS53
aWR0aCwgaGVhZGVyX2hlaWdodC0zKTsKKyAgICAgIFRleHRPdXQgKGhkYywg
eCArIGNob29zZXItPmhlYWRlcnNbaV0ueCwgMywgY2hvb3Nlci0+aGVhZGVy
c1tpXS50ZXh0LCBjaG9vc2VyLT5oZWFkZXJzW2ldLnNsZW4pOworICAgICAg
TW92ZVRvRXggKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbaV0ueCwgaGVh
ZGVyX2hlaWdodC0zLCAmcCk7CisgICAgICBMaW5lVG8gKGhkYywgeCArIGNo
b29zZXItPmhlYWRlcnNbaV0ueCArIGNob29zZXItPmhlYWRlcnNbaV0ud2lk
dGgsIGhlYWRlcl9oZWlnaHQtMyk7CiAgICAgfQogCiAgIEludGVyc2VjdENs
aXBSZWN0IChoZGMsIGNyLmxlZnQsIGNyLnRvcCArIGhlYWRlcl9oZWlnaHQs
IGNyLnJpZ2h0LCBjci5ib3R0b20pOwotCi0gIGZvciAoaWkgPSAwOyBpaSA8
IG5pbmRleGVzOyBpaSsrKQotICAgIHsKLSAgICAgIGkgPSBwYWNrYWdlX2lu
ZGV4ZXNbaWldOwotICAgICAgUGFja2FnZSAqcGtnID0gcGFja2FnZSArIGk7
Ci0gICAgICBpbnQgciA9IHkgKyBpaSAqIHJvd19oZWlnaHQ7Ci0gICAgICBp
bnQgYnkgPSByICsgdG0udG1IZWlnaHQgLSAxMTsKLSAgICAgIGlmIChwa2ct
Pmluc3RhbGxlZCkKLQl7Ci0JICBUZXh0T3V0IChoZGMsIHggKyBoZWFkZXJz
W0NVUlJFTlRfQ09MXS54LCByLAotCQkgICBwa2ctPmluc3RhbGxlZC0+dmVy
c2lvbiwgc3RybGVuIChwa2ctPmluc3RhbGxlZC0+dmVyc2lvbikpOwotCSAg
U2VsZWN0T2JqZWN0IChiaXRtYXBfZGMsIGJtX3J0YXJyb3cpOwotCSAgQml0
Qmx0IChoZGMsIHggKyBoZWFkZXJzW0NVUlJFTlRfQ09MXS54ICsgaGVhZGVy
c1swXS53aWR0aCArIElDT05fTUFSR0lOLzIgKyBITUFSR0lOLzIsIGJ5LAot
CQkgIDExLCAxMSwgYml0bWFwX2RjLCAwLCAwLCBTUkNDT1BZKTsKLQl9CiAK
LSAgICAgIGNvbnN0IGNoYXIgKnMgPSBjaG9vc2VfY2FwdGlvbiAocGtnKTsK
LSAgICAgIFRleHRPdXQgKGhkYywgeCArIGhlYWRlcnNbTkVXX0NPTF0ueCAr
IE5FV19DT0xfU0laRV9TTE9QLCByLAotCSAgICAgICBzLCBzdHJsZW4gKHMp
KTsKLSAgICAgIFNlbGVjdE9iamVjdCAoYml0bWFwX2RjLCBibV9zcGluKTsK
LSAgICAgIEJpdEJsdCAoaGRjLCB4ICsgaGVhZGVyc1tORVdfQ09MXS54LCBi
eSwgMTEsIDExLAotCSAgICAgIGJpdG1hcF9kYywgMCwgMCwgU1JDQ09QWSk7
Ci0KLSAgICAgIEhBTkRMRSBjaGVja19ibTsKLSAgICAgIGlmIChwa2ctPnNy
Y3BpY2tlZCkKLQljaGVja19ibSA9IGJtX2NoZWNreWVzOwotICAgICAgZWxz
ZQotCWNoZWNrX2JtID0gYm1fY2hlY2tubzsKLQotICAgICAgU2VsZWN0T2Jq
ZWN0IChiaXRtYXBfZGMsIGNoZWNrX2JtKTsKLSAgICAgIEJpdEJsdCAoaGRj
LCB4ICsgaGVhZGVyc1tTUkNfQ09MXS54LCBieSwgMTEsIDExLAotCSAgICAg
IGJpdG1hcF9kYywgMCwgMCwgU1JDQ09QWSk7Ci0KLSAgICAgIGlmIChwYWNr
YWdlW2ldLnNkZXNjKQotCXMgPSBwYWNrYWdlW2ldLnNkZXNjOwotICAgICAg
ZWxzZQotCXMgPSBwYWNrYWdlW2ldLm5hbWU7Ci0gICAgICBUZXh0T3V0ICho
ZGMsIHggKyBoZWFkZXJzW1BBQ0tBR0VfQ09MXS54LCByLCBzLCBzdHJsZW4g
KHMpKTsKLSAgICB9CisgIGZvciAoaWkgPSAwOyBpaSA8IGNob29zZXItPm5s
aW5lczsgaWkrKykKKyAgICAgIGNob29zZXItPmxpbmVzW2lpXS5wYWludCAo
aGRjLCB4LCB5LCBpaSwgKGNob29zZXItPmdldF92aWV3X21vZGUgKCkgPT0g
VklFV19DQVRFR09SWSkgPyAwIDogMSk7CiAKLSAgaWYgKG5pbmRleGVzID09
IDApCisgIGlmIChjaG9vc2VyLT5ubGluZXMgPT0gMCkKICAgICB7CiAgICAg
ICBzdGF0aWMgY2hhciAqbXNnID0gIk5vdGhpbmcgdG8gSW5zdGFsbC9VcGRh
dGUiOwogICAgICAgaWYgKHNvdXJjZSA9PSBJRENfU09VUkNFX0RPV05MT0FE
KQpAQCAtMzUwLDkgKzM3Nyw5IEBAIGxpc3RfaHNjcm9sbCAoSFdORCBod25k
LCBIV05EIGhjdGwsIFVJTlQKIHN0YXRpYyBMUkVTVUxUIENBTExCQUNLCiBs
aXN0X2NsaWNrIChIV05EIGh3bmQsIEJPT0wgZGJsY2xrLCBpbnQgeCwgaW50
IHksIFVJTlQgaGl0Q29kZSkKIHsKLSAgaW50IHI7CisgIGludCByLHJlZnJl
c2g7CiAKLSAgaWYgKG5pbmRleGVzID09IDApCisgIGlmIChjaG9vc2VyLT5u
bGluZXMgPT0gMCkKICAgICByZXR1cm4gMDsKIAogICBpZiAoeSA8IGhlYWRl
cl9oZWlnaHQpCkBAIC0zNjIsMjMgKzM4OSwzOCBAQCBsaXN0X2NsaWNrIChI
V05EIGh3bmQsIEJPT0wgZGJsY2xrLCBpbnQgCiAKICAgciA9ICh5ICsgUk9X
X01BUkdJTi8yKSAvIHJvd19oZWlnaHQ7CiAKLSAgaWYgKHIgPCAwIHx8IHIg
Pj0gbmluZGV4ZXMpCisgIGlmIChyIDwgMCB8fCByID49IGNob29zZXItPm5s
aW5lcykKICAgICByZXR1cm4gMDsKIAotICBQYWNrYWdlICpwa2cgPSBwYWNr
YWdlICsgcGFja2FnZV9pbmRleGVzW3JdOwotCi0gIGlmICh4ID49IGhlYWRl
cnNbTkVXX0NPTF0ueCAtIChITUFSR0lOIC8gMikgJiYgeCA8PSBoZWFkZXJz
W05FV19DT0wgKyAxXS54IC0gSE1BUkdJTi8yKQotICAgIHNldF9hY3Rpb24g
KHBrZywgMSk7CisgIHJlZnJlc2ggPSBjaG9vc2VyLT5jbGljayAociwgeCk7
CisgCisgIGlmIChyZWZyZXNoKQorICAgIHsKKyAgICAgIFJFQ1QgcjsKKyAg
ICAgIEdldENsaWVudFJlY3QgKGx2LCAmcik7CisgICAgICBTQ1JPTExJTkZP
IHNpOworICAgICAgbWVtc2V0ICgmc2ksIDAsIHNpemVvZiAoc2kpKTsKKyAg
ICAgIHNpLmNiU2l6ZSA9IHNpemVvZiAoc2kpOworICAgICAgc2kuZk1hc2sg
PSBTSUZfQUxMOyAvKiBTSUZfUkFOR0Ugd2FzIGdpdmluZyBzdHJhbmdlIGJl
aGF2aW91ciAqLworICAgICAgc2kubk1pbiA9IDA7CisKKyAgICAgIHNpLm5N
YXggPSBjaG9vc2VyLT5ubGluZXMgKiByb3dfaGVpZ2h0OworICAgICAgc2ku
blBhZ2UgPSByLmJvdHRvbSAtIGhlYWRlcl9oZWlnaHQ7CisgICAgICBzaS5u
UG9zID0gc2Nyb2xsX3VsY195OworICAgICAgU2V0U2Nyb2xsSW5mbyAobHYs
IFNCX1ZFUlQsICZzaSwgVFJVRSk7CiAKLSAgaWYgKHggPj0gaGVhZGVyc1tT
UkNfQ09MXS54IC0gSE1BUkdJTi8yICYmIHggPD0gaGVhZGVyc1tTUkNfQ09M
ICsgMV0ueCAtIEhNQVJHSU4vMikKLSAgICBwa2ctPnNyY3BpY2tlZCBePSAx
OworICAgICAgSW52YWxpZGF0ZVJlY3QgKGx2LCAmciwgVFJVRSk7CiAKLSAg
UkVDVCByZWN0OwotICByZWN0LmxlZnQgPSBoZWFkZXJzW05FV19DT0xdLngg
LSBzY3JvbGxfdWxjX3g7Ci0gIHJlY3QucmlnaHQgPSBoZWFkZXJzW1NSQ19D
T0wgKyAxXS54IC0gc2Nyb2xsX3VsY194OwotICByZWN0LnRvcCA9IGhlYWRl
cl9oZWlnaHQgKyByICogcm93X2hlaWdodCAtIHNjcm9sbF91bGNfeTsKLSAg
cmVjdC5ib3R0b20gPSByZWN0LnRvcCArIHJvd19oZWlnaHQ7Ci0gIEludmFs
aWRhdGVSZWN0IChod25kLCAmcmVjdCwgVFJVRSk7CisgICAgfQorICBlbHNl
CisgICAgeworICAgICAgUkVDVCByZWN0OworICAgICAgcmVjdC5sZWZ0ID0g
Y2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5uZXdfY29sXS54IC0gc2Nyb2xs
X3VsY194OworICAgICAgcmVjdC5yaWdodCA9IGNob29zZXItPmhlYWRlcnNb
Y2hvb3Nlci0+c3JjX2NvbCArIDFdLnggLSBzY3JvbGxfdWxjX3g7CisgICAg
ICByZWN0LnRvcCA9IGhlYWRlcl9oZWlnaHQgKyByICogcm93X2hlaWdodCAt
IHNjcm9sbF91bGNfeTsKKyAgICAgIHJlY3QuYm90dG9tID0gcmVjdC50b3Ag
KyByb3dfaGVpZ2h0OworICAgICAgSW52YWxpZGF0ZVJlY3QgKGh3bmQsICZy
ZWN0LCBUUlVFKTsKKyAgICB9CiB9CiAKIHN0YXRpYyBMUkVTVUxUIENBTExC
QUNLCkBAIC00MjQsMTQgKzQ2NiwxNCBAQCByZWdpc3Rlcl93aW5kb3dzIChI
SU5TVEFOQ0UgaGluc3QpCiB9CiAKIHN0YXRpYyB2b2lkCi1ub3RlX3dpZHRo
IChIREMgZGMsIGNoYXIgKnN0cmluZywgaW50IGFkZGVuZCwgaW50IGNvbHVt
bikKK25vdGVfd2lkdGggKHN0cnVjdCBfaGVhZGVyICpoZHJzLCBIREMgZGMs
IGNoYXIgKnN0cmluZywgaW50IGFkZGVuZCwgaW50IGNvbHVtbikKIHsKICAg
aWYgKCFzdHJpbmcpCiAgICAgcmV0dXJuOwogICBTSVpFIHM7CiAgIEdldFRl
eHRFeHRlbnRQb2ludDMyIChkYywgc3RyaW5nLCBzdHJsZW4gKHN0cmluZyks
ICZzKTsKLSAgaWYgKGhlYWRlcnNbY29sdW1uXS53aWR0aCA8IHMuY3ggKyBh
ZGRlbmQpCi0gICAgaGVhZGVyc1tjb2x1bW5dLndpZHRoID0gcy5jeCArIGFk
ZGVuZDsKKyAgaWYgKGhkcnNbY29sdW1uXS53aWR0aCA8IHMuY3ggKyBhZGRl
bmQpCisgICAgaGRyc1tjb2x1bW5dLndpZHRoID0gcy5jeCArIGFkZGVuZDsK
IH0KIAogc3RhdGljIGludApAQCAtNDc0LDYgKzUxNiwxNCBAQCBzZXRfZXhp
c3RlbmNlICgpCiB9CiAKIHN0YXRpYyB2b2lkCitmaWxsX21pc3NpbmdfY2F0
ZWdvcnkgKCkKK3sKKyAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdlOyBw
a2ctPm5hbWU7IHBrZysrKQorICAgIGlmICghcGtnLT5jYXRlZ29yeSkKKyAg
ICAgIGFkZF9jYXRlZ29yeSAocGtnLCByZWdpc3Rlcl9jYXRlZ29yeSAoIk1p
c2MiKSk7Cit9CisKK3N0YXRpYyB2b2lkCiBkZWZhdWx0X3RydXN0IChIV05E
IGgsIHRydXN0cyB0cnVzdCkKIHsKICAgaW50IGksIHQsIGM7CkBAIC00ODEs
NiArNTMxLDkgQEAgZGVmYXVsdF90cnVzdCAoSFdORCBoLCB0cnVzdHMgdHJ1
c3QpCiAgIGZvciAoUGFja2FnZSAqcGtnID0gcGFja2FnZTsgcGtnLT5uYW1l
OyBwa2crKykKICAgICB7CiAgICAgICBwa2ctPmFjdGlvbiA9IChhY3Rpb25z
KSB0cnVzdDsKKyAgICAgIGlmIChwa2ctPmNhdGVnb3J5ICYmICEoZ2V0cGFj
a2FnZWNhdGVnb3J5YnluYW1lIChwa2csICJSZXF1aXJlZCIpIHx8CisJCQkg
ICAgIGdldHBhY2thZ2VjYXRlZ29yeWJ5bmFtZSAocGtnLCAiTWlzYyIpKSkK
Kwlwa2ctPmFjdGlvbiA9IEFDVElPTl9TS0lQOwogICAgICAgc2V0X2FjdGlv
biAocGtnLCAwKTsKICAgICB9CiAgIFJFQ1QgcjsKQEAgLTQ5MCwyNCArNTQz
LDQ1MCBAQCBkZWZhdWx0X3RydXN0IChIV05EIGgsIHRydXN0cyB0cnVzdCkK
ICAgICBTZXRGb2N1cyAobmV4dGJ1dHRvbik7CiB9CiAKLXN0YXRpYyB2b2lk
Ci1zZXRfZnVsbF9saXN0IChIV05EIGgsIGludCBpc2Z1bGwpCit2b2lkCitw
aWNrX2xpbmU6OnNldF9saW5lIChQYWNrYWdlICpfcGtnKQoreworICBwa2cg
PSBfcGtnOworICBjYXQgPSBOVUxMOworfQorCit2b2lkCitwaWNrX2xpbmU6
OnNldF9saW5lIChDYXRlZ29yeSAqX2NhdCkKK3sKKyAgY2F0ID0gX2NhdDsK
KyAgcGtnID0gTlVMTDsKK30KKwordm9pZAorcGlja19saW5lOjpwYWludCAo
SERDIGhkYywgaW50IHgsIGludCB5LCBpbnQgcm93LCBpbnQgc2hvd19jYXQp
Cit7CisgIGludCByID0geSArIHJvdyAqIHJvd19oZWlnaHQ7CisgIGludCBi
eSA9IHIgKyB0bS50bUhlaWdodCAtIDExOworICBpZiAocGtnKQorICAgIHsK
KyAgICAgIGlmIChwa2ctPmluc3RhbGxlZCkKKyAgICAgICAgeworICAgICAg
ICAgIFRleHRPdXQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nl
ci0+Y3VycmVudF9jb2xdLngsIHIsCisgICAgICAgICAgICAgICAgICAgcGtn
LT5pbnN0YWxsZWQtPnZlcnNpb24sIHN0cmxlbiAocGtnLT5pbnN0YWxsZWQt
PnZlcnNpb24pKTsKKyAgICAgICAgICBTZWxlY3RPYmplY3QgKGJpdG1hcF9k
YywgYm1fcnRhcnJvdyk7CisgICAgICAgICAgQml0Qmx0IChoZGMsIHggKyBj
aG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmN1cnJlbnRfY29sXS54ICsgY2hv
b3Nlci0+aGVhZGVyc1swXS53aWR0aCArIElDT05fTUFSR0lOLzIgKyBITUFS
R0lOLzIsIGJ5LAorICAgICAgICAgICAgICAgICAgMTEsIDExLCBiaXRtYXBf
ZGMsIDAsIDAsIFNSQ0NPUFkpOworICAgICAgICB9CisKKyAgICAgIGNvbnN0
IGNoYXIgKnMgPSBjaG9vc2VfY2FwdGlvbiAocGtnKTsKKyAgICAgIFRleHRP
dXQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+bmV3X2Nv
bF0ueCArIE5FV19DT0xfU0laRV9TTE9QLCByLAorICAgICAgICAgICAgICAg
cywgc3RybGVuIChzKSk7CisgICAgICBTZWxlY3RPYmplY3QgKGJpdG1hcF9k
YywgYm1fc3Bpbik7CisgICAgICBCaXRCbHQgKGhkYywgeCArIGNob29zZXIt
PmhlYWRlcnNbY2hvb3Nlci0+bmV3X2NvbF0ueCwgYnksIDExLCAxMSwKKyAg
ICAgICAgICAgICAgYml0bWFwX2RjLCAwLCAwLCBTUkNDT1BZKTsKKworICAg
ICAgSEFORExFIGNoZWNrX2JtOworICAgICAgaWYgKHBrZy0+c3JjcGlja2Vk
KQorICAgICAgICBjaGVja19ibSA9IGJtX2NoZWNreWVzOworICAgICAgZWxz
ZQorICAgICAgICBjaGVja19ibSA9IGJtX2NoZWNrbm87CisKKyAgICAgIFNl
bGVjdE9iamVjdCAoYml0bWFwX2RjLCBjaGVja19ibSk7CisgICAgICBCaXRC
bHQgKGhkYywgeCArIGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+c3JjX2Nv
bF0ueCwgYnksIDExLCAxMSwKKyAgICAgICAgICAgICAgYml0bWFwX2RjLCAw
LCAwLCBTUkNDT1BZKTsKKworCS8qIHNob3dzICJmaXJzdCIgY2F0ZWdvcnkg
LSBkbyB3ZSB3YW50IHRvIHNob3cgYW55PyAqLworICAgICAgaWYgKHBrZy0+
Y2F0ZWdvcnkgJiYgc2hvd19jYXQpCisgICAgICAgVGV4dE91dCAoaGRjLCB4
ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5jYXRfY29sXS54LCByLCBw
a2ctPmNhdGVnb3J5LT5uYW1lLCBzdHJsZW4gKHBrZy0+Y2F0ZWdvcnktPm5h
bWUpKTsKKworICAgICAgaWYgKHBrZy0+c2Rlc2MpCisgICAgICAgIHMgPSBw
a2ctPnNkZXNjOworICAgICAgZWxzZQorICAgICAgICBzID0gcGtnLT5uYW1l
OworICAgICAgVGV4dE91dCAoaGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tj
aG9vc2VyLT5wa2dfY29sXS54LCByLCBzLCBzdHJsZW4gKHMpKTsKKyAgICB9
CisgIGVsc2UgaWYgKGNhdCkKKyAgICB7CisgICAgICBUZXh0T3V0IChoZGMs
IHggKyBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmNhdF9jb2xdLngsIHIs
IGNhdC0+bmFtZSwgc3RybGVuIChjYXQtPm5hbWUpKTsKKyAgICB9Cit9CisK
K2ludAorcGlja19saW5lOjpjbGljayAoaW50IHgpCit7CisgIGlmIChwa2cp
CisgICAgeworICAgICAgaWYgKHggPj0gY2hvb3Nlci0+aGVhZGVyc1tjaG9v
c2VyLT5zcmNfY29sXS54IC0gSE1BUkdJTi8yICYmIHggPD0gY2hvb3Nlci0+
aGVhZGVyc1tjaG9vc2VyLT5zcmNfY29sICsgMV0ueCAtIEhNQVJHSU4vMikK
KyAgICAgIHBrZy0+c3JjcGlja2VkIF49IDE7CisKKyAgICBpZiAoeCA+PSBj
aG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPm5ld19jb2xdLnggLSAoSE1BUkdJ
TiAvIDIpICYmIHggPD0gY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5uZXdf
Y29sICsgMV0ueCAtIEhNQVJHSU4vMikKKyAgICAgIHsKKyAgICAgICAgc2V0
X2FjdGlvbiAocGtnLCAxKTsKKyAgICAgICAgLyogQWRkIGFueSBwYWNrYWdl
cyB0aGF0IGFyZSBuZWVkZWQgYnkgdGhpcyBwYWNrYWdlICovCisgICAgICAg
IHJldHVybiBhZGRfcmVxdWlyZWQgIChwa2cpOworICAgICAgfQorICAgIH0K
KyAgZWxzZSBpZiAoY2F0KQorICAgIHsKKyAgICAgIC8qIGhhbmRsZSB0aGUg
Y2F0YWxvZyBiZWluZyBjbGlja2VkIC4uLiBkb2VzIHRoaXMgYmVsb25nIHVw
IGEgbGV2ZWwuLiA/ICovCisgICAgfQorICAKKyAgcmV0dXJuIDA7Cit9CisK
K192aWV3OjpfdmlldyAodmlld3MgX21vZGUsIEhEQyBkYykKK3sKKyAgbGlu
ZXMgPSBOVUxMOworICBubGluZXMgPSAwOworICB2aWV3X21vZGUgPSBWSUVX
X1BBQ0tBR0U7CisgIHNldF9oZWFkZXJzICgpOworICBpbml0X2hlYWRlcnMg
KGRjKTsKKyAgdmlld19tb2RlID0gVklFV19DQVRFR09SWTsKKyAgc2V0X2hl
YWRlcnMgKCk7CisgIGluaXRfaGVhZGVycyAoZGMpOworCisgIHZpZXdfbW9k
ZSA9IF9tb2RlOworICBzZXRfaGVhZGVycyAoKTsKK30KKwordm9pZAorX3Zp
ZXc6OnNldF92aWV3X21vZGUgKHZpZXdzIF9tb2RlKQoreworICBpZiAoX21v
ZGUgPT0gTlZJRVcpCisgICAgICB2aWV3X21vZGUgPSBWSUVXX1BBQ0tBR0Vf
RlVMTDsKKyAgZWxzZQorICAgIHZpZXdfbW9kZSA9IF9tb2RlOworICBzZXRf
aGVhZGVycyAoKTsKK30KKworY2hhciAqCitfdmlldzo6bW9kZV9jYXB0aW9u
ICgpCit7CisgIHN3aXRjaCAodmlld19tb2RlKQorICAgIHsKKyAgICBjYXNl
IFZJRVdfVU5LTk9XTjogICAgICByZXR1cm4gIiI7CisgICAgY2FzZSBWSUVX
X1BBQ0tBR0VfRlVMTDogcmV0dXJuICJGdWxsIjsKKyAgICBjYXNlIFZJRVdf
UEFDS0FHRTogICAgICByZXR1cm4gIlBhcnRpYWwiOworICAgIGNhc2UgVklF
V19DQVRFR09SWTogICAgIHJldHVybiAiQ2F0ZWdvcnkiOworICAgIGRlZmF1
bHQ6ICAgICAgICAgICAgICAgIHJldHVybiAiIjsKKyAgICB9Cit9CisKK3Zv
aWQKK192aWV3OjpzZXRfaGVhZGVycyAodm9pZCkKK3sKKyAgc3dpdGNoICh2
aWV3X21vZGUpCisgICAgeworICAgIGNhc2UgVklFV19VTktOT1dOOgorICAg
ICAgcmV0dXJuOworICAgIGNhc2UgVklFV19QQUNLQUdFX0ZVTEw6IAorICAg
IGNhc2UgVklFV19QQUNLQUdFOiAgICAgIAorICAgICAgaGVhZGVycyA9IHBr
Z19oZWFkZXJzOworICAgICAgY3VycmVudF9jb2wgPSAwOworICAgICAgbmV3
X2NvbCA9IDE7CisgICAgICBzcmNfY29sID0gMjsKKyAgICAgIGNhdF9jb2wg
PSAzOworICAgICAgcGtnX2NvbCA9IDQ7CisgICAgICBsYXN0X2NvbCA9IDQ7
CisgICAgICBicmVhazsKKyAgICBjYXNlIFZJRVdfQ0FURUdPUlk6CisgICAg
ICBoZWFkZXJzID0gY2F0X2hlYWRlcnM7CisgICAgICBjdXJyZW50X2NvbCA9
IDE7CisgICAgICBuZXdfY29sID0gMjsKKyAgICAgIHNyY19jb2wgPSAzOwor
ICAgICAgY2F0X2NvbCA9IDA7CisgICAgICBwa2dfY29sID0gNDsKKyAgICAg
IGxhc3RfY29sID0gNDsKKyAgICBkZWZhdWx0OgorICAgICAgcmV0dXJuOwor
ICAgIH0KK30KKwordm9pZAorX3ZpZXc6OmluaXRfaGVhZGVycyAoSERDIGRj
KQogewogICBpbnQgaTsKLSAgZnVsbF9saXN0ID0gaXNmdWxsOworCisgIGZv
ciAoaSA9IDA7IGhlYWRlcnNbaV0udGV4dDsgaSsrKQorICAgIGhlYWRlcnNb
aV0ud2lkdGggPSAwOworCisgIGZvciAoaSA9IDA7IGhlYWRlcnNbaV0udGV4
dDsgaSsrKQorICAgIG5vdGVfd2lkdGggKGhlYWRlcnMsIGRjLCBoZWFkZXJz
W2ldLnRleHQsIDAsIGkpOworICBmb3IgKFBhY2thZ2UgKnBrZyA9IHBhY2th
Z2U7IHBrZy0+bmFtZTsgcGtnKyspCisgICAgeworICAgICAgaWYgKHBrZy0+
aW5zdGFsbGVkKQorICAgICAgICB7CisgICAgICAgICAgbm90ZV93aWR0aCAo
aGVhZGVycywgZGMsIHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uLCAwLCBjdXJy
ZW50X2NvbCk7CisgICAgICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywgZGMs
IHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uLCBORVdfQ09MX1NJWkVfU0xPUCwg
bmV3X2NvbCk7CisgICAgICAgIH0KKyAgICAgIGZvciAoSW5mbyAqaW5mID0g
cGtnLT5pbmZvc2NhbjsgaW5mIDwgcGtnLT5pbmZvZW5kOyBpbmYrKykKKyAg
ICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywgZGMsIGluZi0+dmVyc2lvbiwg
TkVXX0NPTF9TSVpFX1NMT1AsIG5ld19jb2wpOworICAgICAgZm9yIChDYXRl
Z29yeSAqY2F0ID0gcGtnLT5jYXRlZ29yeTsgY2F0IDsgY2F0ID0gY2F0LT5u
ZXh0KQorCW5vdGVfd2lkdGggKGhlYWRlcnMsIGRjLCBjYXQtPm5hbWUsIDAs
IGNhdF9jb2wpOworICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywgZGMsIHBr
Zy0+bmFtZSwgMCwgcGtnX2NvbCk7CisgICAgICBub3RlX3dpZHRoIChoZWFk
ZXJzLCBkYywgcGtnLT5zZGVzYywgMCwgcGtnX2NvbCk7CisgICAgfQorICBu
b3RlX3dpZHRoIChoZWFkZXJzLCBkYywgImtlZXAiLCBORVdfQ09MX1NJWkVf
U0xPUCwgbmV3X2NvbCk7CisgIG5vdGVfd2lkdGggKGhlYWRlcnMsIGRjLCAi
dW5pbnN0YWxsIiwgTkVXX0NPTF9TSVpFX1NMT1AsIG5ld19jb2wpOworCisg
IGhlYWRlcnNbMF0ueCA9IEhNQVJHSU4vMjsKKyAgZm9yIChpID0gMTsgaSA8
PSBsYXN0X2NvbCA7IGkrKykKKyAgICBoZWFkZXJzW2ldLnggPSBoZWFkZXJz
W2ktMV0ueCArIGhlYWRlcnNbaS0xXS53aWR0aCArICgoaSA9PSBuZXdfY29s
KSA/IE5FV19DT0xfU0laRV9TTE9QIDogMCkgKyBITUFSR0lOOworOworfQor
Cit2b2lkCitfdmlldzo6aW5zZXJ0X3BrZyAoUGFja2FnZSAqcGtnKQorewor
ICBwaWNrX2xpbmUgbGluZTsKKyAgbGluZS5zZXRfbGluZSAocGtnKTsKKyAg
aWYgKHZpZXdfbW9kZSAhPSBWSUVXX0NBVEVHT1JZKQorICAgIHsKKyAgICAg
IGlmIChsaW5lcyA9PSBOVUxMKQorICAgICAgICB7CisgICAgICAgICAgbGlu
ZXMgPSAocGlja19saW5lICopIG1hbGxvYyAoKG5wYWNrYWdlcyArIG5jYXRl
Z29yaWVzKSAqIHNpemVvZiAocGlja19saW5lKSk7CisgICAgICAgICAgbWVt
c2V0IChsaW5lcywgJ1wwJywgKG5wYWNrYWdlcyArIG5jYXRlZ29yaWVzKSAq
IHNpemVvZiAocGlja19saW5lKSApOworCSAgbmxpbmVzID0gMDsKKwkgIGlu
c2VydF9hdCAoMCwgbGluZSk7CisgICAgICAgIH0KKyAgICAgIGVsc2UKKwlp
bnNlcnRfdW5kZXIgKDAsIGxpbmUpOworICAgIH0KKyAgZWxzZQorICAgIHsK
Ky8vICAgICAgYXNzZXJ0IChsaW5lcyk7IC8qIHByb3RlY3QgYWdhaW5zdCBh
IGNvZGluZyBjaGFuZ2UgaW4gZnV0dXJlICovCisgICAgICBmb3IgKENhdGVn
b3J5ICpjYXQgPSBwa2ctPmNhdGVnb3J5OyBjYXQ7IGNhdCA9IGNhdC0+bmV4
dCkKKwl7CisJICAvKiBpbnNlcnQgdGhlIHBhY2thZ2UgdW5kZXIgdGhpcyBj
YXRlZ29yeSBpbiB0aGUgbGlzdC4gSWYgdGhpcyBjYXRlZ29yeSBpcyBub3QK
KwkgICAgIHZpc2libGUsIGFkZCBpdCAqLworCSAgaW50IG49MDsKKwkgIHdo
aWxlIChuIDwgbmxpbmVzKQorCSAgICB7CisJICAgICAgLyogdGhpcyBzaG91
bGQgYmUgYSBnZW5lcmljIGNhbGwgdG8gbGlzdF9zb3J0X2NtcCAqLworCSAg
ICAgIGlmIChsaW5lc1tuXS5nZXRfY2F0ZWdvcnkgKCkKKwkJICAmJiBjYXQt
Pm5hbWUgPT0gbGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpLT5uYW1lKQorCQkg
IGluc2VydF91bmRlciAobiwgbGluZSk7CisJICAgICAgbisrOworCSAgICB9
CisJICBpZiAobiA9PSBubGluZXMpCisJICAgIHsKKwkgICAgICAvKiB0aGUg
Y2F0ZWdvcnkgd2Fzbid0IHZpc2libGUgLSBpbnNlcnQgYXQgdGhlIGVuZCAq
LworCSAgICAgIGluc2VydF9jYXRlZ29yeSAoY2F0LCBDQVRFR09SWV9DT0xM
QVBTRUQpOworCSAgICAgIGluc2VydF9wa2cgKHBrZyk7CisJICAgIH0KKwl9
CisgICAgfQorfQorCit2b2lkCitfdmlldzo6aW5zZXJ0X2NhdGVnb3J5IChD
YXRlZ29yeSAqY2F0LCBpbnQgY29sbGFwc2VkKQoreworICBwaWNrX2xpbmUg
bGluZTsKKyAgbGluZS5zZXRfbGluZSAoY2F0KTsKKyAgaWYgKGxpbmVzID09
IE5VTEwpCisgICAgeworICAgICAgbGluZXMgPSAocGlja19saW5lICopIG1h
bGxvYyAoKG5wYWNrYWdlcyArIG5jYXRlZ29yaWVzKSAqIHNpemVvZiAocGlj
a19saW5lKSk7CisgICAgICBtZW1zZXQgKGxpbmVzLCAnXDAnLCAobnBhY2th
Z2VzICsgbmNhdGVnb3JpZXMpICogc2l6ZW9mIChwaWNrX2xpbmUpICk7Cisg
ICAgICBubGluZXMgPSAwOworICAgICAgaW5zZXJ0X2F0ICgwLCBsaW5lKTsK
KyAgICAgIGlmICghY29sbGFwc2VkKQorCWZvciAoQ2F0ZWdvcnlQYWNrYWdl
ICpjYXRwa2cgPSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNh
dHBrZy0+bmV4dCkKKwkgIGluc2VydF9wa2cgKGdldHBrZ2J5bmFtZSAoY2F0
cGtnLT5wa2cpKTsKKyAgICB9CisgIGVsc2UKKyAgICB7CisgICAgICBpbnQg
bj0wOworICAgICAgd2hpbGUgKG4gPCBubGluZXMpCisgICAgICAgIHsKKyAg
ICAgICAgICAvKiB0aGlzIHNob3VsZCBiZSBhIGdlbmVyaWMgY2FsbCB0byBs
aXN0X3NvcnRfY21wICovCisgICAgICAgICAgaWYgKGxpbmVzW25dLmdldF9j
YXRlZ29yeSAoKQorICAgICAgICAgICAgICAmJiBzdHJjYXNlY21wIChjYXQt
Pm5hbWUsIGxpbmVzW25dLmdldF9jYXRlZ29yeSAoKS0+bmFtZSkgPCAwKQor
ICAgICAgICAgICAgeworCSAgICAgIGluc2VydF9hdCAobiwgbGluZSk7CisJ
ICAgICAgaWYgKCFjb2xsYXBzZWQpCisJCWZvciAoQ2F0ZWdvcnlQYWNrYWdl
ICpjYXRwa2cgPSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNh
dHBrZy0+bmV4dCkKKwkJICBpbnNlcnRfcGtnIChnZXRwa2dieW5hbWUgKGNh
dHBrZy0+cGtnKSk7CisgICAgICAgICAgICAgIG4gPSBubGluZXM7CisgICAg
ICAgICAgICB9CisgICAgICAgICAgZWxzZSBpZiAobGluZXNbbl0uZ2V0X2Nh
dGVnb3J5ICgpID09IGNhdCkKKyAgICAgICAgICAgIG4gPSBubGluZXM7Cisg
ICAgICAgICAgbisrOworCisgICAgICAgIH0KKyAgICAgIGlmIChuID09IG5s
aW5lcykKKyAgICAgICAgeworICAgICAgICAgIC8qIGluc2VydCBhdCB0aGUg
ZW5kICovCisJICBpbnNlcnRfYXQgKG4sIGxpbmUpOworCSAgaWYgKCFjb2xs
YXBzZWQpCisJICAgIGZvciAoQ2F0ZWdvcnlQYWNrYWdlICpjYXRwa2cgPSBj
YXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNhdHBrZy0+bmV4dCkK
KwkgICAgICBpbnNlcnRfcGtnIChnZXRwa2dieW5hbWUgKGNhdHBrZy0+cGtn
KSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKKy8qIGluc2VydCBhIG5ldyBs
aW5lIGF0IGxpbmUgbiAqLwordm9pZAorX3ZpZXc6Omluc2VydF9hdCAoaW50
IG4sIHBpY2tfbGluZSBsaW5lKQoreworICBpZiAobiA8IDAgfHwgbiA+IG5s
aW5lcykKKyAgICByZXR1cm47CisgIG1lbW1vdmUgKCZsaW5lc1tuICsgMV0s
ICZsaW5lc1tuXSwgKG5saW5lcyAtIG4pICogc2l6ZW9mIChwaWNrX2xpbmUp
KTsKKyAgbGluZXNbbl0gPSBsaW5lOworICBubGluZXMrKzsKK30KKworLyog
aW5zZXJ0IGEgbmV3IGxpbmUgaW4gdGhlIGNob29zZXIsIGF0IHRoZSBuZXh0
IGRlcHRoIGluIGZyb20gbGluZW4gKi8KK3ZvaWQKK192aWV3OjppbnNlcnRf
dW5kZXIgKGludCBsaW5lbiwgcGlja19saW5lIGxpbmUpCit7CisgIGludCBu
OworICAvKiBzcGVjaWFsIGNhc2UgLSBlbXB0eSB2aWV3ICovCisgIGlmIChu
bGluZXMgPT0gMCkKKyAgICB7CisgICAgICBpbnNlcnRfYXQgKDAsIGxpbmUp
OworICAgICAgcmV0dXJuOworICAgIH0KKyAgLyogcGFydCAxIC0gZmluZCB0
aGUgYXBwcm9wcmlhdGUgYnVja2V0IGJlZ2lubmluZyAqLworICBpZiAobGlu
ZXNbbGluZW5dLmdldF9jYXRlZ29yeSAoKSkKKyAgICB7CisgICAgICBuID0g
bGluZW4gKyAxOworICAgIH0KKyAgZWxzZSBpZiAobGluZXNbbGluZW5dLmdl
dF9wa2cgKCkpCisgICAgeworICAgICAgbiA9IGxpbmVuOworICAgICAgLyog
d2FsayB1cCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBidWNrZXQgKi8KKyAg
ICAgIHdoaWxlIChuID4gMCAmJiBsaW5lc1tuIC0gMV0uZ2V0X3BrZyAoKSkK
KwluLS07CisgICAgfQorICAvKiBwYXJ0IDIgLSBpbnNlcnQgaW4gc29ydGVk
IG9yZGVyIGluIHRoZSBidWNrZXQgKi8KKyAgd2hpbGUgKG4gPCBubGluZXMp
CisgICAgeworICAgICAgaWYgKGxpbmVzW25dLmdldF9jYXRlZ29yeSAoKSB8
fCAobGluZXNbbl0uZ2V0X3BrZyAoKQorCSAgJiYgc3RyY2FzZWNtcCAobGlu
ZS5nZXRfcGtnICgpLT5uYW1lLCBsaW5lc1tuXS5nZXRfcGtnICgpLT5uYW1l
KSA8IDApKQorCXsKKwkgIGluc2VydF9hdCAobiwgbGluZSk7CisJICBuID0g
bmxpbmVzOworCX0KKyAgICAgIGVsc2UgaWYgKGxpbmVzW25dLmdldF9wa2cg
KCkgPT0gbGluZS5nZXRfcGtnICgpKQorCXsKKwkgIG4gPSBubGluZXM7CisJ
fQorICAgICAgbisrOworICAgIH0KKyAgaWYgKG4gPT0gbmxpbmVzKQorICAg
IHsKKyAgICAgIC8qIGluc2VydCBhdCB0aGUgZW5kIG9mIHRoaXMgYnVja2V0
ICovCisgICAgICBpbnNlcnRfYXQgKG4sIGxpbmUpOworICAgIH0KK30KKwor
dm9pZAorX3ZpZXc6OmNsZWFyX3ZpZXcgKHZvaWQpCit7CisgIG5saW5lcyA9
IDA7Cit9CisKK3N0YXRpYyB2aWV3cwordmlld3NwbHVzcGx1cyh2aWV3cyB0
aGV2aWV3KQoreworICBzd2l0Y2ggKHRoZXZpZXcpCisgICAgeworICAgIGNh
c2UgVklFV19VTktOT1dOOiAgICAgIHJldHVybiBWSUVXX1BBQ0tBR0VfRlVM
TDsKKyAgICBjYXNlIFZJRVdfUEFDS0FHRV9GVUxMOiByZXR1cm4gVklFV19Q
QUNLQUdFOworICAgIGNhc2UgVklFV19QQUNLQUdFOiAgICAgIHJldHVybiBW
SUVXX0NBVEVHT1JZOworICAgIGNhc2UgVklFV19DQVRFR09SWTogICAgIHJl
dHVybiBOVklFVzsKKyAgICBkZWZhdWx0OiAgICAgICAgICAgICAgICByZXR1
cm4gVklFV19VTktOT1dOOworICAgIH0KK30KKworaW50Citfdmlldzo6Y2xp
Y2sgKGludCByb3csIGludCB4KQoreworICBpZiAocm93ID4gbmxpbmVzKQor
ICAgIHJldHVybiAwOworICBpZiAobGluZXNbcm93XS5nZXRfcGtnICgpKQor
ICAgIHJldHVybiBsaW5lc1tyb3ddLmNsaWNrICh4KTsKKyAgZWxzZQorICAg
IHsKKyAgICAgIC8qIGlmIHdlIGFyZSB0aGUgbGFzdCBsaW5lIG9yIHRoZSBu
ZXh0IGxpbmUgaXMgYSBjYXRlZ29yeSB0b28sIGV4cGFuZCAqLworICAgICAg
aWYgKHJvdyA9PSAobmxpbmVzIC0xKSB8fCBsaW5lc1tyb3cgKyAxXS5nZXRf
Y2F0ZWdvcnkgKCkpCisJeworCSAgaW50IGNvdW50ID0gbmxpbmVzOworCSAg
Zm9yIChDYXRlZ29yeVBhY2thZ2UgKmNhdHBrZyA9IGxpbmVzW3Jvd10uZ2V0
X2NhdGVnb3J5ICgpLT5wYWNrYWdlczsgY2F0cGtnOyBjYXRwa2cgPSBjYXRw
a2ctPm5leHQpCisJICAgIHsKKwkgICAgICBQYWNrYWdlICogcGtnID0gZ2V0
cGtnYnluYW1lIChjYXRwa2ctPnBrZyk7CisJICAgICAgaW50IG4gPSByb3cg
KyAxOworCSAgICAgIHBpY2tfbGluZSBsaW5lOworCSAgICAgIGxpbmUuc2V0
X2xpbmUgKHBrZyk7CisJICAgICAgLyogdGhpcyBpcyBhIG5hc3R5IGhhY2su
IEl0IHdpbGwgZ28gYXdheSB3aGVuIHRoZSBoaWVyYXJjaHkgaXMgY29kZWQg
Ki8KKwkgICAgICB3aGlsZSAobiA8IG5saW5lcykKKwkgICAgICAgIHsKKwkJ
ICBpZiAobGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpIHx8IChsaW5lc1tuXS5n
ZXRfcGtnICgpCisJCSAgICAgICYmIHN0cmNhc2VjbXAgKHBrZy0+bmFtZSwg
bGluZXNbbl0uZ2V0X3BrZyAoKS0+bmFtZSkgPCAwKSkKKwkJICAgIHsKKwkJ
ICAgICAgaW5zZXJ0X2F0IChuLCBsaW5lKTsKKwkJICAgICAgbiA9IG5saW5l
czsKKwkJICAgIH0KKwkJICBlbHNlIGlmIChsaW5lc1tuXS5nZXRfcGtnICgp
ID09IHBrZykKKwkJICAgIHsKKwkJICAgICAgbiA9IG5saW5lczsKKwkJICAg
IH0KKwkJICBuKys7CisJCX0KKwkgICAgICBpZiAobiA9PSBubGluZXMpCisJ
CXsKKwkJICAvKiBpbnNlcnQgYXQgdGhlIGVuZCBvZiB0aGlzIGNhdGVnb3J5
ICovCisJCSAgaW5zZXJ0X2F0IChuLCBsaW5lKTsKKwkJICBuPW5saW5lcyAr
IDE7CisJCX0KKwkgICAgfQorCSAgcmV0dXJuIG5saW5lcyAtIGNvdW50Owor
CX0KKyAgICAgIGVsc2UKKwkvKiBjb250cmFjdCAqLworCXsKKwkgIGludCBj
b3VudCA9IDAsIG4gPSByb3cgKyAxOworCSAgd2hpbGUgKG4gPCBubGluZXMg
JiEgbGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpKQorCSAgICB7CisJICAgICAg
bWVtbW92ZSAoJmxpbmVzW25dLCAmbGluZXNbbiArIDFdLCAobmxpbmVzIC0g
bikgKiBzaXplb2YgKHBpY2tfbGluZSkpOworCSAgICAgIG5saW5lcy0tOwor
CSAgICAgIGNvdW50Kys7CisJICAgIH0KKwkgIHJldHVybiBjb3VudDsKKwl9
CisgICAgfQorfQorCiAKLSAgaWYgKHBhY2thZ2VfaW5kZXhlcyA9PSAwKQot
ICAgIHBhY2thZ2VfaW5kZXhlcyA9IChpbnQgKikgbWFsbG9jIChucGFja2Fn
ZXMgKiBzaXplb2YgKGludCkpOworc3RhdGljIHZvaWQKK3NldF92aWV3X21v
ZGUgKEhXTkQgaCwgdmlld3MgbW9kZSkKK3sKKyAgaW50IGk7CisgIGNob29z
ZXItPnNldF92aWV3X21vZGUgKG1vZGUpOwogCi0gIG5pbmRleGVzID0gMDsK
KyAgY2hvb3Nlci0+Y2xlYXJfdmlldyAoKTsKICAgZm9yIChQYWNrYWdlICpw
a2cgPSBwYWNrYWdlOyBwa2ctPm5hbWU7IHBrZysrKQogICAgIGlmICghcGtn
LT5leGNsdWRlKQogICAgICAgewotCXNldF9hY3Rpb24gKHBrZywgMCk7Ci0J
aWYgKChpc2Z1bGwgfHwgaXNfZG93bmxvYWRfYWN0aW9uIChwa2cpKSkKLQkg
IHBhY2thZ2VfaW5kZXhlc1tuaW5kZXhlcysrXSA9IHBrZyAtIHBhY2thZ2U7
CisgICAgICAgIHNldF9hY3Rpb24gKHBrZywgMCk7CiAgICAgICB9CiAKKyAg
c3dpdGNoIChjaG9vc2VyLT5nZXRfdmlld19tb2RlICgpKQorICAgIHsKKyAg
ICBjYXNlIFZJRVdfUEFDS0FHRToKKyAgICAgIGZvciAoUGFja2FnZSAqcGtn
ID0gcGFja2FnZTsgcGtnLT5uYW1lOyBwa2crKykKKwlpZiAoIXBrZy0+ZXhj
bHVkZSAmJiBpc19kb3dubG9hZF9hY3Rpb24gKHBrZykpIAorCSAgY2hvb3Nl
ci0+aW5zZXJ0X3BrZyAocGtnKTsgCisgICAgICBicmVhazsKKyAgICBjYXNl
IFZJRVdfUEFDS0FHRV9GVUxMOgorICAgICAgZm9yIChQYWNrYWdlICpwa2cg
PSBwYWNrYWdlOyBwa2ctPm5hbWU7IHBrZysrKQorCWlmICghcGtnLT5leGNs
dWRlKSAKKwkgIGNob29zZXItPmluc2VydF9wa2cgKHBrZyk7IAorICAgICAg
YnJlYWs7CisgICAgY2FzZSBWSUVXX0NBVEVHT1JZOgorICAgICAgLyogc3Rh
cnQgY29sbGFwc2VkLiBUT0RPOiBtYWtlIHRoaXMgYSBjaG9vc2VyIGZsYWcg
Ki8KKyAgICAgIGZvciAoQ2F0ZWdvcnkgKmNhdCA9IGNhdGVnb3J5OyBjYXQ7
IGNhdCA9IGNhdC0+bmV4dCkKKwljaG9vc2VyLT5pbnNlcnRfY2F0ZWdvcnkg
KGNhdCwgQ0FURUdPUllfQ09MTEFQU0VEKTsKKyAgICAgIGJyZWFrOworICAg
IGRlZmF1bHQ6CisgICAgICBicmVhazsKKyAgICB9CisKICAgUkVDVCByOwog
ICBHZXRDbGllbnRSZWN0IChoLCAmcik7CiAgIFNDUk9MTElORk8gc2k7CkBA
IC01MTUsMTEgKzk5NCwxMSBAQCBzZXRfZnVsbF9saXN0IChIV05EIGgsIGlu
dCBpc2Z1bGwpCiAgIHNpLmNiU2l6ZSA9IHNpemVvZiAoc2kpOwogICBzaS5m
TWFzayA9IFNJRl9BTEw7CiAgIHNpLm5NaW4gPSAwOwotICBzaS5uTWF4ID0g
aGVhZGVyc1syXS54ICsgaGVhZGVyc1syXS53aWR0aCArIEhNQVJHSU47Cisg
IHNpLm5NYXggPSBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmxhc3RfY29s
XS54ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5sYXN0X2NvbF0ud2lk
dGggKyBITUFSR0lOOwogICBzaS5uUGFnZSA9IHIucmlnaHQ7CiAgIFNldFNj
cm9sbEluZm8gKGgsIFNCX0hPUlosICZzaSwgVFJVRSk7CiAKLSAgc2kubk1h
eCA9IG5pbmRleGVzICogcm93X2hlaWdodDsKKyAgc2kubk1heCA9IGNob29z
ZXItPm5saW5lcyAqIHJvd19oZWlnaHQ7CiAgIHNpLm5QYWdlID0gci5ib3R0
b20gLSBoZWFkZXJfaGVpZ2h0OwogICBTZXRTY3JvbGxJbmZvIChoLCBTQl9W
RVJULCAmc2ksIFRSVUUpOwogCkBAIC01NDYsMTAgKzEwMjUsNiBAQCBjcmVh
dGVfbGlzdHZpZXcgKEhXTkQgZGxnLCBSRUNUICpyKQogCQkgICAgICAgaGlu
c3RhbmNlLAogCQkgICAgICAgMCk7CiAgIFNob3dXaW5kb3cgKGx2LCBTV19T
SE9XKTsKLQotICBmb3IgKGkgPSAwOyBoZWFkZXJzW2ldLnRleHQ7IGkrKykK
LSAgICBoZWFkZXJzW2ldLndpZHRoID0gMDsKLQogICBIREMgZGMgPSBHZXRE
QyAobHYpOwogICBzeXNmb250ID0gR2V0U3RvY2tPYmplY3QgKERFRkFVTFRf
R1VJX0ZPTlQpOwogICBTZWxlY3RPYmplY3QgKGRjLCBzeXNmb250KTsKQEAg
LTU2MywzMCArMTAzOCwxNCBAQCBjcmVhdGVfbGlzdHZpZXcgKEhXTkQgZGxn
LCBSRUNUICpyKQogICBpZiAocm93X2hlaWdodCA8IGlyaCkKICAgICByb3df
aGVpZ2h0ID0gaXJoOwogCi0gIGZvciAoaSA9IDA7IGhlYWRlcnNbaV0udGV4
dDsgaSsrKQotICAgIG5vdGVfd2lkdGggKGRjLCBoZWFkZXJzW2ldLnRleHQs
IDAsIGkpOwotICBmb3IgKFBhY2thZ2UgKnBrZyA9IHBhY2thZ2U7IHBrZy0+
bmFtZTsgcGtnKyspCi0gICAgewotICAgICAgaWYgKHBrZy0+aW5zdGFsbGVk
KQotCXsKLQkgIG5vdGVfd2lkdGggKGRjLCBwa2ctPmluc3RhbGxlZC0+dmVy
c2lvbiwgMCwgQ1VSUkVOVF9DT0wpOwotCSAgbm90ZV93aWR0aCAoZGMsIHBr
Zy0+aW5zdGFsbGVkLT52ZXJzaW9uLCBORVdfQ09MX1NJWkVfU0xPUCwgTkVX
X0NPTCk7Ci0JfQotICAgICAgZm9yIChJbmZvICppbmYgPSBwa2ctPmluZm9z
Y2FuOyBpbmYgPCBwa2ctPmluZm9lbmQ7IGluZisrKQotCW5vdGVfd2lkdGgg
KGRjLCBpbmYtPnZlcnNpb24sIE5FV19DT0xfU0laRV9TTE9QLCBORVdfQ09M
KTsKLSAgICAgIG5vdGVfd2lkdGggKGRjLCBwa2ctPm5hbWUsIDAsIFBBQ0tB
R0VfQ09MKTsKLSAgICAgIG5vdGVfd2lkdGggKGRjLCBwa2ctPnNkZXNjLCAw
LCBQQUNLQUdFX0NPTCk7Ci0gICAgfQotICBub3RlX3dpZHRoIChkYywgImtl
ZXAiLCBORVdfQ09MX1NJWkVfU0xPUCwgTkVXX0NPTCk7Ci0gIG5vdGVfd2lk
dGggKGRjLCAidW5pbnN0YWxsIiwgTkVXX0NPTF9TSVpFX1NMT1AsIE5FV19D
T0wpOwotCi0gIGhlYWRlcnNbQ1VSUkVOVF9DT0xdLnggPSBITUFSR0lOLzI7
Ci0gIGhlYWRlcnNbTkVXX0NPTF0ueCA9IGhlYWRlcnNbQ1VSUkVOVF9DT0xd
LnggKyBoZWFkZXJzW0NVUlJFTlRfQ09MXS53aWR0aCArIE5FV19DT0xfU0la
RV9TTE9QICsgSE1BUkdJTjsKLSAgaGVhZGVyc1tTUkNfQ09MXS54ID0gaGVh
ZGVyc1tORVdfQ09MXS54ICsgaGVhZGVyc1tORVdfQ09MXS53aWR0aCArIEhN
QVJHSU47Ci0gIGhlYWRlcnNbUEFDS0FHRV9DT0xdLnggPSBoZWFkZXJzW1NS
Q19DT0xdLnggKyBoZWFkZXJzW1NSQ19DT0xdLndpZHRoICsgSE1BUkdJTjsK
KyAgY2hvb3NlciA9IG5ldyAodmlldykgKFZJRVdfUEFDS0FHRSwgZGMpOwog
CiAgIGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9DVVJSKTsKLSAgc2V0X2Z1
bGxfbGlzdCAobHYsIGZ1bGxfbGlzdCk7CisgIHNldF92aWV3X21vZGUgKGx2
LCBWSUVXX1BBQ0tBR0UpOworICBpZiAoIVNldERsZ0l0ZW1UZXh0IChkbGcs
IElEQ19DSE9PU0VfVklFV0NBUFRJT04sIGNob29zZXItPm1vZGVfY2FwdGlv
bigpKSkKKyAgICBsb2cgKExPR19CQUJCTEUsICJGYWlsZWQgdG8gc2V0IFZp
ZXcgYnV0dG9uIGNhcHRpb24gJWQiLCBHZXRMYXN0RXJyb3IoKSApOworICBm
b3IgKFBhY2thZ2UgKmZvbyA9IHBhY2thZ2U7IGZvby0+bmFtZTsgZm9vKysp
CisgICAgYWRkX3JlcXVpcmVkKGZvbyk7CiAgIHN0YXRpYyBpbnQgdGFbXSA9
IHsgSURDX0NIT09TRV9DVVJSLCAwIH07CiAgIHJic2V0IChkbGcsIHRhLCBJ
RENfQ0hPT1NFX0NVUlIpOwogCkBAIC02MDAsMTggKzEwNTksMjYgQEAgZGlh
bG9nX2NtZCAoSFdORCBoLCBpbnQgaWQsIEhXTkQgaHduZGN0bAogICAgIHsK
ICAgICBjYXNlIElEQ19DSE9PU0VfUFJFVjoKICAgICAgIGRlZmF1bHRfdHJ1
c3QgKGx2LCBUUlVTVF9QUkVWKTsKLSAgICAgIHNldF9mdWxsX2xpc3QgKGx2
LCBmdWxsX2xpc3QpOworICAgICAgZm9yIChQYWNrYWdlICpmb28gPSBwYWNr
YWdlOyBmb28tPm5hbWU7IGZvbysrKQorICAgICAgICBhZGRfcmVxdWlyZWQo
Zm9vKTsKKyAgICAgIHNldF92aWV3X21vZGUgKGx2LCBjaG9vc2VyLT5nZXRf
dmlld19tb2RlICgpKTsKICAgICAgIGJyZWFrOwogICAgIGNhc2UgSURDX0NI
T09TRV9DVVJSOgogICAgICAgZGVmYXVsdF90cnVzdCAobHYsIFRSVVNUX0NV
UlIpOwotICAgICAgc2V0X2Z1bGxfbGlzdCAobHYsIGZ1bGxfbGlzdCk7Cisg
ICAgICBmb3IgKFBhY2thZ2UgKmZvbyA9IHBhY2thZ2U7IGZvby0+bmFtZTsg
Zm9vKyspCisgICAgICAgIGFkZF9yZXF1aXJlZChmb28pOworICAgICAgc2V0
X3ZpZXdfbW9kZSAobHYsIGNob29zZXItPmdldF92aWV3X21vZGUgKCkpOwog
ICAgICAgYnJlYWs7CiAgICAgY2FzZSBJRENfQ0hPT1NFX0VYUDoKICAgICAg
IGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9URVNUKTsKLSAgICAgIHNldF9m
dWxsX2xpc3QgKGx2LCBmdWxsX2xpc3QpOworICAgICAgZm9yIChQYWNrYWdl
ICpmb28gPSBwYWNrYWdlOyBmb28tPm5hbWU7IGZvbysrKQorICAgICAgICBh
ZGRfcmVxdWlyZWQoZm9vKTsKKyAgICAgIHNldF92aWV3X21vZGUgKGx2LCBj
aG9vc2VyLT5nZXRfdmlld19tb2RlICgpKTsKICAgICAgIGJyZWFrOwotICAg
IGNhc2UgSURDX0NIT09TRV9GVUxMUEFSVDoKLSAgICAgIHNldF9mdWxsX2xp
c3QgKGx2LCAhZnVsbF9saXN0KTsKKyAgICBjYXNlIElEQ19DSE9PU0VfVklF
VzoKKyAgICAgIHNldF92aWV3X21vZGUgKGx2LCB2aWV3c3BsdXNwbHVzIChj
aG9vc2VyLT5nZXRfdmlld19tb2RlICgpKSk7CisgICAgICBpZiAoIVNldERs
Z0l0ZW1UZXh0IChoLCBJRENfQ0hPT1NFX1ZJRVdDQVBUSU9OLCBjaG9vc2Vy
LT5tb2RlX2NhcHRpb24oKSkpCisJbG9nIChMT0dfQkFCQkxFLCAiRmFpbGVk
IHRvIHNldCBWaWV3IGJ1dHRvbiBjYXB0aW9uICVkIiwgR2V0TGFzdEVycm9y
KCkgKTsKICAgICAgIGJyZWFrOwogCiAgICAgY2FzZSBJRE9LOgpAQCAtNzg5
LDYgKzEyNTYsMjggQEAgZ2V0cGtnYnluYW1lIChjb25zdCBjaGFyICpwa2du
YW1lKQogICByZXR1cm4gTlVMTDsKIH0KIAorLyogUmV0dXJuIGEgcG9pbnRl
ciB0byBhIGNhdGVnb3J5IGdpdmVuIHRoZSBuYW1lLiAqLworQ2F0ZWdvcnkg
KgorZ2V0Y2F0ZWdvcnlieW5hbWUgKGNvbnN0IGNoYXIgKmNhdGVnb3J5bmFt
ZSkKK3sKKyAgZm9yIChDYXRlZ29yeSAqY2F0ID0gY2F0ZWdvcnk7IGNhdDsg
Y2F0PWNhdC0+bmV4dCkKKyAgICBpZiAoc3RyY2FzZWNtcCAoY2F0LT5uYW1l
LCBjYXRlZ29yeW5hbWUpID09IDApCisgICAgICByZXR1cm4gY2F0OworCisg
IHJldHVybiBOVUxMOworfQorCisvKiBSZXR1cm4gYSBwb2ludGVyIHRvIGEg
Y2F0ZWdvcnkgb2YgYSBnaXZlbiBwYWNrYWdlIGdpdmVuIHRoZSBuYW1lLiAq
LworQ2F0ZWdvcnkgKgorZ2V0cGFja2FnZWNhdGVnb3J5YnluYW1lIChQYWNr
YWdlICpwa2csIGNvbnN0IGNoYXIgKmNhdGVnb3J5bmFtZSkKK3sKKyAgZm9y
IChDYXRlZ29yeSAqY2F0ID0gcGtnLT5jYXRlZ29yeTsgY2F0OyBjYXQgPSBj
YXQtPm5leHQpCisgICAgaWYgKHN0cmNhc2VjbXAgKGNhdC0+bmFtZSwgY2F0
ZWdvcnluYW1lKSA9PSAwKQorICAgICAgcmV0dXJuIGNhdDsKKworICByZXR1
cm4gTlVMTDsKK30KKwogc3RhdGljIHZvaWQKIHNjYW4yIChjaGFyICpwYXRo
LCB1bnNpZ25lZCBpbnQgc2l6ZSkKIHsKQEAgLTkyMSw3ICsxNDEwLDcgQEAg
cGFja2FnZV9zb3J0IChjb25zdCB2b2lkICp2YSwgY29uc3Qgdm9pZAogewog
ICBQYWNrYWdlICphID0gKFBhY2thZ2UgKil2YTsKICAgUGFja2FnZSAqYiA9
IChQYWNrYWdlICopdmI7Ci0gIHJldHVybiBzdHJjbXAgKGEtPm5hbWUsIGIt
Pm5hbWUpOworICByZXR1cm4gc3RyY2FzZWNtcCAoYS0+bmFtZSwgYi0+bmFt
ZSk7CiB9CiAKIHZvaWQKQEAgLTk0NCw2ICsxNDMzLDcgQEAgZG9fY2hvb3Nl
IChISU5TVEFOQ0UgaCkKIAogICByZWFkX2luc3RhbGxlZF9kYiAoKTsKICAg
c2V0X2V4aXN0ZW5jZSAoKTsKKyAgZmlsbF9taXNzaW5nX2NhdGVnb3J5ICgp
OwogCiAgIHFzb3J0IChwYWNrYWdlLCBucGFja2FnZXMsIHNpemVvZiAocGFj
a2FnZVswXSksIHBhY2thZ2Vfc29ydCk7CiAKQEAgLTk2Nyw5ICsxNDU3LDEw
IEBAIGRvX2Nob29zZSAoSElOU1RBTkNFIGgpCiAJCQkgICAgICAgOiAidW5r
bm93biIpOwogICAgICAgY29uc3QgY2hhciAqZXhjbHVkZWQgPSAocGtnLT5l
eGNsdWRlID8gInllcyIgOiAibm8iKTsKIAotICAgICAgbG9nIChMT0dfQkFC
QkxFLCAiWyVzXSBhY3Rpb249JXMgdHJ1c3Q9JXMgaW5zdGFsbGVkPSVzIGV4
Y2x1ZGVkPSVzIHNyYz89JXMiLAorICAgICAgbG9nIChMT0dfQkFCQkxFLCAi
WyVzXSBhY3Rpb249JXMgdHJ1c3Q9JXMgaW5zdGFsbGVkPSVzIGV4Y2x1ZGVk
PSVzIHNyYz89JXMiCisJICAgImNhdGVnb3J5PSVzIiwKIAkgICBwa2ctPm5h
bWUsIGFjdGlvbiwgdHJ1c3QsIGluc3RhbGxlZCwKLQkgICBleGNsdWRlZCwg
cGtnLT5zcmNwaWNrZWQgPyAieWVzIiA6ICJubyIpOworCSAgIGV4Y2x1ZGVk
LCBwa2ctPnNyY3BpY2tlZCA/ICJ5ZXMiIDogIm5vIiwgcGtnLT5jYXRlZ29y
eSk7CiAgICAgICBmb3IgKGludCB0ID0gMTsgdCA8IE5UUlVTVDsgdCsrKQog
CXsKIAkgIGlmIChwa2ctPmluZm9bdF0uaW5zdGFsbCkKSW5kZXg6IGluaS5o
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3Ny
Yy93aW5zdXAvY2luc3RhbGwvaW5pLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9u
IDIuMTIKZGlmZiAtdSAtcCAtcjIuMTIgaW5pLmgKLS0tIGluaS5oCTIwMDEv
MDYvMTggMDA6NDM6NTcJMi4xMgorKysgaW5pLmgJMjAwMS8wNi8yNCAwMTo0
NzoyMQpAQCAtMTMsNiArMTMsOSBAQAogICoKICAqLwogCisjaWZuZGVmIF9J
TklfSF8KKyNkZWZpbmUgX0lOSV9IXworCiAvKiBXaGVuIHNldHVwLmluaSBp
cyBwYXJzZWQsIHRoZSBpbmZvcm1hdGlvbiBpcyBzdG9yZWQgYWNjb3JkaW5n
IHRvCiAgICB0aGUgZGVjbGFyYXRpb25zIGhlcmUuICBpbmkuY2MgKHZpYSBp
bmlsZXggYW5kIGluaXBhcnNlKQogICAgaW5pdGlhbGl6ZXMgdGhlc2Ugc3Ry
dWN0dXJlcy4gIGNob29zZS5jYyBzZXRzIHRoZSBhY3Rpb24gYW5kIHRydXN0
CkBAIC02Miw2ICs2NSwxNSBAQCB0eXBlZGVmIGVudW0KICAgRVhDTFVERV9O
T1RfRk9VTkQKIH0gZXhjbHVkZXM7CiAKK3R5cGVkZWYgZW51bSAKK3sKKyAg
VklFV19VTktOT1dOLAorICBWSUVXX1BBQ0tBR0VfRlVMTCwKKyAgVklFV19Q
QUNLQUdFLAorICBWSUVXX0NBVEVHT1JZLAorICBOVklFVworfSB2aWV3czsK
KwogI2RlZmluZSBpc19kb3dubG9hZF9hY3Rpb24ocGtnKSBcCiAgICgocGtn
KS0+YWN0aW9uID09IEFDVElPTl9QUkVWIHx8IFwKICAgIChwa2cpLT5hY3Rp
b24gPT0gQUNUSU9OX0NVUlIgfHwgXApAQCAtOTcsNiArMTA5LDE5IEBAIHR5
cGVkZWYgc3RydWN0IF9JbmZvCiAjZW5kaWYKIH0gSW5mbzsJCQkvKiArMSBm
b3IgVFJVU1RfVU5LTk9XTiAqLwogCit0eXBlZGVmIHN0cnVjdCBfQ2F0ZWdv
cnlQYWNrYWdlCit7CisgIHN0cnVjdCBfQ2F0ZWdvcnlQYWNrYWdlICpuZXh0
OyAgLyogVGhlIG5leHQgcGFja2FnZSBwb2ludGVyIGluIHRoZSBsaXN0ICov
CisgIGNoYXIgKnBrZzsJCQkgIC8qIFRoaXMgc2hvdWxkIGJlIFBhY2thZ2Ug
KiwgYnV0IHRoZSBwYWNrYWdlcyBjYW4gbW92ZSovCit9IENhdGVnb3J5UGFj
a2FnZTsKKwordHlwZWRlZiBzdHJ1Y3QgX0NhdGVnb3J5Cit7CisgIHN0cnVj
dCBfQ2F0ZWdvcnkgKm5leHQ7IC8qIHRoZSBuZXh0IGNhdGVnb3J5IGluIHRo
ZSBsaXN0ICovCisgIGNoYXIgKm5hbWU7CQkgIC8qIHRoZSBjYXRlZ29yeSAq
LworICBDYXRlZ29yeVBhY2thZ2UgKnBhY2thZ2VzOyAvKiB0aGUgcGFja2Fn
ZXMgaW4gdGhpcyBjYXRlZ29yeSAqLworfSBDYXRlZ29yeTsKKwogdHlwZWRl
ZiBzdHJ1Y3QgX0RlcGVuZGVuY3kKIHsKICAgc3RydWN0IF9EZXBlbmRlbmN5
ICpuZXh0OyAvKiB0aGUgbmV4dCBwYWNrYWdlIGluIHRoaXMgZGVwZW5kZW5j
eSBsaXN0ICovCkBAIC0xMDgsNyArMTMzLDcgQEAgdHlwZWRlZiBzdHJ1Y3QK
ICAgY2hhciAqbmFtZTsJCS8qIHBhY2thZ2UgbmFtZSwgbGlrZSAiY3lnd2lu
IiAqLwogICBjaGFyICpzZGVzYzsJCS8qIHNob3J0IGRlc2NyaXB0aW9uIChy
ZXBsYWNlcyAibmFtZSIgaWYgcHJvdmlkZWQpICovCiAgIGNoYXIgKmxkZXNj
OwkJLyogbG9uZyBkZXNjcmlwdGlvbiAobXVsdGktbGluZSkgKi8KLSAgY2hh
ciAqY2F0ZWdvcnk7IC8qIHRoZSBjYXRlZ29yeSB0aGUgcGFja2FnZSBiZWxv
bmdzIHRvLCBsaWtlICJyZXF1aXJlZCIgb3IgIlhGcmVlODYiICovCisgIENh
dGVnb3J5ICpjYXRlZ29yeTsgICAvKiB0aGUgY2F0ZWdvcmllcyB0aGUgcGFj
a2FnZSBiZWxvbmdzIHRvICovIAogICBEZXBlbmRlbmN5ICpyZXF1aXJlZDsg
LyogdGhlIHBhY2thZ2VzIHJlcXVpcmVkIGZvciB0aGlzIHBhY2thZ2UgdG8g
d29yayAqLwogICBhY3Rpb25zIGFjdGlvbjsJLyogQSByYW5nZSBvZiBzdGF0
ZXMgYXBwbGljYWJsZSB0byB0aGlzIHBhY2thZ2UgKi8KICAgdHJ1c3RzIHRy
dXN0OwkJLyogU2VsZWN0cyBhbW9uZyBpbmZvW10gYmVsb3csIGEgc3Vic2V0
IG9mIGFjdGlvbiAqLwpAQCAtMTI5LDYgKzE1NCw4IEBAIHR5cGVkZWYgc3Ry
dWN0CiAKIGV4dGVybiBQYWNrYWdlICpwYWNrYWdlOwogZXh0ZXJuIGludCBu
cGFja2FnZXM7CitleHRlcm4gQ2F0ZWdvcnkgKmNhdGVnb3J5OworZXh0ZXJu
IGludCBuY2F0ZWdvcmllczsKIAogI2lmZGVmIF9fY3BsdXNwbHVzCiBleHRl
cm4gIkMiIHsKQEAgLTEzOCw3ICsxNjUsMTMgQEAgUGFja2FnZSAqbmV3X3Bh
Y2thZ2UgKGNoYXIgKm5hbWUpOwogdm9pZAlpbmlfaW5pdCAoY2hhciAqc3Ry
aW5nKTsKIFBhY2thZ2UgKmdldHBrZ2J5bmFtZSAoY29uc3QgY2hhciAqcGtn
bmFtZSk7CiB2b2lkICAgIG5ld19yZXF1aXJlbWVudCAoUGFja2FnZSAqcGFj
a2FnZSwgY2hhciAqZGVwZW5kc29uKTsKK0NhdGVnb3J5ICpnZXRjYXRlZ29y
eWJ5bmFtZSAoY29uc3QgY2hhciAqY2F0ZWdvcnluYW1lKTsKK0NhdGVnb3J5
ICpnZXRwYWNrYWdlY2F0ZWdvcnlieW5hbWUgKFBhY2thZ2UgKnBrZywgY29u
c3QgY2hhciAqY2F0ZWdvcnluYW1lKTsgCitDYXRlZ29yeSAqcmVnaXN0ZXJf
Y2F0ZWdvcnkgKGNoYXIgKm5hbWUpOwordm9pZCAgICBhZGRfY2F0ZWdvcnkg
KFBhY2thZ2UgKnBhY2thZ2UsIENhdGVnb3J5ICpjYXQpOwogCiAjaWZkZWYg
X19jcGx1c3BsdXMKIH0KICNlbmRpZgorCisjZW5kaWYgLyogX0lOSV9IXyAq
LwpJbmRleDogaW5pcGFyc2UueQo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL2luaXBhcnNl
LnksdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuOQpkaWZmIC11IC1wIC1yMi45
IGluaXBhcnNlLnkKLS0tIGluaXBhcnNlLnkJMjAwMS8wNi8xNSAwNDowNToz
MQkyLjkKKysrIGluaXBhcnNlLnkJMjAwMS8wNi8yNCAwMTo0NzoyMQpAQCAt
ODYsNyArODYsOCBAQCBzaW1wbGVfbGluZQogIDogVkVSU0lPTiBTVFJJTkcJ
CXsgY3B0LT52ZXJzaW9uID0gJDI7IH0KICB8IFNERVNDIFNUUklORwkJCXsg
Y3AtPnNkZXNjID0gJDI7IH0KICB8IExERVNDIFNUUklORwkJCXsgY3AtPmxk
ZXNjID0gJDI7IH0KLSB8IENBVEVHT1JZIFNUUklORwkJeyBjcC0+Y2F0ZWdv
cnkgPSAkMjsgfQorIHwgQ0FURUdPUlkgU1RSSU5HCQl7IGFkZF9jYXRlZ29y
eSAoY3AsIHJlZ2lzdGVyX2NhdGVnb3J5ICgkMikpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB9CiAgfCBSRVFVSVJFUyByZXF1aXJlcwog
IHwgSU5TVEFMTCBTVFJJTkcgU1RSSU5HCXsgY3B0LT5pbnN0YWxsID0gJDI7
CiAJCQkJICBjcHQtPmluc3RhbGxfc2l6ZSA9IGF0b2koJDMpOwpAQCAtMTIx
LDExICsxMjIsMTMgQEAgcmVxdWlyZXMKIFBhY2thZ2UgKnBhY2thZ2UgPSBO
VUxMOwogaW50IG5wYWNrYWdlcyA9IDA7CiBzdGF0aWMgaW50IG1heHBhY2th
Z2VzID0gMDsKK0NhdGVnb3J5ICpjYXRlZ29yeSA9IE5VTEw7CitpbnQgbmNh
dGVnb3JpZXMgPSAwOwogCiBQYWNrYWdlICoKIG5ld19wYWNrYWdlIChjaGFy
ICpuYW1lKQogewotICBpZiAocGFja2FnZSA9PSAwKQorICBpZiAocGFja2Fn
ZSA9PSBOVUxMKQogICAgIG1heHBhY2thZ2VzID0gbnBhY2thZ2VzID0gMDsK
ICAgaWYgKG5wYWNrYWdlcyA+PSBtYXhwYWNrYWdlcykKICAgICB7CkBAIC0x
NDksNyArMTUyLDcgQEAgbmV3X3BhY2thZ2UgKGNoYXIgKm5hbWUpCiB9CiAK
IHZvaWQKLW5ld19yZXF1aXJlbWVudChQYWNrYWdlICpwYWNrYWdlLCBjaGFy
ICpkZXBlbmRzb24pCituZXdfcmVxdWlyZW1lbnQgKFBhY2thZ2UgKnBhY2th
Z2UsIGNoYXIgKmRlcGVuZHNvbikKIHsKICAgRGVwZW5kZW5jeSAqZHA7CiAg
IGlmICghZGVwZW5kc29uKQpAQCAtMTU4LDQgKzE2MSw1OCBAQCBuZXdfcmVx
dWlyZW1lbnQoUGFja2FnZSAqcGFja2FnZSwgY2hhciAqCiAgIGRwLT5uZXh0
ID0gY3AtPnJlcXVpcmVkOwogICBkcC0+cGFja2FnZSA9IGRlcGVuZHNvbjsK
ICAgY3AtPnJlcXVpcmVkID0gZHA7Cit9CisKK0NhdGVnb3J5ICoKK3JlZ2lz
dGVyX2NhdGVnb3J5IChjaGFyICpuYW1lKQoreworICBDYXRlZ29yeSAqdGVt
cGNhdDsKKyAgaWYgKGNhdGVnb3J5ID09IE5VTEwpCisgICAgbmNhdGVnb3Jp
ZXMgPSAwOworICB0ZW1wY2F0ID0gZ2V0Y2F0ZWdvcnlieW5hbWUgKG5hbWUp
OworICBpZiAoIXRlbXBjYXQpCisgICAgeworICAgICAgQ2F0ZWdvcnkgKnNv
cnRjYXQgPSBjYXRlZ29yeTsKKyAgICAgIHRlbXBjYXQgPSBuZXcgKENhdGVn
b3J5KTsKKyAgICAgIG1lbXNldCAodGVtcGNhdCwgJ1wwJywgc2l6ZW9mIChD
YXRlZ29yeSkpOworICAgICAgdGVtcGNhdC0+bmFtZSA9IHN0cmR1cCAobmFt
ZSk7CisgICAgICBpZiAoIXNvcnRjYXQgfHwgc3RyY2FzZWNtcChzb3J0Y2F0
LT5uYW1lLCBuYW1lKSA+IDApCisJeworCSAgdGVtcGNhdC0+bmV4dCA9IGNh
dGVnb3J5OworCSAgY2F0ZWdvcnkgPSB0ZW1wY2F0OworCX0KKyAgICAgIGVs
c2UKKwl7CisJICB3aGlsZSAoc29ydGNhdC0+bmV4dCAmJiAKKwkJIHN0cmNh
c2VjbXAoc29ydGNhdC0+bmV4dC0+bmFtZSwgdGVtcGNhdC0+bmFtZSkgPCAw
KQorCSAgICB7CisJICAgICAgdGVtcGNhdC0+bmV4dCA9IHNvcnRjYXQtPm5l
eHQ7CisJICAgICAgc29ydGNhdC0+bmV4dCA9IHRlbXBjYXQ7CisJICAgIH0K
Kwl9CisgICAgICBuY2F0ZWdvcmllcysrOworICAgIH0KKyAgcmV0dXJuIHRl
bXBjYXQ7Cit9CisKK3ZvaWQKK2FkZF9jYXRlZ29yeSAoUGFja2FnZSAqcGFj
a2FnZSwgQ2F0ZWdvcnkgKmNhdCkKK3sKKyAgLyogYWRkIGEgbmV3IHJlY29y
ZCBmb3IgdGhlIHBhY2thZ2UgbGlzdCAqLworICAvKiBUT0RPOiBhbHBhYmV0
aWNhbCBpbnNlcnRzID8gKi8KKyAgQ2F0ZWdvcnkgKnRlbXBjYXQ7CisgIENh
dGVnb3J5UGFja2FnZSAqdGVtcGxpbms7CisgIHRlbXBjYXQgPSBuZXcgKENh
dGVnb3J5KTsKKyAgbWVtc2V0ICh0ZW1wY2F0LCAnXDAnLCBzaXplb2YgKENh
dGVnb3J5KSk7CisgIHRlbXBjYXQtPm5leHQgPSBwYWNrYWdlLT5jYXRlZ29y
eTsKKyAgdGVtcGNhdC0+bmFtZSA9IGNhdC0+bmFtZTsKKyAgcGFja2FnZS0+
Y2F0ZWdvcnkgPSB0ZW1wY2F0OworCisgIHRlbXBsaW5rID0gbmV3IChDYXRl
Z29yeVBhY2thZ2UpOworICB0ZW1wbGluay0+bmV4dCA9IGNhdC0+cGFja2Fn
ZXM7CisgIHRlbXBsaW5rLT5wa2cgPSBwYWNrYWdlLT5uYW1lOworICBjYXQt
PnBhY2thZ2VzID0gdGVtcGxpbms7CisgCisgIC8qIGhhY2sgdG8gZW5zdXJl
IHdlIGFsbG9jYXRlIGVub3VnaCBzcGFjZSAqLworICBuY2F0ZWdvcmllcysr
OyAKIH0KSW5kZXg6IHJlcy5yYwo9PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJD
UyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxsL3Jlcy5yYyx2
CnJldHJpZXZpbmcgcmV2aXNpb24gMi4yMApkaWZmIC11IC1wIC1yMi4yMCBy
ZXMucmMKLS0tIHJlcy5yYwkyMDAxLzA1LzI4IDA4OjMxOjAyCTIuMjAKKysr
IHJlcy5yYwkyMDAxLzA2LzI0IDAxOjQ3OjIxCkBAIC0yNDAsNyArMjQwLDgg
QEAgQkVHSU4KICAgICBDT05UUk9MICAgICAgICAgIlNQSU4iLElEQ19TVEFU
SUMsIlN0YXRpYyIsU1NfQklUTUFQLDU1LDE3MCwxNSwxMwogICAgIExURVhU
ICAgICAgICAgICAiPSBjbGljayB0byBjaG9vc2UgYWN0aW9uLCAocCkgPSBw
cmV2aW91cyB2ZXJzaW9uLCAoeCkgPSBleHBlcmltZW50YWwiLAogICAgICAg
ICAgICAgICAgICAgICBJRENfU1RBVElDLDY1LDE3MCwyMjAsOAotICAgIFBV
U0hCVVRUT04gICAgICAiRnVsbC9QYXJ0IixJRENfQ0hPT1NFX0ZVTExQQVJU
LDI4Myw1LDM1LDEwCisgICAgUFVTSEJVVFRPTiAgICAgICJWaWV3IixJRENf
Q0hPT1NFX1ZJRVcsMjc4LDUsMjAsMTAKKyAgICBMVEVYVCAgICAgICAgICAg
IiIsICAgSURDX0NIT09TRV9WSUVXQ0FQVElPTiwgMzAwLDUsMzAsMTAKICAg
ICBDT05UUk9MICAgICAgICAgIkUmeHAiLElEQ19DSE9PU0VfRVhQLCJCdXR0
b24iLEJTX0FVVE9SQURJT0JVVFRPTiB8IAogICAgICAgICAgICAgICAgICAg
ICBXU19HUk9VUCwyNDgsNSwyNSwxMAogICAgIENPTlRST0wgICAgICAgICAi
JkN1cnIiLElEQ19DSE9PU0VfQ1VSUiwiQnV0dG9uIixCU19BVVRPUkFESU9C
VVRUT04sMjIyLApJbmRleDogcmVzb3VyY2UuaAo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2NpbnN0YWxs
L3Jlc291cmNlLmgsdgpyZXRyaWV2aW5nIHJldmlzaW9uIDIuMTEKZGlmZiAt
dSAtcCAtcjIuMTEgcmVzb3VyY2UuaAotLS0gcmVzb3VyY2UuaAkyMDAxLzA1
LzI4IDA4OjMxOjAyCTIuMTEKKysrIHJlc291cmNlLmgJMjAwMS8wNi8yNCAw
MTo0NzoyMQpAQCAtODQsNyArODQsNyBAQAogI2RlZmluZSBJRENfTkVUX1BB
U1NXRCAgICAgICAgICAgICAgICAgIDEwMzEKICNkZWZpbmUgSURDX1ZFUlNJ
T04gICAgICAgICAgICAgICAgICAgICAxMDMzCiAjZGVmaW5lIElEQ19MSVNU
VklFV19QT1MgICAgICAgICAgICAgICAgMTAzNAotI2RlZmluZSBJRENfQ0hP
T1NFX0ZVTExQQVJUICAgICAgICAgICAgIDEwMzUKKyNkZWZpbmUgSURDX0NI
T09TRV9WSUVXICAgICAgICAgICAgICAgICAxMDM1CiAjZGVmaW5lIElEQ19D
SE9PU0VfRVhQICAgICAgICAgICAgICAgICAgMTAzNgogI2RlZmluZSBJRENf
Q0hPT1NFX0NVUlIgICAgICAgICAgICAgICAgIDEwMzcKICNkZWZpbmUgSURD
X0NIT09TRV9QUkVWICAgICAgICAgICAgICAgICAxMDM4CkBAIC0xMDAsNiAr
MTAwLDcgQEAKICNkZWZpbmUgSURDX0RMU19QUFJPR1JFU1NfVEVYVCAgICAg
ICAgICAxMDQ4CiAjZGVmaW5lIElEQ19ETFNfSVBST0dSRVNTX1RFWFQgICAg
ICAgICAgMTA0OQogI2RlZmluZSBJRENfQ0hPT1NFX0lOU1RfVEVYVCAgICAg
IDEwNTAKKyNkZWZpbmUgSURDX0NIT09TRV9WSUVXQ0FQVElPTiAgICAgICAg
ICAxMDUxCiAjZGVmaW5lIElEQ19TVEFUSUMgICAgICAgICAgICAgICAgICAg
ICAgLTEKIAogLy8gTmV4dCBkZWZhdWx0IHZhbHVlcyBmb3IgbmV3IG9iamVj
dHMKQEAgLTExMCw3ICsxMTEsNyBAQAogI2RlZmluZSBfQVBTXzNEX0NPTlRS
T0xTICAgICAgICAgICAgICAgICAgICAgMQogI2RlZmluZSBfQVBTX05FWFRf
UkVTT1VSQ0VfVkFMVUUgICAgICAgIDEyNwogI2RlZmluZSBfQVBTX05FWFRf
Q09NTUFORF9WQUxVRSAgICAgICAgIDQwMDAzCi0jZGVmaW5lIF9BUFNfTkVY
VF9DT05UUk9MX1ZBTFVFICAgICAgICAgMTA1MQorI2RlZmluZSBfQVBTX05F
WFRfQ09OVFJPTF9WQUxVRSAgICAgICAgIDEwNTIKICNkZWZpbmUgX0FQU19O
RVhUX1NZTUVEX1ZBTFVFICAgICAgICAgICAxMDEKICNlbmRpZgogI2VuZGlm
Cg==

------------=_1583532848-65438-78--
