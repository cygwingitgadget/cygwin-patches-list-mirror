From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-patches@cygwin.com>
Subject: FW: sched* functions, pthread rework
Date: Tue, 20 Mar 2001 17:57:00 -0000
Message-id: <EA18B9FA0FE4194AA2B4CDB91F73C0EF79A8@itdomain002.itdomain.net.au>
X-SW-Source: 2001-q1/msg00219.html
Content-type: multipart/mixed; boundary="----------=_1583532846-65438-27"

This is a multi-part message in MIME format...

------------=_1583532846-65438-27
Content-length: 433

For clarity: the sched* functions are not thread related and should be
in cygwin1.dll even when it's built non threaded..
 
New files: sched.cc, include/semaphore.h, include/sched.h
 
Changelog:
21 Mar 2001 Robert Collins <rbtcollins@hotmail.com>
    * sched.cc: New file. Implement sched*
    * include/sched.h: New file. User land includes for sched*.
    * Makefile.in: Add sched.o
    * cygwin.din: Add exports for sched*.

Rob


------------=_1583532846-65438-27
Content-Type: text/x-c; charset=us-ascii; name="sched.cc"
Content-Disposition: inline; filename="sched.cc"
Content-Transfer-Encoding: base64
Content-Length: 12078

Lyogc2NoZWR1bGUuY2M6IHNjaGVkdWxlciBpbnRlcmZhY2UgZm9yIEN5Z3dp
bgoKICAgQ2hyaXMsIHRpcmVkIG9mICBjb3B5cnJpZ2h0IGxpbmVzIHlldD8K
CiAgIFdyaXR0ZW4gYnkgUm9iZXJ0IENvbGxpbnMgPHJidGNvbGxpbnNAaG90
bWFpbC5jb20+CgogICBUaGlzIGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCgog
ICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29yayBsaWNlbnNl
ZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCiAgIEN5Z3dpbiBsaWNlbnNlLiAg
UGxlYXNlIGNvbnN1bHQgdGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IK
ICAgZGV0YWlscy4gKi8KCiNpZmRlZiBIQVZFX0NPTkZJR19ICiMgaW5jbHVk
ZSAiY29uZmlnLmgiCiNlbmRpZgoKI2luY2x1ZGUgIndpbnN1cC5oIgojaW5j
bHVkZSA8bGltaXRzLmg+CiNpbmNsdWRlIDxlcnJuby5oPgojaW5jbHVkZSAi
Y3lnZXJybm8uaCIKI2luY2x1ZGUgPGFzc2VydC5oPgojaW5jbHVkZSA8c3Rk
bGliLmg+CiNpbmNsdWRlIDxzeXNsb2cuaD4KI2luY2x1ZGUgPHNjaGVkLmg+
CiNpbmNsdWRlICJzaWdwcm9jLmgiCiNpbmNsdWRlICJwaW5mby5oIgovKiBm
b3IgZ2V0cGlkICovCiNpbmNsdWRlIDx1bmlzdGQuaD4KCgovKiBXaW4zMiBw
cmlvcml0eSB0byBVTklYIHByaW9yaXR5IE1hcHBpbmcuCiAqIEZvciBub3cs
IEknbSBqdXN0IGZvbGxvd2luZyB0aGUgc3BlYzogYW55IHJhbmdlIG9mIHBy
aW9yaXRpZXMgaXMgb2suCiAqIFRoZXJlIGFyZSBwcm9iYWJseSBtYW55IG1h
bnkgaXNzdWVzIHdpdGggdGhpcy4uLgogKgogKiBXZSBkb24ndCB3YW50IHBy
b2Nlc3MncyBnb2luZyByZWFsdGltZS4gV2VsbCwgdGhleSBwcm9iYWJseSBj
b3VsZCwgYnV0IHRoZSBpc3N1ZXMgCiAqIHdpdGggYXZvaWRpbmcgdGhlIHBy
aW9yaXR5IHZhbHVlcyAxNy0yMiBhbmQgMjctMzAgKG5vdCBzdXBwb3J0ZWQg
YmVmb3JlIHdpbjJrKQogKiBtYWtlIHRoYXQgaW5lZmZpY2llbnQuIAogKiBI
b3dldmVyIHRvIGNvbXBsaWNhdGUgdGhpbmdzIG1vc3QgdW5peGVzIHVzZSBs
b3dlciBpcyBiZXR0ZXIgcHJpb3JpdGllcy4KICoKICogU28gd2UgbWFwIC0x
NCB0byAxNSwgYW5kIDE1IHRvIDEgdmlhICgxNi0gKChuKzE2KSA+PiAxKSkg
CiAqIHdlIHRoZW4gbWFwIDEgdG8gMTUgdG8gdmFyaW91cyBwcm9jZXNzIGNs
YXNzIGFuZCB0aHJlYWQgcHJpb3JpdHkgY29tYmluYXRpb25zCiAqCiAqIFRo
ZW4gd2UgbmVlZCB0byBsb29rIGF0IHRoZSB0aHJlYWRzIHZpIHByb2Nlc3Mg
cHJpb3JpdHkuIEFzIHdpbjk1IDk4IGFuZCBOVCA0IAogKiBEb24ndCBzdXBw
b3J0IG9wZW5pbmcgdGhyZWFkcyBjcm9zcy1wcm9jZXNzICh1bmxlc3MgYSB0
aHJlYWQgSEFORExFIGlzIHBhc3NlZCBhcm91bmQpCiAqIGZvciBub3csIHdl
J2xsIGp1c3QgdXNlIHRoZSBwcmlvcml0eSBjbGFzcy4gCiAqCiAqIFRoZSBj
b2RlIGFuZCBsb2dpYyBhcmUgcHJlc2VudCB0byBjYWxjdWxhdGUgdGhlIHBy
aW9yaXR5IGZvciB0aHJlYWQKICogLCBpZiBhIHRocmVhZCBoYW5kbGUgY2Fu
IGJlIG9idGFpbmVkLiBBbHRlcm5hdGl2ZWx5LCBpZiB0aGUgc3ltYm9scyB3
b3VsZG4ndCBiZSAKICogcmVzb2x2ZWQgdW50aWwgdGhleSBhcmUgdXNlZAog
KiB3ZSBjb3VsZCBzdXBwb3J0IHRoaXMgb24gd2luZG93cyAyMDAwIGFuZCBN
RSBub3csIGFuZCBqdXN0IGZhbGwgYmFjayB0byB0aGUgCiAqIGNsYXNzIG9u
bHkgb24gcHJlIHdpbjIwMDAgbWFjaGluZXMuCiAqCiAqIExhc3RseSwgYmVj
YXVzZSB3ZSBjYW4ndCBhc3N1bWUgdGhhdCB0aGUgcGlkIHdlJ3JlIGdpdmVu
IGFyZSBXaW5kb3dzIHBpZHMsIHdlIGNhbid0CiAqIGFsdGVyIG5vbi1jeWd3
aW4gc3RhcnRlZCBwcm9ncmFtcy4gCiAqLwoKZXh0ZXJuICJDIgp7CgovKiBt
YXggcHJpb3JpdHkgZm9yIHBvbGljeSAqLwogIGludCBzY2hlZF9nZXRfcHJp
b3JpdHlfbWF4IChpbnQgcG9saWN5KQogIHsKICAgIGlmIChwb2xpY3kgPCAx
IHx8IHBvbGljeSA+IDMpCiAgICAgIHsKCXNldF9lcnJubyAoRUlOVkFMKTsK
CXJldHVybiAtMTsKICAgICAgfQogICAgcmV0dXJuIC0xNDsKICB9CgovKiBt
aW4gcHJpb3JpdHkgZm9yIHBvbGljeSAqLwogIGludCBzY2hlZF9nZXRfcHJp
b3JpdHlfbWluIChpbnQgcG9saWN5KQogIHsKICAgIGlmIChwb2xpY3kgPCAx
IHx8IHBvbGljeSA+IDMpCiAgICAgIHsKCXNldF9lcnJubyAoRUlOVkFMKTsK
CXJldHVybiAtMTsKICAgICAgfQogICAgcmV0dXJuIDE1OwogIH0KCi8qIGdl
dCBzY2hlZCBwYXJhbXMgZm9yIHByb2Nlc3MgKi8KLyogTm90ZSwgSSdtIG5l
dmVyIHJldHVybmluZyBFUEVSTSwgCiAqIEFsd2F5cyBFU1JDSC4gVGhpcyBp
cyBieSBkZXNpZ24gKElmIGN5Z3dpbiBldmVyIGxvb2tzIGF0IHBhcmFub2lk
IHNlY3VyaXR5CiAqIFdhbGtpbmcgdGhlIHBpZCB2YWx1ZXMgaXMgYSBrbm93
biBob2xlIGluIHNvbWUgb3MncykgCiAqLwogIGludCBzY2hlZF9nZXRwYXJh
bSAocGlkX3QgcGlkLCBzdHJ1Y3Qgc2NoZWRfcGFyYW0gKnBhcmFtKQogIHsK
ICAgIHBpZF90IGxvY2FscGlkOwogICAgaW50IHdpbnByaTsKICAgIGlmICgh
cGFyYW0gfHwgcGlkIDwgMCkKICAgICAgewoJc2V0X2Vycm5vIChFSU5WQUwp
OwoJcmV0dXJuIC0xOwogICAgICB9CgogICAgbG9jYWxwaWQgPSBwaWQgPyBw
aWQgOiBnZXRwaWQgKCk7CgogICAgRFdPUkQgQ2xhc3M7CiAgICBpbnQgVGhy
ZWFkUHJpb3JpdHk7CiAgICBIQU5ETEUgcHJvY2VzczsKICAgIHBpbmZvIHAg
KGxvY2FscGlkKTsKCiAgICAvKiBnZXQgdGhlIGNsYXNzICovCgogICAgaWYg
KCFwKQogICAgICB7CglzZXRfZXJybm8gKEVTUkNIKTsKCXJldHVybiAtMTsK
ICAgICAgfQogICAgcHJvY2VzcyA9IE9wZW5Qcm9jZXNzIChQUk9DRVNTX1FV
RVJZX0lORk9STUFUSU9OLCBGQUxTRSwgcC0+ZHdQcm9jZXNzSWQpOwogICAg
aWYgKCFwcm9jZXNzKQogICAgICB7CglzZXRfZXJybm8gKEVTUkNIKTsKCXJl
dHVybiAtMTsKICAgICAgfQogICAgQ2xhc3MgPSBHZXRQcmlvcml0eUNsYXNz
IChwcm9jZXNzKTsKICAgIENsb3NlSGFuZGxlIChwcm9jZXNzKTsKICAgIGlm
ICghQ2xhc3MpCiAgICAgIHsKCXNldF9lcnJubyAoRVNSQ0gpOwoJcmV0dXJu
IC0xOwogICAgICB9CiAgICBUaHJlYWRQcmlvcml0eSA9IFRIUkVBRF9QUklP
UklUWV9OT1JNQUw7CgogICAgLyogY2FsY3VsYXRlIHRoZSB1bml4IHByaW9y
aXR5LiAqLwogICAgLyogRklYTUU6IHdpbmRvd3MgMjAwMCBzdXBwb3J0cyBB
Qk9WRV9OT1JNQUwgYW5kIEJFTE9XX05PUk1BTCBjbGFzcydzCiAgICAgKiBT
byB0aGlzIGxvZ2ljIGp1c3QgZGVmYXVsdHMgdGhvc2UgY2xhc3MgZmFjdG9y
cyB0byBOT1JNQUwgaW4gdGhlIGNhbGN1bGF0aW9ucyAqLwoKICAgIHN3aXRj
aCAoQ2xhc3MpCiAgICAgIHsKICAgICAgY2FzZSBJRExFX1BSSU9SSVRZX0NM
QVNTOgoJc3dpdGNoIChUaHJlYWRQcmlvcml0eSkKCSAgewoJICBjYXNlIFRI
UkVBRF9QUklPUklUWV9JRExFOgoJICAgIHdpbnByaSA9IDE7CgkgICAgYnJl
YWs7CgkgIGNhc2UgVEhSRUFEX1BSSU9SSVRZX0xPV0VTVDoKCSAgICB3aW5w
cmkgPSAyOwoJICAgIGJyZWFrOwoJICBjYXNlIFRIUkVBRF9QUklPUklUWV9C
RUxPV19OT1JNQUw6CgkgICAgd2lucHJpID0gMzsKCSAgICBicmVhazsKCSAg
Y2FzZSBUSFJFQURfUFJJT1JJVFlfTk9STUFMOgoJICAgIHdpbnByaSA9IDQ7
CgkgICAgYnJlYWs7CgkgIGNhc2UgVEhSRUFEX1BSSU9SSVRZX0FCT1ZFX05P
Uk1BTDoKCSAgICB3aW5wcmkgPSA1OwoJICAgIGJyZWFrOwoJICBjYXNlIFRI
UkVBRF9QUklPUklUWV9ISUdIRVNUOgoJICBkZWZhdWx0OgoJICAgIHdpbnBy
aSA9IDY7CgkgICAgYnJlYWs7CgkgIH0KCWJyZWFrOwogICAgICBjYXNlIEhJ
R0hfUFJJT1JJVFlfQ0xBU1M6Cglzd2l0Y2ggKFRocmVhZFByaW9yaXR5KQoJ
ICB7CgkgIGNhc2UgVEhSRUFEX1BSSU9SSVRZX0lETEU6CgkgICAgd2lucHJp
ID0gMTsKCSAgICBicmVhazsKCSAgY2FzZSBUSFJFQURfUFJJT1JJVFlfTE9X
RVNUOgoJICAgIHdpbnByaSA9IDExOwoJICAgIGJyZWFrOwoJICBjYXNlIFRI
UkVBRF9QUklPUklUWV9CRUxPV19OT1JNQUw6CgkgICAgd2lucHJpID0gMTI7
CgkgICAgYnJlYWs7CgkgIGNhc2UgVEhSRUFEX1BSSU9SSVRZX05PUk1BTDoK
CSAgICB3aW5wcmkgPSAxMzsKCSAgICBicmVhazsKCSAgY2FzZSBUSFJFQURf
UFJJT1JJVFlfQUJPVkVfTk9STUFMOgoJICAgIHdpbnByaSA9IDE0OwoJICAg
IGJyZWFrOwoJICBjYXNlIFRIUkVBRF9QUklPUklUWV9ISUdIRVNUOgoJICBk
ZWZhdWx0OgoJICAgIHdpbnByaSA9IDE1OwoJICAgIGJyZWFrOwoJICB9Cgli
cmVhazsKICAgICAgY2FzZSBOT1JNQUxfUFJJT1JJVFlfQ0xBU1M6CiAgICAg
IGRlZmF1bHQ6Cglzd2l0Y2ggKFRocmVhZFByaW9yaXR5KQoJICB7CgkgIGNh
c2UgVEhSRUFEX1BSSU9SSVRZX0lETEU6CgkgICAgd2lucHJpID0gMTsKCSAg
ICBicmVhazsKCSAgY2FzZSBUSFJFQURfUFJJT1JJVFlfTE9XRVNUOgoJICAg
IHdpbnByaSA9IDc7CgkgICAgYnJlYWs7CgkgIGNhc2UgVEhSRUFEX1BSSU9S
SVRZX0JFTE9XX05PUk1BTDoKCSAgICB3aW5wcmkgPSA4OwoJICAgIGJyZWFr
OwoJICBjYXNlIFRIUkVBRF9QUklPUklUWV9OT1JNQUw6CgkgICAgd2lucHJp
ID0gOTsKCSAgICBicmVhazsKCSAgY2FzZSBUSFJFQURfUFJJT1JJVFlfQUJP
VkVfTk9STUFMOgoJICAgIHdpbnByaSA9IDEwOwoJICAgIGJyZWFrOwoJICBj
YXNlIFRIUkVBRF9QUklPUklUWV9ISUdIRVNUOgoJICBkZWZhdWx0OgoJICAg
IHdpbnByaSA9IDExOwoJICAgIGJyZWFrOwoJICB9CglicmVhazsKICAgICAg
fQoKICAgIC8qIHJldmVyc2Ugb3V0IHdpbnByaSA9ICgxNi0gKCh1bml4cHJp
KzE2KSA+PiAxKSkgKi8KICAgIC8qICAKICAgICAgIHdpbnByaS0xNiA9IC0g
ICh1bml4cHJpICsxNiApID4+IDEKCiAgICAgICAtKHdpbnByaS0xNikgPSB1
bml4cHJpICsxNiA+PiAxCiAgICAgICAoLSh3aW5wcmktMTYpKSA8PCAxID0g
dW5peHByaSsxNgogICAgICAgKCgtKHdpbnByaSAtIDE2KSkgPDwgMSkgLSAx
NiA9IHVuaXhwcmkKICAgICAqLwoKICAgIHBhcmFtLT5zY2hlZF9wcmlvcml0
eSA9ICgoLSh3aW5wcmkgLSAxNikpIDw8IDEpIC0gMTY7CgogICAgcmV0dXJu
IDA7CiAgfQoKLyogZ2V0IHRoZSBzY2hlZHVsZXIgZm9yIHBpZCAqLwovKiBB
bGwgcHJvY2VzcydzIG9uIFdJTjMyIHJ1biB3aXRoIFNDSEVEX0ZJRk8uCiAq
IFNvIHdlIGp1c3QgZ2l2ZSBhbiBhbnN3ZXIuIAogKiAoV0lOMzIgdXNlcyBh
IG11bHRpIHF1ZXVlIEZJRk8pLgogKi8KICBpbnQgc2NoZWRfZ2V0c2NoZWR1
bGVyIChwaWRfdCBwaWQpCiAgewogICAgaWYgKHBpZCA8IDApCiAgICAgIHJl
dHVybiBFU1JDSDsKICAgIGVsc2UKICAgICAgcmV0dXJuIFNDSEVEX0ZJRk87
CiAgfQoKLyogZ2V0IHRoZSB0aW1lIHF1YW50dW0gZm9yIHBpZCAqLwovKiBX
ZSBjYW4ndCByZXR1cm4gLTExLCBlcnJubyBFTk9TWVMsIGJlY2F1c2UgdGhh
dCBpbXBsaWVzIHRoYXQKICogc2NoZWRfZ2V0X3ByaW9yaXR5X21heCAmIG1p
biBhcmUgYWxzbyBub3Qgc3VwcG9ydGVkIChhY2NvcmRpbmcgdG8gdGhlIHNw
ZWMpCiAqIHNvIHNvbWUgc3BlYy1kcml2ZW4gYXV0b2NvbmYgdGVzdHMgd2ls
bCBsaWtlbHkgYXNzdW1lIHRoZXkgYXJlbid0IHByZXNlbnQgZWl0aGVyCiAq
CiAqIHJldHVybmluZyBFU1JDSCBtaWdodCBjb25mdXNlIHNvbWUgYXBwbGlj
YXRpb25zIChpZiB0aGV5IGFzc3VtZWQgdGhhdCB3aGVuIAogKiBycl9nZXRf
aW50ZXJ2YWwgaXMgY2FsbGVkIG9uIHBpZCAwIGl0IGFsd2F5cyB3b3Jrcyku
IAogKgogKiBJZiBzb21lb25lIGtub3dzIHRoZSB0aW1lIHF1YW50YSBmb3Ig
dGhlIHZhcmlvdXMgd2luMzIgcGxhdGZvcm1zLCB0aGVuIGEgCiAqIHNpbXBs
ZSBjaGVjayBmb3IgdGhlIG9zIHdlJ3JlIHJ1bm5pbmcgb24gd2lsbCBmaW5p
c2ggdGhpcyBmdW5jdGlvbgogKi8KICBpbnQgc2NoZWRfcnJfZ2V0X2ludGVy
dmFsIChwaWRfdCBwaWQsIHN0cnVjdCB0aW1lc3BlYyAqaW50ZXJ2YWwpCiAg
ewogICAgc2V0X2Vycm5vIChFU1JDSCk7CiAgICByZXR1cm4gLTE7CiAgfQoK
Lyogc2V0IHRoZSBzY2hlZHVsaW5nIHBhcmFtZXRlcnMgKi8KICBpbnQgc2No
ZWRfc2V0cGFyYW0gKHBpZF90IHBpZCwgY29uc3Qgc3RydWN0IHNjaGVkX3Bh
cmFtICpwYXJhbSkKICB7CiAgICBwaWRfdCBsb2NhbHBpZDsKICAgIGludCB3
aW5wcmk7CiAgICBEV09SRCBDbGFzczsKICAgIGludCBUaHJlYWRQcmlvcml0
eTsKICAgIEhBTkRMRSBwcm9jZXNzOwoKICAgIGlmICghcGFyYW0gfHwgcGlk
IDwgMCkKICAgICAgewoJc2V0X2Vycm5vIChFSU5WQUwpOwoJcmV0dXJuIC0x
OwogICAgICB9CgogICAgaWYgKHBhcmFtLT5zY2hlZF9wcmlvcml0eSA8IC0x
NCB8fCBwYXJhbS0+c2NoZWRfcHJpb3JpdHkgPiAxNSkKICAgICAgewoJc2V0
X2Vycm5vIChFSU5WQUwpOwoJcmV0dXJuIC0xOwogICAgICB9CgogICAgLyog
IHdpbnByaSA9ICgxNi0gKCh1bml4cHJpKzE2KSA+PiAxKSkgKi8KICAgIHdp
bnByaSA9IDE2IC0gKChwYXJhbS0+c2NoZWRfcHJpb3JpdHkgKyAxNikgPj4g
MSk7CgogICAgLyogY2FsY3VsYXRlIG91ciBkZXNpcmVkIHByaW9yaXR5IGNs
YXNzIGFuZCB0aHJlYWQgcHJpb3JpdHkgKi8KCiAgICBpZiAod2lucHJpIDwg
NykKICAgICAgQ2xhc3MgPSBJRExFX1BSSU9SSVRZX0NMQVNTOwogICAgZWxz
ZSBpZiAod2lucHJpID4gMTApCiAgICAgIENsYXNzID0gSElHSF9QUklPUklU
WV9DTEFTUzsKICAgIGVsc2UKICAgICAgQ2xhc3MgPSBOT1JNQUxfUFJJT1JJ
VFlfQ0xBU1M7CgogICAgc3dpdGNoIChDbGFzcykKICAgICAgewogICAgICBj
YXNlIElETEVfUFJJT1JJVFlfQ0xBU1M6Cglzd2l0Y2ggKHdpbnByaSkKCSAg
ewoJICBjYXNlIDE6CgkgICAgVGhyZWFkUHJpb3JpdHkgPSBUSFJFQURfUFJJ
T1JJVFlfSURMRTsKCSAgICBicmVhazsKCSAgY2FzZSAyOgoJICAgIFRocmVh
ZFByaW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZX0xPV0VTVDsKCSAgICBicmVh
azsKCSAgY2FzZSAzOgoJICAgIFRocmVhZFByaW9yaXR5ID0gVEhSRUFEX1BS
SU9SSVRZX0JFTE9XX05PUk1BTDsKCSAgICBicmVhazsKCSAgY2FzZSA0OgoJ
ICAgIFRocmVhZFByaW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZX05PUk1BTDsK
CSAgICBicmVhazsKCSAgY2FzZSA1OgoJICAgIFRocmVhZFByaW9yaXR5ID0g
VEhSRUFEX1BSSU9SSVRZX0FCT1ZFX05PUk1BTDsKCSAgICBicmVhazsKCSAg
Y2FzZSA2OgoJICAgIFRocmVhZFByaW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZ
X0hJR0hFU1Q7CgkgICAgYnJlYWs7CgkgIH0KCWJyZWFrOwogICAgICBjYXNl
IE5PUk1BTF9QUklPUklUWV9DTEFTUzoKCXN3aXRjaCAod2lucHJpKQoJICB7
CgkgIGNhc2UgNzoKCSAgICBUaHJlYWRQcmlvcml0eSA9IFRIUkVBRF9QUklP
UklUWV9MT1dFU1Q7CgkgICAgYnJlYWs7CgkgIGNhc2UgODoKCSAgICBUaHJl
YWRQcmlvcml0eSA9IFRIUkVBRF9QUklPUklUWV9CRUxPV19OT1JNQUw7Cgkg
ICAgYnJlYWs7CgkgIGNhc2UgOToKCSAgICBUaHJlYWRQcmlvcml0eSA9IFRI
UkVBRF9QUklPUklUWV9OT1JNQUw7CgkgICAgYnJlYWs7CgkgIGNhc2UgMTA6
CgkgICAgVGhyZWFkUHJpb3JpdHkgPSBUSFJFQURfUFJJT1JJVFlfQUJPVkVf
Tk9STUFMOwoJICAgIGJyZWFrOwoJICBjYXNlIDExOgoJICAgIFRocmVhZFBy
aW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZX0hJR0hFU1Q7CgkgICAgYnJlYWs7
CgkgIH0KCWJyZWFrOwogICAgICBjYXNlIEhJR0hfUFJJT1JJVFlfQ0xBU1M6
Cglzd2l0Y2ggKHdpbnByaSkKCSAgewoJICBjYXNlIDEyOgoJICAgIFRocmVh
ZFByaW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZX0JFTE9XX05PUk1BTDsKCSAg
ICBicmVhazsKCSAgY2FzZSAxMzoKCSAgICBUaHJlYWRQcmlvcml0eSA9IFRI
UkVBRF9QUklPUklUWV9OT1JNQUw7CgkgICAgYnJlYWs7CgkgIGNhc2UgMTQ6
CgkgICAgVGhyZWFkUHJpb3JpdHkgPSBUSFJFQURfUFJJT1JJVFlfQUJPVkVf
Tk9STUFMOwoJICAgIGJyZWFrOwoJICBjYXNlIDE1OgoJICAgIFRocmVhZFBy
aW9yaXR5ID0gVEhSRUFEX1BSSU9SSVRZX0hJR0hFU1Q7CgkgICAgYnJlYWs7
CgkgIH0KCWJyZWFrOwogICAgICB9CgogICAgbG9jYWxwaWQgPSBwaWQgPyBw
aWQgOiBnZXRwaWQgKCk7CgogICAgcGluZm8gcCAobG9jYWxwaWQpOwoKICAg
IC8qIHNldCB0aGUgY2xhc3MgKi8KCiAgICBpZiAoIXApCiAgICAgIHsKCXNl
dF9lcnJubyAoMSk7CQkvL0VTUkNIKTsKCXJldHVybiAtMTsKICAgICAgfQog
ICAgcHJvY2VzcyA9CiAgICAgIE9wZW5Qcm9jZXNzIChQUk9DRVNTX1NFVF9J
TkZPUk1BVElPTiwgRkFMU0UsIChEV09SRCkgcC0+ZHdQcm9jZXNzSWQpOwog
ICAgaWYgKCFwcm9jZXNzKQogICAgICB7CglzZXRfZXJybm8gKDIpOwkJLy9F
U1JDSCk7CglyZXR1cm4gLTE7CiAgICAgIH0KICAgIGlmICghU2V0UHJpb3Jp
dHlDbGFzcyAocHJvY2VzcywgQ2xhc3MpKQogICAgICB7CglDbG9zZUhhbmRs
ZSAocHJvY2Vzcyk7CglzZXRfZXJybm8gKEVQRVJNKTsKCXJldHVybiAtMTsK
ICAgICAgfQogICAgQ2xvc2VIYW5kbGUgKHByb2Nlc3MpOwoKICAgIHJldHVy
biAwOwogIH0KCi8qIHNldCB0aGUgc2NoZWR1bGVyICovCiAgaW50CiAgICBz
Y2hlZF9zZXRzY2hlZHVsZXIgKHBpZF90IHBpZCwgaW50IHBvbGljeSwKCQkJ
Y29uc3Qgc3RydWN0IHNjaGVkX3BhcmFtICpwYXJhbSkKICB7CiAgICAvKiBv
biB3aW4zMiwgeW91IGNhbid0IGNoYW5nZSB0aGUgc2NoZWR1bGVyLiBEb2gh
ICovCiAgICBzZXRfZXJybm8gKEVOT1NZUyk7CiAgICByZXR1cm4gLTE7CiAg
fQoKLyogeWllbGQgdGhlIGNwdSAqLwogIGludCBzY2hlZF95aWVsZCAodm9p
ZCkKICB7CiAgICBTbGVlcCAoMCk7CiAgICByZXR1cm4gMDsKICB9Cgp9Cg==

------------=_1583532846-65438-27
Content-Type: text/x-c; charset=us-ascii; name="sched.h"
Content-Disposition: inline; filename="sched.h"
Content-Transfer-Encoding: base64
Content-Length: 1399

LyogQ2hyaXMsIHBsZWFzZSBpbnNlcnQgdGhlIHN0YW5kYXJkIHJlZCBoYXQg
Y29weXJpZ2h0IHN0dWZmIGhlcmUuICovCgovKgogKiBXcml0dGVuIGJ5IFJv
YmVydCBDb2xsaW5zIDxyYnRjb2xsaW5zQGhvdG1haWwuY29tPgogKiBmcm9t
IHRoZSBvcGVuZ3JvdXAgc3BlY2lmaWNhdGlvbnMKICovCgojaWZuZGVmIF9T
Q0hFRF9ICiNkZWZpbmUgX1NDSEVEX0gKI2luY2x1ZGUgPHRpbWUuaD4KCi8q
IHdlIHJldHVybiAtMSBhbmQgc2V0IGVycm5vIG9uIGZhaWx1cmUgKi8KI2Rl
ZmluZSBTQ0hFRF9GSUZPICAxCiNkZWZpbmUgU0NIRURfUlIgICAgMgojZGVm
aW5lIFNDSEVEX09USEVSIDMKCnN0cnVjdCBzY2hlZF9wYXJhbQp7CiAgaW50
IHNjaGVkX3ByaW9yaXR5Owp9OwoKZXh0ZXJuICJDIgp7CgovKiBtYXggcHJp
b3JpdHkgZm9yIHBvbGljeSAqLwogIGludCBzY2hlZF9nZXRfcHJpb3JpdHlf
bWF4IChpbnQpOwovKiBtaW4gcHJpb3JpdHkgZm9yIHBvbGljeSAqLwogIGlu
dCBzY2hlZF9nZXRfcHJpb3JpdHlfbWluIChpbnQpOwovKiBnZXQgc2NoZWQg
cGFyYW1zIGZvciBwcm9jZXNzICovCiAgaW50IHNjaGVkX2dldHBhcmFtIChw
aWRfdCwgc3RydWN0IHNjaGVkX3BhcmFtICopOwovKiBnZXQgdGhlIHNjaGVk
dWxlciBmb3IgcGlkICovCiAgaW50IHNjaGVkX2dldHNjaGVkdWxlciAocGlk
X3QpOwovKiBnZXQgdGhlIHRpbWUgcXVhbnR1bSBmb3IgcGlkICovCiAgaW50
IHNjaGVkX3JyX2dldF9pbnRlcnZhbCAocGlkX3QsIHN0cnVjdCB0aW1lc3Bl
YyAqKTsKLyogc2V0IHRoZSBzY2hlZHVsaW5nIHBhcmFtZXRlcnMgKi8KICBp
bnQgc2NoZWRfc2V0cGFyYW0gKHBpZF90LCBjb25zdCBzdHJ1Y3Qgc2NoZWRf
cGFyYW0gKik7Ci8qIHNldCB0aGUgc2NoZWR1bGVyICovCiAgaW50IHNjaGVk
X3NldHNjaGVkdWxlciAocGlkX3QsIGludCwgY29uc3Qgc3RydWN0IHNjaGVk
X3BhcmFtICopOwovKiB5aWVsZCB0aGUgY3B1ICovCiAgaW50IHNjaGVkX3lp
ZWxkICh2b2lkKTsKCn0KI2VuZGlmCQkJCS8qIF9TQ0hFRF9IICovCg==

------------=_1583532846-65438-27
Content-Type: text/x-diff; charset=us-ascii; name="sched.patch"
Content-Disposition: inline; filename="sched.patch"
Content-Transfer-Encoding: base64
Content-Length: 1952

SW5kZXg6IE1ha2VmaWxlLmluCj09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNT
IGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY3lnd2luL01ha2VmaWxlLmlu
LHYKcmV0cmlldmluZyByZXZpc2lvbiAxLjUxCmRpZmYgLXUgLXAgLXIxLjUx
IE1ha2VmaWxlLmluCi0tLSBNYWtlZmlsZS5pbgkyMDAxLzAyLzIyIDEyOjU2
OjM2CTEuNTEKKysrIE1ha2VmaWxlLmluCTIwMDEvMDMvMjEgMDA6MDA6MTMK
QEAgLTEyMyw4ICsxMjMsOCBAQCBETExfT0ZJTEVTOj1hc3NlcnQubyBhdXRv
bG9hZC5vIGN5Z2hlYXAuCiAJZm9yay5vIGdsb2IubyBncnAubyBoZWFwLm8g
aW5pdC5vIGlvY3RsLm8gbG9jYWx0aW1lLm8gbWFsbG9jLm8gXAogCW1pc2Nm
dW5jcy5vIG1tYXAubyBcCiAJbmV0Lm8gbnRlYS5vIHBhc3N3ZC5vIHBhdGgu
byBwaW5mby5vIHBpcGUubyBwb2xsLm8gcHRocmVhZC5vIHJlZ2V4cC5vIFwK
LQlyZWdlcnJvci5vIHJlZ3N1Yi5vIHJlZ2lzdHJ5Lm8gcmVzb3VyY2UubyBz
Y2FuZGlyLm8gc2VjdXJpdHkubyBzZWxlY3QubyBcCi0Jc2hhcmVkLm8gXAor
CXJlZ2Vycm9yLm8gcmVnc3ViLm8gcmVnaXN0cnkubyByZXNvdXJjZS5vIHNj
YW5kaXIubyBzY2hlZC5vIFwKKyAgICAgICAgc2VjdXJpdHkubyBzZWxlY3Qu
byBzaGFyZWQubyBcCiAJc2hvcnRjdXQubyBzaWduYWwubyBzaWdwcm9jLm8g
c21hbGxwcmludC5vIHNwYXduLm8gc3RyYWNlLm8gc3Ryc2VwLm8gXAogCXN5
bmMubyBzeXNjYWxscy5vIHN5c2NvbmYubyBzeXNsb2cubyB0ZXJtaW9zLm8g
dGhyZWFkLm8gdGltZXMubyB0dHkubyBcCiAJdWluZm8ubyB1bmFtZS5vIHdh
aXQubyB3aW5kb3cubyBcCkluZGV4OiBjeWd3aW4uZGluCj09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY3ln
d2luL2N5Z3dpbi5kaW4sdgpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMjIKZGlm
ZiAtdSAtcCAtcjEuMjIgY3lnd2luLmRpbgotLS0gY3lnd2luLmRpbgkyMDAx
LzAzLzE3IDAxOjE0OjU3CTEuMjIKKysrIGN5Z3dpbi5kaW4JMjAwMS8wMy8y
MSAwMDowMDoxNQpAQCAtMTExNCw2ICsxMTE0LDE0IEBAIGN5Z3dpbjMyX2lu
dGVybmFsID0gY3lnd2luX2ludGVybmFsCiBAUFRIX0FMTE9XQHNlbV93YWl0
CiBAUFRIX0FMTE9XQHNlbV90cnl3YWl0CiBAUFRIX0FMTE9XQHNlbV9wb3N0
CitzY2hlZF9nZXRfcHJpb3JpdHlfbWF4CitzY2hlZF9nZXRfcHJpb3JpdHlf
bWluCitzY2hlZF9nZXRwYXJhbQorc2NoZWRfZ2V0c2NoZWR1bGVyCitzY2hl
ZF9ycl9nZXRfaW50ZXJ2YWwKK3NjaGVkX3NldHBhcmFtCitzY2hlZF9zZXRz
Y2hlZHVsZXIKK3NjaGVkX3lpZWxkCiBhY2wKIF9hY2wgPSBhY2wKIGZhY2wK

------------=_1583532846-65438-27--
