From: "Michael A. Chase" <mchase@ix.netcom.com>
To: <cygwin-patches@cygwin.com>
Cc: "Robert Collins" <robert.collins@itdomain.com.au>
Subject: [PATCH]choose.cc: Simplify set_action(), wrap long lines, and correct problems in setup.log.full
Date: Sat, 23 Jun 2001 14:34:00 -0000
Message-id: <001501c0fc2b$fd137d00$6464648a@ca.boeing.com>
X-SW-Source: 2001-q2/msg00328.html
Content-type: multipart/mixed; boundary="----------=_1583532848-65438-77"

This is a multi-part message in MIME format...

------------=_1583532848-65438-77
Content-length: 1551

Some time between setup.exe 2.57 and 2.75, the ability to set the checkbox
for downloading or installing source was lost.  It was caused by clearing
pkg->srcpicked in set_action().  Set_action() was apparently intended to
manage setting pkg->action when the action column was clicked, but it is now
also used to make sure pkg->action is valid in other places.  I removed
"pkg->srcpicked = 0;" from set_action() and added it to default_trust() so
it would only be cleared when setting the default trust level.

Rob,
   This change throws off 4 hunks in the hierarchy.patch you sent to the
list yesterday, but I was able to complete the patch by hand.
--
Mac :})
Give a hobbit a fish and he'll eat fish for a day.
Give a hobbit a ring and he'll eat fish for an age.

ChangeLog:

Sat Jun 23 13:57:20  2001 Michael A Chase <mchase@ix.netcom.com>

   * choose.cc (set_action): Simplify the state machine logic.
                             Skip ACTION_SKIP when the package is already
installed.
                             Don't clear pkg->srcpicked here.
               (default_trust): Clear pkg->srcpicked when setting default
trust level.
               (paint): Wrap lines excessively long lines.
               (list_click): Ditto.
               (create_listview): Ditto.
               (do_choose): Ditto.
                            Replace TABs and remove CRs in lines written to
setup.log.full.
                            Allow "Yes" for source exists in setup.log.full
when
                               installing from local directories.


------------=_1583532848-65438-77
Content-Type: text/x-diff; charset=us-ascii; name="choose.cc-patch"
Content-Disposition: inline; filename="choose.cc-patch"
Content-Transfer-Encoding: base64
Content-Length: 8972

LS0tIGNob29zZS0yLjc1LmNjCVNhdCBKdW4gMTYgMTI6MDU6MDAgMjAwMQor
KysgY2hvb3NlLmNjCVNhdCBKdW4gMjMgMTM6MTM6MDEgMjAwMQpAQCAtMTAw
LDQ4ICsxMDAsNDUgQEAgaXNpbnN0YWxsZWQgKFBhY2thZ2UgKnBrZywgaW50
IHRydXN0KQogc3RhdGljIHZvaWQKIHNldF9hY3Rpb24gKFBhY2thZ2UgKnBr
ZywgYm9vbCBwcmVpbmMpCiB7Ci0gIHBrZy0+c3JjcGlja2VkID0gMDsKLSAg
aWYgKCFwa2ctPmFjdGlvbiB8fCBwcmVpbmMpCi0gICAgKChpbnQpIHBrZy0+
YWN0aW9uKSsrOworICAvKiBEb24ndCB3b3JyeSBhYm91dCBTQU1FIHZhcmlh
dGlvbnMgZHVyaW5nIHN0YXRlIHRyYW5zaXRpb25zICovCisgIHN3aXRjaCAo
cGtnLT5hY3Rpb24pCisgICAgeworICAgIGNhc2UgQUNUSU9OX1NBTUVfUFJF
VjoKKyAgICBjYXNlIEFDVElPTl9TQU1FX0NVUlI6CisgICAgY2FzZSBBQ1RJ
T05fU0FNRV9URVNUOgorICAgICAgKGludCkgcGtnLT5hY3Rpb24gLT0gQUNU
SU9OX1NBTUU7CisgICAgICBicmVhazsKKyAgICBjYXNlIEFDVElPTl9TQU1F
X0xBU1Q6CisgICAgICBwa2ctPmFjdGlvbiA9IEFDVElPTl9MQVNUOworICAg
IH0KIAotICAvKiBFeGVyY2lzZSB0aGUgYWN0aW9uIHN0YXRlIG1hY2hpbmUu
ICovCisgIC8qIEV4ZXJjaXNlIHRoZSBhY3Rpb24gc3RhdGUgbWFjaGluZS4K
KyAgICAgUmV0dXJuIHdoZW4gYW4gYWNjZXB0YWJsZSBhY3Rpb24gaXMgcmVh
Y2hlZC4gKi8KKyAgaWYgKHByZWluYykKKyAgICAoKGludCkgcGtnLT5hY3Rp
b24pKys7CiAgIGZvciAoOzsgKChpbnQpIHBrZy0+YWN0aW9uKSsrKQogICAg
IHN3aXRjaCAocGtnLT5hY3Rpb24pCiAgICAgICB7Ci0gICAgICBjYXNlIEFD
VElPTl9FUlJPUjoKICAgICAgIGNhc2UgQUNUSU9OX1VOS05PV046Ci0JcGtn
LT5hY3Rpb24gPSAoYWN0aW9ucykgKEFDVElPTl9DVVJSIC0gMSk7Ci0JYnJl
YWs7CiAgICAgICBjYXNlIEFDVElPTl9MQVNUOgorICAgICAgY2FzZSBBQ1RJ
T05fRVJST1I6CisJLyogTmV2ZXIgc2V0IG9yIHBhc3QgZW5kLCBwcmV2aW91
cyB2ZXJzaW9uICovCiAJcGtnLT5hY3Rpb24gPSBBQ1RJT05fUFJFVjsKIAkv
KiBmYWxsIHRocm91Z2ggaW50ZW50aW9uYWxseSAqLwogICAgICAgY2FzZSBB
Q1RJT05fUFJFVjoKICAgICAgIGNhc2UgQUNUSU9OX0NVUlI6CiAgICAgICBj
YXNlIEFDVElPTl9URVNUOgotCS8qIFRyeSB0byBmaW5kIHRoZSBuZXh0IGJl
c3QgYWN0aW9uLiAgV2UgbWF5IG5vdCBoYXZlIGFsbCBvZgotCSAgIHByZXYs
IGN1cnIsIG9yIHRlc3QgYnV0IHdlIHNob3VsZCBoYXZlIGF0IGxlYXN0IG9u
ZSBvZiB0aG9zZS4gKi8KKwkvKiBTZWUgaWYgdGhpcyB2ZXJzaW9uIGlzIGF2
YWlsYWJsZSwgYXQgbGVhc3Qgb25lIHNob3VsZCBiZSAqLwogCUluZm8gKmlu
ZjsKIAlpbmYgPSBwa2ctPmluZm8gKyBwa2ctPmFjdGlvbjsKIAlpZiAoaW5m
LT52ZXJzaW9uICYmIGluZi0+aW5zdGFsbF9leGlzdHMpCiAJICB7CisJICAg
IC8qIFN3aXRjaCB0byBTQU1FIHZhcmlhdGlvbiBpZiB0aGlzIHZlcnNpb24g
aXMgaW5zdGFsbGVkICovCiAJICAgIGlmIChpc2luc3RhbGxlZCAocGtnLCBw
a2ctPmFjdGlvbikpCiAJICAgICAgKGludCkgcGtnLT5hY3Rpb24gKz0gQUNU
SU9OX1NBTUU7CiAJICAgIHJldHVybjsKIAkgIH0KIAlicmVhazsKLSAgICAg
IC8qIEFDVElPTl9TQU1FXyogYXJlIHVzZWQgd2hlbiB0aGUgaW5zdGFsbGVk
IHZlcnNpb24gaXMgdGhlIHNhbWUKLQkgYXMgdGhlIGdpdmVuIGFjdGlvbi4g
Ki8KLSAgICAgIGNhc2UgQUNUSU9OX1NBTUVfQ1VSUjoKLSAgICAgIGNhc2Ug
QUNUSU9OX1NBTUVfVEVTVDoKLQlpZiAoIXByZWluYykJLyogUHJldmlvdXNs
eSBzZXQgdG8gdGhpcyB2YWx1ZSAqLwotCSAgcmV0dXJuOwotCShpbnQpIHBr
Zy0+YWN0aW9uIC09IEFDVElPTl9TQU1FICsgMTsJLyogcmV2ZXJ0IHRvIEFD
VElPTl9DVVJSLCBldGMuICovCi0JYnJlYWs7Ci0gICAgICBjYXNlIEFDVElP
Tl9TQU1FX1BSRVY6Ci0JaWYgKCFwcmVpbmMpCS8qIFByZXZpb3VzbHkgc2V0
IHRvIHRoaXMgdmFsdWUgKi8KLQkgIHJldHVybjsKLQlwa2ctPmFjdGlvbiA9
IEFDVElPTl9VTklOU1RBTEw7Ci0gICAgICAvKiBGYWxsIHRocm91Z2ggaW50
ZW50aW9uYWxseSAqLwogICAgICAgY2FzZSBBQ1RJT05fVU5JTlNUQUxMOgog
CWlmIChwa2ctPmluc3RhbGxlZCkKIAkgIHJldHVybjsKQEAgLTE1NSwxMyAr
MTUyLDEyIEBAIHNldF9hY3Rpb24gKFBhY2thZ2UgKnBrZywgYm9vbCBwcmVp
bmMpCiAJaWYgKHBrZy0+aW5zdGFsbGVkICYmIHBrZy0+aW5zdGFsbGVkLT5z
b3VyY2VfZXhpc3RzKQogCSAgcmV0dXJuOwogCWJyZWFrOwotICAgICAgY2Fz
ZSBBQ1RJT05fU0FNRV9MQVNUOgotCXBrZy0+YWN0aW9uID0gQUNUSU9OX1NL
SVA7Ci0JLyogRmFsbCB0aHJvdWdoIGludGVudGlvbmFsbHkgKi8KICAgICAg
IGNhc2UgQUNUSU9OX1NLSVA6Ci0JcmV0dXJuOworCWlmICghIHBrZy0+aW5z
dGFsbGVkKQorCSAgcmV0dXJuOworCWJyZWFrOwogICAgICAgZGVmYXVsdDoK
LQlsb2cgKDAsICJzaG91bGQgbmV2ZXIgZ2V0IGhlcmUgJWRcbiIsIHBrZy0+
YWN0aW9uKTsKKwlsb2cgKDAsICJzZXRfYWN0aW9uKCk6IGludmFsaWQgc3Rh
dGUgJWRcbiIsIHBrZy0+YWN0aW9uKTsKICAgICAgIH0KIH0KIApAQCAtMjM3
LDcgKzIzMyw4IEBAIHBhaW50IChIV05EIGh3bmQpCiAJICBUZXh0T3V0ICho
ZGMsIHggKyBoZWFkZXJzW0NVUlJFTlRfQ09MXS54LCByLAogCQkgICBwa2ct
Pmluc3RhbGxlZC0+dmVyc2lvbiwgc3RybGVuIChwa2ctPmluc3RhbGxlZC0+
dmVyc2lvbikpOwogCSAgU2VsZWN0T2JqZWN0IChiaXRtYXBfZGMsIGJtX3J0
YXJyb3cpOwotCSAgQml0Qmx0IChoZGMsIHggKyBoZWFkZXJzW0NVUlJFTlRf
Q09MXS54ICsgaGVhZGVyc1swXS53aWR0aCArIElDT05fTUFSR0lOLzIgKyBI
TUFSR0lOLzIsIGJ5LAorCSAgQml0Qmx0IChoZGMsIHggKyBoZWFkZXJzW0NV
UlJFTlRfQ09MXS54ICsgaGVhZGVyc1swXS53aWR0aCArCisJCSAgSUNPTl9N
QVJHSU4vMiArIEhNQVJHSU4vMiwgYnksCiAJCSAgMTEsIDExLCBiaXRtYXBf
ZGMsIDAsIDAsIFNSQ0NPUFkpOwogCX0KIApAQCAtMzY3LDExICszNjQsMTMg
QEAgbGlzdF9jbGljayAoSFdORCBod25kLCBCT09MIGRibGNsaywgaW50IAog
CiAgIFBhY2thZ2UgKnBrZyA9IHBhY2thZ2UgKyBwYWNrYWdlX2luZGV4ZXNb
cl07CiAKLSAgaWYgKHggPj0gaGVhZGVyc1tORVdfQ09MXS54IC0gKEhNQVJH
SU4gLyAyKSAmJiB4IDw9IGhlYWRlcnNbTkVXX0NPTCArIDFdLnggLSBITUFS
R0lOLzIpCisgIGlmICh4ID49IGhlYWRlcnNbTkVXX0NPTF0ueCAtIChITUFS
R0lOIC8gMikgJiYKKyAgICAgIHggPD0gaGVhZGVyc1tORVdfQ09MICsgMV0u
eCAtIEhNQVJHSU4gLyAyKQogICAgIHNldF9hY3Rpb24gKHBrZywgMSk7CiAK
LSAgaWYgKHggPj0gaGVhZGVyc1tTUkNfQ09MXS54IC0gSE1BUkdJTi8yICYm
IHggPD0gaGVhZGVyc1tTUkNfQ09MICsgMV0ueCAtIEhNQVJHSU4vMikKLSAg
ICBwa2ctPnNyY3BpY2tlZCBePSAxOworICBpZiAoeCA+PSBoZWFkZXJzW1NS
Q19DT0xdLnggLSBITUFSR0lOIC8gMiAmJgorICAgICAgeCA8PSBoZWFkZXJz
W1NSQ19DT0wgKyAxXS54IC0gSE1BUkdJTiAvIDIpCisgICAgcGtnLT5zcmNw
aWNrZWQgPSAhcGtnLT5zcmNwaWNrZWQ7CiAKICAgUkVDVCByZWN0OwogICBy
ZWN0LmxlZnQgPSBoZWFkZXJzW05FV19DT0xdLnggLSBzY3JvbGxfdWxjX3g7
CkBAIC00ODIsNiArNDgxLDcgQEAgZGVmYXVsdF90cnVzdCAoSFdORCBoLCB0
cnVzdHMgdHJ1c3QpCiAgICAgewogICAgICAgcGtnLT5hY3Rpb24gPSAoYWN0
aW9ucykgdHJ1c3Q7CiAgICAgICBzZXRfYWN0aW9uIChwa2csIDApOworICAg
ICAgcGtnLT5zcmNwaWNrZWQgPSAwOwogICAgIH0KICAgUkVDVCByOwogICBH
ZXRDbGllbnRSZWN0IChoLCAmcik7CkBAIC01ODEsOSArNTgxLDExIEBAIGNy
ZWF0ZV9saXN0dmlldyAoSFdORCBkbGcsIFJFQ1QgKnIpCiAgIG5vdGVfd2lk
dGggKGRjLCAidW5pbnN0YWxsIiwgTkVXX0NPTF9TSVpFX1NMT1AsIE5FV19D
T0wpOwogCiAgIGhlYWRlcnNbQ1VSUkVOVF9DT0xdLnggPSBITUFSR0lOLzI7
Ci0gIGhlYWRlcnNbTkVXX0NPTF0ueCA9IGhlYWRlcnNbQ1VSUkVOVF9DT0xd
LnggKyBoZWFkZXJzW0NVUlJFTlRfQ09MXS53aWR0aCArIE5FV19DT0xfU0la
RV9TTE9QICsgSE1BUkdJTjsKKyAgaGVhZGVyc1tORVdfQ09MXS54ID0gaGVh
ZGVyc1tDVVJSRU5UX0NPTF0ueCArIGhlYWRlcnNbQ1VSUkVOVF9DT0xdLndp
ZHRoICsKKyAgICBORVdfQ09MX1NJWkVfU0xPUCArIEhNQVJHSU47CiAgIGhl
YWRlcnNbU1JDX0NPTF0ueCA9IGhlYWRlcnNbTkVXX0NPTF0ueCArIGhlYWRl
cnNbTkVXX0NPTF0ud2lkdGggKyBITUFSR0lOOwotICBoZWFkZXJzW1BBQ0tB
R0VfQ09MXS54ID0gaGVhZGVyc1tTUkNfQ09MXS54ICsgaGVhZGVyc1tTUkNf
Q09MXS53aWR0aCArIEhNQVJHSU47CisgIGhlYWRlcnNbUEFDS0FHRV9DT0xd
LnggPSBoZWFkZXJzW1NSQ19DT0xdLnggKyBoZWFkZXJzW1NSQ19DT0xdLndp
ZHRoICsKKyAgICBITUFSR0lOOwogCiAgIGRlZmF1bHRfdHJ1c3QgKGx2LCBU
UlVTVF9DVVJSKTsKICAgc2V0X2Z1bGxfbGlzdCAobHYsIGZ1bGxfbGlzdCk7
CkBAIC05MzEsMTEgKzkzMywxNSBAQCBkb19jaG9vc2UgKEhJTlNUQU5DRSBo
KQogCiAgIG5leHRidXR0b24gPSAwOwogICBibV9zcGluID0gTG9hZEltYWdl
IChoLCBNQUtFSU5UUkVTT1VSQ0UgKElEQl9TUElOKSwgSU1BR0VfQklUTUFQ
LCAwLCAwLCAwKTsKLSAgYm1fcnRhcnJvdyA9IExvYWRJbWFnZSAoaCwgTUFL
RUlOVFJFU09VUkNFIChJREJfUlRBUlJPVyksIElNQUdFX0JJVE1BUCwgMCwg
MCwgMCk7CisgIGJtX3J0YXJyb3cgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRS
RVNPVVJDRSAoSURCX1JUQVJST1cpLCBJTUFHRV9CSVRNQVAsCisJCQkgIDAs
IDAsIDApOwogCi0gIGJtX2NoZWNreWVzID0gTG9hZEltYWdlIChoLCBNQUtF
SU5UUkVTT1VSQ0UgKElEQl9DSEVDS19ZRVMpLCBJTUFHRV9CSVRNQVAsIDAs
IDAsIDApOwotICBibV9jaGVja25vID0gTG9hZEltYWdlIChoLCBNQUtFSU5U
UkVTT1VSQ0UgKElEQl9DSEVDS19OTyksIElNQUdFX0JJVE1BUCwgMCwgMCwg
MCk7Ci0gIGJtX2NoZWNrbmEgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRSRVNP
VVJDRSAoSURCX0NIRUNLX05BKSwgSU1BR0VfQklUTUFQLCAwLCAwLCAwKTsK
KyAgYm1fY2hlY2t5ZXMgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRSRVNPVVJD
RSAoSURCX0NIRUNLX1lFUyksIElNQUdFX0JJVE1BUCwKKwkJCSAgIDAsIDAs
IDApOworICBibV9jaGVja25vID0gTG9hZEltYWdlIChoLCBNQUtFSU5UUkVT
T1VSQ0UgKElEQl9DSEVDS19OTyksIElNQUdFX0JJVE1BUCwKKwkJCSAgMCwg
MCwgMCk7CisgIGJtX2NoZWNrbmEgPSBMb2FkSW1hZ2UgKGgsIE1BS0VJTlRS
RVNPVVJDRSAoSURCX0NIRUNLX05BKSwgSU1BR0VfQklUTUFQLAorCQkJICAw
LCAwLCAwKTsKIAogICByZWdpc3Rlcl93aW5kb3dzIChoKTsKIApAQCAtOTY3
LDE1ICs5NzMsMTYgQEAgZG9fY2hvb3NlIChISU5TVEFOQ0UgaCkKIAkJCSAg
ICAgICA6ICJ1bmtub3duIik7CiAgICAgICBjb25zdCBjaGFyICpleGNsdWRl
ZCA9IChwa2ctPmV4Y2x1ZGUgPyAieWVzIiA6ICJubyIpOwogCi0gICAgICBs
b2cgKExPR19CQUJCTEUsICJbJXNdIGFjdGlvbj0lcyB0cnVzdD0lcyBpbnN0
YWxsZWQ9JXMgZXhjbHVkZWQ9JXMgc3JjPz0lcyIsCisgICAgICBsb2cgKExP
R19CQUJCTEUsCisJICAgIlslc10gYWN0aW9uPSVzIHRydXN0PSVzIGluc3Rh
bGxlZD0lcyBleGNsdWRlZD0lcyBzcmM/PSVzIiwKIAkgICBwa2ctPm5hbWUs
IGFjdGlvbiwgdHJ1c3QsIGluc3RhbGxlZCwKIAkgICBleGNsdWRlZCwgcGtn
LT5zcmNwaWNrZWQgPyAieWVzIiA6ICJubyIpOwogICAgICAgZm9yIChpbnQg
dCA9IDE7IHQgPCBOVFJVU1Q7IHQrKykKIAl7CiAJICBpZiAocGtnLT5pbmZv
W3RdLmluc3RhbGwpCi0JICAgIGxvZyAoTE9HX0JBQkJMRSwgIiAgICAgWyVz
XSB2ZXI9JXNcclxuIgotCQkJICAgICAiICAgICAgICAgIGluc3Q9JXMgJWQg
ZXhpc3RzPSVzXHJcbiIKLQkJCSAgICAgIgkJc3JjPSVzICVkIGV4aXN0cz0l
cyIsCisJICAgIGxvZyAoTE9HX0JBQkJMRSwgIiAgICAgWyVzXSB2ZXI9JXNc
biIKKwkJCSAgICAgIiAgICAgICAgICBpbnN0PSVzICVkIGV4aXN0cz0lc1xu
IgorCQkJICAgICAiICAgICAgICAgIHNyYz0lcyAlZCBleGlzdHM9JXMiLAog
CQkgaW5mb3NbdF0sCiAJCSBwa2ctPmluZm9bdF0udmVyc2lvbiA/OiAiKG5v
bmUpIiwKIAkJIHBrZy0+aW5mb1t0XS5pbnN0YWxsID86ICIobm9uZSkiLApA
QCAtOTgzLDcgKzk5MCw3IEBAIGRvX2Nob29zZSAoSElOU1RBTkNFIGgpCiAJ
CSAocGtnLT5pbmZvW3RdLmluc3RhbGxfZXhpc3RzKSA/ICJ5ZXMiOiJubyIs
CiAJCSBwa2ctPmluZm9bdF0uc291cmNlID86ICIobm9uZSkiLAogCQkgcGtn
LT5pbmZvW3RdLnNvdXJjZV9zaXplLAotCQkgKHBrZy0+aW5mb1t0XS5zb3Vy
Y2VfZXhpc3RzID09IDEpID8gInllcyI6Im5vIik7CisJCSAocGtnLT5pbmZv
W3RdLnNvdXJjZV9leGlzdHMpID8gInllcyI6Im5vIik7CiAJfQogICAgIH0K
IH0K

------------=_1583532848-65438-77--
