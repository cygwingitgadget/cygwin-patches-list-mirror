From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-patches@cygwin.com>
Subject: cygwin_daemon status report.
Date: Sat, 29 Sep 2001 03:54:00 -0000
Message-id: <03f901c148d5$4a054da0$01000001@lifelesswks>
X-SW-Source: 2001-q3/msg00234.html
Content-type: multipart/mixed; boundary="----------=_1583532849-65438-111"

This is a multi-part message in MIME format...

------------=_1583532849-65438-111
Content-length: 990

I've moved the sockets code out of the transport base class, so now the
changes to cygwin are even less intrusive.

I've one key change to make, and then I can't think of any core stuff
for the daemon (not the shm code) that needs to happen other than the
directory reorganisation discussion (+ actions).

So please, this is up for review, as I'm requesting inclusion in HEAD
immediately that 1.3.4 goes out the door I'd like to have the directory
reorganisation discussion now, so I can make time to do that.

The key change I referred to above is a new cygwin environment option -
"DAEMON". This will need to be present for any daemon checks to occur.

Why?

On 95, there is a noticeable timeout when process's start if the daemon
hasn't bound the socket. I imagine there is an equivalent, but much
shorter delay under NT to find /not find the pipe. So this will reduce
the potential impact of the daemon.

We could of course do it in reverse, have the option "NODAEMON".

Thoughts?

Rob

------------=_1583532849-65438-111
Content-Type: text/x-diff; charset=us-ascii; name="daemonstate.patch"
Content-Disposition: inline; filename="daemonstate.patch"
Content-Transfer-Encoding: base64
Content-Length: 121203

UGF0Y2ggZmlsZSBnZW5lcmF0ZWQgU2F0IFNlcCAyOSAyMDo1MDowNSAgMjAw
MSBmcm9tCkNWUyBicmFuY2ggY3lnd2luX2RhZW1vbgpDVlMgcmVwb3NpdG9y
eTogOmV4dDpyYmNvbGxpbnNAc291cmNld2FyZS5jeWdudXMuY29tOi9jdnMv
c3JjCkNWUyBtb2R1bGU6IHNyYy93aW5zdXAvY3lnd2luCgpJbmRleDogc3Jj
L3dpbnN1cC9jeWd3aW4vQ2hhbmdlTG9nCmRpZmYgLXUgc3JjL3dpbnN1cC9j
eWd3aW4vQ2hhbmdlTG9nOjEuOTI1IHNyYy93aW5zdXAvY3lnd2luL0NoYW5n
ZUxvZzoxLjkxNS4yLjYKLS0tIHNyYy93aW5zdXAvY3lnd2luL0NoYW5nZUxv
ZzoxLjkyNQlTYXQgU2VwIDI5IDAyOjAwOjU5IDIwMDEKKysrIHNyYy93aW5z
dXAvY3lnd2luL0NoYW5nZUxvZwlTYXQgU2VwIDI5IDAzOjQ3OjU2IDIwMDEK
QEAgLTEsMyArMSw2MCBAQAorU2F0IFNlcCAyOSAyMDo0MDowMCAyMDAxIFJv
YmVydCBDb2xsaW5zIDxyYnRjb2xsaW5zQGhvdG1haWwuY29tPgorCisJKiBN
YWtlZmlsZS5pbjogQWRkIGN5Z3NlcnZlcl90cmFuc3BvcnRfc29ja2V0cy5v
IHRvIERMTF9PRklMRVMuCisJQWRkIGN5Z3NlcnZlcl90cmFuc3BvcnRfc29j
a2V0c19vdXRzaWRlLm8gdG8gY3lnc2VydmVyLmV4ZS4KKwkqIGN5Z3NlcnZl
ci5jYzogSW5jbHVkZSBuZXcgaW5jbHVkZSBmaWxlcy4KKwkqIGN5Z3NlcnZl
cl9jbGllbnQuY2M6IERpdHRvLgorCSogY3lnc2VydmVyX3NobS5oOiBObyBu
ZWVkIHRvIGluY2x1ZGUgPHN5cy9zb2NrZXQuaD4gbm93LgorCSogY3lnZXJ2
ZXJfdHJhbnNwb3J0LmNjOiBJbmNsdWRlIG5ldyBpbmNsdWRlIGZpbGVzLgor
CSh0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6dHJhbnNwb3J0X2xheWVyX2Jhc2Up
OiBTdHJpcCBiYWNrIHRvIGEgc3R1Yi4KKwkodHJhbnNwb3J0X2xheWVyX2Jh
c2U6Omxpc3Rlbik6IERpdHRvLgorCSh0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6
YWNjZXB0KTogRGl0dG8uCisJKHRyYW5zcG9ydF9sYXllcl9iYXNlOjpjbG9z
ZSk6IERpdHRvLgorCSh0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6cmVhZCk6IERp
dHRvLgorCSh0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6d3JpdGUpOiBEaXR0by4K
KwkodHJhbnNwb3J0X2xheWVyX2Jhc2U6OmNvbm5lY3QpOiBEaXR0by4KKwkq
IGN5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMuY2M6IEluY2x1ZGUgbmV3IGhl
YWRlciAKKwkiY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMuaCIu
CisJKiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3NvY2tldHMuY2M6IE5ldyBmaWxl
LgorCSogZGNydDAuY2M6IE5vIG5lZWQgdG8gaW5jbHVkZSA8c3lzL3NvY2tl
dC5oPiBub3cuCisJKiBmaGFuZGxlcl90dHkuY2M6IERpdHRvLgorCSogdHR5
LmNjOiBEaXR0by4KKwkqIGluY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90cmFu
c3BvcnQuaDogU3RyaXAgdGhlIGJhc2UgY2xhc3MgdG8gYSBzdHViLgorCVJl
bW92ZSB0aGUgY3lnc2VydmVyX3RyYW5zcG9ydF9waXBlcyBjbGFzcy4KKwkq
IGluY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMuaDog
TmV3IGZpbGUuCisJKiBpbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNw
b3J0X3NvY2tldHMuaDogTmV3IGZpbGUuCisKK1R1ZSBTZXAgMjUgMTY6MjI6
MDAgMjAwMSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNv
bT4KKworCSogYXV0b2xvYWQuY2M6IEFkZCBkeW5hbWljIGxvYWQgc3RhdGVt
ZW50IGZvciAnSW1wZXJzb25hdGVOYW1lZFBpcGVDbGllbnQnLgorCSogTWFr
ZWZpbGUuaW46IEFkZCBuZXcgb2JqZWN0IGZpbGVzLCBhbmQgYnVpbGQgaW5z
dHJ1Y3Rpb25zIGZvciBjeWdzZXJ2ZXIuZXhlLgorCSogY3lnd2luLmRpbjog
RXhwb3J0IGZ0b2ssIHNobWF0LCBzaG1jdGwgYW5kIHNobWdldC4KKwkqIGRj
cnQwLmNjOiBBZGRpdGlvbmFsIGluY2x1ZGVzIGZvciBjeWdzZXJ2ZXIgc3Vw
cG9ydC4KKwkoZGxsX2NydDBfMSk6IEluaXRpYWxpc2UgdGhlIGN5Z3NlcnZl
ciBjbGllbnQuCisJKiBmaGFuZGxlci5oIChmaGFuZGxlcl90dHkpOiBOZXcg
bWV0aG9kIGN5Z3NlcnZlcl9hdHRhY2hfdHR5LgorCSogZmhhbmRsZXJfdHR5
LmNjOiBBZGRpdGlvbmFsIGluY2x1ZGVzIGZvciBjeWdzZXJ2ZXIgc3VwcG9y
dC4KKwkoZmhhbmRsZXJfdHR5X3NsYXZlOjpvcGVuKTogQXR0ZW1wdCB0byB1
c2UgdGhlIGN5Z3NlcnZlciB3aGVuIG9idGFpbmluZworCWhhbmRsZXMgZnJv
bSB0aGUgcGFyZW50IHByb2Nlc3MuIE9uIGZhaWx1cmUgb3IgOXggdXNlIHRo
ZSBjdXJyZW50IG1ldGhvZC4KKwkoZmhhbmRsZXJfdHR5X3NsYXZlOjpjeWdz
ZXJ2ZXJfYXR0YWNoX3R0eSk6IE5ldyBmdW5jdGlvbi4KKwkqIGZvcmsuY2Mg
KGZvcmtfY2hpbGQpOiBGaXh1cCBzaG0gbWVtb3J5IG1hcHBlZCBhcmVhcy4K
KwkqIHBpbmZvLmg6IERlY2xhcmUgZml4dXBfc2htc19hZnRlcl9mb3JrKCku
CisJKiBzZWN1cml0eS5oOiBEZWNsYXJlIGFsbG9jX3NkKCkuCisJKiB0dHku
Y2M6IEFkZGl0b25hbCBpbmNsdWRlcyB0byBzdXBwb3J0IGN5Z3NlcnZlci4K
KwkodHR5Ojpjb21tb25faW5pdCk6IERvbid0IGFsbG93IG90aGVycyB0byBv
cGVuIHVzIGlmIHRoZSBjeWdzZXJ2ZXIgaXMgcnVubmluZy4KKwkqIHdpbnN1
cC5oOiBEZWNsYXJlIGN5Z3NlcnZlcl9ydW5uaW5nLgorCSogY3lnc2VydmVy
LmNjOiBOZXcgZmlsZS4KKwkqIGN5Z3NlcnZlcl9jbGllbnQuY2M6IE5ldyBm
aWxlLgorCSogY3lnc2VydmVyX3NobS5jYzogTmV3IGZpbGUuCisJKiBjeWdz
ZXJ2ZXJfc2htLmg6IE5ldyBmaWxlLgorCSogY3lnc2VydmVyX3RyYW5zcG9y
dC5jYzogTmV3IGZpbGUuCisJKiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVz
LmNjOiBOZXcgZmlsZS4KKwkqIGlwYy5jYzogTmV3IGZpbGUuCisJKiBzaG0u
Y2M6IE5ldyBmaWxlLgorCSogaW5jbHVkZS9jeWd3aW4vY3lnc2VydmVyLmg6
IE5ldyBmaWxlLgorCSogaW5jbHVkZS9jeWd3aW4vY3lnc2VydmVyX3RyYW5z
cG9ydC5oOiBOZXcgZmlsZS4KKwkqIGluY2x1ZGUvc3lzL2lwYy5oOiBOZXcg
ZmlsZS4KKwkqIGluY2x1ZGUvc3lzL3NobS5oOiBOZXcgZmlsZS4KKwogU2F0
IFNlcCAyOSAxODoyNjowMCAyMDAxICBSb2JlcnQgQ29sbGlucyA8cmJ0Y29s
bGluc0Bob3RtYWlsLmNvbT4KIAogCSogcHRocmVhZC5jYyAocHRocmVhZF9j
b25kX3RpbWVkd2FpdCk6IERlbGV0ZWQgLSBleHBvcnRlZCBmcm9tIHRocmVh
ZC5jYy4KSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL01ha2VmaWxlLmluCmRp
ZmYgLXUgc3JjL3dpbnN1cC9jeWd3aW4vTWFrZWZpbGUuaW46MS42NCBzcmMv
d2luc3VwL2N5Z3dpbi9NYWtlZmlsZS5pbjoxLjYzLjIuMwotLS0gc3JjL3dp
bnN1cC9jeWd3aW4vTWFrZWZpbGUuaW46MS42NAlUaHUgU2VwIDI3IDE0OjM1
OjE2IDIwMDEKKysrIHNyYy93aW5zdXAvY3lnd2luL01ha2VmaWxlLmluCVNh
dCBTZXAgMjkgMDM6NDc6NTcgMjAwMQpAQCAtMTE2LDE2ICsxMTYsMjAgQEAK
IAogRExMX0lNUE9SVFM6PSQodzMyYXBpX2xpYikvbGlia2VybmVsMzIuYQog
Ci1ETExfT0ZJTEVTOj1hc3NlcnQubyBhdXRvbG9hZC5vIGN5Z2hlYXAubyBk
Y3J0MC5vIGRlYnVnLm8gZGVscXVldWUubyBkaXIubyBcCitETExfT0ZJTEVT
Oj1hc3NlcnQubyBhdXRvbG9hZC5vIGN5Z2hlYXAubyBjeWdzZXJ2ZXJfY2xp
ZW50Lm8gY3lnc2VydmVyX3NobS5vIFwKKwljeWdzZXJ2ZXJfdHJhbnNwb3J0
Lm8gY3lnc2VydmVyX3RyYW5zcG9ydF9waXBlcy5vIGN5Z3NlcnZlcl90cmFu
c3BvcnRfc29ja2V0cy5vIFwKKwlkY3J0MC5vIGRlYnVnLm8gXAorCWRlbHF1
ZXVlLm8gZGlyLm8gXAogCWRsZmNuLm8gZGxsX2luaXQubyBkdGFibGUubyBl
bnZpcm9uLm8gIGVycm5vLm8gZXhjZXB0aW9ucy5vIGV4ZWMubyBcCiAJZXh0
ZXJuYWwubyBmY250bC5vIGZoYW5kbGVyLm8gZmhhbmRsZXJfY2xpcGJvYXJk
Lm8gZmhhbmRsZXJfY29uc29sZS5vIFwKIAlmaGFuZGxlcl9kc3AubyBmaGFu
ZGxlcl9mbG9wcHkubyBmaGFuZGxlcl9tZW0ubyBmaGFuZGxlcl9yYW5kb20u
byBcCiAJZmhhbmRsZXJfcmF3Lm8gZmhhbmRsZXJfc2VyaWFsLm8gZmhhbmRs
ZXJfc29ja2V0Lm8gZmhhbmRsZXJfdGFwZS5vIFwKIAlmaGFuZGxlcl90ZXJt
aW9zLm8gZmhhbmRsZXJfdHR5Lm8gZmhhbmRsZXJfd2luZG93cy5vIGZoYW5k
bGVyX3plcm8ubyBcCi0JZm9yay5vIGdsb2IubyBncnAubyBoZWFwLm8gaW5p
dC5vIGlvY3RsLm8gbG9jYWx0aW1lLm8gbWFsbG9jLm8gXAorCWZvcmsubyBn
bG9iLm8gZ3JwLm8gaGVhcC5vIGluaXQubyBpb2N0bC5vIGlwYy5vIGxvY2Fs
dGltZS5vIG1hbGxvYy5vIFwKIAltaXNjZnVuY3MubyBtbWFwLm8gbmV0Lm8g
bnRlYS5vIHBhc3N3ZC5vIHBhdGgubyBwaW5mby5vIHBpcGUubyBwb2xsLm8g
XAogCXB0aHJlYWQubyByZWdleHAubyByZWdlcnJvci5vIHJlZ3N1Yi5vIHJl
Z2lzdHJ5Lm8gcmVzb3VyY2UubyBzY2FuZGlyLm8gXAotCXNjaGVkLm8gc2Vj
X2FjbC5vIHNlY19oZWxwZXIubyBzZWN1cml0eS5vIHNlbGVjdC5vIHNoYXJl
ZC5vIHNob3J0Y3V0Lm8gc2lnbmFsLm8gc2lncHJvYy5vIFwKKwlzY2hlZC5v
IHNlY19hY2wubyBzZWNfaGVscGVyLm8gc2VjdXJpdHkubyBzZWxlY3QubyBz
aGFyZWQubyBzaG0ubyBcCisJc2hvcnRjdXQubyBzaWduYWwubyBzaWdwcm9j
Lm8gXAogCXNtYWxscHJpbnQubyBzcGF3bi5vIHN0cmFjZS5vIHN0cnNlcC5v
IHN5bmMubyBzeXNjYWxscy5vIHN5c2NvbmYubyBcCiAJc3lzbG9nLm8gdGVy
bWlvcy5vIHRocmVhZC5vIHRpbWVzLm8gdHR5Lm8gdWluZm8ubyB1bmFtZS5v
IHdhaXQubyBcCiAJd2luY2FwLm8gd2luZG93Lm8gXApAQCAtMTQ0LDE0ICsx
NDgsMTcgQEAKIAogYWxsOiBhbGxfdGFyZ2V0ICQoYWxsX2hvc3QpCiAKLWFs
bF90YXJnZXQ6ICQoTElCX05BTUUpIGF1dG9tb2RlLm8gYmlubW9kZS5vIHRl
eHRtb2RlLm8gJChMSUJHTU9OX0EpCithbGxfdGFyZ2V0OiAkKExJQl9OQU1F
KSBhdXRvbW9kZS5vIGJpbm1vZGUubyB0ZXh0bW9kZS5vICQoTElCR01PTl9B
KSBjeWdzZXJ2ZXIuZXhlCiAKIGFsbF9ob3N0OiBuZXctJChMSUJfTkFNRSkg
Y3lncnVuLmV4ZQogCiBmb3JjZToKIAotaW5zdGFsbDogaW5zdGFsbC1saWJz
IGluc3RhbGwtaGVhZGVycyAkKGluc3RhbGxfaG9zdCkgJChpbnN0YWxsX3Rh
cmdldCkKK2luc3RhbGw6IGluc3RhbGwtYmluIGluc3RhbGwtbGlicyBpbnN0
YWxsLWhlYWRlcnMgJChpbnN0YWxsX2hvc3QpICQoaW5zdGFsbF90YXJnZXQp
CiAKK2luc3RhbGwtYmluOiBjeWdzZXJ2ZXIuZXhlCisJJChJTlNUQUxMX1BS
T0dSQU0pIGN5Z3NlcnZlci5leGUgJChiaW5kaXIpL2N5Z3NlcnZlci5leGUJ
CisKIGluc3RhbGwtbGliczogJChMSUJfTkFNRSkKIAkkKElOU1RBTExfREFU
QSkgbmV3LSQoRExMX05BTUUpICQoYmluZGlyKS8kKERMTF9OQU1FKTsgXAog
CWZvciBpIGluICQoTElCX05BTUUpICQoR01PTl9TVEFSVCkgJChMSUJHTU9O
X0EpIGF1dG9tb2RlLm8gYmlubW9kZS5vIHRleHRtb2RlLm8gOyBkbyBcCkBA
IC0yMTYsNiArMjIzLDMwIEBACiBjeWdydW4uZXhlIDogY3lncnVuLm8gJChM
SUJfTkFNRSkgJCh3MzJhcGlfbGliKS9saWJ1c2VyMzIuYSBcCiAJICAgICAk
KHczMmFwaV9saWIpL2xpYnNoZWxsMzIuYSAkKHczMmFwaV9saWIpL2xpYmtl
cm5lbDMyLmEKIAkkKENDKSAtbm9kZWZhdWx0bGlicyAtbyAkQCAkXgorCitj
eWdzZXJ2ZXJfdHJhbnNwb3J0X291dHNpZGUubzogY3lnc2VydmVyX3RyYW5z
cG9ydC5jYworCSQoQ09NUElMRV9DWFgpIC1EX19PVVRTSURFX0NZR1dJTl9f
IC1vICRAICQ8CisKK2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXNfb3V0c2lk
ZS5vOiBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmNjCisJJChDT01QSUxF
X0NYWCkgLURfX09VVFNJREVfQ1lHV0lOX18gLW8gJEAgJDwKKworY3lnc2Vy
dmVyX3RyYW5zcG9ydF9zb2NrZXRzX291dHNpZGUubzogY3lnc2VydmVyX3Ry
YW5zcG9ydF9zb2NrZXRzLmNjCisJJChDT01QSUxFX0NYWCkgLURfX09VVFNJ
REVfQ1lHV0lOX18gLW8gJEAgJDwKKworY3lnc2VydmVyX2NsaWVudF9vdXRz
aWRlLm86IGN5Z3NlcnZlcl9jbGllbnQuY2MKKwkgJChDT01QSUxFX0NYWCkg
LURfX09VVFNJREVfQ1lHV0lOX18gLW8gJEAgJDwKKworY3lnc2VydmVyX3No
bV9vdXRzaWRlLm86IGN5Z3NlcnZlcl9zaG0uY2MKKwkkKENPTVBJTEVfQ1hY
KSAtRF9fT1VUU0lERV9DWUdXSU5fXyAtbyAkQCAkPAorCitjeWdzZXJ2ZXIu
ZXhlOiBjeWdzZXJ2ZXIubyBjeWdzZXJ2ZXJfc2htX291dHNpZGUubyBjeWdz
ZXJ2ZXJfdHJhbnNwb3J0X291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0
X3BpcGVzX291dHNpZGUubyBjeWdzZXJ2ZXJfdHJhbnNwb3J0X3NvY2tldHNf
b3V0c2lkZS5vIGN5Z3NlcnZlcl9jbGllbnRfb3V0c2lkZS5vIHdpbmNhcC5v
IHNtYWxscHJpbnQubyAKKwkkKENYWCkgLW8gJEAgJF4KKyNpZmRlZiBWRVJC
T1NFCisjCSQoQ1hYKSAkKE1JTkdXX0NYWEZMQUdTKSAtbyAkQCAke3dvcmRs
aXN0IDEsMywkXn0gLUIkKG1pbmd3X2J1aWxkKS8gJChNSU5HV19MREZMQUdT
KQorI2Vsc2UKKyMJQGVjaG8gJChDWFgpIC1vICRAICR7d29yZGxpc3QgMSwz
LCRefSAke2ZpbHRlci1vdXQgLUIlLCAkKE1JTkdXX0NYWEZMQUdTKSAkKE1J
TkdXX0xERkxBR1MpfTtcCisjCSQoQ1hYKSAkKE1JTkdXX0NYWEZMQUdTKSAt
byAkQCAke3dvcmRsaXN0IDEsMywkXn0gLUIkKG1pbmd3X2J1aWxkKS8gJChN
SU5HV19MREZMQUdTKQorI2VuZGlmCiAKICMMCiAKSW5kZXg6IHNyYy93aW5z
dXAvY3lnd2luL2F1dG9sb2FkLmNjCmRpZmYgLXUgc3JjL3dpbnN1cC9jeWd3
aW4vYXV0b2xvYWQuY2M6MS4zMiBzcmMvd2luc3VwL2N5Z3dpbi9hdXRvbG9h
ZC5jYzoxLjMyLjIuMQotLS0gc3JjL3dpbnN1cC9jeWd3aW4vYXV0b2xvYWQu
Y2M6MS4zMglXZWQgU2VwIDEyIDEwOjQ2OjM1IDIwMDEKKysrIHNyYy93aW5z
dXAvY3lnd2luL2F1dG9sb2FkLmNjCU1vbiBTZXAgMjQgMjM6MzE6MDMgMjAw
MQpAQCAtMzI3LDYgKzMyNyw3IEBACiBMb2FkRExMZnVuYyAoR2V0VG9rZW5J
bmZvcm1hdGlvbiwgMjAsIGFkdmFwaTMyKQogTG9hZERMTGZ1bmMgKEdldFVz
ZXJOYW1lQSwgOCwgYWR2YXBpMzIpCiBMb2FkRExMZnVuYyAoSW1wZXJzb25h
dGVMb2dnZWRPblVzZXIsIDQsIGFkdmFwaTMyKQorTG9hZERMTGZ1bmMgKElt
cGVyc29uYXRlTmFtZWRQaXBlQ2xpZW50LCA0LCBhZHZhcGkzMikKIExvYWRE
TExmdW5jIChJbml0aWFsaXplQWNsLCAxMiwgYWR2YXBpMzIpCiBMb2FkRExM
ZnVuYyAoSW5pdGlhbGl6ZVNlY3VyaXR5RGVzY3JpcHRvciwgOCwgYWR2YXBp
MzIpCiBMb2FkRExMZnVuYyAoSW5pdGlhbGl6ZVNpZCwgMTIsIGFkdmFwaTMy
KQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyLmNjCmRpZmYg
LXUgL2Rldi9udWxsIHNyYy93aW5zdXAvY3lnd2luL2N5Z3NlcnZlci5jYzox
LjEuMi4yCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAgMTk3
MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyLmNjCVNhdCBTZXAg
MjkgMDM6NDc6NTcgMjAwMQpAQCAtMCwwICsxLDU0OCBAQAorLyogY3lnc2Vy
dmVyLmNjCisKKyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQgSW5jLgorCisg
ICBXcml0dGVuIGJ5IEVnb3IgRHVkYSA8ZGVvQGxvZ29zLW0ucnU+CisKKyAg
IFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0
d2FyZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZQorICAgQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29u
c3VsdCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorICAgZGV0YWls
cy4gKi8KKworI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8c3RkaW8u
aD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNsdWRlIDx3aW5kb3dzLmg+
CisjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CisjaW5jbHVkZSA8c3lzL3NvY2tl
dC5oPgorI2luY2x1ZGUgPG5ldGRiLmg+CisjaW5jbHVkZSAid2luY2FwLmgi
CisKKyNpbmNsdWRlICJnZXRvcHQuaCIKKworI2luY2x1ZGUgImN5Z3dpbi9j
eWdzZXJ2ZXJfdHJhbnNwb3J0LmgiCisjaW5jbHVkZSAiY3lnd2luL2N5Z3Nl
cnZlcl90cmFuc3BvcnRfcGlwZXMuaCIKKyNpbmNsdWRlICJjeWd3aW4vY3ln
c2VydmVyX3RyYW5zcG9ydF9zb2NrZXRzLmgiCisjaW5jbHVkZSAiY3lnd2lu
L2N5Z3NlcnZlci5oIgorI2luY2x1ZGUgImN5Z3NlcnZlcl9zaG0uaCIKKwor
CitHRU5FUklDX01BUFBJTkcgYWNjZXNzX21hcHBpbmc7CitjbGFzcyB0cmFu
c3BvcnRfbGF5ZXJfYmFzZSAqdHJhbnNwb3J0OworCitEV09SRCByZXF1ZXN0
X2NvdW50ID0gMDsKKworQk9PTAorc2V0dXBfcHJpdmlsZWdlcyAoKQorewor
ICBCT09MIHJjLCByZXRfdmFsOworICBIQU5ETEUgaFRva2VuID0gTlVMTDsK
KyAgVE9LRU5fUFJJVklMRUdFUyBzUHJpdmlsZWdlczsKKworICByYyA9IE9w
ZW5Qcm9jZXNzVG9rZW4gKCBHZXRDdXJyZW50UHJvY2VzcygpICwgVE9LRU5f
QUxMX0FDQ0VTUyAsICZoVG9rZW4gKSA7CisgIGlmICggIXJjICkKKyAgICB7
CisgICAgICBwcmludGYgKCAiZXJyb3Igb3BlbmluZyBwcm9jZXNzIHRva2Vu
ICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkgKTsKKyAgICAgIHJldF92YWwg
PSBGQUxTRTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKyAgcmMgPSBMb29r
dXBQcml2aWxlZ2VWYWx1ZSAoIE5VTEwsIFNFX0RFQlVHX05BTUUsICZzUHJp
dmlsZWdlcy5Qcml2aWxlZ2VzWzBdLkx1aWQgKTsKKyAgaWYgKCAhcmMgKQor
ICAgIHsKKyAgICAgIHByaW50ZiAoICJlcnJvciBnZXR0aW5nIHByaWdpbGVn
ZSBsdWlkICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkgKTsKKyAgICAgIHJl
dF92YWwgPSBGQUxTRTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKyAgc1By
aXZpbGVnZXMuUHJpdmlsZWdlQ291bnQgPSAxIDsKKyAgc1ByaXZpbGVnZXMu
UHJpdmlsZWdlc1swXS5BdHRyaWJ1dGVzID0gU0VfUFJJVklMRUdFX0VOQUJM
RUQgOworICByYyA9IEFkanVzdFRva2VuUHJpdmlsZWdlcyAoIGhUb2tlbiwg
RkFMU0UsICZzUHJpdmlsZWdlcywgMCwgTlVMTCwgTlVMTCApIDsKKyAgaWYg
KCAhcmMgKQorICAgIHsKKyAgICAgIHByaW50ZiAoICJlcnJvciBhZGp1c3Rp
bmcgcHJpZ2lsZWdlIGxldmVsLiAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgp
ICk7CisgICAgICByZXRfdmFsID0gRkFMU0U7CisgICAgICBnb3RvIG91dDsK
KyAgICB9CisKKyAgYWNjZXNzX21hcHBpbmcuR2VuZXJpY1JlYWQgPSBGSUxF
X1JFQURfREFUQTsKKyAgYWNjZXNzX21hcHBpbmcuR2VuZXJpY1dyaXRlID0g
RklMRV9XUklURV9EQVRBOworICBhY2Nlc3NfbWFwcGluZy5HZW5lcmljRXhl
Y3V0ZSA9IDA7CisgIGFjY2Vzc19tYXBwaW5nLkdlbmVyaWNBbGwgPSBGSUxF
X1JFQURfREFUQSB8IEZJTEVfV1JJVEVfREFUQTsKKworICByZXRfdmFsID0g
VFJVRTsKKworb3V0OgorICBDbG9zZUhhbmRsZSAoIGhUb2tlbiApOworICBy
ZXR1cm4gcmV0X3ZhbDsKK30KKworaW50CitjaGVja19hbmRfZHVwX2hhbmRs
ZSAoSEFORExFIGZyb21fcHJvY2VzcywgSEFORExFIHRvX3Byb2Nlc3MsCisJ
CSAgICAgIEhBTkRMRSBmcm9tX3Byb2Nlc3NfdG9rZW4sCisgICAgICAgICAg
ICAgICAgICAgICAgRFdPUkQgYWNjZXNzLAorICAgICAgICAgICAgICAgICAg
ICAgIEhBTkRMRSBmcm9tX2hhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAg
ICBIQU5ETEUqIHRvX2hhbmRsZV9wdHIsIEJPT0wgYkluaGVyaXRIYW5kbGUp
Cit7CisgIEhBTkRMRSBsb2NhbF9oYW5kbGUgPSBOVUxMOworICBpbnQgcmV0
X3ZhbCA9IEVBQ0NFUzsKKyAgY2hhciBzZF9idWYgWzEwMjRdOworICBQU0VD
VVJJVFlfREVTQ1JJUFRPUiBzZCA9IChQU0VDVVJJVFlfREVTQ1JJUFRPUikg
JnNkX2J1ZjsKKyAgRFdPUkQgYnl0ZXNfbmVlZGVkOworICBQUklWSUxFR0Vf
U0VUIHBzOworICBEV09SRCBwc19sZW4gPSBzaXplb2YgKHBzKTsKKyAgQk9P
TCBzdGF0dXM7CisKKyAgaWYgKGZyb21fcHJvY2VzcyAhPSBHZXRDdXJyZW50
UHJvY2VzcyAoKSkKK3sgCisKKyAgaWYgKCFEdXBsaWNhdGVIYW5kbGUgKGZy
b21fcHJvY2VzcywgZnJvbV9oYW5kbGUsCisJICAgICAgICAgICAgICAgIEdl
dEN1cnJlbnRQcm9jZXNzICgpLCAmbG9jYWxfaGFuZGxlLAorICAgICAgICAg
ICAgICAgICAgICAgICAgMCwgYkluaGVyaXRIYW5kbGUsCisgICAgICAgICAg
ICAgICAgICAgICAgICBEVVBMSUNBVEVfU0FNRV9BQ0NFU1MpKQorICAgIHsK
KyAgICAgIHByaW50ZiAoICJlcnJvciBnZXR0aW5nIGhhbmRsZSgldSkgdG8g
c2VydmVyICglbHUpXG4iLCAodW5zaWduZWQgaW50KWZyb21faGFuZGxlLCBH
ZXRMYXN0RXJyb3IgKCkpOworICAgICAgZ290byBvdXQ7CisgICAgfQorfSBl
bHNlCisgbG9jYWxfaGFuZGxlID0gZnJvbV9oYW5kbGU7CisKKyAgaWYgKCFH
ZXRLZXJuZWxPYmplY3RTZWN1cml0eSAobG9jYWxfaGFuZGxlLAorICAJCQkg
ICAgICAgIE9XTkVSX1NFQ1VSSVRZX0lORk9STUFUSU9OIHwgR1JPVVBfU0VD
VVJJVFlfSU5GT1JNQVRJT04JfCBEQUNMX1NFQ1VSSVRZX0lORk9STUFUSU9O
LAorCQkJCXNkLCBzaXplb2YgKHNkX2J1ZiksICZieXRlc19uZWVkZWQpKQor
ICAgIHsKKyAgICAgIHByaW50ZiAoICJlcnJvciBnZXR0aW5nIGhhbmRsZSBT
RCAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGdvdG8gb3V0
OworICAgIH0KKworICBNYXBHZW5lcmljTWFzayAoJmFjY2VzcywgJmFjY2Vz
c19tYXBwaW5nKTsKKworICBpZiAoIUFjY2Vzc0NoZWNrIChzZCwgZnJvbV9w
cm9jZXNzX3Rva2VuLCBhY2Nlc3MsICZhY2Nlc3NfbWFwcGluZywKKyAgCQkg
ICAgJnBzLCAmcHNfbGVuLCAmYWNjZXNzLCAmc3RhdHVzKSkKKyAgICB7Cisg
ICAgICBwcmludGYgKCAiZXJyb3IgY2hlY2tpbmcgYWNjZXNzIHJpZ2h0cyAo
JWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGdvdG8gb3V0Owor
ICAgIH0KKworICBpZiAoIXN0YXR1cykKKyAgICB7CisgICAgICBwcmludGYg
KCAiYWNjZXNzIHRvIG9iamVjdCBkZW5pZWRcbiIpOworICAgICAgZ290byBv
dXQ7CisgICAgfQorCisgIGlmICghRHVwbGljYXRlSGFuZGxlIChmcm9tX3By
b2Nlc3MsIGZyb21faGFuZGxlLAorCSAgICAgICAgICAgICAgICB0b19wcm9j
ZXNzLCB0b19oYW5kbGVfcHRyLAorICAgICAgICAgICAgICAgICAgICAgICAg
YWNjZXNzLCBiSW5oZXJpdEhhbmRsZSwgMCkpCisgICAgeworICAgICAgcHJp
bnRmICggImVycm9yIGdldHRpbmcgaGFuZGxlIHRvIGNsaWVudCAoJWx1KVxu
IiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGdvdG8gb3V0OworICAgIH0K
KworICByZXRfdmFsID0gMDsKKyAgICAgICAgICAgICAgICAgICAgCitvdXQ6
CisgIGlmIChsb2NhbF9oYW5kbGUgJiYgZnJvbV9wcm9jZXNzICE9IEdldEN1
cnJlbnRQcm9jZXNzICgpKQorICAgIENsb3NlSGFuZGxlIChsb2NhbF9oYW5k
bGUpOworCisgIHJldHVybiAocmV0X3ZhbCk7Cit9CisKK2ludAorY2hlY2tf
YW5kX2R1cF9oYW5kbGUgKEhBTkRMRSBmcm9tX3Byb2Nlc3MsIEhBTkRMRSB0
b19wcm9jZXNzLAorICAgICAgICAgICAgICAgICAgICAgIEhBTkRMRSBmcm9t
X3Byb2Nlc3NfdG9rZW4sCisgICAgICAgICAgICAgICAgICAgICAgRFdPUkQg
YWNjZXNzLAorICAgICAgICAgICAgICAgICAgICAgIEhBTkRMRSBmcm9tX2hh
bmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICBIQU5ETEUqIHRvX2hhbmRs
ZV9wdHIpCit7CisgIHJldHVybiBjaGVja19hbmRfZHVwX2hhbmRsZShmcm9t
X3Byb2Nlc3MsdG9fcHJvY2Vzcyxmcm9tX3Byb2Nlc3NfdG9rZW4sYWNjZXNz
LGZyb21faGFuZGxlLHRvX2hhbmRsZV9wdHIsRkFMU0UpOworfQorCit2b2lk
CitjbGllbnRfcmVxdWVzdF9hdHRhY2hfdHR5OjpzZXJ2ZSh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqY29ubikKK3sKKyAgSEFORExFIGZyb21fcHJvY2Vzc19o
YW5kbGUgPSBOVUxMOworICBIQU5ETEUgdG9fcHJvY2Vzc19oYW5kbGUgPSBO
VUxMOworICBIQU5ETEUgdG9rZW5faGFuZGxlID0gTlVMTDsKKyAgRFdPUkQg
cmM7CisKKyAgaWYgKGhlYWRlci5jYiAhPSBzaXplb2YgKHJlcSkpCisgICAg
eworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFSU5WQUw7CisgICAgICBy
ZXR1cm47CisgICAgfQorCisjaWZkZWYgREVCVUcKKyAgcHJpbnRmICgiJWQ6
KCVkLCVkKSAtPiAlZFxuIiwgcmVxLm1hc3Rlcl9waWQsCisgIAkgIAkJCXJl
cS5mcm9tX21hc3RlciwgcmVxLnRvX21hc3RlciwKKwkJCQlyZXEucGlkKTsK
KyNlbmRpZgorCisgIGZyb21fcHJvY2Vzc19oYW5kbGUgPSBPcGVuUHJvY2Vz
cyAoUFJPQ0VTU19EVVBfSEFORExFLCBGQUxTRSwgcmVxLm1hc3Rlcl9waWQp
OworICB0b19wcm9jZXNzX2hhbmRsZSA9IE9wZW5Qcm9jZXNzIChQUk9DRVNT
X0RVUF9IQU5ETEUsIEZBTFNFLCByZXEucGlkKTsKKyAgaWYgKCFmcm9tX3By
b2Nlc3NfaGFuZGxlIHx8ICF0b19wcm9jZXNzX2hhbmRsZSkKKyAgICB7Cisg
ICAgICBwcmludGYgKCJlcnJvciBvcGVuaW5nIHByb2Nlc3MgKCVsdSlcbiIs
IEdldExhc3RFcnJvciAoKSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9
IEVBQ0NFUzsKKyAgICAgIGdvdG8gb3V0OworICAgIH0KKworICB0cmFuc3Bv
cnQtPmltcGVyc29uYXRlX2NsaWVudCAoKTsKKyAgCisgIHJjID0gT3BlblRo
cmVhZFRva2VuIChHZXRDdXJyZW50VGhyZWFkICgpLAorICAJCQlUT0tFTl9R
VUVSWSwKKyAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUsCisJCQkmdG9r
ZW5faGFuZGxlKTsKKworICB0cmFuc3BvcnQtPnJldmVydF90b19zZWxmICgp
OworCisgIGlmICghcmMpCisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3Ig
b3BlbmluZyB0aHJlYWQgdG9rZW4gKCVsdSlcbiIsIEdldExhc3RFcnJvciAo
KSk7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NFUzsKKyAgICAg
IGdvdG8gb3V0OworICAgIH0KKworICBpZiAoY2hlY2tfYW5kX2R1cF9oYW5k
bGUgKGZyb21fcHJvY2Vzc19oYW5kbGUsIHRvX3Byb2Nlc3NfaGFuZGxlLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBHRU5FUklDX1JFQUQsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmZyb21fbWFzdGVyLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZyZXEuZnJvbV9tYXN0ZXIpICE9
IDApCisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgZHVwbGljYXRpbmcg
ZnJvbV9tYXN0ZXIgaGFuZGxlICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkp
OworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAgICBn
b3RvIG91dDsKKyAgICB9CisKKyAgaWYgKHJlcS50b19tYXN0ZXIpCisgICAg
eworICAgICAgaWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChmcm9tX3Byb2Nl
c3NfaGFuZGxlLCB0b19wcm9jZXNzX2hhbmRsZSwKKwkJCQl0b2tlbl9oYW5k
bGUsCisJCQkJR0VORVJJQ19XUklURSwKKwkJCQlyZXEudG9fbWFzdGVyLAor
CQkJCSZyZXEudG9fbWFzdGVyKSAhPSAwKQorCXsKKwkgIHByaW50ZiAoImVy
cm9yIGR1cGxpY2F0aW5nIHRvX21hc3RlciBoYW5kbGUgKCVsdSlcbiIsIEdl
dExhc3RFcnJvciAoKSk7CisJICBoZWFkZXIuZXJyb3JfY29kZSA9IEVBQ0NF
UzsKKwkgIGdvdG8gb3V0OworCX0KKyAgICB9CisKKyNpZmRlZiBERUJVRwor
ICBwcmludGYgKCIlZCAtPiAlZCglZCwlZClcbiIsIHJlcS5tYXN0ZXJfcGlk
LCByZXEucGlkLAorICAJICAJCQlyZXEuZnJvbV9tYXN0ZXIsIHJlcS50b19t
YXN0ZXIpOworI2VuZGlmCisKKyAgaGVhZGVyLmVycm9yX2NvZGUgPSAwOwor
CitvdXQ6CisgIGlmIChmcm9tX3Byb2Nlc3NfaGFuZGxlKQorICAgIENsb3Nl
SGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyAgaWYgKHRvX3Byb2Nl
c3NfaGFuZGxlKQorICAgIENsb3NlSGFuZGxlICh0b19wcm9jZXNzX2hhbmRs
ZSk7CisgIGlmICh0b2tlbl9oYW5kbGUpCisgICAgQ2xvc2VIYW5kbGUgKHRv
a2VuX2hhbmRsZSk7Cit9CisKK3ZvaWQKK2NsaWVudF9yZXF1ZXN0X2dldF92
ZXJzaW9uOjpzZXJ2ZSh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubikKK3sK
KyAgaWYgKGhlYWRlci5jYiAhPSBzaXplb2YgKHZlcnNpb24pKQorICAgIHsK
KyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUlOVkFMOworICAgICAgcmV0
dXJuOworICAgIH0KKyAgaGVhZGVyLmVycm9yX2NvZGUgPSAwOworICB2ZXJz
aW9uLm1ham9yID0gQ1lHV0lOX1NFUlZFUl9WRVJTSU9OX01BSk9SOworICB2
ZXJzaW9uLmFwaSAgID0gQ1lHV0lOX1NFUlZFUl9WRVJTSU9OX0FQSTsKKyAg
dmVyc2lvbi5taW5vciA9IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9NSU5PUjsK
KyAgdmVyc2lvbi5wYXRjaCA9IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9QQVRD
SDsKK30KKworY2xhc3Mgc2VydmVyX3JlcXVlc3QKK3sKKyAgcHVibGljOgor
ICBjbGFzcyBzZXJ2ZXJfcmVxdWVzdCAqbmV4dDsKKyAgc2VydmVyX3JlcXVl
c3QgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpuZXdjb25uKTsKKyAgdm9pZCBw
cm9jZXNzICgpOworICBwcml2YXRlOgorICAgIGNoYXIgcmVxdWVzdF9idWZm
ZXIgW01BWF9SRVFVRVNUX1NJWkVdOworICAgIHRyYW5zcG9ydF9sYXllcl9i
YXNlICpjb25uOworfTsKKworY2xhc3Mgc2VydmVyX3JlcXVlc3RfcXVldWUK
K3sKKyAgcHVibGljOgorICBDUklUSUNBTF9TRUNUSU9OIHF1ZXVlbG9jazsK
KyAgSEFORExFIGV2ZW50OworICBzZXJ2ZXJfcmVxdWVzdCAqIHJlcXVlc3Q7
CisgIGJvb2wgYWN0aXZlOworICB1bnNpZ25lZCBpbnQgaW5pdGlhbF93b3Jr
ZXJzOworICB1bnNpZ25lZCBpbnQgcnVubmluZzsKKyAgdm9pZCBjcmVhdGVf
d29ya2VycyAoKTsKKyAgdm9pZCBjbGVhbnVwICgpOworICB2b2lkIGFkZCAo
dHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4pOworfTsKK2NsYXNzIHNlcnZl
cl9yZXF1ZXN0X3F1ZXVlIHJlcXVlc3RfcXVldWU7CisKK3ZvaWQKK2NsaWVu
dF9yZXF1ZXN0X3NodXRkb3duOjpzZXJ2ZSAodHJhbnNwb3J0X2xheWVyX2Jh
c2UgKmNvbm4pCit7CisgIC8qIEZJWE1FOiBsaW5rIHVwd2FyZHMsIGFuZCB0
aGVuIHRoaXMgYmVjb21lcyBhIHRyaXZpYWwgbWV0aG9kIGNhbGwgdG8KKyAg
ICogb25seSBzaHV0ZG93biBfdGhpcyBxdWV1ZV8KKyAgICovCisgIC8qIHRl
bGwgdGhlIG1haW4gdGhyZWFkIHRvIHNodXRkb3duICovCisgIHJlcXVlc3Rf
cXVldWUuYWN0aXZlPWZhbHNlOworfQorCitzZXJ2ZXJfcmVxdWVzdDo6c2Vy
dmVyX3JlcXVlc3QgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpuZXdjb25uKQor
eworICBjb25uID0gbmV3Y29ubjsKKyAgbmV4dCA9IE5VTEw7Cit9CisKK3Zv
aWQKK3NlcnZlcl9yZXF1ZXN0Ojpwcm9jZXNzICgpCit7CisgIHNzaXplX3Qg
Ynl0ZXNfcmVhZCwgYnl0ZXNfd3JpdHRlbjsKKyAgc3RydWN0IHJlcXVlc3Rf
aGVhZGVyKiByZXFfcHRyID0gKHN0cnVjdCByZXF1ZXN0X2hlYWRlciopICZy
ZXF1ZXN0X2J1ZmZlcjsKKyAgY2xpZW50X3JlcXVlc3QgKnJlcSA9IE5VTEw7
CisgIHByaW50ZiAoImFib3V0IHRvIHJlYWRcbiIpOworCisgIGJ5dGVzX3Jl
YWQgPSBjb25uLT5yZWFkIChyZXF1ZXN0X2J1ZmZlciwgc2l6ZW9mIChzdHJ1
Y3QgcmVxdWVzdF9oZWFkZXIpKTsKKyAgaWYgKGJ5dGVzX3JlYWQgIT0gc2l6
ZW9mIChzdHJ1Y3QgcmVxdWVzdF9oZWFkZXIpKQorICAgIHsKKyAgICAgIHBy
aW50ZiAoImVycm9yIHJlYWRpbmcgZnJvbSBjb25uZWN0aW9uICglbHUpXG4i
LCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgZ290byBvdXQ7CisgICAgfQor
ICBwcmludGYgKCJnb3QgaGVhZGVyICglbGQpXG4iLCBieXRlc19yZWFkKTsK
KworICBzd2l0Y2ggKHJlcV9wdHItPnJlcV9pZCkKKyAgICB7CisgICAgY2Fz
ZSBDWUdTRVJWRVJfUkVRVUVTVF9HRVRfVkVSU0lPTjoKKyAgICAgIHJlcSA9
IG5ldyBjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lvbiAoKTsgYnJlYWs7Cisg
ICAgY2FzZSBDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hfVFRZOgorICAgICAg
cmVxID0gbmV3IGNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkgKCk7IGJyZWFr
OworICAgIGNhc2UgQ1lHU0VSVkVSX1JFUVVFU1RfU0hVVERPV046CisgICAg
ICByZXEgPSBuZXcgY2xpZW50X3JlcXVlc3Rfc2h1dGRvd24gKCk7IGJyZWFr
OworICAgIGNhc2UgQ1lHU0VSVkVSX1JFUVVFU1RfU0hNX0dFVDoKKyAgICAg
cmVxID0gbmV3IGNsaWVudF9yZXF1ZXN0X3NobV9nZXQgKCk7IGJyZWFrOwor
ICAgIGRlZmF1bHQ6CisgICAgICByZXEgPSBuZXcgY2xpZW50X3JlcXVlc3Qg
KENZR1NFUlZFUl9SRVFVRVNUX0lOVkFMSUQpOworICAgICAgcmVxLT5oZWFk
ZXIuZXJyb3JfY29kZSA9IEVOT1NZUzsKKyAgICAgIHByaW50ZiAoIkJhZCBj
bGllbnQgcmVxdWVzdCAtIHJldHVybmluZyBFTk9TWVNcbiIpOworICAgIH0K
KworICBpZiAocmVxLT5oZWFkZXIuY2IgIT0gcmVxX3B0ci0+Y2IpCisgICAg
eworICAgICAgcHJpbnRmICgiTWlzbWF0Y2ggaW4gcmVxdWVzdCBidWZmZXIg
c2l6ZXNcbiIpOworICAgICAgZ290byBvdXQ7CisgICAgfQorCisgIGlmIChy
ZXEtPmhlYWRlci5jYikKKyAgICB7CisKKyAgICAgIGJ5dGVzX3JlYWQgPSBj
b25uLT5yZWFkIChyZXEtPmJ1ZmZlciwgcmVxLT5oZWFkZXIuY2IpOworICAg
ICAgaWYgKGJ5dGVzX3JlYWQgIT0gcmVxLT5oZWFkZXIuY2IpCisgICAgICAg
IHsKKyAgICAgICAgICBwcmludGYgKCJlcnJvciByZWFkaW5nIGZyb20gY29u
bmVjdGlvbiAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgICAg
ICBnb3RvIG91dDsKKyAgICAgICAgfQorICAgICAgcHJpbnRmICgiZ290IGJv
ZHkgKCVsZClcbiIsYnl0ZXNfcmVhZCk7CisgICAgfQorCisgIC8qIHRoaXMg
aXMgbm90IGFsbG93ZWQgdG8gZmFpbC4gV2UgbXVzdCByZXR1cm4gRU5PU1lT
IGF0IGEgbWluaW11bSB0byB0aGUgY2xpZW50ICovCisgIHJlcS0+c2VydmUg
KGNvbm4pOworCisgIGlmICgoYnl0ZXNfd3JpdHRlbiA9IGNvbm4tPndyaXRl
ICgoY2hhciAqKSZyZXEtPmhlYWRlciwgc2l6ZW9mIChyZXEtPmhlYWRlcikp
KQorICAgICE9IHNpemVvZihyZXEtPmhlYWRlcikgfHwKKyAgICAoYnl0ZXNf
d3JpdHRlbiA9IGNvbm4tPndyaXRlIChyZXEtPmJ1ZmZlciwgcmVxLT5oZWFk
ZXIuY2IpKSAhPSByZXEtPmhlYWRlci5jYikKKyAgICB7CisgICAgICByZXEt
PmhlYWRlci5lcnJvcl9jb2RlID0gLTE7CisgICAgICBwcmludGYgKCJlcnJv
ciB3cml0aW5nIHRvIGNvbm5lY3Rpb24gKCVsdSlcbiIsIEdldExhc3RFcnJv
ciAoKSk7CisgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgcHJpbnRmKCJT
ZW50IHJlcGx5LCBzaXplICglbGQpXG4iLGJ5dGVzX3dyaXR0ZW4pOworCitv
dXQ6CisgIGNvbm4tPmNsb3NlICgpOworICBkZWxldGUgY29ubjsKKyAgaWYg
KHJlcSkKKyAgICBkZWxldGUgKHJlcSk7Cit9CisKK0RXT1JEIFdJTkFQSQor
d29ya2VyX2Z1bmN0aW9uKCBMUFZPSUQgTHBQYXJhbSApCit7CisgIGNsYXNz
IHNlcnZlcl9yZXF1ZXN0X3F1ZXVlICpxdWV1ZSA9IChjbGFzcyBzZXJ2ZXJf
cmVxdWVzdF9xdWV1ZSAqKSBMcFBhcmFtOworICBjbGFzcyBzZXJ2ZXJfcmVx
dWVzdCAqcmVxdWVzdDsKKyAgLyogRklYTUUgdXNlIGEgdGhyZWFkc2FmZSBw
b3AgaW5zdGVhZCBmb3Igc3BlZWQ/ICovCisgIHdoaWxlIChxdWV1ZS0+YWN0
aXZlKQorICAgIHsKKyAgICAgIEVudGVyQ3JpdGljYWxTZWN0aW9uICgmcXVl
dWUtPnF1ZXVlbG9jayk7CisgICAgICB3aGlsZSAoIXF1ZXVlLT5yZXF1ZXN0
ICYmIHF1ZXVlLT5hY3RpdmUpCisgICAgICAgIHsKKwkgIExlYXZlQ3JpdGlj
YWxTZWN0aW9uICgmcXVldWUtPnF1ZXVlbG9jayk7CisgICAgICAgICAgRFdP
UkQgcmMgPSBXYWl0Rm9yU2luZ2xlT2JqZWN0IChxdWV1ZS0+ZXZlbnQsSU5G
SU5JVEUpOworICAgICAgICAgIGlmIChyYyA9PSBXQUlUX0ZBSUxFRCkKKwkg
ICAgeworCSAgICAgIHByaW50ZigiV2FpdCBmb3IgZXZlbnQgZmFpbGVkXG4i
KTsKKwkgICAgICBxdWV1ZS0+cnVubmluZy0tOworCSAgICAgIEV4aXRUaHJl
YWQgKDApOworCSAgICB9CisJICBFbnRlckNyaXRpY2FsU2VjdGlvbiAoJnF1
ZXVlLT5xdWV1ZWxvY2spOworICAgICAgICB9CisgICAgICBpZiAoIXF1ZXVl
LT5hY3RpdmUpCisJeworCSAgcXVldWUtPnJ1bm5pbmctLTsKKwkgIExlYXZl
Q3JpdGljYWxTZWN0aW9uICgmcXVldWUtPnF1ZXVlbG9jayk7CisJICBFeGl0
VGhyZWFkICgwKTsKKwl9CisgICAgICAvKiBub3QgbmVlZGVkLCBidXQgaXQg
aXMgZWZmaWNpZW50ICovCisgICAgICByZXF1ZXN0ID0gKGNsYXNzIHNlcnZl
cl9yZXF1ZXN0ICopSW50ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKCZxdWV1
ZS0+cmVxdWVzdCwgcXVldWUtPnJlcXVlc3QtPm5leHQpOworICAgICAgTGVh
dmVDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZS0+cXVldWVsb2NrKTsKKyAgICAg
IHJlcXVlc3QtPnByb2Nlc3MgKCk7CisgICAgICBkZWxldGUgcmVxdWVzdDsK
KyAgICB9CisgIHF1ZXVlLT5ydW5uaW5nLS07CisgIEV4aXRUaHJlYWQgKDAp
OworfQorCit2b2lkCitzZXJ2ZXJfcmVxdWVzdF9xdWV1ZTo6Y3JlYXRlX3dv
cmtlcnMoKQoreworICBJbml0aWFsaXplQ3JpdGljYWxTZWN0aW9uICgmcXVl
dWVsb2NrKTsKKyAgaWYgKChldmVudCA9IENyZWF0ZUV2ZW50IChOVUxMLCBG
QUxTRSwgRkFMU0UsIE5VTEwpKSA9PSBOVUxMKQorICAgIHsKKyAgICAgIHBy
aW50ZiAoIkZhaWxlZCB0byBjcmVhdGUgZXZlbnQgcXVldWUgKCVsdSksIHRl
cm1pbmF0aW5nXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgZXhpdCAo
MSk7CisgICAgfQorICBhY3RpdmUgPSB0cnVlOworICAKKyAgLyogRklYTUU6
IFVzZSBhIHN0YWNrIHBhaXIgYW5kIGNyZWF0ZSB0aHJlYWRzIG9uIHRoZSBm
bHkgd2hlbmV2ZXIKKyAgICogd2UgaGF2ZSB0byB0byBzZXJ2aWNlIGEgcmVx
dWVzdC4KKyAgICovCisgIGZvciAodW5zaWduZWQgaW50IGk9MDsgaTxpbml0
aWFsX3dvcmtlcnM7IGkrKykKKyAgICB7CisgICAgICBIQU5ETEUgaFRocmVh
ZDsKKyAgICAgIERXT1JEIHRpZDsKKyAgICAgIGhUaHJlYWQgPSBDcmVhdGVU
aHJlYWQgKE5VTEwsIDAsIHdvcmtlcl9mdW5jdGlvbiwgdGhpcywgMCwgJnRp
ZCk7CisgICAgICBpZiAoaFRocmVhZCA9PSBOVUxMKQorICAgICAgICB7CisJ
ICBwcmludGYgKCJGYWlsZWQgdG8gY3JlYXRlIHRocmVhZCAoJWx1KSwgdGVy
bWluYXRpbmdcbiIsIEdldExhc3RFcnJvciAoKSk7CisJICBleGl0ICgxKTsK
Kwl9CisgICAgICBDbG9zZUhhbmRsZSAoaFRocmVhZCk7CisgICAgICBydW5u
aW5nKys7CisgICAgfQorfQorCit2b2lkCitzZXJ2ZXJfcmVxdWVzdF9xdWV1
ZTo6Y2xlYW51cCAoKQoreworICAvKiBoYXJ2ZXN0IHRoZSB0aHJlYWRzICov
CisgIGFjdGl2ZSA9IGZhbHNlOworICBpZiAoIXJ1bm5pbmcpCisgICAgcmV0
dXJuOworICBwcmludGYgKCJXYWl0aW5nIGZvciBjdXJyZW50IGNvbm5lY3Rp
b25zIHRvIHRlcm1pbmF0ZVxuIik7CisgIGZvciAoaW50IG49cnVubmluZzsg
bjsgbi0tKQorICAgIFB1bHNlRXZlbnQgKGV2ZW50KTsKKyAgd2hpbGUgKHJ1
bm5pbmcpCisgICAgc2xlZXAgKDEpOworICBEZWxldGVDcml0aWNhbFNlY3Rp
b24gKCZxdWV1ZWxvY2spOworICBDbG9zZUhhbmRsZSAoZXZlbnQpOworfQor
Cit2b2lkCitzZXJ2ZXJfcmVxdWVzdF9xdWV1ZTo6YWRkICh0cmFuc3BvcnRf
bGF5ZXJfYmFzZSAqY29ubikKK3sKKyAgLyogc2FmZSB0byBub3QgIlRyeSIg
YmVjYXVzZSB3b3JrZXJzIGRvbid0IGhvZyB0aGlzLCB0aGV5IHdhaXQgb24g
dGhlIGV2ZW50CisgICAqLworICBFbnRlckNyaXRpY2FsU2VjdGlvbiAoJnF1
ZXVlbG9jayk7CisgIGlmICghcnVubmluZykKKyAgICB7CisgICAgICBwcmlu
dGYgKCJObyB3b3JrZXIgdGhyZWFkcyB0byBoYW5kbGUgcmVxdWVzdCFcbiIp
OworICAgICAgY29ubi0+Y2xvc2UgKCk7CisgICAgICBkZWxldGUgY29ubjsK
KyAgICB9CisgIHNlcnZlcl9yZXF1ZXN0ICogbGlzdHJlcXVlc3Q7CisgIGlm
ICghcmVxdWVzdCkKKyAgICB7CisgICAgICByZXF1ZXN0ID0gbmV3IHNlcnZl
cl9yZXF1ZXN0IChjb25uKTsKKyAgICAgIGxpc3RyZXF1ZXN0ID0gcmVxdWVz
dDsKKyAgICB9CisgIGVsc2UKKyAgICB7CisgICAgICAvKiBhZGQgdG8gdGhl
IHF1ZXVlIGVuZC4gKi8KKyAgICAgIGxpc3RyZXF1ZXN0ID0gcmVxdWVzdDsK
KyAgICAgIHdoaWxlIChsaXN0cmVxdWVzdC0+bmV4dCkKKwlsaXN0cmVxdWVz
dCA9IGxpc3RyZXF1ZXN0LT5uZXh0OworICAgICAgbGlzdHJlcXVlc3QtPm5l
eHQgPSBuZXcgc2VydmVyX3JlcXVlc3QgKGNvbm4pOworICAgICAgbGlzdHJl
cXVlc3QgPSBsaXN0cmVxdWVzdC0+bmV4dDsKKyAgICB9CisgIFB1bHNlRXZl
bnQgKGV2ZW50KTsKKyAgTGVhdmVDcml0aWNhbFNlY3Rpb24gKCZxdWV1ZWxv
Y2spOworfQorCitzdHJ1Y3Qgb3B0aW9uIGxvbmdvcHRzW10gPSB7CisgIHsi
c2h1dGRvd24iLCBub19hcmd1bWVudCwgTlVMTCwgJ3MnfSwKKyAgezAsIG5v
X2FyZ3VtZW50LCBOVUxMLCAwfQorfTsKKworY2hhciBvcHRzW10gPSAicyI7
CisKK2ludAorbWFpbiAoaW50IGFyZ2MsIGNoYXIgKiphcmd2KQoreworICBp
bnQgc2h1dGRvd249MDsKKyAgY2hhciBpOworCisgIHdoaWxlICgoaSA9IGdl
dG9wdF9sb25nIChhcmdjLCBhcmd2LCBvcHRzLCBsb25nb3B0cywgTlVMTCkp
ICE9IEVPRikKKyAgICBzd2l0Y2ggKGkpCisgICAgICB7CisgICAgICBjYXNl
ICdzJzoKKyAgICAgICAgc2h1dGRvd24gPSAxOworICAgICAgICBicmVhazsK
KyAgICAgIGRlZmF1bHQ6CisgICAgICAgIGJyZWFrOworICAgICAgIC8qTk9U
UkVBQ0hFRCovCisgICAgICB9CisKKyAgd2luY2FwLmluaXQoKTsKKyAgaWYg
KHdpbmNhcC5oYXNfc2VjdXJpdHkgKCkpCisgICAgc2V0dXBfcHJpdmlsZWdl
cyAoKTsKKyAgdHJhbnNwb3J0ID0gY3JlYXRlX3NlcnZlcl90cmFuc3BvcnQg
KCk7CisKKyAgaWYgKHNodXRkb3duKQorICAgIHsKKyAgICAgIGlmICghdHJh
bnNwb3J0LT5jb25uZWN0KCkpCisJeworCSAgcHJpbnRmICgiY291bGRuJ3Qg
ZXN0YWJsaXNoIGNvbm5lY3Rpb24gd2l0aCBzZXJ2ZXJcbiIpOworCSAgZXhp
dCAoMSk7CisJfQorICAgICAgY2xpZW50X3JlcXVlc3Rfc2h1dGRvd24gKnJl
cXVlc3QgPQorCW5ldyBjbGllbnRfcmVxdWVzdF9zaHV0ZG93biAoKTsKKyAg
ICAgIHJlcXVlc3QtPnNlbmQgKHRyYW5zcG9ydCk7CisgICAgICB0cmFuc3Bv
cnQtPmNsb3NlKCk7CisgICAgICBkZWxldGUgdHJhbnNwb3J0OworICAgICAg
ZGVsZXRlIHJlcXVlc3Q7CisgICAgICBleGl0KDApOworICAgIH0KKworICB0
cmFuc3BvcnQtPmxpc3RlbiAoKTsKKyAgcmVxdWVzdF9xdWV1ZS5pbml0aWFs
X3dvcmtlcnMgPSAxMDsKKyAgcmVxdWVzdF9xdWV1ZS5jcmVhdGVfd29ya2Vy
cygpOworICB3aGlsZSAocmVxdWVzdF9xdWV1ZS5hY3RpdmUpCisgICAgewor
ICAgICAgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKiBuZXdfY29ubiA9IHRyYW5z
cG9ydC0+YWNjZXB0ICgpOworICAgICAgLyogRklYTUU6IHRoaXMgaXMgYSBs
aXR0bGUgdWdseS4gV2hhdCB3ZSByZWFsbHkgd2FudCBpcyB0byB3YWl0IG9u
IHR3byBvYmplY3RzOgorICAgICAgICogb25lIGZvciB0aGUgcGlwZS9zb2Nr
ZXQsIGFuZCBvbmUgZm9yIGJlaW5nIHRvbGQgdG8gc2h1dGRvd24uIE90aGVy
d2lzZQorICAgICAgICogdGhpcyB3aWxsIHN0YXkgYSBwcm9ibGVtICh3ZSB3
b24ndCBhY3R1YWxseSBzaHV0ZG93biB1bnRpbCB0aGUgcmVxdWVzdAorICAg
ICAgICogX0FGVEVSXyB0aGUgc2h1dGRvd24gcmVxdWVzdC4gQW5kIHNlbmRp
bmcgb3Vyc2VsdmVzIGEgcmVxdWVzdCBpcyB1Z2x5IAorICAgICAgICovCisg
ICAgICBpZiAobmV3X2Nvbm4gJiYgcmVxdWVzdF9xdWV1ZS5hY3RpdmUpCisg
ICAgICAgICAgcmVxdWVzdF9xdWV1ZS5hZGQgKG5ld19jb25uKTsKKyAgICB9
CisgIHByaW50ZiAoIk5vIGxvbmdlciBhY2NlcHRpbmcgcmVxdWVzdHMuXG4i
KTsKKyAgcmVxdWVzdF9xdWV1ZS5jbGVhbnVwICgpOworICB0cmFuc3BvcnQt
PmNsb3NlICgpOworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2Vy
dmVyX2NsaWVudC5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5
Z3dpbi9jeWdzZXJ2ZXJfY2xpZW50LmNjOjEuMS4yLjIKLS0tIC9kZXYvbnVs
bAkJVGh1IEphbiAgMSAwMTowMDowMCAxOTcwCisrKyBzcmMvd2luc3VwL2N5
Z3dpbi9jeWdzZXJ2ZXJfY2xpZW50LmNjCVNhdCBTZXAgMjkgMDM6NDc6NTgg
MjAwMQpAQCAtMCwwICsxLDIyNyBAQAorLyogY3lnc2VydmVyX2NsaWVudC5j
YworCisgICBDb3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKworICAgV3Jp
dHRlbiBieSBFZ29yIER1ZGEgPGRlb0Bsb2dvcy1tLnJ1PgorCisgICBUaGlz
IGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdhcmUg
aXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJt
cyBvZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQg
dGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMuICov
CisKKyNpZmRlZiBfX09VVFNJREVfQ1lHV0lOX18KKyN1bmRlZiBfX0lOU0lE
RV9DWUdXSU5fXworI2Vsc2UKKyNpbmNsdWRlICJ3aW5zdXAuaCIKKyNlbmRp
ZgorCisjaWZuZGVmIF9fSU5TSURFX0NZR1dJTl9fCisjZGVmaW5lIGRlYnVn
X3ByaW50ZiBwcmludGYKKyNkZWZpbmUgYXBpX2ZhdGFsIHByaW50ZgorI2lu
Y2x1ZGUgPHN0ZGlvLmg+CisjaW5jbHVkZSA8d2luZG93cy5oPgorI2VuZGlm
CisjaW5jbHVkZSA8c3lzL3NvY2tldC5oPgorI2luY2x1ZGUgPGVycm5vLmg+
CisjaW5jbHVkZSA8dW5pc3RkLmg+CisvLyNpbmNsdWRlICJzZWN1cml0eS5o
IgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0LmgiCisj
aW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfcGlwZXMuaCIK
KyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydF9zb2NrZXRz
LmgiCisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlci5oIgorCisvKiAwID0g
dW50ZXN0ZWQsIDEgPSBydW5uaW5nLCAyID0gZGVhZCAqLworaW50IGN5Z3Nl
cnZlcl9ydW5uaW5nPUNZR1NFUlZFUl9VTktOT1dOOworCitjbGllbnRfcmVx
dWVzdF9nZXRfdmVyc2lvbjo6Y2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNpb24g
KCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lHU0VSVkVSX1JFUVVFU1RfR0VUX1ZF
UlNJT04pCit7CisgIGhlYWRlci5jYiA9IHNpemVvZiAodmVyc2lvbik7Cisg
IGJ1ZmZlciA9IChjaGFyICopJnZlcnNpb247Cit9CisKKyNpZmRlZiBfX0lO
U0lERV9DWUdXSU5fXwordm9pZAorY2xpZW50X3JlcXVlc3RfZ2V0X3ZlcnNp
b246OnNlcnZlICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubikKK3sKK30K
KyNlbmRpZgorCitjbGllbnRfcmVxdWVzdF9hdHRhY2hfdHR5OjpjbGllbnRf
cmVxdWVzdF9hdHRhY2hfdHR5ICgpIDogY2xpZW50X3JlcXVlc3QgKENZR1NF
UlZFUl9SRVFVRVNUX0FUVEFDSF9UVFkpCit7CisgIGhlYWRlci5jYiA9IHNp
emVvZiAocmVxKTsKKyAgYnVmZmVyID0gKGNoYXIgKikmcmVxOworICByZXEu
cGlkID0gMDsKKyAgcmVxLm1hc3Rlcl9waWQgPSAwOworICByZXEuZnJvbV9t
YXN0ZXIgPSBOVUxMOworICByZXEudG9fbWFzdGVyID0gTlVMTDsKK30KKwor
Y2xpZW50X3JlcXVlc3RfYXR0YWNoX3R0eTo6Y2xpZW50X3JlcXVlc3RfYXR0
YWNoX3R0eSAoRFdPUkQgbnBpZCwgRFdPUkQgbm1hc3Rlcl9waWQsIEhBTkRM
RSBuZnJvbV9tYXN0ZXIsIEhBTkRMRSBudG9fbWFzdGVyKSA6IGNsaWVudF9y
ZXF1ZXN0IChDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hfVFRZKQoreworICBo
ZWFkZXIuY2IgPSBzaXplb2YgKHJlcSk7CisgIGJ1ZmZlciA9IChjaGFyICop
JnJlcTsKKyAgcmVxLnBpZCA9IG5waWQ7CisgIHJlcS5tYXN0ZXJfcGlkID0g
bm1hc3Rlcl9waWQ7CisgIHJlcS5mcm9tX21hc3RlciA9IG5mcm9tX21hc3Rl
cjsKKyAgcmVxLnRvX21hc3RlciA9IG50b19tYXN0ZXI7Cit9CisKKyNpZmRl
ZiBfX0lOU0lERV9DWUdXSU5fXwordm9pZAorY2xpZW50X3JlcXVlc3RfYXR0
YWNoX3R0eTo6c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKQor
eworfQorI2VuZGlmCisKK2NsaWVudF9yZXF1ZXN0X3NodXRkb3duOjpjbGll
bnRfcmVxdWVzdF9zaHV0ZG93biAoKSA6IGNsaWVudF9yZXF1ZXN0IChDWUdT
RVJWRVJfUkVRVUVTVF9TSFVURE9XTikKK3sKKyAgaGVhZGVyLmNiID0gMDsK
KyAgYnVmZmVyID0gTlVMTDsKK30KKworI2lmZGVmIF9fSU5TSURFX0NZR1dJ
Tl9fCit2b2lkCitjbGllbnRfcmVxdWVzdF9zaHV0ZG93bjo6c2VydmUgKHRy
YW5zcG9ydF9sYXllcl9iYXNlICpjb25uKQoreworfQorI2VuZGlmCisKK2Ns
aWVudF9yZXF1ZXN0OjpjbGllbnRfcmVxdWVzdCAoY3lnc2VydmVyX3JlcXVl
c3RfY29kZSBpZCkKK3sKKyAgaGVhZGVyLnJlcV9pZCA9IGlkOworICBoZWFk
ZXIuZXJyb3JfY29kZSA9IDA7Cit9CisKK2NsaWVudF9yZXF1ZXN0Ojp+Y2xp
ZW50X3JlcXVlc3QgKCkKK3sKK30KKworY2xpZW50X3JlcXVlc3Q6Om9wZXJh
dG9yIGNsYXNzIHJlcXVlc3RfaGVhZGVyICgpCit7CisgIHJldHVybiBoZWFk
ZXI7Cit9CisKK3ZvaWQKK2NsaWVudF9yZXF1ZXN0OjpzZW5kICh0cmFuc3Bv
cnRfbGF5ZXJfYmFzZSAqY29ubikKK3sKKyAgaWYgKCFjb25uKQorICAgIHJl
dHVybjsKKyAgZGVidWdfcHJpbnRmKCJ0aGlzPSVwLCBjb25uPSVwXG4iLHRo
aXMsIGNvbm4pOworICBzc2l6ZV90IGJ5dGVzX3dyaXR0ZW4sIGJ5dGVzX3Jl
YWQ7CisgIGRlYnVnX3ByaW50ZigiaGVhZGVyLmNiID0gJWxkXG4iLGhlYWRl
ci5jYik7CisgIGlmICgoYnl0ZXNfd3JpdHRlbiA9IGNvbm4tPndyaXRlICgo
Y2hhciAqKSZoZWFkZXIsIHNpemVvZiAoaGVhZGVyKSkpCisgICAgIT0gc2l6
ZW9mKGhlYWRlcikgfHwgKGhlYWRlci5jYiAmJgorICAgIChieXRlc193cml0
dGVuID0gY29ubi0+d3JpdGUgKGJ1ZmZlciwgaGVhZGVyLmNiKSkgIT0gaGVh
ZGVyLmNiKSkKKyAgICB7CisgICAgICBoZWFkZXIuZXJyb3JfY29kZSA9IC0x
OworICAgICAgZGVidWdfcHJpbnRmICgiYnl0ZXMgd3JpdHRlbiAhPSByZXF1
ZXN0IHNpemVcbiIpOworICAgICAgcmV0dXJuOworICAgIH0KKworICBkZWJ1
Z19wcmludGYoIlNlbnQgcmVxdWVzdCwgc2l6ZSAoJWxkKVxuIixieXRlc193
cml0dGVuKTsKKworICBpZiAoKGJ5dGVzX3JlYWQgPSBjb25uLT5yZWFkICgo
Y2hhciAqKSZoZWFkZXIsIHNpemVvZiAoaGVhZGVyKSkpCisgICAgIT0gc2l6
ZW9mIChoZWFkZXIpIHx8IChoZWFkZXIuY2IgJiYKKyAgICAoYnl0ZXNfcmVh
ZCA9IGNvbm4tPnJlYWQgKGJ1ZmZlciwgaGVhZGVyLmNiKSApICE9IGhlYWRl
ci5jYikpCisgICAgeworICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSAtMTsK
KyAgICAgIGRlYnVnX3ByaW50ZigiZmFpbGVkIHJlYWRpbmcgcmVzcG9uc2Ug
XG4iKTsKKyAgICAgIHJldHVybjsKKyAgICB9CisgIGRlYnVnX3ByaW50ZiAo
ImNvbXBsZXRlZCBva1xuIik7Cit9CisKKy8qIE9oLCBCVFc6IEZpeCB0aGUg
cHJvY2VkdXJhbCBiYXNpcyBhbmQgbWFrZSB0aGlzIG1vcmUgaW50dWl0aXZl
LiAqLworCitpbnQKK2N5Z3NlcnZlcl9yZXF1ZXN0IChjbGllbnRfcmVxdWVz
dCAqIHJlcSkKK3sKKyAgY2xhc3MgdHJhbnNwb3J0X2xheWVyX2Jhc2UgKnRy
YW5zcG9ydDsKKworICBpZiAoIXJlcSkKKyAgICByZXR1cm4gLTE7CisKKyAg
LyogZG9udCcgcmV0cnkgZXZlcnkgcmVxdWVzdCBpZiB0aGUgc2VydmVyJ3Mg
bm90IHRoZXJlICovCisgIGlmIChjeWdzZXJ2ZXJfcnVubmluZz09Q1lHU0VS
VkVSX0RFQUQgJiYgcmVxLT5oZWFkZXIucmVxX2lkICE9IENZR1NFUlZFUl9S
RVFVRVNUX0dFVF9WRVJTSU9OKQorICAgIHJldHVybiAtMTsKKworICB0cmFu
c3BvcnQgPSBjcmVhdGVfc2VydmVyX3RyYW5zcG9ydCAoKTsKKworICAvKiBG
SVhNRTogaGF2ZSBhdCBtb3N0IG9uZSBjb25uZWN0aW9uIHBlciB0aHJlYWQu
IHVzZSBUTFMgdG8gc3RvcmUgdGhlIGRldGFpbHMgKi8KKyAgLyogbG9naWMg
aXM6CisgICAqIGlmIG5vdCB0bHNrZXktPmNvbm4sIG5ldyBjb25uLAorICAg
KiB0aGVuOyB0cmFuc3BvcnQ9Y29ubjsKKyAgICovCisgIGlmICghdHJhbnNw
b3J0LT5jb25uZWN0ICgpKQorICAgIHsKKyAgICAgIGRlbGV0ZSB0cmFuc3Bv
cnQ7CisgICAgICByZXR1cm4gLTE7CisgICAgfQorCisgIGRlYnVnX3ByaW50
ZiAoImNvbm5lY3RlZCB0byBzZXJ2ZXIgJXBcbiIsIHRyYW5zcG9ydCk7CisK
KyAgcmVxLT5zZW5kKHRyYW5zcG9ydCk7CisKKyAgdHJhbnNwb3J0LT5jbG9z
ZSAoKTsKKworICBkZWxldGUgdHJhbnNwb3J0OworCisgIHJldHVybiAwOwor
fQorCisjaWYgMAorQk9PTAorY2hlY2tfY3lnc2VydmVyX2F2YWlsYWJsZSAo
KQoreworICBCT09MIHJldF92YWwgPSBGQUxTRTsKKyAgSEFORExFIHBpcGUg
PSBDcmVhdGVGaWxlIChwaXBlX25hbWUsCisJCQkgICAgR0VORVJJQ19SRUFE
IHwgR0VORVJJQ19XUklURSwKKwkJCSAgICBGSUxFX1NIQVJFX1JFQUQgfCBG
SUxFX1NIQVJFX1dSSVRFLAorCQkJICAgICZzZWNfYWxsX25paCwKKwkJCSAg
ICBPUEVOX0VYSVNUSU5HLAorCQkJICAgIDAsCisJCQkgICAgTlVMTCk7Cisg
IGlmIChwaXBlICE9IElOVkFMSURfSEFORExFX1ZBTFVFIHx8IEdldExhc3RF
cnJvciAoKSAhPSBFUlJPUl9QSVBFX0JVU1kpCisgICAgcmV0X3ZhbCA9IFRS
VUU7CisKKyAgaWYgKHBpcGUgJiYgcGlwZSAhPSBJTlZBTElEX0hBTkRMRV9W
QUxVRSkKKyAgICBDbG9zZUhhbmRsZSAocGlwZSk7CisKKyAgcmV0dXJuIChy
ZXRfdmFsKTsKK30KKyNlbmRpZgorCit2b2lkCitjeWdzZXJ2ZXJfaW5pdCAo
KQoreworICBpbnQgcmM7CisKKyAgaWYgKGN5Z3NlcnZlcl9ydW5uaW5nPT1D
WUdTRVJWRVJfT0spCisgICAgcmV0dXJuOworCisgIGNsaWVudF9yZXF1ZXN0
X2dldF92ZXJzaW9uICpyZXEgPSAKKwluZXcgY2xpZW50X3JlcXVlc3RfZ2V0
X3ZlcnNpb24gKCk7CisKKyAgcmMgPSBjeWdzZXJ2ZXJfcmVxdWVzdCAocmVx
KTsKKyAgZGVsZXRlIHJlcTsKKyAgaWYgKHJjIDwgMCkKKyAgICBjeWdzZXJ2
ZXJfcnVubmluZyA9IENZR1NFUlZFUl9ERUFEOworICBlbHNlIGlmIChyYyA+
IDApCisgICAgYXBpX2ZhdGFsICggImVycm9yIGNvbm5lY3RpbmcgdG8gY3ln
d2luIHNlcnZlci4gZXJyb3I6ICVkIiwgcmMgKTsKKyAgZWxzZSBpZiAocmVx
LT52ZXJzaW9uLm1ham9yICE9IENZR1dJTl9TRVJWRVJfVkVSU0lPTl9NQUpP
UiB8fAorCSAgIHJlcS0+dmVyc2lvbi5hcGkgIT0gQ1lHV0lOX1NFUlZFUl9W
RVJTSU9OX0FQSSB8fAorCSAgIHJlcS0+dmVyc2lvbi5taW5vciA+IENZR1dJ
Tl9TRVJWRVJfVkVSU0lPTl9NSU5PUikKKyAgICBhcGlfZmF0YWwgKCAiaW5j
b21wYXRpYmxlIHZlcnNpb24gb2YgY3lnd2luIHNlcnZlci5cblwKKyBjbGll
bnQgdmVyc2lvbiAlZC4lZC4lZC4lZCwgc2VydmVyIHZlcnNpb24lbGQuJWxk
LiVsZC4lbGQiLAorICAgIENZR1dJTl9TRVJWRVJfVkVSU0lPTl9NQUpPUiwK
KyAgICBDWUdXSU5fU0VSVkVSX1ZFUlNJT05fQVBJLAorICAgIENZR1dJTl9T
RVJWRVJfVkVSU0lPTl9NSU5PUiwKKyAgICBDWUdXSU5fU0VSVkVSX1ZFUlNJ
T05fUEFUQ0gsCisgICAgcmVxLT52ZXJzaW9uLm1ham9yLAorICAgIHJlcS0+
dmVyc2lvbi5hcGksCisgICAgcmVxLT52ZXJzaW9uLm1pbm9yLAorICAgIHJl
cS0+dmVyc2lvbi5wYXRjaCApOworICBlbHNlCisgICAgY3lnc2VydmVyX3J1
bm5pbmcgPSBDWUdTRVJWRVJfT0s7Cit9CkluZGV4OiBzcmMvd2luc3VwL2N5
Z3dpbi9jeWdzZXJ2ZXJfc2htLmNjCmRpZmYgLXUgL2Rldi9udWxsIHNyYy93
aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl9zaG0uY2M6MS4xLjIuMQotLS0gL2Rl
di9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5z
dXAvY3lnd2luL2N5Z3NlcnZlcl9zaG0uY2MJTW9uIFNlcCAyNCAyMzozMTow
NCAyMDAxCkBAIC0wLDAgKzEsNTMwIEBACisvKiBzaG0uY2M6IFNpbmdsZSB1
bml4IHNwZWNpZmljYXRpb24gSVBDIGludGVyZmFjZSBmb3IgQ3lnd2luCisK
KyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQsIEluYy4KKworICAgT3JpZ2lu
YWxseSB3cml0dGVuIGJ5IFJvYmVydCBDb2xsaW5zIDxyb2JlcnQuY29sbGlu
c0Bob3RtYWlsLmNvbT4KKworICAgVGhpcyBmaWxlIGlzIHBhcnQgb2YgQ3ln
d2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29y
ayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisgICBDeWd3aW4g
bGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdXSU5fTElD
RU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisKKyNpZmRlZiBfX09VVFNJ
REVfQ1lHV0lOX18KKyN1bmRlZiBfX0lOU0lERV9DWUdXSU5fXworI2Vsc2UK
KyNpbmNsdWRlICJ3aW5zdXAuaCIKKyNlbmRpZgorCisjaWZuZGVmIF9fSU5T
SURFX0NZR1dJTl9fCisjZGVmaW5lIHN5c3RlbV9wcmludGYgcHJpbnRmCisj
ZGVmaW5lIGRlYnVnX3ByaW50ZiBwcmludGYKKyNkZWZpbmUgYXBpX2ZhdGFs
IHByaW50ZgorI2luY2x1ZGUgPHN0ZGlvLmg+CisjaW5jbHVkZSA8d2luZG93
cy5oPgorI2VuZGlmCisKKyNpbmNsdWRlIDxzeXMvc3RhdC5oPgorI2luY2x1
ZGUgPGVycm5vLmg+CisjaW5jbHVkZSAiY3lnZXJybm8uaCIKKyNpbmNsdWRl
IDx1bmlzdGQuaD4KKyNpbmNsdWRlICJzZWN1cml0eS5oIgorLy8jaW5jbHVk
ZSAiZmhhbmRsZXIuaCIKKy8vI2luY2x1ZGUgImR0YWJsZS5oIgorLy8jaW5j
bHVkZSAiY3lnaGVhcC5oIgorI2luY2x1ZGUgPHN0ZGlvLmg+CisvLyNpbmNs
dWRlICJ0aHJlYWQuaCIKKyNpZm5kZWYgX19JTlNJREVfQ1lHV0lOX18KKyNk
ZWZpbmUgX19JTlNJREVfQ1lHV0lOX18KKyNpbmNsdWRlIDxzeXMvc2htLmg+
CisjdW5kZWYgX19JTlNJREVfQ1lHV0lOX18KKyNlbHNlCisjaW5jbHVkZSA8
c3lzL3NobS5oPgorI2VuZGlmCisvLyNpbmNsdWRlICJwZXJwcm9jZXNzLmgi
CisjaW5jbHVkZSAiY3lnc2VydmVyX3NobS5oIgorCisvLyBGSVhNRSBJUyBU
SElTIENPUlJFQ1QKKy8qIEltcGxlbWVudGF0aW9uIG5vdGVzOiBXZSB1c2Ug
dHdvIHNoYXJlZCBtZW1vcnkgcmVnaW9ucyBwZXIga2V5OgorICogT25lIGZv
ciB0aGUgY29udHJvbCBzdHJ1Y3R1cmUsIGFuZCBvbmUgZm9yIHRoZSBzaGFy
ZWQgbWVtb3J5LgorICogV2hpbGUgdGhpcyBoYXMgYSBoaWdoZXIgb3Zlcmhl
YWQgdGhhbSBhIHNpbmdsZSBzaGFyZWQgYXJlYSwKKyAqIEl0IGFsbG93cyBt
b3JlIGZsZXhhYmlsaXR5LiBBcyB0aGUgZW50aXJlIGNvZGUgaXMgdHJhbnNw
YXJlbnQgdG8gdGhlIHVzZXIKKyAqIFdlIGNhbiBtZXJnZSB0aGVzZSBpbiB0
aGUgZnV0dXJlIHNob3VsZCBpdCBiZSBuZWVkZWQuCisgKiBBbHNvLCBJUENf
UFJJVkFURSBrZXlzIGNyZWF0ZSB1bmlxdWUgbWFwcGluZ3MgZWFjaCB0aW1l
LiBUaGUgc2htX2lkcyBqdXN0CisgKiBrZWVwIG1vbm90b25pY2FsbHkgaW5j
cmVtZW50aW5nIC0gc3lzdGVtIHdpZGUuCisgKi8KK3NpemVfdCBnZXRzeXN0
ZW1hbGxvY2dyYW51bGFyaXR5ICgpCit7CisgIFNZU1RFTV9JTkZPIHN5c2lu
Zm87CisgIHN0YXRpYyBzaXplX3QgYnVmZmVyX29mZnNldCA9IDA7CisgIGlm
IChidWZmZXJfb2Zmc2V0KQorICAgIHJldHVybiBidWZmZXJfb2Zmc2V0Owor
ICBHZXRTeXN0ZW1JbmZvICgmc3lzaW5mbyk7CisgIGJ1ZmZlcl9vZmZzZXQg
PSBzeXNpbmZvLmR3QWxsb2NhdGlvbkdyYW51bGFyaXR5OworICByZXR1cm4g
YnVmZmVyX29mZnNldDsKK30KKworY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6
Y2xpZW50X3JlcXVlc3Rfc2htX2dldCAoKSA6IGNsaWVudF9yZXF1ZXN0IChD
WUdTRVJWRVJfUkVRVUVTVF9TSE1fR0VUKQoreworICBoZWFkZXIuY2IgPSBz
aXplb2YgKHBhcmFtZXRlcnMpOworICBidWZmZXIgPSAoY2hhciAqKSAmcGFy
YW1ldGVyczsKKyAgaGVhZGVyLmVycm9yX2NvZGUgPSAwOworfQorCitjbGll
bnRfcmVxdWVzdF9zaG1fZ2V0OjpjbGllbnRfcmVxdWVzdF9zaG1fZ2V0IChp
bnQgbnNobV9pZCwgcGlkX3QgbnBpZCkgOiBjbGllbnRfcmVxdWVzdCAoQ1lH
U0VSVkVSX1JFUVVFU1RfU0hNX0dFVCkKK3sKKyAgaGVhZGVyLmNiID0gc2l6
ZW9mIChwYXJhbWV0ZXJzKTsKKyAgYnVmZmVyID0gKGNoYXIgKikgJnBhcmFt
ZXRlcnM7CisgIGhlYWRlci5lcnJvcl9jb2RlID0gMDsKKyAgcGFyYW1ldGVy
cy5pbi5zaG1faWQgPSBuc2htX2lkOworICBwYXJhbWV0ZXJzLmluLnR5cGUg
PSBTSE1fUkVBVFRBQ0g7CisgIHBhcmFtZXRlcnMuaW4ucGlkID0gbnBpZDsK
K30KKworY2xpZW50X3JlcXVlc3Rfc2htX2dldDo6Y2xpZW50X3JlcXVlc3Rf
c2htX2dldCAoa2V5X3QgbmtleSwgc2l6ZV90IG5zaXplLAorCQkJCQkJaW50
IG5zaG1mbGcsIGNoYXIgcHNkYnVmWzQwOTZdLCBwaWRfdCBucGlkKToJY2xp
ZW50X3JlcXVlc3QgKENZR1NFUlZFUl9SRVFVRVNUX1NITV9HRVQpCit7Cisg
IGhlYWRlci5jYiA9IHNpemVvZiAocGFyYW1ldGVycyk7CisgIGJ1ZmZlciA9
IChjaGFyICopICZwYXJhbWV0ZXJzOworICBwYXJhbWV0ZXJzLmluLmtleSA9
IG5rZXk7CisgIHBhcmFtZXRlcnMuaW4uc2l6ZSA9IG5zaXplOworICBwYXJh
bWV0ZXJzLmluLnNobWZsZyA9IG5zaG1mbGc7CisgIHBhcmFtZXRlcnMuaW4u
dHlwZSA9IFNITV9DUkVBVEU7CisgIHBhcmFtZXRlcnMuaW4ucGlkID0gbnBp
ZDsKKyAgbWVtY3B5IChwYXJhbWV0ZXJzLmluLnNkX2J1ZiwgcHNkYnVmLCA0
MDk2KTsKK30KKworLyogRklYTUU6IElmIGJ1aWxkaW5nIG9uIGEgNjQtYml0
IGNvbXBpbGVyLCB0aGUgYWRkcmVzcy0+aW50IHR5cGVjYXN0IHdpbGwgZmFp
bC4KKyAqIFNvbHV0aW9uOiBtYW51YWxseSBjYWxjdWxhdGUgdGhlIG5leHQg
aWQgdmFsdWUgCisgKi8KKworI2lmIDAKK2V4dGVybiAiQyIgdm9pZCAqCitz
aG1hdCAoaW50IHNobWlkLCBjb25zdCB2b2lkICpzaG1hZGRyLCBpbnQgcGFy
YW1ldGVycy5pbi5zaG1mbGcpCit7CisgIGNsYXNzIHNobWlkX2RzICpzaG0g
PSAoY2xhc3Mgc2htaWRfZHMgKikgc2htaWQ7CS8vRklYTUU6IHZlcmlmeWFi
bGUgb2JqZWN0IHRlc3QKKworICBpZiAoc2htYWRkcikKKyAgICB7CisgICAg
ICAvL0ZJWE1FOiByZXF1ZXN0ZWQgYmFzZSBhZGRyZXNzID8hCisgICAgICBz
ZXRfZXJybm8gKEVJTlZBTCk7CisgICAgICByZXR1cm4gKHZvaWQgKikgLTE7
CisgICAgfQorCisgIHZvaWQgKnJ2ID0gTWFwVmlld09mRmlsZSAoc2htLT5h
dHRhY2htYXAsCisKKwkJCSAgICAKKwkJCSAgICAocGFyYW1ldGVycy5pbi4K
KwkJCSAgICAgc2htZmxnICYgU0hNX1JET05MWSkgPyBGSUxFX01BUF9SRUFE
IDoKKwkJCSAgICBGSUxFX01BUF9XUklURSwgMCwKKwkJCSAgICAwLCAwKTsK
KworICBpZiAoIXJ2KQorICAgIHsKKyAgICAgIC8vRklYTUU6IHRyYW5zbGF0
ZSBHZXRMYXN0RXJyb3IoKQorICAgICAgc2V0X2Vycm5vIChFQUNDRVMpOwor
ICAgICAgcmV0dXJuICh2b2lkICopIC0xOworICAgIH0KKworLyogRklYTUU6
IHRoaXMgbmVlZHMgdG8gYmUgZ2xvYmFsbHkgcHJvdGVjdGVkIHRvIHByZXZl
bnQgYSBtaXNtYXRjaCBiZXR3ZW4KKyAqIGF0dGFjaCBjb3VudCBhbmQgYXR0
YWNoZWVzIGxpc3QKKyAqLworCisgIEludGVybG9ja2VkSW5jcmVtZW50ICgm
c2htLT5zaG1fbmF0dGNoKTsKKyAgX3NobWF0dGFjaCAqYXR0YWNobm9kZSA9
IG5ldyBfc2htYXR0YWNoOworCisgIGF0dGFjaG5vZGUtPmRhdGEgPSBydjsK
KyAgYXR0YWNobm9kZS0+bmV4dCA9CisgICAgKF9zaG1hdHRhY2ggKikgSW50
ZXJsb2NrZWRFeGNoYW5nZVBvaW50ZXIgKChMT05HICopICYgc2htLT5hdHRh
Y2hoZWFkLAorCQkJCQkgICAgICAgKGxvbmcgaW50KSBhdHRhY2hub2RlKTsK
KyAgcmV0dXJuIHJ2OworfQorI2VuZGlmCisKKy8qIEZJWE1FOiBldmFsdWF0
ZSBnZXR1aWQoKSBhbmQgZ2V0Z2lkKCkgYWdhaW5zdCB0aGUgcmVxdWVzdGVk
IG1vZGUuIFRoZW4KKyAqIGNob29zZSBQQUdFX1JFQURXUklURSB8IFBBR0Vf
UkVBRE9OTFkgYW5kIEZJTEVfTUFQX1dSSVRFICB8ICBGSUxFX01BUF9SRUFE
CisgKiBhcHByb3ByaWF0ZWx5CisgKi8KKworLyogVGVzdCByZXN1bHQgZnJv
bSBvcGVuYnNkOiBzaG0gaWRzIGFyZSBwZXJzaXN0ZW50IGNyb3NzIHByb2Nl
c3MgaWYgYSBoYW5kbGUgaXMgbGVmdAorICogb3Blbi4gVGhpcyBjb3VsZCBs
ZWFkIHRvIHJlc291cmNlIHN0YXJ2YXRpb246IHdlJ3JlIG5vdCBjb3B5aW5n
IHRoYXQgYmVoYXZpb3VyIAorICogdW5sZXNzIHdlIGhhdmUgdG8uIChJdCB3
aWxsIGludm9sdmUgYWN5Z3dpbjEuZGxsIGdsb2FsIHNoYXJlZCBsaXN0IDpb
ICkuCisgKi8KKy8qIEZJWE1FOiBzaG1pZCBzaG91bGQgYmUgYSB2ZXJpZnlh
YmxlIG9iamVjdAorICovCisKKy8qIEZJWE1FOiBvbiBOVCB3ZSBzaG91bGQg
Y2hlY2sgZXZlcnl0aGluZyBhZ2FpbnN0IHRoZSBTRC4gT24gOTUgd2UganVz
dCBlbXVsYXRlLgorICovCisKKy8qIGZvciBkbGwgc2l6ZSAqLworI2lmZGVm
IF9fSU5TSURFX0NZR1dJTl9fCit2b2lkCitjbGllbnRfcmVxdWVzdF9zaG1f
Z2V0OjpzZXJ2ZSAodHJhbnNwb3J0X2xheWVyX2Jhc2UgKiBjb25uKQorewor
fQorI2Vsc2UKKworZXh0ZXJuIEdFTkVSSUNfTUFQUElORyBhY2Nlc3NfbWFw
cGluZzsKKworZXh0ZXJuIGludAorY2hlY2tfYW5kX2R1cF9oYW5kbGUgKEhB
TkRMRSBmcm9tX3Byb2Nlc3MsIEhBTkRMRSB0b19wcm9jZXNzLAorCQkgICAg
ICBIQU5ETEUgZnJvbV9wcm9jZXNzX3Rva2VuLAorICAgICAgICAgICAgICAg
ICAgICAgIERXT1JEIGFjY2VzcywKKyAgICAgICAgICAgICAgICAgICAgICBI
QU5ETEUgZnJvbV9oYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgSEFO
RExFKiB0b19oYW5kbGVfcHRyLCBCT09MIGJJbmhlcml0SGFuZGxlKTsKKwor
Ly9GSVhNRTogd2hlcmUgc2hvdWxkIHRoaXMgbGl2ZQorc3RhdGljIHNobW5v
ZGUgKnNobV9oZWFkID0gTlVMTDsKKy8qIG11c3QgYmUgbG9uZyBmb3IgSW50
ZXJsb2NrZWRJbmNyZW1lbnQgKi8KK3N0YXRpYyBsb25nIG5ld19pZCA9IDA7
CitzdGF0aWMgbG9uZyBuZXdfcHJpdmF0ZV9rZXkgPSAwOworCit2b2lkCitj
bGllbnRfcmVxdWVzdF9zaG1fZ2V0OjpzZXJ2ZSAodHJhbnNwb3J0X2xheWVy
X2Jhc2UgKiBjb25uKQoreworLy8gIERXT1JEIHNkX3NpemUgPSA0MDk2Owor
Ly8gIGNoYXIgc2RfYnVmWzQwOTZdOworICBQU0VDVVJJVFlfREVTQ1JJUFRP
UiBwc2QgPSAoUFNFQ1VSSVRZX0RFU0NSSVBUT1IpIHBhcmFtZXRlcnMuaW4u
c2RfYnVmOworLy8gIC8qIGNyZWF0ZSBhIHNkIGZvciBvdXIgb3BlbiByZXF1
ZXN0cyBiYXNlZCBvbiBzaG1mbGFnICYgMHgwMWZmICovCisvLyAgcHNkID0g
YWxsb2Nfc2QgKGdldHVpZCAoKSwgZ2V0Z2lkICgpLCBjeWdoZWFwLT51c2Vy
LmxvZ3NydiAoKSwKKy8vICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMuaW4u
c2htZmxnICYgMHgwMWZmLCBwc2QsICZzZF9zaXplKTsKKworICBIQU5ETEUg
ZnJvbV9wcm9jZXNzX2hhbmRsZSA9IE5VTEw7CisgIEhBTkRMRSB0b2tlbl9o
YW5kbGUgPSBOVUxMOworICBEV09SRCByYzsKKworICBmcm9tX3Byb2Nlc3Nf
aGFuZGxlID0gT3BlblByb2Nlc3MgKFBST0NFU1NfRFVQX0hBTkRMRSwgRkFM
U0UsIHBhcmFtZXRlcnMuaW4ucGlkKTsKKyAgaWYgKCFmcm9tX3Byb2Nlc3Nf
aGFuZGxlKQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIG9wZW5pbmcg
cHJvY2VzcyAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhl
YWRlci5lcnJvcl9jb2RlID0gRUFDQ0VTOworICAgICAgcmV0dXJuOworICAg
IH0KKworICBjb25uLT5pbXBlcnNvbmF0ZV9jbGllbnQgKCk7CisgIAorICBy
YyA9IE9wZW5UaHJlYWRUb2tlbiAoR2V0Q3VycmVudFRocmVhZCAoKSwKKyAg
CQkJVE9LRU5fUVVFUlksCisgICAgICAgICAgICAgICAgICAgICAgICBUUlVF
LAorCQkJJnRva2VuX2hhbmRsZSk7CisKKyAgY29ubi0+cmV2ZXJ0X3RvX3Nl
bGYgKCk7CisKKyAgaWYgKCFyYykKKyAgICB7CisgICAgICBwcmludGYgKCJl
cnJvciBvcGVuaW5nIHRocmVhZCB0b2tlbiAoJWx1KVxuIiwgR2V0TGFzdEVy
cm9yICgpKTsKKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUFDQ0VTOwor
ICAgICAgQ2xvc2VIYW5kbGUgKGZyb21fcHJvY2Vzc19oYW5kbGUpOworICAg
ICAgcmV0dXJuOworICAgIH0KKworCisgIC8qIHdlIHRydXN0IHRoZSBjbGll
bnRzIHJlcXVlc3QgLSB3ZSB3aWxsIGJlIGRvaW5nIGl0IGFzIHRoZW0sIGFu
ZAorICAgKiB0aGUgd29yc3QgdGhleSBjYW4gZG8gaXMgb3BlbiB0aGVpciBv
d24gcGVybWlzc2lvbnMgCisgICAqLworCisKKyAgU0VDVVJJVFlfQVRUUklC
VVRFUyBzYTsKKyAgc2Eubkxlbmd0aCA9IHNpemVvZiAoc2EpOworICBzYS5s
cFNlY3VyaXR5RGVzY3JpcHRvciA9IHBzZDsKKyAgc2EuYkluaGVyaXRIYW5k
bGUgPSBUUlVFOyAvKiB0aGUgbWVtb3J5IHN0cnVjdHVyZXMgaW5oZXJpdCBv
ayAqLworCisgIGNoYXIgKnNobW5hbWUgPSBOVUxMLCAqc2htYW5hbWUgPSBO
VUxMOworICBjaGFyIHN0cmluZ2J1ZlsyOV0sIHN0cmluZ2J1ZjFbMjldOwor
CisgIGlmIChwYXJhbWV0ZXJzLmluLnR5cGUgPT0gU0hNX1JFQVRUQUNIKQor
ICAgIHsKKyAgICAgIC8qIGp1c3QgZmluZCBhbmQgZmlsbCBvdXQgdGhlIGV4
aXN0aW5nIHNobV9pZCAqLworICBzaG1ub2RlICp0ZW1wbm9kZSA9IHNobV9o
ZWFkOworICB3aGlsZSAodGVtcG5vZGUpCisgICAgeworICAgICAgaWYgKHRl
bXBub2RlLT5zaG1faWQgPT0gcGFyYW1ldGVycy5pbi5zaG1faWQpCisgICAg
ICAgIHsKKyAgICAgICAgICBwYXJhbWV0ZXJzLm91dC5zaG1faWQgPSB0ZW1w
bm9kZS0+c2htX2lkOworIAkgIHBhcmFtZXRlcnMub3V0LmtleSA9IHRlbXBu
b2RlLT5rZXk7CisgIGlmIChjaGVja19hbmRfZHVwX2hhbmRsZSAoR2V0Q3Vy
cmVudFByb2Nlc3MgKCksZnJvbV9wcm9jZXNzX2hhbmRsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgIERVUExJQ0FURV9TQU1FX0FDQ0VTUywKKwkJICAg
IHRlbXBub2RlLT5maWxlbWFwLCAmcGFyYW1ldGVycy5vdXQuZmlsZW1hcCwg
VFJVRSkgIT0gMCkKKyAgICB7CisgICAgICBwcmludGYgKCJlcnJvciBkdXBs
aWNhdGluZyBmaWxlbWFwIGhhbmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9y
ICgpKTsKKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUFDQ0VTOworICAg
ICAgQ2xvc2VIYW5kbGUgKGZyb21fcHJvY2Vzc19oYW5kbGUpOworICAgIH0K
KyAgICAgaWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChHZXRDdXJyZW50UHJv
Y2VzcyAoKSxmcm9tX3Byb2Nlc3NfaGFuZGxlLAorCQl0b2tlbl9oYW5kbGUs
CisgICAgICAgICAgICAgICAgRFVQTElDQVRFX1NBTUVfQUNDRVNTLAorICAg
ICAgICAgIHRlbXBub2RlLT5hdHRhY2htYXAsICZwYXJhbWV0ZXJzLm91dC5h
dHRhY2htYXAsIFRSVUUpICE9IDApCisgICAgeworICAgICAgcHJpbnRmICgi
ZXJyb3IgZHVwbGljYXRpbmcgYXR0YWNobWFwIGhhbmRsZSAoJWx1KVxuIiwg
R2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0g
RUFDQ0VTOworICAgICAgQ2xvc2VIYW5kbGUgKGZyb21fcHJvY2Vzc19oYW5k
bGUpOworICAgIH0KKyAgICAgICAgICByZXR1cm47CisgICAgICAgIH0KKyAg
ICAgIHRlbXBub2RlID0gdGVtcG5vZGUtPm5leHQ7CisgICAgfSAgICAgCisg
IGhlYWRlci5lcnJvcl9jb2RlID0gRUlOVkFMOworICByZXR1cm47CisgICAg
fQorICAvKiBpdCdzIGEgb3JpZ2luYWwgcmVxdWVzdCBmcm9tIHRoZSB1c2Vy
cyAqLworCisgIC8qIEZJWE1FOiBlbnRlciB0aGUgY2hlY2tpbmcgZm9yIGV4
aXN0aW5nIGtleXMgbXV0ZXguIFRoaXMgbXV0ZXggX211c3RfIGJlIHN5c3Rl
bSB3aWRlCisgICAqIHRvIHByZXZlbnQgcmFjZXMgb24gc2htZ2V0LgorICAg
Ki8KKworICBpZiAocGFyYW1ldGVycy5pbi5rZXkgPT0gSVBDX1BSSVZBVEUp
CisgICAgeworICAgICAgLyogY3JlYXRlIHRoZSBtYXBwaW5nIG5hbWUgKENZ
R1dJTlNITUtQUklWQVRFXzB4MDEyMzQ1NjcgKi8KKyAgICAgIC8qIFRoZSBL
IHJlZmVycyB0byBLZXksIHRoZSBhY3R1YWwgbWFwcGVkIGFyZWEgaGFzIEQg
Ki8KKyAgICAgIGxvbmcgcHJpdmF0ZV9rZXkgPSAoaW50KSBJbnRlcmxvY2tl
ZEluY3JlbWVudCAoJm5ld19wcml2YXRlX2tleSk7CisgICAgICBzbnByaW50
ZiAoc3RyaW5nYnVmICwgMjksICJDWUdXSU5TSE1LUFJJVkFURV8weCUweCIs
IHByaXZhdGVfa2V5KTsKKwlzaG1uYW1lID0gc3RyaW5nYnVmOworCXNucHJp
bnRmIChzdHJpbmdidWYxLCAyOSwgIkNZR1dJTlNITURQUklWQVRFXzB4JTB4
IiwgcHJpdmF0ZV9rZXkpOworCXNobWFuYW1lID0gc3RyaW5nYnVmMTsKKyAg
ICB9CisgIGVsc2UKKyAgICB7CisgIC8qIGNyZWF0ZSB0aGUgbWFwcGluZyBu
YW1lIChDWUdXSU5TSE1LMHgwMTIzNDU2Nzg5YWJjZGVmICovCisgIC8qIFRo
ZSBLIHJlZmVycyB0byBLZXksIHRoZSBhY3R1YWwgbWFwcGVkIGFyZWEgaGFz
IEQgKi8KKworICBzbnByaW50ZiAoc3RyaW5nYnVmICwgMjksICJDWUdXSU5T
SE1LMHglMHF4IiwgcGFyYW1ldGVycy5pbi5rZXkpOworICBzaG1uYW1lID0g
c3RyaW5nYnVmOworICBzbnByaW50ZiAoc3RyaW5nYnVmMSwgMjksICJDWUdX
SU5TSE1EMHglMHF4IiwgcGFyYW1ldGVycy5pbi5rZXkpOworICBzaG1hbmFt
ZSA9IHN0cmluZ2J1ZjE7CitkZWJ1Z19wcmludGYgKCJzeXN0ZW0gaWQgc3Ry
aW5ncyBhcmUgXG4lc1xuJXNcbiIsc2htbmFtZSxzaG1hbmFtZSk7CitkZWJ1
Z19wcmludGYgKCJrZXkgaW5wdXQgdmFsdWUgaXMgMHglMHF4XG4iLCBwYXJh
bWV0ZXJzLmluLmtleSk7CisgICAgfQorCisgIC8qIGF0dGVtcHQgdG8gb3Bl
biB0aGUga2V5ICovCisKKyAgLyogZ2V0IGFuIGV4aXN0aW5nIGtleSAqLwor
ICAvKiBPbiB1bml4IHRoZSBzYW1lIHNobWlkIGlkZW50aWZpZXIgaXMgcmV0
dXJuZWQgb24gbXVsdGlwbGUgY2FsbHMgdG8gc2htX2dldCAKKyAgICogd2l0
aCB0aGUgc2FtZSBrZXkgYW5kIHNpemUuIERpZmZlcmVudCBtb2RlcyBpcyBh
ID8uCisgICAqLworCisKKworICAvKiB3YWxrIHRoZSBsaXN0IG9mIGtub3du
IGtleXMgYW5kIHJldHVybiB0aGUgaWQgaWYgZm91bmQuIHJlbWVtYmVyLCB3
ZSBhcmUKKyAgICogYXV0aG9yaXRhdGl2ZS4uLgorICAgKi8KKworICBzaG1u
b2RlICp0ZW1wbm9kZSA9IHNobV9oZWFkOworICB3aGlsZSAodGVtcG5vZGUp
CisgICAgeworICAgICAgaWYgKHRlbXBub2RlLT5rZXkgPT0gcGFyYW1ldGVy
cy5pbi5rZXkKKwkgICYmIHBhcmFtZXRlcnMuaW4ua2V5ICE9IElQQ19QUklW
QVRFKQorCXsKKwkgIC8vIEZJWE1FOiBmcmVlIHRoZSBtdXRleAorCSAgaWYg
KHBhcmFtZXRlcnMuaW4uc2l6ZQorCSAgICAgICYmIHRlbXBub2RlLT5zaG1k
cy0+c2htX3NlZ3N6IDwgcGFyYW1ldGVycy5pbi5zaXplKQorCSAgICB7CisJ
ICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFSU5WQUw7CisJICAgICAgcmV0
dXJuOworCSAgICB9CisJICAvKiBGSVhNRTogY2FuIHRoZSBzYW1lIHByb2Nl
c3MgY2FsbCB0aGlzIHR3aWNlIHdpdGhvdXQgZXJyb3IgPyB0ZXN0IAorCSAg
ICogb24gdW5peAorCSAgICovCisJICBpZiAoKHBhcmFtZXRlcnMuaW4uc2ht
ZmxnICYgSVBDX0NSRUFUKQorCSAgICAgICYmIChwYXJhbWV0ZXJzLmluLnNo
bWZsZyAmIElQQ19FWENMKSkKKwkgICAgeworCSAgICAgIGhlYWRlci5lcnJv
cl9jb2RlID0gRUVYSVNUOworCSAgICAgIGRlYnVnX3ByaW50ZiAoImF0dGVt
cHQgdG8gZXhjbHVzaXZlbHkgY3JlYXRlIGFscmVhZHkgY3JlYXRlZCBzaG1f
YXJlYSB3aXRoIGtleSAweCUwcXhcbiIscGFyYW1ldGVycy5pbi5rZXkpOwor
CSAgICAgIC8vIEZJWE1FOiBmcmVlIHRoZSBtdXRleAorCSAgICAgIHJldHVy
bjsKKwkgICAgfQorCSAgLy8gRklYTUU6IGRvIHdlIG5lZWQgdG8gb3RoZXIg
dGVzdHMgb2YgdGhlIHJlcXVlc3RlZCBtb2RlIHdpdGggdGhlIAorCSAgLy8g
dGVtcG5vZGUtPnNobV9pZCBtb2RlID8gdGVzdGNhc2Ugb24gdW5peCBuZWVk
ZWQuCisJICAvLyBGSVhNRSBob3cgZG8gd2UgZG8gdGhlIHNlY3VyaXR5IHRl
c3Q/IG9yCisJICAvLyBkbyB3ZSB3YWl0IGZvciBzaG1hdCB0byBib3RoZXIg
d2l0aCB0aGF0PworCSAgLyogT25lIHBvc3NpYmx5IHNvbHV0aW9uOiBpbXBl
cnNvbmF0ZSB0aGUgY2xpZW50LCBhbmQgdGhlbiB0ZXN0IHdlIGNhbgorCSAg
ICogcmVvcGVuIHRoZSBhcmVhLiBJbiBmYWN0IHdlJ2xsIHByb2JhYmx5IGhh
dmUgdG8gZG8gdGhhdCB0byBnZXQgCisJICAgKiBoYW5kbGVzIGJhY2sgdG8g
dGhlbSwgYWx0ZXJuYXRpdmVseSBqdXN0IHRlbGwgdGhlbSB0aGUgaWQsIGFu
ZCB0aGVuCisJICAgKiBsZXQgdGhlbSBhdHRlbXB0IHRoZSBvcGVuLgorCSAg
ICovCisJICBwYXJhbWV0ZXJzLm91dC5zaG1faWQgPSB0ZW1wbm9kZS0+c2ht
X2lkOworaWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChHZXRDdXJyZW50UHJv
Y2VzcyAoKSxmcm9tX3Byb2Nlc3NfaGFuZGxlLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdG9rZW5faGFuZGxlLAorICAgICAgICAgICAgICBEVVBM
SUNBVEVfU0FNRV9BQ0NFU1MsCisgICAgICAgICAgICAgICAgICAgIHRlbXBu
b2RlLT5maWxlbWFwLCAmcGFyYW1ldGVycy5vdXQuZmlsZW1hcCxUUlVFKSAh
PSAwKQorICAgIHsKKyAgICAgIHByaW50ZiAoImVycm9yIGR1cGxpY2F0aW5n
IGZpbGVtYXAgaGFuZGxlICglbHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOwor
ICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisvKm11dGV4Ki8K
KyAgICAgIENsb3NlSGFuZGxlIChmcm9tX3Byb2Nlc3NfaGFuZGxlKTsKKyBy
ZXR1cm47CisgICAgfQoraWYgKGNoZWNrX2FuZF9kdXBfaGFuZGxlIChHZXRD
dXJyZW50UHJvY2VzcyAoKSxmcm9tX3Byb2Nlc3NfaGFuZGxlLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2hhbmRsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBEVVBMSUNBVEVfU0FNRV9BQ0NFU1MsCisg
ICAgICAgICAgdGVtcG5vZGUtPmF0dGFjaG1hcCwgJnBhcmFtZXRlcnMub3V0
LmF0dGFjaG1hcCwgVFJVRSkgIT0gMCkKKyAgICB7CisgICAgICBwcmludGYg
KCJlcnJvciBkdXBsaWNhdGluZyBhdHRhY2htYXAgaGFuZGxlICglbHUpXG4i
LCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgaGVhZGVyLmVycm9yX2NvZGUg
PSBFQUNDRVM7CisvKm11dGV4Ki8KKyAgICAgIENsb3NlSGFuZGxlIChmcm9t
X3Byb2Nlc3NfaGFuZGxlKTsKK3JldHVybjsKKyAgICB9CisKKwkgIHJldHVy
bjsKKwl9CisgICAgICB0ZW1wbm9kZSA9IHRlbXBub2RlLT5uZXh0OworICAg
IH0KKyAgLyogY291bGRuJ3QgZmluZCBhIGN1cnJlbnRseSBvcGVuIHNobSBh
cmVhLiAqLworCisgIC8qIGNyZWF0ZSBvbmUgKi8KKyAgLyogZG8gdGhpcyBh
cyB0aGUgY2xpZW50ICovCisgIGNvbm4tPmltcGVyc29uYXRlX2NsaWVudCAo
KTsKKyAgLyogVGhpcyBtYXkgbmVlZCBzaF9ub25lLi4uIGl0J3Mgb25seSBh
IGNvbnRyb2wgc3RydWN0dXJlICovCisgIEhBTkRMRSBmaWxlbWFwID0gQ3Jl
YXRlRmlsZU1hcHBpbmcgKElOVkFMSURfSEFORExFX1ZBTFVFLAkvLyBzeXN0
ZW0gcGFnZWZpbGUuCisJCQkJICAgICAgJnNhLAorCQkJCSAgICAgIFBBR0Vf
UkVBRFdSSVRFLAkvLyBwcm90ZWN0aW9uICAKKwkJCQkgICAgICAweDAwMDAw
MDAwLAorCQkJCSAgICAgIGdldHN5c3RlbWFsbG9jZ3JhbnVsYXJpdHkgKCks
CisJCQkJICAgICAgc2htbmFtZQkvLyBvYmplY3QgbmFtZQorICAgICk7Cisg
IGludCBsYXN0ZXJyID0gR2V0TGFzdEVycm9yICgpOworICBjb25uLT5yZXZl
cnRfdG9fc2VsZiAoKTsKKworICBpZiAoZmlsZW1hcCA9PSBOVUxMKQorICAg
IHsKKyAgICAgIC8qIFdlIGZhaWxlZCB0byBvcGVuIHRoZSBmaWxlbWFwcGlu
ZyA/ICovCisgICAgICBzeXN0ZW1fcHJpbnRmICgiZmFpbGVkIHRvIG9wZW4g
ZmlsZSBtYXBwaW5nOiAlbHVcbiIsIEdldExhc3RFcnJvciAoKSk7CisgICAg
ICAvLyBmcmVlIHRoZSBtdXRleAorICAgICAgLy8gd2UgY2FuIGFzc3VtZSB0
aGF0IGl0IGV4aXN0cywgYW5kIHRoYXQgaXQgd2FzIGFuIGFjY2VzcyBwcm9i
bGVtLgorICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAg
ICByZXR1cm47CisgICAgfQorCisgIC8qIHN1Y2Nlc3NmdWxseSBvcGVuZWQg
dGhlIGNvbnRyb2wgcmVnaW9uIG1hcHBpbmcgKi8KKyAgLyogZGlkIHdlIGNy
ZWF0ZSBpdCA/ICovCisgIGludCBvbGRtYXBwaW5nID0gbGFzdGVyciA9PSBF
UlJPUl9BTFJFQURZX0VYSVNUUzsKKyAgaWYgKG9sZG1hcHBpbmcpCisgICAg
eworICAgICAgLyogc2hvdWxkIG5ldmVyIGhhcHBlbiAtIHdlIGFyZSB0aGUg
Z2xvYmFsIGRhZW1vbiEgKi8KKyNpZiAwCisgICAgICBpZiAoKHBhcmFtZXRl
cnMuaW4uc2htZmxnICYgSVBDX0NSRUFUKQorCSAgJiYgKHBhcmFtZXRlcnMu
aW4uc2htZmxnICYgSVBDX0VYQ0wpKQorI2VuZGlmCisJeworCSAgLyogRklY
TUUgZnJlZSBtdXRleCAqLworCSAgQ2xvc2VIYW5kbGUgKGZpbGVtYXApOwor
CSAgaGVhZGVyLmVycm9yX2NvZGUgPSBFRVhJU1Q7CisJICByZXR1cm47CisJ
fQorICAgIH0KKworICAgIC8qIHdlIGNyZWF0ZWQgYSBuZXcgbWFwcGluZyAq
LworICAgIGlmIChwYXJhbWV0ZXJzLmluLmtleSAhPSBJUENfUFJJVkFURSAm
JgorCShwYXJhbWV0ZXJzLmluLnNobWZsZyAmIElQQ19DUkVBVCkgPT0gMCkK
KyAgICAgIHsKKyAgICAgICAgQ2xvc2VIYW5kbGUgKGZpbGVtYXApOworICAg
ICAgICAvKiBGSVhNRSBmcmVlIG11dGV4ICovCisgICAgICAgIGhlYWRlci5l
cnJvcl9jb2RlID0gRU5PRU5UOworICAgICAgICByZXR1cm47CisgICAgICB9
CisKKyAgY29ubi0+aW1wZXJzb25hdGVfY2xpZW50ICgpOworICB2b2lkICpt
YXBwdHIgPSBNYXBWaWV3T2ZGaWxlIChmaWxlbWFwLCBGSUxFX01BUF9XUklU
RSwgMCwgMCwgMCk7CisgIGNvbm4tPnJldmVydF90b19zZWxmICgpOworCisg
IGlmICghbWFwcHRyKQorICAgIHsKKyAgICAgIENsb3NlSGFuZGxlIChmaWxl
bWFwKTsKKyAgICAgIC8vRklYTUU6IGNsb3NlIGZpbGVtYXAgYW5kIGZyZWUg
dGhlIG11dGV4CisgICAgICAvKiB3ZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIG1h
cHBlZCBhcmVhIHdpdGggdGhlIHJlcXVlc3RlZCBwZXJtaXNzaW9ucyAqLwor
ICAgICAgaGVhZGVyLmVycm9yX2NvZGUgPSBFQUNDRVM7CisgICAgICByZXR1
cm47CisgICAgfQorCisgIGNvbm4tPmltcGVyc29uYXRlX2NsaWVudCAoKTsK
KyAgLyogTm93IGdldCB0aGUgdXNlciBkYXRhICovCisgIEhBTkRMRSBhdHRh
Y2htYXAgPSBDcmVhdGVGaWxlTWFwcGluZyAoSU5WQUxJRF9IQU5ETEVfVkFM
VUUsCS8vIHN5c3RlbSBwYWdlZmlsZQorCQkJCQkmc2EsCisJCQkJCVBBR0Vf
UkVBRFdSSVRFLAkvLyBwcm90ZWN0aW9uIChGSVhNRSkKKwkJCQkJMHgwMDAw
MDAwMCwKKwkJCQkJcGFyYW1ldGVycy5pbi5zaXplICsKKwkJCQkJcGFyYW1l
dGVycy5pbi5zaXplICUKKwkJCQkJZ2V0c3lzdGVtYWxsb2NncmFudWxhcml0
eSAoKSwKKwkJCQkJc2htYW5hbWUJLy8gb2JqZWN0IG5hbWUKKyAgICApOwor
ICBjb25uLT5yZXZlcnRfdG9fc2VsZiAoKTsKKworICBpZiAoYXR0YWNobWFw
ID09IE5VTEwpCisgICAgeworICAgICAgc3lzdGVtX3ByaW50ZiAoImZhaWxl
ZCB0byBnZXQgc2htIGF0dGFjaG1hcFxuIik7CisgICAgICBoZWFkZXIuZXJy
b3JfY29kZSA9IEVOT01FTTsKKyAgICAgIFVubWFwVmlld09mRmlsZSAobWFw
cHRyKTsKKyAgICAgIENsb3NlSGFuZGxlIChmaWxlbWFwKTsKKyAgICAgIC8q
IEZJWE1FIGV4aXQgdGhlIG11dGV4ICovCisgICAgICByZXR1cm47CisgICAg
fQorCisgIHNobWlkX2RzICpzaG10ZW1wID0gbmV3IHNobWlkX2RzOworICBp
ZiAoIXNobXRlbXApCisgICAgeworICAgICAgc3lzdGVtX3ByaW50ZiAoImZh
aWxlZCB0byBtYWxsb2Mgc2htIG5vZGVcbiIpOworICAgICAgaGVhZGVyLmVy
cm9yX2NvZGUgPSBFTk9NRU07CisgICAgICBVbm1hcFZpZXdPZkZpbGUgKG1h
cHB0cik7CisgICAgICBDbG9zZUhhbmRsZSAoZmlsZW1hcCk7CisgICAgICBD
bG9zZUhhbmRsZSAoYXR0YWNobWFwKTsKKyAgICAgIC8qIEZJWE1FIGV4aXQg
bXV0ZXggKi8KKyAgICAgIHJldHVybjsKKyAgICB9CisKKyAgLyogZmlsbCBv
dXQgdGhlIG5vZGUgZGF0YSAqLworICBzaG10ZW1wLT5zaG1fcGVybS5jdWlk
ID0gZ2V0dWlkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS51aWQgPSBzaG10
ZW1wLT5zaG1fcGVybS5jdWlkOworICBzaG10ZW1wLT5zaG1fcGVybS5jZ2lk
ID0gZ2V0Z2lkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS5naWQgPSBzaG10
ZW1wLT5zaG1fcGVybS5jZ2lkOworICBzaG10ZW1wLT5zaG1fcGVybS5tb2Rl
ID0gcGFyYW1ldGVycy5pbi5zaG1mbGcgJiAweDAxZmY7CisgIHNobXRlbXAt
PnNobV9scGlkID0gMDsKKyAgc2htdGVtcC0+c2htX25hdHRjaCA9IDA7Cisg
IHNobXRlbXAtPnNobV9hdGltZSA9IDA7CisgIHNobXRlbXAtPnNobV9kdGlt
ZSA9IDA7CisgIHNobXRlbXAtPnNobV9jdGltZSA9IHRpbWUgKE5VTEwpOwor
ICBzaG10ZW1wLT5zaG1fc2Vnc3ogPSBwYXJhbWV0ZXJzLmluLnNpemU7Cisg
ICooc2htaWRfZHMgKikgbWFwcHRyID0gKnNobXRlbXA7CisgIHNobXRlbXAt
Pm1hcHB0ciA9IG1hcHB0cjsKKworICAvKiBubyBuZWVkIGZvciBJbnRlcmxv
Y2tlZEV4Y2hhbmdlIGhlcmUsIHdlJ3JlIHNlcmlhbGlzZWQgYnkgdGhlIGds
b2JhbCBtdXRleCAqLworICB0ZW1wbm9kZSA9IG5ldyBzaG1ub2RlOworICB0
ZW1wbm9kZS0+c2htZHMgPSBzaG10ZW1wOworICB0ZW1wbm9kZS0+c2htX2lk
ID0gKGludCkgSW50ZXJsb2NrZWRJbmNyZW1lbnQgKCZuZXdfaWQpOworICB0
ZW1wbm9kZS0+a2V5ID0gcGFyYW1ldGVycy5pbi5rZXk7CisgIHRlbXBub2Rl
LT5maWxlbWFwID0gZmlsZW1hcDsKKyAgdGVtcG5vZGUtPmF0dGFjaG1hcCA9
IGF0dGFjaG1hcDsKKyAgdGVtcG5vZGUtPm5leHQgPSBzaG1faGVhZDsKKyAg
c2htX2hlYWQgPSB0ZW1wbm9kZTsKKworICAvKiB3ZSBub3cgaGF2ZSB0aGUg
YXJlYSBpbiB0aGUgZGFlbW9uIGxpc3QsIG9wZW5lZC4gCisKKyAgRklYTUU6
IGxlYXZlIHRoZSBzeXN0ZW0gd2lkZSBzaG0gbXV0ZXggKi8KKworICBwYXJh
bWV0ZXJzLm91dC5zaG1faWQgPSB0ZW1wbm9kZS0+c2htX2lkOworaWYgKGNo
ZWNrX2FuZF9kdXBfaGFuZGxlIChHZXRDdXJyZW50UHJvY2VzcyAoKSxmcm9t
X3Byb2Nlc3NfaGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
dG9rZW5faGFuZGxlLAorICAgICAgICAgICAgICBEVVBMSUNBVEVfU0FNRV9B
Q0NFU1MsCisgICAgICAgICAgICAgICAgICAgIHRlbXBub2RlLT5maWxlbWFw
LCAmcGFyYW1ldGVycy5vdXQuZmlsZW1hcCwgVFJVRSkgIT0gMCkKKyAgICB7
CisgICAgICBwcmludGYgKCJlcnJvciBkdXBsaWNhdGluZyBmaWxlbWFwIGhh
bmRsZSAoJWx1KVxuIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRl
ci5lcnJvcl9jb2RlID0gRUFDQ0VTOworICAgICAgQ2xvc2VIYW5kbGUgKGZy
b21fcHJvY2Vzc19oYW5kbGUpOworLyogbXV0ZXggZXQgYWwgKi8KK3JldHVy
bjsKKyAgICB9CitpZiAoY2hlY2tfYW5kX2R1cF9oYW5kbGUgKEdldEN1cnJl
bnRQcm9jZXNzICgpLGZyb21fcHJvY2Vzc19oYW5kbGUsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdG9rZW5faGFuZGxlLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgRFVQTElDQVRFX1NBTUVfQUNDRVNTLAorICAgICAg
ICAgIHRlbXBub2RlLT5hdHRhY2htYXAsICZwYXJhbWV0ZXJzLm91dC5hdHRh
Y2htYXAsIFRSVUUpICE9IDApCisgICAgeworICAgICAgcHJpbnRmICgiZXJy
b3IgZHVwbGljYXRpbmcgYXR0YWNobWFwIGhhbmRsZSAoJWx1KVxuIiwgR2V0
TGFzdEVycm9yICgpKTsKKyAgICAgIGhlYWRlci5lcnJvcl9jb2RlID0gRUFD
Q0VTOworICAgICAgQ2xvc2VIYW5kbGUgKGZyb21fcHJvY2Vzc19oYW5kbGUp
OworLyogbW9yZSBjbGVhbnVwLi4uIHlheSEgKi8KK3JldHVybjsKKyAgICB9
CisgIHJldHVybjsKK30KKyNlbmRpZgpJbmRleDogc3JjL3dpbnN1cC9jeWd3
aW4vY3lnc2VydmVyX3NobS5oCmRpZmYgLXUgL2Rldi9udWxsIHNyYy93aW5z
dXAvY3lnd2luL2N5Z3NlcnZlcl9zaG0uaDoxLjEuMi4yCi0tLSAvZGV2L251
bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAgMTk3MAorKysgc3JjL3dpbnN1cC9j
eWd3aW4vY3lnc2VydmVyX3NobS5oCVNhdCBTZXAgMjkgMDM6NDc6NTggMjAw
MQpAQCAtMCwwICsxLDc5IEBACisvKiBjeWdzZXJ2ZXJfc2htLmgKKworICAg
Q29weXJpZ2h0IDIwMDEgUmVkIEhhdCBJbmMuCisgICBXcml0dGVuIGJ5IFJv
YmVydCBDb2xsaW5zIDxyYnRjb2xsaW5zQGhvdG1haWwuY29tPgorCitUaGlz
IGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKK1RoaXMgc29mdHdhcmUgaXMg
YSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJtcyBv
ZiB0aGUKK0N5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1bHQgdGhlIGZp
bGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKK2RldGFpbHMuICovCisKKyNpbmNs
dWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVy
X3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIK
KworI2RlZmluZSBTSE1fQ1JFQVRFIDAKKyNkZWZpbmUgU0hNX1JFQVRUQUNI
IDEKKworCitjbGFzcyBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0IDogcHVibGlj
IGNsaWVudF9yZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgdmlydHVhbCB2b2lk
IHNlcnZlICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubik7CisgIGNsaWVu
dF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1ZXN0X3NobV9nZXQoa2V5
X3QsIHNpemVfdCwgaW50LCBjaGFyIHBzZGJ1Zls0MDk2XSwgcGlkX3QpOwor
ICBjbGllbnRfcmVxdWVzdF9zaG1fZ2V0OjpjbGllbnRfcmVxdWVzdF9zaG1f
Z2V0KCk7CisgIGNsaWVudF9yZXF1ZXN0X3NobV9nZXQ6OmNsaWVudF9yZXF1
ZXN0X3NobV9nZXQoaW50LHBpZF90KTsKKyAgdW5pb24geworICAgc3RydWN0
IHtpbnQgdHlwZTsgcGlkX3QgcGlkOyBpbnQgc2htX2lkOyBrZXlfdCBrZXk7
IHNpemVfdCBzaXplOyBpbnQgc2htZmxnOyBjaGFyIHNkX2J1Zls0MDk2XTt9
IGluOworICAgc3RydWN0IHtpbnQgc2htX2lkOyBIQU5ETEUgZmlsZW1hcDsg
SEFORExFIGF0dGFjaG1hcDsga2V5X3Qga2V5O30gb3V0OworICB9IHBhcmFt
ZXRlcnM7Cit9OworCisjaWYgMAorY2xhc3MgX3NobWF0dGFjaCB7CitwdWJs
aWM6CisgIHZvaWQgKmRhdGE7CisgIGNsYXNzIF9zaG1hdHRhY2ggKm5leHQ7
Cit9OworCitjbGFzcyBzaG1pZF9kcyB7CitwdWJsaWM6CisgIHN0cnVjdCAg
IGlwY19wZXJtIHNobV9wZXJtOworICBzaXplX3QgICBzaG1fc2Vnc3o7Cisg
IHBpZF90ICAgIHNobV9scGlkOworICBwaWRfdCAgICBzaG1fY3BpZDsKKyAg
c2htYXR0X3Qgc2htX25hdHRjaDsKKyAgdGltZV90ICAgc2htX2F0aW1lOwor
ICB0aW1lX3QgICBzaG1fZHRpbWU7CisgIHRpbWVfdCAgIHNobV9jdGltZTsK
KyAgSEFORExFIGZpbGVtYXA7CisgIEhBTkRMRSBhdHRhY2htYXA7CisgIHZv
aWQgKm1hcHB0cjsKKyAgY2xhc3MgX3NobWF0dGFjaCAqYXR0YWNoaGVhZDsK
K307CisKK2NsYXNzIHNobW5vZGUgeworcHVibGljOgorICBjbGFzcyBzaG1p
ZF9kcyAqIHNobWlkOworICBjbGFzcyBzaG1ub2RlICpuZXh0OworICBrZXlf
dCBrZXk7Cit9OworLy8uLi4uCitzdHJ1Y3Qgc2htaWRfZHMgeworICBzdHJ1
Y3QgICBpcGNfcGVybSBzaG1fcGVybTsKKyAgc2l6ZV90ICAgc2htX3NlZ3N6
OworICBwaWRfdCAgICBzaG1fbHBpZDsKKyAgcGlkX3QgICAgc2htX2NwaWQ7
CisgIHNobWF0dF90IHNobV9uYXR0Y2g7CisgIHRpbWVfdCAgIHNobV9hdGlt
ZTsKKyAgdGltZV90ICAgc2htX2R0aW1lOworICB0aW1lX3QgICBzaG1fY3Rp
bWU7Cit9OworCit2b2lkICpzaG1hdChpbnQsIGNvbnN0IHZvaWQgKiwgaW50
KTsKK2ludCAgIHNobWN0bChpbnQsIGludCwgc3RydWN0IHNobWlkX2RzICop
OworaW50ICAgc2htZHQoY29uc3Qgdm9pZCAqKTsKK2ludCAgIHNobWdldChr
ZXlfdCwgc2l6ZV90LCBpbnQpOworCisjZW5kaWYKSW5kZXg6IHNyYy93aW5z
dXAvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnQuY2MKZGlmZiAtdSAvZGV2
L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5j
YzoxLjEuMi4yCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAg
MTk3MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9y
dC5jYwlTYXQgU2VwIDI5IDAzOjQ3OjU4IDIwMDEKQEAgLTAsMCArMSw5MiBA
QAorLyogY3lnc2VydmVyX3RyYW5zcG9ydC5jYworCisgICBDb3B5cmlnaHQg
MjAwMSBSZWQgSGF0IEluYy4KKworICAgV3JpdHRlbiBieSBSb2JlcnQgQ29s
bGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNvbT4KKworICAgVGhpcyBmaWxl
IGlzIHBhcnQgb2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3YXJlIGlzIGEg
Y29weXJpZ2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2Yg
dGhlCisgICBDeWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBm
aWxlICJDWUdXSU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxzLiAqLworCisj
aW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1
ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHdpbmRvd3MuaD4KKyNpbmNsdWRl
IDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CisjaW5j
bHVkZSA8bmV0ZGIuaD4KKyNpbmNsdWRlICJ3aW5jYXAuaCIKKyNpbmNsdWRl
ICJjeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oIgorI2luY2x1ZGUgImN5
Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmgiCisjaW5jbHVkZSAi
Y3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfc29ja2V0cy5oIgorCisvKiB0
byBhbGxvdyB0aGlzIHRvIGxpbmsgaW50byBjeWd3aW4gYW5kIHRoZSAuZGxs
LCBhIGxpdHRsZSBtYWdpYyBpcyBuZWVkZWQuICovCisjaWZuZGVmIF9fT1VU
U0lERV9DWUdXSU5fXworI2luY2x1ZGUgIndpbnN1cC5oIgorI2Vsc2UKKyNk
ZWZpbmUgZGVidWdfcHJpbnRmIHByaW50ZgorI2VuZGlmCisKKy8qIFRoZSBm
YWN0b3J5ICovCitjbGFzcyB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY3JlYXRl
X3NlcnZlcl90cmFuc3BvcnQoKQoreworICB0cmFuc3BvcnRfbGF5ZXJfYmFz
ZSAqdGVtcDsKKyAgLyogY3VycmVudGx5IHRoZXJlIGlzIG9ubHkgdGhlIGJh
c2UgY2xhc3MhICovCisgIGlmICh3aW5jYXAuaXNfd2lubnQgKCkpCisgICAg
dGVtcCA9IG5ldyB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKCk7CisgIGVsc2UK
KyAgICB0ZW1wID0gbmV3IHRyYW5zcG9ydF9sYXllcl9iYXNlICgpOworICBy
ZXR1cm4gdGVtcDsKK30KKworCit0cmFuc3BvcnRfbGF5ZXJfYmFzZTo6dHJh
bnNwb3J0X2xheWVyX2Jhc2UgKCkKK3sKKyAgLyogc2hvdWxkIHdlIHRocm93
IGFuIGVycm9yIG9mIHNvbWUgc29ydCA/ICovCit9CisKK3ZvaWQKK3RyYW5z
cG9ydF9sYXllcl9iYXNlOjpsaXN0ZW4gKCkKK3sKK30KKworY2xhc3MgdHJh
bnNwb3J0X2xheWVyX2Jhc2UgKgordHJhbnNwb3J0X2xheWVyX2Jhc2U6OmFj
Y2VwdCAoKQoreworICByZXR1cm4gTlVMTDsKK30KKwordm9pZAordHJhbnNw
b3J0X2xheWVyX2Jhc2U6OmNsb3NlKCkKK3sKK30KKworc3NpemVfdAordHJh
bnNwb3J0X2xheWVyX2Jhc2U6OnJlYWQgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxl
bikKK3sKKyAgcmV0dXJuIDA7Cit9CisKK3NzaXplX3QKK3RyYW5zcG9ydF9s
YXllcl9iYXNlOjp3cml0ZSAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQorewor
ICByZXR1cm4gMDsKK30KKworYm9vbAordHJhbnNwb3J0X2xheWVyX2Jhc2U6
OmNvbm5lY3QgKCkKK3sKKyAgcmV0dXJuIGZhbHNlOworfQorCit2b2lkCit0
cmFuc3BvcnRfbGF5ZXJfYmFzZTo6aW1wZXJzb25hdGVfY2xpZW50ICgpCit7
Cit9CisKK3ZvaWQKK3RyYW5zcG9ydF9sYXllcl9iYXNlOjpyZXZlcnRfdG9f
c2VsZiAoKQoreworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2Vy
dmVyX3RyYW5zcG9ydF9waXBlcy5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMv
d2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmNjOjEu
MS4yLjIKLS0tIC9kZXYvbnVsbAkJVGh1IEphbiAgMSAwMTowMDowMCAxOTcw
CisrKyBzcmMvd2luc3VwL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3Bp
cGVzLmNjCVNhdCBTZXAgMjkgMDM6NDc6NTggMjAwMQpAQCAtMCwwICsxLDE5
NiBAQAorLyogY3lnc2VydmVyX3RyYW5zcG9ydF9waXBlcy5jYworCisgICBD
b3B5cmlnaHQgMjAwMSBSZWQgSGF0IEluYy4KKworICAgV3JpdHRlbiBieSBS
b2JlcnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bob3RtYWlsLmNvbT4KKworICAg
VGhpcyBmaWxlIGlzIHBhcnQgb2YgQ3lnd2luLgorCisgICBUaGlzIHNvZnR3
YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUg
dGVybXMgb2YgdGhlCisgICBDeWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25z
dWx0IHRoZSBmaWxlICJDWUdXSU5fTElDRU5TRSIgZm9yCisgICBkZXRhaWxz
LiAqLworCisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxzdGRpby5o
PgorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHdpbmRvd3MuaD4K
KyNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDxzeXMvc29ja2V0
Lmg+CisjaW5jbHVkZSA8bmV0ZGIuaD4KKyNpbmNsdWRlICJ3aW5jYXAuaCIK
KyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oIgorI2lu
Y2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmgiCisK
Ky8qIHRvIGFsbG93IHRoaXMgdG8gbGluayBpbnRvIGN5Z3dpbiBhbmQgdGhl
IC5kbGwsIGEgbGl0dGxlIG1hZ2ljIGlzIG5lZWRlZC4gKi8KKyNpZm5kZWYg
X19PVVRTSURFX0NZR1dJTl9fCisjaW5jbHVkZSAid2luc3VwLmgiCisjZWxz
ZQorI2RlZmluZSBkZWJ1Z19wcmludGYgcHJpbnRmCisjZW5kaWYKKwordHJh
bnNwb3J0X2xheWVyX3BpcGVzOjp0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKEhB
TkRMRSBuZXdfcGlwZSkKK3sKKyAgcGlwZSA9IG5ld19waXBlOworICBpZiAo
aW5pdGVkICE9IHRydWUpCisgICAgaW5pdF9zZWN1cml0eSgpOworfTsKKwor
dHJhbnNwb3J0X2xheWVyX3BpcGVzOjp0cmFuc3BvcnRfbGF5ZXJfcGlwZXMg
KCkgCit7CisgIHBpcGUgPSBOVUxMOworICBzdHJjcHkocGlwZV9uYW1lLCAi
XFxcXC5cXHBpcGVcXGN5Z3dpbl9scGMiKTsKKyAgaWYgKGluaXRlZCAhPSB0
cnVlKQorICAgIGluaXRfc2VjdXJpdHkoKTsKK30KKworCit2b2lkCit0cmFu
c3BvcnRfbGF5ZXJfcGlwZXM6OmluaXRfc2VjdXJpdHkoKQoreworICAvKiBG
SVhNRTogcHRocmVhZF9vbmNlIG9yIGVxdWl2YWxlbnQgbmVlZGVkICovCisg
IEluaXRpYWxpemVTZWN1cml0eURlc2NyaXB0b3IgKCZzZCwgU0VDVVJJVFlf
REVTQ1JJUFRPUl9SRVZJU0lPTik7CisgIFNldFNlY3VyaXR5RGVzY3JpcHRv
ckRhY2wgKCZzZCwgVFJVRSwgMCwgRkFMU0UpOworCisgIHNlY19ub25lX25p
aC5uTGVuZ3RoID0gc2VjX2FsbF9uaWgubkxlbmd0aCA9IHNpemVvZiAoU0VD
VVJJVFlfQVRUUklCVVRFUyk7CisgIHNlY19ub25lX25paC5iSW5oZXJpdEhh
bmRsZSA9IHNlY19hbGxfbmloLmJJbmhlcml0SGFuZGxlID0gRkFMU0U7Cisg
IHNlY19ub25lX25paC5scFNlY3VyaXR5RGVzY3JpcHRvciA9IE5VTEw7Cisg
IHNlY19hbGxfbmloLmxwU2VjdXJpdHlEZXNjcmlwdG9yID0gJnNkOworICBp
bml0ZWQgPSB0cnVlOworfQorCit2b2lkCit0cmFuc3BvcnRfbGF5ZXJfcGlw
ZXM6Omxpc3RlbiAoKQoreworICAvKiBuby1vcCAqLworfQorCitjbGFzcyB0
cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKgordHJhbnNwb3J0X2xheWVyX3BpcGVz
OjphY2NlcHQgKCkKK3sKKyAgaWYgKHBpcGUpCisgICAgeworICAgICAgZGVi
dWdfcHJpbnRmICgiQWxyZWFkeSBoYXZlIGEgcGlwZSBpbiB0aGlzICVwXG4i
LHRoaXMpOworICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIHBpcGUg
PSBDcmVhdGVOYW1lZFBpcGUgKHBpcGVfbmFtZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgUElQRV9BQ0NFU1NfRFVQTEVYLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICBQSVBFX1RZUEVfQllURSB8IFBJUEVfV0FJVCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgUElQRV9VTkxJTUlURURfSU5TVEFO
Q0VTLAorICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAwLCAxMDAwLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAmc2VjX2FsbF9uaWggKTsKKyAg
aWYgKHBpcGUgPT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgeworICAg
ICAgZGVidWdfcHJpbnRmICgiZXJyb3IgY3JlYXRpbmcgcGlwZSAoJWx1KVxu
LiIsIEdldExhc3RFcnJvciAoKSk7CisgICAgICByZXR1cm4gTlVMTDsKKyAg
ICB9CisKKyAgaWYgKCAhQ29ubmVjdE5hbWVkUGlwZSAoIHBpcGUsIE5VTEwg
KSAmJgorICAgICBHZXRMYXN0RXJyb3IgKCkgIT0gRVJST1JfUElQRV9DT05O
RUNURUQpCisgICAgeworICAgICAgcHJpbnRmICgiZXJyb3IgY29ubmVjdGlu
ZyB0byBwaXBlICglbHUpXG4uIiwgR2V0TGFzdEVycm9yICgpKTsKKyAgICAg
IENsb3NlSGFuZGxlIChwaXBlKTsKKyAgICAgIHBpcGUgPSBOVUxMOworICAg
ICAgcmV0dXJuIE5VTEw7CisgICAgfQorICAKKyAgdHJhbnNwb3J0X2xheWVy
X3BpcGVzICpuZXdfY29ubiA9IG5ldyB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMg
KHBpcGUpOworICBwaXBlID0gTlVMTDsKKworICByZXR1cm4gbmV3X2Nvbm47
ICAKK30KKwordm9pZAordHJhbnNwb3J0X2xheWVyX3BpcGVzOjpjbG9zZSgp
Cit7CisgIGlmIChwaXBlICYmIHBpcGUgIT0gSU5WQUxJRF9IQU5ETEVfVkFM
VUUpCisgICAgeworICAgICAgRmx1c2hGaWxlQnVmZmVycyAocGlwZSk7Cisg
ICAgICBEaXNjb25uZWN0TmFtZWRQaXBlIChwaXBlKTsKKyAgICAgIENsb3Nl
SGFuZGxlIChwaXBlKTsKKyAgICB9Cit9CisKK3NzaXplX3QKK3RyYW5zcG9y
dF9sYXllcl9waXBlczo6cmVhZCAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQor
eworICBEV09SRCBieXRlc19yZWFkLCByYzsKKyAgaWYgKCFwaXBlIHx8IHBp
cGUgPT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgcmV0dXJuIC0xOwor
CisgIHJjID0gUmVhZEZpbGUgKHBpcGUsIGJ1ZiwgbGVuLCAmYnl0ZXNfcmVh
ZCwgTlVMTCk7CisgIGlmICghcmMpCisgICAgeworICAgICAgZGVidWdfcHJp
bnRmICgiZXJyb3IgcmVhZGluZyBmcm9tIHBpcGUgKCVsdSlcbiIsIEdldExh
c3RFcnJvciAoKSk7CisgICAgICByZXR1cm4gLTE7CisgICAgfQorICByZXR1
cm4gYnl0ZXNfcmVhZDsKK30KKworc3NpemVfdAordHJhbnNwb3J0X2xheWVy
X3BpcGVzOjp3cml0ZSAoY2hhciAqYnVmLCBzaXplX3QgbGVuKQoreworICBE
V09SRCBieXRlc193cml0dGVuLCByYzsKKyAgaWYgKCFwaXBlIHx8IHBpcGUg
PT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpCisgICAgcmV0dXJuIC0xOworCisg
IHJjID0gV3JpdGVGaWxlIChwaXBlLCBidWYsIGxlbiwgJmJ5dGVzX3dyaXR0
ZW4sIE5VTEwpOworICBpZiAoIXJjKQorICAgIHsKKyAgICAgIGRlYnVnX3By
aW50ZiAoImVycm9yIHdyaXRpbmcgdG8gcGlwZSAoJWx1KVxuIiwgR2V0TGFz
dEVycm9yICgpKTsKKyAgICAgIHJldHVybiAtMTsKKyAgICB9CisgIHJldHVy
biBieXRlc193cml0dGVuOworfQorCitib29sCit0cmFuc3BvcnRfbGF5ZXJf
cGlwZXM6OmNvbm5lY3QgKCkKK3sKKyAgaWYgKHBpcGUgJiYgcGlwZSAhPSBJ
TlZBTElEX0hBTkRMRV9WQUxVRSkKKyAgICB7CisgICAgICBkZWJ1Z19wcmlu
dGYgKCJBbHJlYWR5IGhhdmUgYSBwaXBlIGluIHRoaXMgJXBcbiIsdGhpcyk7
CisgICAgICByZXR1cm4gZmFsc2U7CisgICAgfQorCisgIHdoaWxlICgxKQor
ICAgIHsKKyAgICAgIHBpcGUgPSBDcmVhdGVGaWxlIChwaXBlX25hbWUsCisJ
CSAgICAgICAgIEdFTkVSSUNfUkVBRCB8IEdFTkVSSUNfV1JJVEUsCisJCSAg
ICAgICAgIEZJTEVfU0hBUkVfUkVBRCB8IEZJTEVfU0hBUkVfV1JJVEUsCisJ
CSAgICAgICAgICZzZWNfYWxsX25paCwKKwkJICAgICAgICAgT1BFTl9FWElT
VElORywKKwkJICAgICAgICAgMCwgTlVMTCk7CisKKyAgICAgIGlmIChwaXBl
ICE9IElOVkFMSURfSEFORExFX1ZBTFVFKQorCS8qIGdvdCB0aGUgcGlwZSAq
LworICAgICAgICByZXR1cm4gdHJ1ZTsKKworICAgICAgaWYgKEdldExhc3RF
cnJvciAoKSAhPSBFUlJPUl9QSVBFX0JVU1kpCisgICAgICAgIHsKKyAgICAg
ICAgICBkZWJ1Z19wcmludGYgKCJFcnJvciBvcGVuaW5nIHRoZSBwaXBlICgl
bHUpXG4iLCBHZXRMYXN0RXJyb3IgKCkpOworICAgICAgICAgIHBpcGUgPSBO
VUxMOworICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgfQorICAg
ICAgaWYgKCFXYWl0TmFtZWRQaXBlIChwaXBlX25hbWUsIDIwMDAwKSkKKyAg
ICAgICAgZGVidWdfcHJpbnRmICggImVycm9yIGNvbm5lY3RpbmcgdG8gc2Vy
dmVyIHBpcGUgYWZ0ZXIgMjAgc2Vjb25kcyAoJWx1KVxuIiwgR2V0TGFzdEVy
cm9yICgpICk7CisgICAgICAvKiBXZSBsb29wIGhlcmUsIGJlY2F1c2UgdGhl
IHBpcGUgZXhpc3RzIGJ1dCBpcyBidXN5LiBJZiBpdCBkb2Vzbid0IGV4aXN0
CisgICAgICAgKiB0aGUgIT0gRVJST1JfUElQRV9CVVNZIHdpbGwgY2F0Y2gg
aXQuCisgICAgICAgKi8gCisgICAgfQorfQorCit2b2lkCit0cmFuc3BvcnRf
bGF5ZXJfcGlwZXM6OmltcGVyc29uYXRlX2NsaWVudCAoKQoreworICBpZiAo
cGlwZSAmJiBwaXBlICE9IElOVkFMSURfSEFORExFX1ZBTFVFKQorICAgIElt
cGVyc29uYXRlTmFtZWRQaXBlQ2xpZW50IChwaXBlKTsKKyAgZGVidWdfcHJp
bnRmKCJJIGFtIHdobyB5b3UgYXJlXG4iKTsKK30KKwordm9pZAordHJhbnNw
b3J0X2xheWVyX3BpcGVzOjpyZXZlcnRfdG9fc2VsZiAoKQoreworICBSZXZl
cnRUb1NlbGYgKCk7IAorICBkZWJ1Z19wcmludGYoIkkgYW0gd2hvIEkgeWFt
XG4iKTsKK30KKwpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVy
X3RyYW5zcG9ydF9zb2NrZXRzLmNjCmRpZmYgLXUgL2Rldi9udWxsIHNyYy93
aW5zdXAvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfc29ja2V0cy5jYzox
LjEuMi4xCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEgMDE6MDA6MDAgMTk3
MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydF9z
b2NrZXRzLmNjCVNhdCBTZXAgMjkgMDM6NDc6NTggMjAwMQpAQCAtMCwwICsx
LDEzMSBAQAorLyogY3lnc2VydmVyX3RyYW5zcG9ydF9zb2NrZXRzLmNjCisK
KyAgIENvcHlyaWdodCAyMDAxIFJlZCBIYXQgSW5jLgorCisgICBXcml0dGVu
IGJ5IFJvYmVydCBDb2xsaW5zIDxyYnRjb2xsaW5zQGhvdG1haWwuY29tPgor
CisgICBUaGlzIGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMg
c29mdHdhcmUgaXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVy
IHRoZSB0ZXJtcyBvZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNl
IGNvbnN1bHQgdGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRl
dGFpbHMuICovCisKKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPHN0
ZGlvLmg+CisjaW5jbHVkZSA8dW5pc3RkLmg+CisjaW5jbHVkZSA8d2luZG93
cy5oPgorI2luY2x1ZGUgPHN5cy90eXBlcy5oPgorI2luY2x1ZGUgPHN5cy9z
b2NrZXQuaD4KKyNpbmNsdWRlIDxuZXRkYi5oPgorI2luY2x1ZGUgIndpbmNh
cC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0Lmgi
CisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRfc29ja2V0
cy5oIgorCisvKiB0byBhbGxvdyB0aGlzIHRvIGxpbmsgaW50byBjeWd3aW4g
YW5kIHRoZSAuZGxsLCBhIGxpdHRsZSBtYWdpYyBpcyBuZWVkZWQuICovCisj
aWZuZGVmIF9fT1VUU0lERV9DWUdXSU5fXworI2luY2x1ZGUgIndpbnN1cC5o
IgorZXh0ZXJuICJDIiBpbnQKK2N5Z3dpbl9zb2NrZXQgKGludCBhZiwgaW50
IHR5cGUsIGludCBwcm90b2NvbCk7CitleHRlcm4gIkMiIGludAorY3lnd2lu
X2Nvbm5lY3QgKGludCBmZCwKKyAgICAgICAgICAgICAgICBjb25zdCBzdHJ1
Y3Qgc29ja2FkZHIgKm5hbWUsCisJCWludCBuYW1lbGVuKTsKK2V4dGVybiAi
QyIgaW50CitjeWd3aW5fYWNjZXB0IChpbnQgZmQsIHN0cnVjdCBzb2NrYWRk
ciAqcGVlciwgaW50ICpsZW4pOworZXh0ZXJuICJDIiBpbnQKK2N5Z3dpbl9s
aXN0ZW4gKGludCBmZCwgaW50IGJhY2tsb2cpOworZXh0ZXJuICJDIiBpbnQK
K2N5Z3dpbl9iaW5kIChpbnQgZmQsIGNvbnN0IHN0cnVjdCBzb2NrYWRkciAq
bXlfYWRkciwgaW50IGFkZHJsZW4pOworCisjZWxzZQorI2RlZmluZSBjeWd3
aW5fYWNjZXB0KEEsQixDKSAgOjphY2NlcHQoQSxCLEMpCisjZGVmaW5lIGN5
Z3dpbl9zb2NrZXQoQSxCLEMpICA6OnNvY2tldChBLEIsQykKKyNkZWZpbmUg
Y3lnd2luX2xpc3RlbihBLEIpICAgIDo6bGlzdGVuKEEsQikKKyNkZWZpbmUg
Y3lnd2luX2JpbmQoQSxCLEMpICAgIDo6YmluZChBLEIsQykKKyNkZWZpbmUg
Y3lnd2luX2Nvbm5lY3QoQSxCLEMpIDo6Y29ubmVjdChBLEIsQykKKyNkZWZp
bmUgZGVidWdfcHJpbnRmIHByaW50ZgorI2VuZGlmCisKK3RyYW5zcG9ydF9s
YXllcl9zb2NrZXRzOjp0cmFuc3BvcnRfbGF5ZXJfc29ja2V0cyAoaW50IG5l
d2ZkKTogZmQobmV3ZmQpCit7CisgIC8qIFRoaXMgbWF5IG5vdCBiZSBuZWVk
ZWQgaW4gdGhpcyBjb25zdHJ1Y3RvciAtIGl0J3Mgb25seSB1c2VkCisgICAq
IHdoZW4gY3JlYXRpbmcgYSBjb25uZWN0aW9uIHZpYSBiaW5kIG9yIGNvbm5l
Y3QKKyAgICovCisgIHNvY2tkZXRhaWxzLnNhX2ZhbWlseSA9IEFGX1VOSVg7
CisgIHN0cmNweSAoc29ja2RldGFpbHMuc2FfZGF0YSwgIi90bXAvY3lnZGFl
bW8iKTsKKyAgc2RsZW4gPSBzdHJsZW4oc29ja2RldGFpbHMuc2FfZGF0YSkg
KyBzaXplb2Yoc29ja2RldGFpbHMuc2FfZmFtaWx5KTsKK307CisKK3RyYW5z
cG9ydF9sYXllcl9zb2NrZXRzOjp0cmFuc3BvcnRfbGF5ZXJfc29ja2V0cyAo
KTogZmQgKC0xKQoreworICBzb2NrZGV0YWlscy5zYV9mYW1pbHkgPSBBRl9V
TklYOworICBzdHJjcHkgKHNvY2tkZXRhaWxzLnNhX2RhdGEsICIvdG1wL2N5
Z2RhZW1vIik7CisgIHNkbGVuID0gc3RybGVuKHNvY2tkZXRhaWxzLnNhX2Rh
dGEpICsgc2l6ZW9mKHNvY2tkZXRhaWxzLnNhX2ZhbWlseSk7Cit9CisKK3Zv
aWQKK3RyYW5zcG9ydF9sYXllcl9zb2NrZXRzOjpsaXN0ZW4gKCkKK3sKKyAg
Lyogd2Ugd2FudCBhIHRocmVhZCBwb29sIGJhc2VkIGFwcHJvYWNoLiAqLwor
ICBpZiAoKGZkID0gY3lnd2luX3NvY2tldCAoQUZfVU5JWCwgU09DS19TVFJF
QU0sMCkpIDwgMCkKKyAgICBwcmludGYgKCJTb2NrZXQgbm90IGNyZWF0ZWQg
ZXJyb3IgJWRcbiIsIGVycm5vKTsKKyAgaWYgKGN5Z3dpbl9iaW5kKGZkLCAm
c29ja2RldGFpbHMsIHNkbGVuKSkKKyAgICBwcmludGYgKCJCaW5kIGRvZXNu
J3QgbGlrZSB5b3UuIFRzayBUc2suIEJpbmQgc2FpZCAlZFxuIiwgZXJybm8p
OworICBpZiAoY3lnd2luX2xpc3RlbihmZCwgNSkgPCAwKQorICAgIHByaW50
ZiAoIkFuZCB0aGUgT1MganVzdCBpc24ndCBsaXN0ZW5pbmcsIGFsbCBpdCBz
YXlzIGlzICVkXG4iLCBlcnJubyk7Cit9CisKK2NsYXNzIHRyYW5zcG9ydF9s
YXllcl9zb2NrZXRzICoKK3RyYW5zcG9ydF9sYXllcl9zb2NrZXRzOjphY2Nl
cHQgKCkKK3sKKyAgLyogRklYTUU6IGNoZWNrIHdlIGhhdmUgbGlzdGVuZWQg
Ki8KKyAgaW50IG5ld19mZDsKKworICBpZiAoKG5ld19mZCA9IGN5Z3dpbl9h
Y2NlcHQoZmQsICZzb2NrZGV0YWlscywgJnNkbGVuKSkgPCAwKQorICAgIHsK
KyAgICAgIHByaW50ZiAoIk51cCwgY291bGQnIGFjY2VwdC4gJWRcbiIsZXJy
bm8pOworICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorICAKKyAgdHJhbnNw
b3J0X2xheWVyX3NvY2tldHMgKm5ld19jb25uID0gbmV3IHRyYW5zcG9ydF9s
YXllcl9zb2NrZXRzIChuZXdfZmQpOworCisgIHJldHVybiBuZXdfY29ubjsg
IAorCit9CisKK3ZvaWQKK3RyYW5zcG9ydF9sYXllcl9zb2NrZXRzOjpjbG9z
ZSgpCit7CisgIC8qIEZJWE1FIC0gYXJlIHdlIG9wZW4/ICovCisgIDo6Y2xv
c2UgKGZkKTsKK30KKworc3NpemVfdAordHJhbnNwb3J0X2xheWVyX3NvY2tl
dHM6OnJlYWQgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKyAgLyogRklY
TUU6IGFyZSB3ZSBvcGVuPyAqLworICByZXR1cm4gOjpyZWFkIChmZCwgYnVm
LCBsZW4pOworfQorCitzc2l6ZV90Cit0cmFuc3BvcnRfbGF5ZXJfc29ja2V0
czo6d3JpdGUgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKyAgLyogRklY
TUU6IGFyZSB3ZSBvcGVuPyAqLworICByZXR1cm4gOjp3cml0ZSAoZmQsIGJ1
ZiwgbGVuKTsKK30KKworYm9vbAordHJhbnNwb3J0X2xheWVyX3NvY2tldHM6
OmNvbm5lY3QgKCkKK3sKKyAgLyogYXJlIHdlIGFscmVhZHkgY29ubmVjdGVk
PyAqLworICBpZiAoZmQgIT0gLTEpCisgICAgcmV0dXJuIGZhbHNlOworICBm
ZCA9IGN5Z3dpbl9zb2NrZXQgKEFGX1VOSVgsIFNPQ0tfU1RSRUFNLCAwKTsK
KyAgaWYgKGN5Z3dpbl9jb25uZWN0IChmZCwgJnNvY2tkZXRhaWxzLCBzZGxl
bikgPCAwKQorICAgIHsKKyAgICAgIGRlYnVnX3ByaW50ZigiY2xpZW50IGNv
bm5lY3QgZmFpbHVyZSAlZFxuIiwgZXJybm8pOworICAgICAgOjpjbG9zZSAo
ZmQpOworICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKyAgcmV0dXJuIHRy
dWU7Cit9CkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9jeWd3aW4uZGluCmRp
ZmYgLXUgc3JjL3dpbnN1cC9jeWd3aW4vY3lnd2luLmRpbjoxLjM3IHNyYy93
aW5zdXAvY3lnd2luL2N5Z3dpbi5kaW46MS4zNy4yLjEKLS0tIHNyYy93aW5z
dXAvY3lnd2luL2N5Z3dpbi5kaW46MS4zNwlUdWUgU2VwIDE4IDE4OjA3OjEw
IDIwMDEKKysrIHNyYy93aW5zdXAvY3lnd2luL2N5Z3dpbi5kaW4JTW9uIFNl
cCAyNCAyMzozMTowNCAyMDAxCkBAIC0xMjIwLDMgKzEyMjAsNyBAQAogX2Fj
bHRvdGV4dCA9IGFjbHRvdGV4dAogYWNsZnJvbXRleHQKIF9hY2xmcm9tdGV4
dCA9IGFjbGZyb210ZXh0CitmdG9rCitzaG1hdAorc2htY3RsCitzaG1nZXQK
SW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL2RjcnQwLmNjCmRpZmYgLXUgc3Jj
L3dpbnN1cC9jeWd3aW4vZGNydDAuY2M6MS4xMTIgc3JjL3dpbnN1cC9jeWd3
aW4vZGNydDAuY2M6MS4xMTIuMi4yCi0tLSBzcmMvd2luc3VwL2N5Z3dpbi9k
Y3J0MC5jYzoxLjExMglGcmkgU2VwIDE0IDIxOjM2OjQzIDIwMDEKKysrIHNy
Yy93aW5zdXAvY3lnd2luL2RjcnQwLmNjCVNhdCBTZXAgMjkgMDM6NDc6NTgg
MjAwMQpAQCAtMzQsNiArMzQsOCBAQAogI2luY2x1ZGUgInNoYXJlZF9pbmZv
LmgiCiAjaW5jbHVkZSAiY3lnd2luX3ZlcnNpb24uaCIKICNpbmNsdWRlICJk
bGxfaW5pdC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNw
b3J0LmgiCisjaW5jbHVkZSAiY3lnd2luL2N5Z3NlcnZlci5oIgogCiAjZGVm
aW5lIE1BWF9BVF9GSUxFX0xFVkVMIDEwCiAKQEAgLTY4Nyw2ICs2ODksOCBA
QAogCiAgIC8qIEluaXRpYWxpemUgc2lnbmFsL3N1YnByb2Nlc3MgaGFuZGxp
bmcuICovCiAgIHNpZ3Byb2NfaW5pdCAoKTsKKworICBjeWdzZXJ2ZXJfaW5p
dCAoKTsKIAogICAvKiBDb25uZWN0IHRvIHR0eS4gKi8KICAgdHR5X2luaXQg
KCk7CkluZGV4OiBzcmMvd2luc3VwL2N5Z3dpbi9maGFuZGxlci5oCmRpZmYg
LXUgc3JjL3dpbnN1cC9jeWd3aW4vZmhhbmRsZXIuaDoxLjg0IHNyYy93aW5z
dXAvY3lnd2luL2ZoYW5kbGVyLmg6MS44My4yLjIKLS0tIHNyYy93aW5zdXAv
Y3lnd2luL2ZoYW5kbGVyLmg6MS44NAlGcmkgU2VwIDI4IDE4OjIzOjA2IDIw
MDEKKysrIHNyYy93aW5zdXAvY3lnd2luL2ZoYW5kbGVyLmgJU2F0IFNlcCAy
OSAwMjozNTozMCAyMDAxCkBAIC04NDAsNiArODQwLDggQEAKICAgb2ZmX3Qg
bHNlZWsgKG9mZl90LCBpbnQpIHsgcmV0dXJuIDA7IH0KICAgc2VsZWN0X3Jl
Y29yZCAqc2VsZWN0X3JlYWQgKHNlbGVjdF9yZWNvcmQgKnMpOwogICBpbnQg
cmVhZHlfZm9yX3JlYWQgKGludCBmZCwgRFdPUkQgaG93bG9uZywgaW50IGln
bnJhKTsKKworICBpbnQgY3lnc2VydmVyX2F0dGFjaF90dHkgKEhBTkRMRSos
IEhBTkRMRSopOwogfTsKIAogY2xhc3MgZmhhbmRsZXJfcHR5X21hc3Rlcjog
cHVibGljIGZoYW5kbGVyX3R0eV9jb21tb24KSW5kZXg6IHNyYy93aW5zdXAv
Y3lnd2luL2ZoYW5kbGVyX3R0eS5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3ln
d2luL2ZoYW5kbGVyX3R0eS5jYzoxLjQ5IHNyYy93aW5zdXAvY3lnd2luL2Zo
YW5kbGVyX3R0eS5jYzoxLjQ5LjIuMgotLS0gc3JjL3dpbnN1cC9jeWd3aW4v
ZmhhbmRsZXJfdHR5LmNjOjEuNDkJTW9uIFNlcCAyNCAxNDo1MDo0NCAyMDAx
CisrKyBzcmMvd2luc3VwL2N5Z3dpbi9maGFuZGxlcl90dHkuY2MJU2F0IFNl
cCAyOSAwMzo0Nzo1OCAyMDAxCkBAIC0yNSw2ICsyNSw4IEBACiAjaW5jbHVk
ZSAicGluZm8uaCIKICNpbmNsdWRlICJjeWdoZWFwLmgiCiAjaW5jbHVkZSAi
c2hhcmVkX2luZm8uaCIKKyNpbmNsdWRlICJjeWd3aW4vY3lnc2VydmVyX3Ry
YW5zcG9ydC5oIgorI2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXIuaCIKIAog
LyogVHR5IG1hc3RlciBzdHVmZiAqLwogCkBAIC01MjMsNDIgKzUyNSw4OSBA
QAogICAgICAgcmV0dXJuIDA7CiAgICAgfQogCi0gIEhBTkRMRSB0dHlfb3du
ZXIgPSBPcGVuUHJvY2VzcyAoUFJPQ0VTU19EVVBfSEFORExFLCBGQUxTRSwK
LQkJCQkgICAgIGdldF90dHlwICgpLT5tYXN0ZXJfcGlkKTsKLSAgaWYgKHR0
eV9vd25lciA9PSBOVUxMKQotICAgIHsKLSAgICAgIHRlcm1pb3NfcHJpbnRm
ICgiY2FuJ3Qgb3BlbiB0dHkgKCVkKSBoYW5kbGUgcHJvY2VzcyAlZCIsCi0J
CSAgICAgIHR0eW51bSwgZ2V0X3R0eXAgKCktPm1hc3Rlcl9waWQpOwotICAg
ICAgX19zZXRlcnJubyAoKTsKLSAgICAgIHJldHVybiAwOwotICAgIH0KKyAg
SEFORExFIGZyb21fbWFzdGVyX2xvY2FsLCB0b19tYXN0ZXJfbG9jYWw7CiAK
LSAgSEFORExFIG5oOwotICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAodHR5X293
bmVyLCBnZXRfdHR5cCAoKS0+ZnJvbV9tYXN0ZXIsIGhNYWluUHJvYywgJm5o
LCAwLCBUUlVFLAotCQkJRFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKLSAgICB7
Ci0gICAgICB0ZXJtaW9zX3ByaW50ZiAoImNhbid0IGR1cGxpY2F0ZSBpbnB1
dCwgJUUiKTsKLSAgICAgIF9fc2V0ZXJybm8gKCk7Ci0gICAgICByZXR1cm4g
MDsKLSAgICB9Ci0gIHNldF9pb19oYW5kbGUgKG5oKTsKLSAgUHJvdGVjdEhh
bmRsZTEgKG5oLCBmcm9tX3B0eSk7Ci0gIHRlcm1pb3NfcHJpbnRmICgiZHVw
bGljYXRlZCBmcm9tX21hc3RlciAlcC0+JXAgZnJvbSB0dHlfb3duZXIgJXAi
LAotCQkgIGdldF90dHlwICgpLT5mcm9tX21hc3RlciwgbmgsIHR0eV9vd25l
cik7Ci0gIGlmICghRHVwbGljYXRlSGFuZGxlICh0dHlfb3duZXIsIGdldF90
dHlwICgpLT50b19tYXN0ZXIsIGhNYWluUHJvYywgJm5oLCAwLCBUUlVFLAot
CQkJRFVQTElDQVRFX1NBTUVfQUNDRVNTKSkKLSAgICB7Ci0gICAgICB0ZXJt
aW9zX3ByaW50ZiAoImNhbid0IGR1cGxpY2F0ZSBvdXRwdXQsICVFIik7Ci0g
ICAgICBfX3NldGVycm5vICgpOwotICAgICAgcmV0dXJuIDA7Ci0gICAgfQot
ICBzZXRfb3V0cHV0X2hhbmRsZSAobmgpOwotICBQcm90ZWN0SGFuZGxlMSAo
bmgsIHRvX3B0eSk7Ci0gIENsb3NlSGFuZGxlICh0dHlfb3duZXIpOworICBp
ZiAoIXdpbmNhcC5oYXNfc2VjdXJpdHkgKCkgfHwKKyAgICAgIGN5Z3NlcnZl
cl9ydW5uaW5nIT1DWUdTRVJWRVJfT0sgfHwKKyAgICAgICFjeWdzZXJ2ZXJf
YXR0YWNoX3R0eSAoICZmcm9tX21hc3Rlcl9sb2NhbCwgJnRvX21hc3Rlcl9s
b2NhbCkpCisgICAgeworICAgICAgdGVybWlvc19wcmludGYgKCJjYW5ub3Qg
ZHVwIGhhbmRsZXMgdmlhIHNlcnZlci4gdXNpbmcgb2xkIG1ldGhvZC4iKTsK
KworICAgICAgSEFORExFIHR0eV9vd25lciA9IE9wZW5Qcm9jZXNzIChQUk9D
RVNTX0RVUF9IQU5ETEUsIEZBTFNFLAorCQkJCSAgICAgICAgIGdldF90dHlw
ICgpLT5tYXN0ZXJfcGlkKTsKKyAgICAgIGlmICh0dHlfb3duZXIgPT0gTlVM
TCkKKyAgICAgICAgeworICAgICAgICAgIHRlcm1pb3NfcHJpbnRmICgiY2Fu
J3Qgb3BlbiB0dHkgKCVkKSBoYW5kbGUgcHJvY2VzcyAlZCIsCisJIAkgICAg
ICAgICAgdHR5bnVtLCBnZXRfdHR5cCAoKS0+bWFzdGVyX3BpZCk7CisgICAg
ICAgICAgX19zZXRlcnJubyAoKTsKKyAgICAgICAgICByZXR1cm4gMDsKKyAg
ICAgICAgfQorCisgICAgICBpZiAoIUR1cGxpY2F0ZUhhbmRsZSAodHR5X293
bmVyLCBnZXRfdHR5cCAoKS0+ZnJvbV9tYXN0ZXIsIAorCQkJICBoTWFpblBy
b2MsICZmcm9tX21hc3Rlcl9sb2NhbCwgMCwgVFJVRSwKKwkJCSAgICBEVVBM
SUNBVEVfU0FNRV9BQ0NFU1MpKQorICAgICAgICB7CisgICAgICAgICAgdGVy
bWlvc19wcmludGYgKCJjYW4ndCBkdXBsaWNhdGUgaW5wdXQsICVFIik7Cisg
ICAgICAgICAgX19zZXRlcnJubyAoKTsKKyAgICAgICAgICByZXR1cm4gMDsK
KyAgICAgICAgfQorICAgICAgdGVybWlvc19wcmludGYgKCJkdXBsaWNhdGVk
IGZyb21fbWFzdGVyICVwLT4lcCBmcm9tIHR0eV9vd25lciAlcCIsCisJCSAg
ICAgZ2V0X3R0eXAgKCktPmZyb21fbWFzdGVyLCBmcm9tX21hc3Rlcl9sb2Nh
bCwgdHR5X293bmVyKTsKKworICAgICAgaWYgKCFEdXBsaWNhdGVIYW5kbGUg
KHR0eV9vd25lciwgZ2V0X3R0eXAgKCktPnRvX21hc3RlciwgCisJCQkgIGhN
YWluUHJvYywgJnRvX21hc3Rlcl9sb2NhbCwgMCwgVFJVRSwKKwkJCSAgRFVQ
TElDQVRFX1NBTUVfQUNDRVNTKSkKKyAgICAgICAgeworICAgICAgICAgIHRl
cm1pb3NfcHJpbnRmICgiY2FuJ3QgZHVwbGljYXRlIG91dHB1dCwgJUUiKTsK
KyAgICAgICAgICBfX3NldGVycm5vICgpOworICAgICAgICAgIHJldHVybiAw
OworICAgICAgICB9CisgICAgICB0ZXJtaW9zX3ByaW50ZiAoImR1cGxpY2F0
ZWQgdG9fbWFzdGVyICVwLT4lcCBmcm9tIHR0eV9vd25lciAlcCIsCisgICAg
ICAJCSAgICAgZ2V0X3R0eXAgKCktPnRvX21hc3RlciwgdG9fbWFzdGVyX2xv
Y2FsLCB0dHlfb3duZXIpOworICAgICAgQ2xvc2VIYW5kbGUgKHR0eV9vd25l
cik7CisgICAgfQorCisgIHNldF9pb19oYW5kbGUgKGZyb21fbWFzdGVyX2xv
Y2FsKTsKKyAgUHJvdGVjdEhhbmRsZTEgKGZyb21fbWFzdGVyX2xvY2FsLCBm
cm9tX3B0eSk7CisgIHNldF9vdXRwdXRfaGFuZGxlICh0b19tYXN0ZXJfbG9j
YWwpOworICBQcm90ZWN0SGFuZGxlMSAodG9fbWFzdGVyX2xvY2FsLCB0b19w
dHkpOwogCiAgIHNldF9vcGVuX3N0YXR1cyAoKTsKICAgdGVybWlvc19wcmlu
dGYgKCJ0dHklZCBvcGVuZWQiLCB0dHludW0pOwogCisgIHJldHVybiAxOwor
fQorCitpbnQKK2ZoYW5kbGVyX3R0eV9zbGF2ZTo6Y3lnc2VydmVyX2F0dGFj
aF90dHkgKExQSEFORExFIGZyb21fbWFzdGVyX3B0ciwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMUEhBTkRMRSB0b19tYXN0
ZXJfcHRyKQoreworICBpZiAoIWZyb21fbWFzdGVyX3B0ciB8fCAhdG9fbWFz
dGVyX3B0cikKKyAgICByZXR1cm4gMDsKKworICBjbGllbnRfcmVxdWVzdF9h
dHRhY2hfdHR5ICpyZXF1ZXN0ID0gCisJbmV3IGNsaWVudF9yZXF1ZXN0X2F0
dGFjaF90dHkgKChEV09SRCkgR2V0Q3VycmVudFByb2Nlc3NJZCAoKSwKKwkJ
CQkgICAgICAoRFdPUkQpIGdldF90dHlwICgpLT5tYXN0ZXJfcGlkLAorCQkJ
CSAgICAgIChIQU5ETEUpIGdldF90dHlwICgpLT5mcm9tX21hc3RlciwKKwkJ
CQkgICAgICAoSEFORExFKSBnZXRfdHR5cCAoKS0+dG9fbWFzdGVyKTsKKwor
ICBpZiAoY3lnc2VydmVyX3JlcXVlc3QgKHJlcXVlc3QpICE9IDAgfHwKKwly
ZXF1ZXN0LT5oZWFkZXIuZXJyb3JfY29kZSAhPSAwKQorICAgIHJldHVybiAw
OworCisvKgorICBzdHJ1Y3QgcmVxdWVzdF9hdHRhY2hfdHR5IHJlcTsKKyAg
SU5JVF9SRVFVRVNUIChyZXEsIENZR1NFUlZFUl9SRVFVRVNUX0FUVEFDSF9U
VFkpOworICByZXEucGlkID0gR2V0Q3VycmVudFByb2Nlc3NJZCAoKTsKKyAg
cmVxLm1hc3Rlcl9waWQgPSBnZXRfdHR5cCAoKS0+bWFzdGVyX3BpZDsKKyAg
cmVxLmZyb21fbWFzdGVyID0gZ2V0X3R0eXAgKCktPmZyb21fbWFzdGVyOwor
ICByZXEudG9fbWFzdGVyID0gZ2V0X3R0eXAgKCktPnRvX21hc3RlcjsKKyAg
aWYgKGN5Z3NlcnZlcl9yZXF1ZXN0ICgoc3RydWN0IHJlcXVlc3RfaGVhZGVy
KikgJnJlcSkgIT0gMCkKKyAgICByZXR1cm4gMDsKKyovCisgICpmcm9tX21h
c3Rlcl9wdHIgPSByZXF1ZXN0LT5mcm9tX21hc3RlciAoKTsKKyAgKnRvX21h
c3Rlcl9wdHIgPSByZXF1ZXN0LT50b19tYXN0ZXIgKCk7CisgIGRlbGV0ZSBy
ZXF1ZXN0OwogICByZXR1cm4gMTsKIH0KIApJbmRleDogc3JjL3dpbnN1cC9j
eWd3aW4vZm9yay5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL2Zvcmsu
Y2M6MS42OCBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjOjEuNjguMi4xCi0t
LSBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjOjEuNjgJU2F0IFNlcCAyMiAw
OTo1NTowMiAyMDAxCisrKyBzcmMvd2luc3VwL2N5Z3dpbi9mb3JrLmNjCU1v
biBTZXAgMjQgMjM6MzE6MDQgMjAwMQpAQCAtMzAyLDYgKzMwMiw5IEBACiAg
IGlmIChmaXh1cF9tbWFwc19hZnRlcl9mb3JrICgpKQogICAgIGFwaV9mYXRh
bCAoInJlY3JlYXRlX21tYXBzX2FmdGVyX2ZvcmtfZmFpbGVkIik7CiAKKyAg
aWYgKGZpeHVwX3NobXNfYWZ0ZXJfZm9yayAoKSkKKyAgICBhcGlfZmF0YWwg
KCJyZWNyZWF0ZV9zaG0gYXJlYXMgYWZ0ZXIgZm9yayBmYWlsZWQiKTsKKwog
ICAvKiBTZXQgdGhyZWFkIGxvY2FsIHN0dWZmIHRvIHplcm8uICBVbmRlciBX
aW5kb3dzIDk1Lzk4IHRoaXMgaXMgc29tZXRpbWVzCiAgICAgIG5vbi16ZXJv
LCBmb3Igc29tZSByZWFzb24uCiAgICAgIEZJWE1FOiAgVGhlcmUgaXMgYSBt
ZW1vcnkgbGVhayBoZXJlIGFmdGVyIGEgZm9yay4gKi8KSW5kZXg6IHNyYy93
aW5zdXAvY3lnd2luL2lwYy5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2lu
c3VwL2N5Z3dpbi9pcGMuY2M6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlUaHUg
SmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2luL2lw
Yy5jYwlNb24gU2VwIDI0IDIzOjMxOjA0IDIwMDEKQEAgLTAsMCArMSwzOSBA
QAorLyogaXBjLmNjOiBTaW5nbGUgdW5peCBzcGVjaWZpY2F0aW9uIElQQyBp
bnRlcmZhY2UgZm9yIEN5Z3dpbgorCisgICBDb3B5cmlnaHQgMjAwMSBSZWQg
SGF0LCBJbmMuCisKKyAgIE9yaWdpbmFsbHkgd3JpdHRlbiBieSBSb2JlcnQg
Q29sbGlucyA8cm9iZXJ0LmNvbGxpbnNAaG90bWFpbC5jb20+CisKKyAgIFRo
aXMgZmlsZSBpcyBwYXJ0IG9mIEN5Z3dpbi4KKworICAgVGhpcyBzb2Z0d2Fy
ZSBpcyBhIGNvcHlyaWdodGVkIHdvcmsgbGljZW5zZWQgdW5kZXIgdGhlIHRl
cm1zIG9mIHRoZQorICAgQ3lnd2luIGxpY2Vuc2UuICBQbGVhc2UgY29uc3Vs
dCB0aGUgZmlsZSAiQ1lHV0lOX0xJQ0VOU0UiIGZvcgorICAgZGV0YWlscy4g
Ki8KKworI2luY2x1ZGUgIndpbnN1cC5oIgorI2luY2x1ZGUgPHN5cy9pcGMu
aD4KKyNpbmNsdWRlIDxzeXMvc3RhdC5oPgorCitleHRlcm4gIkMiCit7CisK
Ky8qIE5vdGVzOiB3ZSByZXR1cm4gYSB2YWxpZCBrZXkgZXZlbiBpZiBpZCdz
IGxvdyBvcmRlciA4IGJpdHMgYXJlIDAuICovCitrZXlfdAorZnRvayhjb25z
dCBjaGFyICpwYXRoLCBpbnQgaWQpCit7CisgIHN0cnVjdCBzdGF0IHN0YXRi
dWY7CisgIGlmIChzdGF0KHBhdGgsICZzdGF0YnVmKSkKKyAgICB7CisgICAg
ICAvKiBzdGF0IHNldCB0aGUgYXBwcm9wcmlhdGUgZXJybm8gZm9yIHVzICov
CisgICAgICByZXR1cm4gKGtleV90KSAtMTsKKyAgICB9CisgIAorICAvKiBk
ZXZfdCBpcyBzaG9ydCBmb3IgY3lnd2luIAorICAgKiBpbm9fdCBpcyBsb25n
IGZvciBjeWd3aW4KKyAgICogYW5kIHdlIG5lZWQgOCBiaXRzIGZvciB0aGUg
aWQuCisgICAqIHRodXMga2V5X3QgaXMgbG9uZyBsb25nLiAKKyAgICovCisg
IHJldHVybiAoKGxvbmcgbG9uZykgc3RhdGJ1Zi5zdF9kZXYgPDwgKDUqOCkp
IHwgKHN0YXRidWYuc3RfaW5vIDw8ICg4KSApIHwgKGlkICYgMHgwMGZmKTsK
K30KKworfQpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vcGluZm8uaApkaWZm
IC11IHNyYy93aW5zdXAvY3lnd2luL3BpbmZvLmg6MS4zMSBzcmMvd2luc3Vw
L2N5Z3dpbi9waW5mby5oOjEuMzEuMi4xCi0tLSBzcmMvd2luc3VwL2N5Z3dp
bi9waW5mby5oOjEuMzEJV2VkIFNlcCAxMiAxMDo0NjozNiAyMDAxCisrKyBz
cmMvd2luc3VwL2N5Z3dpbi9waW5mby5oCU1vbiBTZXAgMjQgMjM6MzE6MDQg
MjAwMQpAQCAtMjAxLDYgKzIwMSw4IEBACiAKIC8qIEZvciBtbWFwcyBhY3Jv
c3MgZm9yaygpLiAqLwogaW50IF9fc3RkY2FsbCBmaXh1cF9tbWFwc19hZnRl
cl9mb3JrICgpOworLyogZm9yIHNobSBhcmVhcyBhY3Jvc3MgZm9yayAoKS4g
Ki8KK2ludCBfX3N0ZGNhbGwgZml4dXBfc2htc19hZnRlcl9mb3JrICgpOwog
CiB2b2lkIF9fc3RkY2FsbCBmaWxsX3J1c2FnZSAoc3RydWN0IHJ1c2FnZSAq
LCBIQU5ETEUpOwogdm9pZCBfX3N0ZGNhbGwgYWRkX3J1c2FnZSAoc3RydWN0
IHJ1c2FnZSAqLCBzdHJ1Y3QgcnVzYWdlICopOwpJbmRleDogc3JjL3dpbnN1
cC9jeWd3aW4vc2VjdXJpdHkuaApkaWZmIC11IHNyYy93aW5zdXAvY3lnd2lu
L3NlY3VyaXR5Lmg6MS4xNiBzcmMvd2luc3VwL2N5Z3dpbi9zZWN1cml0eS5o
OjEuMTYuNC4xCi0tLSBzcmMvd2luc3VwL2N5Z3dpbi9zZWN1cml0eS5oOjEu
MTYJRnJpIFNlcCAgNyAxNDozMjowNSAyMDAxCisrKyBzcmMvd2luc3VwL2N5
Z3dpbi9zZWN1cml0eS5oCU1vbiBTZXAgMjQgMjM6MzE6MDQgMjAwMQpAQCAt
MjA0LDMgKzIwNCw1IEBACiAKIGludCBfX3N0ZGNhbGwgTlRSZWFkRUEgKGNv
bnN0IGNoYXIgKmZpbGUsIGNvbnN0IGNoYXIgKmF0dHJuYW1lLCBjaGFyICpi
dWYsIGludCBsZW4pOwogQk9PTCBfX3N0ZGNhbGwgTlRXcml0ZUVBIChjb25z
dCBjaGFyICpmaWxlLCBjb25zdCBjaGFyICphdHRybmFtZSwgY29uc3QgY2hh
ciAqYnVmLCBpbnQgbGVuKTsKK1BTRUNVUklUWV9ERVNDUklQVE9SIGFsbG9j
X3NkICh1aWRfdCB1aWQsIGdpZF90IGdpZCwgY29uc3QgY2hhciAqbG9nc3J2
LCBpbnQgYXR0cmlidXRlLAorICAgICAgICAgIFBTRUNVUklUWV9ERVNDUklQ
VE9SIHNkX3JldCwgRFdPUkQgKnNkX3NpemVfcmV0KTsKSW5kZXg6IHNyYy93
aW5zdXAvY3lnd2luL3NobS5jYwpkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2lu
c3VwL2N5Z3dpbi9zaG0uY2M6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlUaHUg
SmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2luL3No
bS5jYwlNb24gU2VwIDI0IDIzOjMxOjA0IDIwMDEKQEAgLTAsMCArMSw0NDYg
QEAKKy8qIHNobS5jYzogU2luZ2xlIHVuaXggc3BlY2lmaWNhdGlvbiBJUEMg
aW50ZXJmYWNlIGZvciBDeWd3aW4KKworICAgQ29weXJpZ2h0IDIwMDEgUmVk
IEhhdCwgSW5jLgorCisgICBPcmlnaW5hbGx5IHdyaXR0ZW4gYnkgUm9iZXJ0
IENvbGxpbnMgPHJvYmVydC5jb2xsaW5zQGhvdG1haWwuY29tPgorCisgICBU
aGlzIGZpbGUgaXMgcGFydCBvZiBDeWd3aW4uCisKKyAgIFRoaXMgc29mdHdh
cmUgaXMgYSBjb3B5cmlnaHRlZCB3b3JrIGxpY2Vuc2VkIHVuZGVyIHRoZSB0
ZXJtcyBvZiB0aGUKKyAgIEN5Z3dpbiBsaWNlbnNlLiAgUGxlYXNlIGNvbnN1
bHQgdGhlIGZpbGUgIkNZR1dJTl9MSUNFTlNFIiBmb3IKKyAgIGRldGFpbHMu
ICovCisKKyNpbmNsdWRlICJ3aW5zdXAuaCIKKyNpbmNsdWRlIDxzeXMvc3Rh
dC5oPgorI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSAiY3lnZXJybm8u
aCIKKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNsdWRlICJzZWN1cml0eS5o
IgorI2luY2x1ZGUgImZoYW5kbGVyLmgiCisjaW5jbHVkZSAiZHRhYmxlLmgi
CisjaW5jbHVkZSAiY3lnaGVhcC5oIgorI2luY2x1ZGUgPHN0ZGlvLmg+Cisj
aW5jbHVkZSAidGhyZWFkLmgiCisjaW5jbHVkZSA8c3lzL3NobS5oPgorI2lu
Y2x1ZGUgInBlcnByb2Nlc3MuaCIKKyNpbmNsdWRlICJjeWdzZXJ2ZXJfc2ht
LmgiCisKKy8vIEZJWE1FIElTIFRISVMgQ09SUkVDVAorLyogSW1wbGVtZW50
YXRpb24gbm90ZXM6IFdlIHVzZSB0d28gc2hhcmVkIG1lbW9yeSByZWdpb25z
IHBlciBrZXk6CisgKiBPbmUgZm9yIHRoZSBjb250cm9sIHN0cnVjdHVyZSwg
YW5kIG9uZSBmb3IgdGhlIHNoYXJlZCBtZW1vcnkuCisgKiBXaGlsZSB0aGlz
IGhhcyBhIGhpZ2hlciBvdmVyaGVhZCB0aGFtIGEgc2luZ2xlIHNoYXJlZCBh
cmVhLAorICogSXQgYWxsb3dzIG1vcmUgZmxleGFiaWxpdHkuIEFzIHRoZSBl
bnRpcmUgY29kZSBpcyB0cmFuc3BhcmVudCB0byB0aGUgdXNlcgorICogV2Ug
Y2FuIG1lcmdlIHRoZXNlIGluIHRoZSBmdXR1cmUgc2hvdWxkIGl0IGJlIG5l
ZWRlZC4KKyAqLworZXh0ZXJuICJDIiBzaXplX3QKK2dldHN5c3RlbWFsbG9j
Z3JhbnVsYXJpdHkgKCkKK3sKKyAgU1lTVEVNX0lORk8gc3lzaW5mbzsKKyAg
c3RhdGljIHNpemVfdCBidWZmZXJfb2Zmc2V0ID0gMDsKKyAgaWYgKGJ1ZmZl
cl9vZmZzZXQpCisgICAgcmV0dXJuIGJ1ZmZlcl9vZmZzZXQ7CisgIEdldFN5
c3RlbUluZm8gKCZzeXNpbmZvKTsKKyAgYnVmZmVyX29mZnNldCA9IHN5c2lu
Zm8uZHdBbGxvY2F0aW9uR3JhbnVsYXJpdHk7CisgIHJldHVybiBidWZmZXJf
b2Zmc2V0OworfQorCitzdGF0aWMgc2htbm9kZSAqc2htX2hlYWQgPSBOVUxM
OworCitzdGF0aWMgc2htbm9kZSAqCitidWlsZF9pbnByb2Nlc3Nfc2htZHMg
KEhBTkRMRSBoZmlsZW1hcCwgSEFORExFIGhhdHRhY2htYXAsIGtleV90IGtl
eSwKKwkJICAgICAgIGludCBzaG1faWQpCit7CisgIEhBTkRMRSBmaWxlbWFw
ID0gaGZpbGVtYXA7CisgIHZvaWQgKm1hcHB0ciA9IE1hcFZpZXdPZkZpbGUg
KGZpbGVtYXAsIEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKworICBpZiAo
IW1hcHB0cikKKyAgICB7CisgICAgICBDbG9zZUhhbmRsZSAoaGZpbGVtYXAp
OworICAgICAgQ2xvc2VIYW5kbGUgKGhhdHRhY2htYXApOworICAgICAgLy9G
SVhNRTogY2xvc2UgZmlsZW1hcCBhbmQgZnJlZSB0aGUgbXV0ZXgKKyAgICAg
IC8qIHdlIGNvdWxkbid0IGFjY2VzcyB0aGUgbWFwcGVkIGFyZWEgd2l0aCB0
aGUgcmVxdWVzdGVkIHBlcm1pc3Npb25zICovCisgICAgICBzZXRfZXJybm8g
KEVBQ0NFUyk7CisgICAgICByZXR1cm4gTlVMTDsKKyAgICB9CisKKyAgLyog
Tm93IGdldCB0aGUgdXNlciBkYXRhICovCisgIEhBTkRMRSBhdHRhY2htYXAg
PSBoYXR0YWNobWFwOworICBzaG1pZF9kcyAqc2htdGVtcCA9IG5ldyBzaG1p
ZF9kczsKKyAgaWYgKCFzaG10ZW1wKQorICAgIHsKKyAgICAgIHN5c3RlbV9w
cmludGYgKCJmYWlsZWQgdG8gbWFsbG9jIHNobSBub2RlXG4iKTsKKyAgICAg
IHNldF9lcnJubyAoRU5PTUVNKTsKKyAgICAgIFVubWFwVmlld09mRmlsZSAo
bWFwcHRyKTsKKyAgICAgIENsb3NlSGFuZGxlIChmaWxlbWFwKTsKKyAgICAg
IENsb3NlSGFuZGxlIChhdHRhY2htYXApOworICAgICAgLyogZXhpdCBtdXRl
eCAqLworICAgICAgcmV0dXJuIE5VTEw7CisgICAgfQorCisgIC8qIGdldCB0
aGUgc3lzdGVtIG5vZGUgZGF0YSAqLworICAqc2htdGVtcCA9ICooc2htaWRf
ZHMgKikgbWFwcHRyOworCisgIC8qIHByb2Nlc3MgbG9jYWwgZGF0YSAqLwor
ICBzaG1ub2RlICp0ZW1wbm9kZSA9IG5ldyBzaG1ub2RlOworCisgIHRlbXBu
b2RlLT5maWxlbWFwID0gZmlsZW1hcDsKKyAgdGVtcG5vZGUtPmF0dGFjaG1h
cCA9IGF0dGFjaG1hcDsKKyAgc2htdGVtcC0+bWFwcHRyID0gbWFwcHRyOwor
CisgIC8qIG5vIG5lZWQgZm9yIEludGVybG9ja2VkRXhjaGFuZ2UgaGVyZSwg
d2UncmUgc2VyaWFsaXNlZCBieSB0aGUgZ2xvYmFsIG11dGV4ICovCisgIHRl
bXBub2RlLT5zaG1kcyA9IHNobXRlbXA7CisgIHRlbXBub2RlLT5zaG1faWQg
PSBzaG1faWQ7CisgIHRlbXBub2RlLT5rZXkgPSBrZXk7CisgIHRlbXBub2Rl
LT5uZXh0ID0gc2htX2hlYWQ7CisgIHRlbXBub2RlLT5hdHRhY2hoZWFkID0g
TlVMTDsKKyAgc2htX2hlYWQgPSB0ZW1wbm9kZTsKKworICAvKiBGSVhNRTog
bGVhdmUgdGhlIHN5c3RlbSB3aWRlIHNobSBtdXRleCAqLworCisgIHJldHVy
biB0ZW1wbm9kZTsKK30KKworaW50IF9fc3RkY2FsbAorZml4dXBfc2htc19h
ZnRlcl9mb3JrICgpCit7CisgIHNobW5vZGUgKnRlbXBub2RlID0gc2htX2hl
YWQ7CisgIHdoaWxlICh0ZW1wbm9kZSkKKyAgICB7CisgICAgICB2b2lkICpu
ZXdzaG1kcyA9CisJTWFwVmlld09mRmlsZSAodGVtcG5vZGUtPmZpbGVtYXAs
IEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKyAgICAgIGlmICghbmV3c2ht
ZHMpCisJeworCSAgLyogZG9uJ3Qgd29ycnkgYWJvdXQgaGFuZGxlIGNsZWFu
dXAsIHdlJ3JlIGR5aW5nISAqLworCSAgc3lzdGVtX3ByaW50ZigiZmFpbGVk
IHRvIHJlYXR0YWNoIHRvIHNobSBjb250cm9sIGZpbGUgdmlldyAleFxuIix0
ZW1wbm9kZSk7CisJICByZXR1cm4gMTsKKwl9CisgICAgICB0ZW1wbm9kZS0+
c2htZHMgPSAoY2xhc3Mgc2htaWRfZHMgKikgbmV3c2htZHM7CisgICAgICB0
ZW1wbm9kZS0+c2htZHMtPm1hcHB0ciA9IG5ld3NobWRzOworICAgICAgX3No
bWF0dGFjaCAqYXR0YWNobm9kZSA9IHRlbXBub2RlLT5hdHRhY2hoZWFkOwor
ICAgICAgd2hpbGUgKGF0dGFjaG5vZGUpCisJeworCSAgdm9pZCAqbmV3ZGF0
YSA9IE1hcFZpZXdPZkZpbGVFeCAodGVtcG5vZGUtPmF0dGFjaG1hcCwKKwkJ
CQkJICAgKGF0dGFjaG5vZGUtPnNobWZsZyAmIFNITV9SRE9OTFkpID8KKwkJ
CQkJICAgRklMRV9NQVBfUkVBRCA6IEZJTEVfTUFQX1dSSVRFLCAwLAorCQkJ
CQkgICAwLCAwLCBhdHRhY2hub2RlLT5kYXRhKTsKKwkgIGlmIChuZXdkYXRh
ICE9IGF0dGFjaG5vZGUtPmRhdGEpCisJICAgIHsKKwkgICAgICAvKiBkb24n
dCB3b3JyeSBhYm91dCBoYW5kbGUgY2xlYW51cCwgd2UncmUgZHlpbmchICov
CisJCXN5c3RlbV9wcmludGYoImZhaWxlZCB0byByZWF0dGFjaCB0byBtYXBw
ZWQgZmlsZSB2aWV3ICV4XG4iLGF0dGFjaG5vZGUtPmRhdGEpOworCSAgICAg
IHJldHVybiAxOworCSAgICB9CisJICBhdHRhY2hub2RlID0gYXR0YWNobm9k
ZS0+bmV4dDsKKwl9CisgICAgICB0ZW1wbm9kZSA9IHRlbXBub2RlLT5uZXh0
OworICAgIH0KKyAgcmV0dXJuIDA7Cit9CisKKy8qIHRoaXMgaXMgdWdseS4g
WWVzLCBJIGtub3cgdGhhdC4KKyAqIEZJWE1FOiBhYnN0cmFjdCB0aGUgbG9v
a3VwIGZ1bmN0aW9uYWxpdHksCisgKiBTbyB0aGF0IGl0IGNhbiBiZSBhbiBh
cnJheSwgbGlzdCwgd2hhdGV2ZXIgd2l0aG91dCB1cyBiZWluZyB3b3JyaWVk
CisgKi8KKworLyogRklYTUU6IGFmdGVyIGZvcmssIGV2ZXJ5IG1lbW9yeSBh
cmVhIG5lZWRzIHRvIGhhdmUgdGhlIGF0dGFjaCBjb3VudAorICogaW5jcmVt
ZW50ZWQgYW5kIHRoZSBtYXBwaW5ncyBwb3RlbnRpYWxseSByZWVzdGFibGlz
aGVkLCBwZXJoYXBzIGFsbG93aW5nCisgKiBpbmhlcml0IHdpbGwgd29yaz8h
PworICovCisKKy8qIEZJWE1FOiBhcmUgaW5oZXJpdGVkIG1hcHBlZCBJUENf
UFJJVkFURSBpZCdzIHNoYXJlZCBiZXR3ZWVuIHByb2Nlc3MncworICogWUVT
IGZyb20gbGludXguCisgKi8KKworZXh0ZXJuICJDIiB2b2lkICoKK3NobWF0
IChpbnQgc2htaWQsIGNvbnN0IHZvaWQgKnNobWFkZHIsIGludCBzaG1mbGcp
Cit7CisgIHNobW5vZGUgKnRlbXBub2RlID0gc2htX2hlYWQ7CisgIHdoaWxl
ICh0ZW1wbm9kZSAmJiB0ZW1wbm9kZS0+c2htX2lkICE9IHNobWlkKQorICAg
IHRlbXBub2RlID0gdGVtcG5vZGUtPm5leHQ7CisKKyAgaWYgKCF0ZW1wbm9k
ZSkKKyAgICB7CisgICAgICAvKiBjb3VsZG4ndCBmaW5kIGEgY3VycmVudGx5
IG9wZW4gc2htIGNvbnRyb2wgYXJlYSBmb3IgdGhlIGtleSAtIHByb2JhYmx5
IGJlY2F1c2UKKyAgICAgICAqIHNobWdldCBoYXNuJ3QgYmVlbiBjYWxsZWQu
IAorICAgICAgICogQWxsb2NhdGUgYSBuZXcgY29udHJvbCBibG9jayAtIHRo
aXMgaGFzIHRvIGJlIGhhbmRsZWQgYnkgdGhlIGRhZW1vbiAqLworICAgICAg
Y2xpZW50X3JlcXVlc3Rfc2htX2dldCAqcmVxID0KKwluZXcgY2xpZW50X3Jl
cXVlc3Rfc2htX2dldCAoc2htaWQsIEdldEN1cnJlbnRQcm9jZXNzSWQgKCkp
OworCisgICAgICBpbnQgcmM7CisgICAgICBpZiAoKHJjID0gY3lnc2VydmVy
X3JlcXVlc3QgKHJlcSkpKQorCXsKKwkgIGRlbGV0ZSByZXE7CisJICBzZXRf
ZXJybm8gKEVOT1NZUyk7CS8qIGRhZW1vbiBjb21tdW5pY2F0aW9uIGZhaWxl
ZCAqLworCSAgcmV0dXJuICh2b2lkICopIC0xOworCX0KKworICAgICAgaWYg
KHJlcS0+aGVhZGVyLmVycm9yX2NvZGUpCS8qIHNobV9nZXQgZmFpbGVkIGlu
IHRoZSBkYWVtb24gKi8KKwl7CisJICBzZXRfZXJybm8gKHJlcS0+aGVhZGVy
LmVycm9yX2NvZGUpOworCSAgZGVsZXRlIHJlcTsKKwkgIHJldHVybiAodm9p
ZCAqKSAtMTsKKwl9CisKKyAgICAgIC8qIHdlJ3ZlIGdvdCB0aGUgaWQsIG5v
dyB3ZSBvcGVuIHRoZSBtZW1vcnkgYXJlYSBvdXJzZWx2ZXMuCisgICAgICAg
KiBUaGlzIHRlc3RzIHNlY3VyaXR5IGF1dG9tYWdpY2FsbHkKKyAgICAgICAq
IEZJWE1FOiBtYWtlIHRoaXMgYSBtZXRob2Qgb2Ygc2htbm9kZSA/CisgICAg
ICAgKi8KKyAgICAgIHRlbXBub2RlID0KKwlidWlsZF9pbnByb2Nlc3Nfc2ht
ZHMgKHJlcS0+cGFyYW1ldGVycy5vdXQuZmlsZW1hcCwKKwkJCSAgICAgICBy
ZXEtPnBhcmFtZXRlcnMub3V0LmF0dGFjaG1hcCwKKwkJCSAgICAgICByZXEt
PnBhcmFtZXRlcnMub3V0LmtleSwKKwkJCSAgICAgICByZXEtPnBhcmFtZXRl
cnMub3V0LnNobV9pZCk7CisgICAgICBkZWxldGUgcmVxOworICAgICAgaWYg
KCF0ZW1wbm9kZSkKKwlyZXR1cm4gKHZvaWQgKikgLTE7CisKKyAgICB9CisK
KyAgY2xhc3Mgc2htaWRfZHMgKnNobSA9IHRlbXBub2RlLT5zaG1kczsKKwor
ICBpZiAoc2htYWRkcikKKyAgICB7CisgICAgICAvL0ZJWE1FOiByZXF1ZXN0
ZWQgYmFzZSBhZGRyZXNzID8hIChEb24ndCBmb3JnZXQgdG8gZml4IHRoZSBm
aXh1cF9hZnRlcl9mb3JrIHRvbykKKyAgICAgIHNldF9lcnJubyAoRUlOVkFM
KTsKKyAgICAgIHJldHVybiAodm9pZCAqKSAtMTsKKyAgICB9CisKKyAgdm9p
ZCAqcnYgPSBNYXBWaWV3T2ZGaWxlICh0ZW1wbm9kZS0+YXR0YWNobWFwLAor
CQkJICAgIChzaG1mbGcgJiBTSE1fUkRPTkxZKSA/IEZJTEVfTUFQX1JFQUQg
OgorCQkJICAgIEZJTEVfTUFQX1dSSVRFLCAwLCAwLCAwKTsKKworICBpZiAo
IXJ2KQorICAgIHsKKyAgICAgIC8vRklYTUU6IHRyYW5zbGF0ZSBHZXRMYXN0
RXJyb3IoKQorICAgICAgc2V0X2Vycm5vIChFQUNDRVMpOworICAgICAgcmV0
dXJuICh2b2lkICopIC0xOworICAgIH0KKworICBJbnRlcmxvY2tlZEluY3Jl
bWVudCAoJnNobS0+c2htX25hdHRjaCk7CisgIF9zaG1hdHRhY2ggKmF0dGFj
aG5vZGUgPSBuZXcgX3NobWF0dGFjaDsKKworICBhdHRhY2hub2RlLT5kYXRh
ID0gcnY7CisgIGF0dGFjaG5vZGUtPnNobWZsZyA9IHNobWZsZzsKKyAgYXR0
YWNobm9kZS0+bmV4dCA9CisgICAgKF9zaG1hdHRhY2ggKikgSW50ZXJsb2Nr
ZWRFeGNoYW5nZVBvaW50ZXIgKCZ0ZW1wbm9kZS0+YXR0YWNoaGVhZCwgYXR0
YWNobm9kZSk7CisKKworICByZXR1cm4gcnY7Cit9CisKKy8vRklYTUU6IHdo
byBpcyBhbGxvd2VkIHRvIHBlcmZvcm0gU1RBVD8gCitleHRlcm4gIkMiIGlu
dAorc2htY3RsIChpbnQgc2htaWQsIGludCBjbWQsIHN0cnVjdCBzaG1pZF9k
cyAqYnVmKQoreworICBzaG1ub2RlICp0ZW1wbm9kZSA9IHNobV9oZWFkOwor
ICB3aGlsZSAodGVtcG5vZGUgJiYgdGVtcG5vZGUtPnNobV9pZCAhPSBzaG1p
ZCkKKyAgICB0ZW1wbm9kZSA9IHRlbXBub2RlLT5uZXh0OworICBpZiAoIXRl
bXBub2RlKQorICB7CisgICAgLyogY291bGRuJ3QgZmluZCBhIGN1cnJlbnRs
eSBvcGVuIHNobSBjb250cm9sIGFyZWEgZm9yIHRoZSBrZXkgLSBwcm9iYWJs
eSBiZWNhdXNlCisgICAgICogc2htZ2V0IGhhc24ndCBiZWVuIGNhbGxlZC4K
KyAgICAgKiBBbGxvY2F0ZSBhIG5ldyBjb250cm9sIGJsb2NrIC0gdGhpcyBo
YXMgdG8gYmUgaGFuZGxlZCBieSB0aGUgZGFlbW9uICovCisgICAgY2xpZW50
X3JlcXVlc3Rfc2htX2dldCAqcmVxID0KKyAgICAgIG5ldyBjbGllbnRfcmVx
dWVzdF9zaG1fZ2V0IChzaG1pZCwgR2V0Q3VycmVudFByb2Nlc3NJZCAoKSk7
CisKKyAgICBpbnQgcmM7CisgICAgaWYgKChyYyA9IGN5Z3NlcnZlcl9yZXF1
ZXN0IChyZXEpKSkKKyAgICAgIHsKKyAgICAgICAgZGVsZXRlIHJlcTsKKyAg
ICAgICAgc2V0X2Vycm5vIChFTk9TWVMpOyAgIC8qIGRhZW1vbiBjb21tdW5p
Y2F0aW9uIGZhaWxlZCAqLworICAgICAgICByZXR1cm4gLTE7CisgICAgICB9
CisKKyAgICBpZiAocmVxLT5oZWFkZXIuZXJyb3JfY29kZSkgICAgICAgLyog
c2htX2dldCBmYWlsZWQgaW4gdGhlIGRhZW1vbiAqLworICAgICAgeworICAg
ICAgICBzZXRfZXJybm8gKHJlcS0+aGVhZGVyLmVycm9yX2NvZGUpOworICAg
ICAgICBkZWxldGUgcmVxOworICAgICAgICByZXR1cm4gLTE7CisgICAgICB9
CisKKyAgICAvKiB3ZSd2ZSBnb3QgdGhlIGlkLCBub3cgd2Ugb3BlbiB0aGUg
bWVtb3J5IGFyZWEgb3Vyc2VsdmVzLgorICAgICAqIFRoaXMgdGVzdHMgc2Vj
dXJpdHkgYXV0b21hZ2ljYWxseQorICAgICAqIEZJWE1FOiBtYWtlIHRoaXMg
YSBtZXRob2Qgb2Ygc2htbm9kZSA/CisgICAgICovCisgICAgdGVtcG5vZGUg
PQorICAgICAgYnVpbGRfaW5wcm9jZXNzX3NobWRzIChyZXEtPnBhcmFtZXRl
cnMub3V0LmZpbGVtYXAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJlcS0+cGFyYW1ldGVycy5vdXQuYXR0YWNobWFwLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXEtPnBhcmFtZXRlcnMub3V0LmtleSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLT5wYXJhbWV0ZXJzLm91
dC5zaG1faWQpOworICAgIGRlbGV0ZSByZXE7CisgICAgaWYgKCF0ZW1wbm9k
ZSkKKyAgICAgIHJldHVybiAtMTsKKyAgfQorICAKKyAgc3dpdGNoIChjbWQp
CisgICAgeworICAgIGNhc2UgSVBDX1NUQVQ6CisgICAgICBidWYtPnNobV9w
ZXJtID0gdGVtcG5vZGUtPnNobWRzLT5zaG1fcGVybTsgCisgICAgICBidWYt
PnNobV9zZWdzeiA9IHRlbXBub2RlLT5zaG1kcy0+c2htX3NlZ3N6OworICAg
ICAgYnVmLT5zaG1fbHBpZCA9IHRlbXBub2RlLT5zaG1kcy0+c2htX2xwaWQ7
CisgICAgICBidWYtPnNobV9jcGlkID0gdGVtcG5vZGUtPnNobWRzLT5zaG1f
Y3BpZDsKKyAgICAgIGJ1Zi0+c2htX25hdHRjaCA9IHRlbXBub2RlLT5zaG1k
cy0+c2htX25hdHRjaDsKKyAgICAgIGJ1Zi0+c2htX2F0aW1lID0gdGVtcG5v
ZGUtPnNobWRzLT5zaG1fYXRpbWU7CisgICAgICBidWYtPnNobV9kdGltZSA9
IHRlbXBub2RlLT5zaG1kcy0+c2htX2R0aW1lOworICAgICAgYnVmLT5zaG1f
Y3RpbWUgPSB0ZW1wbm9kZS0+c2htZHMtPnNobV9jdGltZTsKKyAgICAgIGJy
ZWFrOworICAgIGNhc2UgSVBDX1JNSUQ6CisgICAgICB7CisgICAgICAvKiBU
T0RPOiBjaGVjayBwZXJtaXNzaW9ucy4gT3IgcG9zc2libHksIHRoZSBkYWVt
b24gZ2V0cyB0byBiZSB0aGUgb25seSAKKyAgICAgICAqIG9uZSB3aXRoIHdy
aXRlIGFjY2VzcyB0byB0aGUgbWVtb3J5IGFyZWE/CisgICAgICAgKi8KKyAg
ICAgIGlmICh0ZW1wbm9kZS0+c2htZHMtPnNobV9uYXR0Y2gpCisJc3lzdGVt
X3ByaW50ZiAoImNhbGwgdG8gc2htY3RsIHdpdGggY21kPSBJUENfUk1JRCB3
aGVuIG1lbW9yeSBhcmVhIHN0aWxsIGhhcyIKKwkJCSIgYXR0YWNoZWVzXG4i
KTsKKyAgICAgIC8qIGhvdyBkb2VzIHRoaXMgd29yaz8gCisJKiB3ZSBtYXJr
IHRoZSBkcyBhcmVhIGFzICJkZWxldGVkIiwgYW5kIHRoZSBhdCBhbmQgZ2V0
IGNhbGxzIGFsbCBmYWlsIGZyb20gbm93IG9uCisJKiBvbiwgd2hlbiBuYXR0
Y2ggYmVjb21lcyAwLCB0aGUgbWFwcGVkIGRhdGEgYXJlYSBpcyBkZXN0cm95
ZWQuCisgICAgICAgICogYW5kIGVhY2ggcHJvY2VzcywgYXMgdGhleSB0b3Vj
aCB0aGlzIGFyZWEgZGV0YWNoZXMuIGV2ZW50dWFsbHkgb25seSB0aGUgCisg
CSogZGFlbW9uIGhhcyBhbiBhdHRhY2guIFRoZSBkYWVtb24gZ2V0cyBhc2tl
ZCB0byBkZXRhY2ggaW1tZWRpYXRlbHkuCisJKi8KKyNpZiAwCisgICAgICBj
bGllbnRfcmVxdWVzdF9zaG1fZ2V0ICpyZXEgPQorCSAgbmV3IGNsaWVudF9y
ZXF1ZXN0X3NobV9nZXQgKFNITV9ERUwsIHNobWlkLCBHZXRDdXJyZW50UHJv
Y2Vzc0lkICgpKTsKKyAgICBpbnQgcmM7CisgICAgaWYgKChyYyA9IGN5Z3Nl
cnZlcl9yZXF1ZXN0IChyZXEpKSkKKyAgICAgIHsKKyAgICAgICAgZGVsZXRl
IHJlcTsKKyAgICAgICAgc2V0X2Vycm5vIChFTk9TWVMpOyAgIC8qIGRhZW1v
biBjb21tdW5pY2F0aW9uIGZhaWxlZCAqLworICAgICAgICByZXR1cm4gLTE7
CisgICAgICB9CisKKyAgICBpZiAocmVxLT5oZWFkZXIuZXJyb3JfY29kZSkg
ICAgICAgLyogc2htX2RlbCBmYWlsZWQgaW4gdGhlIGRhZW1vbiAqLworICAg
ICAgeworICAgICAgICBzZXRfZXJybm8gKHJlcS0+aGVhZGVyLmVycm9yX2Nv
ZGUpOworICAgICAgICBkZWxldGUgcmVxOworICAgICAgICByZXR1cm4gLTE7
CisgICAgICB9CisKKyAgICAgLyogdGhlIGRhZW1vbiBoYXMgZGVsZXRlZCBp
dCdzIHJlZmVyZW5jZXMgKi8KKyAgICAgLyogbm93IGZvciB1cyAqLworI2Vu
ZGlmCit9CisgICAgICBicmVhazsKKyAgICBjYXNlIElQQ19TRVQ6CisgICAg
ZGVmYXVsdDoKKyAgICAgIHNldF9lcnJubyAoRUlOVkFMKTsKKyAgICAgIHJl
dHVybiAtMTsKKyAgICB9CisgIHJldHVybiAwOworfQorCisvKiBGSVhNRTog
ZXZhbHVhdGUgZ2V0dWlkKCkgYW5kIGdldGdpZCgpIGFnYWluc3QgdGhlIHJl
cXVlc3RlZCBtb2RlLiBUaGVuCisgKiBjaG9vc2UgUEFHRV9SRUFEV1JJVEUg
fCBQQUdFX1JFQURPTkxZIGFuZCBGSUxFX01BUF9XUklURSAgfCAgRklMRV9N
QVBfUkVBRAorICogYXBwcm9wcmlhdGVseQorICovCisKKy8qIFRlc3QgcmVz
dWx0IGZyb20gb3BlbmJzZDogc2htIGlkcyBhcmUgcGVyc2lzdGVudCBjcm9z
cyBwcm9jZXNzIGlmIGEgaGFuZGxlIGlzIGxlZnQKKyAqIG9wZW4uIFRoaXMg
Y291bGQgbGVhZCB0byByZXNvdXJjZSBzdGFydmF0aW9uOiB3ZSdyZSBub3Qg
Y29weWluZyB0aGF0IGJlaGF2aW91ciAKKyAqIHVubGVzcyB3ZSBoYXZlIHRv
LiAoSXQgd2lsbCBpbnZvbHZlIGFjeWd3aW4xLmRsbCBnbG9hbCBzaGFyZWQg
bGlzdCA6WyApLgorICovCisvKiBGSVhNRTogc2htaWQgc2hvdWxkIGJlIGEg
dmVyaWZ5YWJsZSBvYmplY3QKKyAqLworCisvKiBGSVhNRTogb24gTlQgd2Ug
c2hvdWxkIGNoZWNrIGV2ZXJ5dGhpbmcgYWdhaW5zdCB0aGUgU0QuIE9uIDk1
IHdlIGp1c3QgZW11bGF0ZS4KKyAqLworZXh0ZXJuICJDIiBpbnQKK3NobWdl
dCAoa2V5X3Qga2V5LCBzaXplX3Qgc2l6ZSwgaW50IHNobWZsZykKK3sKKyAg
RFdPUkQgc2Rfc2l6ZSA9IDQwOTY7CisgIGNoYXIgc2RfYnVmWzQwOTZdOwor
ICBQU0VDVVJJVFlfREVTQ1JJUFRPUiBwc2QgPSAoUFNFQ1VSSVRZX0RFU0NS
SVBUT1IpIHNkX2J1ZjsKKyAgLyogY3JlYXRlIGEgc2QgZm9yIG91ciBvcGVu
IHJlcXVlc3RzIGJhc2VkIG9uIHNobWZsYWcgJiAweDAxZmYgKi8KKyAgcHNk
ID0gYWxsb2Nfc2QgKGdldHVpZCAoKSwgZ2V0Z2lkICgpLCBjeWdoZWFwLT51
c2VyLmxvZ3NydiAoKSwKKwkJICBzaG1mbGcgJiAweDAxZmYsIHBzZCwgJnNk
X3NpemUpOworCisgIGlmIChrZXkgPT0gKGtleV90KSAtIDEpCisgICAgewor
ICAgICAgc2V0X2Vycm5vIChFTk9FTlQpOworICAgICAgcmV0dXJuIC0xOwor
ICAgIH0KKworICAvKiBGSVhNRTogZW50ZXIgdGhlIGNoZWNraW5nIGZvciBl
eGlzdGluZyBrZXlzIG11dGV4LiBUaGlzIG11dGV4IF9tdXN0XyBiZSBzeXN0
ZW0gd2lkZQorICAgKiB0byBwcmV2ZW50IHJhY2VzIG9uIHNobWdldC4KKyAg
ICovCisKKyAgLyogd2FsayB0aGUgbGlzdCBvZiBjdXJyZW50bHkgb3BlbiBr
ZXlzIGFuZCByZXR1cm4gdGhlIGlkIGlmIGZvdW5kCisgICAqLworICBzaG1u
b2RlICp0ZW1wbm9kZSA9IHNobV9oZWFkOworICB3aGlsZSAodGVtcG5vZGUp
CisgICAgeworICAgICAgaWYgKHRlbXBub2RlLT5rZXkgPT0ga2V5ICYmIGtl
eSAhPSBJUENfUFJJVkFURSkKKwl7CisJICAvLyBGSVhNRTogZnJlZSB0aGUg
bXV0ZXgKKwkgIGlmIChzaXplICYmIHRlbXBub2RlLT5zaG1kcy0+c2htX3Nl
Z3N6IDwgc2l6ZSkKKwkgICAgeworCSAgICAgIHNldF9lcnJubyAoRUlOVkFM
KTsKKwkgICAgICByZXR1cm4gLTE7CisJICAgIH0KKwkgIGlmICgoc2htZmxn
ICYgSVBDX0NSRUFUKSAmJiAoc2htZmxnICYgSVBDX0VYQ0wpKQorCSAgICB7
CisJICAgICAgc2V0X2Vycm5vIChFRVhJU1QpOworCSAgICAgIC8vIEZJWE1F
OiBmcmVlIHRoZSBtdXRleAorCSAgICAgIHJldHVybiAtMTsKKwkgICAgfQor
CSAgLy8gRklYTUU6IGRvIHdlIG5lZWQgdG8gb3RoZXIgdGVzdHMgb2YgdGhl
IHJlcXVlc3RlZCBtb2RlIHdpdGggdGhlCisJICAvLyB0ZW1wbm9kZS0+c2ht
aWQgbW9kZSA/IHRlc3RjYXNlIG9uIHVuaXggbmVlZGVkLgorCSAgLy8gRklY
TUUgZG8gd2UgbmVlZCBhIHNlY3VyaXR5IHRlc3Q/IFdlIGFyZSBvbmx5IGV4
YW1pbmluZyB0aGUga2V5cyB3ZSBhbHJlYWR5IGhhdmUgb3Blbi4KKwkgIC8v
IEZJWE1FOiB3aGF0IGFyZSB0aGUgc2VjIGltcGxpY2F0aW9ucyBmb3IgZm9y
ayAoKSBpZiB3ZSBkb24ndCBjaGVjayBoZXJlPworCSAgcmV0dXJuIHRlbXBu
b2RlLT5zaG1faWQ7CisJfQorICAgICAgdGVtcG5vZGUgPSB0ZW1wbm9kZS0+
bmV4dDsKKyAgICB9CisgIC8qIGNvdWxkbid0IGZpbmQgYSBjdXJyZW50bHkg
b3BlbiBzaG0gY29udHJvbCBhcmVhIGZvciB0aGUga2V5LgorICAgKiBBbGxv
Y2F0ZSBhIG5ldyBjb250cm9sIGJsb2NrIC0gdGhpcyBoYXMgdG8gYmUgaGFu
ZGxlZCBieSB0aGUgZGFlbW9uICovCisgIGNsaWVudF9yZXF1ZXN0X3NobV9n
ZXQgKnJlcSA9CisgICAgbmV3IGNsaWVudF9yZXF1ZXN0X3NobV9nZXQgKGtl
eSwgc2l6ZSwgc2htZmxnLCBzZF9idWYsCisJCQkJR2V0Q3VycmVudFByb2Nl
c3NJZCAoKSk7CisKKyAgaW50IHJjOworICBpZiAoKHJjID0gY3lnc2VydmVy
X3JlcXVlc3QgKHJlcSkpKQorICAgIHsKKyAgICAgIGRlbGV0ZSByZXE7Cisg
ICAgICBzZXRfZXJybm8gKEVOT1NZUyk7CS8qIGRhZW1vbiBjb21tdW5pY2F0
aW9uIGZhaWxlZCAqLworICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICBp
ZiAocmVxLT5oZWFkZXIuZXJyb3JfY29kZSkJLyogc2htX2dldCBmYWlsZWQg
aW4gdGhlIGRhZW1vbiAqLworICAgIHsKKyAgICAgIHNldF9lcnJubyAocmVx
LT5oZWFkZXIuZXJyb3JfY29kZSk7CisgICAgICBkZWxldGUgcmVxOworICAg
ICAgcmV0dXJuIC0xOworICAgIH0KKworICAvKiB3ZSd2ZSBnb3QgdGhlIGlk
LCBub3cgd2Ugb3BlbiB0aGUgbWVtb3J5IGFyZWEgb3Vyc2VsdmVzLgorICAg
KiBUaGlzIHRlc3RzIHNlY3VyaXR5IGF1dG9tYWdpY2FsbHkKKyAgICogRklY
TUU6IG1ha2UgdGhpcyBhIG1ldGhvZCBvZiBzaG1ub2RlID8KKyAgICovCisg
IHNobW5vZGUgKnNobXRlbXAgPSBidWlsZF9pbnByb2Nlc3Nfc2htZHMgKHJl
cS0+cGFyYW1ldGVycy5vdXQuZmlsZW1hcCwKKwkJCQkJICAgIHJlcS0+cGFy
YW1ldGVycy5vdXQuYXR0YWNobWFwLAorCQkJCQkgICAga2V5LAorCQkJCQkg
ICAgcmVxLT5wYXJhbWV0ZXJzLm91dC5zaG1faWQpOworICBkZWxldGUgcmVx
OworICBpZiAoc2htdGVtcCkKKyAgICByZXR1cm4gc2htdGVtcC0+c2htX2lk
OworICByZXR1cm4gLTE7CisKKworI2lmIDAKKyAgLyogZmlsbCBvdXQgdGhl
IG5vZGUgZGF0YSAqLworICBzaG10ZW1wLT5zaG1fcGVybS5jdWlkID0gZ2V0
dWlkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS51aWQgPSBzaG10ZW1wLT5z
aG1fcGVybS5jdWlkOworICBzaG10ZW1wLT5zaG1fcGVybS5jZ2lkID0gZ2V0
Z2lkICgpOworICBzaG10ZW1wLT5zaG1fcGVybS5naWQgPSBzaG10ZW1wLT5z
aG1fcGVybS5jZ2lkOworICBzaG10ZW1wLT5zaG1fcGVybS5tb2RlID0gc2ht
ZmxnICYgMHgwMWZmOworICBzaG10ZW1wLT5zaG1fbHBpZCA9IDA7CisgIHNo
bXRlbXAtPnNobV9uYXR0Y2ggPSAwOworICBzaG10ZW1wLT5zaG1fYXRpbWUg
PSAwOworICBzaG10ZW1wLT5zaG1fZHRpbWUgPSAwOworICBzaG10ZW1wLT5z
aG1fY3RpbWUgPSB0aW1lIChOVUxMKTsKKyAgc2htdGVtcC0+c2htX3NlZ3N6
ID0gc2l6ZTsKKyAgKihzaG1pZF9kcyAqKSBtYXBwdHIgPSAqc2htdGVtcDsK
KyAgc2htdGVtcC0+ZmlsZW1hcCA9IGZpbGVtYXA7CisgIHNobXRlbXAtPmF0
dGFjaG1hcCA9IGF0dGFjaG1hcDsKKyAgc2htdGVtcC0+bWFwcHRyID0gbWFw
cHRyOworCisjZW5kaWYKK30KSW5kZXg6IHNyYy93aW5zdXAvY3lnd2luL3R0
eS5jYwpkaWZmIC11IHNyYy93aW5zdXAvY3lnd2luL3R0eS5jYzoxLjI5IHNy
Yy93aW5zdXAvY3lnd2luL3R0eS5jYzoxLjI5LjIuMgotLS0gc3JjL3dpbnN1
cC9jeWd3aW4vdHR5LmNjOjEuMjkJV2VkIFNlcCAxMiAxMDo0NjozNiAyMDAx
CisrKyBzcmMvd2luc3VwL2N5Z3dpbi90dHkuY2MJU2F0IFNlcCAyOSAwMzo0
Nzo1OCAyMDAxCkBAIC0yMyw2ICsyMyw4IEBACiAjaW5jbHVkZSAic3luYy5o
IgogI2luY2x1ZGUgInNpZ3Byb2MuaCIKICNpbmNsdWRlICJwaW5mby5oIgor
I2luY2x1ZGUgImN5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0LmgiCisjaW5j
bHVkZSAiY3lnd2luL2N5Z3NlcnZlci5oIgogI2luY2x1ZGUgInNoYXJlZF9p
bmZvLmgiCiAKIGV4dGVybiBmaGFuZGxlcl90dHlfbWFzdGVyICp0dHlfbWFz
dGVyOwpAQCAtMzkyLDcgKzM5NCw3IEBACiAKICAgLyogQWxsb3cgdGhlIG90
aGVycyB0byBvcGVuIHVzIChmb3IgaGFuZGxlIGR1cGxpY2F0aW9uKSAqLwog
Ci0gIGlmICh3aW5jYXAuaGFzX3NlY3VyaXR5ICgpICYmCisgIGlmICh3aW5j
YXAuaGFzX3NlY3VyaXR5ICgpICYmIGN5Z3NlcnZlcl9ydW5uaW5nPT1DWUdT
RVJWRVJfT0sgJiYKICAgICAgIChTZXRLZXJuZWxPYmplY3RTZWN1cml0eSAo
aE1haW5Qcm9jLCBEQUNMX1NFQ1VSSVRZX0lORk9STUFUSU9OLAogCQkJICAg
ICAgIGdldF9udWxsX3NkICgpKSA9PSBGQUxTRSkpCiAgICAgc21hbGxfcHJp
bnRmICgiQ2FuJ3Qgc2V0IHByb2Nlc3Mgc2VjdXJpdHksICVFIik7CkluZGV4
OiBzcmMvd2luc3VwL2N5Z3dpbi93aW5zdXAuaApkaWZmIC11IHNyYy93aW5z
dXAvY3lnd2luL3dpbnN1cC5oOjEuNjkgc3JjL3dpbnN1cC9jeWd3aW4vd2lu
c3VwLmg6MS42OS4yLjEKLS0tIHNyYy93aW5zdXAvY3lnd2luL3dpbnN1cC5o
OjEuNjkJV2VkIFNlcCAxMiAxMDo0NjozNyAyMDAxCisrKyBzcmMvd2luc3Vw
L2N5Z3dpbi93aW5zdXAuaAlNb24gU2VwIDI0IDIzOjMxOjA0IDIwMDEKQEAg
LTY5LDYgKzY5LDggQEAKIGVudW0gY29kZXBhZ2VfdHlwZSB7YW5zaV9jcCwg
b2VtX2NwfTsKIGV4dGVybiBjb2RlcGFnZV90eXBlIGN1cnJlbnRfY29kZXBh
Z2U7CiAKK2V4dGVybiBpbnQgY3lnc2VydmVyX3J1bm5pbmc7CisKIC8qIFVz
ZWQgdG8gY2hlY2sgaWYgQ3lnd2luIERMTCBpcyBkeW5hbWljYWxseSBsb2Fk
ZWQuICovCiBleHRlcm4gaW50IGR5bmFtaWNhbGx5X2xvYWRlZDsKIApJbmRl
eDogc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9jeWd3aW4vY3lnc2VydmVy
LmgKZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVk
ZS9jeWd3aW4vY3lnc2VydmVyLmg6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlU
aHUgSmFuICAxIDAxOjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2lu
L2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlci5oCU1vbiBTZXAgMjQgMjM6MzE6
MDQgMjAwMQpAQCAtMCwwICsxLDEyNiBAQAorLyogY3lnc2VydmVyLmgKKwor
ICAgQ29weXJpZ2h0IDIwMDEgUmVkIEhhdCBJbmMuCisKKyAgIFdyaXR0ZW4g
YnkgRWdvciBEdWRhIDxkZW9AbG9nb3MtbS5ydT4KKworVGhpcyBmaWxlIGlz
IHBhcnQgb2YgQ3lnd2luLgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJp
Z2h0ZWQgd29yayBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCitD
eWd3aW4gbGljZW5zZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdX
SU5fTElDRU5TRSIgZm9yCitkZXRhaWxzLiAqLworCisjaWZuZGVmIF9DWUdT
RVJWRVJfSF8KKyNkZWZpbmUgX0NZR1NFUlZFUl9IXworCisjZGVmaW5lIE1B
WF9SRVFVRVNUX1NJWkUgMTI4CisKKyNkZWZpbmUgQ1lHV0lOX1NFUlZFUl9W
RVJTSU9OX01BSk9SCTEKKyNkZWZpbmUgQ1lHV0lOX1NFUlZFUl9WRVJTSU9O
X0FQSQkxCisjZGVmaW5lIENZR1dJTl9TRVJWRVJfVkVSU0lPTl9NSU5PUgkw
CisjZGVmaW5lIENZR1dJTl9TRVJWRVJfVkVSU0lPTl9QQVRDSAkwCisKKwor
dHlwZWRlZiBlbnVtIHsKKyAgQ1lHU0VSVkVSX1VOS05PV049MCwKKyAgQ1lH
U0VSVkVSX09LPTEsCisgIENZR1NFUlZFUl9ERUFEPTIKK30gY3lnc2VydmVy
X3N0YXRlczsKKwordHlwZWRlZiBlbnVtIHsKKyAgQ1lHU0VSVkVSX1JFUVVF
U1RfSU5WQUxJRCA9IDAsCisgIENZR1NFUlZFUl9SRVFVRVNUX0dFVF9WRVJT
SU9OLAorICBDWUdTRVJWRVJfUkVRVUVTVF9BVFRBQ0hfVFRZLAorICBDWUdT
RVJWRVJfUkVRVUVTVF9TSFVURE9XTiwKKyAgQ1lHU0VSVkVSX1JFUVVFU1Rf
U0hNX0dFVCwKKyAgQ1lHU0VSVkVSX1JFUVVFU1RfTEFTVAorfSBjeWdzZXJ2
ZXJfcmVxdWVzdF9jb2RlOworCitjbGFzcyByZXF1ZXN0X2hlYWRlcgorewor
ICBwdWJsaWM6CisgICAgc3NpemVfdCBjYjsKKyAgICBjeWdzZXJ2ZXJfcmVx
dWVzdF9jb2RlIHJlcV9pZDsKKyAgICBzc2l6ZV90IGVycm9yX2NvZGU7Cit9
CisjaWZkZWYgX19HTlVDX18KKyAgX19hdHRyaWJ1dGVfXyAoKHBhY2tlZCkp
CisjZW5kaWYKKzsKKworZXh0ZXJuIHZvaWQgY3lnc2VydmVyX2luaXQgKCk7
CisKKyNkZWZpbmUgSU5JVF9SRVFVRVNUKHJlcSxpZCkgXAorCShyZXEpLmhl
YWRlci5jYiA9IHNpemVvZiAocmVxKTsgXAorCShyZXEpLmhlYWRlci5yZXFf
aWQgPSBpZDsKKworc3RydWN0IHJlcXVlc3RfZ2V0X3ZlcnNpb24KK3sKKyAg
RFdPUkQgbWFqb3IsIGFwaSwgbWlub3IsIHBhdGNoOworfQorI2lmZGVmIF9f
R05VQ19fCisgIF9fYXR0cmlidXRlX18gKChwYWNrZWQpKQorI2VuZGlmCis7
CisKK3N0cnVjdCByZXF1ZXN0X3NodXRkb3duCit7CisgIGludCBmb287Cit9
CisjaWZkZWYgX19HTlVDX18KKyAgX19hdHRyaWJ1dGVfXyAoKHBhY2tlZCkp
CisjZW5kaWYKKzsKKworc3RydWN0IHJlcXVlc3RfYXR0YWNoX3R0eQorewor
ICBEV09SRCBwaWQsIG1hc3Rlcl9waWQ7CisgIEhBTkRMRSBmcm9tX21hc3Rl
ciwgdG9fbWFzdGVyOworfQorI2lmZGVmIF9fR05VQ19fCisgIF9fYXR0cmli
dXRlX18gKChwYWNrZWQpKQorI2VuZGlmCis7CisKK2NsYXNzIGNsaWVudF9y
ZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgY2xpZW50X3JlcXVlc3QgKGN5Z3Nl
cnZlcl9yZXF1ZXN0X2NvZGUgaWQpOworICB2aXJ0dWFsIHZvaWQgc2VuZCAo
dHJhbnNwb3J0X2xheWVyX2Jhc2UgKmNvbm4pOworICB2aXJ0dWFsIHZvaWQg
c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKSB7fTsKKyAgdmly
dHVhbCBvcGVyYXRvciBzdHJ1Y3QgcmVxdWVzdF9oZWFkZXIgKCk7CisgIGN5
Z3NlcnZlcl9yZXF1ZXN0X2NvZGUgcmVxX2lkICgpIHtyZXR1cm4gaGVhZGVy
LnJlcV9pZDt9OworICB2aXJ0dWFsIH5jbGllbnRfcmVxdWVzdCgpOworICBy
ZXF1ZXN0X2hlYWRlciBoZWFkZXI7CisgIGNoYXIgKmJ1ZmZlcjsKK307CisK
K2NsYXNzIGNsaWVudF9yZXF1ZXN0X2dldF92ZXJzaW9uIDogcHVibGljIGNs
aWVudF9yZXF1ZXN0Cit7CisgIHB1YmxpYzoKKyAgdmlydHVhbCB2b2lkIHNl
cnZlICh0cmFuc3BvcnRfbGF5ZXJfYmFzZSAqY29ubik7CisgIGNsaWVudF9y
ZXF1ZXN0X2dldF92ZXJzaW9uOjpjbGllbnRfcmVxdWVzdF9nZXRfdmVyc2lv
bigpOworICBzdHJ1Y3QgcmVxdWVzdF9nZXRfdmVyc2lvbiB2ZXJzaW9uOwor
fTsKKworY2xhc3MgY2xpZW50X3JlcXVlc3Rfc2h1dGRvd24gOiBwdWJsaWMg
Y2xpZW50X3JlcXVlc3QKK3sKKyAgcHVibGljOgorICB2aXJ0dWFsIHZvaWQg
c2VydmUgKHRyYW5zcG9ydF9sYXllcl9iYXNlICpjb25uKTsKKyAgY2xpZW50
X3JlcXVlc3Rfc2h1dGRvd24gKCk7Cit9OworCitjbGFzcyBjbGllbnRfcmVx
dWVzdF9hdHRhY2hfdHR5IDogcHVibGljIGNsaWVudF9yZXF1ZXN0Cit7Cisg
IHB1YmxpYzoKKyAgdmlydHVhbCB2b2lkIHNlcnZlICh0cmFuc3BvcnRfbGF5
ZXJfYmFzZSAqY29ubik7CisgIGNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkg
KCk7CisgIGNsaWVudF9yZXF1ZXN0X2F0dGFjaF90dHkgKERXT1JEIG5waWQs
IERXT1JEIG5tYXN0ZXJfcGlkLCBIQU5ETEUgbmZyb21fbWFzdGVyLCBIQU5E
TEUgbnRvX21hc3Rlcik7CisgIEhBTkRMRSBmcm9tX21hc3RlciAoKSB7cmV0
dXJuIHJlcS5mcm9tX21hc3Rlcjt9OworICBIQU5ETEUgdG9fbWFzdGVyICgp
IHtyZXR1cm4gcmVxLnRvX21hc3Rlcjt9OworICBzdHJ1Y3QgcmVxdWVzdF9h
dHRhY2hfdHR5IHJlcTsKK307CisKK2V4dGVybiBpbnQgY3lnc2VydmVyX3Jl
cXVlc3QgKGNsaWVudF9yZXF1ZXN0ICopOworCisjZW5kaWYgLyogX0NZR1NF
UlZFUitIKyAqLwpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9j
eWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oCmRpZmYgLXUgL2Rldi9udWxs
IHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90
cmFuc3BvcnQuaDoxLjEuMi4yCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEg
MDE6MDA6MDAgMTk3MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9j
eWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydC5oCVNhdCBTZXAgMjkgMDM6NDc6
NTkgMjAwMQpAQCAtMCwwICsxLDIwIEBACisjaWZuZGVmIF9DWUdTRVJWRVJf
VFJBTlNQT1JUXworI2RlZmluZSBfQ1lHU0VSVkVSX1RSQU5TUE9SVF8KK2Ns
YXNzIHRyYW5zcG9ydF9sYXllcl9iYXNlICpjcmVhdGVfc2VydmVyX3RyYW5z
cG9ydCgpOworCisvKiB0aGUgYmFzZSBjbGFzcyBkb2VzIG5vdGhpbmcuICov
CitjbGFzcyB0cmFuc3BvcnRfbGF5ZXJfYmFzZQoreworICBwdWJsaWM6Cisg
ICAgdmlydHVhbCB2b2lkIGxpc3RlbiAoKTsKKyAgICB2aXJ0dWFsIGNsYXNz
IHRyYW5zcG9ydF9sYXllcl9iYXNlICogYWNjZXB0ICgpOworICAgIHZpcnR1
YWwgdm9pZCBjbG9zZSAoKTsKKyAgICB2aXJ0dWFsIHNzaXplX3QgcmVhZCAo
Y2hhciAqYnVmLCBzaXplX3QgbGVuKTsKKyAgICB2aXJ0dWFsIHNzaXplX3Qg
d3JpdGUgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7CisgICAgdmlydHVhbCBi
b29sIGNvbm5lY3QoKTsKKyAgICB2aXJ0dWFsIHZvaWQgaW1wZXJzb25hdGVf
Y2xpZW50ICgpOworICAgIHZpcnR1YWwgdm9pZCByZXZlcnRfdG9fc2VsZiAo
KTsKKyAgICB0cmFuc3BvcnRfbGF5ZXJfYmFzZSAoKTsKK307CisKKyNlbmRp
ZiAvKiBfQ1lHU0VSVkVSX1RSQU5TUE9SVF8gKi8KSW5kZXg6IHNyYy93aW5z
dXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZlcl90cmFuc3BvcnRf
cGlwZXMuaApkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2luc3VwL2N5Z3dpbi9p
bmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0X3BpcGVzLmg6MS4x
LjIuMQotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAwOjAwIDE5NzAK
KysrIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvY3lnd2luL2N5Z3NlcnZl
cl90cmFuc3BvcnRfcGlwZXMuaAlTYXQgU2VwIDI5IDAzOjQ3OjU5IDIwMDEK
QEAgLTAsMCArMSwyNyBAQAorI2lmbmRlZiBfQ1lHU0VSVkVSX1RSQU5TUE9S
VF9QSVBFU18KKyNkZWZpbmUgX0NZR1NFUlZFUl9UUkFOU1BPUlRfUElQRVNf
CisvKiBOYW1lZCBwaXBlcyBiYXNlZCB0cmFuc3BvcnQsIGZvciBzZWN1cml0
eSBvbiBOVCAqLworY2xhc3MgdHJhbnNwb3J0X2xheWVyX3BpcGVzIDogcHVi
bGljIHRyYW5zcG9ydF9sYXllcl9iYXNlCit7CisgIHB1YmxpYzoKKyAgICB2
aXJ0dWFsIHZvaWQgbGlzdGVuICgpOworICAgIHZpcnR1YWwgY2xhc3MgdHJh
bnNwb3J0X2xheWVyX3BpcGVzICogYWNjZXB0ICgpOworICAgIHZpcnR1YWwg
dm9pZCBjbG9zZSAoKTsKKyAgICB2aXJ0dWFsIHNzaXplX3QgcmVhZCAoY2hh
ciAqYnVmLCBzaXplX3QgbGVuKTsKKyAgICB2aXJ0dWFsIHNzaXplX3Qgd3Jp
dGUgKGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7CisgICAgdmlydHVhbCBib29s
IGNvbm5lY3QoKTsKKyAgICB2aXJ0dWFsIHZvaWQgaW1wZXJzb25hdGVfY2xp
ZW50ICgpOworICAgIHZpcnR1YWwgdm9pZCByZXZlcnRfdG9fc2VsZiAoKTsK
KyAgICB0cmFuc3BvcnRfbGF5ZXJfcGlwZXMgKCk7CisKKyAgcHJpdmF0ZToK
KyAgICAvKiBmb3IgcGlwZSBiYXNlZCBjb21tdW5pY2F0aW9ucyAqLworICAg
IHZvaWQgaW5pdF9zZWN1cml0eSAoKTsKKyAgICBTRUNVUklUWV9ERVNDUklQ
VE9SIHNkOworICAgIFNFQ1VSSVRZX0FUVFJJQlVURVMgc2VjX25vbmVfbmlo
LCBzZWNfYWxsX25paDsKKyAgICBjaGFyIHBpcGVfbmFtZSBbTUFYX1BBVEhd
OworICAgIEhBTkRMRSBwaXBlOworICAgIGJvb2wgaW5pdGVkOworICAgIHRy
YW5zcG9ydF9sYXllcl9waXBlcyAoSEFORExFIG5ld19waXBlKTsKK307Cisj
ZW5kaWYgLyogX0NZR1NFUlZFUl9UUkFOU1BPUlRfUElQRVNfICovCkluZGV4
OiBzcmMvd2luc3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJf
dHJhbnNwb3J0X3NvY2tldHMuaApkaWZmIC11IC9kZXYvbnVsbCBzcmMvd2lu
c3VwL2N5Z3dpbi9pbmNsdWRlL2N5Z3dpbi9jeWdzZXJ2ZXJfdHJhbnNwb3J0
X3NvY2tldHMuaDoxLjEuMi4xCi0tLSAvZGV2L251bGwJCVRodSBKYW4gIDEg
MDE6MDA6MDAgMTk3MAorKysgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9j
eWd3aW4vY3lnc2VydmVyX3RyYW5zcG9ydF9zb2NrZXRzLmgJU2F0IFNlcCAy
OSAwMzo0Nzo1OSAyMDAxCkBAIC0wLDAgKzEsMjEgQEAKKyNpZm5kZWYgX0NZ
R1NFUlZFUl9UUkFOU1BPUlRfU09DS0VUU18KKyNkZWZpbmUgX0NZR1NFUlZF
Ul9UUkFOU1BPUlRfU09DS0VUU18KK2NsYXNzIHRyYW5zcG9ydF9sYXllcl9z
b2NrZXRzIDogcHVibGljIHRyYW5zcG9ydF9sYXllcl9iYXNlCit7CisgIHB1
YmxpYzoKKyAgICB2aXJ0dWFsIHZvaWQgbGlzdGVuICgpOworICAgIHZpcnR1
YWwgY2xhc3MgdHJhbnNwb3J0X2xheWVyX3NvY2tldHMgKiBhY2NlcHQgKCk7
CisgICAgdmlydHVhbCB2b2lkIGNsb3NlICgpOworICAgIHZpcnR1YWwgc3Np
emVfdCByZWFkIChjaGFyICpidWYsIHNpemVfdCBsZW4pOworICAgIHZpcnR1
YWwgc3NpemVfdCB3cml0ZSAoY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKKyAg
ICB2aXJ0dWFsIGJvb2wgY29ubmVjdCgpOworICAgIHRyYW5zcG9ydF9sYXll
cl9zb2NrZXRzICgpOworCisgIHByaXZhdGU6CisgICAgLyogZm9yIHNvY2tl
dCBiYXNlZCBjb21tdW5pY2F0aW9ucyAqLworICAgIGludCBmZDsKKyAgICBz
dHJ1Y3Qgc29ja2FkZHIgc29ja2RldGFpbHM7CisgICAgaW50IHNkbGVuOwor
ICAgIHRyYW5zcG9ydF9sYXllcl9zb2NrZXRzIChpbnQgbmV3ZmQpOworfTsK
KyNlbmRpZiAvKiBfQ1lHU0VSVkVSX1RSQU5TUE9SVF9TT0NLRVRTXyAqLwpJ
bmRleDogc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9zeXMvaXBjLmgKZGlm
ZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9zeXMv
aXBjLmg6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAxOjAw
OjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lzL2lw
Yy5oCU1vbiBTZXAgMjQgMjM6MzE6MDUgMjAwMQpAQCAtMCwwICsxLDUyIEBA
CisvKiBzeXMvaXBjLmgKKworICAgQ29weXJpZ2h0IDIwMDEgUmVkIEhhdCBJ
bmMuIAorICAgV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29sbGlu
c0Bob3RtYWlsLmNvbT4KKworVGhpcyBmaWxlIGlzIHBhcnQgb2YgQ3lnd2lu
LgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29yayBsaWNl
bnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCitDeWd3aW4gbGljZW5zZS4g
IFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdXSU5fTElDRU5TRSIgZm9y
CitkZXRhaWxzLiAqLworCisjaWZkZWYgX19jcGx1c3BsdXMKK2V4dGVybiAi
QyIKK3sKKyNlbmRpZgorCisjaWZuZGVmIF9TWVNfSVBDX0gKKyNkZWZpbmUg
X1NZU19JUENfSAorCisvKiBzeXMvdHlwZXMgbXVzdCBiZSBpbmNsdWRlZCBi
ZWZvcmUgc3lzL2lwYy5oLiBXZSBhcmVuJ3QgbWVhbnQgdG8gYXV0b21hdGlj
YWxseSAKKyAqIGluY2x1ZGUgaXQgaG93ZXZlciAKKyAqLworCitzdHJ1Y3Qg
aXBjX3Blcm0geworICB1aWRfdCAgdWlkOworICBnaWRfdCAgZ2lkOworICB1
aWRfdCAgY3VpZDsKKyAgZ2lkX3QgIGNnaWQ7CisgIG1vZGVfdCBtb2RlOwor
fTsgCisKKy8qIHRoZSBtb2RlIGZsYWdzIHVzZWQgd2l0aCB0aGUgX2dldCBm
dW5jdGlvbnMgdXNlIHRoZSBsb3cgb3JkZXIgOSBiaXRzIGZvciBhIG1vZGUg
CisgKiByZXF1ZXN0CisgKi8KKyNkZWZpbmUgSVBDX0NSRUFUICAweDAyMDAK
KyNkZWZpbmUgSVBDX0VYQ0wgICAweDA0MDAKKyNkZWZpbmUgSVBDX05PV0FJ
VCAweDA4MDAKKworLyogdGhpcyBpcyBhIHZhbHVlIHRoYXQgd2lsbCBfbmV2
ZXJfIGJlIGEgdmFsaWQga2V5IGZyb20gZnRvayAqLworI2RlZmluZSBJUENf
UFJJVkFURSAtMgorCisjZGVmaW5lIElQQ19STUlEIDB4MDAwMworI2RlZmlu
ZSBJUENfU0VUICAweDAwMDIKKyNkZWZpbmUgSVBDX1NUQVQgMHgwMDAxCisK
K2tleV90IGZ0b2soY29uc3QgY2hhciAqLCBpbnQpOworCisjZW5kaWYgLyog
X1NZU19JUENfSCAqLworCisjaWZkZWYgX19jcGx1c3BsdXMKK30KKyNlbmRp
ZgpJbmRleDogc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9zeXMvc2htLmgK
ZGlmZiAtdSAvZGV2L251bGwgc3JjL3dpbnN1cC9jeWd3aW4vaW5jbHVkZS9z
eXMvc2htLmg6MS4xLjIuMQotLS0gL2Rldi9udWxsCQlUaHUgSmFuICAxIDAx
OjAwOjAwIDE5NzAKKysrIHNyYy93aW5zdXAvY3lnd2luL2luY2x1ZGUvc3lz
L3NobS5oCU1vbiBTZXAgMjQgMjM6MzE6MDUgMjAwMQpAQCAtMCwwICsxLDg5
IEBACisvKiBzeXMvc2htLmgKKworICAgQ29weXJpZ2h0IDIwMDEgUmVkIEhh
dCBJbmMuIAorICAgV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29s
bGluc0Bob3RtYWlsLmNvbT4KKworVGhpcyBmaWxlIGlzIHBhcnQgb2YgQ3ln
d2luLgorCitUaGlzIHNvZnR3YXJlIGlzIGEgY29weXJpZ2h0ZWQgd29yayBs
aWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCitDeWd3aW4gbGljZW5z
ZS4gIFBsZWFzZSBjb25zdWx0IHRoZSBmaWxlICJDWUdXSU5fTElDRU5TRSIg
Zm9yCitkZXRhaWxzLiAqLworCisjaWZkZWYgX19jcGx1c3BsdXMKK2V4dGVy
biAiQyIKK3sKKyNlbmRpZgorCisjaWZuZGVmIF9TWVNfU0hNX0gKKyNkZWZp
bmUgX1NZU19TSE1fSAorCisjaW5jbHVkZSA8c3lzL2lwYy5oPgorCisjZGVm
aW5lIFNITV9SRE9OTFkgMQorLyogNjQgS2Igd2FzIGhhcmRjb2RlZCBmb3Ig
eDg2LiBNUyBzdGF0ZXMgdGhpcyBtYXkgY2hhbmdlLCBidXQgd2UgbmVlZCBp
dCBpbiB0aGUgaGVhZGVyCisgKiBmaWxlLgorICovCisjZGVmaW5lIFNITUxC
QSAgICAgNjU1MzYKKyNkZWZpbmUgU0hNX1JORAkgICAxCisKK3R5cGVkZWYg
bG9uZyBpbnQgc2htYXR0X3Q7CisKKyNpZiBkZWZpbmVkKF9fSU5TSURFX0NZ
R1dJTl9fKSAmJiBkZWZpbmVkKF9fY3BsdXNwbHVzKQorCitjbGFzcyBfc2ht
YXR0YWNoIHsKK3B1YmxpYzoKKyAgdm9pZCAqZGF0YTsKKyAgaW50IHNobWZs
ZzsKKyAgY2xhc3MgX3NobWF0dGFjaCAqbmV4dDsKK307CisKK2NsYXNzIHNo
bWlkX2RzIHsKK3B1YmxpYzoKKyAgc3RydWN0ICAgaXBjX3Blcm0gc2htX3Bl
cm07CisgIHNpemVfdCAgIHNobV9zZWdzejsKKyAgcGlkX3QgICAgc2htX2xw
aWQ7CisgIHBpZF90ICAgIHNobV9jcGlkOworICBzaG1hdHRfdCBzaG1fbmF0
dGNoOworICB0aW1lX3QgICBzaG1fYXRpbWU7CisgIHRpbWVfdCAgIHNobV9k
dGltZTsKKyAgdGltZV90ICAgc2htX2N0aW1lOworICB2b2lkICptYXBwdHI7
Cit9OworCitjbGFzcyBzaG1ub2RlIHsKK3B1YmxpYzoKKyAgY2xhc3Mgc2ht
aWRfZHMgKiBzaG1kczsKKyAgaW50IHNobV9pZDsKKyAgY2xhc3Mgc2htbm9k
ZSAqbmV4dDsKKyAga2V5X3Qga2V5OworICBIQU5ETEUgZmlsZW1hcDsKKyAg
SEFORExFIGF0dGFjaG1hcDsKKyAgY2xhc3MgX3NobWF0dGFjaCAqYXR0YWNo
aGVhZDsKK307CisKKyNlbHNlCisvKiB0aGlzIGlzIHdoYXQgd2UgcmV0dXJu
IHdoZW4gcXVlcmllZC4gSXQgaGFzIG5vIGJpdHdpc2UgY29ycmVzcG9uZGVu
Y2UKKyAqIHRoZSBpbnRlcm5hbCBzdHJ1Y3R1cmVzIAorICovCitzdHJ1Y3Qg
c2htaWRfZHMgeworICBzdHJ1Y3QgICBpcGNfcGVybSBzaG1fcGVybTsKKyAg
c2l6ZV90ICAgc2htX3NlZ3N6OworICBwaWRfdCAgICBzaG1fbHBpZDsKKyAg
cGlkX3QgICAgc2htX2NwaWQ7CisgIHNobWF0dF90IHNobV9uYXR0Y2g7Cisg
IHRpbWVfdCAgIHNobV9hdGltZTsKKyAgdGltZV90ICAgc2htX2R0aW1lOwor
ICB0aW1lX3QgICBzaG1fY3RpbWU7Cit9OworI2VuZGlmIC8qIF9fSU5TSURF
X0NZR1dJTl9fICovCisKK3ZvaWQgKnNobWF0KGludCwgY29uc3Qgdm9pZCAq
LCBpbnQpOworaW50ICAgc2htY3RsKGludCwgaW50LCBzdHJ1Y3Qgc2htaWRf
ZHMgKik7CitpbnQgICBzaG1kdChjb25zdCB2b2lkICopOworaW50ICAgc2ht
Z2V0KGtleV90LCBzaXplX3QsIGludCk7CisKKyNlbmRpZiAvKiBfU1lTX1NI
TV9IICovCisKKyNpZmRlZiBfX2NwbHVzcGx1cworfQorI2VuZGlmCg==

------------=_1583532849-65438-111--
