Return-Path: <cygwin-patches-return-5745-listarch-cygwin-patches=sources.redhat.com@cygwin.com>
Received: (qmail 26338 invoked by alias); 13 Feb 2006 18:44:41 -0000
Received: (qmail 26325 invoked by uid 22791); 13 Feb 2006 18:44:38 -0000
X-Spam-Check-By: sourceware.org
Received: from ACCESS1.CIMS.NYU.EDU (HELO access1.cims.nyu.edu) (128.122.81.155)     by sourceware.org (qpsmtpd/0.31) with ESMTP; Mon, 13 Feb 2006 18:44:36 +0000
Received: from localhost (localhost [127.0.0.1]) 	by access1.cims.nyu.edu (8.12.10+Sun/8.12.10) with ESMTP id k1DIiTA7023830 	for <cygwin-patches@cygwin.com>; Mon, 13 Feb 2006 13:44:29 -0500 (EST)
Date: Mon, 13 Feb 2006 18:44:00 -0000
From: Igor Peshansky <pechtcha@cs.nyu.edu>
Reply-To: cygwin-patches@cygwin.com
To: cygwin-patches@cygwin.com
Subject: [PATCH] cygcheck: follow symbolic links
Message-ID: <Pine.GSO.4.63.0602131341020.17217@access1.cims.nyu.edu>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-559023410-1483920592-1139856269=:17217"
X-IsSubscribed: yes
Mailing-List: contact cygwin-patches-help@cygwin.com; run by ezmlm
Precedence: bulk
List-Subscribe: <mailto:cygwin-patches-subscribe@cygwin.com>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Archive: <http://sourceware.org/ml/cygwin-patches/>
List-Help: <mailto:cygwin-patches-help@cygwin.com>, <http://sourceware.org/ml/#faqs>
Sender: cygwin-patches-owner@cygwin.com
X-SW-Source: 2006-q1/txt/msg00054.txt.bz2

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---559023410-1483920592-1139856269=:17217
Content-Type: TEXT/PLAIN; charset=US-ASCII
Content-length: 1344

As promised in <http://cygwin.com/ml/cygwin/2006-02/msg00071.html>, the
attached patch teaches cygcheck to follow symlinks when looking for
executables, and also flags scripts.  Sorry, had legal delays in sending
this (as you can see, I had this working since 02/03).  Comments welcome.
	Igor

2006-02-03  Igor Peshansky  <pechtcha@cs.nyu.edu>

	* cygcheck.cc (LINK_EXTENSION): New macro.
	(check_existence): New static function.
	(find_on_path): Check for symbolic links if asked.
	(EXE_MAGIC,SHORTCUT_MAGIC,SYMLINK_COOKIE,SYMLINK_MAGIC): New
	macros.
	(is_exe,is_symlink,readlink): New static functions.
	(track_down): Only call dll_info() for executables, display
	an error for symlinks, and print magic number for others.
	(find_app_on_path): New static function.
	(cygcheck, dump_sysinfo): Call find_app_on_path() instead of
	find_on_path().

-- 
				http://cs.nyu.edu/~pechtcha/
      |\      _,,,---,,_	    pechtcha@cs.nyu.edu | igor@watson.ibm.com
ZZZzz /,`.-'`'    -.  ;-;;,_		Igor Peshansky, Ph.D. (name changed!)
     |,4-  ) )-,_. ,\ (  `'-'		old name: Igor Pechtchanski
    '---''(_/--'  `-'\_) fL	a.k.a JaguaR-R-R-r-r-r-.-.-.  Meow!

"Las! je suis sot... -Mais non, tu ne l'es pas, puisque tu t'en rends compte."
"But no -- you are no fool; you call yourself a fool, there's proof enough in
that!" -- Rostand, "Cyrano de Bergerac"
---559023410-1483920592-1139856269=:17217
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=cygcheck-follow-symlinks.patch
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.GSO.4.63.0602131344290.17217@access1.cims.nyu.edu>
Content-Description: 
Content-Disposition: attachment; filename=cygcheck-follow-symlinks.patch
Content-length: 11521

SW5kZXg6IHdpbnN1cC91dGlscy9jeWdjaGVjay5jYw0KPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PQ0KUkNTIGZpbGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvdXRp
bHMvY3lnY2hlY2suY2Msdg0KcmV0cmlldmluZyByZXZpc2lvbiAxLjg4DQpk
aWZmIC11IC1wIC1yMS44OCBjeWdjaGVjay5jYw0KLS0tIHdpbnN1cC91dGls
cy9jeWdjaGVjay5jYwkxOSBKYW4gMjAwNiAyMToxNjozOCAtMDAwMAkxLjg4
DQorKysgd2luc3VwL3V0aWxzL2N5Z2NoZWNrLmNjCTMgRmViIDIwMDYgMTc6
NDA6MzQgLTAwMDANCkBAIC0yNDksOSArMjQ5LDQxIEBAIGluaXRfcGF0aHMg
KCkNCiAgICAgfQ0KIH0NCiANCisjZGVmaW5lIExJTktfRVhURU5TSU9OICIu
bG5rIg0KKw0KK3N0YXRpYyBib29sDQorY2hlY2tfZXhpc3RlbmNlIChjaGFy
ICpmaWxlLCBpbnQgc2hvd2FsbCwgaW50IGZvdW5kb25lLCBjaGFyICpmaXJz
dCkNCit7DQorICBpZiAoR2V0RmlsZUF0dHJpYnV0ZXMgKGZpbGUpICE9IChE
V09SRCkgLSAxKQ0KKyAgICB7DQorICAgICAgY2hhciAqbGFzdGRvdCA9IHN0
cnJjaHIgKGZpbGUsICcuJyk7DQorICAgICAgYm9vbCBpc19saW5rID0gbGFz
dGRvdCAmJiAhc3RyY21wIChsYXN0ZG90LCBMSU5LX0VYVEVOU0lPTik7DQor
ICAgICAgLy8gSWYgZmlsZSBpcyBhIGxpbmssIGZpeCB1cCB0aGUgZXh0ZW5z
aW9uIGJlZm9yZSBwcmludGluZw0KKyAgICAgIGlmIChpc19saW5rKQ0KKwkq
bGFzdGRvdCA9ICdcMCc7DQorICAgICAgaWYgKHNob3dhbGwpDQorCXByaW50
ZiAoIkZvdW5kOiAlc1xuIiwgZmlsZSk7DQorICAgICAgaWYgKGZvdW5kb25l
KQ0KKwl7DQorCSAgY2hhciAqZmxhc3Rkb3QgPSBzdHJyY2hyIChmaXJzdCwg
Jy4nKTsNCisJICBib29sIGZfaXNfbGluayA9IGZsYXN0ZG90ICYmICFzdHJj
bXAgKGZsYXN0ZG90LCBMSU5LX0VYVEVOU0lPTik7DQorCSAgLy8gaWYgZmly
c3QgaXMgYSBsaW5rLCBmaXggdXAgdGhlIGV4dGVuc2lvbiBiZWZvcmUgcHJp
bnRpbmcNCisJICBpZiAoZl9pc19saW5rKQ0KKwkgICAgKmZsYXN0ZG90ID0g
J1wwJzsNCisJICBwcmludGYgKCJXYXJuaW5nOiAlcyBoaWRlcyAlc1xuIiwg
Zmlyc3QsIGZpbGUpOw0KKwkgIGlmIChmX2lzX2xpbmspDQorCSAgICAqZmxh
c3Rkb3QgPSAnLic7DQorCX0NCisgICAgICBpZiAoaXNfbGluaykNCisJKmxh
c3Rkb3QgPSAnLic7DQorICAgICAgcmV0dXJuIHRydWU7DQorICAgIH0NCisg
IHJldHVybiBmYWxzZTsNCit9DQorDQogc3RhdGljIGNoYXIgKg0KIGZpbmRf
b25fcGF0aCAoY2hhciAqZmlsZSwgY2hhciAqZGVmYXVsdF9leHRlbnNpb24s
DQotCSAgICAgIGludCBzaG93YWxsID0gMCwgaW50IHNlYXJjaF9zeXNkaXJz
ID0gMCkNCisJICAgICAgaW50IHNob3dhbGwgPSAwLCBpbnQgc2VhcmNoX3N5
c2RpcnMgPSAwLCBpbnQgY2hlY2tsaW5rcyA9IDApDQogew0KICAgc3RhdGlj
IGNoYXIgcnZbNDAwMF07DQogICBjaGFyIHRtcFs0MDAwXSwgKnB0ciA9IHJ2
Ow0KQEAgLTI3MCwxMSArMzAyLDIxIEBAIGZpbmRfb25fcGF0aCAoY2hhciAq
ZmlsZSwgY2hhciAqZGVmYXVsdF8NCiANCiAgIGlmIChzdHJjaHIgKGZpbGUs
ICc6JykgfHwgc3RyY2hyIChmaWxlLCAnXFwnKSB8fCBzdHJjaHIgKGZpbGUs
ICcvJykpDQogICAgIHsNCisgICAgICAvLyBGSVhNRTogdGhpcyB3aWxsIGZp
bmQgImZvbyIgYmVmb3JlICJmb28uZXhlIiAtLSBjb250cmFyeSB0byBXaW5k
b3dzDQogICAgICAgY2hhciAqZm4gPSBjeWdwYXRoIChmaWxlLCBOVUxMKTsN
CiAgICAgICBpZiAoYWNjZXNzIChmbiwgRl9PSykgPT0gMCkNCiAJcmV0dXJu
IGZuOw0KICAgICAgIHN0cmNweSAocnYsIGZuKTsNCiAgICAgICBzdHJjYXQg
KHJ2LCBkZWZhdWx0X2V4dGVuc2lvbik7DQorICAgICAgaWYgKGFjY2VzcyAo
cnYsIEZfT0spID09IDApDQorCXJldHVybiBydjsNCisgICAgICBpZiAoIWNo
ZWNrbGlua3MpDQorCXJldHVybiBmbjsNCisgICAgICBzdHJjYXQgKHJ2LCBM
SU5LX0VYVEVOU0lPTik7DQorICAgICAgaWYgKGFjY2VzcyAocnYsIEZfT0sp
ID09IDApDQorCXJldHVybiBydjsNCisgICAgICBzdHJjcHkgKHJ2LCBmbik7
DQorICAgICAgc3RyY2F0IChydiwgTElOS19FWFRFTlNJT04pOw0KICAgICAg
IHJldHVybiBhY2Nlc3MgKHJ2LCBGX09LKSA9PSAwID8gcnYgOiBmbjsNCiAg
ICAgfQ0KIA0KQEAgLTI4NiwxNCArMzI4LDI1IEBAIGZpbmRfb25fcGF0aCAo
Y2hhciAqZmlsZSwgY2hhciAqZGVmYXVsdF8NCiAgICAgICBpZiAoaSA9PSAw
IHx8ICFzZWFyY2hfc3lzZGlycyB8fCBzdHJjYXNlY21wIChwYXRoc1tpXSwg
cGF0aHNbMF0pKQ0KIAl7DQogCSAgc3ByaW50ZiAocHRyLCAiJXNcXCVzJXMi
LCBwYXRoc1tpXSwgZmlsZSwgZGVmYXVsdF9leHRlbnNpb24pOw0KLQkgIGlm
IChHZXRGaWxlQXR0cmlidXRlcyAocHRyKSAhPSAoRFdPUkQpIC0gMSkNCi0J
ICAgIHsNCi0JICAgICAgaWYgKHNob3dhbGwpDQotCQlwcmludGYgKCJGb3Vu
ZDogJXNcbiIsIHB0cik7DQotCSAgICAgIGlmIChwdHIgPT0gdG1wICYmIHZl
cmJvc2UpDQotCQlwcmludGYgKCJXYXJuaW5nOiAlcyBoaWRlcyAlc1xuIiwg
cnYsIHB0cik7DQotCSAgICAgIHB0ciA9IHRtcDsNCi0JICAgIH0NCisJICBp
ZiAoY2hlY2tfZXhpc3RlbmNlIChwdHIsIHNob3dhbGwsIHB0ciA9PSB0bXAg
JiYgdmVyYm9zZSwgcnYpKQ0KKwkgICAgcHRyID0gdG1wOw0KKw0KKwkgIGlm
ICghY2hlY2tsaW5rcykNCisJICAgIGNvbnRpbnVlOw0KKw0KKwkgIHNwcmlu
dGYgKHB0ciwgIiVzXFwlcyVzJXMiLCBwYXRoc1tpXSwgZmlsZSwgZGVmYXVs
dF9leHRlbnNpb24sIExJTktfRVhURU5TSU9OKTsNCisJICBpZiAoY2hlY2tf
ZXhpc3RlbmNlIChwdHIsIHNob3dhbGwsIHB0ciA9PSB0bXAgJiYgdmVyYm9z
ZSwgcnYpKQ0KKwkgICAgcHRyID0gdG1wOw0KKw0KKwkgIGlmICghKmRlZmF1
bHRfZXh0ZW5zaW9uKQ0KKwkgICAgY29udGludWU7DQorDQorCSAgc3ByaW50
ZiAocHRyLCAiJXNcXCVzIiwgcGF0aHNbaV0sIGZpbGUpOw0KKwkgIGlmIChj
aGVja19leGlzdGVuY2UgKHB0ciwgc2hvd2FsbCwgcHRyID09IHRtcCAmJiB2
ZXJib3NlLCBydikpDQorCSAgICBwdHIgPSB0bXA7DQorCSAgc3ByaW50ZiAo
cHRyLCAiJXNcXCVzJXMiLCBwYXRoc1tpXSwgZmlsZSwgTElOS19FWFRFTlNJ
T04pOw0KKwkgIGlmIChjaGVja19leGlzdGVuY2UgKHB0ciwgc2hvd2FsbCwg
cHRyID09IHRtcCAmJiB2ZXJib3NlLCBydikpDQorCSAgICBwdHIgPSB0bXA7
DQogCX0NCiAgICAgfQ0KIA0KQEAgLTYxMCw2ICs2NjMsMTAxIEBAIGRsbF9p
bmZvIChjb25zdCBjaGFyICpwYXRoLCBIQU5ETEUgZmgsIGkNCiAgICAgY3ln
d2luX2luZm8gKGZoKTsNCiB9DQogDQorLyogVE9ETzogc2hvdWxkIHRoZSB0
aHJlZSBmdW5jdGlvbnMgYmVsb3cgZ28gaW50byBwYXRoLmNjPyAqLw0KKw0K
KyNkZWZpbmUgRVhFX01BR0lDICgoaW50KSoodW5zaWduZWQgc2hvcnQgKiki
TVoiKQ0KKyNkZWZpbmUgU0hPUlRDVVRfTUFHSUMgKChpbnQpKih1bnNpZ25l
ZCBzaG9ydCAqKSJMXDAiKQ0KKyNkZWZpbmUgU1lNTElOS19DT09LSUUgIiE8
c3ltbGluaz4iDQorI2RlZmluZSBTWU1MSU5LX01BR0lDICgoaW50KSoodW5z
aWduZWQgc2hvcnQgKilTWU1MSU5LX0NPT0tJRSkNCisNCitzdGF0aWMgYm9v
bA0KK2lzX2V4ZSAoSEFORExFIGZoKQ0KK3sNCisgIGludCBtYWdpYyA9IGdl
dF93b3JkIChmaCwgMHgwKTsNCisgIHJldHVybiBtYWdpYyA9PSBFWEVfTUFH
SUM7DQorfQ0KKw0KK3N0YXRpYyBib29sDQoraXNfc3ltbGluayAoSEFORExF
IGZoKQ0KK3sNCisgIGludCBtYWdpYyA9IGdldF93b3JkIChmaCwgMHgwKTsN
CisgIHJldHVybiBtYWdpYyA9PSBTSE9SVENVVF9NQUdJQyB8fCBtYWdpYyA9
PSBTWU1MSU5LX01BR0lDOw0KK30NCisNCitzdGF0aWMgYm9vbA0KK3JlYWRs
aW5rIChIQU5ETEUgZmgsIGNoYXIgKnBhdGgsIGludCBtYXhsZW4pDQorew0K
KyAgaW50IGdvdDsNCisgIGludCBtYWdpYyA9IGdldF93b3JkIChmaCwgMHgw
KTsNCisNCisgIGlmIChtYWdpYyA9PSBTSE9SVENVVF9NQUdJQykNCisgICAg
ew0KKyAgICAgIGludCBvZmZzZXQgPSBnZXRfd29yZCAoZmgsIDB4NGMpOw0K
KyAgICAgIGludCBzbGVuID0gZ2V0X3dvcmQgKGZoLCAweDRjICsgb2Zmc2V0
ICsgMik7DQorICAgICAgaWYgKHNsZW4gPj0gbWF4bGVuKQ0KKwl7DQorCSAg
ZGlzcGxheV9lcnJvciAoInJlYWRsaW5rOiBQYXRoIHRvbyBsb25nIik7DQor
CSAgcmV0dXJuIGZhbHNlOw0KKwl9DQorICAgICAgaWYgKFNldEZpbGVQb2lu
dGVyIChmaCwgMHg0YyArIG9mZnNldCArIDQsIDAsIEZJTEVfQkVHSU4pID09
IElOVkFMSURfU0VUX0ZJTEVfUE9JTlRFUg0KKwkgICYmIEdldExhc3RFcnJv
ciAoKSAhPSBOT19FUlJPUikNCisJew0KKwkgIGRpc3BsYXlfZXJyb3IgKCJy
ZWFkbGluazogU2V0RmlsZVBvaW50ZXIoKSIpOw0KKwkgIHJldHVybiBmYWxz
ZTsNCisJfQ0KKw0KKyAgICAgIGlmICghUmVhZEZpbGUgKGZoLCBwYXRoLCBz
bGVuLCAoRFdPUkQgKikgJmdvdCwgMCkpDQorCXsNCisJICBkaXNwbGF5X2Vy
cm9yICgicmVhZGxpbms6IFJlYWRGaWxlKCkiKTsNCisJICByZXR1cm4gZmFs
c2U7DQorCX0NCisgICAgICBlbHNlIGlmIChnb3QgPCBzbGVuKQ0KKwl7DQor
CSAgZGlzcGxheV9lcnJvciAoInJlYWRsaW5rOiBSZWFkRmlsZSgpIik7DQor
CSAgcmV0dXJuIGZhbHNlOw0KKwl9DQorICAgICAgZWxzZQ0KKwlwYXRoW2dv
dF0gPSAnXDAnOw0KKyAgICB9DQorICBlbHNlIGlmIChtYWdpYyA9PSBTWU1M
SU5LX01BR0lDKQ0KKyAgICB7DQorICAgICAgY2hhciBjb29raWVfYnVmW3Np
emVvZiAoU1lNTElOS19DT09LSUUpIC0gMV07DQorDQorICAgICAgaWYgKFNl
dEZpbGVQb2ludGVyIChmaCwgMCwgMCwgRklMRV9CRUdJTikgPT0gSU5WQUxJ
RF9TRVRfRklMRV9QT0lOVEVSDQorCSAgJiYgR2V0TGFzdEVycm9yICgpICE9
IE5PX0VSUk9SKQ0KKwl7DQorCSAgZGlzcGxheV9lcnJvciAoInJlYWRsaW5r
OiBTZXRGaWxlUG9pbnRlcigpIik7DQorCSAgcmV0dXJuIGZhbHNlOw0KKwl9
DQorDQorICAgICAgaWYgKCFSZWFkRmlsZSAoZmgsIGNvb2tpZV9idWYsIHNp
emVvZiAoY29va2llX2J1ZiksIChEV09SRCAqKSAmZ290LCAwKSkNCisJew0K
KwkgIGRpc3BsYXlfZXJyb3IgKCJyZWFkbGluazogUmVhZGZpbGUoKSIpOw0K
KwkgIHJldHVybiBmYWxzZTsNCisJfQ0KKyAgICAgIGVsc2UgaWYgKGdvdCA9
PSBzaXplb2YgKGNvb2tpZV9idWYpDQorCSAgICAgICAmJiBtZW1jbXAgKGNv
b2tpZV9idWYsIFNZTUxJTktfQ09PS0lFLCBzaXplb2YgKGNvb2tpZV9idWYp
KSA9PSAwKQ0KKwl7DQorCSAgaWYgKCFSZWFkRmlsZSAoZmgsIHBhdGgsIG1h
eGxlbiwgKERXT1JEICopICZnb3QsIDApKQ0KKwkgICAgew0KKwkgICAgICBk
aXNwbGF5X2Vycm9yICgicmVhZGxpbms6IFJlYWRGaWxlKCkiKTsNCisJICAg
ICAgcmV0dXJuIGZhbHNlOw0KKwkgICAgfQ0KKwkgIGVsc2UgaWYgKGdvdCA+
PSBtYXhsZW4pDQorCSAgICB7DQorCSAgICAgIGRpc3BsYXlfZXJyb3IgKCJy
ZWFkbGluazogUGF0aCB0b28gbG9uZyIpOw0KKwkgICAgICBwYXRoWzBdID0g
J1wwJzsNCisJICAgICAgcmV0dXJuIGZhbHNlOw0KKwkgICAgfQ0KKwkgIGVs
c2UNCisJICAgIHBhdGhbZ290XSA9ICdcMCc7DQorCX0NCisgICAgfQ0KKyAg
ZWxzZQ0KKyAgICByZXR1cm4gZmFsc2U7DQorICByZXR1cm4gdHJ1ZTsNCit9
DQorDQogLy8gUmV0dXJuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgZXJy
b3IgcHJpbnRlZA0KIHN0YXRpYyBib29sDQogdHJhY2tfZG93biAoY2hhciAq
ZmlsZSwgY2hhciAqc3VmZml4LCBpbnQgbHZsKQ0KQEAgLTY4Miw3ICs4MzAs
MTcgQEAgdHJhY2tfZG93biAoY2hhciAqZmlsZSwgY2hhciAqc3VmZml4LCBp
bg0KIA0KICAgZC0+c3RhdGUgPSBESURfQUNUSVZFOw0KIA0KLSAgZGxsX2lu
Zm8gKHBhdGgsIGZoLCBsdmwsIDEpOw0KKyAgaWYgKGlzX2V4ZSAoZmgpKQ0K
KyAgICBkbGxfaW5mbyAocGF0aCwgZmgsIGx2bCwgMSk7DQorICBlbHNlIGlm
IChpc19zeW1saW5rIChmaCkpDQorICAgIGRpc3BsYXlfZXJyb3IgKCJ0cmFj
a19kb3duOiBIdWg/ICBHb3QgYSBzeW1saW5rISIpOw0KKyAgZWxzZQ0KKyAg
ICB7DQorICAgICAgaW50IG1hZ2ljID0gZ2V0X3dvcmQgKGZoLCAweDApOw0K
KyAgICAgIG1hZ2ljICY9IDB4MDBGRkZGRkY7DQorICAgICAgcHJpbnRmICgi
IC0gTm90IGEgRExMOiBtYWdpYyBudW1iZXIgJXggKCVkKSAnJXMnXG4iLCBt
YWdpYywgbWFnaWMsIChjaGFyICopJm1hZ2ljKTsNCisgICAgfQ0KKw0KICAg
ZC0+c3RhdGUgPSBESURfSU5BQ1RJVkU7DQogICBpZiAoIUNsb3NlSGFuZGxl
IChmaCkpDQogICAgIGRpc3BsYXlfZXJyb3IgKCJ0cmFja19kb3duOiBDbG9z
ZUhhbmRsZSgpIik7DQpAQCAtNzExLDExICs4NjksNTUgQEAgbHMgKGNoYXIg
KmYpDQogICAgIGRpc3BsYXlfZXJyb3IgKCJsczogQ2xvc2VIYW5kbGUoKSIp
Ow0KIH0NCiANCisvLyBGaW5kIGEgcmVhbCBhcHBsaWNhdGlvbiBvbiB0aGUg
cGF0aCAocG9zc2libHkgZm9sbG93aW5nIHN5bWxpbmtzKQ0KK3N0YXRpYyBj
aGFyICoNCitmaW5kX2FwcF9vbl9wYXRoIChjaGFyICphcHAsIGludCBzaG93
YWxsID0gMCkNCit7DQorICBjaGFyICpwYXBwID0gZmluZF9vbl9wYXRoIChh
cHAsIChjaGFyICopICIuZXhlIiwgc2hvd2FsbCwgMCwgMSk7DQorDQorICBI
QU5ETEUgZmggPQ0KKyAgICBDcmVhdGVGaWxlIChwYXBwLCBHRU5FUklDX1JF
QUQsIEZJTEVfU0hBUkVfUkVBRCB8IEZJTEVfU0hBUkVfV1JJVEUsDQorCQlO
VUxMLCBPUEVOX0VYSVNUSU5HLCBGSUxFX0FUVFJJQlVURV9OT1JNQUwsIE5V
TEwpOw0KKyAgaWYgKGZoID09IElOVkFMSURfSEFORExFX1ZBTFVFKQ0KKyAg
ICB7DQorICAgICAgcHJpbnRmICgiIC0gQ2Fubm90IG9wZW5cbiIpOw0KKyAg
ICAgIHJldHVybiBOVUxMOw0KKyAgICB9DQorDQorICBpZiAoaXNfc3ltbGlu
ayAoZmgpKQ0KKyAgICB7DQorICAgICAgc3RhdGljIGNoYXIgdG1wWzQwMDBd
ID0gIiI7DQorICAgICAgY2hhciAqcHRyOw0KKyAgICAgIHJlYWRsaW5rKGZo
LCB0bXAsIDM5OTkpOw0KKyAgICAgIHB0ciA9IGN5Z3BhdGgodG1wLCBOVUxM
KTsNCisgICAgICBmb3IgKGNoYXIgKnAgPSBwdHI7IChwID0gc3RyY2hyIChw
LCAnLycpKTsgcCsrKQ0KKwkqcCA9ICdcXCc7DQorICAgICAgcHJpbnRmICgi
IC0+ICVzXG4iLCBwdHIpOw0KKyAgICAgIGlmICghc3RyY2hyIChwdHIsICdc
XCcpKQ0KKwl7DQorCSAgY2hhciAqbGFzdHNlcDsNCisJICBzdHJuY3B5ICh0
bXAsIGN5Z3BhdGggKHBhcHAsIE5VTEwpLCAzOTk5KTsNCisJICBmb3IgKGNo
YXIgKnAgPSB0bXA7IChwID0gc3RyY2hyIChwLCAnLycpKTsgcCsrKQ0KKwkg
ICAgKnAgPSAnXFwnOw0KKwkgIGxhc3RzZXAgPSBzdHJyY2hyICh0bXAsICdc
XCcpOw0KKwkgIHN0cm5jcHkobGFzdHNlcCsxLCBwdHIsIDM5OTktKGxhc3Rz
ZXAtdG1wKSk7DQorCSAgcHRyID0gdG1wOw0KKwl9DQorICAgICAgaWYgKCFD
bG9zZUhhbmRsZSAoZmgpKQ0KKwlkaXNwbGF5X2Vycm9yICgiZmluZF9hcHBf
b25fcGF0aDogQ2xvc2VIYW5kbGUoKSIpOw0KKyAgICAgIHJldHVybiBmaW5k
X2FwcF9vbl9wYXRoIChwdHIsIHNob3dhbGwpOw0KKyAgICB9DQorDQorICBp
ZiAoIUNsb3NlSGFuZGxlIChmaCkpDQorICAgIGRpc3BsYXlfZXJyb3IgKCJm
aW5kX2FwcF9vbl9wYXRoOiBDbG9zZUhhbmRsZSgpIik7DQorICByZXR1cm4g
cGFwcDsNCit9DQorDQogLy8gUmV0dXJuIHRydWUgb24gc3VjY2VzcywgZmFs
c2UgaWYgZXJyb3IgcHJpbnRlZA0KIHN0YXRpYyBib29sDQogY3lnY2hlY2sg
KGNoYXIgKmFwcCkNCiB7DQotICBjaGFyICpwYXBwID0gZmluZF9vbl9wYXRo
IChhcHAsIChjaGFyICopICIuZXhlIiwgMSwgMCk7DQorICBjaGFyICpwYXBw
ID0gZmluZF9hcHBfb25fcGF0aCAoYXBwLCAxKTsNCiAgIGlmICghcGFwcCkN
CiAgICAgew0KICAgICAgIHByaW50ZiAoIkVycm9yOiBjb3VsZCBub3QgZmlu
ZCAlc1xuIiwgYXBwKTsNCkBAIC0xNDQxLDcgKzE2NDMsNyBAQCBkdW1wX3N5
c2luZm8gKCkNCiAgICAgcHJpbnRmDQogICAgICAgKCJMb29raW5nIHRvIHNl
ZSB3aGVyZSBjb21tb24gcHJvZ3JhbXMgY2FuIGJlIGZvdW5kLCBpZiBhdCBh
bGwuLi5cbiIpOw0KICAgZm9yIChpID0gMDsgY29tbW9uX2FwcHNbaV0ubmFt
ZTsgaSsrKQ0KLSAgICBpZiAoIWZpbmRfb25fcGF0aCAoKGNoYXIgKikgY29t
bW9uX2FwcHNbaV0ubmFtZSwgKGNoYXIgKikgIi5leGUiLCAxLCAwKSkNCisg
ICAgaWYgKCFmaW5kX2FwcF9vbl9wYXRoICgoY2hhciAqKSBjb21tb25fYXBw
c1tpXS5uYW1lLCAxKSkNCiAgICAgICB7DQogCWlmIChjb21tb25fYXBwc1tp
XS5taXNzaW5nX2lzX2dvb2QpDQogCSAgcHJpbnRmICgiTm90IEZvdW5kOiAl
cyAoZ29vZCEpXG4iLCBjb21tb25fYXBwc1tpXS5uYW1lKTsNCg==

---559023410-1483920592-1139856269=:17217--
