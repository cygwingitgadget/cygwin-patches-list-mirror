Return-Path: <corinna-cygwin@cygwin.com>
Received: from mout.kundenserver.de (mout.kundenserver.de [212.227.126.131])
 by sourceware.org (Postfix) with ESMTPS id 3F3003844010
 for <cygwin-patches@cygwin.com>; Thu, 20 Aug 2020 14:06:41 +0000 (GMT)
DMARC-Filter: OpenDMARC Filter v1.3.2 sourceware.org 3F3003844010
Authentication-Results: sourceware.org;
 dmarc=none (p=none dis=none) header.from=cygwin.com
Authentication-Results: sourceware.org;
 spf=fail smtp.mailfrom=corinna-cygwin@cygwin.com
Received: from calimero.vinschen.de ([217.91.18.234]) by
 mrelayeu.kundenserver.de (mreue010 [212.227.15.167]) with ESMTPSA (Nemesis)
 id 1MtwEO-1kwCZ93dHg-00uGRe for <cygwin-patches@cygwin.com>; Thu, 20 Aug 2020
 16:06:39 +0200
Received: by calimero.vinschen.de (Postfix, from userid 500)
 id 4109BA8070B; Thu, 20 Aug 2020 16:06:39 +0200 (CEST)
Date: Thu, 20 Aug 2020 16:06:39 +0200
From: Corinna Vinschen <corinna-cygwin@cygwin.com>
To: cygwin-patches@cygwin.com
Subject: Re: [PATCH] Cygwin: strace: ignore GCC exceptions
Message-ID: <20200820140639.GS3272@calimero.vinschen.de>
Reply-To: cygwin-patches@cygwin.com
Mail-Followup-To: cygwin-patches@cygwin.com
References: <20200820135433.19279-1-kbrown@cornell.edu>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <20200820135433.19279-1-kbrown@cornell.edu>
X-Provags-ID: V03:K1:0WgpMmfCMaPLY9xCna0yR6vGHzIdI+c4URlSmDsDBEvAmIgT/8Y
 FwNPV5W/RvMRvXJkNDIVxcsRnUym0emFTDlhrR1/TpsbgadWHQVP9JJLOR+Uc8bEqz1fzLJ
 tdBn3+C7xT4TepSmibCO6EUDpo2WTi9vf8q9iDfiGntBOald571aAa9t6RRPjz6lJ8JcGLX
 myRbaaWstCTw4WgVeiF4w==
X-UI-Out-Filterresults: notjunk:1;V03:K0:POGCVUrUjek=:IEVfvcS8BBiqlHxoQLLWe4
 9Gz37Tqwjrm5h4TRuSBtrbMzRprskL5wO1/5ul1mdQGpQ8tJKDWTx/iPxIJpKtC7EAwddzQ8s
 PnpnPvVit+ziJ/0jRPpTryKm9AlxZ7/zzKgJ4RWEwzJuvwzHatRUmhIlqArgIakB3JD74wDKm
 Xio3kL5lh6wCwP6mxrzIApuCcATAJUU/G6c0mhVEIjuI4LBpbF7tphN5Hl51iqS9sfymXYksg
 OVMAb6Bm9eg3FfnaK7e6bUvvE+C8JpmX1N2Pkw4HldxVGR39n6jd2MqjAEjeUq8W6KqJmviZ7
 w2SVLOUo8En4QJD/D9Hl/9bWqjF8ZchL9LP4kHtK9H6M3qWcVv7b6sfffA04mw2CjDSfCz2bH
 thZ1pJ2s8qJ41e6fgLVDbP+jVOs41PWeKvjfbbAC3tYKobcg8l8SuktarD4bNRKaYGyA3gC7X
 8zfp2J+5AT+iu0mxz9XbGfdrYSY0HTb7FnWNouxWCqh8oe/HLHiTf0T/r23uPDiyAyqTvQObH
 qqwXNQ4tBSyvtdQLjB1JsNGWYWIkzPm/wfEaE84RI9tPuhsdpFEGPDsesv0fb6SZvVZ7TkyQ/
 1OnzyqWH2rpdftozYKYjK+cc0elZ7CIiKo1Bp0N5pDDNPKDw/+MufCEbnftuL72kEHhMgISWa
 /z0zFIrsEP4MiIrWxwglrwrwiz+L9HM5qIjK+IyxBpufGs3hhtcGl8TY3MmYM72/HY3d+7/7g
 FmUGyoAfoe7uUb4YFkKeTC62tmDaYZmzidazrzkM7QCHYCfePNMZOVRW0oNcOWFI7tg6Joj2B
 bYqEocPBvEMvBNPszXtBUbPIWUbg1j14wSl4UHIfjoR3ZeeQelJOjJNkrledSTxmtTQOTW03X
 QjAJ/9UbrL+r5GDfUu8g==
X-Spam-Status: No, score=-104.5 required=5.0 tests=BAYES_00, GIT_PATCH_0,
 GOOD_FROM_CORINNA_CYGWIN, JMQ_SPF_NEUTRAL, KAM_DMARC_STATUS,
 RCVD_IN_DNSWL_NONE, RCVD_IN_MSPIKE_H2, SPF_HELO_NONE, SPF_NEUTRAL,
 TXREP autolearn=ham autolearn_force=no version=3.4.2
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on
 server2.sourceware.org
X-BeenThere: cygwin-patches@cygwin.com
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Cygwin core component patch submission and discussion
 <cygwin-patches.cygwin.com>
List-Unsubscribe: <https://cygwin.com/mailman/options/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=unsubscribe>
List-Archive: <https://cygwin.com/pipermail/cygwin-patches/>
List-Post: <mailto:cygwin-patches@cygwin.com>
List-Help: <mailto:cygwin-patches-request@cygwin.com?subject=help>
List-Subscribe: <https://cygwin.com/mailman/listinfo/cygwin-patches>,
 <mailto:cygwin-patches-request@cygwin.com?subject=subscribe>
X-List-Received-Date: Thu, 20 Aug 2020 14:06:42 -0000

Hi Ken,

On Aug 20 09:54, Ken Brown via Cygwin-patches wrote:
> Any C++ app that calls 'throw' on 64-bit Cygwin results in an
> exception of type STATUS_GCC_THROW (0x20474343) generated by the C++
> runtime.  Don't pollute the strace output by printing information
> about this and other GCC exceptions.
> ---
>  winsup/utils/strace.cc | 7 +++++++
>  1 file changed, 7 insertions(+)
> 
> diff --git a/winsup/utils/strace.cc b/winsup/utils/strace.cc
> index 9b6569a70..2b317012d 100644
> --- a/winsup/utils/strace.cc
> +++ b/winsup/utils/strace.cc
> @@ -790,6 +790,13 @@ proc_child (unsigned mask, FILE *ofile, pid_t pid)
>  	    case STATUS_BREAKPOINT:
>  	    case 0x406d1388:		/* SetThreadName exception. */
>  	      break;
> +#ifdef __x86_64__
> +	    case 0x20474343:		/* STATUS_GCC_THROW. */
> +	    case 0x21474343:		/* STATUS_GCC_UNWIND. */
> +	    case 0x22474343:		/* STATUS_GCC_FORCED. */
> +	      status = DBG_EXCEPTION_NOT_HANDLED;
> +	      break;
> +#endif
>  	    default:
>  	      status = DBG_EXCEPTION_NOT_HANDLED;
>  	      if (ev.u.Exception.dwFirstChance)
> -- 
> 2.28.0

Wouldn't it make sense to create a header defining the GCC status values
as in libgcc/unwind-seh.c and share this between exceptions.cc and
strace.cc?


Thanks,
Corinna
