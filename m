From: "Robert Collins" <robert.collins@itdomain.com.au>
To: <cygwin-developers@sources.redhat.com>, <cygwin-patches@cygwin.com>
Subject: Re: hierarchy in setup (category stuff)
Date: Sat, 23 Jun 2001 07:16:00 -0000
Message-id: <054c01c0fbef$5f600e20$0200a8c0@lifelesswks>
References: <04e801c0faa2$f9008260$0200a8c0@lifelesswks> <20010621222615.C13746@redhat.com> <3B3324A7.49FFC98A@yahoo.com>
X-SW-Source: 2001-q2/msg00327.html
Content-type: multipart/mixed; boundary="----------=_1583532848-65438-76"

This is a multi-part message in MIME format...

------------=_1583532848-65438-76
Content-length: 1479

----- Original Message -----
From: "Earnie Boyd" <earnie_boyd@yahoo.com>
To: <cygwin-developers@sources.redhat.com>
Sent: Friday, June 22, 2001 8:57 PM
Subject: Re: hierarchy in setup (category stuff)


> Christopher Faylor wrote:
> >
> >
> > >4) Should category should uncategorised packages appear as?
> > >"Uncategorised" seems singularly unappealing..
> >
> > Misc?
> >
>
> Optional?
>

I've gone with "Misc". Optional has a implied judgment about the package
value, and I'm aiming for backwards compatability: ash etc should not
_need_ to be categorised for this setup.exe to make sense to the user.

I think that locally found packages (see recent threads on
cygwin@cygwin.com) can be dumped into a new category "local" or
something similar.

I've attached my current sandbox changes. The code _is not finished_. (I
am _looking_ at adding the prev/curr/exp capability to whole categories
as well as the code cleanliness I mention below).

However: Feel free to throw stones at the UI, functionality, look n
feel. I need to know whether this is what folk have anticipated users
will understand.

Code-wise I need to tidy up the classes a little, and doing that will
make the code significantly smaller. The end I am currently targeting is
a large array of lines, with categories having a sub-count of the number
of packages visible and their own array pointer for those packages. That
will allow a slightly better class hierarchy...

anyway, have fun, feedback wanted.

Rob

------------=_1583532848-65438-76
Content-Type: text/x-c++; charset=us-ascii; name="choose.h"
Content-Disposition: inline; filename="choose.h"
Content-Transfer-Encoding: base64
Content-Length: 2257

LyoKICogQ29weXJpZ2h0IChjKSAyMDAwLCBSZWQgSGF0LCBJbmMuCiAqCiAq
ICAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogKiAgICAgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBh
cyBwdWJsaXNoZWQgYnkKICogICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5k
YXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCiAq
ICAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgog
KiAgICAgQSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZSBjYW4gYmUgZm91bmQgYXQKICogICAgIGh0dHA6Ly93d3cuZ251Lm9yZy8K
ICoKICogV3JpdHRlbiBieSBSb2JlcnQgQ29sbGlucyA8cmJ0Y29sbGluc0Bo
b3RtYWlsLmNvbT4KICoKICovCgojaWZuZGVmIF9DSE9PU0VfSF8KI2RlZmlu
ZSBfQ0hPT1NFX0hfCgojaW5jbHVkZSAiaW5pLmgiCgojZGVmaW5lIENBVEVH
T1JZX0VYUEFOREVEICAwCiNkZWZpbmUgQ0FURUdPUllfQ09MTEFQU0VEIDEK
CgpzdHJ1Y3QgX2hlYWRlcgp7CiAgY2hhciAqdGV4dDsKICBpbnQgc2xlbjsK
ICBpbnQgd2lkdGg7CiAgaW50IHg7Cn07CgpjbGFzcyBwaWNrX2xpbmUKewog
IHB1YmxpYzoKICAgIHZvaWQgc2V0X2xpbmUgKFBhY2thZ2UgKl9wa2cpOwog
ICAgdm9pZCBzZXRfbGluZSAoQ2F0ZWdvcnkgKl9jYXQpOwogICAgdm9pZCBw
YWludCAoSERDIGhkYywgaW50IHgsIGludCB5LCBpbnQgcm93LCBpbnQgc2hv
d19jYXQpOwogICAgUGFja2FnZSAqZ2V0X3BrZyAodm9pZCkgeyByZXR1cm4g
cGtnOyB9OwogICAgQ2F0ZWdvcnkgKmdldF9jYXRlZ29yeSAodm9pZCkgeyBy
ZXR1cm4gY2F0OyB9OwogICAgaW50IGNsaWNrIChpbnQgeCk7CiAgcHJpdmF0
ZToKICAgIFBhY2thZ2UgKnBrZzsKICAgIENhdGVnb3J5ICpjYXQ7Cn07Cgp0
eXBlZGVmIGNsYXNzIF92aWV3CnsKICBwdWJsaWM6CiAgICBpbnQgbnVtX2Nv
bHVtbnM7CiAgICB2aWV3cyBnZXRfdmlld19tb2RlICgpIHsgcmV0dXJuIHZp
ZXdfbW9kZTsgfTsKICAgIHZvaWQgc2V0X3ZpZXdfbW9kZSh2aWV3cyBfbW9k
ZSk7CiAgICBzdHJ1Y3QgX2hlYWRlciAqaGVhZGVyczsKICAgIF92aWV3ICh2
aWV3cyBtb2RlLCBIREMgZGMpOwogICAgY2hhciAqbW9kZV9jYXB0aW9uICgp
OwogICAgdm9pZCBpbnNlcnRfcGtnIChQYWNrYWdlICopOwogICAgdm9pZCBp
bnNlcnRfY2F0ZWdvcnkgKENhdGVnb3J5ICosIGludCk7CiAgICB2b2lkIGNs
ZWFyX3ZpZXcgKHZvaWQpOwogICAgaW50IGNsaWNrIChpbnQgcm93LCBpbnQg
eCk7CiAgICBpbnQgY3VycmVudF9jb2w7CiAgICBpbnQgbmV3X2NvbDsKICAg
IGludCBzcmNfY29sOwogICAgaW50IGNhdF9jb2w7CiAgICBpbnQgcGtnX2Nv
bDsKICAgIGludCBsYXN0X2NvbDsKICAgIHBpY2tfbGluZSAqIGxpbmVzOwog
ICAgaW50IG5saW5lczsKCiAgcHJpdmF0ZToKICAgIHZpZXdzIHZpZXdfbW9k
ZTsKICAgIHZvaWQgc2V0X2hlYWRlcnMgKHZvaWQpOwogICAgdm9pZCBpbml0
X2hlYWRlcnMgKEhEQyBkYyk7CiAgICB2b2lkIGluc2VydF9hdCAoaW50LCBQ
YWNrYWdlICopOwoKfSB2aWV3OwoKI2VuZGlmIC8qIF9DSE9PU0VfSF8gKi8K

------------=_1583532848-65438-76
Content-Type: text/x-diff; charset=us-ascii; name="hierarchy.patch"
Content-Disposition: inline; filename="hierarchy.patch"
Content-Transfer-Encoding: base64
Content-Length: 45982

PyAuaW5pcGFyc2UueS5zd3AKPyAudGFyLmNjLnN3cAo/IGNob29zZS5oCj8g
ZGVwZW5kczIucGF0Y2gKPyBkZXBlbmRzNC5wYXRjaAo/IGhpZXJhcmNoeS5w
YXRjaAo/IGhvbWUucGF0Y2gKPyBvcmNpbnN0YWxsCj8gd29yay5wYXRjaApJ
bmRleDogY2hvb3NlLmNjCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KUkNTIGZp
bGU6IC9jdnMvc3JjL3NyYy93aW5zdXAvY2luc3RhbGwvY2hvb3NlLmNjLHYK
cmV0cmlldmluZyByZXZpc2lvbiAyLjMzCmRpZmYgLXUgLXAgLXIyLjMzIGNo
b29zZS5jYwotLS0gY2hvb3NlLmNjCTIwMDEvMDYvMTYgMTg6NTA6MTMJMi4z
MworKysgY2hvb3NlLmNjCTIwMDEvMDYvMjMgMTQ6MTI6NTEKQEAgLTQzLDYg
KzQzLDcgQEAgc3RhdGljIGNoYXIgKmN2c2lkID0gIlxuJSUlICRJZDogY2hv
b3NlLgogI2luY2x1ZGUgImZpbmQuaCIKICNpbmNsdWRlICJmaWxlbWFuaXAu
aCIKICNpbmNsdWRlICJtb3VudC5oIgorI2luY2x1ZGUgImNob29zZS5oIgog
CiAjaW5jbHVkZSAicG9ydC5oIgogCkBAIC01NSw4ICs1Niw2IEBAIHN0YXRp
YyBjaGFyICpjdnNpZCA9ICJcbiUlJSAkSWQ6IGNob29zZS4KIAogc3RhdGlj
IGludCBpbml0aWFsaXplZCA9IDA7CiAKLXN0YXRpYyBpbnQgZnVsbF9saXN0
ID0gMDsKLQogc3RhdGljIGludCBzY3JvbGxfdWxjX3gsIHNjcm9sbF91bGNf
eTsKIAogc3RhdGljIEhXTkQgbHYsIG5leHRidXR0b24sIGNob29zZV9pbnN0
X3RleHQ7CkBAIC02NiwyOCArNjUsMjkgQEAgc3RhdGljIEhBTkRMRSBzeXNm
b250Owogc3RhdGljIGludCByb3dfaGVpZ2h0Owogc3RhdGljIEhBTkRMRSBi
bV9zcGluLCBibV9ydGFycm93LCBibV9jaGVja3llcywgYm1fY2hlY2tubywg
Ym1fY2hlY2tuYTsKIHN0YXRpYyBIREMgYml0bWFwX2RjOworc3RhdGljIHZp
ZXcgKmNob29zZXIgPSBOVUxMOworCitzdGF0aWMgc3RydWN0IF9oZWFkZXIg
cGtnX2hlYWRlcnNbXSA9IHsKKyAgeyAiQ3VycmVudCIsIDcsIDAsIDAgfSwK
KyAgeyAiTmV3IiwgMywgMCwgMCB9LAorICB7ICJTcmM/IiwgNCwgMCwgMCB9
LAorICB7ICJDYXRlZ29yeSIsIDgsIDAsIDAgfSwKKyAgeyAiUGFja2FnZSIs
IDcsIDAsIDAgfSwKKyAgeyAwLCAwLCAwLCAwIH0KK307CiAKLXN0YXRpYyBz
dHJ1Y3QKLSAgewotICAgIGNoYXIgKnRleHQ7Ci0gICAgaW50IHNsZW47Ci0g
ICAgaW50IHdpZHRoOwotICAgIGludCB4OwotICB9Ci1oZWFkZXJzW10gPSB7
CitzdGF0aWMgc3RydWN0IF9oZWFkZXIgY2F0X2hlYWRlcnNbXSA9IHsKKyAg
eyAiQ2F0ZWdvcnkiLCA4LCAwLCAwIH0sCiAgIHsgIkN1cnJlbnQiLCA3LCAw
LCAwIH0sCi0jZGVmaW5lIENVUlJFTlRfQ09MIDAKICAgeyAiTmV3IiwgMywg
MCwgMCB9LAotI2RlZmluZSBORVdfQ09MIDEKICAgeyAiU3JjPyIsIDQsIDAs
IDAgfSwKLSNkZWZpbmUgU1JDX0NPTCAyCiAgIHsgIlBhY2thZ2UiLCA3LCAw
LCAwIH0sCi0jZGVmaW5lIFBBQ0tBR0VfQ09MIDMKICAgeyAwLCAwLCAwLCAw
IH0KIH07Ci0jZGVmaW5lIE5VTV9DT0xVTU5TIChzaXplb2YgKGhlYWRlcnMp
IC8gKHNpemVvZiAoaGVhZGVyc1swXSkpIC0gMSkKKworc3RhdGljIGludCBh
ZGRfcmVxdWlyZWQoUGFja2FnZSAqcGtnKTsKK3N0YXRpYyB2b2lkIHNldF92
aWV3X21vZGUgKEhXTkQgaCwgdmlld3MgbW9kZSk7CiAKLWludCAqcGFja2Fn
ZV9pbmRleGVzLCBuaW5kZXhlczsKIAogc3RhdGljIGJvb2wKIGlzaW5zdGFs
bGVkIChQYWNrYWdlICpwa2csIGludCB0cnVzdCkKQEAgLTE2NSw2ICsxNjUs
NjkgQEAgc2V0X2FjdGlvbiAoUGFja2FnZSAqcGtnLCBib29sIHByZWluYykK
ICAgICAgIH0KIH0KIAorc3RhdGljIGludAorYWRkX3JlcXVpcmVkIChQYWNr
YWdlICpwa2cpCit7CisgIERlcGVuZGVuY3kgKmRwOworICBQYWNrYWdlICpy
ZXF1aXJlZDsKKyAgaW50IGM7CisgIGludCBjaGFuZ2VkID0gMDsKKyAgZHAg
PSBwa2ctPnJlcXVpcmVkOworICBzd2l0Y2ggKHBrZy0+YWN0aW9uKQorICAg
IHsKKyAgICBjYXNlIEFDVElPTl9VTklOU1RBTEw6CisgICAgY2FzZSBBQ1RJ
T05fRVJST1I6CisgICAgY2FzZSBBQ1RJT05fVU5LTk9XTjoKKyAgICBjYXNl
IEFDVElPTl9TUkNfT05MWToKKyAgICBjYXNlIEFDVElPTl9TS0lQOgorICAg
ICAgcmV0dXJuIDA7CisgICAgZGVmYXVsdDoKKyAgICAgIGJyZWFrOworICAg
IH0KKyAgd2hpbGUgKGRwKQorICAgIHsKKyAgICAgIGlmICgocmVxdWlyZWQg
PSBnZXRwa2dieW5hbWUoZHAtPnBhY2thZ2UpKSA9PSBOVUxMKQorICAgICAg
ICB7CisgICAgICAgICAgZHA9ZHAtPm5leHQ7CisgICAgICAgICAgY29udGlu
dWU7CisgICAgICAgIH0KKyAgICAgIHN3aXRjaCAocmVxdWlyZWQtPmFjdGlv
bikKKyAgICAgICAgeworCWNhc2UgQUNUSU9OX1BSRVY6CisJY2FzZSBBQ1RJ
T05fQ1VSUjoKKwljYXNlIEFDVElPTl9URVNUOgorCWNhc2UgQUNUSU9OX0xB
U1Q6CisJY2FzZSBBQ1RJT05fU0FNRV9DVVJSOgorCWNhc2UgQUNUSU9OX1NB
TUVfVEVTVDoKKwljYXNlIEFDVElPTl9TQU1FX1BSRVY6CisJY2FzZSBBQ1RJ
T05fUkVETzoKKwljYXNlIEFDVElPTl9TQU1FX0xBU1Q6CisJICAvKiB3ZSBh
cmUgaW5zdGFsbGluZyBhIHVzZXIgc2VsZWN0ZWQgdmVyc2lvbiAqLworCSAg
YnJlYWs7CisJCisJY2FzZSBBQ1RJT05fVU5JTlNUQUxMOgorCSAgLyogaXQn
cyBhbHJlYWR5IGluc3RhbGxlZCAtIGxlYXZlIGl0ICovCisJICByZXF1aXJl
ZC0+YWN0aW9uID0gQUNUSU9OX1NLSVA7CisJICBicmVhazsKKwljYXNlIEFD
VElPTl9FUlJPUjoKKwljYXNlIEFDVElPTl9VTktOT1dOOgorCWNhc2UgQUNU
SU9OX1NSQ19PTkxZOgorCWNhc2UgQUNUSU9OX1NLSVA6CisJICAvKiB0aGUg
Y3VycmVudCBpbnN0YWxsIHdpbGwgZmFpbCAqLworCSAgcmVxdWlyZWQtPmFj
dGlvbiA9IEFDVElPTl9QUkVWOyAvKiB0aGlzIGZpbmQgcHJldiwgdGhlbiBj
dXJyLCB0aGVuIHRlc3QuICovCisJICBzZXRfYWN0aW9uKHJlcXVpcmVkLCAw
KTsJICAvKiB3ZSBuZWVkIGEgZmluZF9iZXN0IHRoYXQgZ2V0cyBpbnN0YWxs
ZWQsICovCisJICBjaGFuZ2VkKys7CQkJICAvKiB0aGVuIGN1cnJlbnQsIHRo
ZW4gcHJldiwgdGhlbiB0ZXN0ICovCisJICBjaG9vc2VyLT5pbnNlcnRfcGtn
IChyZXF1aXJlZCk7CisJICBicmVhazsKKwlkZWZhdWx0OgorCSAgbG9nICgw
LCAic2hvdWxkIG5ldmVyIGdldCBoZXJlICVkXG4iLCByZXF1aXJlZC0+YWN0
aW9uKTsKKwl9CisgICAgICBjaGFuZ2VkICs9IGFkZF9yZXF1aXJlZCAocmVx
dWlyZWQpOworICAgICAgZHA9ZHAtPm5leHQ7CisgICAgfQorICByZXR1cm4g
Y2hhbmdlZDsKK30KKwogLyogUmV0dXJuIGFuIGFwcHJvcHJpYXRlIGNhcHRp
b24gZ2l2ZW4gdGhlIGN1cnJlbnQgYWN0aW9uLiAqLwogY29uc3QgY2hhciAq
CiBjaG9vc2VfY2FwdGlvbiAoUGFja2FnZSAqcGtnKQpAQCAtMjE3LDU1ICsy
ODAsMTkgQEAgcGFpbnQgKEhXTkQgaHduZCkKICAgeSA9IGNyLnRvcCAtIHNj
cm9sbF91bGNfeSArIGhlYWRlcl9oZWlnaHQ7CiAKIAotICBmb3IgKGkgPSAw
OyBoZWFkZXJzW2ldLnRleHQ7IGkrKykKKyAgZm9yIChpID0gMDsgaSA8PSBj
aG9vc2VyLT5sYXN0X2NvbCA7IGkrKykKICAgICB7Ci0gICAgICBUZXh0T3V0
IChoZGMsIHggKyBoZWFkZXJzW2ldLngsIDMsIGhlYWRlcnNbaV0udGV4dCwg
aGVhZGVyc1tpXS5zbGVuKTsKLSAgICAgIE1vdmVUb0V4IChoZGMsIHggKyBo
ZWFkZXJzW2ldLngsIGhlYWRlcl9oZWlnaHQtMywgJnApOwotICAgICAgTGlu
ZVRvIChoZGMsIHggKyBoZWFkZXJzW2ldLnggKyBoZWFkZXJzW2ldLndpZHRo
LCBoZWFkZXJfaGVpZ2h0LTMpOworICAgICAgVGV4dE91dCAoaGRjLCB4ICsg
Y2hvb3Nlci0+aGVhZGVyc1tpXS54LCAzLCBjaG9vc2VyLT5oZWFkZXJzW2ld
LnRleHQsIGNob29zZXItPmhlYWRlcnNbaV0uc2xlbik7CisgICAgICBNb3Zl
VG9FeCAoaGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tpXS54LCBoZWFkZXJf
aGVpZ2h0LTMsICZwKTsKKyAgICAgIExpbmVUbyAoaGRjLCB4ICsgY2hvb3Nl
ci0+aGVhZGVyc1tpXS54ICsgY2hvb3Nlci0+aGVhZGVyc1tpXS53aWR0aCwg
aGVhZGVyX2hlaWdodC0zKTsKICAgICB9CiAKICAgSW50ZXJzZWN0Q2xpcFJl
Y3QgKGhkYywgY3IubGVmdCwgY3IudG9wICsgaGVhZGVyX2hlaWdodCwgY3Iu
cmlnaHQsIGNyLmJvdHRvbSk7Ci0KLSAgZm9yIChpaSA9IDA7IGlpIDwgbmlu
ZGV4ZXM7IGlpKyspCi0gICAgewotICAgICAgaSA9IHBhY2thZ2VfaW5kZXhl
c1tpaV07Ci0gICAgICBQYWNrYWdlICpwa2cgPSBwYWNrYWdlICsgaTsKLSAg
ICAgIGludCByID0geSArIGlpICogcm93X2hlaWdodDsKLSAgICAgIGludCBi
eSA9IHIgKyB0bS50bUhlaWdodCAtIDExOwotICAgICAgaWYgKHBrZy0+aW5z
dGFsbGVkKQotCXsKLQkgIFRleHRPdXQgKGhkYywgeCArIGhlYWRlcnNbQ1VS
UkVOVF9DT0xdLngsIHIsCi0JCSAgIHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9u
LCBzdHJsZW4gKHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uKSk7Ci0JICBTZWxl
Y3RPYmplY3QgKGJpdG1hcF9kYywgYm1fcnRhcnJvdyk7Ci0JICBCaXRCbHQg
KGhkYywgeCArIGhlYWRlcnNbQ1VSUkVOVF9DT0xdLnggKyBoZWFkZXJzWzBd
LndpZHRoICsgSUNPTl9NQVJHSU4vMiArIEhNQVJHSU4vMiwgYnksCi0JCSAg
MTEsIDExLCBiaXRtYXBfZGMsIDAsIDAsIFNSQ0NPUFkpOwotCX0KLQotICAg
ICAgY29uc3QgY2hhciAqcyA9IGNob29zZV9jYXB0aW9uIChwa2cpOwotICAg
ICAgVGV4dE91dCAoaGRjLCB4ICsgaGVhZGVyc1tORVdfQ09MXS54ICsgTkVX
X0NPTF9TSVpFX1NMT1AsIHIsCi0JICAgICAgIHMsIHN0cmxlbiAocykpOwot
ICAgICAgU2VsZWN0T2JqZWN0IChiaXRtYXBfZGMsIGJtX3NwaW4pOwotICAg
ICAgQml0Qmx0IChoZGMsIHggKyBoZWFkZXJzW05FV19DT0xdLngsIGJ5LCAx
MSwgMTEsCi0JICAgICAgYml0bWFwX2RjLCAwLCAwLCBTUkNDT1BZKTsKIAot
ICAgICAgSEFORExFIGNoZWNrX2JtOwotICAgICAgaWYgKHBrZy0+c3JjcGlj
a2VkKQotCWNoZWNrX2JtID0gYm1fY2hlY2t5ZXM7Ci0gICAgICBlbHNlCi0J
Y2hlY2tfYm0gPSBibV9jaGVja25vOwotCi0gICAgICBTZWxlY3RPYmplY3Qg
KGJpdG1hcF9kYywgY2hlY2tfYm0pOwotICAgICAgQml0Qmx0IChoZGMsIHgg
KyBoZWFkZXJzW1NSQ19DT0xdLngsIGJ5LCAxMSwgMTEsCi0JICAgICAgYml0
bWFwX2RjLCAwLCAwLCBTUkNDT1BZKTsKKyAgZm9yIChpaSA9IDA7IGlpIDwg
Y2hvb3Nlci0+bmxpbmVzOyBpaSsrKQorICAgICAgY2hvb3Nlci0+bGluZXNb
aWldLnBhaW50IChoZGMsIHgsIHksIGlpLCAoY2hvb3Nlci0+Z2V0X3ZpZXdf
bW9kZSAoKSA9PSBWSUVXX0NBVEVHT1JZKSA/IDAgOiAxKTsKIAotICAgICAg
aWYgKHBhY2thZ2VbaV0uc2Rlc2MpCi0JcyA9IHBhY2thZ2VbaV0uc2Rlc2M7
Ci0gICAgICBlbHNlCi0JcyA9IHBhY2thZ2VbaV0ubmFtZTsKLSAgICAgIFRl
eHRPdXQgKGhkYywgeCArIGhlYWRlcnNbUEFDS0FHRV9DT0xdLngsIHIsIHMs
IHN0cmxlbiAocykpOwotICAgIH0KLQotICBpZiAobmluZGV4ZXMgPT0gMCkK
KyAgaWYgKGNob29zZXItPm5saW5lcyA9PSAwKQogICAgIHsKICAgICAgIHN0
YXRpYyBjaGFyICptc2cgPSAiTm90aGluZyB0byBJbnN0YWxsL1VwZGF0ZSI7
CiAgICAgICBpZiAoc291cmNlID09IElEQ19TT1VSQ0VfRE9XTkxPQUQpCkBA
IC0zNTAsOSArMzc3LDkgQEAgbGlzdF9oc2Nyb2xsIChIV05EIGh3bmQsIEhX
TkQgaGN0bCwgVUlOVAogc3RhdGljIExSRVNVTFQgQ0FMTEJBQ0sKIGxpc3Rf
Y2xpY2sgKEhXTkQgaHduZCwgQk9PTCBkYmxjbGssIGludCB4LCBpbnQgeSwg
VUlOVCBoaXRDb2RlKQogewotICBpbnQgcjsKKyAgaW50IHIscmVmcmVzaDsK
IAotICBpZiAobmluZGV4ZXMgPT0gMCkKKyAgaWYgKGNob29zZXItPm5saW5l
cyA9PSAwKQogICAgIHJldHVybiAwOwogCiAgIGlmICh5IDwgaGVhZGVyX2hl
aWdodCkKQEAgLTM2MiwyMyArMzg5LDM4IEBAIGxpc3RfY2xpY2sgKEhXTkQg
aHduZCwgQk9PTCBkYmxjbGssIGludCAKIAogICByID0gKHkgKyBST1dfTUFS
R0lOLzIpIC8gcm93X2hlaWdodDsKIAotICBpZiAociA8IDAgfHwgciA+PSBu
aW5kZXhlcykKKyAgaWYgKHIgPCAwIHx8IHIgPj0gY2hvb3Nlci0+bmxpbmVz
KQogICAgIHJldHVybiAwOwotCi0gIFBhY2thZ2UgKnBrZyA9IHBhY2thZ2Ug
KyBwYWNrYWdlX2luZGV4ZXNbcl07CiAKLSAgaWYgKHggPj0gaGVhZGVyc1tO
RVdfQ09MXS54IC0gKEhNQVJHSU4gLyAyKSAmJiB4IDw9IGhlYWRlcnNbTkVX
X0NPTCArIDFdLnggLSBITUFSR0lOLzIpCi0gICAgc2V0X2FjdGlvbiAocGtn
LCAxKTsKKyAgcmVmcmVzaCA9IGNob29zZXItPmNsaWNrIChyLCB4KTsKKyAK
KyAgaWYgKHJlZnJlc2gpCisgICAgeworICAgICAgUkVDVCByOworICAgICAg
R2V0Q2xpZW50UmVjdCAobHYsICZyKTsKKyAgICAgIFNDUk9MTElORk8gc2k7
CisgICAgICBtZW1zZXQgKCZzaSwgMCwgc2l6ZW9mIChzaSkpOworICAgICAg
c2kuY2JTaXplID0gc2l6ZW9mIChzaSk7CisgICAgICBzaS5mTWFzayA9IFNJ
Rl9BTEw7IC8qIFNJRl9SQU5HRSB3YXMgZ2l2aW5nIHN0cmFuZ2UgYmVoYXZp
b3VyICovCisgICAgICBzaS5uTWluID0gMDsKKworICAgICAgc2kubk1heCA9
IGNob29zZXItPm5saW5lcyAqIHJvd19oZWlnaHQ7CisgICAgICBzaS5uUGFn
ZSA9IHIuYm90dG9tIC0gaGVhZGVyX2hlaWdodDsKKyAgICAgIHNpLm5Qb3Mg
PSBzY3JvbGxfdWxjX3k7CisgICAgICBTZXRTY3JvbGxJbmZvIChsdiwgU0Jf
VkVSVCwgJnNpLCBUUlVFKTsKIAotICBpZiAoeCA+PSBoZWFkZXJzW1NSQ19D
T0xdLnggLSBITUFSR0lOLzIgJiYgeCA8PSBoZWFkZXJzW1NSQ19DT0wgKyAx
XS54IC0gSE1BUkdJTi8yKQotICAgIHBrZy0+c3JjcGlja2VkIF49IDE7Cisg
ICAgICBJbnZhbGlkYXRlUmVjdCAobHYsICZyLCBUUlVFKTsKIAotICBSRUNU
IHJlY3Q7Ci0gIHJlY3QubGVmdCA9IGhlYWRlcnNbTkVXX0NPTF0ueCAtIHNj
cm9sbF91bGNfeDsKLSAgcmVjdC5yaWdodCA9IGhlYWRlcnNbU1JDX0NPTCAr
IDFdLnggLSBzY3JvbGxfdWxjX3g7Ci0gIHJlY3QudG9wID0gaGVhZGVyX2hl
aWdodCArIHIgKiByb3dfaGVpZ2h0IC0gc2Nyb2xsX3VsY195OwotICByZWN0
LmJvdHRvbSA9IHJlY3QudG9wICsgcm93X2hlaWdodDsKLSAgSW52YWxpZGF0
ZVJlY3QgKGh3bmQsICZyZWN0LCBUUlVFKTsKKyAgICB9CisgIGVsc2UKKyAg
ICB7CisgICAgICBSRUNUIHJlY3Q7CisgICAgICByZWN0LmxlZnQgPSBjaG9v
c2VyLT5oZWFkZXJzW2Nob29zZXItPm5ld19jb2xdLnggLSBzY3JvbGxfdWxj
X3g7CisgICAgICByZWN0LnJpZ2h0ID0gY2hvb3Nlci0+aGVhZGVyc1tjaG9v
c2VyLT5zcmNfY29sICsgMV0ueCAtIHNjcm9sbF91bGNfeDsKKyAgICAgIHJl
Y3QudG9wID0gaGVhZGVyX2hlaWdodCArIHIgKiByb3dfaGVpZ2h0IC0gc2Ny
b2xsX3VsY195OworICAgICAgcmVjdC5ib3R0b20gPSByZWN0LnRvcCArIHJv
d19oZWlnaHQ7CisgICAgICBJbnZhbGlkYXRlUmVjdCAoaHduZCwgJnJlY3Qs
IFRSVUUpOworICAgIH0KIH0KIAogc3RhdGljIExSRVNVTFQgQ0FMTEJBQ0sK
QEAgLTQyNCwxNCArNDY2LDE0IEBAIHJlZ2lzdGVyX3dpbmRvd3MgKEhJTlNU
QU5DRSBoaW5zdCkKIH0KIAogc3RhdGljIHZvaWQKLW5vdGVfd2lkdGggKEhE
QyBkYywgY2hhciAqc3RyaW5nLCBpbnQgYWRkZW5kLCBpbnQgY29sdW1uKQor
bm90ZV93aWR0aCAoc3RydWN0IF9oZWFkZXIgKmhkcnMsIEhEQyBkYywgY2hh
ciAqc3RyaW5nLCBpbnQgYWRkZW5kLCBpbnQgY29sdW1uKQogewogICBpZiAo
IXN0cmluZykKICAgICByZXR1cm47CiAgIFNJWkUgczsKICAgR2V0VGV4dEV4
dGVudFBvaW50MzIgKGRjLCBzdHJpbmcsIHN0cmxlbiAoc3RyaW5nKSwgJnMp
OwotICBpZiAoaGVhZGVyc1tjb2x1bW5dLndpZHRoIDwgcy5jeCArIGFkZGVu
ZCkKLSAgICBoZWFkZXJzW2NvbHVtbl0ud2lkdGggPSBzLmN4ICsgYWRkZW5k
OworICBpZiAoaGRyc1tjb2x1bW5dLndpZHRoIDwgcy5jeCArIGFkZGVuZCkK
KyAgICBoZHJzW2NvbHVtbl0ud2lkdGggPSBzLmN4ICsgYWRkZW5kOwogfQog
CiBzdGF0aWMgaW50CkBAIC00NzQsNiArNTE2LDE0IEBAIHNldF9leGlzdGVu
Y2UgKCkKIH0KIAogc3RhdGljIHZvaWQKK2ZpbGxfbWlzc2luZ19jYXRlZ29y
eSAoKQoreworICBmb3IgKFBhY2thZ2UgKnBrZyA9IHBhY2thZ2U7IHBrZy0+
bmFtZTsgcGtnKyspCisgICAgaWYgKCFwa2ctPmNhdGVnb3J5KQorICAgICAg
YWRkX2NhdGVnb3J5IChwa2csIHJlZ2lzdGVyX2NhdGVnb3J5ICgiTWlzYyIp
KTsKK30KKworc3RhdGljIHZvaWQKIGRlZmF1bHRfdHJ1c3QgKEhXTkQgaCwg
dHJ1c3RzIHRydXN0KQogewogICBpbnQgaSwgdCwgYzsKQEAgLTQ4MSw2ICs1
MzEsOSBAQCBkZWZhdWx0X3RydXN0IChIV05EIGgsIHRydXN0cyB0cnVzdCkK
ICAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdlOyBwa2ctPm5hbWU7IHBr
ZysrKQogICAgIHsKICAgICAgIHBrZy0+YWN0aW9uID0gKGFjdGlvbnMpIHRy
dXN0OworICAgICAgaWYgKHBrZy0+Y2F0ZWdvcnkgJiYgIShnZXRwYWNrYWdl
Y2F0ZWdvcnlieW5hbWUgKHBrZywgIlJlcXVpcmVkIikgfHwKKwkJCSAgICAg
Z2V0cGFja2FnZWNhdGVnb3J5YnluYW1lIChwa2csICJNaXNjIikpKQorCXBr
Zy0+YWN0aW9uID0gQUNUSU9OX1NLSVA7CiAgICAgICBzZXRfYWN0aW9uIChw
a2csIDApOwogICAgIH0KICAgUkVDVCByOwpAQCAtNDkwLDI0ICs1NDMsNDYy
IEBAIGRlZmF1bHRfdHJ1c3QgKEhXTkQgaCwgdHJ1c3RzIHRydXN0KQogICAg
IFNldEZvY3VzIChuZXh0YnV0dG9uKTsKIH0KIAotc3RhdGljIHZvaWQKLXNl
dF9mdWxsX2xpc3QgKEhXTkQgaCwgaW50IGlzZnVsbCkKK3ZvaWQKK3BpY2tf
bGluZTo6c2V0X2xpbmUgKFBhY2thZ2UgKl9wa2cpCit7CisgIHBrZyA9IF9w
a2c7CisgIGNhdCA9IE5VTEw7Cit9CisKK3ZvaWQKK3BpY2tfbGluZTo6c2V0
X2xpbmUgKENhdGVnb3J5ICpfY2F0KQogeworICBjYXQgPSBfY2F0OworICBw
a2cgPSBOVUxMOworfQorCit2b2lkCitwaWNrX2xpbmU6OnBhaW50IChIREMg
aGRjLCBpbnQgeCwgaW50IHksIGludCByb3csIGludCBzaG93X2NhdCkKK3sK
KyAgaW50IHIgPSB5ICsgcm93ICogcm93X2hlaWdodDsKKyAgaW50IGJ5ID0g
ciArIHRtLnRtSGVpZ2h0IC0gMTE7CisgIGlmIChwa2cpCisgICAgeworICAg
ICAgaWYgKHBrZy0+aW5zdGFsbGVkKQorICAgICAgICB7CisgICAgICAgICAg
VGV4dE91dCAoaGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5j
dXJyZW50X2NvbF0ueCwgciwKKyAgICAgICAgICAgICAgICAgICBwa2ctPmlu
c3RhbGxlZC0+dmVyc2lvbiwgc3RybGVuIChwa2ctPmluc3RhbGxlZC0+dmVy
c2lvbikpOworICAgICAgICAgIFNlbGVjdE9iamVjdCAoYml0bWFwX2RjLCBi
bV9ydGFycm93KTsKKyAgICAgICAgICBCaXRCbHQgKGhkYywgeCArIGNob29z
ZXItPmhlYWRlcnNbY2hvb3Nlci0+Y3VycmVudF9jb2xdLnggKyBjaG9vc2Vy
LT5oZWFkZXJzWzBdLndpZHRoICsgSUNPTl9NQVJHSU4vMiArIEhNQVJHSU4v
MiwgYnksCisgICAgICAgICAgICAgICAgICAxMSwgMTEsIGJpdG1hcF9kYywg
MCwgMCwgU1JDQ09QWSk7CisgICAgICAgIH0KKworICAgICAgY29uc3QgY2hh
ciAqcyA9IGNob29zZV9jYXB0aW9uIChwa2cpOworICAgICAgVGV4dE91dCAo
aGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5uZXdfY29sXS54
ICsgTkVXX0NPTF9TSVpFX1NMT1AsIHIsCisgICAgICAgICAgICAgICBzLCBz
dHJsZW4gKHMpKTsKKyAgICAgIFNlbGVjdE9iamVjdCAoYml0bWFwX2RjLCBi
bV9zcGluKTsKKyAgICAgIEJpdEJsdCAoaGRjLCB4ICsgY2hvb3Nlci0+aGVh
ZGVyc1tjaG9vc2VyLT5uZXdfY29sXS54LCBieSwgMTEsIDExLAorICAgICAg
ICAgICAgICBiaXRtYXBfZGMsIDAsIDAsIFNSQ0NPUFkpOworCisgICAgICBI
QU5ETEUgY2hlY2tfYm07CisgICAgICBpZiAocGtnLT5zcmNwaWNrZWQpCisg
ICAgICAgIGNoZWNrX2JtID0gYm1fY2hlY2t5ZXM7CisgICAgICBlbHNlCisg
ICAgICAgIGNoZWNrX2JtID0gYm1fY2hlY2tubzsKKworICAgICAgU2VsZWN0
T2JqZWN0IChiaXRtYXBfZGMsIGNoZWNrX2JtKTsKKyAgICAgIEJpdEJsdCAo
aGRjLCB4ICsgY2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5zcmNfY29sXS54
LCBieSwgMTEsIDExLAorICAgICAgICAgICAgICBiaXRtYXBfZGMsIDAsIDAs
IFNSQ0NPUFkpOworCisJLyogc2hvd3MgImZpcnN0IiBjYXRlZ29yeSAtIGRv
IHdlIHdhbnQgdG8gc2hvdyBhbnk/ICovCisgICAgICBpZiAocGtnLT5jYXRl
Z29yeSAmJiBzaG93X2NhdCkKKyAgICAgICBUZXh0T3V0IChoZGMsIHggKyBj
aG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPmNhdF9jb2xdLngsIHIsIHBrZy0+
Y2F0ZWdvcnktPm5hbWUsIHN0cmxlbiAocGtnLT5jYXRlZ29yeS0+bmFtZSkp
OworCisgICAgICBpZiAocGtnLT5zZGVzYykKKyAgICAgICAgcyA9IHBrZy0+
c2Rlc2M7CisgICAgICBlbHNlCisgICAgICAgIHMgPSBwa2ctPm5hbWU7Cisg
ICAgICBUZXh0T3V0IChoZGMsIHggKyBjaG9vc2VyLT5oZWFkZXJzW2Nob29z
ZXItPnBrZ19jb2xdLngsIHIsIHMsIHN0cmxlbiAocykpOworICAgIH0KKyAg
ZWxzZSBpZiAoY2F0KQorICAgIHsKKyAgICAgIFRleHRPdXQgKGhkYywgeCAr
IGNob29zZXItPmhlYWRlcnNbY2hvb3Nlci0+Y2F0X2NvbF0ueCwgciwgY2F0
LT5uYW1lLCBzdHJsZW4gKGNhdC0+bmFtZSkpOworICAgIH0KK30KKworaW50
CitwaWNrX2xpbmU6OmNsaWNrIChpbnQgeCkKK3sKKyAgaWYgKHBrZykKKyAg
ICB7CisgICAgICBpZiAoeCA+PSBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXIt
PnNyY19jb2xdLnggLSBITUFSR0lOLzIgJiYgeCA8PSBjaG9vc2VyLT5oZWFk
ZXJzW2Nob29zZXItPnNyY19jb2wgKyAxXS54IC0gSE1BUkdJTi8yKQorICAg
ICAgcGtnLT5zcmNwaWNrZWQgXj0gMTsKKworICAgIGlmICh4ID49IGNob29z
ZXItPmhlYWRlcnNbY2hvb3Nlci0+bmV3X2NvbF0ueCAtIChITUFSR0lOIC8g
MikgJiYgeCA8PSBjaG9vc2VyLT5oZWFkZXJzW2Nob29zZXItPm5ld19jb2wg
KyAxXS54IC0gSE1BUkdJTi8yKQorICAgICAgeworICAgICAgICBzZXRfYWN0
aW9uIChwa2csIDEpOworICAgICAgICAvKiBBZGQgYW55IHBhY2thZ2VzIHRo
YXQgYXJlIG5lZWRlZCBieSB0aGlzIHBhY2thZ2UgKi8KKyAgICAgICAgcmV0
dXJuIGFkZF9yZXF1aXJlZCAgKHBrZyk7CisgICAgICB9CisgICAgfQorICBl
bHNlIGlmIChjYXQpCisgICAgeworICAgICAgLyogaGFuZGxlIHRoZSBjYXRh
bG9nIGJlaW5nIGNsaWNrZWQgLi4uIGRvZXMgdGhpcyBiZWxvbmcgdXAgYSBs
ZXZlbC4uID8gKi8KKyAgICB9CisgIAorICByZXR1cm4gMDsKK30KKworX3Zp
ZXc6Ol92aWV3ICh2aWV3cyBfbW9kZSwgSERDIGRjKQoreworICBsaW5lcyA9
IE5VTEw7CisgIG5saW5lcyA9IDA7CisgIHZpZXdfbW9kZSA9IFZJRVdfUEFD
S0FHRTsKKyAgc2V0X2hlYWRlcnMgKCk7CisgIGluaXRfaGVhZGVycyAoZGMp
OworICB2aWV3X21vZGUgPSBWSUVXX0NBVEVHT1JZOworICBzZXRfaGVhZGVy
cyAoKTsKKyAgaW5pdF9oZWFkZXJzIChkYyk7CisKKyAgdmlld19tb2RlID0g
X21vZGU7CisgIHNldF9oZWFkZXJzICgpOworfQorCit2b2lkCitfdmlldzo6
c2V0X3ZpZXdfbW9kZSAodmlld3MgX21vZGUpCit7CisgIGlmIChfbW9kZSA9
PSBOVklFVykKKyAgICAgIHZpZXdfbW9kZSA9IFZJRVdfUEFDS0FHRV9GVUxM
OworICBlbHNlCisgICAgdmlld19tb2RlID0gX21vZGU7CisgIHNldF9oZWFk
ZXJzICgpOworfQorCitjaGFyICoKK192aWV3Ojptb2RlX2NhcHRpb24gKCkK
K3sKKyAgc3dpdGNoICh2aWV3X21vZGUpCisgICAgeworICAgIGNhc2UgVklF
V19VTktOT1dOOiAgICAgIHJldHVybiAiIjsKKyAgICBjYXNlIFZJRVdfUEFD
S0FHRV9GVUxMOiByZXR1cm4gIkZ1bGwiOworICAgIGNhc2UgVklFV19QQUNL
QUdFOiAgICAgIHJldHVybiAiUGFydGlhbCI7CisgICAgY2FzZSBWSUVXX0NB
VEVHT1JZOiAgICAgcmV0dXJuICJDYXRlZ29yeSI7CisgICAgZGVmYXVsdDog
ICAgICAgICAgICAgICAgcmV0dXJuICIiOworICAgIH0KK30KKwordm9pZAor
X3ZpZXc6OnNldF9oZWFkZXJzICh2b2lkKQoreworICBzd2l0Y2ggKHZpZXdf
bW9kZSkKKyAgICB7CisgICAgY2FzZSBWSUVXX1VOS05PV046CisgICAgICBy
ZXR1cm47CisgICAgY2FzZSBWSUVXX1BBQ0tBR0VfRlVMTDogCisgICAgY2Fz
ZSBWSUVXX1BBQ0tBR0U6ICAgICAgCisgICAgICBoZWFkZXJzID0gcGtnX2hl
YWRlcnM7CisgICAgICBjdXJyZW50X2NvbCA9IDA7CisgICAgICBuZXdfY29s
ID0gMTsKKyAgICAgIHNyY19jb2wgPSAyOworICAgICAgY2F0X2NvbCA9IDM7
CisgICAgICBwa2dfY29sID0gNDsKKyAgICAgIGxhc3RfY29sID0gNDsKKyAg
ICAgIGJyZWFrOworICAgIGNhc2UgVklFV19DQVRFR09SWToKKyAgICAgIGhl
YWRlcnMgPSBjYXRfaGVhZGVyczsKKyAgICAgIGN1cnJlbnRfY29sID0gMTsK
KyAgICAgIG5ld19jb2wgPSAyOworICAgICAgc3JjX2NvbCA9IDM7CisgICAg
ICBjYXRfY29sID0gMDsKKyAgICAgIHBrZ19jb2wgPSA0OworICAgICAgbGFz
dF9jb2wgPSA0OworICAgIGRlZmF1bHQ6CisgICAgICByZXR1cm47CisgICAg
fQorfQorCit2b2lkCitfdmlldzo6aW5pdF9oZWFkZXJzIChIREMgZGMpCit7
CiAgIGludCBpOwotICBmdWxsX2xpc3QgPSBpc2Z1bGw7CiAKLSAgaWYgKHBh
Y2thZ2VfaW5kZXhlcyA9PSAwKQotICAgIHBhY2thZ2VfaW5kZXhlcyA9IChp
bnQgKikgbWFsbG9jIChucGFja2FnZXMgKiBzaXplb2YgKGludCkpOworICBm
b3IgKGkgPSAwOyBoZWFkZXJzW2ldLnRleHQ7IGkrKykKKyAgICBoZWFkZXJz
W2ldLndpZHRoID0gMDsKIAotICBuaW5kZXhlcyA9IDA7CisgIGZvciAoaSA9
IDA7IGhlYWRlcnNbaV0udGV4dDsgaSsrKQorICAgIG5vdGVfd2lkdGggKGhl
YWRlcnMsIGRjLCBoZWFkZXJzW2ldLnRleHQsIDAsIGkpOwogICBmb3IgKFBh
Y2thZ2UgKnBrZyA9IHBhY2thZ2U7IHBrZy0+bmFtZTsgcGtnKyspCisgICAg
eworICAgICAgaWYgKHBrZy0+aW5zdGFsbGVkKQorICAgICAgICB7CisgICAg
ICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywgZGMsIHBrZy0+aW5zdGFsbGVk
LT52ZXJzaW9uLCAwLCBjdXJyZW50X2NvbCk7CisgICAgICAgICAgbm90ZV93
aWR0aCAoaGVhZGVycywgZGMsIHBrZy0+aW5zdGFsbGVkLT52ZXJzaW9uLCBO
RVdfQ09MX1NJWkVfU0xPUCwgbmV3X2NvbCk7CisgICAgICAgIH0KKyAgICAg
IGZvciAoSW5mbyAqaW5mID0gcGtnLT5pbmZvc2NhbjsgaW5mIDwgcGtnLT5p
bmZvZW5kOyBpbmYrKykKKyAgICAgICAgbm90ZV93aWR0aCAoaGVhZGVycywg
ZGMsIGluZi0+dmVyc2lvbiwgTkVXX0NPTF9TSVpFX1NMT1AsIG5ld19jb2wp
OworICAgICAgZm9yIChDYXRlZ29yeSAqY2F0ID0gcGtnLT5jYXRlZ29yeTsg
Y2F0IDsgY2F0ID0gY2F0LT5uZXh0KQorCW5vdGVfd2lkdGggKGhlYWRlcnMs
IGRjLCBjYXQtPm5hbWUsIDAsIGNhdF9jb2wpOworICAgICAgbm90ZV93aWR0
aCAoaGVhZGVycywgZGMsIHBrZy0+bmFtZSwgMCwgcGtnX2NvbCk7CisgICAg
ICBub3RlX3dpZHRoIChoZWFkZXJzLCBkYywgcGtnLT5zZGVzYywgMCwgcGtn
X2NvbCk7CisgICAgfQorICBub3RlX3dpZHRoIChoZWFkZXJzLCBkYywgImtl
ZXAiLCBORVdfQ09MX1NJWkVfU0xPUCwgbmV3X2NvbCk7CisgIG5vdGVfd2lk
dGggKGhlYWRlcnMsIGRjLCAidW5pbnN0YWxsIiwgTkVXX0NPTF9TSVpFX1NM
T1AsIG5ld19jb2wpOworCisgIGhlYWRlcnNbMF0ueCA9IEhNQVJHSU4vMjsK
KyAgZm9yIChpID0gMTsgaSA8PSBsYXN0X2NvbCA7IGkrKykKKyAgICBoZWFk
ZXJzW2ldLnggPSBoZWFkZXJzW2ktMV0ueCArIGhlYWRlcnNbaS0xXS53aWR0
aCArICgoaSA9PSBuZXdfY29sKSA/IE5FV19DT0xfU0laRV9TTE9QIDogMCkg
KyBITUFSR0lOOworOworfQorCit2b2lkCitfdmlldzo6aW5zZXJ0X3BrZyAo
UGFja2FnZSAqcGtnKQoreworICBpZiAodmlld19tb2RlICE9IFZJRVdfQ0FU
RUdPUlkpCisgICAgeworICAgICAgaWYgKGxpbmVzID09IE5VTEwpCisgICAg
ICAgIHsKKyAgICAgICAgICBsaW5lcyA9IChwaWNrX2xpbmUgKikgbWFsbG9j
ICgobnBhY2thZ2VzICsgbmNhdGVnb3JpZXMpICogc2l6ZW9mIChwaWNrX2xp
bmUpKTsKKyAgICAgICAgICBtZW1zZXQgKGxpbmVzLCAnXDAnLCAobnBhY2th
Z2VzICsgbmNhdGVnb3JpZXMpICogc2l6ZW9mIChwaWNrX2xpbmUpICk7Cisg
ICAgICAgICAgbmxpbmVzID0gMTsKKyAgICAgICAgICBsaW5lc1swXS5zZXRf
bGluZSAocGtnKTsKKyAgICAgICAgfQorICAgICAgZWxzZQorICAgICAgICB7
CisgICAgICAgICAgaW50IG49MDsKKyAgICAgICAgICB3aGlsZSAobiA8IG5s
aW5lcykKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgLyogdGhpcyBz
aG91bGQgYmUgYSBnZW5lcmljIGNhbGwgdG8gbGlzdF9zb3J0X2NtcCAqLwor
ICAgICAgICAgICAgICBpZiAobGluZXNbbl0uZ2V0X3BrZyAoKSAKKyAgCSAg
ICAgICAgICAmJiBzdHJjYXNlY21wIChwa2ctPm5hbWUsIGxpbmVzW25dLmdl
dF9wa2cgKCktPm5hbWUpIDwgMCkKKyAgICAgICAgICAgICAgICB7CisgICAg
ICAgICAgICAgICAgICBtZW1tb3ZlICgmbGluZXNbbiArIDFdLCAmbGluZXNb
bl0sIChubGluZXMgLSBuKSAqIHNpemVvZiAocGlja19saW5lKSk7CisgICAg
ICAgICAgICAgICAgICBsaW5lc1tuXS5zZXRfbGluZSAocGtnKTsKKyAgICAg
ICAgICAgICAgICAgIG5saW5lcysrOworICAgICAgICAgICAgICAgICAgbiA9
IG5saW5lczsKKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgIGVs
c2UgaWYgKGxpbmVzW25dLmdldF9wa2cgKCkgPT0gcGtnKQorCSAgICAgICAg
eworICAgICAgICAgICAgICAgICAgbiA9IG5saW5lcyAtIDE7CisgICAgICAg
ICAgICAgICAgfQorCSAgICAgIG4rKzsKKyAgICAgICAgICAKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgICBpZiAobiA9PSBubGluZXMpCisJICAgIHsKKyAg
IAkgICAgICAvKiBpbnNlcnQgYXQgdGhlIGVuZCAqLworCSAgICAgIGxpbmVz
W25dLnNldF9saW5lIChwa2cpOworIAkgICAgICBubGluZXMrKzsKKwkgICAg
fQorICAgICAgICB9CisgICAgfQorICBlbHNlCisgICAgeworLy8gICAgICBh
c3NlcnQgKGxpbmVzKTsgLyogcHJvdGVjdCBhZ2FpbnN0IGEgY29kaW5nIGNo
YW5nZSBpbiBmdXR1cmUgKi8KKyAgICAgIGZvciAoQ2F0ZWdvcnkgKmNhdCA9
IHBrZy0+Y2F0ZWdvcnk7IGNhdDsgY2F0ID0gY2F0LT5uZXh0KQorCXsKKwkg
IC8qIGluc2VydCB0aGUgcGFja2FnZSB1bmRlciB0aGlzIGNhdGVnb3J5IGlu
IHRoZSBsaXN0LiBJZiB0aGlzIGNhdGVnb3J5IGlzIG5vdAorCSAgICAgdmlz
aWJsZSwgYWRkIGl0ICovCisJICBpbnQgbj0wOworCSAgd2hpbGUgKG4gPCBu
bGluZXMpCisJICAgIHsKKwkgICAgICAvKiB0aGlzIHNob3VsZCBiZSBhIGdl
bmVyaWMgY2FsbCB0byBsaXN0X3NvcnRfY21wICovCisJICAgICAgaWYgKGxp
bmVzW25dLmdldF9jYXRlZ29yeSAoKQorCQkgICYmIGNhdC0+bmFtZSA9PSBs
aW5lc1tuXS5nZXRfY2F0ZWdvcnkgKCktPm5hbWUpCisJCXsKKwkJLyogaW5z
ZXJ0IHVuZGVyIHRoaXMgY2F0ZWdvcnkgKi8KKwkJICBuKys7CisJCSAgd2hp
bGUgKG4gPCBubGluZXMgJiEgbGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgpKQor
CQkgICAgeworCQkgICAgICBpZiAobGluZXNbbl0uZ2V0X3BrZyAoKQorCQkJ
ICAmJiBzdHJjYXNlY21wIChwa2ctPm5hbWUsIGxpbmVzW25dLmdldF9wa2cg
KCktPm5hbWUpIDwgMCkKKwkJCXsKKwkJCSAgbWVtbW92ZSAoJmxpbmVzW24g
KyAxXSwgJmxpbmVzW25dLCAobmxpbmVzIC0gbikgKiBzaXplb2YgKHBpY2tf
bGluZSkpOworCQkJICBsaW5lc1tuXS5zZXRfbGluZSAocGtnKTsKKwkJCSAg
bmxpbmVzKys7CisJCQkgIG4gPSBubGluZXM7CisJCQl9CisJICAgICAgCSAg
ICAgZWxzZSBpZiAobGluZXNbbl0uZ2V0X3BrZyAoKSA9PSBwa2cpCisJCQl7
CisJCQkgIG4gPSBubGluZXM7CisJCQl9CisJCSAgICBlbHNlIGlmIChsaW5l
c1tuXS5nZXRfY2F0ZWdvcnkgKCkpCisJCQl7CisJCQkgIG1lbW1vdmUgKCZs
aW5lc1tuICsgMV0sICZsaW5lc1tuXSwgKG5saW5lcyAtIG4pICogc2l6ZW9m
IChwaWNrX2xpbmUpKTsKKwkJCSAgbGluZXNbbl0uc2V0X2xpbmUgKHBrZyk7
CisJCQkgIG5saW5lcysrOworCQkJICBuID0gbmxpbmVzOworCQkJfQorCQkg
ICAgICBuKys7CisJCSAgICB9CisJCSAgaWYgKG4gPT0gbmxpbmVzKQorCQkg
ICAgeworCQkgICAgICAvKiBpbnNlcnQgYXQgdGhlIGVuZCBvZiB0aGlzIGNh
dGVnb3J5ICovCisJCSAgICAgIGxpbmVzW25dLnNldF9saW5lIChwa2cpOwor
CQkgICAgICBubGluZXMrKzsKKwkJICAgICAgbj1ubGluZXMgKyAxOworCQkg
ICAgfQorCQl9CisJICAgICAgbisrOworCSAgICB9CisJICBpZiAobiA9PSBu
bGluZXMpCisJICAgIHsKKwkgICAgICAvKiB0aGUgY2F0ZWdvcnkgd2Fzbid0
IHZpc2libGUgLSBpbnNlcnQgYXQgdGhlIGVuZCAqLworCSAgICAgIGluc2Vy
dF9jYXRlZ29yeSAoY2F0LCBDQVRFR09SWV9DT0xMQVBTRUQpOworCSAgICAg
IGluc2VydF9wa2cgKHBrZyk7CisJICAgIH0KKwl9CisgICAgfQorfQorCit2
b2lkCitfdmlldzo6aW5zZXJ0X2NhdGVnb3J5IChDYXRlZ29yeSAqY2F0LCBp
bnQgY29sbGFwc2VkKQoreworICBpZiAobGluZXMgPT0gTlVMTCkKKyAgICB7
CisgICAgICBsaW5lcyA9IChwaWNrX2xpbmUgKikgbWFsbG9jICgobnBhY2th
Z2VzICsgbmNhdGVnb3JpZXMpICogc2l6ZW9mIChwaWNrX2xpbmUpKTsKKyAg
ICAgIG1lbXNldCAobGluZXMsICdcMCcsIChucGFja2FnZXMgKyBuY2F0ZWdv
cmllcykgKiBzaXplb2YgKHBpY2tfbGluZSkgKTsKKyAgICAgIG5saW5lcyA9
IDE7CisgICAgICBsaW5lc1swXS5zZXRfbGluZSAoY2F0KTsKKyAgICAgIGlm
ICghY29sbGFwc2VkKQorCWZvciAoQ2F0ZWdvcnlQYWNrYWdlICpjYXRwa2cg
PSBjYXQtPnBhY2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNhdHBrZy0+bmV4
dCkKKwkgIGluc2VydF9wa2cgKGdldHBrZ2J5bmFtZSAoY2F0cGtnLT5wa2cp
KTsKKyAgICB9CisgIGVsc2UKKyAgICB7CisgICAgICBpbnQgbj0wOworICAg
ICAgd2hpbGUgKG4gPCBubGluZXMpCisgICAgICAgIHsKKyAgICAgICAgICAv
KiB0aGlzIHNob3VsZCBiZSBhIGdlbmVyaWMgY2FsbCB0byBsaXN0X3NvcnRf
Y21wICovCisgICAgICAgICAgaWYgKGxpbmVzW25dLmdldF9jYXRlZ29yeSAo
KQorICAgICAgICAgICAgICAmJiBzdHJjYXNlY21wIChjYXQtPm5hbWUsIGxp
bmVzW25dLmdldF9jYXRlZ29yeSAoKS0+bmFtZSkgPCAwKQorICAgICAgICAg
ICAgeworICAgICAgICAgICAgICBtZW1tb3ZlICgmbGluZXNbbiArIDFdLCAm
bGluZXNbbl0sIChubGluZXMgLSBuKSAqIHNpemVvZiAocGlja19saW5lKSk7
CisgICAgICAgICAgICAgIGxpbmVzW25dLnNldF9saW5lIChjYXQpOworICAg
ICAgICAgICAgICBubGluZXMrKzsKKwkgICAgICBpZiAoIWNvbGxhcHNlZCkK
KwkJZm9yIChDYXRlZ29yeVBhY2thZ2UgKmNhdHBrZyA9IGNhdC0+cGFja2Fn
ZXM7IGNhdHBrZzsgY2F0cGtnID0gY2F0cGtnLT5uZXh0KQorCQkgIGluc2Vy
dF9wa2cgKGdldHBrZ2J5bmFtZSAoY2F0cGtnLT5wa2cpKTsKKyAgICAgICAg
ICAgICAgbiA9IG5saW5lczsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICBl
bHNlIGlmIChsaW5lc1tuXS5nZXRfY2F0ZWdvcnkgKCkgPT0gY2F0KQorICAg
ICAgICAgICAgeworICAgICAgICAgICAgICBuID0gbmxpbmVzIC0gMTsKKyAg
ICAgICAgICAgIH0KKyAgICAgICAgICBuKys7CisKKyAgICAgICAgfQorICAg
ICAgaWYgKG4gPT0gbmxpbmVzKQorICAgICAgICB7CisgICAgICAgICAgLyog
aW5zZXJ0IGF0IHRoZSBlbmQgKi8KKyAgICAgICAgICBsaW5lc1tuXS5zZXRf
bGluZSAoY2F0KTsKKyAgICAgICAgICBubGluZXMrKzsKKwkgIGlmICghY29s
bGFwc2VkKQorCSAgICBmb3IgKENhdGVnb3J5UGFja2FnZSAqY2F0cGtnID0g
Y2F0LT5wYWNrYWdlczsgY2F0cGtnOyBjYXRwa2cgPSBjYXRwa2ctPm5leHQp
CisJICAgICAgaW5zZXJ0X3BrZyAoZ2V0cGtnYnluYW1lIChjYXRwa2ctPnBr
ZykpOworICAgICAgICB9CisgICAgfQorfQorCit2b2lkCitfdmlldzo6Y2xl
YXJfdmlldyAodm9pZCkKK3sKKyAgbmxpbmVzID0gMDsKK30KKworc3RhdGlj
IHZpZXdzCit2aWV3c3BsdXNwbHVzKHZpZXdzIHRoZXZpZXcpCit7CisgIHN3
aXRjaCAodGhldmlldykKKyAgICB7CisgICAgY2FzZSBWSUVXX1VOS05PV046
ICAgICAgcmV0dXJuIFZJRVdfUEFDS0FHRV9GVUxMOworICAgIGNhc2UgVklF
V19QQUNLQUdFX0ZVTEw6IHJldHVybiBWSUVXX1BBQ0tBR0U7CisgICAgY2Fz
ZSBWSUVXX1BBQ0tBR0U6ICAgICAgcmV0dXJuIFZJRVdfQ0FURUdPUlk7Cisg
ICAgY2FzZSBWSUVXX0NBVEVHT1JZOiAgICAgcmV0dXJuIE5WSUVXOworICAg
IGRlZmF1bHQ6ICAgICAgICAgICAgICAgIHJldHVybiBWSUVXX1VOS05PV047
CisgICAgfQorfQorCitpbnQKK192aWV3OjpjbGljayAoaW50IHJvdywgaW50
IHgpCit7CisgIGlmIChyb3cgPiBubGluZXMpCisgICAgcmV0dXJuIDA7Cisg
IGlmIChsaW5lc1tyb3ddLmdldF9wa2cgKCkpCisgICAgcmV0dXJuIGxpbmVz
W3Jvd10uY2xpY2sgKHgpOworICBlbHNlCisgICAgeworICAgICAgLyogaWYg
d2UgYXJlIHRoZSBsYXN0IGxpbmUgb3IgdGhlIG5leHQgbGluZSBpcyBhIGNh
dGVnb3J5IHRvbywgZXhwYW5kICovCisgICAgICBpZiAocm93ID09IChubGlu
ZXMgLTEpIHx8IGxpbmVzW3JvdyArIDFdLmdldF9jYXRlZ29yeSAoKSkKKwl7
CisJICBpbnQgY291bnQgPSBubGluZXM7CisJICBmb3IgKENhdGVnb3J5UGFj
a2FnZSAqY2F0cGtnID0gbGluZXNbcm93XS5nZXRfY2F0ZWdvcnkgKCktPnBh
Y2thZ2VzOyBjYXRwa2c7IGNhdHBrZyA9IGNhdHBrZy0+bmV4dCkKKwkgICAg
eworCSAgICAgIFBhY2thZ2UgKiBwa2cgPSBnZXRwa2dieW5hbWUgKGNhdHBr
Zy0+cGtnKTsKKwkgICAgICBpbnQgbiA9IHJvdyArIDE7CisJICAgICAgLyog
dGhpcyBpcyBhIG5hc3R5IGhhY2suIEl0IHdpbGwgZ28gYXdheSB3aGVuIHRo
ZSBoaWVyYXJjaHkgaXMgY29kZWQgKi8KKwkgICAgICB3aGlsZSAobiA8IG5s
aW5lcykKKwkgICAgICAgIHsKKwkJICBpZiAobGluZXNbbl0uZ2V0X3BrZyAo
KQorCQkgICAgICAmJiBzdHJjYXNlY21wIChwa2ctPm5hbWUsIGxpbmVzW25d
LmdldF9wa2cgKCktPm5hbWUpIDwgMCkKKwkJICAgIHsKKwkJICAgICAgbWVt
bW92ZSAoJmxpbmVzW24gKyAxXSwgJmxpbmVzW25dLCAobmxpbmVzIC0gbikg
KiBzaXplb2YgKHBpY2tfbGluZSkpOworCQkgICAgICBsaW5lc1tuXS5zZXRf
bGluZSAocGtnKTsKKwkJICAgICAgbmxpbmVzKys7CisJCSAgICAgIG4gPSBu
bGluZXM7CisJCSAgICB9CisJCSAgZWxzZSBpZiAobGluZXNbbl0uZ2V0X3Br
ZyAoKSA9PSBwa2cpCisJCSAgICB7CisJCSAgICAgIG4gPSBubGluZXM7CisJ
CSAgICB9CisJCSAgZWxzZSBpZiAobGluZXNbbl0uZ2V0X2NhdGVnb3J5ICgp
KQorCQkgICAgeworCQkgICAgICBtZW1tb3ZlICgmbGluZXNbbiArIDFdLCAm
bGluZXNbbl0sIChubGluZXMgLSBuKSAqIHNpemVvZiAocGlja19saW5lKSk7
CisJCSAgICAgIGxpbmVzW25dLnNldF9saW5lIChwa2cpOworCQkgICAgICBu
bGluZXMrKzsKKwkJICAgICAgbiA9IG5saW5lczsKKwkJICAgIH0KKwkJICBu
Kys7CisJCX0KKwkgICAgICBpZiAobiA9PSBubGluZXMpCisJCXsKKwkJICAv
KiBpbnNlcnQgYXQgdGhlIGVuZCBvZiB0aGlzIGNhdGVnb3J5ICovCisJCSAg
bGluZXNbbl0uc2V0X2xpbmUgKHBrZyk7CisJCSAgbmxpbmVzKys7CisJCSAg
bj1ubGluZXMgKyAxOworCQl9CisJICAgIH0KKwkgIHJldHVybiBubGluZXMg
LSBjb3VudDsKKwl9CisgICAgICBlbHNlCisJLyogY29udHJhY3QgKi8KKwl7
CisJICBpbnQgY291bnQgPSAwLCBuID0gcm93ICsgMTsKKwkgIHdoaWxlIChu
IDwgbmxpbmVzICYhIGxpbmVzW25dLmdldF9jYXRlZ29yeSAoKSkKKwkgICAg
eworCSAgICAgIG1lbW1vdmUgKCZsaW5lc1tuXSwgJmxpbmVzW24gKyAxXSwg
KG5saW5lcyAtIG4pICogc2l6ZW9mIChwaWNrX2xpbmUpKTsKKwkgICAgICBu
bGluZXMtLTsKKwkgICAgICBjb3VudCsrOworCSAgICB9CisJICByZXR1cm4g
Y291bnQ7CisJfQorICAgIH0KK30KKworCitzdGF0aWMgdm9pZAorc2V0X3Zp
ZXdfbW9kZSAoSFdORCBoLCB2aWV3cyBtb2RlKQoreworICBpbnQgaTsKKyAg
Y2hvb3Nlci0+c2V0X3ZpZXdfbW9kZSAobW9kZSk7CisKKyAgY2hvb3Nlci0+
Y2xlYXJfdmlldyAoKTsKKyAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdl
OyBwa2ctPm5hbWU7IHBrZysrKQogICAgIGlmICghcGtnLT5leGNsdWRlKQog
ICAgICAgewotCXNldF9hY3Rpb24gKHBrZywgMCk7Ci0JaWYgKChpc2Z1bGwg
fHwgaXNfZG93bmxvYWRfYWN0aW9uIChwa2cpKSkKLQkgIHBhY2thZ2VfaW5k
ZXhlc1tuaW5kZXhlcysrXSA9IHBrZyAtIHBhY2thZ2U7CisgICAgICAgIHNl
dF9hY3Rpb24gKHBrZywgMCk7CiAgICAgICB9CiAKKyAgc3dpdGNoIChjaG9v
c2VyLT5nZXRfdmlld19tb2RlICgpKQorICAgIHsKKyAgICBjYXNlIFZJRVdf
UEFDS0FHRToKKyAgICAgIGZvciAoUGFja2FnZSAqcGtnID0gcGFja2FnZTsg
cGtnLT5uYW1lOyBwa2crKykKKwlpZiAoIXBrZy0+ZXhjbHVkZSAmJiBpc19k
b3dubG9hZF9hY3Rpb24gKHBrZykpIAorCSAgY2hvb3Nlci0+aW5zZXJ0X3Br
ZyAocGtnKTsgCisgICAgICBicmVhazsKKyAgICBjYXNlIFZJRVdfUEFDS0FH
RV9GVUxMOgorICAgICAgZm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdlOyBw
a2ctPm5hbWU7IHBrZysrKQorCWlmICghcGtnLT5leGNsdWRlKSAKKwkgIGNo
b29zZXItPmluc2VydF9wa2cgKHBrZyk7IAorICAgICAgYnJlYWs7CisgICAg
Y2FzZSBWSUVXX0NBVEVHT1JZOgorICAgICAgLyogc3RhcnQgY29sbGFwc2Vk
LiBUT0RPOiBtYWtlIHRoaXMgYSBjaG9vc2VyIGZsYWcgKi8KKyAgICAgIGZv
ciAoQ2F0ZWdvcnkgKmNhdCA9IGNhdGVnb3J5OyBjYXQ7IGNhdCA9IGNhdC0+
bmV4dCkKKwljaG9vc2VyLT5pbnNlcnRfY2F0ZWdvcnkgKGNhdCwgQ0FURUdP
UllfQ09MTEFQU0VEKTsKKyAgICAgIGJyZWFrOworICAgIGRlZmF1bHQ6Cisg
ICAgICBicmVhazsKKyAgICB9CisKICAgUkVDVCByOwogICBHZXRDbGllbnRS
ZWN0IChoLCAmcik7CiAgIFNDUk9MTElORk8gc2k7CkBAIC01MTUsMTEgKzEw
MDYsMTEgQEAgc2V0X2Z1bGxfbGlzdCAoSFdORCBoLCBpbnQgaXNmdWxsKQog
ICBzaS5jYlNpemUgPSBzaXplb2YgKHNpKTsKICAgc2kuZk1hc2sgPSBTSUZf
QUxMOwogICBzaS5uTWluID0gMDsKLSAgc2kubk1heCA9IGhlYWRlcnNbMl0u
eCArIGhlYWRlcnNbMl0ud2lkdGggKyBITUFSR0lOOworICBzaS5uTWF4ID0g
Y2hvb3Nlci0+aGVhZGVyc1tjaG9vc2VyLT5sYXN0X2NvbF0ueCArIGNob29z
ZXItPmhlYWRlcnNbY2hvb3Nlci0+bGFzdF9jb2xdLndpZHRoICsgSE1BUkdJ
TjsKICAgc2kublBhZ2UgPSByLnJpZ2h0OwogICBTZXRTY3JvbGxJbmZvICho
LCBTQl9IT1JaLCAmc2ksIFRSVUUpOwogCi0gIHNpLm5NYXggPSBuaW5kZXhl
cyAqIHJvd19oZWlnaHQ7CisgIHNpLm5NYXggPSBjaG9vc2VyLT5ubGluZXMg
KiByb3dfaGVpZ2h0OwogICBzaS5uUGFnZSA9IHIuYm90dG9tIC0gaGVhZGVy
X2hlaWdodDsKICAgU2V0U2Nyb2xsSW5mbyAoaCwgU0JfVkVSVCwgJnNpLCBU
UlVFKTsKIApAQCAtNTQ2LDEwICsxMDM3LDYgQEAgY3JlYXRlX2xpc3R2aWV3
IChIV05EIGRsZywgUkVDVCAqcikKIAkJICAgICAgIGhpbnN0YW5jZSwKIAkJ
ICAgICAgIDApOwogICBTaG93V2luZG93IChsdiwgU1dfU0hPVyk7Ci0KLSAg
Zm9yIChpID0gMDsgaGVhZGVyc1tpXS50ZXh0OyBpKyspCi0gICAgaGVhZGVy
c1tpXS53aWR0aCA9IDA7Ci0KICAgSERDIGRjID0gR2V0REMgKGx2KTsKICAg
c3lzZm9udCA9IEdldFN0b2NrT2JqZWN0IChERUZBVUxUX0dVSV9GT05UKTsK
ICAgU2VsZWN0T2JqZWN0IChkYywgc3lzZm9udCk7CkBAIC01NjMsMzAgKzEw
NTAsMTQgQEAgY3JlYXRlX2xpc3R2aWV3IChIV05EIGRsZywgUkVDVCAqcikK
ICAgaWYgKHJvd19oZWlnaHQgPCBpcmgpCiAgICAgcm93X2hlaWdodCA9IGly
aDsKIAotICBmb3IgKGkgPSAwOyBoZWFkZXJzW2ldLnRleHQ7IGkrKykKLSAg
ICBub3RlX3dpZHRoIChkYywgaGVhZGVyc1tpXS50ZXh0LCAwLCBpKTsKLSAg
Zm9yIChQYWNrYWdlICpwa2cgPSBwYWNrYWdlOyBwa2ctPm5hbWU7IHBrZysr
KQotICAgIHsKLSAgICAgIGlmIChwa2ctPmluc3RhbGxlZCkKLQl7Ci0JICBu
b3RlX3dpZHRoIChkYywgcGtnLT5pbnN0YWxsZWQtPnZlcnNpb24sIDAsIENV
UlJFTlRfQ09MKTsKLQkgIG5vdGVfd2lkdGggKGRjLCBwa2ctPmluc3RhbGxl
ZC0+dmVyc2lvbiwgTkVXX0NPTF9TSVpFX1NMT1AsIE5FV19DT0wpOwotCX0K
LSAgICAgIGZvciAoSW5mbyAqaW5mID0gcGtnLT5pbmZvc2NhbjsgaW5mIDwg
cGtnLT5pbmZvZW5kOyBpbmYrKykKLQlub3RlX3dpZHRoIChkYywgaW5mLT52
ZXJzaW9uLCBORVdfQ09MX1NJWkVfU0xPUCwgTkVXX0NPTCk7Ci0gICAgICBu
b3RlX3dpZHRoIChkYywgcGtnLT5uYW1lLCAwLCBQQUNLQUdFX0NPTCk7Ci0g
ICAgICBub3RlX3dpZHRoIChkYywgcGtnLT5zZGVzYywgMCwgUEFDS0FHRV9D
T0wpOwotICAgIH0KLSAgbm90ZV93aWR0aCAoZGMsICJrZWVwIiwgTkVXX0NP
TF9TSVpFX1NMT1AsIE5FV19DT0wpOwotICBub3RlX3dpZHRoIChkYywgInVu
aW5zdGFsbCIsIE5FV19DT0xfU0laRV9TTE9QLCBORVdfQ09MKTsKLQotICBo
ZWFkZXJzW0NVUlJFTlRfQ09MXS54ID0gSE1BUkdJTi8yOwotICBoZWFkZXJz
W05FV19DT0xdLnggPSBoZWFkZXJzW0NVUlJFTlRfQ09MXS54ICsgaGVhZGVy
c1tDVVJSRU5UX0NPTF0ud2lkdGggKyBORVdfQ09MX1NJWkVfU0xPUCArIEhN
QVJHSU47Ci0gIGhlYWRlcnNbU1JDX0NPTF0ueCA9IGhlYWRlcnNbTkVXX0NP
TF0ueCArIGhlYWRlcnNbTkVXX0NPTF0ud2lkdGggKyBITUFSR0lOOwotICBo
ZWFkZXJzW1BBQ0tBR0VfQ09MXS54ID0gaGVhZGVyc1tTUkNfQ09MXS54ICsg
aGVhZGVyc1tTUkNfQ09MXS53aWR0aCArIEhNQVJHSU47CisgIGNob29zZXIg
PSBuZXcgKHZpZXcpIChWSUVXX1BBQ0tBR0UsIGRjKTsKIAogICBkZWZhdWx0
X3RydXN0IChsdiwgVFJVU1RfQ1VSUik7Ci0gIHNldF9mdWxsX2xpc3QgKGx2
LCBmdWxsX2xpc3QpOworICBzZXRfdmlld19tb2RlIChsdiwgVklFV19QQUNL
QUdFKTsKKyAgaWYgKCFTZXREbGdJdGVtVGV4dCAoZGxnLCBJRENfQ0hPT1NF
X1ZJRVdDQVBUSU9OLCBjaG9vc2VyLT5tb2RlX2NhcHRpb24oKSkpCisgICAg
bG9nIChMT0dfQkFCQkxFLCAiRmFpbGVkIHRvIHNldCBWaWV3IGJ1dHRvbiBj
YXB0aW9uICVkIiwgR2V0TGFzdEVycm9yKCkgKTsKKyAgZm9yIChQYWNrYWdl
ICpmb28gPSBwYWNrYWdlOyBmb28tPm5hbWU7IGZvbysrKQorICAgIGFkZF9y
ZXF1aXJlZChmb28pOwogICBzdGF0aWMgaW50IHRhW10gPSB7IElEQ19DSE9P
U0VfQ1VSUiwgMCB9OwogICByYnNldCAoZGxnLCB0YSwgSURDX0NIT09TRV9D
VVJSKTsKIApAQCAtNjAwLDE4ICsxMDcxLDI2IEBAIGRpYWxvZ19jbWQgKEhX
TkQgaCwgaW50IGlkLCBIV05EIGh3bmRjdGwKICAgICB7CiAgICAgY2FzZSBJ
RENfQ0hPT1NFX1BSRVY6CiAgICAgICBkZWZhdWx0X3RydXN0IChsdiwgVFJV
U1RfUFJFVik7Ci0gICAgICBzZXRfZnVsbF9saXN0IChsdiwgZnVsbF9saXN0
KTsKKyAgICAgIGZvciAoUGFja2FnZSAqZm9vID0gcGFja2FnZTsgZm9vLT5u
YW1lOyBmb28rKykKKyAgICAgICAgYWRkX3JlcXVpcmVkKGZvbyk7CisgICAg
ICBzZXRfdmlld19tb2RlIChsdiwgY2hvb3Nlci0+Z2V0X3ZpZXdfbW9kZSAo
KSk7CiAgICAgICBicmVhazsKICAgICBjYXNlIElEQ19DSE9PU0VfQ1VSUjoK
ICAgICAgIGRlZmF1bHRfdHJ1c3QgKGx2LCBUUlVTVF9DVVJSKTsKLSAgICAg
IHNldF9mdWxsX2xpc3QgKGx2LCBmdWxsX2xpc3QpOworICAgICAgZm9yIChQ
YWNrYWdlICpmb28gPSBwYWNrYWdlOyBmb28tPm5hbWU7IGZvbysrKQorICAg
ICAgICBhZGRfcmVxdWlyZWQoZm9vKTsKKyAgICAgIHNldF92aWV3X21vZGUg
KGx2LCBjaG9vc2VyLT5nZXRfdmlld19tb2RlICgpKTsKICAgICAgIGJyZWFr
OwogICAgIGNhc2UgSURDX0NIT09TRV9FWFA6CiAgICAgICBkZWZhdWx0X3Ry
dXN0IChsdiwgVFJVU1RfVEVTVCk7Ci0gICAgICBzZXRfZnVsbF9saXN0IChs
diwgZnVsbF9saXN0KTsKKyAgICAgIGZvciAoUGFja2FnZSAqZm9vID0gcGFj
a2FnZTsgZm9vLT5uYW1lOyBmb28rKykKKyAgICAgICAgYWRkX3JlcXVpcmVk
KGZvbyk7CisgICAgICBzZXRfdmlld19tb2RlIChsdiwgY2hvb3Nlci0+Z2V0
X3ZpZXdfbW9kZSAoKSk7CiAgICAgICBicmVhazsKLSAgICBjYXNlIElEQ19D
SE9PU0VfRlVMTFBBUlQ6Ci0gICAgICBzZXRfZnVsbF9saXN0IChsdiwgIWZ1
bGxfbGlzdCk7CisgICAgY2FzZSBJRENfQ0hPT1NFX1ZJRVc6CisgICAgICBz
ZXRfdmlld19tb2RlIChsdiwgdmlld3NwbHVzcGx1cyAoY2hvb3Nlci0+Z2V0
X3ZpZXdfbW9kZSAoKSkpOworICAgICAgaWYgKCFTZXREbGdJdGVtVGV4dCAo
aCwgSURDX0NIT09TRV9WSUVXQ0FQVElPTiwgY2hvb3Nlci0+bW9kZV9jYXB0
aW9uKCkpKQorCWxvZyAoTE9HX0JBQkJMRSwgIkZhaWxlZCB0byBzZXQgVmll
dyBidXR0b24gY2FwdGlvbiAlZCIsIEdldExhc3RFcnJvcigpICk7CiAgICAg
ICBicmVhazsKIAogICAgIGNhc2UgSURPSzoKQEAgLTc4OSw2ICsxMjY4LDI4
IEBAIGdldHBrZ2J5bmFtZSAoY29uc3QgY2hhciAqcGtnbmFtZSkKICAgcmV0
dXJuIE5VTEw7CiB9CiAKKy8qIFJldHVybiBhIHBvaW50ZXIgdG8gYSBjYXRl
Z29yeSBnaXZlbiB0aGUgbmFtZS4gKi8KK0NhdGVnb3J5ICoKK2dldGNhdGVn
b3J5YnluYW1lIChjb25zdCBjaGFyICpjYXRlZ29yeW5hbWUpCit7CisgIGZv
ciAoQ2F0ZWdvcnkgKmNhdCA9IGNhdGVnb3J5OyBjYXQ7IGNhdD1jYXQtPm5l
eHQpCisgICAgaWYgKHN0cmNhc2VjbXAgKGNhdC0+bmFtZSwgY2F0ZWdvcnlu
YW1lKSA9PSAwKQorICAgICAgcmV0dXJuIGNhdDsKKworICByZXR1cm4gTlVM
TDsKK30KKworLyogUmV0dXJuIGEgcG9pbnRlciB0byBhIGNhdGVnb3J5IG9m
IGEgZ2l2ZW4gcGFja2FnZSBnaXZlbiB0aGUgbmFtZS4gKi8KK0NhdGVnb3J5
ICoKK2dldHBhY2thZ2VjYXRlZ29yeWJ5bmFtZSAoUGFja2FnZSAqcGtnLCBj
b25zdCBjaGFyICpjYXRlZ29yeW5hbWUpCit7CisgIGZvciAoQ2F0ZWdvcnkg
KmNhdCA9IHBrZy0+Y2F0ZWdvcnk7IGNhdDsgY2F0ID0gY2F0LT5uZXh0KQor
ICAgIGlmIChzdHJjYXNlY21wIChjYXQtPm5hbWUsIGNhdGVnb3J5bmFtZSkg
PT0gMCkKKyAgICAgIHJldHVybiBjYXQ7CisKKyAgcmV0dXJuIE5VTEw7Cit9
CisKIHN0YXRpYyB2b2lkCiBzY2FuMiAoY2hhciAqcGF0aCwgdW5zaWduZWQg
aW50IHNpemUpCiB7CkBAIC05MjEsNyArMTQyMiw3IEBAIHBhY2thZ2Vfc29y
dCAoY29uc3Qgdm9pZCAqdmEsIGNvbnN0IHZvaWQKIHsKICAgUGFja2FnZSAq
YSA9IChQYWNrYWdlICopdmE7CiAgIFBhY2thZ2UgKmIgPSAoUGFja2FnZSAq
KXZiOwotICByZXR1cm4gc3RyY21wIChhLT5uYW1lLCBiLT5uYW1lKTsKKyAg
cmV0dXJuIHN0cmNhc2VjbXAgKGEtPm5hbWUsIGItPm5hbWUpOwogfQogCiB2
b2lkCkBAIC05NDQsNiArMTQ0NSw3IEBAIGRvX2Nob29zZSAoSElOU1RBTkNF
IGgpCiAKICAgcmVhZF9pbnN0YWxsZWRfZGIgKCk7CiAgIHNldF9leGlzdGVu
Y2UgKCk7CisgIGZpbGxfbWlzc2luZ19jYXRlZ29yeSAoKTsKIAogICBxc29y
dCAocGFja2FnZSwgbnBhY2thZ2VzLCBzaXplb2YgKHBhY2thZ2VbMF0pLCBw
YWNrYWdlX3NvcnQpOwogCkBAIC05NjcsOSArMTQ2OSwxMCBAQCBkb19jaG9v
c2UgKEhJTlNUQU5DRSBoKQogCQkJICAgICAgIDogInVua25vd24iKTsKICAg
ICAgIGNvbnN0IGNoYXIgKmV4Y2x1ZGVkID0gKHBrZy0+ZXhjbHVkZSA/ICJ5
ZXMiIDogIm5vIik7CiAKLSAgICAgIGxvZyAoTE9HX0JBQkJMRSwgIlslc10g
YWN0aW9uPSVzIHRydXN0PSVzIGluc3RhbGxlZD0lcyBleGNsdWRlZD0lcyBz
cmM/PSVzIiwKKyAgICAgIGxvZyAoTE9HX0JBQkJMRSwgIlslc10gYWN0aW9u
PSVzIHRydXN0PSVzIGluc3RhbGxlZD0lcyBleGNsdWRlZD0lcyBzcmM/PSVz
IgorCSAgICJjYXRlZ29yeT0lcyIsCiAJICAgcGtnLT5uYW1lLCBhY3Rpb24s
IHRydXN0LCBpbnN0YWxsZWQsCi0JICAgZXhjbHVkZWQsIHBrZy0+c3JjcGlj
a2VkID8gInllcyIgOiAibm8iKTsKKwkgICBleGNsdWRlZCwgcGtnLT5zcmNw
aWNrZWQgPyAieWVzIiA6ICJubyIsIHBrZy0+Y2F0ZWdvcnkpOwogICAgICAg
Zm9yIChpbnQgdCA9IDE7IHQgPCBOVFJVU1Q7IHQrKykKIAl7CiAJICBpZiAo
cGtnLT5pbmZvW3RdLmluc3RhbGwpCkluZGV4OiBpbmkuaAo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3ZzL3NyYy9zcmMvd2luc3VwL2Np
bnN0YWxsL2luaS5oLHYKcmV0cmlldmluZyByZXZpc2lvbiAyLjEyCmRpZmYg
LXUgLXAgLXIyLjEyIGluaS5oCi0tLSBpbmkuaAkyMDAxLzA2LzE4IDAwOjQz
OjU3CTIuMTIKKysrIGluaS5oCTIwMDEvMDYvMjMgMTQ6MTI6NTEKQEAgLTEz
LDYgKzEzLDkgQEAKICAqCiAgKi8KIAorI2lmbmRlZiBfSU5JX0hfCisjZGVm
aW5lIF9JTklfSF8KKwogLyogV2hlbiBzZXR1cC5pbmkgaXMgcGFyc2VkLCB0
aGUgaW5mb3JtYXRpb24gaXMgc3RvcmVkIGFjY29yZGluZyB0bwogICAgdGhl
IGRlY2xhcmF0aW9ucyBoZXJlLiAgaW5pLmNjICh2aWEgaW5pbGV4IGFuZCBp
bmlwYXJzZSkKICAgIGluaXRpYWxpemVzIHRoZXNlIHN0cnVjdHVyZXMuICBj
aG9vc2UuY2Mgc2V0cyB0aGUgYWN0aW9uIGFuZCB0cnVzdApAQCAtNjIsNiAr
NjUsMTUgQEAgdHlwZWRlZiBlbnVtCiAgIEVYQ0xVREVfTk9UX0ZPVU5ECiB9
IGV4Y2x1ZGVzOwogCit0eXBlZGVmIGVudW0gCit7CisgIFZJRVdfVU5LTk9X
TiwKKyAgVklFV19QQUNLQUdFX0ZVTEwsCisgIFZJRVdfUEFDS0FHRSwKKyAg
VklFV19DQVRFR09SWSwKKyAgTlZJRVcKK30gdmlld3M7CisKICNkZWZpbmUg
aXNfZG93bmxvYWRfYWN0aW9uKHBrZykgXAogICAoKHBrZyktPmFjdGlvbiA9
PSBBQ1RJT05fUFJFViB8fCBcCiAgICAocGtnKS0+YWN0aW9uID09IEFDVElP
Tl9DVVJSIHx8IFwKQEAgLTk3LDYgKzEwOSwxOSBAQCB0eXBlZGVmIHN0cnVj
dCBfSW5mbwogI2VuZGlmCiB9IEluZm87CQkJLyogKzEgZm9yIFRSVVNUX1VO
S05PV04gKi8KIAordHlwZWRlZiBzdHJ1Y3QgX0NhdGVnb3J5UGFja2FnZQor
eworICBzdHJ1Y3QgX0NhdGVnb3J5UGFja2FnZSAqbmV4dDsgIC8qIFRoZSBu
ZXh0IHBhY2thZ2UgcG9pbnRlciBpbiB0aGUgbGlzdCAqLworICBjaGFyICpw
a2c7CQkJICAvKiBUaGlzIHNob3VsZCBiZSBQYWNrYWdlICosIGJ1dCB0aGUg
cGFja2FnZXMgY2FuIG1vdmUqLworfSBDYXRlZ29yeVBhY2thZ2U7CisKK3R5
cGVkZWYgc3RydWN0IF9DYXRlZ29yeQoreworICBzdHJ1Y3QgX0NhdGVnb3J5
ICpuZXh0OyAvKiB0aGUgbmV4dCBjYXRlZ29yeSBpbiB0aGUgbGlzdCAqLwor
ICBjaGFyICpuYW1lOwkJICAvKiB0aGUgY2F0ZWdvcnkgKi8KKyAgQ2F0ZWdv
cnlQYWNrYWdlICpwYWNrYWdlczsgLyogdGhlIHBhY2thZ2VzIGluIHRoaXMg
Y2F0ZWdvcnkgKi8KK30gQ2F0ZWdvcnk7CisKIHR5cGVkZWYgc3RydWN0IF9E
ZXBlbmRlbmN5CiB7CiAgIHN0cnVjdCBfRGVwZW5kZW5jeSAqbmV4dDsgLyog
dGhlIG5leHQgcGFja2FnZSBpbiB0aGlzIGRlcGVuZGVuY3kgbGlzdCAqLwpA
QCAtMTA4LDcgKzEzMyw3IEBAIHR5cGVkZWYgc3RydWN0CiAgIGNoYXIgKm5h
bWU7CQkvKiBwYWNrYWdlIG5hbWUsIGxpa2UgImN5Z3dpbiIgKi8KICAgY2hh
ciAqc2Rlc2M7CQkvKiBzaG9ydCBkZXNjcmlwdGlvbiAocmVwbGFjZXMgIm5h
bWUiIGlmIHByb3ZpZGVkKSAqLwogICBjaGFyICpsZGVzYzsJCS8qIGxvbmcg
ZGVzY3JpcHRpb24gKG11bHRpLWxpbmUpICovCi0gIGNoYXIgKmNhdGVnb3J5
OyAvKiB0aGUgY2F0ZWdvcnkgdGhlIHBhY2thZ2UgYmVsb25ncyB0bywgbGlr
ZSAicmVxdWlyZWQiIG9yICJYRnJlZTg2IiAqLworICBDYXRlZ29yeSAqY2F0
ZWdvcnk7ICAgLyogdGhlIGNhdGVnb3JpZXMgdGhlIHBhY2thZ2UgYmVsb25n
cyB0byAqLyAKICAgRGVwZW5kZW5jeSAqcmVxdWlyZWQ7IC8qIHRoZSBwYWNr
YWdlcyByZXF1aXJlZCBmb3IgdGhpcyBwYWNrYWdlIHRvIHdvcmsgKi8KICAg
YWN0aW9ucyBhY3Rpb247CS8qIEEgcmFuZ2Ugb2Ygc3RhdGVzIGFwcGxpY2Fi
bGUgdG8gdGhpcyBwYWNrYWdlICovCiAgIHRydXN0cyB0cnVzdDsJCS8qIFNl
bGVjdHMgYW1vbmcgaW5mb1tdIGJlbG93LCBhIHN1YnNldCBvZiBhY3Rpb24g
Ki8KQEAgLTEyOSw2ICsxNTQsOCBAQCB0eXBlZGVmIHN0cnVjdAogCiBleHRl
cm4gUGFja2FnZSAqcGFja2FnZTsKIGV4dGVybiBpbnQgbnBhY2thZ2VzOwor
ZXh0ZXJuIENhdGVnb3J5ICpjYXRlZ29yeTsKK2V4dGVybiBpbnQgbmNhdGVn
b3JpZXM7CiAKICNpZmRlZiBfX2NwbHVzcGx1cwogZXh0ZXJuICJDIiB7CkBA
IC0xMzgsNyArMTY1LDEzIEBAIFBhY2thZ2UgKm5ld19wYWNrYWdlIChjaGFy
ICpuYW1lKTsKIHZvaWQJaW5pX2luaXQgKGNoYXIgKnN0cmluZyk7CiBQYWNr
YWdlICpnZXRwa2dieW5hbWUgKGNvbnN0IGNoYXIgKnBrZ25hbWUpOwogdm9p
ZCAgICBuZXdfcmVxdWlyZW1lbnQgKFBhY2thZ2UgKnBhY2thZ2UsIGNoYXIg
KmRlcGVuZHNvbik7CitDYXRlZ29yeSAqZ2V0Y2F0ZWdvcnlieW5hbWUgKGNv
bnN0IGNoYXIgKmNhdGVnb3J5bmFtZSk7CitDYXRlZ29yeSAqZ2V0cGFja2Fn
ZWNhdGVnb3J5YnluYW1lIChQYWNrYWdlICpwa2csIGNvbnN0IGNoYXIgKmNh
dGVnb3J5bmFtZSk7IAorQ2F0ZWdvcnkgKnJlZ2lzdGVyX2NhdGVnb3J5IChj
aGFyICpuYW1lKTsKK3ZvaWQgICAgYWRkX2NhdGVnb3J5IChQYWNrYWdlICpw
YWNrYWdlLCBDYXRlZ29yeSAqY2F0KTsKIAogI2lmZGVmIF9fY3BsdXNwbHVz
CiB9CiAjZW5kaWYKKworI2VuZGlmIC8qIF9JTklfSF8gKi8KSW5kZXg6IGlu
aXBhcnNlLnkKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2N2
cy9zcmMvc3JjL3dpbnN1cC9jaW5zdGFsbC9pbmlwYXJzZS55LHYKcmV0cmll
dmluZyByZXZpc2lvbiAyLjkKZGlmZiAtdSAtcCAtcjIuOSBpbmlwYXJzZS55
Ci0tLSBpbmlwYXJzZS55CTIwMDEvMDYvMTUgMDQ6MDU6MzEJMi45CisrKyBp
bmlwYXJzZS55CTIwMDEvMDYvMjMgMTQ6MTI6NTEKQEAgLTg2LDcgKzg2LDgg
QEAgc2ltcGxlX2xpbmUKICA6IFZFUlNJT04gU1RSSU5HCQl7IGNwdC0+dmVy
c2lvbiA9ICQyOyB9CiAgfCBTREVTQyBTVFJJTkcJCQl7IGNwLT5zZGVzYyA9
ICQyOyB9CiAgfCBMREVTQyBTVFJJTkcJCQl7IGNwLT5sZGVzYyA9ICQyOyB9
Ci0gfCBDQVRFR09SWSBTVFJJTkcJCXsgY3AtPmNhdGVnb3J5ID0gJDI7IH0K
KyB8IENBVEVHT1JZIFNUUklORwkJeyBhZGRfY2F0ZWdvcnkgKGNwLCByZWdp
c3Rlcl9jYXRlZ29yeSAoJDIpKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgfQogIHwgUkVRVUlSRVMgcmVxdWlyZXMKICB8IElOU1RBTEwg
U1RSSU5HIFNUUklORwl7IGNwdC0+aW5zdGFsbCA9ICQyOwogCQkJCSAgY3B0
LT5pbnN0YWxsX3NpemUgPSBhdG9pKCQzKTsKQEAgLTEyMSwxMSArMTIyLDEz
IEBAIHJlcXVpcmVzCiBQYWNrYWdlICpwYWNrYWdlID0gTlVMTDsKIGludCBu
cGFja2FnZXMgPSAwOwogc3RhdGljIGludCBtYXhwYWNrYWdlcyA9IDA7CitD
YXRlZ29yeSAqY2F0ZWdvcnkgPSBOVUxMOworaW50IG5jYXRlZ29yaWVzID0g
MDsKIAogUGFja2FnZSAqCiBuZXdfcGFja2FnZSAoY2hhciAqbmFtZSkKIHsK
LSAgaWYgKHBhY2thZ2UgPT0gMCkKKyAgaWYgKHBhY2thZ2UgPT0gTlVMTCkK
ICAgICBtYXhwYWNrYWdlcyA9IG5wYWNrYWdlcyA9IDA7CiAgIGlmIChucGFj
a2FnZXMgPj0gbWF4cGFja2FnZXMpCiAgICAgewpAQCAtMTQ5LDcgKzE1Miw3
IEBAIG5ld19wYWNrYWdlIChjaGFyICpuYW1lKQogfQogCiB2b2lkCi1uZXdf
cmVxdWlyZW1lbnQoUGFja2FnZSAqcGFja2FnZSwgY2hhciAqZGVwZW5kc29u
KQorbmV3X3JlcXVpcmVtZW50IChQYWNrYWdlICpwYWNrYWdlLCBjaGFyICpk
ZXBlbmRzb24pCiB7CiAgIERlcGVuZGVuY3kgKmRwOwogICBpZiAoIWRlcGVu
ZHNvbikKQEAgLTE1OCw0ICsxNjEsNTggQEAgbmV3X3JlcXVpcmVtZW50KFBh
Y2thZ2UgKnBhY2thZ2UsIGNoYXIgKgogICBkcC0+bmV4dCA9IGNwLT5yZXF1
aXJlZDsKICAgZHAtPnBhY2thZ2UgPSBkZXBlbmRzb247CiAgIGNwLT5yZXF1
aXJlZCA9IGRwOworfQorCitDYXRlZ29yeSAqCityZWdpc3Rlcl9jYXRlZ29y
eSAoY2hhciAqbmFtZSkKK3sKKyAgQ2F0ZWdvcnkgKnRlbXBjYXQ7CisgIGlm
IChjYXRlZ29yeSA9PSBOVUxMKQorICAgIG5jYXRlZ29yaWVzID0gMDsKKyAg
dGVtcGNhdCA9IGdldGNhdGVnb3J5YnluYW1lIChuYW1lKTsKKyAgaWYgKCF0
ZW1wY2F0KQorICAgIHsKKyAgICAgIENhdGVnb3J5ICpzb3J0Y2F0ID0gY2F0
ZWdvcnk7CisgICAgICB0ZW1wY2F0ID0gbmV3IChDYXRlZ29yeSk7CisgICAg
ICBtZW1zZXQgKHRlbXBjYXQsICdcMCcsIHNpemVvZiAoQ2F0ZWdvcnkpKTsK
KyAgICAgIHRlbXBjYXQtPm5hbWUgPSBzdHJkdXAgKG5hbWUpOworICAgICAg
aWYgKCFzb3J0Y2F0IHx8IHN0cmNhc2VjbXAoc29ydGNhdC0+bmFtZSwgbmFt
ZSkgPiAwKQorCXsKKwkgIHRlbXBjYXQtPm5leHQgPSBjYXRlZ29yeTsKKwkg
IGNhdGVnb3J5ID0gdGVtcGNhdDsKKwl9CisgICAgICBlbHNlCisJeworCSAg
d2hpbGUgKHNvcnRjYXQtPm5leHQgJiYgCisJCSBzdHJjYXNlY21wKHNvcnRj
YXQtPm5leHQtPm5hbWUsIHRlbXBjYXQtPm5hbWUpIDwgMCkKKwkgICAgewor
CSAgICAgIHRlbXBjYXQtPm5leHQgPSBzb3J0Y2F0LT5uZXh0OworCSAgICAg
IHNvcnRjYXQtPm5leHQgPSB0ZW1wY2F0OworCSAgICB9CisJfQorICAgICAg
bmNhdGVnb3JpZXMrKzsKKyAgICB9CisgIHJldHVybiB0ZW1wY2F0OworfQor
Cit2b2lkCithZGRfY2F0ZWdvcnkgKFBhY2thZ2UgKnBhY2thZ2UsIENhdGVn
b3J5ICpjYXQpCit7CisgIC8qIGFkZCBhIG5ldyByZWNvcmQgZm9yIHRoZSBw
YWNrYWdlIGxpc3QgKi8KKyAgLyogVE9ETzogYWxwYWJldGljYWwgaW5zZXJ0
cyA/ICovCisgIENhdGVnb3J5ICp0ZW1wY2F0OworICBDYXRlZ29yeVBhY2th
Z2UgKnRlbXBsaW5rOworICB0ZW1wY2F0ID0gbmV3IChDYXRlZ29yeSk7Cisg
IG1lbXNldCAodGVtcGNhdCwgJ1wwJywgc2l6ZW9mIChDYXRlZ29yeSkpOwor
ICB0ZW1wY2F0LT5uZXh0ID0gcGFja2FnZS0+Y2F0ZWdvcnk7CisgIHRlbXBj
YXQtPm5hbWUgPSBjYXQtPm5hbWU7CisgIHBhY2thZ2UtPmNhdGVnb3J5ID0g
dGVtcGNhdDsKKworICB0ZW1wbGluayA9IG5ldyAoQ2F0ZWdvcnlQYWNrYWdl
KTsKKyAgdGVtcGxpbmstPm5leHQgPSBjYXQtPnBhY2thZ2VzOworICB0ZW1w
bGluay0+cGtnID0gcGFja2FnZS0+bmFtZTsKKyAgY2F0LT5wYWNrYWdlcyA9
IHRlbXBsaW5rOworIAorICAvKiBoYWNrIHRvIGVuc3VyZSB3ZSBhbGxvY2F0
ZSBlbm91Z2ggc3BhY2UgKi8KKyAgbmNhdGVnb3JpZXMrKzsgCiB9CkluZGV4
OiByZXMucmMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2N2
cy9zcmMvc3JjL3dpbnN1cC9jaW5zdGFsbC9yZXMucmMsdgpyZXRyaWV2aW5n
IHJldmlzaW9uIDIuMjAKZGlmZiAtdSAtcCAtcjIuMjAgcmVzLnJjCi0tLSBy
ZXMucmMJMjAwMS8wNS8yOCAwODozMTowMgkyLjIwCisrKyByZXMucmMJMjAw
MS8wNi8yMyAxNDoxMjo1MQpAQCAtMjQwLDcgKzI0MCw4IEBAIEJFR0lOCiAg
ICAgQ09OVFJPTCAgICAgICAgICJTUElOIixJRENfU1RBVElDLCJTdGF0aWMi
LFNTX0JJVE1BUCw1NSwxNzAsMTUsMTMKICAgICBMVEVYVCAgICAgICAgICAg
Ij0gY2xpY2sgdG8gY2hvb3NlIGFjdGlvbiwgKHApID0gcHJldmlvdXMgdmVy
c2lvbiwgKHgpID0gZXhwZXJpbWVudGFsIiwKICAgICAgICAgICAgICAgICAg
ICAgSURDX1NUQVRJQyw2NSwxNzAsMjIwLDgKLSAgICBQVVNIQlVUVE9OICAg
ICAgIkZ1bGwvUGFydCIsSURDX0NIT09TRV9GVUxMUEFSVCwyODMsNSwzNSwx
MAorICAgIFBVU0hCVVRUT04gICAgICAiVmlldyIsSURDX0NIT09TRV9WSUVX
LDI3OCw1LDIwLDEwCisgICAgTFRFWFQgICAgICAgICAgICIiLCAgIElEQ19D
SE9PU0VfVklFV0NBUFRJT04sIDMwMCw1LDMwLDEwCiAgICAgQ09OVFJPTCAg
ICAgICAgICJFJnhwIixJRENfQ0hPT1NFX0VYUCwiQnV0dG9uIixCU19BVVRP
UkFESU9CVVRUT04gfCAKICAgICAgICAgICAgICAgICAgICAgV1NfR1JPVVAs
MjQ4LDUsMjUsMTAKICAgICBDT05UUk9MICAgICAgICAgIiZDdXJyIixJRENf
Q0hPT1NFX0NVUlIsIkJ1dHRvbiIsQlNfQVVUT1JBRElPQlVUVE9OLDIyMiwK
SW5kZXg6IHJlc291cmNlLmgKPT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1Mg
ZmlsZTogL2N2cy9zcmMvc3JjL3dpbnN1cC9jaW5zdGFsbC9yZXNvdXJjZS5o
LHYKcmV0cmlldmluZyByZXZpc2lvbiAyLjExCmRpZmYgLXUgLXAgLXIyLjEx
IHJlc291cmNlLmgKLS0tIHJlc291cmNlLmgJMjAwMS8wNS8yOCAwODozMTow
MgkyLjExCisrKyByZXNvdXJjZS5oCTIwMDEvMDYvMjMgMTQ6MTI6NTEKQEAg
LTg0LDcgKzg0LDcgQEAKICNkZWZpbmUgSURDX05FVF9QQVNTV0QgICAgICAg
ICAgICAgICAgICAxMDMxCiAjZGVmaW5lIElEQ19WRVJTSU9OICAgICAgICAg
ICAgICAgICAgICAgMTAzMwogI2RlZmluZSBJRENfTElTVFZJRVdfUE9TICAg
ICAgICAgICAgICAgIDEwMzQKLSNkZWZpbmUgSURDX0NIT09TRV9GVUxMUEFS
VCAgICAgICAgICAgICAxMDM1CisjZGVmaW5lIElEQ19DSE9PU0VfVklFVyAg
ICAgICAgICAgICAgICAgMTAzNQogI2RlZmluZSBJRENfQ0hPT1NFX0VYUCAg
ICAgICAgICAgICAgICAgIDEwMzYKICNkZWZpbmUgSURDX0NIT09TRV9DVVJS
ICAgICAgICAgICAgICAgICAxMDM3CiAjZGVmaW5lIElEQ19DSE9PU0VfUFJF
ViAgICAgICAgICAgICAgICAgMTAzOApAQCAtMTAwLDYgKzEwMCw3IEBACiAj
ZGVmaW5lIElEQ19ETFNfUFBST0dSRVNTX1RFWFQgICAgICAgICAgMTA0OAog
I2RlZmluZSBJRENfRExTX0lQUk9HUkVTU19URVhUICAgICAgICAgIDEwNDkK
ICNkZWZpbmUgSURDX0NIT09TRV9JTlNUX1RFWFQgICAgICAxMDUwCisjZGVm
aW5lIElEQ19DSE9PU0VfVklFV0NBUFRJT04gICAgICAgICAgMTA1MQogI2Rl
ZmluZSBJRENfU1RBVElDICAgICAgICAgICAgICAgICAgICAgIC0xCiAKIC8v
IE5leHQgZGVmYXVsdCB2YWx1ZXMgZm9yIG5ldyBvYmplY3RzCkBAIC0xMTAs
NyArMTExLDcgQEAKICNkZWZpbmUgX0FQU18zRF9DT05UUk9MUyAgICAgICAg
ICAgICAgICAgICAgIDEKICNkZWZpbmUgX0FQU19ORVhUX1JFU09VUkNFX1ZB
TFVFICAgICAgICAxMjcKICNkZWZpbmUgX0FQU19ORVhUX0NPTU1BTkRfVkFM
VUUgICAgICAgICA0MDAwMwotI2RlZmluZSBfQVBTX05FWFRfQ09OVFJPTF9W
QUxVRSAgICAgICAgIDEwNTEKKyNkZWZpbmUgX0FQU19ORVhUX0NPTlRST0xf
VkFMVUUgICAgICAgICAxMDUyCiAjZGVmaW5lIF9BUFNfTkVYVF9TWU1FRF9W
QUxVRSAgICAgICAgICAgMTAxCiAjZW5kaWYKICNlbmRpZgo=

------------=_1583532848-65438-76--
